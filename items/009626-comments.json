[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25405540",
    "html_url": "https://github.com/rust-lang/rust/issues/9626#issuecomment-25405540",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9626",
    "id": 25405540,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NDA1NTQw",
    "user": {
      "login": "bmaxa",
      "id": 5524409,
      "node_id": "MDQ6VXNlcjU1MjQ0MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5524409?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bmaxa",
      "html_url": "https://github.com/bmaxa",
      "followers_url": "https://api.github.com/users/bmaxa/followers",
      "following_url": "https://api.github.com/users/bmaxa/following{/other_user}",
      "gists_url": "https://api.github.com/users/bmaxa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bmaxa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bmaxa/subscriptions",
      "organizations_url": "https://api.github.com/users/bmaxa/orgs",
      "repos_url": "https://api.github.com/users/bmaxa/repos",
      "events_url": "https://api.github.com/users/bmaxa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bmaxa/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-30T20:56:33Z",
    "updated_at": "2013-09-30T20:56:33Z",
    "body": "Here is example of simple TCP server that will give you idea how to write\nyours. Server spawns lightweight thread on new connection\nand handles read/write in there so you could handle xxx connections\nsimultaneously. Eof is when stream.read() functions return None.\nThis server closes connection after single read, so you can\ntest eg with a(pache)b(ench) or something.\n\n``` rust\nuse std::rt::io::net::tcp::TcpListener;\nuse std::rt::io::{Reader, Writer, Listener, Acceptor};\nuse std::rt::io::net::ip::{SocketAddr, Ipv4Addr};\nuse std::str;\nuse std::cell::Cell;\n\nfn main() {\n    let addr = SocketAddr {\n        ip: Ipv4Addr(0, 0, 0, 0),\n        port: 9090\n    };\n\n    let mut acceptor = TcpListener::bind(addr).listen().unwrap();\n\n    println(\"Listener is ready\");\n\n    loop {\n        let stream = acceptor.accept().unwrap();\n        let stream = Cell::new(stream);\n        do spawn{\n            let mut buf = [0,..512];\n            let mut stream = stream.take();\n            loop {\n                match stream.read(buf) {\n                    Some(count) => {\n                        print(\"read \"+count.to_str()+\" bytes: \"+str::from_utf8(buf));\n                        stream.write(bytes!(\"Hello World\\r\\n\"));\n                        break; // close connection after read\n                    }\n                    None => { println(\"Finished\"); break } // connection is closed by client\n                }\n            }\n\n        }\n\n    }\n}\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25405540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25406476",
    "html_url": "https://github.com/rust-lang/rust/issues/9626#issuecomment-25406476",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9626",
    "id": 25406476,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NDA2NDc2",
    "user": {
      "login": "simao",
      "id": 203575,
      "node_id": "MDQ6VXNlcjIwMzU3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/203575?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/simao",
      "html_url": "https://github.com/simao",
      "followers_url": "https://api.github.com/users/simao/followers",
      "following_url": "https://api.github.com/users/simao/following{/other_user}",
      "gists_url": "https://api.github.com/users/simao/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/simao/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/simao/subscriptions",
      "organizations_url": "https://api.github.com/users/simao/orgs",
      "repos_url": "https://api.github.com/users/simao/repos",
      "events_url": "https://api.github.com/users/simao/events{/privacy}",
      "received_events_url": "https://api.github.com/users/simao/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-30T21:08:39Z",
    "updated_at": "2013-09-30T21:08:39Z",
    "body": "Hello,\n\nThis code has the same problem as mine.\n\nIf you change the size of the buffer to a small value, like `[0,..1]`, emulating a big request from the client, the server needs to loop in order to call `.read` multiple times before closing the connection.\n\nOn the last `.read`, when the client already sent the complete request, the server will block forever waiting for more data from the client, and never close the connection. This could be avoided if we could call `.eof` before calling `.read` again, but `.eof` is not yet implemented in tcp.rs.\n\nThanks!\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25406476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25407036",
    "html_url": "https://github.com/rust-lang/rust/issues/9626#issuecomment-25407036",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9626",
    "id": 25407036,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NDA3MDM2",
    "user": {
      "login": "bmaxa",
      "id": 5524409,
      "node_id": "MDQ6VXNlcjU1MjQ0MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5524409?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bmaxa",
      "html_url": "https://github.com/bmaxa",
      "followers_url": "https://api.github.com/users/bmaxa/followers",
      "following_url": "https://api.github.com/users/bmaxa/following{/other_user}",
      "gists_url": "https://api.github.com/users/bmaxa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bmaxa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bmaxa/subscriptions",
      "organizations_url": "https://api.github.com/users/bmaxa/orgs",
      "repos_url": "https://api.github.com/users/bmaxa/repos",
      "events_url": "https://api.github.com/users/bmaxa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bmaxa/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-30T21:15:45Z",
    "updated_at": "2013-09-30T21:15:45Z",
    "body": "Eof will not help, as it will never trigger if client does not closes connection (and we know\nalready if client closes, read returns None).\nSo problem is that you have to know when to stop reading and start writing,\n and that's a matter of protocol.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25407036/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25411482",
    "html_url": "https://github.com/rust-lang/rust/issues/9626#issuecomment-25411482",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9626",
    "id": 25411482,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NDExNDgy",
    "user": {
      "login": "simao",
      "id": 203575,
      "node_id": "MDQ6VXNlcjIwMzU3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/203575?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/simao",
      "html_url": "https://github.com/simao",
      "followers_url": "https://api.github.com/users/simao/followers",
      "following_url": "https://api.github.com/users/simao/following{/other_user}",
      "gists_url": "https://api.github.com/users/simao/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/simao/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/simao/subscriptions",
      "organizations_url": "https://api.github.com/users/simao/orgs",
      "repos_url": "https://api.github.com/users/simao/repos",
      "events_url": "https://api.github.com/users/simao/events{/privacy}",
      "received_events_url": "https://api.github.com/users/simao/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-30T22:21:33Z",
    "updated_at": "2013-09-30T22:21:33Z",
    "body": "Ah I see! Thank you for your help!\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25411482/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25411657",
    "html_url": "https://github.com/rust-lang/rust/issues/9626#issuecomment-25411657",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9626",
    "id": 25411657,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NDExNjU3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-30T22:24:16Z",
    "updated_at": "2013-09-30T22:24:16Z",
    "body": "Closing because I agree that this is a protocol thing and not a rt::io thing.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25411657/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
