[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/121346463",
    "html_url": "https://github.com/rust-lang/rust/issues/27023#issuecomment-121346463",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27023",
    "id": 121346463,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMTM0NjQ2Mw==",
    "user": {
      "login": "elinorbgr",
      "id": 3009227,
      "node_id": "MDQ6VXNlcjMwMDkyMjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3009227?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elinorbgr",
      "html_url": "https://github.com/elinorbgr",
      "followers_url": "https://api.github.com/users/elinorbgr/followers",
      "following_url": "https://api.github.com/users/elinorbgr/following{/other_user}",
      "gists_url": "https://api.github.com/users/elinorbgr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elinorbgr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elinorbgr/subscriptions",
      "organizations_url": "https://api.github.com/users/elinorbgr/orgs",
      "repos_url": "https://api.github.com/users/elinorbgr/repos",
      "events_url": "https://api.github.com/users/elinorbgr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elinorbgr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-14T19:17:01Z",
    "updated_at": "2015-07-14T19:17:01Z",
    "body": "I also reproduce this running `make check-stage1-rpass` on my 64bits linux with this configure:\n\n```\n./configure --llvm-root=/usr/ --enable-debug --disable-docs --enable-optimize\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/121346463/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122859001",
    "html_url": "https://github.com/rust-lang/rust/issues/27023#issuecomment-122859001",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27023",
    "id": 122859001,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjg1OTAwMQ==",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-20T11:45:03Z",
    "updated_at": "2015-07-20T11:53:55Z",
    "body": "I can reproduce this as well on my Mac.  (After applying #27139 to get around debuginfo issues, I then hit this bug; configure flags `--enable-debug --enable-optimize --enable-ccache --enable-clang --disable-optimize-tests --disable-llvm-assertions --disable-debuginfo`)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122859001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122862053",
    "html_url": "https://github.com/rust-lang/rust/issues/27023#issuecomment-122862053",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27023",
    "id": 122862053,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjg2MjA1Mw==",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-20T11:55:39Z",
    "updated_at": "2015-07-20T11:55:39Z",
    "body": "(flagging as `I-crash` because jemalloc assert fails sound especially scary, in terms of potential threat, to me.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122862053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122947573",
    "html_url": "https://github.com/rust-lang/rust/issues/27023#issuecomment-122947573",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27023",
    "id": 122947573,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjk0NzU3Mw==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-20T16:50:59Z",
    "updated_at": "2015-07-20T16:50:59Z",
    "body": "Looks like this is indeed a memory unsafety bug. We're allocating a chunk of memory with a size of 16 bytes and then deallocating it with the size of 20 bytes. This was never found because jemalloc assertions are normally disabled, but `--enable-debug` builds enable these assertions. Optimization and debuginfo are unrelated to this bug.\n\nTo see this in action, this program will abort because the assertion in `exchange_free` is tripped. Note that this doesn't print anything, it just aborts:\n\n``` rust\n#![feature(no_std, lang_items, start, box_syntax, unsize, unique, core_prelude)]\n#![feature(core, coerce_unsized, core_intrinsics, libc, linkage)]\n#![no_std]\n#![allow(improper_ctypes)]\n\n#[macro_use]\nextern crate core;\nextern crate libc;\n\nuse core::prelude::*;\nuse core::ptr::Unique;\nuse core::marker::Unsize;\nuse core::ops::CoerceUnsized;\n\nstruct Wrapper<'a, T: ?Sized>(&'a mut i32, T);\n\nimpl<'a, T: ?Sized> Drop for Wrapper<'a, T> {\n    fn drop(&mut self) {}\n}\n\n#[lang = \"owned_box\"]\nstruct Box<T>(Unique<T>);\nimpl<T: ?Sized+Unsize<U>, U: ?Sized> CoerceUnsized<Box<U>> for Box<T> {}\n\n#[start]\nfn start(_argc: isize, _argv: *const *const u8) -> isize {\n    let mut x = 3;\n    let wrapper: Box<Wrapper<i32>> = box Wrapper(&mut x, 123);\n    let _: Box<Wrapper<Send>> = wrapper;\n    0\n}\n\n#[lang = \"exchange_malloc\"]\nunsafe fn exchange_malloc(size: usize, align: usize) -> *mut u8 {\n    assert_eq!(size, 16);\n    assert_eq!(align, 8);\n    extern {\n        fn malloc(size: usize) -> *mut u8;\n    }\n    malloc(size)\n}\n\n#[lang = \"exchange_free\"]\nunsafe fn exchange_free(ptr: *mut u8, old_size: usize, align: usize) {\n    assert_eq!(old_size, 16);\n    assert_eq!(align, 8);\n    extern {\n        fn free(ptr: *mut u8);\n    }\n    free(ptr)\n}\n\n\n\n#[lang = \"stack_exhausted\"] extern fn stack_exhausted() {}\n#[lang = \"eh_personality\"] extern fn eh_personality() {}\n#[lang = \"panic_fmt\"]\n#[linkage = \"external\"]\npub fn panic_fmt() -> ! {\n    unsafe { core::intrinsics::abort() }\n}\n```\n\nNominating as this seems like a minor codegen bug (perhaps related to the warning that's printed), but I don't think that it's too too urgent to fix immediately.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122947573/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122947631",
    "html_url": "https://github.com/rust-lang/rust/issues/27023#issuecomment-122947631",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27023",
    "id": 122947631,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjk0NzYzMQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-20T16:51:16Z",
    "updated_at": "2015-07-20T16:51:16Z",
    "body": "Also updated the title a bit.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122947631/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/124339012",
    "html_url": "https://github.com/rust-lang/rust/issues/27023#issuecomment-124339012",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27023",
    "id": 124339012,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNDMzOTAxMg==",
    "user": {
      "login": "eefriedman",
      "id": 12769964,
      "node_id": "MDQ6VXNlcjEyNzY5OTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/12769964?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eefriedman",
      "html_url": "https://github.com/eefriedman",
      "followers_url": "https://api.github.com/users/eefriedman/followers",
      "following_url": "https://api.github.com/users/eefriedman/following{/other_user}",
      "gists_url": "https://api.github.com/users/eefriedman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eefriedman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eefriedman/subscriptions",
      "organizations_url": "https://api.github.com/users/eefriedman/orgs",
      "repos_url": "https://api.github.com/users/eefriedman/repos",
      "events_url": "https://api.github.com/users/eefriedman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eefriedman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-24T06:04:45Z",
    "updated_at": "2015-07-24T06:04:45Z",
    "body": "The testcase can be simplified by just using size_of_val:\n\n``` rust\nstruct Wrapper<'a, T: ?Sized>(&'a mut i32, T);\nimpl<'a, T: ?Sized> Drop for Wrapper<'a, T> {\n    fn drop(&mut self) {}\n}\nfn main() {\n    let mut x = 3;\n    let wrapper: Box<Wrapper<i32>> = Box::new(Wrapper(&mut x, 123));\n    assert_eq!(std::mem::size_of_val(&*wrapper), 16);\n    let wrapper2: Box<Wrapper<Send>> = wrapper;\n    assert_eq!(std::mem::size_of_val(&*wrapper2), 16); // currently fails\n}\n```\n\nThis is essentially the same as issue #26403.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/124339012/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130830364",
    "html_url": "https://github.com/rust-lang/rust/issues/27023#issuecomment-130830364",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27023",
    "id": 130830364,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDgzMDM2NA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-13T20:28:11Z",
    "updated_at": "2015-08-13T20:28:11Z",
    "body": "I believe this was fixed in #27351\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130830364/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/240889623",
    "html_url": "https://github.com/rust-lang/rust/issues/27023#issuecomment-240889623",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27023",
    "id": 240889623,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MDg4OTYyMw==",
    "user": {
      "login": "apasel422",
      "id": 8644784,
      "node_id": "MDQ6VXNlcjg2NDQ3ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8644784?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apasel422",
      "html_url": "https://github.com/apasel422",
      "followers_url": "https://api.github.com/users/apasel422/followers",
      "following_url": "https://api.github.com/users/apasel422/following{/other_user}",
      "gists_url": "https://api.github.com/users/apasel422/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apasel422/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apasel422/subscriptions",
      "organizations_url": "https://api.github.com/users/apasel422/orgs",
      "repos_url": "https://api.github.com/users/apasel422/repos",
      "events_url": "https://api.github.com/users/apasel422/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apasel422/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-08-18T23:42:36Z",
    "updated_at": "2016-08-18T23:42:36Z",
    "body": "The following prints `16` followed by `24` on stable, beta, and nightly: https://is.gd/rQdidj\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/240889623/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
