[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33287380",
    "html_url": "https://github.com/rust-lang/rust/issues/11791#issuecomment-33287380",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11791",
    "id": 33287380,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjg3Mzgw",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-25T12:01:06Z",
    "updated_at": "2014-01-25T12:01:06Z",
    "body": "This is working as designed: we used to allow arbitrary constant expressions in patterns, but this was removed in https://github.com/mozilla/rust/commit/db0693ac8d06202a289f451c223eb6f514819ffe .\n\nThere are (at least) two options:\n- just write `-1` instead of `-1 as u32` (note that `-1` is actually a valid `u32` literal, despite being \"negative\")\n- define a `static` like `static ERROR_VAL: u32 = -1;` and use `ERROR_VAL` as the pattern\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33287380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33289803",
    "html_url": "https://github.com/rust-lang/rust/issues/11791#issuecomment-33289803",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11791",
    "id": 33289803,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjg5ODAz",
    "user": {
      "login": "bnoordhuis",
      "id": 275871,
      "node_id": "MDQ6VXNlcjI3NTg3MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/275871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bnoordhuis",
      "html_url": "https://github.com/bnoordhuis",
      "followers_url": "https://api.github.com/users/bnoordhuis/followers",
      "following_url": "https://api.github.com/users/bnoordhuis/following{/other_user}",
      "gists_url": "https://api.github.com/users/bnoordhuis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bnoordhuis/subscriptions",
      "organizations_url": "https://api.github.com/users/bnoordhuis/orgs",
      "repos_url": "https://api.github.com/users/bnoordhuis/repos",
      "events_url": "https://api.github.com/users/bnoordhuis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bnoordhuis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-25T14:15:13Z",
    "updated_at": "2014-01-25T14:15:13Z",
    "body": "Thanks for the suggestion.  I tried something like that actually but it doesn't seem to work for all types.  Here's an example:\n\n```\nfn main() {\n    use std::libc::c_void;\n    static ICONV_ERROR: *c_void = -1 as *c_void;\n    match -1 as *c_void {\n        ICONV_ERROR => None,\n        val => Some(val),\n    };\n}\n```\n\n```\n$ cat t.rs\nt.rs:3:35: 3:48 error: Can't cast this type\nt.rs:3     static ICONV_ERROR: *c_void = -1 as *c_void;\n```\n\nIt's kind of strange because std::libc uses the same pattern.\n\nDo you know what the rationale for commit db0693a was?  It doesn't seem like an improvement from my point of view as a user.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33289803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33290070",
    "html_url": "https://github.com/rust-lang/rust/issues/11791#issuecomment-33290070",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11791",
    "id": 33290070,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjkwMDcw",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-25T14:28:20Z",
    "updated_at": "2014-01-25T14:28:20Z",
    "body": "Ah, looks like we don't support casts to raw pointers in const-expressions (yet). In this case you may be reduced to just using `if pointer == -1 as *c_void { None } else { Some(pointer) }`, unfortunately.\n\nI don't remember the exact context, and, as you can see, the commit message is rather terse (as is the pull request: https://github.com/mozilla/rust/pull/6417). However, I believe it was simplifying the language and making the pattern grammar more sensible (previously, it wasn't clear if `1 | 2` was matching 3 (i.e. bitwise or of 1 and 2) or matching 1 or 2; now it can only be the latter). I could be incorrect.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33290070/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33290861",
    "html_url": "https://github.com/rust-lang/rust/issues/11791#issuecomment-33290861",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11791",
    "id": 33290861,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjkwODYx",
    "user": {
      "login": "bnoordhuis",
      "id": 275871,
      "node_id": "MDQ6VXNlcjI3NTg3MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/275871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bnoordhuis",
      "html_url": "https://github.com/bnoordhuis",
      "followers_url": "https://api.github.com/users/bnoordhuis/followers",
      "following_url": "https://api.github.com/users/bnoordhuis/following{/other_user}",
      "gists_url": "https://api.github.com/users/bnoordhuis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bnoordhuis/subscriptions",
      "organizations_url": "https://api.github.com/users/bnoordhuis/orgs",
      "repos_url": "https://api.github.com/users/bnoordhuis/repos",
      "events_url": "https://api.github.com/users/bnoordhuis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bnoordhuis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-25T15:06:37Z",
    "updated_at": "2014-01-25T15:07:42Z",
    "body": "Thanks, that makes sense.  The asymmetry between match predicates and normal expressions is somewhat displeasing but I can see the point of removing ambiguity from the language.\n\n(EDIT: Though in the case of casts there is never any ambiguity, I think?  Or is there?)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33290861/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/569783748",
    "html_url": "https://github.com/rust-lang/rust/issues/11791#issuecomment-569783748",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11791",
    "id": 569783748,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2OTc4Mzc0OA==",
    "user": {
      "login": "Cxarli",
      "id": 10348289,
      "node_id": "MDQ6VXNlcjEwMzQ4Mjg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/10348289?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Cxarli",
      "html_url": "https://github.com/Cxarli",
      "followers_url": "https://api.github.com/users/Cxarli/followers",
      "following_url": "https://api.github.com/users/Cxarli/following{/other_user}",
      "gists_url": "https://api.github.com/users/Cxarli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Cxarli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Cxarli/subscriptions",
      "organizations_url": "https://api.github.com/users/Cxarli/orgs",
      "repos_url": "https://api.github.com/users/Cxarli/repos",
      "events_url": "https://api.github.com/users/Cxarli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Cxarli/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2019-12-30T20:14:09Z",
    "updated_at": "2019-12-30T20:14:09Z",
    "body": "Sorry for necroposting but this was the first issue I found when googling for \"Rust cast in match arm\".\r\n\r\nSomething like\r\n```rust\r\nconst TEN: u32 = 10;\r\n\r\nfn main() {\r\n    let x: u64 = 20;\r\n\r\n    match x {\r\n        TEN as u64 => { /* ... */ },\r\n        _          => { /* ... */ },\r\n    }\r\n}\r\n```\r\n\r\nstill doesn't compile on `rustc 1.40.0`. However, I've found the following workaround which I wanted to share with anyone from the future who comes here by googling like me:\r\n\r\n```rust\r\nconst TEN: u32 = 10;\r\n\r\nfn main() {\r\n    let x: u64 = 20;\r\n\r\n    match x {\r\n        a if a == TEN as u64 => { /* ... */ },\r\n        _                    => { /* ... */ },\r\n    }\r\n}\r\n```\r\n\r\nIf you move the cast to inside the `if` expression it's all fine.\r\n\r\n(of course here it'd be trivial to `match x as u32` or `const TEN: u64` but imagine that's unwanted for the sake of the example)",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/569783748/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1536707585",
    "html_url": "https://github.com/rust-lang/rust/issues/11791#issuecomment-1536707585",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11791",
    "id": 1536707585,
    "node_id": "IC_kwDOAAsO6M5bmEwB",
    "user": {
      "login": "blagowtf",
      "id": 127629827,
      "node_id": "U_kgDOB5t6Aw",
      "avatar_url": "https://avatars.githubusercontent.com/u/127629827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blagowtf",
      "html_url": "https://github.com/blagowtf",
      "followers_url": "https://api.github.com/users/blagowtf/followers",
      "following_url": "https://api.github.com/users/blagowtf/following{/other_user}",
      "gists_url": "https://api.github.com/users/blagowtf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blagowtf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blagowtf/subscriptions",
      "organizations_url": "https://api.github.com/users/blagowtf/orgs",
      "repos_url": "https://api.github.com/users/blagowtf/repos",
      "events_url": "https://api.github.com/users/blagowtf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blagowtf/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-05-05T19:53:04Z",
    "updated_at": "2023-05-05T19:53:20Z",
    "body": "Hello, just passing by to say i was bitten by this when trying to write code like the following:\r\n\r\n```rust\r\nenum XX {\r\n  A = 0,\r\n  B = 1,\r\n  C = 2,\r\n}\r\n```\r\n\r\n```rust\r\nlet x: u64 = ...;\r\nmatch x {\r\n   XX::A as u64 => XX::A,\r\n  XX::B as u64 => XX::B,\r\n   XX::C as u64 => XX::C,\r\n  _=> panic!()\r\n}\r\n```\r\n\r\nI can hardcode the values but it would have been great to use the cast values in the pattern.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1536707585/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1685261437",
    "html_url": "https://github.com/rust-lang/rust/issues/11791#issuecomment-1685261437",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11791",
    "id": 1685261437,
    "node_id": "IC_kwDOAAsO6M5kcwx9",
    "user": {
      "login": "twvd",
      "id": 11619441,
      "node_id": "MDQ6VXNlcjExNjE5NDQx",
      "avatar_url": "https://avatars.githubusercontent.com/u/11619441?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/twvd",
      "html_url": "https://github.com/twvd",
      "followers_url": "https://api.github.com/users/twvd/followers",
      "following_url": "https://api.github.com/users/twvd/following{/other_user}",
      "gists_url": "https://api.github.com/users/twvd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/twvd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/twvd/subscriptions",
      "organizations_url": "https://api.github.com/users/twvd/orgs",
      "repos_url": "https://api.github.com/users/twvd/repos",
      "events_url": "https://api.github.com/users/twvd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/twvd/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-08-20T11:35:57Z",
    "updated_at": "2023-08-20T11:35:57Z",
    "body": "I also just ran into this, when trying to match an `i32` against byte literals. Would be very nice if this could be reconsidered..",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1685261437/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
