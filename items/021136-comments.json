[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69929820",
    "html_url": "https://github.com/rust-lang/rust/issues/21136#issuecomment-69929820",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21136",
    "id": 69929820,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTI5ODIw",
    "user": {
      "login": "bombless",
      "id": 1296393,
      "node_id": "MDQ6VXNlcjEyOTYzOTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1296393?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bombless",
      "html_url": "https://github.com/bombless",
      "followers_url": "https://api.github.com/users/bombless/followers",
      "following_url": "https://api.github.com/users/bombless/following{/other_user}",
      "gists_url": "https://api.github.com/users/bombless/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bombless/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bombless/subscriptions",
      "organizations_url": "https://api.github.com/users/bombless/orgs",
      "repos_url": "https://api.github.com/users/bombless/repos",
      "events_url": "https://api.github.com/users/bombless/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bombless/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-14T15:11:19Z",
    "updated_at": "2015-01-14T15:13:48Z",
    "body": "``` Rust\nstruct GenericStruct<T: ?Sized>;\n\nimpl <T: ?Sized> GenericStruct<T> {\n    fn bar(&self, _: &mut T) {}\n}\n\ntrait Trait{}\n\nstruct FooBar;\nimpl Trait for FooBar{}\n\nfn main() {\n    let mut foobar = FooBar;\n    let foo = GenericStruct::<Trait>;\n    foo.bar(&mut foobar);   // First borrow passes ...\n    foo.bar(&mut foobar);   // Second borrow\n}\n```\n\nMaybe this one is a better idea.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69929820/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69955441",
    "html_url": "https://github.com/rust-lang/rust/issues/21136#issuecomment-69955441",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21136",
    "id": 69955441,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTU1NDQx",
    "user": {
      "login": "Nemikolh",
      "id": 4008156,
      "node_id": "MDQ6VXNlcjQwMDgxNTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4008156?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nemikolh",
      "html_url": "https://github.com/Nemikolh",
      "followers_url": "https://api.github.com/users/Nemikolh/followers",
      "following_url": "https://api.github.com/users/Nemikolh/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nemikolh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nemikolh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nemikolh/subscriptions",
      "organizations_url": "https://api.github.com/users/Nemikolh/orgs",
      "repos_url": "https://api.github.com/users/Nemikolh/repos",
      "events_url": "https://api.github.com/users/Nemikolh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nemikolh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-14T17:31:22Z",
    "updated_at": "2015-01-14T19:45:03Z",
    "body": "This one is a better idea and is a solution to my examples.\n\nHowever I do believe there's a problem here.\nI just don't think anymore that it is \"Lifetime\" related.\n\nWhy would this code compile fines (**Example A**):\n\n``` rust\nstruct GenericStruct<T>;\n\nimpl <T> GenericStruct<T> {\n    fn bar(&self, _: &mut T) {}\n}\n\nstruct FooBar;\n\nfn main() {\n    let mut foobar = FooBar;\n    let foo = GenericStruct;\n    foo.bar(&mut foobar);\n    foo.bar(&mut foobar);\n}\n```\n\nwhile this one does not (**Example B**):\n\n``` rust\nstruct GenericStruct<T>;\n\nimpl <T> GenericStruct<T> {\n    fn bar(&self, _: T) {}                   // <--- Only change\n}\n\nstruct FooBar;\n\nfn main() {\n    let mut foobar = FooBar;\n    let foo = GenericStruct;\n    foo.bar(&mut foobar);\n    foo.bar(&mut foobar);\n}\n```\n\nThe only difference is the **&mut** added to the type T to the function bar.\nIt seems to me that the borrow checker or a part of the parser is annotating the AST wrongly, resulting in this strange behavior.\n\nWhatever in the compiler does this, it does it very strangely. (or maybe there's a compiler test case explaining why this is the current desired? behavior)\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69955441/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69962377",
    "html_url": "https://github.com/rust-lang/rust/issues/21136#issuecomment-69962377",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21136",
    "id": 69962377,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTYyMzc3",
    "user": {
      "login": "bombless",
      "id": 1296393,
      "node_id": "MDQ6VXNlcjEyOTYzOTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1296393?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bombless",
      "html_url": "https://github.com/bombless",
      "followers_url": "https://api.github.com/users/bombless/followers",
      "following_url": "https://api.github.com/users/bombless/following{/other_user}",
      "gists_url": "https://api.github.com/users/bombless/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bombless/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bombless/subscriptions",
      "organizations_url": "https://api.github.com/users/bombless/orgs",
      "repos_url": "https://api.github.com/users/bombless/repos",
      "events_url": "https://api.github.com/users/bombless/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bombless/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-14T18:10:43Z",
    "updated_at": "2015-01-14T18:14:17Z",
    "body": "I don't know but with simple `T` you can hardly do any thing, that said, you can not even tell whether `T` is some kind of `&mut U`, `&U`, or if methods related to `GenericStruct` can copy `T` or something. And at the compiler's view the lack of bounds also makes it know little of GenericStruct.\nAnd the fact that `GenericStruct` is defined in the same crate doesn't help at all since the compiler only check the conditions on bounds, it won't look deep into that `GenericStruct` to see what exactly happended, otherwise it is a failure of the language design, because it either make Rust unsafe or can only tell if the generic method is safe by checking those who actually calles it, that will be as bad as C++ templates, in which case should be avoided.\n\nSo I don't really see the point here.\n\nMaybe give `T` some bounds and play with both `&mut` and `&`  types will better show your idea.\n\nThough I do believe that Rust prevents some codes which actually do no harm.\nAnd personally I think it can be considered as a way to adapt future extension of the language.\n\nBy the way have you tried `std::any::Any`? I have feelings that it may solve some of your problems. I don't know, but if it doesn't, just take it as another blue sky thinking of mine.\n\nAt last, maybe these words are just bullshit for a Rust expert. If this make anyone bad please let me know, I will delete this comment.\n\nAnd maybe this comment should not appear in this kind of issues, let me know as well in that case.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69962377/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69978191",
    "html_url": "https://github.com/rust-lang/rust/issues/21136#issuecomment-69978191",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21136",
    "id": 69978191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTc4MTkx",
    "user": {
      "login": "Nemikolh",
      "id": 4008156,
      "node_id": "MDQ6VXNlcjQwMDgxNTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4008156?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nemikolh",
      "html_url": "https://github.com/Nemikolh",
      "followers_url": "https://api.github.com/users/Nemikolh/followers",
      "following_url": "https://api.github.com/users/Nemikolh/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nemikolh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nemikolh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nemikolh/subscriptions",
      "organizations_url": "https://api.github.com/users/Nemikolh/orgs",
      "repos_url": "https://api.github.com/users/Nemikolh/repos",
      "events_url": "https://api.github.com/users/Nemikolh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nemikolh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-14T19:43:37Z",
    "updated_at": "2015-01-14T19:43:37Z",
    "body": "> I don't know but with simple T you can hardly do any thing\n\nThat's right but I kept the examples as simple as possible.\n\n> it won't look deep into that GenericStruct to see what exactly happended, otherwise it is a failure of the language design, because it either make Rust unsafe or can only tell if the generic method is safe by checking those who actually calls it, that will be as bad as C++ templates, in which case should be avoided.\n\nI do understand your point, but I don't understand how this relate to the _borrow_ part. \n\n> Maybe give T some bounds and play with both &mut and & types will better show your idea.\n\nBounds are not contributing to the borrow scope, aren't they ?\n\n## To be clear\n- The problem I'm talking about here is a _borrow lifetime_ problem not an _object lifetime_ problem.\n  \n  (you didn't mention that but I wanted to be sure everyone understand)\n- As far as I know, in the example B `foobar` should be borrow only for the duration of `bar`\n\n## Problem\n\nThe part I don't understand is why when the compiler see\n\n``` rust\nfoo.bar(&mut foobar);\n```\n\nIt does infers different borrow scopes for the example A and B I've given. \n\nIf you play with scope, you'll see in the example that \n- `foobar` is borrowed for the _object lifetime_ duration of `foo`.\n- `foo` is immutable, so can't possibly without writing unsafe code borrow `foobar` for more than the duration of the call to `bar`\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69978191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78033426",
    "html_url": "https://github.com/rust-lang/rust/issues/21136#issuecomment-78033426",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21136",
    "id": 78033426,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MDMzNDI2",
    "user": {
      "login": "Nemikolh",
      "id": 4008156,
      "node_id": "MDQ6VXNlcjQwMDgxNTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4008156?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nemikolh",
      "html_url": "https://github.com/Nemikolh",
      "followers_url": "https://api.github.com/users/Nemikolh/followers",
      "following_url": "https://api.github.com/users/Nemikolh/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nemikolh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nemikolh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nemikolh/subscriptions",
      "organizations_url": "https://api.github.com/users/Nemikolh/orgs",
      "repos_url": "https://api.github.com/users/Nemikolh/repos",
      "events_url": "https://api.github.com/users/Nemikolh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nemikolh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-10T11:04:57Z",
    "updated_at": "2015-03-10T11:04:57Z",
    "body": "Closing the issue as now we have to use explicitly `PhantomData` to use a type parameter on a GenericStruct (which is a good thing).\n\nThe updated examples would look like:\n\n``` rust\nuse std::marker::PhantomData;\n\nstruct GenericStruct<T> {\n    marker: PhantomData<T>\n}\n\nimpl <T> GenericStruct<T> {\n    // or fn bar(&self, _: &mut T) {}\n    fn bar(&self, _: T) {}                   // <--- Only change\n}\n\nstruct FooBar;\n\nfn main() {\n    let mut foobar = FooBar;\n    let foo = GenericStruct { marker: PhantomData };\n    foo.bar(&mut foobar);\n    foo.bar(&mut foobar);\n}\n```\n\nAnd both compiles.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78033426/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
