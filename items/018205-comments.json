[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59905552",
    "html_url": "https://github.com/rust-lang/rust/issues/18205#issuecomment-59905552",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18205",
    "id": 59905552,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTA1NTUy",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-21T10:05:53Z",
    "updated_at": "2014-10-21T10:05:53Z",
    "body": "The whole thing in one piece:\n\n``` rust\npub struct Referrable {\n    x: i64\n}\n\nimpl Referrable {\n    pub fn new() -> Referrable {\n        Referrable { x: 0i64 }\n    }\n\n    pub fn update(&mut self) {\n        self.x += 1;\n    }\n}\n\npub trait Segger<'a> {\n    fn new(&'a Referrable) -> Self;\n    fn update(& self);\n}\n\npub struct SegFault<'a> {\n    r: &'a Referrable\n}\n\nimpl<'a> Segger<'a> for SegFault<'a> {\n    fn new(r: &'a Referrable) -> SegFault<'a> {\n        SegFault { r: r }\n    }\n\n    fn update(& self) {\n        println!(\"{}\", self.r.x);\n    }\n}\n\n\npub struct SegObscure<'a> {\n    seg: Box<Segger<'a> + 'a>\n}\n\nimpl<'a> SegObscure<'a> {\n    pub fn new(r: & Referrable) -> SegObscure<'a> {\n        let seg: Box<SegFault> = box Segger::new(r);\n        SegObscure { seg: seg }\n    }\n\n    pub fn update(& self) {\n        self.seg.update();\n    }\n}\n\nfn main() {\n    let mut r = Referrable::new();\n    let s = SegObscure::new(& r);\n    for _ in range(0i, 10i) {\n        s.update();\n        r.update();\n    }\n    r = Referrable::new();\n    s.update();\n    // Still works!\n}\n```\n\nThanks for filing, these memory safety bugs are very important to catch, however, I think this may be a duplicate of another bug which I cannot find right now (iirc @zwarich was interacting with those other bugs). I believe the underlying problem here is the function `pub fn new(r: & Referrable) -> SegObscure<'a> {` is invalid, the boxing/returning that happens should be disallowed without the `r` having the `'a` lifetime too.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59905552/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59906336",
    "html_url": "https://github.com/rust-lang/rust/issues/18205#issuecomment-59906336",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18205",
    "id": 59906336,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTA2MzM2",
    "user": {
      "login": "ftxqxd",
      "id": 2055302,
      "node_id": "MDQ6VXNlcjIwNTUzMDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2055302?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ftxqxd",
      "html_url": "https://github.com/ftxqxd",
      "followers_url": "https://api.github.com/users/ftxqxd/followers",
      "following_url": "https://api.github.com/users/ftxqxd/following{/other_user}",
      "gists_url": "https://api.github.com/users/ftxqxd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ftxqxd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ftxqxd/subscriptions",
      "organizations_url": "https://api.github.com/users/ftxqxd/orgs",
      "repos_url": "https://api.github.com/users/ftxqxd/repos",
      "events_url": "https://api.github.com/users/ftxqxd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ftxqxd/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-21T10:13:46Z",
    "updated_at": "2014-10-21T10:13:46Z",
    "body": "FWIW, I\u2019ve reduced the issue a little more ([playpen](http://is.gd/5378za)):\n\n``` rust\ntrait Segger<'a> {\n    fn new(&'a int) -> Self;\n    fn get(&self) -> int;\n}\n\nstruct SegFault<'a> {\n    r: &'a int,\n}\n\nimpl<'a> Segger<'a> for SegFault<'a> {\n    fn new(r: &'a int) -> SegFault<'a> { SegFault { r: r } }\n    fn get(&self) -> int { *self.r }\n}\n\nstruct SegObscure<'a> {\n    seg: Box<Segger<'a> + 'a>,\n}\n\nimpl<'a> SegObscure<'a> {\n    fn new(r: &'a int) -> SegObscure<'a> {\n        //     ^\n        // Interestingly, this lifetime can be removed with no effect\n        let seg: Box<SegFault> = box Segger::new(r);\n        SegObscure { seg: seg }\n    }\n}\n\nfn main() {\n    let mut r = vec![42i];\n    let s = SegObscure::new(&r[0]);\n    println!(\"{}\", s.seg.get());\n\n    // We can do all sorts of evil things\n    r.pop();\n    drop(r);\n\n    // We can now (rather unreliably) overwrite what was in r[0] previously by\n    // allocating something somewhere in memory\n    let _ = box 36i;\n\n    // ...and we've changed the value magically\n    println!(\"{}\", s.seg.get());\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59906336/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59953960",
    "html_url": "https://github.com/rust-lang/rust/issues/18205#issuecomment-59953960",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18205",
    "id": 59953960,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTUzOTYw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-21T16:14:32Z",
    "updated_at": "2014-10-21T16:14:32Z",
    "body": "Nominating\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59953960/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59956968",
    "html_url": "https://github.com/rust-lang/rust/issues/18205#issuecomment-59956968",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18205",
    "id": 59956968,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTU2OTY4",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-21T16:34:27Z",
    "updated_at": "2014-10-21T17:07:17Z",
    "body": "As I posted on IRC, this is a variance problem - `SegObscure<'a>` is unsoundly bivariant:\n\n``` Rust\npub trait Segger {\n    fn val(& self) -> uint;\n}\n\nimpl<'a> Segger for &'a uint {\n    fn val(& self) -> uint{\n        **self\n    }\n}\n\npub struct SegObscure<'a> {\n    seg: Box<Segger + 'a>\n}\n\n// This function is sound\nfn create<'a>(r: &'a uint) -> SegObscure<'a> {\n        let seg: Box<&'a uint> = box r;\n        SegObscure { seg: seg }\n}\n\n// WRONG!\nfn create_dangling_pointer() -> SegObscure<'static> {\n    let r = 1u;\n    create(&r)\n}\n\nfn access(s: SegObscure) {\n  println!(\"{}\", s.seg.val());\n}\n\nfn main() {\n    let s = create_dangling_pointer();\n    access(s);\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59956968/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59959953",
    "html_url": "https://github.com/rust-lang/rust/issues/18205#issuecomment-59959953",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18205",
    "id": 59959953,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTU5OTUz",
    "user": {
      "login": "strega-nil",
      "id": 3479021,
      "node_id": "MDQ6VXNlcjM0NzkwMjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3479021?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/strega-nil",
      "html_url": "https://github.com/strega-nil",
      "followers_url": "https://api.github.com/users/strega-nil/followers",
      "following_url": "https://api.github.com/users/strega-nil/following{/other_user}",
      "gists_url": "https://api.github.com/users/strega-nil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/strega-nil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/strega-nil/subscriptions",
      "organizations_url": "https://api.github.com/users/strega-nil/orgs",
      "repos_url": "https://api.github.com/users/strega-nil/repos",
      "events_url": "https://api.github.com/users/strega-nil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/strega-nil/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-21T16:55:05Z",
    "updated_at": "2014-10-21T16:55:05Z",
    "body": "Thanks for cutting it down. I still am not a good Rust programmer, so I was just copying, as close as I could, the original, accidental, version.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59959953/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60310192",
    "html_url": "https://github.com/rust-lang/rust/issues/18205#issuecomment-60310192",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18205",
    "id": 60310192,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzEwMTky",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-23T21:13:00Z",
    "updated_at": "2014-10-23T21:13:00Z",
    "body": "cc @nikomatsakis \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60310192/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60310250",
    "html_url": "https://github.com/rust-lang/rust/issues/18205#issuecomment-60310250",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18205",
    "id": 60310250,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzEwMjUw",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-23T21:13:27Z",
    "updated_at": "2014-10-23T21:13:27Z",
    "body": "P-backcompat-lang, 1.0.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60310250/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60641317",
    "html_url": "https://github.com/rust-lang/rust/issues/18205#issuecomment-60641317",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18205",
    "id": 60641317,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjQxMzE3",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-27T18:12:23Z",
    "updated_at": "2014-10-27T18:12:23Z",
    "body": "seems to be dup of #18262 \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60641317/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60641753",
    "html_url": "https://github.com/rust-lang/rust/issues/18205#issuecomment-60641753",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18205",
    "id": 60641753,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjQxNzUz",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-27T18:14:54Z",
    "updated_at": "2014-10-27T18:14:54Z",
    "body": "I tested and this is indeed fixed by PR #18371. Too bad I didn't look into this bug first rather than #18262, since I see that other people already worked out the variance connection already. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60641753/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
