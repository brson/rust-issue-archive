[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66950796",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-66950796",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 66950796,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2OTUwNzk2",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-15T05:13:57Z",
    "updated_at": "2014-12-15T05:13:57Z",
    "body": "So I looked at this a little deeper. From the LLVM IR, it seems that when LLVM SROAs the `Result` struct, it ends up spliting the `memcopy`s and `memset`s for the moves. Unfortunately, it includes the padding elements in the struct, resulting in bloated code and unaligned loads and stores.\n\nThis would be fixed with some TBAA metadata emitted, so is essentially #6736.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66950796/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67052109",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-67052109",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 67052109,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MDUyMTA5",
    "user": {
      "login": "pythonesque",
      "id": 923144,
      "node_id": "MDQ6VXNlcjkyMzE0NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/923144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pythonesque",
      "html_url": "https://github.com/pythonesque",
      "followers_url": "https://api.github.com/users/pythonesque/followers",
      "following_url": "https://api.github.com/users/pythonesque/following{/other_user}",
      "gists_url": "https://api.github.com/users/pythonesque/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pythonesque/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pythonesque/subscriptions",
      "organizations_url": "https://api.github.com/users/pythonesque/orgs",
      "repos_url": "https://api.github.com/users/pythonesque/repos",
      "events_url": "https://api.github.com/users/pythonesque/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pythonesque/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-15T19:40:33Z",
    "updated_at": "2014-12-15T19:40:33Z",
    "body": "This is something I've noticed as well.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67052109/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67115012",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-67115012",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 67115012,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MTE1MDEy",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-16T05:38:44Z",
    "updated_at": "2014-12-16T05:38:44Z",
    "body": "Ok, so I did a basic implementation of `tbaa.struct` and it doesn't look like it fixes the issue.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67115012/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67724745",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-67724745",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 67724745,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzI0NzQ1",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-20T04:33:24Z",
    "updated_at": "2014-12-20T04:33:24Z",
    "body": "Ok, so I managed to fix up the codegen, hopefully it's still valid. It improved speed a little, but part of the issue is that IoError is 8 words, or 64 bytes on x86-64.\n\n``` rust\npub struct IoError {\n  pub kind: IoErrorKind // 2 words because a single variant has a uint associated with it\n  pub desc: &'static str // 2 words - the size of a string slice\n  pub detail: Option<String> // 4 words - One for the discriminant 3 for the String.\n}\n```\n\nIt's no surprise that the code using `IoError` is so much slower when the data is so much bigger.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67724745/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67725008",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-67725008",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 67725008,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzI1MDA4",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-20T04:46:42Z",
    "updated_at": "2014-12-20T04:46:42Z",
    "body": "I was talking with @mcpherrrin and @huonw, and they mentioned that we are shrinking the enum tag down to the smallest integer size, which would result in padding and the unsigned stores and loads you found. I wonder if disabling the shrinking would speed things up.  \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67725008/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67725179",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-67725179",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 67725179,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzI1MTc5",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-20T04:55:47Z",
    "updated_at": "2014-12-20T04:58:45Z",
    "body": "@erickt heh, that's exactly the change I made. Instead of just using the smallest integer type, I use the smallest to figure out what the appropriate alignment is, then use the alignment size to set the discriminant type. For some reason LLVM was struggling to figure out that the padding wasn't being written to or read from.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67725179/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67725356",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-67725356",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 67725356,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzI1MzU2",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-20T05:05:18Z",
    "updated_at": "2014-12-20T05:05:18Z",
    "body": "For the record, with @alexcrichton example the slower example gets twice as fast with the newer codegen. It's still much slower than the faster example, but that's hardly surprising.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67725356/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67757799",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-67757799",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 67757799,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzU3Nzk5",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-21T02:26:30Z",
    "updated_at": "2014-12-21T02:26:30Z",
    "body": "Even with @Aatch's patches, we're just doubling the IoError case from 40MB/s to 80MB/s. The destructor we're getting from the `description: Option<Str>` is really hurting us. Removing that gets us to 287MB/s. We can convert `desc: &'static str` into a function, which gets rid of another word and to 339MB/s. Finally, if we remove `IoErrorKind::ShortWrite(uint)` as suggested in the [io reform rfc](https://github.com/rust-lang/rfcs/pull/517#discussion_r21801094), we get `IoError` down into a word. This gets us to 731MB/s. Finally, if implement enum compression, then we'd be able to reduce a type like `Result<(), IoError>` down into a single word, which would get us to the 1200MB/s number.\n\n``` rust\n#[deriving(Show, PartialEq, Eq)]\nenum MyError3Kind {\n    EndOfFile,\n    Error,\n    _Error1, //(uint),\n}\n\n#[deriving(Show, PartialEq, Eq)]\nstruct MyError3 {\n    kind: MyError3Kind,\n    //desc: &'static str,\n    //description: Option<String>,\n}\n\nimpl Error for MyError3 {\n    fn is_eof(&self) -> bool {\n        self.kind == MyError3Kind::EndOfFile\n    }\n}\n\n#[bench]\nfn bench_foo11_enum_smaller_error(b: &mut test::Bencher) {\n    let bytes = generate_bytes();\n    b.bytes = bytes.len() as u64;\n\n    b.iter(|| {\n        let mut rdr = bytes.as_slice();\n        let iter = Foo11::new(|buf| -> Result<(), MyError3> {\n            match rdr.push(BUFFER_SIZE, buf) {\n                Ok(_) => Ok(()),\n                Err(io::IoError { kind: io::EndOfFile, .. }) => Ok(()),\n                Err(_) => {\n                    Err(MyError3 {\n                        kind: MyError3Kind::Error,\n                        //desc: \"\",\n                        //description: Some(\"foo\".to_string()),\n                    })\n                }\n            }\n        });\n\n        for (idx, item) in iter.enumerate() {\n            assert_eq!(idx as u8, item.unwrap());\n        }\n    })\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67757799/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67758023",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-67758023",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 67758023,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzU4MDIz",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-21T02:39:16Z",
    "updated_at": "2014-12-21T02:39:16Z",
    "body": "CC @mitsuhiko\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67758023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68145035",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-68145035",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 68145035,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTQ1MDM1",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-26T15:28:39Z",
    "updated_at": "2014-12-26T15:28:39Z",
    "body": "Giant return types simply don't exist in C libraries, even though C structs are first-class. The canonical approach is to pass an extra pointer:\n\n``` rust\nfn foo(..., _ret: &mut IoError<T>);\n\nfn bar(..., _ret: &mut IoError<T>) {\n    foo(..., _ret);\n    if !_ret.is_ok() { return; } // no need to copy\n\n    // ...\n\n    // write our own value when we're done\n    *_ret = ...;\n}\n\nfn baz() {\n     let mut _ret: IoError<T> = uninitialized();\n     bar(..., &mut _ret);\n}\n```\n\nLLVM doesn't have the freedom to change cross-library signatures, but we can probably do this in the Rust calling convention without API breakage.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68145035/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68157827",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-68157827",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 68157827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTU3ODI3",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-26T20:58:10Z",
    "updated_at": "2014-12-26T20:58:10Z",
    "body": "Rust implements large return types via an out pointer similar to the manual version in C.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68157827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68158939",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-68158939",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 68158939,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTU4OTM5",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-26T21:29:08Z",
    "updated_at": "2014-12-26T21:29:08Z",
    "body": "@huonw: That's already how the platform ABIs handle large return values anyway.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68158939/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68158962",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-68158962",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 68158962,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTU4OTYy",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-26T21:29:40Z",
    "updated_at": "2014-12-26T21:29:40Z",
    "body": "The x86_64 ABI uses a higher threshold than Rust's choice of 1 word though.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68158962/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/424067927",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-424067927",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 424067927,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNDA2NzkyNw==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-09-24T18:00:08Z",
    "updated_at": "2018-09-24T18:00:08Z",
    "body": "Triage: updated code:\r\n\r\n```rust\r\n#![feature(test)]\r\nextern crate test;\r\n\r\nuse std::iter::repeat;\r\n\r\nconst N: usize = 100000;\r\n\r\n#[derive(Clone)]\r\nstruct Foo;\r\n#[derive(Clone)]\r\nstruct Bar {\r\n    name: &'static str,\r\n    desc: Option<String>,\r\n    other: Option<String>,\r\n}\r\n\r\n#[bench]\r\nfn b1(b: &mut test::Bencher) {\r\n    b.iter(|| {\r\n        let r: Result<u8, Foo> = Ok(1u8);\r\n        repeat(r).take(N).map(|x| test::black_box(x)).count()\r\n    });\r\n}\r\n\r\n#[bench]\r\nfn b2(b: &mut test::Bencher) {\r\n    b.iter(|| {\r\n        let r: Result<u8, Bar> = Ok(1u8);\r\n        repeat(r).take(N).map(|x| test::black_box(x)).count()\r\n    });\r\n}\r\n```\r\n\r\nupdated benchmarks:\r\n\r\n```text\r\nrunning 2 tests\r\ntest b1 ... bench:      25,617 ns/iter (+/- 2,836)\r\ntest b2 ... bench:   1,093,834 ns/iter (+/- 50,578)\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/424067927/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/809582277",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-809582277",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 809582277,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwOTU4MjI3Nw==",
    "user": {
      "login": "klensy",
      "id": 1782831,
      "node_id": "MDQ6VXNlcjE3ODI4MzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1782831?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klensy",
      "html_url": "https://github.com/klensy",
      "followers_url": "https://api.github.com/users/klensy/followers",
      "following_url": "https://api.github.com/users/klensy/following{/other_user}",
      "gists_url": "https://api.github.com/users/klensy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klensy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klensy/subscriptions",
      "organizations_url": "https://api.github.com/users/klensy/orgs",
      "repos_url": "https://api.github.com/users/klensy/repos",
      "events_url": "https://api.github.com/users/klensy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klensy/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-03-29T17:50:59Z",
    "updated_at": "2021-03-29T17:50:59Z",
    "body": "That benchmark on `rustc 1.53.0-nightly (07e0e2ec2 2021-03-24)` for me returns:\r\n```\r\nrunning 2 tests\r\ntest b1 ... bench:      25,082 ns/iter (+/- 26)\r\ntest b2 ... bench:     501,483 ns/iter (+/- 1,637)\r\n```\r\n\r\nIf `b2` bench will be changed to \r\n```\r\n#[bench]\r\nfn b2(b: &mut test::Bencher) {\r\n    b.iter(|| {\r\n        let r: Result<u8, Bar> = Ok(1u8);\r\n        iter::repeat_with(||r.as_ref()).take(N).map(|x| test::black_box(x)).count()\r\n    });\r\n}\r\n```\r\n\r\nresults will be\r\n```\r\nrunning 2 tests\r\ntest b1 ... bench:      25,081 ns/iter (+/- 44)\r\ntest b2 ... bench:      50,160 ns/iter (+/- 155)\r\n```\r\nbut this can be not related to actual problem.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/809582277/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1776104497",
    "html_url": "https://github.com/rust-lang/rust/issues/19864#issuecomment-1776104497",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19864",
    "id": 1776104497,
    "node_id": "IC_kwDOAAsO6M5p3TQx",
    "user": {
      "login": "istankovic",
      "id": 1312091,
      "node_id": "MDQ6VXNlcjEzMTIwOTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1312091?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/istankovic",
      "html_url": "https://github.com/istankovic",
      "followers_url": "https://api.github.com/users/istankovic/followers",
      "following_url": "https://api.github.com/users/istankovic/following{/other_user}",
      "gists_url": "https://api.github.com/users/istankovic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/istankovic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/istankovic/subscriptions",
      "organizations_url": "https://api.github.com/users/istankovic/orgs",
      "repos_url": "https://api.github.com/users/istankovic/repos",
      "events_url": "https://api.github.com/users/istankovic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/istankovic/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-10-23T22:13:20Z",
    "updated_at": "2023-10-23T22:13:20Z",
    "body": "With rustc 1.75.0-nightly (249624b50 2023-10-20):\r\n```\r\nrunning 2 tests                                   \r\ntest b1 ... bench:      21,169 ns/iter (+/- 377)  \r\ntest b2 ... bench:     108,729 ns/iter (+/- 1,838)\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1776104497/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
