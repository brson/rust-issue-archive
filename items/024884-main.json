{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/24884",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/24884/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/24884/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/24884/events",
  "html_url": "https://github.com/rust-lang/rust/pull/24884",
  "id": 71469346,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MzQyMzE0NDI=",
  "number": 24884,
  "title": "Extend the diagnostics plugin with uniqueness tests and JSON output.",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "nrc",
    "id": 762626,
    "node_id": "MDQ6VXNlcjc2MjYyNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nrc",
    "html_url": "https://github.com/nrc",
    "followers_url": "https://api.github.com/users/nrc/followers",
    "following_url": "https://api.github.com/users/nrc/following{/other_user}",
    "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
    "organizations_url": "https://api.github.com/users/nrc/orgs",
    "repos_url": "https://api.github.com/users/nrc/repos",
    "events_url": "https://api.github.com/users/nrc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nrc/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "nrc",
      "id": 762626,
      "node_id": "MDQ6VXNlcjc2MjYyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nrc",
      "html_url": "https://github.com/nrc",
      "followers_url": "https://api.github.com/users/nrc/followers",
      "following_url": "https://api.github.com/users/nrc/following{/other_user}",
      "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
      "organizations_url": "https://api.github.com/users/nrc/orgs",
      "repos_url": "https://api.github.com/users/nrc/repos",
      "events_url": "https://api.github.com/users/nrc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nrc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2015-04-28T03:43:25Z",
  "updated_at": "2015-04-30T04:46:47Z",
  "closed_at": "2015-04-30T04:44:52Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/24884",
    "html_url": "https://github.com/rust-lang/rust/pull/24884",
    "diff_url": "https://github.com/rust-lang/rust/pull/24884.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/24884.patch",
    "merged_at": "2015-04-30T04:44:52Z"
  },
  "body": "I've been working on improving the diagnostic registration system so that it can:\n- Check uniqueness of error codes _across the whole compiler_. The current method using `errorck.py` is prone to failure as it relies on simple text search - I found that it breaks when referencing an error's ident within a string (e.g. `\"See also E0303\"`).\n- Provide JSON output of error metadata, to eventually facilitate HTML output, as well as tracking of which errors need descriptions. The current schema is:\n\n```\n<error code>: {\n    \"description\": <long description>,\n    \"use_site\": {\n        \"filename\": <filename where error is used>,\n        \"line\": <line in file where error is used>\n    }\n}\n```\n\n[Here's](https://gist.github.com/michaelsproul/3246846ff1bea71bd049) a pretty-printed sample dump for `librustc`.\n\nOne thing to note is that I had to move the diagnostics arrays out of the diagnostics modules. I really wanted to be able to capture error usage information, which only becomes available as a crate is compiled. Hence all invocations of `__build_diagnostics_array!` have been moved to the ends of their respective `lib.rs` files. I tried to avoid moving the array by making a plugin that expands to nothing but couldn't invoke it in item position and gave up on hackily generating a fake item. I also briefly considered using a lint, but it seemed like it would impossible to get access to the data stored in the thread-local storage.\n\nThe next step will be to generate a web page that lists each error with its rendered description and use site. Simple mapping and filtering of the metadata files also allows us to work out which error numbers are absent, which errors are unused and which need descriptions.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/24884/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/24884/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
