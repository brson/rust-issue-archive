[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/159617598",
    "html_url": "https://github.com/rust-lang/rust/issues/30041#issuecomment-159617598",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30041",
    "id": 159617598,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1OTYxNzU5OA==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-25T14:10:40Z",
    "updated_at": "2015-11-25T14:10:52Z",
    "body": "Looks like an LLVM problem. Does clang generate better code?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/159617598/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/294303825",
    "html_url": "https://github.com/rust-lang/rust/issues/30041#issuecomment-294303825",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30041",
    "id": 294303825,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NDMwMzgyNQ==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-04-15T16:33:19Z",
    "updated_at": "2017-04-15T16:33:19Z",
    "body": "Triage: this is still an issue. From what I can tell, only `bad1` and `bad2` are still a problem in Rust, with `bad3` being solved. I may have incorrectly transformed the code above to C (C++?), though, so no guarantees...\r\n\r\nInterestingly, bad3 with `rustc -O` compiles to a `retq`, but clang 4.0.0 doesn't optimize it away.\r\n\r\nHowever, for bad1 and bad2 the assembly looks the same:\r\n\r\n```c\r\nvoid bad1(bool *x) {\r\n    if (*x) {\r\n        *x = *x;\r\n    }\r\n}\r\n\r\nvoid bad2(bool *x) {\r\n    if (*x) {\r\n        *x = false;\r\n        *x = true;\r\n    }\r\n}\r\n\r\nvoid bad3(bool *x) {\r\n    if (!*x) {\r\n        *x = *x;\r\n    }\r\n}\r\n```\r\n\r\ncompiles to:\r\n\r\n```asm\r\nbad1(bool*):                              # @bad1(bool*)\r\n        cmpb    $0, (%rdi)\r\n        je      .LBB0_2\r\n        movb    $1, (%rdi)\r\n.LBB0_2:\r\n        retq\r\n\r\nbad2(bool*):                              # @bad2(bool*)\r\n        cmpb    $0, (%rdi)\r\n        je      .LBB1_2\r\n        movb    $1, (%rdi)\r\n.LBB1_2:\r\n        retq\r\n\r\nbad3(bool*):                              # @bad3(bool*)\r\n        cmpb    $0, (%rdi)\r\n        jne     .LBB2_2\r\n        movb    $0, (%rdi)\r\n.LBB2_2:\r\n        retq\r\n```\r\n\r\nwhile Rust compiles the original code to:\r\n\r\n```asm\r\ngood1:\r\n    retq\r\n\r\ngood2:\r\n    retq\r\n\r\ngood3:\r\n    retq\r\n\r\ngood4:\r\n    retq\r\n\r\nbad1:\r\n    cmpb   $0x0,(%rdi)\r\n    je     8 <bad1+0x8>\r\n    movb   $0x1,(%rdi)\r\n    retq\r\n\r\nbad2:\r\n    cmpb   $0x0,(%rdi)\r\n    je     8 <bad2+0x8>\r\n    movb   $0x1,(%rdi)\r\n    retq\r\n\r\nbad3:\r\n    retq\r\n```\r\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/294303825/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377944268",
    "html_url": "https://github.com/rust-lang/rust/issues/30041#issuecomment-377944268",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30041",
    "id": 377944268,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Nzk0NDI2OA==",
    "user": {
      "login": "nox",
      "id": 123095,
      "node_id": "MDQ6VXNlcjEyMzA5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/123095?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nox",
      "html_url": "https://github.com/nox",
      "followers_url": "https://api.github.com/users/nox/followers",
      "following_url": "https://api.github.com/users/nox/following{/other_user}",
      "gists_url": "https://api.github.com/users/nox/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nox/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nox/subscriptions",
      "organizations_url": "https://api.github.com/users/nox/orgs",
      "repos_url": "https://api.github.com/users/nox/repos",
      "events_url": "https://api.github.com/users/nox/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nox/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-04-02T14:41:24Z",
    "updated_at": "2018-04-02T14:41:24Z",
    "body": "Seems like this regressed even more: https://godbolt.org/g/n3cxcD\r\n\r\nAm I misinterpreting godbolt's output? Why are none of the `good*` functions just `retq` anymore?\r\n\r\nCc @rust-lang/wg-codegen ",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377944268/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/378186340",
    "html_url": "https://github.com/rust-lang/rust/issues/30041#issuecomment-378186340",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30041",
    "id": 378186340,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODE4NjM0MA==",
    "user": {
      "login": "nagisa",
      "id": 679122,
      "node_id": "MDQ6VXNlcjY3OTEyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nagisa",
      "html_url": "https://github.com/nagisa",
      "followers_url": "https://api.github.com/users/nagisa/followers",
      "following_url": "https://api.github.com/users/nagisa/following{/other_user}",
      "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions",
      "organizations_url": "https://api.github.com/users/nagisa/orgs",
      "repos_url": "https://api.github.com/users/nagisa/repos",
      "events_url": "https://api.github.com/users/nagisa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nagisa/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-04-03T09:23:50Z",
    "updated_at": "2018-04-03T09:23:50Z",
    "body": "Godbolt requests debug info which in turn disables frame pointer\nelimination. The push mov pop instructions are the frame pointer\nbookkeeping.\n\nOn Mon, Apr 2, 2018, 17:41 Anthony Ramine <notifications@github.com> wrote:\n\n> Seems like this regressed even more: https://godbolt.org/g/n3cxcD\n>\n> Am I misinterpreting godbolt's output? Why are none of the good*\n> functions just retq anymore?\n>\n> Cc @rust-lang/wg-codegen\n> <https://github.com/orgs/rust-lang/teams/wg-codegen>\n>\n> \u2014\n> You are receiving this because you are on a team that was mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/rust-lang/rust/issues/30041#issuecomment-377944268>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AApc0ue4XYfP0l4Ae1JF-ESAERAUOZM4ks5tkji1gaJpZM4GoxxM>\n> .\n>\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/378186340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/378191113",
    "html_url": "https://github.com/rust-lang/rust/issues/30041#issuecomment-378191113",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30041",
    "id": 378191113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODE5MTExMw==",
    "user": {
      "login": "nox",
      "id": 123095,
      "node_id": "MDQ6VXNlcjEyMzA5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/123095?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nox",
      "html_url": "https://github.com/nox",
      "followers_url": "https://api.github.com/users/nox/followers",
      "following_url": "https://api.github.com/users/nox/following{/other_user}",
      "gists_url": "https://api.github.com/users/nox/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nox/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nox/subscriptions",
      "organizations_url": "https://api.github.com/users/nox/orgs",
      "repos_url": "https://api.github.com/users/nox/repos",
      "events_url": "https://api.github.com/users/nox/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nox/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-04-03T09:40:21Z",
    "updated_at": "2018-04-03T09:40:21Z",
    "body": "@nagisa Thanks! Would have never guessed that myself. What is the flag to omit debug info on Godbolt?",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/378191113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/378197915",
    "html_url": "https://github.com/rust-lang/rust/issues/30041#issuecomment-378197915",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30041",
    "id": 378197915,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODE5NzkxNQ==",
    "user": {
      "login": "nagisa",
      "id": 679122,
      "node_id": "MDQ6VXNlcjY3OTEyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nagisa",
      "html_url": "https://github.com/nagisa",
      "followers_url": "https://api.github.com/users/nagisa/followers",
      "following_url": "https://api.github.com/users/nagisa/following{/other_user}",
      "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions",
      "organizations_url": "https://api.github.com/users/nagisa/orgs",
      "repos_url": "https://api.github.com/users/nagisa/repos",
      "events_url": "https://api.github.com/users/nagisa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nagisa/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-04-03T10:05:31Z",
    "updated_at": "2018-04-03T10:05:31Z",
    "body": "You cannot disable debug-info generation for godbolt because that\u2019s what it relies on to provide its basic functionality.\r\n\r\nThat being said [this](https://github.com/rust-lang/rust/pull/48786) should help with the frame pointer stuff once it lands.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/378197915/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1179933664",
    "html_url": "https://github.com/rust-lang/rust/issues/30041#issuecomment-1179933664",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30041",
    "id": 1179933664,
    "node_id": "IC_kwDOAAsO6M5GVFvg",
    "user": {
      "login": "workingjubilee",
      "id": 46493976,
      "node_id": "MDQ6VXNlcjQ2NDkzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/workingjubilee",
      "html_url": "https://github.com/workingjubilee",
      "followers_url": "https://api.github.com/users/workingjubilee/followers",
      "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}",
      "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions",
      "organizations_url": "https://api.github.com/users/workingjubilee/orgs",
      "repos_url": "https://api.github.com/users/workingjubilee/repos",
      "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/workingjubilee/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-07-11T03:44:27Z",
    "updated_at": "2022-07-11T03:44:27Z",
    "body": "A Godbolt with more comparative data: https://rust.godbolt.org/z/cs69hPnT6\r\nTonight, the \"good\" functions no longer have problems.\r\nbad3 is gone.\r\nbad1 and bad2 now merge as a function because they generate the same code.\r\n\r\n```asm\r\nbad1:\r\n        cmp     byte ptr [rdi], 0\r\n        je      .LBB1_2\r\n        mov     byte ptr [rdi], 1\r\n.LBB1_2:\r\n        ret\r\n```\r\n\r\nThis seems to be true of **both** rustc and clang.\r\n\r\nThe unoptimized LLVMIR currently looks like\r\n```llvm\r\ndefine void @bad1(i8* align 1 %x) unnamed_addr #0 {\r\n  %0 = load i8, i8* %x, align 1, !range !2, !noundef !3\r\n  %_2 = trunc i8 %0 to i1\r\n  br i1 %_2, label %bb1, label %bb2\r\n\r\nbb2:                                              ; preds = %bb1, %start\r\n  ret void\r\n\r\nbb1:                                              ; preds = %start\r\n  %1 = load i8, i8* %x, align 1, !range !2, !noundef !3\r\n  %_3 = trunc i8 %1 to i1\r\n  %2 = zext i1 %_3 to i8\r\n  store i8 %2, i8* %x, align 1\r\n  br label %bb2\r\n}\r\n\r\ndefine void @bad2(i8* align 1 %x) unnamed_addr #0 {\r\n  %0 = load i8, i8* %x, align 1, !range !2, !noundef !3\r\n  %_2 = trunc i8 %0 to i1\r\n  br i1 %_2, label %bb1, label %bb2\r\n\r\nbb2:                                              ; preds = %bb1, %start\r\n  ret void\r\n\r\nbb1:                                              ; preds = %start\r\n  store i8 0, i8* %x, align 1\r\n  store i8 1, i8* %x, align 1\r\n  br label %bb2\r\n}\r\n\r\ndefine void @bad3(i8* align 1 %x) unnamed_addr #0 {\r\n  %0 = load i8, i8* %x, align 1, !range !2, !noundef !3\r\n  %_3 = trunc i8 %0 to i1\r\n  %_2 = xor i1 %_3, true\r\n  br i1 %_2, label %bb1, label %bb2\r\n\r\nbb2:                                              ; preds = %bb1, %start\r\n  ret void\r\n\r\nbb1:                                              ; preds = %start\r\n  %1 = load i8, i8* %x, align 1, !range !2, !noundef !3\r\n  %_4 = trunc i8 %1 to i1\r\n  %2 = zext i1 %_4 to i8\r\n  store i8 %2, i8* %x, align 1\r\n  br label %bb2\r\n}\r\n\r\nattributes #0 = { nonlazybind uwtable \"probe-stack\"=\"__rust_probestack\" \"target-cpu\"=\"x86-64\" }\r\n```\r\n\r\nIt might be useful to figure out why bad3 and most of the \"good\" ones can get away with generating even heavier functions and yet be optimized completely away. good1 seems to just be tiny enough that of course it's trivial to optimize.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1179933664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
