[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21291017",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-21291017",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 21291017,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxMjkxMDE3",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-20T09:45:21Z",
    "updated_at": "2013-07-20T09:45:21Z",
    "body": "There are several side-issues with making the AST map work \"properly\". For one, since it contains `&` it would have lifetime, which means that every piece of code that uses it needs lifetimes and that causes more lifetime requirements and so on and so forth.\n\nMuch of the current code isn't designed to deal with these kinds of structures, happily copying around `@`-pointers from the map and using `@fn` closures that can't have borrowed pointers in them. Furthermore, much of the code only needs minor use of the map, but the rest of the code pays for it's design decisions.\n\nWhile unpalatable, a map based on unsafe pointers may help us, at least as a bridging solution until the rest of the code is brought up to a place where a safe-code map can be used instead.\n\nMy idea is to integrate the map into a wrapper for the AST, to limit the potential for, uh, bad things to happen. A simple struct like this:\n\n``` rust\nstruct ASTData {\n    crate: ast::crate,\n    priv map: ast_map::Map\n}\n```\n\nWith methods like this:\n\n``` rust\nfn find<'a>(&'a self, node: node_id) -> Option<&'a node>;\n```\n\nThe only place (as far as I am aware) the AST undergoes structural changes is during folding. Thus, folding can maintain the AST map. There is very little code that absolutely requires `@`, instead it is used as the \"easy\" option.\n\nThe current AST map is `HashMap<node_id, node>`, where `node` is an enum variant for the various indexed nodes. The variants mostly use `@`, but they could use `*` instead. `ASTData` has `map` as a private field to ensure no direct access, instead most access should be done via a safe API that returns a region pointer that causes `ASTData` to be frozen for it's length. An unsafe API can also be written to deal with cases where such freezing is unwanted, but the memory usage from copying is unacceptable.\n\nThe design above should be fairly safe as the pointers held in the map are \"internal\" pointers to the map's owner, meaning it's unlikely end up with dangling pointers.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21291017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21291989",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-21291989",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 21291989,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxMjkxOTg5",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-20T11:16:25Z",
    "updated_at": "2013-07-20T11:16:25Z",
    "body": "I actually don't know that `~` trees are the way to model the AST. I was thinking that using an arena might be the right approach (it's certainly the traditional approach). To make that work, though, we need to finish up the work on lifetime syntax.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21291989/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21292610",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-21292610",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 21292610,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxMjkyNjEw",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-20T12:08:44Z",
    "updated_at": "2013-07-20T12:08:44Z",
    "body": "@nikomatsakis as long as it can be semantically owned (so folding is memory efficient, it can be sent across task boundaries, etc) then I don't really care how it's implemented.\n\nFinishing the lifetime syntax would be very nice too :smile: \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21292610/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24149822",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-24149822",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 24149822,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTQ5ODIy",
    "user": {
      "login": "dobkeratops",
      "id": 1120754,
      "node_id": "MDQ6VXNlcjExMjA3NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1120754?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dobkeratops",
      "html_url": "https://github.com/dobkeratops",
      "followers_url": "https://api.github.com/users/dobkeratops/followers",
      "following_url": "https://api.github.com/users/dobkeratops/following{/other_user}",
      "gists_url": "https://api.github.com/users/dobkeratops/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dobkeratops/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dobkeratops/subscriptions",
      "organizations_url": "https://api.github.com/users/dobkeratops/orgs",
      "repos_url": "https://api.github.com/users/dobkeratops/repos",
      "events_url": "https://api.github.com/users/dobkeratops/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dobkeratops/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-10T10:24:16Z",
    "updated_at": "2013-09-10T10:28:32Z",
    "body": "Probably not enough code that uses it for it to be an issue yet ... but would you forsee a need for seperate compiler & tools AST structure/interfaces - similar to how clang provides a stable C interface and  a more fully featured , but more rapidly changing internal representation.\n\nr.e. tools, are there any ideas on how incremental build might go - with C++ although the header situation is pretty dire, you can at least translate individual sources  - wheras at present you must compile an entire crate.  Perhaps a tools oriented AST could be more suited to incremental builds? (for ide support).\n\n(perhaps there are other issues more suitable for this question)\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24149822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28045388",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-28045388",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 28045388,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MDQ1Mzg4",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-08T08:18:41Z",
    "updated_at": "2013-11-08T08:18:41Z",
    "body": "@nikomatsakis given that said work seems to be being finished, is it time to reapproach this? Probably not a 1.0 priority, as it certainly has no bearing on the language itself, but it seems it will be necessary to get rustc memory usage reasonable.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28045388/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28053689",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-28053689",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 28053689,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MDUzNjg5",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-08T10:30:42Z",
    "updated_at": "2013-11-08T10:30:42Z",
    "body": "Well, PR #10153 has not yet landed (still under review) but yes it might be reasonable to experiment once it does.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28053689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28055011",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-28055011",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 28055011,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MDU1MDEx",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-08T10:57:04Z",
    "updated_at": "2013-11-08T10:57:04Z",
    "body": "On Fri, Nov 08, 2013 at 12:18:45AM -0800, Corey Richardson wrote:\n\n> it seems it will be necessary to get rustc memory usage reasonable.\n\n...though I'm not sure I agree with this particular statement. It\nwould reduce the usage in box headers, but then improving the GC\nwould do so as well.\n\nNonetheless, I don't think the AST is correctly structured today, just\nfrom first principles. I can imagine two alternative designs, both of\nwhich will save memory and make it obvious how to trash the AST in a\ndeterministic fashion etc:\n1. Store all AST nodes in arrays, divided by type. Something like:\n   \n   ```\n   struct Ast {\n       items: ~[Item],\n       exprs: ~[Expr],\n       ...\n   }\n   \n   ...\n   \n   enum Expr {\n        ...\n        ExprBinop(Binop, ExprId, ExprId),\n        ...\n   }\n   \n   struct ItemId { index: u32 }\n   struct ExprId { index: u32 }\n   ```\n   \n   Note that `@ast::Expr` pointers are replaced with `ExprId`, etc.\n   This requires some refactoring to Segregate node ids into distinct\n   categories. In some cases we pun within a single table, mixing node\n   ids for items and exprs.  We'll have to stop doing that.\n   \n   For those code paths that take a single node id, we could create\n   an enum like:\n   \n   ```\n   enum NodeId {\n        ItemId(ItemId),\n        ExprId(ExprId),\n        ...\n   }\n   ```\n   \n   which would allow us to keep a single code path.\n   \n   Pro: Maximally memory layout; pointers can be 32 bit.\n   Pro: Subsumes the current AST Map, which can just go away\n       entirely, saving even more memory.\n   Pro: Trivial to trash the AST Node after folding.\n   Pro: We can use TLS to thread the AST array around with minimal\n       effort; though we will have to be careful in trans\n       when growing the array.\n   Pro: Refactoring away from NodeId into different categories\n       will improve readability and correctness, imo.\n   Con: Annoying to match nested nodes.\n   Con: The potential for \"dangling pointers\" in the form of outdated \n       indices exists when folding.\n2. Use an arena to allocate AST nodes. Make ASTNodes have the lifetime\n   of this arena. Replace any `@ast::Node` with `Node<'ast>`, defined\n   as follows:\n   \n      type Node<'ast> = &'a Node<'ast>;\n   \n   Pro: Relatively efficient memory layout.\n   Pro: Easy to trash, no need for dangling pointers.\n   Pro: Correctness of AST fold becomes _type checked_, because it\n       will have to have two lifetime parameters, `'in` and `'out`,\n       and it will be producing `Node<'out>`.\n   Con: Must thread lifetimes around, lots of manual editing.\n   Con: We still need the AST Map. That makes me very sad.\n\nLooking forward, I would (maybe) like to eventually convert from one\nmonolithic AST into an AST per item. The same would hold for all the\nside tables in trans. The idea is to enable us to parallelize by\nshipping items to different tasks. Either (1) or (2) could be adapted\nto this approach, though using an array is somewhat easier but less\nsafe. Easier because indices can be sent between tasks. Less safe\nbecause the type of an `ExprId` would not identify the item it belongs\nto, and so we could confusingly use an `ExprId` from one fn in the\ncontext of another. To convert approach (2) we'd have to use something\nlike the [Message abstraction](https://mail.mozilla.org/pipermail/rust-dev/2013-November/006304.html) I outlined on the mailing list.\n\nThat said, what I'd REALLY like to do is to desugar from the AST into\na CFG after type checking, and do most of our processing on the CFG.\nBut all of this discussion is still relevant. As a babystep in that\ndirection I opened #6298 and I even have a lot of work on that lying\naround on a branch, waiting for me to finish up with #2202 before it\ncan be merged. Got to get on that!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28055011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29523625",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-29523625",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 29523625,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NTIzNjI1",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-29T15:46:39Z",
    "updated_at": "2013-11-29T15:46:39Z",
    "body": "cc me\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29523625/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29810525",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-29810525",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 29810525,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODEwNTI1",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-04T14:51:56Z",
    "updated_at": "2013-12-04T14:52:10Z",
    "body": "I would like to replace all uses of `@T`/`P<T>` in **Visitor** with `&T`.\nThe only **Visitor** implementation I know of that needs the original pointer is in **ast_map**, and I have a few ideas on how to deal with it:\n- provide a helper `P::from_ref(&T) -> P<T>` function that returns the original `@T`/`P<T>` pointer from a reference; this will work in most cases, but it's not safe if the provided `&T` wasn't borrowed from a `@T`/`P<T>`.\n- use a **Folder** instead of a **Visitor**; if all the methods are implemented to return the original `@T`/`P<T>`, no new allocations should be made behind the scenes, but it could be slower (experimentation required)\n- write a specialized version of the current **Visitor**, which works with `@T`/`P<T>` and is used only by **ast_map**; apart from the code duplication, it's the cleanest solution\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29810525/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29820305",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-29820305",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 29820305,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODIwMzA1",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-04T16:28:36Z",
    "updated_at": "2013-12-04T16:28:36Z",
    "body": "@eddyb what is the motivation to make this change? The fact that some users want to take ownership of what they are passed seems like a good reason for keeping it the way it is.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29820305/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29822950",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-29822950",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 29822950,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODIyOTUw",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-04T16:56:57Z",
    "updated_at": "2013-12-04T16:56:57Z",
    "body": "@nikomatsakis it's an extra cost (ref-counting right now) for all visitors and changing `@T` with anything else means touching every **Visitor** implementation.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29822950/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47421149",
    "html_url": "https://github.com/rust-lang/rust/issues/7929#issuecomment-47421149",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7929",
    "id": 47421149,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDIxMTQ5",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T07:56:15Z",
    "updated_at": "2014-06-28T07:56:15Z",
    "body": "(The AST now has `Gc` instead of `@`, but the semantics haven't changed.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47421149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
