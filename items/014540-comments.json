[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44974502",
    "html_url": "https://github.com/rust-lang/rust/issues/14540#issuecomment-44974502",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14540",
    "id": 44974502,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0OTc0NTAy",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-03T14:51:29Z",
    "updated_at": "2014-06-03T14:51:29Z",
    "body": "I whipped up a dummy example to see how this would optimize `Option<Result<T, E>>` types, and it has a pretty nice 8% speedup: https://gist.github.com/erickt/8a6be5c8a2542eaf0c45. This would be especially helpful for my `libserialize` rewrite [RFC](https://github.com/rust-lang/rfcs/pull/22).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44974502/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45053172",
    "html_url": "https://github.com/rust-lang/rust/issues/14540#issuecomment-45053172",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14540",
    "id": 45053172,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MDUzMTcy",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-04T05:36:33Z",
    "updated_at": "2017-01-15T07:08:11Z",
    "body": "I don't want to comment too much on what should be the language defined method of determining the one \"invalid\" bit pattern that would get chosen among all the possible ones. But I do believe that if at least one \"invalid\" bit pattern (interpreted as the underlying integral type of the enum) exists such that it is either larger than the largest enum variant or smaller than the smallest enum variant, then one of those should be guaranteed to get chosen. This enables users to create C-like enums that they use as integers bounded to a certain continuous range of values (by providing their own unsafe iterators for such an enum type). For example, given the following enum:\r\n\r\n```\r\n#[repr(u8)]\r\nenum Value {\r\n    Min = 1,\r\n    Max = 3\r\n}\r\n```\r\n\r\nThe language should guarantee that the \"invalid\" bit pattern used for representing the `None` value of type `Option<Value>` is either 0b_0000_0000 (less than Value::Min), or in the range of values [0b_0000_0100, 0b_1111_1111] (greater than Value::Max). That's assuming the underlying integral type of  `Value` is `u8`.\r\n\r\n[Edit]\r\nIgnore this whole comment. When I wrote it I didn't realize that it's undefined behaviour to have an enum set to a discriminant value that's not included in the definition of the enum. Therefore an iterator that traverses from `Value::Min` to `Value::Max` in increments of 1, would have to along the way store the non-existing discriminant value 2 into the enum which would be UB. Therefore it would be fine to use value 2 as a the underlying representation for `Option::None::<Value>`. Although maybe the rule that determines which value is used to represent internally the `None` case should favor the value 0 the most, because I think comparison against 0 may be faster than comparison against other values on some processors.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45053172/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45225119",
    "html_url": "https://github.com/rust-lang/rust/issues/14540#issuecomment-45225119",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14540",
    "id": 45225119,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MjI1MTE5",
    "user": {
      "login": "pczarn",
      "id": 3356767,
      "node_id": "MDQ6VXNlcjMzNTY3Njc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3356767?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pczarn",
      "html_url": "https://github.com/pczarn",
      "followers_url": "https://api.github.com/users/pczarn/followers",
      "following_url": "https://api.github.com/users/pczarn/following{/other_user}",
      "gists_url": "https://api.github.com/users/pczarn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pczarn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pczarn/subscriptions",
      "organizations_url": "https://api.github.com/users/pczarn/orgs",
      "repos_url": "https://api.github.com/users/pczarn/repos",
      "events_url": "https://api.github.com/users/pczarn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pczarn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-05T14:23:06Z",
    "updated_at": "2014-06-05T14:26:41Z",
    "body": "Don't you think it could be done transitively for all tagged unions and integral enum types?\n\nI have three optimizations on my mind:\n- use free patterns for zero-length variant representations in non-integral enums, including checks for nullable pointers and all of the above\n- allow `#[repr(`_int type_`)]` on non-integral enums\n- use `#[packed]` on enums to force all possible optimizations\n\nI think the bit pattern of a variant should should be as close to 0 as possible in the order of declaration, just like in integral enums. It could stay undefined or become implementation defined\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45225119/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45225445",
    "html_url": "https://github.com/rust-lang/rust/issues/14540#issuecomment-45225445",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14540",
    "id": 45225445,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MjI1NDQ1",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-05T14:25:29Z",
    "updated_at": "2014-06-05T14:31:55Z",
    "body": "> use #[packed] on enums to force all possible optimizations\n\nWhy wouldn't this be the default? (That is, why would all optimisations be applied by default.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45225445/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45402681",
    "html_url": "https://github.com/rust-lang/rust/issues/14540#issuecomment-45402681",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14540",
    "id": 45402681,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NDAyNjgx",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-07T06:36:08Z",
    "updated_at": "2014-06-07T06:37:37Z",
    "body": "> Don't you think it could be done transitively for all tagged unions and integral enum types?\n\nI don't really understand the question. I'm sure that there are plenty of other possible optimizations, but they can be implemented irrespective of this proposed optimization and I think they should get their own dedicated github-issues.\n\nThis proposed optimization should happen automatically, just like the non-null based space-optimization of `Option<&T>` and `Option<~T>` values.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45402681/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45995018",
    "html_url": "https://github.com/rust-lang/rust/issues/14540#issuecomment-45995018",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14540",
    "id": 45995018,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1OTk1MDE4",
    "user": {
      "login": "pczarn",
      "id": 3356767,
      "node_id": "MDQ6VXNlcjMzNTY3Njc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3356767?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pczarn",
      "html_url": "https://github.com/pczarn",
      "followers_url": "https://api.github.com/users/pczarn/followers",
      "following_url": "https://api.github.com/users/pczarn/following{/other_user}",
      "gists_url": "https://api.github.com/users/pczarn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pczarn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pczarn/subscriptions",
      "organizations_url": "https://api.github.com/users/pczarn/orgs",
      "repos_url": "https://api.github.com/users/pczarn/repos",
      "events_url": "https://api.github.com/users/pczarn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pczarn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-13T10:05:19Z",
    "updated_at": "2014-06-13T10:05:19Z",
    "body": "@huonw, because it's a space-time tradeoff. Ideally, all possible values of an ADT could be represented within a minimal number of bits. However, values can be moved out of enums, so they should exist somewhere with proper alignment. Matching complex packed enums could still get expensive without simple discriminants:\n\n``` rust\nenum Value {\n  A = 20,\n  B = 21,\n}\n\n// Option<Result<Value, IoErrorKind>>\nmatch maybe_result {\n  // matches on {22, _}\n  None => a,\n  // matches on {18, 0}\n  Some(Err(ShortWrite(0))) => b,\n  // matches on {x, _} if 20 <= x && x < 22\n  Some(Ok(_)) => c,\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45995018/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/57465743",
    "html_url": "https://github.com/rust-lang/rust/issues/14540#issuecomment-57465743",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14540",
    "id": 57465743,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NDY1NzQz",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-01T13:51:23Z",
    "updated_at": "2014-10-01T13:51:23Z",
    "body": "@pczarn But there is no space-time tradeoff with the space-optimization that is being proposed here.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/57465743/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/57470655",
    "html_url": "https://github.com/rust-lang/rust/issues/14540#issuecomment-57470655",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14540",
    "id": 57470655,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NDcwNjU1",
    "user": {
      "login": "pczarn",
      "id": 3356767,
      "node_id": "MDQ6VXNlcjMzNTY3Njc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3356767?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pczarn",
      "html_url": "https://github.com/pczarn",
      "followers_url": "https://api.github.com/users/pczarn/followers",
      "following_url": "https://api.github.com/users/pczarn/following{/other_user}",
      "gists_url": "https://api.github.com/users/pczarn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pczarn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pczarn/subscriptions",
      "organizations_url": "https://api.github.com/users/pczarn/orgs",
      "repos_url": "https://api.github.com/users/pczarn/repos",
      "events_url": "https://api.github.com/users/pczarn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pczarn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-01T14:17:41Z",
    "updated_at": "2014-10-01T14:17:41Z",
    "body": "Of course, sorry, I was referring to something else.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/57470655/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/221400773",
    "html_url": "https://github.com/rust-lang/rust/issues/14540#issuecomment-221400773",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14540",
    "id": 221400773,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyMTQwMDc3Mw==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-05-24T21:04:39Z",
    "updated_at": "2016-05-24T21:04:39Z",
    "body": "Triage: no changes I'm aware of.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/221400773/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/302750720",
    "html_url": "https://github.com/rust-lang/rust/issues/14540#issuecomment-302750720",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14540",
    "id": 302750720,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwMjc1MDcyMA==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-19T16:32:42Z",
    "updated_at": "2017-05-19T16:32:42Z",
    "body": "I'm going to close this in favor of rust-lang/rfcs#1230 since there's a lot of potential layout optimizations involving enums but this one specific issue isn't key enough that it should be tracked separately.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/302750720/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
