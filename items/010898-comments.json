[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43460062",
    "html_url": "https://github.com/rust-lang/rust/issues/10898#issuecomment-43460062",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10898",
    "id": 43460062,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNDYwMDYy",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-19T01:35:02Z",
    "updated_at": "2014-05-19T01:35:02Z",
    "body": "I can't make heads or tails of this.\n\n``` rust\nextern crate test;\n\n#[main]\nfn say_hi () {\n   println!(\"Hello!!\");\n}\n\n#[test]\nfn addition_works () {\n   assert! (2 + 2 == 4);\n}\n\n#[test]\nfn test2() {\n    assert!(1 + 1 == 2);\n}\n\n#[bench]\nfn addition_benchmarked (b: &mut test::Bencher) {\n   let mut sum = 0;\n   b.iter(|| sum += 1)\n}\n```\n\nAnd the following patch:\n\n``` patch\ndiff --git a/src/libtest/lib.rs b/src/libtest/lib.rs\nindex 4681c02..9517961 100644\n--- a/src/libtest/lib.rs\n+++ b/src/libtest/lib.rs\n@@ -156,6 +156,20 @@ impl TestFn {\n     }\n }\n\n+impl fmt::Show for TestFn {\n+    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n+        f.write(match *self {\n+            StaticTestFn(..) => \"StaticTestFn(..)\",\n+            StaticBenchFn(..) => \"StaticBenchFn(..)\",\n+            StaticMetricFn(..) => \"StaticMetricFn(..)\",\n+            DynTestFn(..) => \"DynTestFn(..)\",\n+            DynMetricFn(..) => \"DynMetricFn(..)\",\n+            DynBenchFn(..) => \"DynBenchFn(..)\"\n+        }.as_bytes()).ok().unwrap();\n+        Ok(())\n+    }\n+}\n+\n /// Manager of the benchmarking runs.\n ///\n /// This is feed into functions marked with `#[bench]` to allow for\n@@ -170,13 +184,14 @@ pub struct Bencher {\n\n // The definition of a single test. A test runner will run a list of\n // these.\n-#[deriving(Clone)]\n+#[deriving(Clone, Show)]\n pub struct TestDesc {\n     pub name: TestName,\n     pub ignore: bool,\n     pub should_fail: bool,\n }\n\n+#[deriving(Show)]\n pub struct TestDescAndFn {\n     pub desc: TestDesc,\n     pub testfn: TestFn,\n@@ -242,15 +257,9 @@ pub fn test_main(args: &[StrBuf], tests: Vec<TestDescAndFn> ) {\n pub fn test_main_static(args: &[StrBuf], tests: &[TestDescAndFn]) {\n     let owned_tests = tests.iter().map(|t| {\n         match t.testfn {\n-            StaticTestFn(f) =>\n-            TestDescAndFn { testfn: StaticTestFn(f), desc: t.desc.clone() },\n-\n-            StaticBenchFn(f) =>\n-            TestDescAndFn { testfn: StaticBenchFn(f), desc: t.desc.clone() },\n-\n-            _ => {\n-                fail!(\"non-static tests passed to test::test_main_static\");\n-            }\n+            StaticTestFn(f) => TestDescAndFn { testfn: StaticTestFn(f), desc: t.desc.clone() },\n+            StaticBenchFn(f) => TestDescAndFn { testfn: StaticBenchFn(f), desc: t.desc.clone() },\n+            _ => fail!(\"non-static tests passed to test::test_main_static\")\n         }\n     }).collect();\n     test_main(args, owned_tests)\n@@ -739,10 +748,9 @@ pub fn fmt_bench_samples(bs: &BenchSamples) -> StrBuf {\n }\n\n // A simple console test runner\n-pub fn run_tests_console(opts: &TestOpts,\n-                         tests: Vec<TestDescAndFn> ) -> io::IoResult<bool> {\n-    fn callback<T: Writer>(event: &TestEvent,\n-                           st: &mut ConsoleTestState<T>) -> io::IoResult<()> {\n+pub fn run_tests_console(opts: &TestOpts, tests: Vec<TestDescAndFn> ) -> io::IoResult<bool> {\n+\n+    fn callback<T: Writer>(event: &TestEvent, st: &mut ConsoleTestState<T>) -> io::IoResult<()> {\n         match (*event).clone() {\n             TeFiltered(ref filtered_tests) => st.write_run_start(filtered_tests.len()),\n             TeWait(ref test, padding) => st.write_test_start(test, padding),\n@@ -778,6 +786,7 @@ pub fn run_tests_console(opts: &TestOpts,\n             }\n         }\n     }\n+\n     let mut st = try!(ConsoleTestState::new(opts, None::<StdWriter>));\n     fn len_if_padded(t: &TestDescAndFn) -> uint {\n         match t.testfn.padding() {\n@@ -933,9 +942,7 @@ fn get_concurrency() -> uint {\n     }\n }\n\n-pub fn filter_tests(\n-    opts: &TestOpts,\n-    tests: Vec<TestDescAndFn> ) -> Vec<TestDescAndFn> {\n+pub fn filter_tests(opts: &TestOpts, tests: Vec<TestDescAndFn>) -> Vec<TestDescAndFn> {\n     let mut filtered = tests;\n\n     // Remove tests that don't match the test filter\n@@ -972,6 +979,7 @@ pub fn filter_tests(\n     match opts.test_shard {\n         None => filtered,\n         Some((a,b)) => {\n+            println!(\"sharding over: {}\", filtered);\n             filtered.move_iter().enumerate()\n             .filter(|&(i,_)| i % b == a)\n             .map(|(_,t)| t)\n```\n\nI get:\n\n```\nsharding over: [TestDescAndFn { desc: TestDesc { name: addition_benchmarked, ignore: false, should_fail: false }, testfn: StaticBenchFn(..) }, TestDescAndFn { desc: TestDesc { name: addition_works, ignore: false, should_fail: false }, testfn: StaticTestFn(..) }, TestDescAndFn { desc: TestDesc { name: test2, ignore: false, should_fail: false }, testfn: StaticTestFn(..) }]\n```\n\nBut even `./foo --test-shard 1.1`, which should in theory run _everything_, is running nothing!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43460062/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43460151",
    "html_url": "https://github.com/rust-lang/rust/issues/10898#issuecomment-43460151",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10898",
    "id": 43460151,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNDYwMTUx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-19T01:38:46Z",
    "updated_at": "2014-05-19T01:39:51Z",
    "body": "IIRC, indexing starts from 0. e.g. 0.1 runs everything, 0.2 and 1.2 run half each.\n\n(We should have an out-of-bounds warning...)\n\n(Or maybe not? I can't remember the syntax.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43460151/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43460185",
    "html_url": "https://github.com/rust-lang/rust/issues/10898#issuecomment-43460185",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10898",
    "id": 43460185,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNDYwMTg1",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-19T01:39:54Z",
    "updated_at": "2014-05-19T01:39:54Z",
    "body": "@killerswan the issue is actually quite simpler. With two shards, your choices are `0.2` and `1.2`, not `2.2`! That will check if `i % 2 == 2`, which is obviously never going to be true. I found this very counter intuitive. I'll change it to behavior more logically (1.2 and 2.2 instead of 0.2 and 1.2)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43460185/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
