{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/15503",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/15503/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/15503/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/15503/events",
  "html_url": "https://github.com/rust-lang/rust/pull/15503",
  "id": 37291509,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTgwNTc4MDM=",
  "number": 15503,
  "title": "New `deriving` that generates O(n) code for PartialOrd, Ord, etc.",
  "user": {
    "login": "pnkfelix",
    "id": 173127,
    "node_id": "MDQ6VXNlcjE3MzEyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pnkfelix",
    "html_url": "https://github.com/pnkfelix",
    "followers_url": "https://api.github.com/users/pnkfelix/followers",
    "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
    "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
    "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
    "repos_url": "https://api.github.com/users/pnkfelix/repos",
    "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 11,
  "created_at": "2014-07-07T17:37:43Z",
  "updated_at": "2014-07-11T17:36:40Z",
  "closed_at": "2014-07-11T17:36:37Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/15503",
    "html_url": "https://github.com/rust-lang/rust/pull/15503",
    "diff_url": "https://github.com/rust-lang/rust/pull/15503.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/15503.patch",
    "merged_at": "2014-07-11T17:36:40Z"
  },
  "body": "Instead of generating a separate case (albeit trivial) for each of the N*N cases when comparing two instances of an enum with N variants, this `deriving` uses the strategy outlined here: https://github.com/rust-lang/rust/issues/15375#issuecomment-47994007\n\nIn particular, it generates code that looks more like this:\n\n``` rust\n    match (this, that, ...) {\n      (Variant1, Variant1, Variant1) => ... // delegate Matching on Variant1\n      (Variant2, Variant2, Variant2) => ... // delegate Matching on Variant2\n      ...\n      _ => {\n        let index_tup = {\n          let idx_this = match this { Variant1 => 0u, Variant2 => 1u, ... };\n          let idx_that = match that { Variant1 => 0u, Variant2 => 1u, ... };\n          ...\n          (idx_this, idx_that, ...)\n        };\n        ... // delegate to catch-all; it can inspect `index_tup` for its logic\n      }\n    }\n```\n\nWhile adding a new variant to the `const_nonmatching` flag (and renaming it to `on_nonmatching`) to allow expressing the above (while still allowing one to opt back into the old `O(N^2)` and in general `O(N^K)` (where `K` is the number of self arguments) code generation behavior), I had two realizations:\n1. Observation: Nothing except for the comparison derivings (`PartialOrd`, `Ord`, `PartialEq`, `Eq`) were even using the old `O(N^K)` code generator.  So after this hypothetically lands, _nothing_ needs to use them, and thus that code generation strategy could be removed, under the assumption that it is very unlikely that any `deriving` mode will actually need that level of generality.\n2. Observation: The new code generator I am adding can actually be unified with all of the other code generators that just dispatch on the variant tag (they all assume that there is only one self argument).\n\nThese two observations mean that one can get rid of the `const_nonmatching` (aka `on_nonmatching`) entirely.  So I did that too in this PR.\n\nThe question is: Do we actually want to follow through on both of the above observations?  I'm pretty sure the second observation is a pure win.  But there _might_ be someone out there with an example that invalidates the reasoning in the first observation.  That is, there might be a client out there with an example of hypothetical deriving mode that wants to opt into the `O(N^K)` behavior.  So, if that is true, then I can revise this PR to resurrect the `on_nonmatching` flag and provide a way to access the `O(N^K)` behavior.\n\nThe manner in which I choose to squash these commits during a post-review rebase depends on the answer to the above question.\n\nFix #15375.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/15503/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/15503/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
