[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89625267",
    "html_url": "https://github.com/rust-lang/rust/issues/24047#issuecomment-89625267",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24047",
    "id": 89625267,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NjI1MjY3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-04T17:41:14Z",
    "updated_at": "2015-04-04T17:41:14Z",
    "body": "This is currently working as intended in terms of that it doesn't compile. The `PartialEq` trait is not object-safe which means it's not usable through a trait object. I suspect the error message could be a little better in this case, however!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89625267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89672879",
    "html_url": "https://github.com/rust-lang/rust/issues/24047#issuecomment-89672879",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24047",
    "id": 89672879,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NjcyODc5",
    "user": {
      "login": "withoutboats",
      "id": 9063376,
      "node_id": "MDQ6VXNlcjkwNjMzNzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9063376?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/withoutboats",
      "html_url": "https://github.com/withoutboats",
      "followers_url": "https://api.github.com/users/withoutboats/followers",
      "following_url": "https://api.github.com/users/withoutboats/following{/other_user}",
      "gists_url": "https://api.github.com/users/withoutboats/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/withoutboats/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/withoutboats/subscriptions",
      "organizations_url": "https://api.github.com/users/withoutboats/orgs",
      "repos_url": "https://api.github.com/users/withoutboats/repos",
      "events_url": "https://api.github.com/users/withoutboats/events{/privacy}",
      "received_events_url": "https://api.github.com/users/withoutboats/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-04T22:34:07Z",
    "updated_at": "2015-04-04T22:37:07Z",
    "body": "The derived PartialEq is not object-safe, but in my actual code I was able to implement an object-safe PartialEq which satisfied my needs in the case of the trait that was boxed. Deriving `PartialEq` on the trait itself does not compile, but if the trait does implement `PartialEq`, wouldn't it be better for structs carrying a boxed trait to derive `PartialEq`? Note that if the struct is carrying the trait object as an unboxed reference, it compiles fine.  This is at least an inconsistency.\n\nSpecifically in my case - and here may be Doing It Wrong - my boxed trait defines a method which a group of memberless structs all implement, expressively defining different modes of operation. I only needed `PartialEq` to test the mode-switching code, so the `PartialEq` implementation casts both self & rhs to `&Any` and compares their `TypeIDs`. Obviously this wouldn't be a proper equality check if the structs carried any data, but for my use it works.\n\nAn example of what I did (which needs nightly to compile) is below:\n\n```\n#![feature(core)]\n\nuse std::any::Any;\n\ntrait Foo: Any {\n    fn quux(&self) -> bool;\n}\n\nimpl PartialEq for Foo {\n    fn eq(&self, rhs: &Foo) -> bool {\n        self.get_type_id() == rhs.get_type_id()\n    }\n}\n\nstruct Bar;\nimpl Foo for Bar {\n    fn quux(&self) -> bool { true }\n}\n\nstruct Baz;\nimpl Foo for Baz {\n    fn quux(&self) -> bool { false }\n}\n\nfn main() {\n    println!(\"{}\", &Bar as &Foo == &Bar as &Foo); //true\n    println!(\"{}\", &Baz as &Foo == &Baz as &Foo); //true\n    println!(\"{}\", &Bar as &Foo == &Baz as &Foo); //false\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89672879/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/180015659",
    "html_url": "https://github.com/rust-lang/rust/issues/24047#issuecomment-180015659",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24047",
    "id": 180015659,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4MDAxNTY1OQ==",
    "user": {
      "login": "murarth",
      "id": 1332722,
      "node_id": "MDQ6VXNlcjEzMzI3MjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1332722?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murarth",
      "html_url": "https://github.com/murarth",
      "followers_url": "https://api.github.com/users/murarth/followers",
      "following_url": "https://api.github.com/users/murarth/following{/other_user}",
      "gists_url": "https://api.github.com/users/murarth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/murarth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/murarth/subscriptions",
      "organizations_url": "https://api.github.com/users/murarth/orgs",
      "repos_url": "https://api.github.com/users/murarth/repos",
      "events_url": "https://api.github.com/users/murarth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/murarth/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-02-04T19:33:15Z",
    "updated_at": "2016-02-04T19:33:15Z",
    "body": "I've also run into this issue, using `Rc<Trait>` in an enum variant and `impl PartialEq for Trait`. I've employed a workaround: defining `struct RcTrait(Rc<Trait>)` with a non-derived `PartialEq` implementation. `RcTrait` can then be inserted into `derive(PartialEq)` structs or enums without triggering this issue.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/180015659/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/180403450",
    "html_url": "https://github.com/rust-lang/rust/issues/24047#issuecomment-180403450",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24047",
    "id": 180403450,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4MDQwMzQ1MA==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-02-05T15:33:25Z",
    "updated_at": "2016-02-05T15:33:47Z",
    "body": "Using that trait `Foo` from @withoutboats' code, it seems like you run into this:\n\n``` rust\nstruct TestStruct {\n    member: Box<Foo>\n}\n\n// Compiles\nimpl PartialEq for TestStruct {\n    fn eq(&self, rhs: &Self) -> bool {\n        &self.member == &rhs.member\n    }\n}\n\n//  ERROR: cannot move out of borrowed content\nimpl PartialEq for TestStruct {\n    fn eq(&self, rhs: &Self) -> bool {\n        self.member == rhs.member\n    }\n}\n```\n\nI don't see why the second should fail to compile. The `==` operator usually autorefs its two operands.\n\n[Full code / playpen](https://play.rust-lang.org/?gist=e5d42cbb6f8662c1a08a&version=nightly)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/180403450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/180404358",
    "html_url": "https://github.com/rust-lang/rust/issues/24047#issuecomment-180404358",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24047",
    "id": 180404358,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4MDQwNDM1OA==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-02-05T15:36:11Z",
    "updated_at": "2016-02-05T15:36:11Z",
    "body": "The code in the initial post however will never compile, so maybe edit that to clarify.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/180404358/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/193411899",
    "html_url": "https://github.com/rust-lang/rust/issues/24047#issuecomment-193411899",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24047",
    "id": 193411899,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5MzQxMTg5OQ==",
    "user": {
      "login": "durka",
      "id": 47007,
      "node_id": "MDQ6VXNlcjQ3MDA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/47007?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/durka",
      "html_url": "https://github.com/durka",
      "followers_url": "https://api.github.com/users/durka/followers",
      "following_url": "https://api.github.com/users/durka/following{/other_user}",
      "gists_url": "https://api.github.com/users/durka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/durka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/durka/subscriptions",
      "organizations_url": "https://api.github.com/users/durka/orgs",
      "repos_url": "https://api.github.com/users/durka/repos",
      "events_url": "https://api.github.com/users/durka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/durka/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-03-07T19:29:54Z",
    "updated_at": "2016-03-07T19:29:54Z",
    "body": "Seems like @bluss' code can be fixed by changing `#[derive(PartialEq)]` to put in some more `&`s. Any reason not to do that?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/193411899/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/298274237",
    "html_url": "https://github.com/rust-lang/rust/issues/24047#issuecomment-298274237",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24047",
    "id": 298274237,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODI3NDIzNw==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-01T02:08:26Z",
    "updated_at": "2017-05-01T02:08:26Z",
    "body": "I'm not sure I quite understand what needs to be done here. The original issue implies that `#[derive(PartialEq)]` should work with trait objects, but [this comment](https://github.com/rust-lang/rust/issues/24047#issuecomment-89625267) suggests that should never work (`PartialEq` isn't object-safe). The discussion then seems to shift to changing derive to *make* it work, which is confusing to me.\r\n\r\nCould someone give a summary of this issue, preferably giving some concrete things that need to be done?",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/298274237/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/298275438",
    "html_url": "https://github.com/rust-lang/rust/issues/24047#issuecomment-298275438",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24047",
    "id": 298275438,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODI3NTQzOA==",
    "user": {
      "login": "withoutboats",
      "id": 9063376,
      "node_id": "MDQ6VXNlcjkwNjMzNzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9063376?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/withoutboats",
      "html_url": "https://github.com/withoutboats",
      "followers_url": "https://api.github.com/users/withoutboats/followers",
      "following_url": "https://api.github.com/users/withoutboats/following{/other_user}",
      "gists_url": "https://api.github.com/users/withoutboats/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/withoutboats/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/withoutboats/subscriptions",
      "organizations_url": "https://api.github.com/users/withoutboats/orgs",
      "repos_url": "https://api.github.com/users/withoutboats/repos",
      "events_url": "https://api.github.com/users/withoutboats/events{/privacy}",
      "received_events_url": "https://api.github.com/users/withoutboats/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-01T02:23:44Z",
    "updated_at": "2017-05-01T02:23:44Z",
    "body": "I was pretty new to Rust when I posted this and I don't think implementing derive of PartialEq for trait objects by using their type ids is a very good idea; looks like @bluss's issue was fixed a year ago, I'm just going to close this.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/298275438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
