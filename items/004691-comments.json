[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20448194",
    "html_url": "https://github.com/rust-lang/rust/issues/4691#issuecomment-20448194",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4691",
    "id": 20448194,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwNDQ4MTk0",
    "user": {
      "login": "msullivan",
      "id": 340349,
      "node_id": "MDQ6VXNlcjM0MDM0OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/msullivan",
      "html_url": "https://github.com/msullivan",
      "followers_url": "https://api.github.com/users/msullivan/followers",
      "following_url": "https://api.github.com/users/msullivan/following{/other_user}",
      "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions",
      "organizations_url": "https://api.github.com/users/msullivan/orgs",
      "repos_url": "https://api.github.com/users/msullivan/repos",
      "events_url": "https://api.github.com/users/msullivan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/msullivan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-03T22:11:02Z",
    "updated_at": "2013-07-03T22:11:02Z",
    "body": "Has any of this been done?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20448194/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20448474",
    "html_url": "https://github.com/rust-lang/rust/issues/4691#issuecomment-20448474",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4691",
    "id": 20448474,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwNDQ4NDc0",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-03T22:16:21Z",
    "updated_at": "2013-07-03T22:16:21Z",
    "body": "I actually this this is done. Let me double-check the tests.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20448474/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20448533",
    "html_url": "https://github.com/rust-lang/rust/issues/4691#issuecomment-20448533",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4691",
    "id": 20448533,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwNDQ4NTMz",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-03T22:17:31Z",
    "updated_at": "2013-07-03T22:17:31Z",
    "body": "See e.g. compile-fail/borrowck-move-out-of-struct-with-dtor.rs\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20448533/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20448680",
    "html_url": "https://github.com/rust-lang/rust/issues/4691#issuecomment-20448680",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4691",
    "id": 20448680,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwNDQ4Njgw",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-03T22:20:20Z",
    "updated_at": "2013-07-03T22:20:20Z",
    "body": "Not sure about the FSU case, and the test doesn't cover the `let y = x.f`\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20448680/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20448800",
    "html_url": "https://github.com/rust-lang/rust/issues/4691#issuecomment-20448800",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4691",
    "id": 20448800,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwNDQ4ODAw",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-03T22:22:37Z",
    "updated_at": "2013-07-03T22:22:37Z",
    "body": "It occurs to me that this test is only present on the branch for PR #7262 \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20448800/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24489886",
    "html_url": "https://github.com/rust-lang/rust/issues/4691#issuecomment-24489886",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4691",
    "id": 24489886,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NDg5ODg2",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-16T05:43:35Z",
    "updated_at": "2013-09-16T05:43:35Z",
    "body": "@nikomatsakis: can this be closed now?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24489886/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24676903",
    "html_url": "https://github.com/rust-lang/rust/issues/4691#issuecomment-24676903",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4691",
    "id": 24676903,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0Njc2OTAz",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-18T16:05:36Z",
    "updated_at": "2013-09-18T16:05:36Z",
    "body": "@thestinger sounds like it needs tests.  I will tag as such (and also poke around to check what the situation is with respect to the tests).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24676903/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24699728",
    "html_url": "https://github.com/rust-lang/rust/issues/4691#issuecomment-24699728",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4691",
    "id": 24699728,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0Njk5NzI4",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-18T21:10:16Z",
    "updated_at": "2013-09-18T21:19:55Z",
    "body": "Or rather, I think the first two bullets already have tests: \n- compile-fail/borrowck-move-out-of-struct-with-dtor.rs\n- compile-fail/borrowck-move-out-of-tuple-struct-with-dtor.rs\n\nNow I'm just trying to understand what Niko was getting at about the functional struct update (FSU) case...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24699728/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24704346",
    "html_url": "https://github.com/rust-lang/rust/issues/4691#issuecomment-24704346",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4691",
    "id": 24704346,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NzA0MzQ2",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-18T22:22:32Z",
    "updated_at": "2013-09-19T01:17:51Z",
    "body": "Okay, the borrow checker currently does not prevent someone from doing this, but I think @nikomatsakis wants it to be prevented:\n\n``` rust\nuse NC = std::util::NonCopyable;\n\n#[cfg(version2)]\nstruct S { a: int, b: int, p: ~str, nc: NC }\n#[cfg(version2)]\nfn make_s(a: int) -> S { S{ a: a, b: 0, p: ~\"A\", nc: NC } }\n#[cfg(version2)]\nfn ownmut(s: &mut S) { s.b = 1; s.p.push_char('B'); }\n\n#[cfg(not(version2))]\nstruct S { a: int, b: int, nc: NC }\n#[cfg(not(version2))]\nfn make_s(a: int) -> S { S{ a: a, b: 0, nc: NC } }\n#[cfg(not(version2))]\nfn ownmut(s: &mut S) { s.b = 1; }\n\nimpl ToStr for S {\n    #[cfg(version2)]\n    fn to_str(&self) -> ~str {\n        \"S { a: \"+ self.a.to_str() + \n            \", b: \"+ self.b.to_str() +\n            \", p: \"+ self.p + \" (nc) }\"\n    }\n    #[cfg(not(version2))]\n    fn to_str(&self) -> ~str {\n        \"S { a: \"+ self.a.to_str() +\n            \", b: \"+ self.b.to_str() + \" (nc) }\"\n    }\n}\n\nimpl Drop for S {\n    fn drop(&mut self) {\n        println!(\"{} is dropped\", self.to_str());\n    }\n}\n\nfn main() {\n    let s0 = make_s(0);\n    println!(\"s0: {}\", s0.to_str());\n\n    // Shouldn't be allowed: A move out of value with a dtor via\n    // Functional Struct Update (FSU):\n    let mut s2 = S{a: 2, ..s0};\n\n    // Uncommenting below will fail to compile, b/c s0 has been moved\n    // println!(\"s0: {}\", s0.to_str());\n\n    ownmut(&mut s2);\n\n    println!(\"s2: {}\", s2.to_str());\n}\n```\n\nThere seems like there's good reason for preventing this, at least in our current system, because its not clear how you should go about destructing instances of things like `S` where some of their parts have been reused (i.e. moved) via functional struct update.\n\nI put two versions of the code above.  In one version, `S` carries trivial payloads, and the compiled program \"just\" makes two destructor invocations at the end of `main`: one for `s2`, and another for `s0`.  In \"version2\", I added a `~str` payload to it (but left the struct-update alone, so the reference gets copied from `s0` to `s2`).\n\nHere's the results:\n\n```\n% rustc /tmp/f.rs && /tmp/f\nwarning: no debug symbols in executable (-arch x86_64)\ns0: S { a: 0, b: 0 (nc) }\ns2: S { a: 2, b: 1 (nc) }\nS { a: 2, b: 1 (nc) } is dropped\nS { a: 0, b: 0 (nc) } is dropped\n% rustc --cfg version2 /tmp/f.rs && /tmp/f\nwarning: no debug symbols in executable (-arch x86_64)\ns0: S { a: 0, b: 0, p: A (nc) }\ns2: S { a: 2, b: 1, p: AB (nc) }\nS { a: 2, b: 1, p: AB (nc) } is dropped\nSegmentation fault: 11\n% \n```\n\nSo, yeah, this is not yet done, and its not just a matter of `E-needstest`; I'll take that flag back off.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24704346/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
