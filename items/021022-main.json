{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/21022",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21022/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21022/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21022/events",
  "html_url": "https://github.com/rust-lang/rust/pull/21022",
  "id": 54076219,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MjcyMDc0MTQ=",
  "number": 21022,
  "title": "New scoping rules for safe destruction",
  "user": {
    "login": "pnkfelix",
    "id": 173127,
    "node_id": "MDQ6VXNlcjE3MzEyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pnkfelix",
    "html_url": "https://github.com/pnkfelix",
    "followers_url": "https://api.github.com/users/pnkfelix/followers",
    "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
    "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
    "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
    "repos_url": "https://api.github.com/users/pnkfelix/repos",
    "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "nikomatsakis",
    "id": 155238,
    "node_id": "MDQ6VXNlcjE1NTIzOA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nikomatsakis",
    "html_url": "https://github.com/nikomatsakis",
    "followers_url": "https://api.github.com/users/nikomatsakis/followers",
    "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
    "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
    "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
    "repos_url": "https://api.github.com/users/nikomatsakis/repos",
    "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2015-01-12T16:43:49Z",
  "updated_at": "2015-02-14T07:33:21Z",
  "closed_at": "2015-02-02T15:32:36Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/21022",
    "html_url": "https://github.com/rust-lang/rust/pull/21022",
    "diff_url": "https://github.com/rust-lang/rust/pull/21022.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/21022.patch",
    "merged_at": null
  },
  "body": "This is a resurrection and heavy revision/expansion of a PR that pcwalton did to resolve #8861.\n\nThe most relevant, user-visible semantic change is this: `#[unsafe_destructor]` is gone.  Instead, if a type expression for some value has a destructor, then any lifetimes referenced within that type expression must strictly outlive the scope of the value.\n\nThe kind of code that breaks is typically fixed by moving around bindings so that certain values (like arenas) live longer, like so:\n\n```\n         let mut forest = ast_map::Forest::new(expanded_crate);\n+        let arenas = ty::CtxtArenas::new();\n         let ast_map = assign_node_ids_and_map(&sess, &mut forest);\n\n         write_out_deps(&sess, input, &outputs, &id[]);\n\n-        let arenas = ty::CtxtArenas::new();\n         let analysis = phase_3_run_analysis_passes(sess,\n                                                    ast_map,\n                                                    &arenas,\n```\n\nAnother fun case is when you are swapping references: the finer grain scopes introduced by this PR require changes like this:\n\n```\n         };\n         let mut matched = false;\n         let ninsts = self.prog.insts.len();\n-        let mut clist = &mut Threads::new(self.which, ninsts, ncaps);\n-        let mut nlist = &mut Threads::new(self.which, ninsts, ncaps);\n+        let mut cthread = Threads::new(self.which, ninsts, ncaps);\n+        let mut nthread = Threads::new(self.which, ninsts, ncaps);\n+        let mut clist = &mut cthread;\n+        let mut nlist = &mut nthread;\n\n         let mut groups: Vec<_> = repeat(None).take(ncaps * 2).collect();\n\n```\n\n[breaking-change]\n\nFix #8861 \n",
  "closed_by": {
    "login": "pnkfelix",
    "id": 173127,
    "node_id": "MDQ6VXNlcjE3MzEyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pnkfelix",
    "html_url": "https://github.com/pnkfelix",
    "followers_url": "https://api.github.com/users/pnkfelix/followers",
    "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
    "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
    "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
    "repos_url": "https://api.github.com/users/pnkfelix/repos",
    "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/21022/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21022/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
