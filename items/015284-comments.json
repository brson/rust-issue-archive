[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47726325",
    "html_url": "https://github.com/rust-lang/rust/pull/15284#issuecomment-47726325",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15284",
    "id": 47726325,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzI2MzI1",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T00:54:14Z",
    "updated_at": "2014-07-02T00:56:14Z",
    "body": "At a first pass, this all looks ok, except https://github.com/apoelstra/rust/commit/962e1b6c44a8360bb18d21e70b334408e251685b. Saying \"if there is one, I didn't check\" basically means \"no\", to me. Making changes with performance impliciations _with no measurements_ is not something we should do. I'm fine with removing the separation if it's true that 1. there are no users depending on this, 2. the performance impact is actually small.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47726325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47726616",
    "html_url": "https://github.com/rust-lang/rust/pull/15284#issuecomment-47726616",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15284",
    "id": 47726616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzI2NjE2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T01:00:11Z",
    "updated_at": "2014-07-02T01:00:11Z",
    "body": "A few high-level points:\n- Is there still any utility to having the distinction between `Bitv` and `BitvSet`?\n- Could the bitv constructor just be `Bitv::new()` and perhaps add a `Bitv::with_capacity()` ?\n- This does unfortunately mean that small bit vectors require a heap allocation. I'm sure there's a microbenchmark which will show that this is a perf hit, but that may not matter too too much. Just wanted to bring this up as a point.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47726616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47729534",
    "html_url": "https://github.com/rust-lang/rust/pull/15284#issuecomment-47729534",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15284",
    "id": 47729534,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzI5NTM0",
    "user": {
      "login": "apoelstra",
      "id": 1351933,
      "node_id": "MDQ6VXNlcjEzNTE5MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apoelstra",
      "html_url": "https://github.com/apoelstra",
      "followers_url": "https://api.github.com/users/apoelstra/followers",
      "following_url": "https://api.github.com/users/apoelstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/apoelstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
      "organizations_url": "https://api.github.com/users/apoelstra/orgs",
      "repos_url": "https://api.github.com/users/apoelstra/repos",
      "events_url": "https://api.github.com/users/apoelstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apoelstra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T01:54:09Z",
    "updated_at": "2014-07-02T01:54:09Z",
    "body": "@cmr I'll do some benchmarks and see what happens. As for usage, I'm not aware of any performance-sensitive use of small `Bitv`s in the wild (there are none in rustc or in my code) and I'm not sure where I should look to find some.\n\n@alexcrichton Agreed, I should change the constructors. As for the distinction between `Bitv` and `BitvSet`, I think it's worthwhile because `BitvSet` behaves as though it were unbounded (getting past the end will simply return \"element not in set\" while setting past the end will extend the underlying array). The two types are conceptually very different and I think we should keep the separation in code.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47729534/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47729898",
    "html_url": "https://github.com/rust-lang/rust/pull/15284#issuecomment-47729898",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15284",
    "id": 47729898,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzI5ODk4",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T02:01:11Z",
    "updated_at": "2014-07-02T02:01:11Z",
    "body": "If rustc doesn't use it, I'm convinced. I still want to know what the\nperformance impact is.\n\nOn Tue, Jul 1, 2014 at 6:54 PM, Andrew Poelstra notifications@github.com\nwrote:\n\n> @cmr https://github.com/cmr I'll do some benchmarks and see what\n> happens. As for usage, I'm not aware of any performance-sensitive use of\n> small Bitvs in the wild (there are none in rustc or in my code) and I'm\n> not sure where I should look to find some.\n> \n> @alexcrichton https://github.com/alexcrichton Agreed, I should change\n> the constructors. As for the distinction between Bitv and BitvSet, I\n> think it's worthwhile because BitvSet behaves as though it were unbounded\n> (getting past the end will simply return \"element not in set\" while setting\n> past the end will extend the underlying array). The two types are\n> conceptually very different and I think we should keep the separation in\n> code.\n> \n> \u2014\n> Reply to this email directly or view it on GitHub\n> https://github.com/rust-lang/rust/pull/15284#issuecomment-47729534.\n\n## \n\nhttp://octayn.net/\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47729898/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47735146",
    "html_url": "https://github.com/rust-lang/rust/pull/15284#issuecomment-47735146",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15284",
    "id": 47735146,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzM1MTQ2",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T04:00:54Z",
    "updated_at": "2014-07-02T04:00:54Z",
    "body": "`big_mask` is called a lot, especially in conjunction with `self.storage.iter()`. I wonder if there's some value in `Words`-like iterator that includes the mask, so e.g. `all` would be `self.mask_words().all(|(mask, word)| word & mask == mask)`. The iterator could then be updating the mask incrementally, instead of recomputing it each time (or, it could understand that the only time there won't be a full `!0` mask is for the last word, and so treat it specially).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47735146/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824925",
    "html_url": "https://github.com/rust-lang/rust/pull/15284#issuecomment-47824925",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15284",
    "id": 47824925,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI0OTI1",
    "user": {
      "login": "apoelstra",
      "id": 1351933,
      "node_id": "MDQ6VXNlcjEzNTE5MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apoelstra",
      "html_url": "https://github.com/apoelstra",
      "followers_url": "https://api.github.com/users/apoelstra/followers",
      "following_url": "https://api.github.com/users/apoelstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/apoelstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
      "organizations_url": "https://api.github.com/users/apoelstra/orgs",
      "repos_url": "https://api.github.com/users/apoelstra/repos",
      "events_url": "https://api.github.com/users/apoelstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apoelstra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:35:12Z",
    "updated_at": "2014-07-02T19:35:12Z",
    "body": "Thanks for the comments guys. I have submitted a new pull which takes all of your suggestions into account:\n- `BitvSet::compactify` is now `BitvSet::shrink_to_fit()` and is public. It is no longer called from `BitvSet::remove`; that is the user's responsibility.\n- `BitvSet::grow` is removed. We now have the new `BitvSet::reserve` and `Bitv::reserve` which are public.\n- The masking rules for `Bitv`s containing a number of bits not a multiple of `uint::BITS` are explained in a7b31a9e, are handled consistently, and unit tested. In particular `Bitv::word_iter` is now `Bitv::mask_words` and does masking itself.\n- `MaskWords` still does the job of `enumerate` and `skip`, because it can do so more efficiently.\n- Performance data is included in the commit message of 337a75f8. What it shows is that not much has changed except that `Bitv::iter` is slowed down for small `Bitv`s (as a consequence of `Bitv::get` needing to do an indirection) and `Bitv::union` is sped up (the old code had an indirection involving an `Op` enum to choose the right function, I guess to avoid code repetition in a world without macros).\n- `Bitv::each_storage` is removed since it had been reduced to a pointless indirection\n- `Bitv::extend` and `from_iterator` preallocate space.\n- `BitvSet::is_subset` and `is_superset` are substantially shortened and unit tested\n- 4-space tabs everywhere :)\n- `Bitv::new` is renamed to `Bitv::with_capacity`, and the new `Bitv::new` creates an empty `Bitv`. There is also a `BitvSet::with_capacity` which preallocates space.\n- `Bitv::assign` is removed since it is just a less-general version of `Clone::clone_from`. `Clone` is implemented explicitly to reuse space in `clone_from` if possible.\n- `iter::all()` is used in several places that explicit `for`/`return` loops had been.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824925/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
