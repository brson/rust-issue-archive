[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30605170",
    "html_url": "https://github.com/rust-lang/rust/issues/10983#issuecomment-30605170",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10983",
    "id": 30605170,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjA1MTcw",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-15T13:28:39Z",
    "updated_at": "2013-12-15T13:36:22Z",
    "body": "> Furthermore, it means that in order to test if a list is null, an extra pointer-dereference must occur.\n\nThis isn't at all true: checking for `Nil` is a simple as checking that the discriminant is `1` (I think; it may be chosen to be 0, and likely depends on the order in which the variants are defined). FWIW, this enum is actually represented as the following currently (in C, with Rust types):\n\n``` c\nstruct List {\n    u8 discriminant;\n    union {\n        struct { T elem; List* next; } cons;\n        zero_sized_type nil;\n    } variants;\n}\n```\n\nit could feasibly (but is _not_ now) be represented as\n\n``` c\nstruct List {\n    T elem;\n    List* next;\n}\n```\n\nwhere `next` is null when the `List` is `Nil` (that is, generalise the current `Option<~T>` optimisation to being able to use inner non-nullable `~` (etc) pointers as the discriminant for `Option`-like enums). However, in neither scheme does a pointer dereference occur to check for the current value being `Nil`. In the former it is `list.discriminant == 1`, in the latter it is `list.next == NULL`, i.e. both are just field accesses.\n\n(Also, note that the proposed definition doesn't allow for empty lists.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30605170/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30611385",
    "html_url": "https://github.com/rust-lang/rust/issues/10983#issuecomment-30611385",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10983",
    "id": 30611385,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjExMzg1",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-15T16:13:24Z",
    "updated_at": "2013-12-15T16:13:24Z",
    "body": "As @huonw notes, the two definitions given in the description are not representing the same two classes of data: the first can represent an empty list, while the second (as written) cannot.\n\n(It is possible that the author had intended for the second struct definition to be more like `struct Cons<T> { elem: T, link: Option<~Cons<T>> }` and then also add in `type List<T> = Option<~Cons<T>>`; but then again, I don't like trying to guess what people might have meant.  If you did that, then you should indeed end up with your `List<T>` allocating a single word of memory within its owner, rather than the current 5 + sizeof(T) byte representation described by huonw.)\n\n---\n\nAnyway, in my opinion, there are three distinct goals one might strive for in the tutorial:\n1. Provide examples of idiomatic Rust code,\n2. Provide Rust code that exercises distinct Rust language features, and\n3. minor subgoal: Provide guidance as to the performance tradeoffs of different choices.\n\nNote for point 1: we should be striving in the tutorial for idiomatic Rust.  Idiomatic Rust is not necessarily the same thing as idiomatic C.\n\nNote for point 2: the linked list is a classic algebraic data type, which invites using it to illustrate Rust-style `enum`, regardless of whether that matches the expectations of people coming from C.\n\nNote for point 3: Yes, its not great that `Nil` in the above ends up occupying >=2 words.  But on the other hand, we get to allocate the first element inline within the owner of the List.  Maybe that is a win in some scenarios; it is not obvious to me.\n\n---\n\nI am not terribly inclined to change the List enum definition, at least not based on the reasons given in this ticket.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30611385/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30622672",
    "html_url": "https://github.com/rust-lang/rust/issues/10983#issuecomment-30622672",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10983",
    "id": 30622672,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjIyNjcy",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-15T21:50:24Z",
    "updated_at": "2013-12-15T21:51:04Z",
    "body": "I don't think an owned singly linked list has much of a use case, so there's not really any demonstration of a real-world practice here. In almost ever case, a vector or a rope is going to provide much better performance. Intrusive linked lists are useful, but not something you can define _efficiently_ without pervasive `unsafe` code.\n\nSince empty lists need to be supported, writing one in the C style requires adding an extra `Option<T>` at the top-level and code to handle the special case in all of the methods. It would be much better to just expand the `enum` special cases built-in to the compiler to include types like this. Using an `enum` is the idiomatic way to represent a singly-linked list or a balanced binary search tree, whether or not it's as efficient as doing it all manually at the moment.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30622672/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30625742",
    "html_url": "https://github.com/rust-lang/rust/issues/10983#issuecomment-30625742",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10983",
    "id": 30625742,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjI1NzQy",
    "user": {
      "login": "ezyang",
      "id": 13564,
      "node_id": "MDQ6VXNlcjEzNTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/13564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ezyang",
      "html_url": "https://github.com/ezyang",
      "followers_url": "https://api.github.com/users/ezyang/followers",
      "following_url": "https://api.github.com/users/ezyang/following{/other_user}",
      "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions",
      "organizations_url": "https://api.github.com/users/ezyang/orgs",
      "repos_url": "https://api.github.com/users/ezyang/repos",
      "events_url": "https://api.github.com/users/ezyang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ezyang/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-16T00:02:53Z",
    "updated_at": "2013-12-16T00:02:53Z",
    "body": "Thanks everyone for the factual corrections! @huonw, you are right; the actual list type needs to be wrapped in the `Option<~Cons<T>>` style; I had forgotten to mention that (@pnkfelix figured it out though!) I don't think the description of how the tutorial list type is compiled is accurate for many choices of `T`, as can be seen by:\n\n``` rust\nenum List<T> {\n    Cons(T, ~List<T>),\n    Nil\n}\n\nfn main() {\n  println(format!(\"{}\", std::mem::size_of::<List<int>>()));\n}\n```\n\nWhich outputs `16` on a 64-bit system (no tag!)\n\n> Note for point 2: the linked list is a classic algebraic data type, which invites using it to illustrate Rust-style enum, regardless of whether that matches the expectations of people coming from C.\n\nAs a counterpoint, I would point out that linked list with owned pointers supports mutation, which is very unlike an algebraic data-type.\n\n> Since empty lists need to be supported, writing one in the C style requires adding an extra Option<T> at the top-level and code to handle the special case in all of the methods.\n\nI agree the C-style definition is a bit more clunky.\n\n> It would be much better to just expand the enum special cases built-in to the compiler to include types like this.\n\nI don't think this will be possible without breaking the invariant that a dereferenced `~List<T>` and `List<T>` have the same representation. (in the former case, the nullary case can be handled by having the owned pointer be represented as NULL; this cannot be done in the latter case).\n\nI don't really have any counterargument for, \"Well, you shouldn't use linked lists\"; we've had an argument about this on IRC and it really is a cultural issue.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30625742/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30626371",
    "html_url": "https://github.com/rust-lang/rust/issues/10983#issuecomment-30626371",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10983",
    "id": 30626371,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjI2Mzcx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-16T00:36:08Z",
    "updated_at": "2013-12-16T00:36:08Z",
    "body": "Oh, it appears that my second description is correct (the `~List` field is NULL to indicate that the list is `Nil`); neat.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30626371/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30646553",
    "html_url": "https://github.com/rust-lang/rust/issues/10983#issuecomment-30646553",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10983",
    "id": 30646553,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjQ2NTUz",
    "user": {
      "login": "ezyang",
      "id": 13564,
      "node_id": "MDQ6VXNlcjEzNTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/13564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ezyang",
      "html_url": "https://github.com/ezyang",
      "followers_url": "https://api.github.com/users/ezyang/followers",
      "following_url": "https://api.github.com/users/ezyang/following{/other_user}",
      "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions",
      "organizations_url": "https://api.github.com/users/ezyang/orgs",
      "repos_url": "https://api.github.com/users/ezyang/repos",
      "events_url": "https://api.github.com/users/ezyang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ezyang/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-16T09:31:21Z",
    "updated_at": "2013-12-16T09:31:21Z",
    "body": "@huonw Yep, that's what I wrote originally. Rereading your comment, I think there's another misunderstanding regarding the pointer reference. In my comment, I was claiming that checking if `~List<T>` was empty required a pointer dereference, whereas in your comment it appeared that you talking about the check if `List<T>` was empty. My observation was that `Option<~Cons<T>>` does not require a pointer dereference to check if things are null, because of the null-optimization.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30646553/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30646856",
    "html_url": "https://github.com/rust-lang/rust/issues/10983#issuecomment-30646856",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10983",
    "id": 30646856,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjQ2ODU2",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-16T09:36:51Z",
    "updated_at": "2013-12-16T09:36:51Z",
    "body": "A branch for the special empty case at the start is likely going to be just as hard for the branch predictor to deal with as the case at the end. It's not obvious to me if there's an advantage to doing it that way.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30646856/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30649601",
    "html_url": "https://github.com/rust-lang/rust/issues/10983#issuecomment-30649601",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10983",
    "id": 30649601,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjQ5NjAx",
    "user": {
      "login": "ezyang",
      "id": 13564,
      "node_id": "MDQ6VXNlcjEzNTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/13564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ezyang",
      "html_url": "https://github.com/ezyang",
      "followers_url": "https://api.github.com/users/ezyang/followers",
      "following_url": "https://api.github.com/users/ezyang/following{/other_user}",
      "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions",
      "organizations_url": "https://api.github.com/users/ezyang/orgs",
      "repos_url": "https://api.github.com/users/ezyang/repos",
      "events_url": "https://api.github.com/users/ezyang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ezyang/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-16T10:20:43Z",
    "updated_at": "2013-12-16T10:20:43Z",
    "body": "Sentinel nodes have good properties for many pointer data-structures, but using them for singly-linked lists is pretty weird. The sentinel node also costs quite a bit if your items are fat (which is one of the cases where using linked-lists can be right).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30649601/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30657638",
    "html_url": "https://github.com/rust-lang/rust/issues/10983#issuecomment-30657638",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10983",
    "id": 30657638,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjU3NjM4",
    "user": {
      "login": "glaebhoerl",
      "id": 1216629,
      "node_id": "MDQ6VXNlcjEyMTY2Mjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1216629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glaebhoerl",
      "html_url": "https://github.com/glaebhoerl",
      "followers_url": "https://api.github.com/users/glaebhoerl/followers",
      "following_url": "https://api.github.com/users/glaebhoerl/following{/other_user}",
      "gists_url": "https://api.github.com/users/glaebhoerl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glaebhoerl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glaebhoerl/subscriptions",
      "organizations_url": "https://api.github.com/users/glaebhoerl/orgs",
      "repos_url": "https://api.github.com/users/glaebhoerl/repos",
      "events_url": "https://api.github.com/users/glaebhoerl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glaebhoerl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-16T12:43:08Z",
    "updated_at": "2013-12-16T12:43:38Z",
    "body": "> As a counterpoint, I would point out that linked list with owned pointers supports mutation, which is very unlike an algebraic data-type.\n\nVery unlike an algebraic data-type _in a traditional garbage collected functional language with immutable data_. When I defined ADTs as a C++ library, I also discovered that being able to mutate them falls right out and can be quite useful: in this case it's Haskell that's lacking in expressiveness. I believe Disciple also allows mutation of ADTs as part of the language (sans IORefs), but they also have the type system infrastructure to prevent conflicts with laziness and purity.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30657638/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
