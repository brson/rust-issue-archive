{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/18941",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18941/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18941/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18941/events",
  "html_url": "https://github.com/rust-lang/rust/pull/18941",
  "id": 48724344,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MjQ0MTgwMjg=",
  "number": 18941,
  "title": "Rewrite std::sync::TaskPool to be load balancing and panic-resistant",
  "user": {
    "login": "reem",
    "id": 4745181,
    "node_id": "MDQ6VXNlcjQ3NDUxODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4745181?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/reem",
    "html_url": "https://github.com/reem",
    "followers_url": "https://api.github.com/users/reem/followers",
    "following_url": "https://api.github.com/users/reem/following{/other_user}",
    "gists_url": "https://api.github.com/users/reem/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/reem/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/reem/subscriptions",
    "organizations_url": "https://api.github.com/users/reem/orgs",
    "repos_url": "https://api.github.com/users/reem/repos",
    "events_url": "https://api.github.com/users/reem/events{/privacy}",
    "received_events_url": "https://api.github.com/users/reem/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 7,
  "created_at": "2014-11-14T02:57:40Z",
  "updated_at": "2014-11-16T22:59:52Z",
  "closed_at": "2014-11-16T13:17:50Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/18941",
    "html_url": "https://github.com/rust-lang/rust/pull/18941",
    "diff_url": "https://github.com/rust-lang/rust/pull/18941.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/18941.patch",
    "merged_at": "2014-11-16T13:17:50Z"
  },
  "body": "The previous implementation was very likely to cause panics during\nunwinding through this process:\n- child panics, drops its receiver\n- taskpool comes back around and sends another job over to that child\n- the child receiver has hung up, so the taskpool panics on send\n- during unwinding, the taskpool attempts to send a quit message to\n  the child, causing a panic during unwinding\n- panic during unwinding causes a process abort\n\nThis meant that TaskPool upgraded any child panic to a full process\nabort. This came up in Iron when it caused crashes in long-running\nservers.\n\nThis implementation uses a single channel to communicate between\nspawned tasks and the TaskPool, which significantly reduces the complexity\nof the implementation and cuts down on allocation. The TaskPool uses\nthe channel as a single-producer-multiple-consumer queue.\n\nAdditionally, through the use of send_opt and recv_opt instead of\nsend and recv, this TaskPool is robust on the face of child panics,\nboth before, during, and after the TaskPool itself is dropped.\n\nThis TaskPool uses an additional \"monitor\" task start new child\ntasks to replace those that panic.\n\nDue to the TaskPool no longer using an `init_fn_factory`, this is a\n\n[breaking-change]\n\notherwise, the API has not changed.\n\nIf you used `init_fn_factory` in your code, and this change breaks for\nyou, you can instead use an `AtomicUint` counter and a channel to\nmove information into child tasks.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/18941/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18941/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
