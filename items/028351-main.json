{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/28351",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/28351/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/28351/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/28351/events",
  "html_url": "https://github.com/rust-lang/rust/pull/28351",
  "id": 105981428,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NDQ3NjU4MTM=",
  "number": 28351,
  "title": "Make macro expansion backtraces shorter",
  "user": {
    "login": "jonas-schievink",
    "id": 1786438,
    "node_id": "MDQ6VXNlcjE3ODY0Mzg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jonas-schievink",
    "html_url": "https://github.com/jonas-schievink",
    "followers_url": "https://api.github.com/users/jonas-schievink/followers",
    "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}",
    "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions",
    "organizations_url": "https://api.github.com/users/jonas-schievink/orgs",
    "repos_url": "https://api.github.com/users/jonas-schievink/repos",
    "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jonas-schievink/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "nrc",
    "id": 762626,
    "node_id": "MDQ6VXNlcjc2MjYyNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nrc",
    "html_url": "https://github.com/nrc",
    "followers_url": "https://api.github.com/users/nrc/followers",
    "following_url": "https://api.github.com/users/nrc/following{/other_user}",
    "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
    "organizations_url": "https://api.github.com/users/nrc/orgs",
    "repos_url": "https://api.github.com/users/nrc/repos",
    "events_url": "https://api.github.com/users/nrc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nrc/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "nrc",
      "id": 762626,
      "node_id": "MDQ6VXNlcjc2MjYyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nrc",
      "html_url": "https://github.com/nrc",
      "followers_url": "https://api.github.com/users/nrc/followers",
      "following_url": "https://api.github.com/users/nrc/following{/other_user}",
      "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
      "organizations_url": "https://api.github.com/users/nrc/orgs",
      "repos_url": "https://api.github.com/users/nrc/repos",
      "events_url": "https://api.github.com/users/nrc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nrc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2015-09-11T10:07:12Z",
  "updated_at": "2015-12-26T10:15:48Z",
  "closed_at": "2015-09-15T05:05:38Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/28351",
    "html_url": "https://github.com/rust-lang/rust/pull/28351",
    "diff_url": "https://github.com/rust-lang/rust/pull/28351.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/28351.patch",
    "merged_at": "2015-09-15T05:05:38Z"
  },
  "body": "The second commit in this PR will stop printing the macro definition site in backtraces, which cuts their length in half and increases readability (the definition site was only correct for local macros).\n\nThe third commit will not print an invocation if the last one printed occurred at the same place (span). This will make backtraces caused by a self-recursive macro much shorter.\n\n(A possible alternative would be to capture the backtrace first, then limit it to a few frames at the start and end of the chain and print `...` inbetween. This would also work with multiple macros calling each other, which is not addressed by this PR - although the backtrace will still be halved)\n\nExample:\n\n``` rust\nmacro_rules! m {\n ( 0 $($t:tt)* ) => ( m!($($t)*); );\n () => ( fn main() {0} );\n}\n\nm!(0 0 0 0 0 0 0 0 0 0 0 0 0 0 0);\n```\n\nOn a semi-recent nightly, this yields:\n\n```\ntest.rs:3:21: 3:22 error: mismatched types:\n expected `()`,\n    found `_`\n(expected (),\n    found integral variable) [E0308]\ntest.rs:3  () => ( fn main() {0} );\n                              ^\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:2:23: 2:34 note: expansion site\ntest.rs:1:1: 4:2 note: in expansion of m!\ntest.rs:6:1: 6:35 note: expansion site\ntest.rs:3:21: 3:22 help: run `rustc --explain E0308` to see a detailed explanation\nerror: aborting due to previous error\n```\n\nAfter this patch:\n\n```\ntest.rs:3:21: 3:22 error: mismatched types:\n expected `()`,\n    found `_`\n(expected (),\n    found integral variable) [E0308]\ntest.rs:3  () => ( fn main() {0} );\n                              ^\ntest.rs:2:23: 2:34 note: in this expansion of m!\ntest.rs:6:1: 6:35 note: in this expansion of m!\ntest.rs:3:21: 3:22 help: run `rustc --explain E0308` to see a detailed explanation\nerror: aborting due to previous error\n```\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/28351/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/28351/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
