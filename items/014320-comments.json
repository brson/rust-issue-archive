[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43714655",
    "html_url": "https://github.com/rust-lang/rust/pull/14320#issuecomment-43714655",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14320",
    "id": 43714655,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzE0NjU1",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-21T05:50:32Z",
    "updated_at": "2014-05-21T05:50:32Z",
    "body": "Can tests be added for this? Injecting `#![no_std]` may not play nicely with macros that generate modules, perhaps we could leave it out for now?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43714655/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43714859",
    "html_url": "https://github.com/rust-lang/rust/pull/14320#issuecomment-43714859",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14320",
    "id": 43714859,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzE0ODU5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-21T05:55:03Z",
    "updated_at": "2014-05-21T05:55:03Z",
    "body": "@alexcrichton I don't know how to test this, but I ran `make check-stage1-pretty` and that passed. The only real testing I can think of is to use a run-make test and then look at the output of `--pretty expanded` for `#![no_std]`, etc, but that doesn't really seem very useful.\n\nWhy would `#![no_std]` not play nicely with macros that generate modules? I would assume `#![no_std]` would not affect anything at all during this compilation (beyond where I already noted that it skips injecting the prelude based on `#![no_std]`, which is why that attribute is deferred until the prelude inejct fold). Certainly a macro wouldn't be able to tell whether the crate is using `#![no_std]`.\n\nAnd when compiling the `--pretty expanded` output, `#![no_std]` is what prevents it from re-injecting the crates. The only reason today's `--pretty expanded` output compiles is because the `#[phase(syntax,link)]` attribute is skipped. Fixing it to print just that causes a link error due to duplicate crates.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43714859/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43715049",
    "html_url": "https://github.com/rust-lang/rust/pull/14320#issuecomment-43715049",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14320",
    "id": 43715049,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzE1MDQ5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-21T05:59:21Z",
    "updated_at": "2014-05-21T05:59:21Z",
    "body": "FWIW I just searched for `no_std` and the only code that checks for its presence is `rustc::front::std_inject`. So I'm pretty confident in saying that adding it here won't affect anything else during this compilation.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43715049/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43715273",
    "html_url": "https://github.com/rust-lang/rust/pull/14320#issuecomment-43715273",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14320",
    "id": 43715273,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzE1Mjcz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-21T06:03:33Z",
    "updated_at": "2014-05-21T06:03:33Z",
    "body": "``` rust\nmacro_rules! foo( () => (mod foo { fn bar() -> Option<int> { Some(3) } }) )\n\nfoo!()\n\nfn main() {\n    foo::bar();\n}\n```\n\nWhen expanded, this will have `#![no_std]` which will turn off prelude injection, which will cause `mod foo` to not compile in the expanded version (I think). Can you verify to see if this works?\n\nAlso, why is `#![no_std]` necessary for getting expanded pretty printing to compile?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43715273/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43724056",
    "html_url": "https://github.com/rust-lang/rust/pull/14320#issuecomment-43724056",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14320",
    "id": 43724056,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzI0MDU2",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-21T07:56:25Z",
    "updated_at": "2014-05-21T07:57:05Z",
    "body": "@alexcrichton Still compiles fine (both the normal version and recompiling the `--pretty expanded` version). Macros are expanded before prelude injection happens (which should be obvious, otherwise the `mod foo` wouldn't get the prelude), and `#![no_std]` doesn't get added until prelude injection (otherwise it would disable prelude injection for the entire crate).\n\n> Also, why is `#![no_std]` necessary for getting expanded pretty printing to compile?\n\nBecause `--pretty expanded` spits out the stdlib-injected version, and skipping `#![no_std]` means the stdlib will get injected a second time. Apparently that's ok without the `#[phase(syntax,link)]` attribute, but with it, you get an error. So fixing the `#[phase(syntax,link)]` attribute to be an outer attribute instead of an inner one (which causes it to show up during pretty-printing) also breaks the recompilation of the expanded form without `#![no_std]`.\n\nYou can reproduce this right now. The following compiles:\n\n``` rust\n#![feature(phase)]\n#![no_std]\n#[phase(syntax,link)]\nextern crate std = \"std#0.11.0-pre\";\nextern crate native = \"native#0.11.0-pre\";\nextern crate std = \"std#0.11.0-pre\";\nextern crate native = \"native#0.11.0-pre\";\nfn main() {}\n```\n\nThis is basically what you get when you recompile the expanded form of `fn main() {}` right now (I skipped prelude injection because it's not relevant here, and of course I added `#![no_std]` so you don't inject a third copy of the stdlibs).\n\nBut the following, which is what you get after fixing the `phase` attribute, doesn't compile:\n\n``` rust\n#![feature(phase)]\n#![no_std]\n#[phase(syntax,link)]\nextern crate std = \"std#0.11.0-pre\";\nextern crate native = \"native#0.11.0-pre\";\n#[phase(syntax,link)]\nextern crate std = \"std#0.11.0-pre\";\nextern crate native = \"native#0.11.0-pre\";\nfn main() {}\n```\n\nThe error message says:\n\n```\nwarning: using multiple versions of crate `std`\nexp.rs:4:1: 4:37 note: used here\nexp.rs:4 extern crate std = \"std#0.11.0-pre\";\n         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nnote: crate_id: std#0.11.0-pre\nexp.rs:7:1: 7:37 note: used here\nexp.rs:7 extern crate std = \"std#0.11.0-pre\";\n         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nnote: crate_id: std#0.11.0-pre\nerror: duplicate entry for `malloc`\nerror: duplicate entry for `free`\nerror: duplicate entry for `strdup_uniq`\nerror: duplicate entry for `eh_personality`\nerror: duplicate entry for `managed_heap`\nerror: duplicate entry for `gc`\nerror: aborting due to 6 previous errors\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43724056/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43778077",
    "html_url": "https://github.com/rust-lang/rust/pull/14320#issuecomment-43778077",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14320",
    "id": 43778077,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzc4MDc3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-21T16:11:27Z",
    "updated_at": "2014-05-21T16:11:27Z",
    "body": "That error is quite worrisome (I opened an issue, #14330).\n\nAlso, it appears I need to go to bed sooner, of course the modules are expanded and have their preludes injected later!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43778077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
