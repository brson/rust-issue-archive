[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27076239",
    "html_url": "https://github.com/rust-lang/rust/issues/10062#issuecomment-27076239",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10062",
    "id": 27076239,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDc2MjM5",
    "user": {
      "login": "miselin",
      "id": 73127,
      "node_id": "MDQ6VXNlcjczMTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/miselin",
      "html_url": "https://github.com/miselin",
      "followers_url": "https://api.github.com/users/miselin/followers",
      "following_url": "https://api.github.com/users/miselin/following{/other_user}",
      "gists_url": "https://api.github.com/users/miselin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/miselin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/miselin/subscriptions",
      "organizations_url": "https://api.github.com/users/miselin/orgs",
      "repos_url": "https://api.github.com/users/miselin/repos",
      "events_url": "https://api.github.com/users/miselin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/miselin/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-25T09:19:22Z",
    "updated_at": "2013-10-25T09:30:37Z",
    "body": "Investigated a bit and found libuv calls the process exit callback with an exit status and termination signal if they are present, as expected from `std::rt::uv::uvio` (see https://github.com/joyent/libuv/blob/d170c915c98fec671f99db6f8d6c15aeacc5d754/src/unix/process.c#L105).\n\nHowever, on OSX at least `WIFEXITED` returns false for a process terminated by signal. `WIFSIGNALED` returns true, so Rust's exit callback gets called with a zero `exit_status` but a non-zero `term_signal`.\n\nI added an assertion to the exit callback to confirm, which asserted that `term_signal` was zero if the `exit_status` was zero, and hit an assertion failure in my test (as expected):\n\n`failed in non-task context at 'assertion failed: term_signal == 0', /path/to/rust/src/libstd/rt/uv/uvio.rs:781`\n\nA possible solution could be to modify `uvio::RtioProcess::wait` to check for a non-zero `term_signal` and return it if the exit status is zero, or to do a bitwise operation to make it easier to identify that it is a signal number rather than an exit status.\n\nThis same behaviour is exhibited on Linux systems, but the test ends up considered failed, as it should, somehow on Linux with an explicit failure at `runtest.rs:805` (explicit `fail!()` caused by the code path stemming from `runtest.rs:155` - `ProcRes.status != 0`). Not sure how that happens or at least why it's different on OSX.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27076239/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27076714",
    "html_url": "https://github.com/rust-lang/rust/issues/10062#issuecomment-27076714",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10062",
    "id": 27076714,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDc2NzE0",
    "user": {
      "login": "miselin",
      "id": 73127,
      "node_id": "MDQ6VXNlcjczMTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/miselin",
      "html_url": "https://github.com/miselin",
      "followers_url": "https://api.github.com/users/miselin/followers",
      "following_url": "https://api.github.com/users/miselin/following{/other_user}",
      "gists_url": "https://api.github.com/users/miselin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/miselin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/miselin/subscriptions",
      "organizations_url": "https://api.github.com/users/miselin/orgs",
      "repos_url": "https://api.github.com/users/miselin/repos",
      "events_url": "https://api.github.com/users/miselin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/miselin/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-25T09:28:33Z",
    "updated_at": "2013-10-25T09:28:33Z",
    "body": "Linux segfaults also fail a run-fail because of `error: failure produced the wrong error code: 1` (as expected, as they are not returning the failure exit status), so somehow the Linux code path is getting a magical non-zero exit status on signal...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27076714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27105702",
    "html_url": "https://github.com/rust-lang/rust/issues/10062#issuecomment-27105702",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10062",
    "id": 27105702,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MTA1NzAy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-25T16:18:12Z",
    "updated_at": "2013-10-25T16:18:12Z",
    "body": "When I originally wrote the process bindings to libuv, I was dubious that I was doing the correct thing in propagating the child's error status, so it could very well be doing the wrong thing.\n\nWhat we should be doing, however, is somehow exposing this information via the `wait()` call or possibly raising on the `io_error` condition.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27105702/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27127053",
    "html_url": "https://github.com/rust-lang/rust/issues/10062#issuecomment-27127053",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10062",
    "id": 27127053,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MTI3MDUz",
    "user": {
      "login": "miselin",
      "id": 73127,
      "node_id": "MDQ6VXNlcjczMTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/miselin",
      "html_url": "https://github.com/miselin",
      "followers_url": "https://api.github.com/users/miselin/followers",
      "following_url": "https://api.github.com/users/miselin/following{/other_user}",
      "gists_url": "https://api.github.com/users/miselin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/miselin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/miselin/subscriptions",
      "organizations_url": "https://api.github.com/users/miselin/orgs",
      "repos_url": "https://api.github.com/users/miselin/repos",
      "events_url": "https://api.github.com/users/miselin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/miselin/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-25T21:22:38Z",
    "updated_at": "2013-10-25T21:22:38Z",
    "body": "It could be worth exposing `term_signal` as well as `exit_status` from the `wait()` call. There's also the `error` field in the exit callback, which is for errno returned by `execve(2)` if that fails.\n\nI've had a hunt around on Linux and a segfaulted test takes a completely different code path to get that non-zero exit status - one that I haven't yet found... It doesn't pass up exit status via libuv's exit callback, or any of the `task.death.on_exit`s that are set in uvio.\n\nMight switch into hunting the other direction - starting at runtest and going deeper through the call stack rather than trying to find its deepest point first.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27127053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
