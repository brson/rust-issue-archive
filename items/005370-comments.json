[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/19982938",
    "html_url": "https://github.com/rust-lang/rust/issues/5370#issuecomment-19982938",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/5370",
    "id": 19982938,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5OTgyOTM4",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-06-25T15:09:40Z",
    "updated_at": "2013-06-25T15:12:27Z",
    "body": "\bThe case documented by brson in the description _seems_ like it works now (after updating the `ReaderError` declaration to bind `'self` ... :\n\n```\n% cat ~/Dev/Rust/iss5370-a.rs\npub struct ReaderError<'self>(&'self mut int);\n\ncondition! {\n    pub reader_error: super::ReaderError -> bool;\n}\n\nfn main() {\n}\n% rustc --version\n/Users/fklock/opt/rust/bin/rustc 0.6 (e650399 2013-06-12 23:10:15 -0700)\nhost: x86_64-apple-darwin\n% rustc ~/Dev/Rust/iss5370-a.rs\nwarning: no debug symbols in executable (-arch x86_64)\n% ~/Dev/Rust/iss5370-a\n% \n```\n\n... however, my attempt to investigate more carefully (by putting in a _use_ of the condition) yielded similar problems:\n\n```\n% cat ~/Dev/Rust/iss5370-c.rs\npub struct ReaderError<'self>(&'self mut int);\n\ncondition! {\n    pub reader_error: super::ReaderError -> bool;\n}\n\nfn main() {\n    let mut x : int = 1;\n    do reader_error::cond.trap(|z| {\n        println(fmt!(\"Hi from handler I think z: %?\", z));\n        true\n    }).in {\n        println(\"Start of try\");\n\n        reader_error::cond.raise(ReaderError(&mut x));\n\n        println(\"Finis of try\");\n    }\n}\n% rustc ~/Dev/Rust/iss5370-c.rs\n/Users/fklock/Dev/Rust/iss5370-c.rs:15:45: 15:51 error: borrowed value does not live long enough\n/Users/fklock/Dev/Rust/iss5370-c.rs:15         reader_error::cond.raise(ReaderError(&mut x));\n                                                                                    ^~~~~~\nnote: borrowed pointer must be valid for the static lifetime...\n/Users/fklock/Dev/Rust/iss5370-c.rs:7:10: 19:1 note: ...but borrowed value is only valid for the block at 7:10\n/Users/fklock/Dev/Rust/iss5370-c.rs:7 fn main() {\n/Users/fklock/Dev/Rust/iss5370-c.rs:8     let mut x : int = 1;\n/Users/fklock/Dev/Rust/iss5370-c.rs:9     do reader_error::cond.trap(|z| {\n/Users/fklock/Dev/Rust/iss5370-c.rs:10         println(fmt!(\"Hi from handler I think z: %?\", z));\n/Users/fklock/Dev/Rust/iss5370-c.rs:11         true\n/Users/fklock/Dev/Rust/iss5370-c.rs:12     }).in {\n                                       ...\nerror: aborting due to previous error\n% \n```\n\nand:\n\n```\n% cat ~/Dev/Rust/iss5370-b.rs\npub struct ReaderError<'self>(&'self mut int);\n\ncondition! {\n    pub reader_error: super::ReaderError -> bool;\n}\n\nfn foo<'b>(err: ReaderError<'b>) -> bool {\n    reader_error::cond.raise(err)\n}\n\nfn main() {\n    let mut x : int = 2;\n    let mut y : int = 3;\n    let err = ReaderError(&x);\n    do reader_error::cond.trap(|z| {\n        println(fmt!(\"Hi from handler I think z: %?\", z));\n        true\n    }).in {\n        foo(err, &mut y);\n    }\n}\n% rustc ~/Dev/Rust/iss5370-b.rs\n/Users/fklock/Dev/Rust/iss5370-b.rs:8:29: 8:32 error: internal compiler error: Cannot relate bound region as subregion: br_anon(0)\n/Users/fklock/Dev/Rust/iss5370-b.rs:8     reader_error::cond.raise(err)\n                                                                   ^~~\n% \n```\n\nSo I am going to leave this ticket open for now.  The test case in the description should probably be revised to something that exposes the bug, but I do not like my current examples (they are the results of my playing around, and do not necessarily denote a sane scenario), so I am going to wait to come up with something better before revising the description.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/19982938/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22521036",
    "html_url": "https://github.com/rust-lang/rust/issues/5370#issuecomment-22521036",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/5370",
    "id": 22521036,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyNTIxMDM2",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-12T20:03:24Z",
    "updated_at": "2013-08-12T20:03:24Z",
    "body": "Re-nominating for milestone 3, feature-complete. I don't think this is backwards-incompatible.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22521036/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22714523",
    "html_url": "https://github.com/rust-lang/rust/issues/5370#issuecomment-22714523",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/5370",
    "id": 22714523,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyNzE0NTIz",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-15T17:11:43Z",
    "updated_at": "2013-08-15T17:11:43Z",
    "body": "accepted for backwards-compatible milestone\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22714523/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23756860",
    "html_url": "https://github.com/rust-lang/rust/issues/5370#issuecomment-23756860",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/5370",
    "id": 23756860,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNzU2ODYw",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-04T00:02:38Z",
    "updated_at": "2013-09-04T00:22:14Z",
    "body": "FYI, the examples I provided now consistently yield the error:\n\n```\n/Users/pnkfelix/Dev/Rust/iss5370-c.rs:4:22: 4:40 error: Illegal anonymous lifetime: only 'static is allowed here\n/Users/pnkfelix/Dev/Rust/iss5370-c.rs:4     pub reader_error: super::ReaderError -> bool;\n                                                              ^~~~~~~~~~~~~~~~~~\nerror: aborting due to previous error\n```\n\nI'm reviewing to see if this means we can close this ticket.\n\nUpdate (later): Well, duh, the title of the ticket says that this is still a problem.  so the question is whether we actually want to support this or not.  Since condition handlers are executed in the context of where they are raised, it sounds like we should be able to do this.  The current problem arises due to the implementation strategy we are using; I do not think it is intrinsic to the feature itself (of offering a condition system, at least not one where the handlers are executed in the dynamic context of where the raise occurred, so that all borrowed state should indeed still be available).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23756860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26073479",
    "html_url": "https://github.com/rust-lang/rust/issues/5370#issuecomment-26073479",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/5370",
    "id": 26073479,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MDczNDc5",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-10T17:26:28Z",
    "updated_at": "2013-10-10T17:26:28Z",
    "body": "cc #9795\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26073479/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/40362003",
    "html_url": "https://github.com/rust-lang/rust/issues/5370#issuecomment-40362003",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/5370",
    "id": 40362003,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMzYyMDAz",
    "user": {
      "login": "flaper87",
      "id": 13816,
      "node_id": "MDQ6VXNlcjEzODE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/13816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/flaper87",
      "html_url": "https://github.com/flaper87",
      "followers_url": "https://api.github.com/users/flaper87/followers",
      "following_url": "https://api.github.com/users/flaper87/following{/other_user}",
      "gists_url": "https://api.github.com/users/flaper87/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/flaper87/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/flaper87/subscriptions",
      "organizations_url": "https://api.github.com/users/flaper87/orgs",
      "repos_url": "https://api.github.com/users/flaper87/repos",
      "events_url": "https://api.github.com/users/flaper87/events{/privacy}",
      "received_events_url": "https://api.github.com/users/flaper87/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-14T12:54:06Z",
    "updated_at": "2014-04-14T12:54:06Z",
    "body": "`std::condition` and the `condition!` macro were removed as of #12039\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/40362003/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
