{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/7495",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7495/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7495/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7495/events",
  "html_url": "https://github.com/rust-lang/rust/pull/7495",
  "id": 16183850,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NjYzNjY0Nw==",
  "number": 7495,
  "title": "work towards removing headers from exchange allocations",
  "user": {
    "login": "thestinger",
    "id": 1505226,
    "node_id": "MDQ6VXNlcjE1MDUyMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thestinger",
    "html_url": "https://github.com/thestinger",
    "followers_url": "https://api.github.com/users/thestinger/followers",
    "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
    "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
    "organizations_url": "https://api.github.com/users/thestinger/orgs",
    "repos_url": "https://api.github.com/users/thestinger/repos",
    "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thestinger/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 3,
  "created_at": "2013-06-30T04:41:53Z",
  "updated_at": "2014-06-12T06:49:09Z",
  "closed_at": "2013-07-01T00:32:00Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/7495",
    "html_url": "https://github.com/rust-lang/rust/pull/7495",
    "diff_url": "https://github.com/rust-lang/rust/pull/7495.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/7495.patch",
    "merged_at": "2013-07-01T00:32:01Z"
  },
  "body": "With these changes, exchange allocator headers are never initialized, read or written to. Removing the header will now just involve updating the code in trans using an offset to only do it if the type contained is managed.\n\nThe only thing blocking removing the initialization of the last field in the header was ~fn since it uses it to store the dynamic size/types due to captures. I temporarily switched it to a `closure_exchange_alloc` lang item (it uses the same `exchange_free`) and #7496 is filed about removing that.\n\nSince the `exchange_free` call is now inlined all over the codebase, I don't think we should have an assert for null. It doesn't currently ever happen, but it would be fine if we started generating code that did do it. The `exchange_free` function also had a comment declaring that it must not fail, but a regular assert would cause a failure. I also removed the atomic counter because valgrind can already find these leaks, and we have valgrind bots now.\n\nNote that exchange free does not currently print an error an out-of-memory when it aborts, because our `io` code may allocate. We could probably get away with a `#[rust_stack]` call to a `stdio` function but it would be better to make a write system call.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/7495/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7495/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
