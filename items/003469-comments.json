[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8513438",
    "html_url": "https://github.com/rust-lang/rust/issues/3469#issuecomment-8513438",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3469",
    "id": 8513438,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MTM0Mzg=",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-12T23:15:16Z",
    "updated_at": "2012-09-12T23:15:16Z",
    "body": "It's an incompleteness, a bug. We're intending to support integer constant expressions in that context eventually. I'd pull up the github issue associated with it but their search engine fell over yesterday and still doesn't have indices back online. Will check again next time around.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8513438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13495910",
    "html_url": "https://github.com/rust-lang/rust/issues/3469#issuecomment-13495910",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3469",
    "id": 13495910,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNDk1OTEw",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-13T14:27:53Z",
    "updated_at": "2013-02-13T14:28:01Z",
    "body": "It would also be swell to allow values like enum discriminants, which would allow things like\n\n```\nenum A {\n  A1,\n  A2,\n  A_Count\n}\nlet foo: [int * A_Count];\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13495910/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13663463",
    "html_url": "https://github.com/rust-lang/rust/issues/3469#issuecomment-13663463",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3469",
    "id": 13663463,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNjYzNDYz",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-16T18:11:19Z",
    "updated_at": "2013-02-16T18:11:19Z",
    "body": "Regarding the enum trick, I'd prefer to have some way of getting the max discriminant of an enum. I do this trick of adding an extra value in C all the time but it's annoying because it foils exhaustiveness checks.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13663463/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14064255",
    "html_url": "https://github.com/rust-lang/rust/issues/3469#issuecomment-14064255",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3469",
    "id": 14064255,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MDY0MjU1",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-25T18:43:31Z",
    "updated_at": "2013-02-25T18:43:31Z",
    "body": "So I have a patch that addresses this, problem is that it only half works. Simple constant expressions like `2*3` or `32/2` work but attempting to use a previously defined constant fails (`Non-constant path in constant expr`). This seems to be because `const_eval::eval_const_expr` can't find the expr in the `def_map` when called in `typeck::astconv`. I'm not sure about order of things in that stage of the compiler so I'm a bit lost in how to approach this.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14064255/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14076830",
    "html_url": "https://github.com/rust-lang/rust/issues/3469#issuecomment-14076830",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3469",
    "id": 14076830,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MDc2ODMw",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-25T21:29:05Z",
    "updated_at": "2013-02-25T21:29:05Z",
    "body": "It looks the astconv stuff might happen in the collect pass, which directly precedes the resolve pass which does record information about constants in def_map.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14076830/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14084079",
    "html_url": "https://github.com/rust-lang/rust/issues/3469#issuecomment-14084079",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3469",
    "id": 14084079,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MDg0MDc5",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-25T23:50:09Z",
    "updated_at": "2013-02-25T23:50:09Z",
    "body": "So trying to avoid the const_eval in astconv by propagating `@ast::expr` down through `ty::vstore_fixed` doesn't work since it necessitates creating `expr` in various places in trans which results in errors like\n\n```\nexpected `[u8]/8` but found `[u8]/8` ([] storage differs: expected 8 but found 8)\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14084079/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14480310",
    "html_url": "https://github.com/rust-lang/rust/issues/3469#issuecomment-14480310",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3469",
    "id": 14480310,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NDgwMzEw",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-03-06T03:14:35Z",
    "updated_at": "2013-03-06T03:14:35Z",
    "body": "Thanks to some help from pcwalton, I have this working properly now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14480310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14495371",
    "html_url": "https://github.com/rust-lang/rust/issues/3469#issuecomment-14495371",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3469",
    "id": 14495371,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NDk1Mzcx",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-03-06T11:49:40Z",
    "updated_at": "2013-03-06T11:49:40Z",
    "body": "@pcwalton @graydon regarding the set of expressions that can be included in constants, I think there are issues around field projection and the like because we need to evaluate constants during the \"collect\" of type checking.  \n\nThat is, type checking first iterates over all struct declarations and converts them into types.  It then descends into function bodies and expressions to check those.  The tricky part here is that checking a function body / expression requires the types for the struct declarations and so forth.  In particular, imagine we have to type check something like `x.f` --- we need to compute the type of `x`, but if it has a struct type, for example, we need to lookup that struct and figure out the declared type of the field `f`.  Right now the code that type checks a constant expression is the same as the code that type checks a function body, so it e.g. assumes that the types of structs are available.  \n\nBasically this means that either the code that type checks expressions will have to be parameterized over what phase it is operating in (hard and annoying but not impossible), or else we will wind up having to duplicate the code that type checks constants so that when we are evaluating constants to compute the final types we don't require that type conversion has taken place.  \n\nThus far we have taken the duplication path.  If you look in `eval_const.rs`, you will see there that the function which evaluates constants basically duplicates the type rules, which is fine because it adds additional logic.  You'll also see that it aborts for things like field projection.  So in essence we already have established a subset of constant expressions, though I don't think failure is handled gracefully.\n\nIf we are duplicating, it makes sense from a _practical perspective_ to duplicate as little as possible.  Duplicating integer arithmetic and so on seems pretty straightforward.  I am not sure though if there is a theoretical reason that we can't handle more complex expressions, but the logic involved is fairly complex (think autoderef etc).\n\nIt is not really clear to me when it is necessary to have field projection (`a.b`), pointer dereferences (`*a`), indexing (`a[b]`) in constant expressions.  I feel like any example that makes use of such things can be written more clearly by having an intermediate constant for the value you are trying to obtain.  \n\nDoes this make sense?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14495371/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/15392750",
    "html_url": "https://github.com/rust-lang/rust/issues/3469#issuecomment-15392750",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3469",
    "id": 15392750,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MzkyNzUw",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-03-25T13:24:36Z",
    "updated_at": "2013-03-25T13:24:36Z",
    "body": "The original issue as described was resolved by #5112.  There appears to be some remaining questions of how expressive we should allow constant expressions to be, but I do not think this ticket is a good place for such discussion to continue; closing.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/15392750/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
