[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/36426819",
    "html_url": "https://github.com/rust-lang/rust/issues/12642#issuecomment-36426819",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12642",
    "id": 36426819,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDI2ODE5",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-03-01T15:04:42Z",
    "updated_at": "2014-03-01T15:04:42Z",
    "body": "How about we have #[derive(Compact as $name)] or something along those lines, which automatically generates some implementations, much like the other derives. For example,\n\n``` rust\n#[deriving(Compact as SmallerX)]\nenum X { Foo(Option<bool>), Bar(bool) }\n```\n\nwould generate the following:\n\n``` rust\nstruct SmallerX { priv data: [u8,..1] }\n\nimpl Compact<SmallerX> for X {\n  fn compact(self)->SmallerX {\n    let mut result = SmallerX{data:[0u8]};\n    match self {\n      Foo(x) => {\n        match x {\n          Some(y) => {\n            match y {\n              true => result.data[0] = 0,\n              false => result.data[0] = 1,\n            }\n          },\n          None => result.data[0] = 2,\n        }\n      },\n      Bar(x) => {\n        match x {\n          true => result.data[0] = 3,\n          false => result.data[0] = 4,\n        }\n      },\n    }\n    result\n  }\n}\n\nimpl SmallerX {\n  fn uncompact(self) -> X {\n    match self.data[0] {\n      0 => Foo(Some(true)),\n      1 => Foo(Some(false)),\n      2 => Foo(None),\n      3 => Bar(true),\n      4 => Bar(false),\n    }\n  }\n}\n```\n\nOr something along these lines. I'm sure someone can come up with an algorithm that can compress at least the enum headers somewhat intelligently. You do `X.compact()` when you store it, and `SmallerX.uncompact()` when you want your `X` back.\n\nThe nice thing about this approach would be that no changes need be made to the IR-generation; and users could manually implement `trait Compact<T>` if they prefer. Some care must be taken when compacting a type that contains borrowed pointers, and the compact types will need to implement Drop to automatically unpack themselves when they contain non-POD types.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/36426819/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/36428626",
    "html_url": "https://github.com/rust-lang/rust/issues/12642#issuecomment-36428626",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12642",
    "id": 36428626,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDI4NjI2",
    "user": {
      "login": "glaebhoerl",
      "id": 1216629,
      "node_id": "MDQ6VXNlcjEyMTY2Mjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1216629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glaebhoerl",
      "html_url": "https://github.com/glaebhoerl",
      "followers_url": "https://api.github.com/users/glaebhoerl/followers",
      "following_url": "https://api.github.com/users/glaebhoerl/following{/other_user}",
      "gists_url": "https://api.github.com/users/glaebhoerl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glaebhoerl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glaebhoerl/subscriptions",
      "organizations_url": "https://api.github.com/users/glaebhoerl/orgs",
      "repos_url": "https://api.github.com/users/glaebhoerl/repos",
      "events_url": "https://api.github.com/users/glaebhoerl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glaebhoerl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-03-01T16:14:16Z",
    "updated_at": "2014-03-01T16:14:16Z",
    "body": "@Thiez What about e.g. the `Flags` struct? It should result in the same code as current flags enum approaches in Rust/C: `flags.is_quick` should compile to `flags & IsQuick`. With the `deriving(Compact)` approach you would have to pack/unpack the entire struct every time you want to access a field, and I'm not sure how well LLVM could optimize all of that away.\n\n(If the semantics could stay the same, according to the scenario at the bottom of the OP, then I was thinking `#[compact]` would be analogous to the [`#[packed]` attribute](https://github.com/mozilla/rust/commit/cad2260) we already have as something which only affects the representation of the given item.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/36428626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/56625101",
    "html_url": "https://github.com/rust-lang/rust/issues/12642#issuecomment-56625101",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12642",
    "id": 56625101,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NjI1MTAx",
    "user": {
      "login": "rust-highfive",
      "id": 7378925,
      "node_id": "MDQ6VXNlcjczNzg5MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7378925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rust-highfive",
      "html_url": "https://github.com/rust-highfive",
      "followers_url": "https://api.github.com/users/rust-highfive/followers",
      "following_url": "https://api.github.com/users/rust-highfive/following{/other_user}",
      "gists_url": "https://api.github.com/users/rust-highfive/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rust-highfive/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rust-highfive/subscriptions",
      "organizations_url": "https://api.github.com/users/rust-highfive/orgs",
      "repos_url": "https://api.github.com/users/rust-highfive/repos",
      "events_url": "https://api.github.com/users/rust-highfive/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rust-highfive/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-24T05:00:40Z",
    "updated_at": "2014-09-24T05:00:40Z",
    "body": "This issue has been moved to the RFCs repo: rust-lang/rfcs#311\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/56625101/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
