{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/5640",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/5640/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/5640/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/5640/events",
  "html_url": "https://github.com/rust-lang/rust/pull/5640",
  "id": 12638628,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NDkwMDE0NQ==",
  "number": 5640,
  "title": "libsyntax: Refactor deriving to reduce boilerplate required & derive Ord, TotalOrd and TotalEq",
  "user": {
    "login": "huonw",
    "id": 1203825,
    "node_id": "MDQ6VXNlcjEyMDM4MjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/huonw",
    "html_url": "https://github.com/huonw",
    "followers_url": "https://api.github.com/users/huonw/followers",
    "following_url": "https://api.github.com/users/huonw/following{/other_user}",
    "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
    "organizations_url": "https://api.github.com/users/huonw/orgs",
    "repos_url": "https://api.github.com/users/huonw/repos",
    "events_url": "https://api.github.com/users/huonw/events{/privacy}",
    "received_events_url": "https://api.github.com/users/huonw/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 6,
  "created_at": "2013-03-31T03:26:29Z",
  "updated_at": "2014-06-14T20:15:02Z",
  "closed_at": "2013-04-12T12:30:58Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/5640",
    "html_url": "https://github.com/rust-lang/rust/pull/5640",
    "diff_url": "https://github.com/rust-lang/rust/pull/5640.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/5640.patch",
    "merged_at": null
  },
  "body": "This refactors much of the ast generation required for `deriving` instances into a common interface, so that new instances only need to specify what they do with the actual data, rather than worry about naming function arguments and extracting fields from structs and enum. (This all happens in `generic.rs`. I've tried to make sure it was well commented and explained, since it's a little abstract at points, but I'm sure it's still a little confusing.)\n\nIt makes instances like the comparison traits and `Clone` short and easy to write.\n\nCaveats:\n- Not surprisingly, this slows the expansion pass (in some cases, dramatically, specifically deriving Ord or TotalOrd on enums with many variants).   However, this shouldn't be too concerning, since in a more realistic case (compiling `core.rc`) the time increased by 0.01s, which isn't worth mentioning. And, it possibly slows type checking very slightly (about 2% worst case), but I'm having trouble measuring it (and I don't understand why this would happen). I think this could be resolved by using traits and encoding it all in the type system so that monomorphisation handles everything, but that would probably be a little tricky to arrange nicely, reduce flexibility and make compiling rustc take longer. (Maybe some judicious use of `#[inline(always)]` would help too; I'll have a bit of a play with it.)\n- The abstraction is not currently powerful enough for:\n  - `IterBytes`: doesn't support arguments of type other than `&Self`.\n  - `Encodable`/`Decodable` (#5090): doesn't support traits with parameters.\n  - `Rand` & `FromStr`; doesn't support static functions and arguments of type other than `&Self`.\n  - `ToStr`: I don't think it supports returning `~str` yet, but I haven't actually tried.\n  \n  (The last 3 are traits that might be nice to have: the derived `ToStr`/`FromStr` could just read/write the same format as `fmt!(\"%?\", x)`, like `Show` and `Read` in Haskell.)\n  \n  I have ideas to resolve all of these, but I feel like it would essentially be a simpler version of the `mt` & `ty_` parts of `ast.rs`, and I'm not sure if the simplification is worth having 2 copies of similar code.\n\nAlso, makes Ord, TotalOrd and TotalEq derivable (closes #4269, #5588 and #5589), although a snapshot is required before they can be used in the rust repo.\n\nIf there is anything that is unclear (or incorrect) either here or in the code, I'd like to get it pointed out now, so I can explain/fix it while I'm still intimately familiar with the code.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/5640/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/5640/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
