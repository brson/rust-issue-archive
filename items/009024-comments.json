[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23980023",
    "html_url": "https://github.com/rust-lang/rust/issues/9024#issuecomment-23980023",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9024",
    "id": 23980023,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzOTgwMDIz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-07T02:34:39Z",
    "updated_at": "2013-09-07T02:35:06Z",
    "body": "Interesting. If you remove the `alloca` of `%s` at the top, the `memcpy` at the end, and store directly into `%0` instead of `%s`, then the bounds check will be eliminated.\n\nFor some reason, it appears that the last `memcpy` in the `match_case` block is preventing the `cond` block from being eliminated...\n\nI was testing this by passing the following code to llvm's `opt` command\n\n(I added the `noalias` attributes myself, didn't help)\n\n```\n; ModuleID = 'foo.rc'\n\n%tydesc = type { i64, i64, void ({}*, i8*)*, void ({}*, i8*)*, void ({}*, i8*)*, void ({}*, i8*)*, i64, { i8*, i64 } }\n\ndeclare void @llvm.memcpy.p0i8.p0i8.i64(i8* nocapture, i8* nocapture readonly, i64, i32, i1)\n\ndeclare void @llvm.memset.p0i8.i64(i8* nocapture, i8, i64, i32, i1)\n\ndefine void @_ZN3add16_d492e97021e66524v0.0E([3 x float]* nocapture noalias, {\n        i64, %tydesc*, i8*, i8*, i8 }* nocapture readnone, [3 x float]*\n        nocapture noalias readonly, [3 x float]* nocapture noalias readonly) {\n\"function top level\":\n  %s = alloca [3 x float], align 4\n  %4 = bitcast [3 x float]* %s to i8*\n  call void @llvm.memset.p0i8.i64(i8* %4, i8 0, i64 12, i32 4, i1 false)\n  br label %match_else\n\nmatch_else:                                       ; preds = %\"function top level\", %next6\n  %.sroa.013.0.load1922 = phi i64 [ 0, %\"function top level\" ], [ %8, %next6 ]\n  %5 = shl i64 %.sroa.013.0.load1922, 2\n  %6 = icmp ugt i64 %.sroa.013.0.load1922, 2\n  br i1 %6, label %cond, label %next6\n\nmatch_case:                                       ; preds = %next6\n  %7 = bitcast [3 x float]* %0 to i8*\n  call void @llvm.memcpy.p0i8.p0i8.i64(i8* %7, i8* %4, i64 12, i32 4, i1 false)\n  ret void\n\ncond:                                             ; preds = %match_else\n    ret void\n\nnext6:                                            ; preds = %match_else\n  %8 = add i64 %.sroa.013.0.load1922, 1\n  %9 = getelementptr inbounds [3 x float]* %3, i64 0, i64 %.sroa.013.0.load1922\n  %10 = getelementptr inbounds [3 x float]* %2, i64 0, i64 %.sroa.013.0.load1922\n  %11 = load float* %9, align 4\n  %12 = load float* %10, align 4\n  %13 = fadd float %11, %12\n  %14 = getelementptr inbounds [3 x float]* %s, i64 0, i64 %.sroa.013.0.load1922\n  store float %13, float* %14, align 4\n  %15 = icmp slt i64 %8, 3\n  br i1 %15, label %match_else, label %match_case\n}\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23980023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24635104",
    "html_url": "https://github.com/rust-lang/rust/issues/9024#issuecomment-24635104",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9024",
    "id": 24635104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NjM1MTA0",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-18T01:27:47Z",
    "updated_at": "2013-09-18T01:27:47Z",
    "body": "This is still an issue despite the return value being tagged as `sret` and `noalias` now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24635104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32122137",
    "html_url": "https://github.com/rust-lang/rust/issues/9024#issuecomment-32122137",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9024",
    "id": 32122137,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTIyMTM3",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-12T13:12:02Z",
    "updated_at": "2014-01-12T13:12:02Z",
    "body": "This looks like a regression that happened somewhere between LLVM 3.2 and 3.3. I reduced the code to just a loop with the bounds check:\n\n``` llvm\n; ModuleID = '<stdin>'\n\ndefine void @test() {\n\"function top level\":\n  br label %loop\n\nloop:                                             ; preds = %body, %\"function top level\"\n  %0 = phi i64 [ 0, %\"function top level\" ], [ %2, %body ]\n  %1 = icmp ugt i64 %0, 2\n  br i1 %1, label %fail, label %body\n\nfail:                                             ; preds = %loop\n  tail call void @bounds_fail()\n  unreachable\n\nbody:                                             ; preds = %loop\n  %2 = add i64 %0, 1\n  %3 = icmp slt i64 %2, 3\n  br i1 %3, label %loop, label %out\n\nout:                                              ; preds = %body\n  ret void\n}\n\ndeclare void @bounds_fail()\n```\n\nand `opt` from LLVM 3.2 optimizes that to:\n\n``` llvm\n; ModuleID = '<stdin>'\n\ndefine void @test() {\nbody.2:\n  ret void\n}\n```\n\nbut `opt` from LLVM 3.3, 3.4, and a 3.5 snapshot as of svn197556 leave it unchanged.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32122137/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32123403",
    "html_url": "https://github.com/rust-lang/rust/issues/9024#issuecomment-32123403",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9024",
    "id": 32123403,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTIzNDAz",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-12T14:16:03Z",
    "updated_at": "2014-01-12T14:16:03Z",
    "body": "Filed a bug against LLVM at http://llvm.org/bugs/show_bug.cgi?id=18449\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32123403/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/36461017",
    "html_url": "https://github.com/rust-lang/rust/issues/9024#issuecomment-36461017",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9024",
    "id": 36461017,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDYxMDE3",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-03-02T18:03:37Z",
    "updated_at": "2014-03-02T18:03:37Z",
    "body": "Looks like this is fixed. Using `rustc 0.10-pre (3d117cf 2014-03-01 03:06:31 -0800)` I get:\n\n``` rust\n; Function Attrs: uwtable\ndefine void @_ZN6addf3220h7431f4d506cb9520daa4v0.0E([3 x float]* noalias nocapture sret, [3 x float]* noalias nocapture readonly, [3 x float]* noalias nocapture readonly) unnamed_addr #1 {\nentry-block:\n  %s = alloca [3 x float], align 4\n  %3 = bitcast [3 x float]* %s to i8*\n  call void @llvm.memset.p0i8.i64(i8* %3, i8 0, i64 12, i32 4, i1 false)\n  br label %next7\n\nnext7:                                            ; preds = %next7, %entry-block\n  %4 = phi i64 [ 0, %entry-block ], [ %5, %next7 ]\n  %5 = add i64 %4, 1\n  %6 = getelementptr inbounds [3 x float]* %2, i64 0, i64 %4\n  %7 = getelementptr inbounds [3 x float]* %1, i64 0, i64 %4\n  %8 = load float* %6, align 4\n  %9 = load float* %7, align 4\n  %10 = fadd float %8, %9\n  %11 = getelementptr inbounds [3 x float]* %s, i64 0, i64 %4\n  store float %10, float* %11, align 4\n  %12 = icmp slt i64 %5, 3\n  br i1 %12, label %next7, label %join9\n\njoin9:                                            ; preds = %next7\n  %13 = bitcast [3 x float]* %0 to i8*\n  call void @llvm.memcpy.p0i8.p0i8.i64(i8* %13, i8* %3, i64 12, i32 4, i1 false)\n  ret void\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/36461017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
