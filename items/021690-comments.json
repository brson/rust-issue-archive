[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71769337",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-71769337",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 71769337,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzY5MzM3",
    "user": {
      "login": "kmcallister",
      "id": 444997,
      "node_id": "MDQ6VXNlcjQ0NDk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kmcallister",
      "html_url": "https://github.com/kmcallister",
      "followers_url": "https://api.github.com/users/kmcallister/followers",
      "following_url": "https://api.github.com/users/kmcallister/following{/other_user}",
      "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions",
      "organizations_url": "https://api.github.com/users/kmcallister/orgs",
      "repos_url": "https://api.github.com/users/kmcallister/repos",
      "events_url": "https://api.github.com/users/kmcallister/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kmcallister/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-28T02:14:51Z",
    "updated_at": "2015-01-28T02:14:51Z",
    "body": "Inline IR was discussed on #15180. Another option is `extern \"llvm-intrinsic\" { ... }` which I vaguely think we had at some point.  If we added more intrinsics to `std::intrinsics` would that be sufficient?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71769337/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71806084",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-71806084",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 71806084,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxODA2MDg0",
    "user": {
      "login": "mpdn",
      "id": 448023,
      "node_id": "MDQ6VXNlcjQ0ODAyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/448023?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mpdn",
      "html_url": "https://github.com/mpdn",
      "followers_url": "https://api.github.com/users/mpdn/followers",
      "following_url": "https://api.github.com/users/mpdn/following{/other_user}",
      "gists_url": "https://api.github.com/users/mpdn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mpdn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mpdn/subscriptions",
      "organizations_url": "https://api.github.com/users/mpdn/orgs",
      "repos_url": "https://api.github.com/users/mpdn/repos",
      "events_url": "https://api.github.com/users/mpdn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mpdn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-28T09:40:52Z",
    "updated_at": "2015-01-28T09:40:52Z",
    "body": "Yeah, adding it as a function in `std::intrinsics` could definitely work as well.\n\nThere are [a few different fast math flags](http://llvm.org/docs/LangRef.html#fast-math-flags), but the `fast` flag is probably the most important as it implies all the other flags. Adding all of them would be unreasonable if using intrinsic functions, but I don't think all of them are necessary.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71806084/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131848502",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-131848502",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 131848502,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTg0ODUwMg==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-17T14:48:41Z",
    "updated_at": "2015-08-17T14:48:41Z",
    "body": "This [forum thread ](https://users.rust-lang.org/t/how-to-zip-two-slices-efficiently/2048/2) has examples of loops that llvm can vectorize well for integers, but doesn't for floats (a dot product).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131848502/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307093406",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-307093406",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 307093406,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzA5MzQwNg==",
    "user": {
      "login": "kornelski",
      "id": 72159,
      "node_id": "MDQ6VXNlcjcyMTU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kornelski",
      "html_url": "https://github.com/kornelski",
      "followers_url": "https://api.github.com/users/kornelski/followers",
      "following_url": "https://api.github.com/users/kornelski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions",
      "organizations_url": "https://api.github.com/users/kornelski/orgs",
      "repos_url": "https://api.github.com/users/kornelski/repos",
      "events_url": "https://api.github.com/users/kornelski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kornelski/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-08T12:50:37Z",
    "updated_at": "2020-01-20T15:12:46Z",
    "body": "\r\nI've prototyped it using a newtype: https://gitlab.com/kornelski/ffast-math (https://play.rust-lang.org/?gist=d516771d1d002f740cc9bf6eb5cacdf0&version=nightly&backtrace=0)\r\n\r\nIt works in simple cases, but the newtype solution is insufficient:\r\n\r\n- it doesn't work with floating-point literals. That's a huge pain when converting programs to this newtype.\r\n- it doesn't work with the `as` operator, and a trait to make that possible has been rejected before.\r\n- the wrapper type and extra level of indirection affects inlining of code using it. I've found some large functions where the newtype was slower than regular float, but not because of float math, but because other structs and calls around it weren't as optimized. I wasn't able to reproduce it in simple cases, so I'm not sure what exactly is going on.\r\n\r\nSo I'm very keen on seeing it supported natively in Rust.\r\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307093406/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307180140",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-307180140",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 307180140,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzE4MDE0MA==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-08T17:57:39Z",
    "updated_at": "2017-06-08T17:57:39Z",
    "body": "@pornel The issue #24963 had a test case where a newtype impacted vectorization. That example was fixed (great!), sounds like the bug is probably still visible in similar code.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307180140/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307202197",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-307202197",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 307202197,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzIwMjE5Nw==",
    "user": {
      "login": "pedrocr",
      "id": 246322,
      "node_id": "MDQ6VXNlcjI0NjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/246322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pedrocr",
      "html_url": "https://github.com/pedrocr",
      "followers_url": "https://api.github.com/users/pedrocr/followers",
      "following_url": "https://api.github.com/users/pedrocr/following{/other_user}",
      "gists_url": "https://api.github.com/users/pedrocr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pedrocr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pedrocr/subscriptions",
      "organizations_url": "https://api.github.com/users/pedrocr/orgs",
      "repos_url": "https://api.github.com/users/pedrocr/repos",
      "events_url": "https://api.github.com/users/pedrocr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pedrocr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-08T19:22:50Z",
    "updated_at": "2017-06-08T22:40:25Z",
    "body": "I've tried -ffast-math in my C vs Rust benchmark of some graphics code:\r\n\r\nhttps://github.com/pedrocr/rustc-math-bench\r\n\r\nIn the C code it's a ~20% improvement in clang but no benefit with GCC. In both cases it returns a wrong result and the math is extremely simple (multiplying a vector by a matrix). According to this:\r\n\r\nhttps://stackoverflow.com/questions/38978951/can-ffast-math-be-safely-used-on-a-typical-project#38981307\r\n\r\n`-ffast-math` is generally too unsafe for normal usage as it implies some strange things (e.g., NaN checks always return false). So it seems sensible to have a way to opt-in only to the more benign ones.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307202197/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307222383",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-307222383",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 307222383,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzIyMjM4Mw==",
    "user": {
      "login": "kornelski",
      "id": 72159,
      "node_id": "MDQ6VXNlcjcyMTU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kornelski",
      "html_url": "https://github.com/kornelski",
      "followers_url": "https://api.github.com/users/kornelski/followers",
      "following_url": "https://api.github.com/users/kornelski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions",
      "organizations_url": "https://api.github.com/users/kornelski/orgs",
      "repos_url": "https://api.github.com/users/kornelski/repos",
      "events_url": "https://api.github.com/users/kornelski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kornelski/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-08T20:46:06Z",
    "updated_at": "2017-06-08T20:50:08Z",
    "body": "@pedrocr Your benchmark has a loss of precision in `sum` regardless of fast-math mode. Both slow and fast give wrong result compared to summation using `double sum`. \r\n\r\nWith `double` for the `sum` and you'll get correct result, even with `-ffast-math`.\r\n\r\nYou get significantly different sum with `float sum`, because fast-math gives you a small systemic rounding error, which accumulates over *100 million* additions.\r\n\r\nAll values from matrix multiplication are the same to at least 6 digits (I've diffed `printf(\"%f\", out[i])` of all values and they're all the same).\r\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307222383/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307244726",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-307244726",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 307244726,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzI0NDcyNg==",
    "user": {
      "login": "pedrocr",
      "id": 246322,
      "node_id": "MDQ6VXNlcjI0NjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/246322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pedrocr",
      "html_url": "https://github.com/pedrocr",
      "followers_url": "https://api.github.com/users/pedrocr/followers",
      "following_url": "https://api.github.com/users/pedrocr/following{/other_user}",
      "gists_url": "https://api.github.com/users/pedrocr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pedrocr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pedrocr/subscriptions",
      "organizations_url": "https://api.github.com/users/pedrocr/orgs",
      "repos_url": "https://api.github.com/users/pedrocr/repos",
      "events_url": "https://api.github.com/users/pedrocr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pedrocr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-08T22:28:38Z",
    "updated_at": "2017-06-08T22:29:03Z",
    "body": "@pornel thanks, fixed here:\r\n\r\nhttps://github.com/pedrocr/rustc-math-bench/commit/8169fa3901b03af5628def8111f01e347ba8af30\r\n\r\nThe benchmark results are fine though, the sum is only used as a checksum. Here are the averages of three runs in ms/megapixel:\r\n\r\nCompiler | -O3 -march=native | -O3 -march=native -ffast-math\r\n--- | --- | ---\r\nclang 3.8.0-2ubuntu4 | 6,91 | 5,40 (-22%)\r\ngcc 5.4.0-6ubuntu1~16.04.4 | 5,71 | 5,85 (+2%)\r\n\r\nSo as I mentioned before clang/llvm gets a good benefit from ffast-math but not gcc. I'd say making sure things like `is_normal()` still work is very important but at least on llvm it helps to be able to enable ffast-math.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307244726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307246076",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-307246076",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 307246076,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzI0NjA3Ng==",
    "user": {
      "login": "pedrocr",
      "id": 246322,
      "node_id": "MDQ6VXNlcjI0NjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/246322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pedrocr",
      "html_url": "https://github.com/pedrocr",
      "followers_url": "https://api.github.com/users/pedrocr/followers",
      "following_url": "https://api.github.com/users/pedrocr/following{/other_user}",
      "gists_url": "https://api.github.com/users/pedrocr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pedrocr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pedrocr/subscriptions",
      "organizations_url": "https://api.github.com/users/pedrocr/orgs",
      "repos_url": "https://api.github.com/users/pedrocr/repos",
      "events_url": "https://api.github.com/users/pedrocr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pedrocr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-08T22:35:59Z",
    "updated_at": "2017-06-08T22:41:17Z",
    "body": "I've suggested it would make sense to expose `-ffast-math` using the target-feature mechanisms:\r\n\r\nhttps://internals.rust-lang.org/t/pre-rfc-stabilization-of-target-feature/5176/23",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307246076/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 1,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307253061",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-307253061",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 307253061,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzI1MzA2MQ==",
    "user": {
      "login": "kornelski",
      "id": 72159,
      "node_id": "MDQ6VXNlcjcyMTU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kornelski",
      "html_url": "https://github.com/kornelski",
      "followers_url": "https://api.github.com/users/kornelski/followers",
      "following_url": "https://api.github.com/users/kornelski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions",
      "organizations_url": "https://api.github.com/users/kornelski/orgs",
      "repos_url": "https://api.github.com/users/kornelski/repos",
      "events_url": "https://api.github.com/users/kornelski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kornelski/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-08T23:18:26Z",
    "updated_at": "2017-06-08T23:18:26Z",
    "body": "Rust has [fast math intrinsics](https://doc.rust-lang.org/core/intrinsics/fn.fadd_fast.html), so the fast math behavior could be limited to [a specific type](https://internals.rust-lang.org/t/avoiding-partialord-problems-by-introducing-fast-finite-floating-point-types/5376) or selected functions, without forcing the whole program into it. ",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307253061/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307463239",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-307463239",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 307463239,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzQ2MzIzOQ==",
    "user": {
      "login": "pedrocr",
      "id": 246322,
      "node_id": "MDQ6VXNlcjI0NjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/246322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pedrocr",
      "html_url": "https://github.com/pedrocr",
      "followers_url": "https://api.github.com/users/pedrocr/followers",
      "following_url": "https://api.github.com/users/pedrocr/following{/other_user}",
      "gists_url": "https://api.github.com/users/pedrocr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pedrocr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pedrocr/subscriptions",
      "organizations_url": "https://api.github.com/users/pedrocr/orgs",
      "repos_url": "https://api.github.com/users/pedrocr/repos",
      "events_url": "https://api.github.com/users/pedrocr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pedrocr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-09T18:20:36Z",
    "updated_at": "2017-06-09T18:20:36Z",
    "body": "A usable solution for my use cases would probably be to have the vector types in the simd crate be the types that allow the opt-in to ffast-math. That way there's only one type I need to conciously convert the code to for speedups. But for the general solution of in normal code having to swap types seems cumbersome. But maybe just doing `return val as f32` when `val` is an `f32fast` type isn't that bad.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/307463239/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/321586324",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-321586324",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 321586324,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTU4NjMyNA==",
    "user": {
      "login": "pedrocr",
      "id": 246322,
      "node_id": "MDQ6VXNlcjI0NjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/246322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pedrocr",
      "html_url": "https://github.com/pedrocr",
      "followers_url": "https://api.github.com/users/pedrocr/followers",
      "following_url": "https://api.github.com/users/pedrocr/following{/other_user}",
      "gists_url": "https://api.github.com/users/pedrocr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pedrocr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pedrocr/subscriptions",
      "organizations_url": "https://api.github.com/users/pedrocr/orgs",
      "repos_url": "https://api.github.com/users/pedrocr/repos",
      "events_url": "https://api.github.com/users/pedrocr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pedrocr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-08-10T15:28:49Z",
    "updated_at": "2017-08-10T15:28:49Z",
    "body": "Created a pre-RFC discussion on internals to try and get a discussion on the best way to do this:\r\n\r\nhttps://internals.rust-lang.org/t/pre-rfc-whats-the-best-way-to-implement-ffast-math/5740",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/321586324/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/455865968",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-455865968",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 455865968,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTg2NTk2OA==",
    "user": {
      "login": "robsmith11",
      "id": 22622548,
      "node_id": "MDQ6VXNlcjIyNjIyNTQ4",
      "avatar_url": "https://avatars.githubusercontent.com/u/22622548?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/robsmith11",
      "html_url": "https://github.com/robsmith11",
      "followers_url": "https://api.github.com/users/robsmith11/followers",
      "following_url": "https://api.github.com/users/robsmith11/following{/other_user}",
      "gists_url": "https://api.github.com/users/robsmith11/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/robsmith11/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robsmith11/subscriptions",
      "organizations_url": "https://api.github.com/users/robsmith11/orgs",
      "repos_url": "https://api.github.com/users/robsmith11/repos",
      "events_url": "https://api.github.com/users/robsmith11/events{/privacy}",
      "received_events_url": "https://api.github.com/users/robsmith11/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2019-01-20T13:19:37Z",
    "updated_at": "2019-01-20T13:19:37Z",
    "body": "Is there a current recommended approach to using fast-math optimizations in rust nightly?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/455865968/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/545985469",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-545985469",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 545985469,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NTk4NTQ2OQ==",
    "user": {
      "login": "jeffvandyke",
      "id": 6729124,
      "node_id": "MDQ6VXNlcjY3MjkxMjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6729124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jeffvandyke",
      "html_url": "https://github.com/jeffvandyke",
      "followers_url": "https://api.github.com/users/jeffvandyke/followers",
      "following_url": "https://api.github.com/users/jeffvandyke/following{/other_user}",
      "gists_url": "https://api.github.com/users/jeffvandyke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jeffvandyke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jeffvandyke/subscriptions",
      "organizations_url": "https://api.github.com/users/jeffvandyke/orgs",
      "repos_url": "https://api.github.com/users/jeffvandyke/repos",
      "events_url": "https://api.github.com/users/jeffvandyke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jeffvandyke/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2019-10-24T15:57:54Z",
    "updated_at": "2019-10-24T17:13:37Z",
    "body": "If it helps, a good benchmark comparison article between C++ and Rust floating point optimizations ([link](https://www.reidatcheson.com/hpc/architecture/performance/rust/c++/2019/10/19/measure-cache.html)) inside loops was written recently (Oct 19), with a good [Hacker News discussion](https://news.ycombinator.com/item?id=21342501) exploring this concept.\r\n\r\nPersonally, I think the key is that without specifying any (EDIT: floating-point specific) flags (and after using iterators), by default clang and gcc do more optimizations on float math than Rust currently does.\r\n\r\n(EDIT: It seems that `-fvectorize -Ofast` was specified for clang to get gcc-comparable results, see proceeding comment)\r\n\r\nAn important key for any discussion on opmitized float math should keep this in mind: vectorization isn't always less precise - a commenter pointed out that a vectorized floating point sum is actually *more* accurate than the un-vectorized version. Also see Stack Overflow: <https://stackoverflow.com/a/7455442>\r\n\r\nI'm curious what criteria for vectorization clang (or gcc) uses for figuring out floating point optimization. I'm not enough of an expert in these areas to know specifics though. I'm also not sure what precision guarantees Rust makes for floating point math.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/545985469/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/545987841",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-545987841",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 545987841,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NTk4Nzg0MQ==",
    "user": {
      "login": "pedrocr",
      "id": 246322,
      "node_id": "MDQ6VXNlcjI0NjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/246322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pedrocr",
      "html_url": "https://github.com/pedrocr",
      "followers_url": "https://api.github.com/users/pedrocr/followers",
      "following_url": "https://api.github.com/users/pedrocr/following{/other_user}",
      "gists_url": "https://api.github.com/users/pedrocr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pedrocr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pedrocr/subscriptions",
      "organizations_url": "https://api.github.com/users/pedrocr/orgs",
      "repos_url": "https://api.github.com/users/pedrocr/repos",
      "events_url": "https://api.github.com/users/pedrocr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pedrocr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2019-10-24T16:03:27Z",
    "updated_at": "2019-10-24T16:03:27Z",
    "body": "> Personally, I think the key is that without specifying any flags (and after using iterators), by default clang and gcc do more optimizations on float math than Rust currently does.\r\n\r\nThat's not the case in the article. The clang compilation was using `-Ofast` which apparently enables `-ffast-math`.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/545987841/reactions",
      "total_count": 6,
      "+1": 6,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/551232620",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-551232620",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 551232620,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MTIzMjYyMA==",
    "user": {
      "login": "tkaitchuck",
      "id": 4756752,
      "node_id": "MDQ6VXNlcjQ3NTY3NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4756752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkaitchuck",
      "html_url": "https://github.com/tkaitchuck",
      "followers_url": "https://api.github.com/users/tkaitchuck/followers",
      "following_url": "https://api.github.com/users/tkaitchuck/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkaitchuck/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkaitchuck/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkaitchuck/subscriptions",
      "organizations_url": "https://api.github.com/users/tkaitchuck/orgs",
      "repos_url": "https://api.github.com/users/tkaitchuck/repos",
      "events_url": "https://api.github.com/users/tkaitchuck/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkaitchuck/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2019-11-07T19:40:41Z",
    "updated_at": "2019-11-07T19:40:41Z",
    "body": "As mentioned above, enabling fast math globally on a build is way to unsafe. Some things like `-ffp-contract=fast` being on by default make sense. But others are necessarily situational. Manually calling intrinsics on every single call is tedious. \r\n\r\nPerhaps it would be better to allow annotating a function. IE:\r\n```\r\n#[math(overflow=\"wrap\", assumptions=(\"algebraic\", \"no-nan\", \"finite\"))]\r\nfn update_velocity(b1: &mut Body, b2: &mut Body, diff: f32, mag: f32) {\r\n    b1.vel = b1.vel - diff * (b2.mass * mag);\r\n    b2.vel = b2.vel + diff * (b1.mass * mag);\r\n}\r\n```\r\nThat would provide reasonable safety while being more convenient, doubly so if it could be applied to entire modules.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/551232620/reactions",
      "total_count": 17,
      "+1": 14,
      "-1": 2,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/573465260",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-573465260",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 573465260,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MzQ2NTI2MA==",
    "user": {
      "login": "gnzlbg",
      "id": 904614,
      "node_id": "MDQ6VXNlcjkwNDYxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/904614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnzlbg",
      "html_url": "https://github.com/gnzlbg",
      "followers_url": "https://api.github.com/users/gnzlbg/followers",
      "following_url": "https://api.github.com/users/gnzlbg/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnzlbg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnzlbg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnzlbg/subscriptions",
      "organizations_url": "https://api.github.com/users/gnzlbg/orgs",
      "repos_url": "https://api.github.com/users/gnzlbg/repos",
      "events_url": "https://api.github.com/users/gnzlbg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnzlbg/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-01-12T22:39:29Z",
    "updated_at": "2020-01-12T22:45:02Z",
    "body": "Enabling fast match by default is going to break a lot of floating-point code. \r\n\r\nFor example, chances are that somewhere in your floating-point program, something is computing the sum of an array of floating-point values. If that code is doing it right, it is probably going to be using a crate like [accurate](https://github.com/bsteinb/accurate) to compute the sum efficiently with a small error. \r\n\r\n One of the algorithms that `accurate` implements is Kahan summation, which is roughly:\r\n\r\n```\r\nS = X[0]\r\nC = 0\r\nfor i in [1..N]:\r\n  Y = X[i] - C\r\n  T = S + Y\r\n  C = (T - S) - Y\r\n  S = T\r\n```\r\n\r\nWith `-ffast-math`, a compiler can replace `T` in `C = (T - S) - Y` with `S + Y`, which results in `C = ((S + Y) - S) - Y` and optimize that to `C = 0`. Since `C` is never modified, and adding zero does nothing with `-ffast-math`, Kahan algorithm can be further optimized to:\r\n\r\n```\r\nS = X[0]\r\nfor i in [1..N]:\r\n  S += X[i]\r\n```\r\n\r\nwhich defeats the point and produces quite inaccurate results. \r\n\r\nThis optimization is not theoretical, `clang` performs it when `-ffast-math` is enabled, e.g., see: https://gcc.godbolt.org/z/8NLIdB , where a more accurate Kahan summation gets optimized to an inaccurate sum.\r\n\r\nAllowing users to enable `-ffast-math` globally is only going to destroy all properly-written floating-point code in libstd and elsewhere, which Rust users building applications with more than 200 crates are probably using without knowing. \r\n\r\nEven allowing this at the function scope seems like a footgun, e.g., imagine a user writes:\r\n\r\n```rust\r\n#[math(overflow=\"wrap\", assumptions=(\"algebraic\", \"no-nan\", \"finite\"))]\r\nfn foo(b1: &[f32]) -> f32 {\r\n    accurate::kahan_sum(b1)\r\n}\r\n```\r\n\r\nIf `accurate` gets inlined into `foo`, the same algorithm-destroying optimization shown above would apply. To avoid that, we would need to prevent functions with \"incompatible\" `#[math(...)]` annotations from being inlined into each other (which might be worse for perf than the \"fast-math\" wins) - in this case, since `accurate::kahan_sum` wouldn't have a `#[math(...)]` annotation, it would not be inlineable into `foo`. This means, however, that the example used by @tkaitchuck above might not work, because the `<f32 as Add<f32>::add` method does not have a `#[math]` annotation either (and wouldn't have it with any proposal AFAICT).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/573465260/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/573668313",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-573668313",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 573668313,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MzY2ODMxMw==",
    "user": {
      "login": "kornelski",
      "id": 72159,
      "node_id": "MDQ6VXNlcjcyMTU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kornelski",
      "html_url": "https://github.com/kornelski",
      "followers_url": "https://api.github.com/users/kornelski/followers",
      "following_url": "https://api.github.com/users/kornelski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions",
      "organizations_url": "https://api.github.com/users/kornelski/orgs",
      "repos_url": "https://api.github.com/users/kornelski/repos",
      "events_url": "https://api.github.com/users/kornelski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kornelski/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-01-13T13:41:09Z",
    "updated_at": "2020-01-13T13:41:09Z",
    "body": "> If accurate gets inlined into foo, the same algorithm-destroying optimization shown above would apply. \r\n\r\nI'd consider that a compiler bug. \r\n\r\nThe whole dilemma seems to be coming from tying fp optimizations to scopes, rather than types. If there was `f32` and `fastf32`, then inlining wouldn't be semantics-breaking.\r\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/573668313/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/573906708",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-573906708",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 573906708,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MzkwNjcwOA==",
    "user": {
      "login": "hanna-kruppe",
      "id": 2311707,
      "node_id": "MDQ6VXNlcjIzMTE3MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2311707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hanna-kruppe",
      "html_url": "https://github.com/hanna-kruppe",
      "followers_url": "https://api.github.com/users/hanna-kruppe/followers",
      "following_url": "https://api.github.com/users/hanna-kruppe/following{/other_user}",
      "gists_url": "https://api.github.com/users/hanna-kruppe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hanna-kruppe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hanna-kruppe/subscriptions",
      "organizations_url": "https://api.github.com/users/hanna-kruppe/orgs",
      "repos_url": "https://api.github.com/users/hanna-kruppe/repos",
      "events_url": "https://api.github.com/users/hanna-kruppe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hanna-kruppe/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-01-13T22:38:49Z",
    "updated_at": "2020-01-13T22:38:59Z",
    "body": "@gnzlbg \r\n> To avoid that, we would need to prevent functions with \"incompatible\" `#[math(...)]` annotations from being inlined into each other (which might be worse for perf than the \"fast-math\" wins)\r\n\r\nThis is not at all necessary in LLVM IR, where fast-math flags apply to individual instructions, not whole functions. MIR could adopt the same basic idea to also enable MIR inlining between functions with different fast-math settings.\r\n\r\n> This means, however, that the example used by @tkaitchuck above might not work, because the `<f32 as Add<f32>::add` method does not have a `#[math]` annotation either\r\n\r\nThe general question for how to propagate fast-math settings into other functions in a controlled and predictable fashion is a very tricky language design challenge, but this specific example is not affected. For primitive types, expressions like `x + y` (in contrast to `x.add(y)`) already get special-cased and lowered directly to built-in MIR operations, so no function call is involved anyway.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/573906708/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/574063304",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-574063304",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 574063304,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NDA2MzMwNA==",
    "user": {
      "login": "gnzlbg",
      "id": 904614,
      "node_id": "MDQ6VXNlcjkwNDYxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/904614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnzlbg",
      "html_url": "https://github.com/gnzlbg",
      "followers_url": "https://api.github.com/users/gnzlbg/followers",
      "following_url": "https://api.github.com/users/gnzlbg/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnzlbg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnzlbg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnzlbg/subscriptions",
      "organizations_url": "https://api.github.com/users/gnzlbg/orgs",
      "repos_url": "https://api.github.com/users/gnzlbg/repos",
      "events_url": "https://api.github.com/users/gnzlbg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnzlbg/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-01-14T08:35:17Z",
    "updated_at": "2020-01-14T08:35:33Z",
    "body": "@rkruppe good points about inlining in MIR and about `x + y` being special cased. \r\n\r\nSo IIUC, inlining would still need to be very careful of, after inlining, not applying other optimizations that could change the fast-math settings of the inlined code. In a \"fast-math\" function, `x + y` would get fast-math flags, but would an `x + y` that gets inlined from a `x.add(y)` also get them? \r\n\r\n> The whole dilemma seems to be coming from tying fp optimizations to scopes, rather than types. If there was f32 and fastf32, then inlining wouldn't be semantics-breaking.\r\n\r\n@kornelski What `fastf32` achieves is tying the fp-arithmetic constraints to the operations on the memory it wraps. We already have some `core::intrinsics` for fast-math. I don't know if it is a good idea, but I would be ok with exposing a perma-unstable set of intrinsics that can express all these operations, since that should be enough to write types like `fastf32` and other approaches like `NonNan<NoSignedZero<Associative<T>>>` in Rust libraries. Maybe something like:\r\n\r\n```rust\r\nmod core::intrinsics { // or somewhere else\r\n    // bitflags for fast-math:\r\n    const NonNan: u32 = 0b1;\r\n    const NoSignedZero: u32 = 0b10;\r\n    const Associative: u32 = 0b100;\r\n    ...\r\n\r\n    // fp arithmetic intrinsics taking a const bitset of fast-math flags\r\n    fn fp_add<T>(T, T, const fast_math_flags: u32) -> T;\r\n    fn fp_sub<T>(T, T, const fast_math_flags: u32) -> T;  \r\n   ...\r\n   fn fp_sqrt<T>(T, T, const fast_math_flags: u32) -> T;\r\n   ...\r\n}\r\n```\r\n\r\nAlternatively, maybe we can just extend all the current floating-point core intrinsics with a bitset. With something like default function arguments, we would just set that bitset to `0` by default, preserving current behavior.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/574063304/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/574887097",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-574887097",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 574887097,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NDg4NzA5Nw==",
    "user": {
      "login": "hanna-kruppe",
      "id": 2311707,
      "node_id": "MDQ6VXNlcjIzMTE3MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2311707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hanna-kruppe",
      "html_url": "https://github.com/hanna-kruppe",
      "followers_url": "https://api.github.com/users/hanna-kruppe/followers",
      "following_url": "https://api.github.com/users/hanna-kruppe/following{/other_user}",
      "gists_url": "https://api.github.com/users/hanna-kruppe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hanna-kruppe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hanna-kruppe/subscriptions",
      "organizations_url": "https://api.github.com/users/hanna-kruppe/orgs",
      "repos_url": "https://api.github.com/users/hanna-kruppe/repos",
      "events_url": "https://api.github.com/users/hanna-kruppe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hanna-kruppe/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-01-15T22:29:00Z",
    "updated_at": "2020-01-15T22:29:00Z",
    "body": "> So IIUC, inlining would still need to be very careful of, after inlining, not applying other optimizations that could change the fast-math settings of the inlined code. In a \"fast-math\" function, `x + y` would get fast-math flags, but would an `x + y` that gets inlined from a `x.add(y)` also get them?\r\n\r\nNo, if fast-math flags are per-instruction, then inlining automatically does the correct thing: just copy each instructions around without changing the fast-math flags on it. So if without inlining `x.add(y)` calls a function that does a regular fadd, then you'll get the same after inlining.\r\n\r\nOn the other hand, optimizations that specifically rewrite floating point operations need to take care to correctly interpret and update flags of all involved instructions (e.g. reassociating `fadd x, (fadd assoc y, z)` is incorrect).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/574887097/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/576285735",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-576285735",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 576285735,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NjI4NTczNQ==",
    "user": {
      "login": "Ixrec",
      "id": 5285357,
      "node_id": "MDQ6VXNlcjUyODUzNTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5285357?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ixrec",
      "html_url": "https://github.com/Ixrec",
      "followers_url": "https://api.github.com/users/Ixrec/followers",
      "following_url": "https://api.github.com/users/Ixrec/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ixrec/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ixrec/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ixrec/subscriptions",
      "organizations_url": "https://api.github.com/users/Ixrec/orgs",
      "repos_url": "https://api.github.com/users/Ixrec/repos",
      "events_url": "https://api.github.com/users/Ixrec/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ixrec/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-01-20T13:57:48Z",
    "updated_at": "2020-01-20T13:57:48Z",
    "body": "> I would be ok with exposing a perma-unstable set of intrinsics that can express all these operations, since that should be enough to write types like fastf32 and other approaches like NonNan<NoSignedZero<Associative<T>>> in Rust libraries\r\n\r\nWas \"perma-unstable\" meant to be something else? Unless we think all libraries interested in fast-math are okay with being perma-unstable libraries.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/576285735/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/576295249",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-576295249",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 576295249,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NjI5NTI0OQ==",
    "user": {
      "login": "gnzlbg",
      "id": 904614,
      "node_id": "MDQ6VXNlcjkwNDYxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/904614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnzlbg",
      "html_url": "https://github.com/gnzlbg",
      "followers_url": "https://api.github.com/users/gnzlbg/followers",
      "following_url": "https://api.github.com/users/gnzlbg/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnzlbg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnzlbg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnzlbg/subscriptions",
      "organizations_url": "https://api.github.com/users/gnzlbg/orgs",
      "repos_url": "https://api.github.com/users/gnzlbg/repos",
      "events_url": "https://api.github.com/users/gnzlbg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnzlbg/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-01-20T14:20:27Z",
    "updated_at": "2020-01-20T14:20:55Z",
    "body": "@lxrec a perma-unstable feature is enough to allow those interested in developing a stable-rust solution to prototype one in nightly, since as mentioned, it allows people to implement types like `fastf32`, type wrappers like `NonNan<T>`, and even proc macros like `#[fast_math(...)]`. \r\n\r\nThat would allow those interested in \"fast-math\" to explore the design space without having to hack on the compiler, and to submit RFCs that can be tried, since library APIs using unstable features can be exposed from libcore to stable Rust users, without having to stabilize the \"perma-unstable\" features themselves.\r\n\r\n> Unless we think all libraries interested in fast-math are okay with being perma-unstable libraries.\r\n\r\nI have yet to see anybody expressing desire for this goal.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/576295249/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/576316665",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-576316665",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 576316665,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NjMxNjY2NQ==",
    "user": {
      "login": "kornelski",
      "id": 72159,
      "node_id": "MDQ6VXNlcjcyMTU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kornelski",
      "html_url": "https://github.com/kornelski",
      "followers_url": "https://api.github.com/users/kornelski/followers",
      "following_url": "https://api.github.com/users/kornelski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions",
      "organizations_url": "https://api.github.com/users/kornelski/orgs",
      "repos_url": "https://api.github.com/users/kornelski/repos",
      "events_url": "https://api.github.com/users/kornelski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kornelski/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-01-20T15:12:30Z",
    "updated_at": "2020-01-20T15:12:30Z",
    "body": "@gnzlbg Intrinsics for prototyping are OK, but they're not enough for practical use: https://github.com/rust-lang/rust/issues/21690#issuecomment-307093406",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/576316665/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/576330182",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-576330182",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 576330182,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NjMzMDE4Mg==",
    "user": {
      "login": "gnzlbg",
      "id": 904614,
      "node_id": "MDQ6VXNlcjkwNDYxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/904614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnzlbg",
      "html_url": "https://github.com/gnzlbg",
      "followers_url": "https://api.github.com/users/gnzlbg/followers",
      "following_url": "https://api.github.com/users/gnzlbg/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnzlbg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnzlbg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnzlbg/subscriptions",
      "organizations_url": "https://api.github.com/users/gnzlbg/orgs",
      "repos_url": "https://api.github.com/users/gnzlbg/repos",
      "events_url": "https://api.github.com/users/gnzlbg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnzlbg/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-01-20T15:46:45Z",
    "updated_at": "2020-01-20T15:56:49Z",
    "body": "You mention three issues in that comment:\r\n\r\n* lack of literal support: this is an orthogonal problem that should be solved by \"user-defined literals\". \r\n* lack of `as` support: `From`, `TryFrom`, `round`, `transmute`, and similar APIs are usually (always?) clearer than `as`,  particularly when combined with type ascription,\r\n* bad performance: sounds like a compiler bug, did you report it ? Looking at your code, your `ffast_math::fff` type is `repr(C)`  but should be `repr(transparent)` - notice that `repr(C)` inhibits the `Scalar` and `ScalarPair` `repr(Rust)` optimizations, forcing the `ffast_math::fff` type to use the `Aggregate` ABI class.\r\n\r\nSo from the issues you mention, the one I think has most weight is the lack of \"user-defined literals\". I don't think one needs to solve this problem to ship a fast-math feature. Today, we would need to write `let x = NonNan(1.0);`. IMO that is not that bad, definitely not bad enough to block an otherwise useful feature, in particular if we consider that with a \"user-defined literals\" feature we might need to write `let x = 1.0_NonNan_f64;` or similar (e.g. `let x = 1_r64;` for `Real<f64>`).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/576330182/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/586036366",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-586036366",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 586036366,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NjAzNjM2Ng==",
    "user": {
      "login": "AlexEne",
      "id": 5849037,
      "node_id": "MDQ6VXNlcjU4NDkwMzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5849037?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexEne",
      "html_url": "https://github.com/AlexEne",
      "followers_url": "https://api.github.com/users/AlexEne/followers",
      "following_url": "https://api.github.com/users/AlexEne/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexEne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexEne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexEne/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexEne/orgs",
      "repos_url": "https://api.github.com/users/AlexEne/repos",
      "events_url": "https://api.github.com/users/AlexEne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexEne/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-02-14T00:18:38Z",
    "updated_at": "2020-02-14T00:22:58Z",
    "body": "For game engines and similar real-time apps where floating point-accuracy is not that big of an issue (but speed is), this is quite important. The experience and steps to add this today in rust programs is not at all great. \r\n\r\nWhat would be the best practical next steps to get some traction on this issue?\r\nWhat needs to be addressed and how can we help with this?\r\n\r\nPotential questions that might need answers:\r\nDoes allowing -ffast-math have safety repercursions in safe rust? I can't imagine how it would violate safety invariants, but an example in safe rust would be great.\r\n\r\nIf it doesn't have any security/safety implications, my proposal would be for this be a compiler option like -Oz, etc. (exactly as clang has it?). Disabled by default, of course. \r\n\r\nDoes this need a RFC? The pre-rfc discussion from 2017 is now locked and in an inconclusive state.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/586036366/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 1,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610040329",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610040329",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610040329,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDA0MDMyOQ==",
    "user": {
      "login": "Jasper-Bekkers",
      "id": 49594,
      "node_id": "MDQ6VXNlcjQ5NTk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jasper-Bekkers",
      "html_url": "https://github.com/Jasper-Bekkers",
      "followers_url": "https://api.github.com/users/Jasper-Bekkers/followers",
      "following_url": "https://api.github.com/users/Jasper-Bekkers/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jasper-Bekkers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jasper-Bekkers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jasper-Bekkers/subscriptions",
      "organizations_url": "https://api.github.com/users/Jasper-Bekkers/orgs",
      "repos_url": "https://api.github.com/users/Jasper-Bekkers/repos",
      "events_url": "https://api.github.com/users/Jasper-Bekkers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jasper-Bekkers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-06T21:14:35Z",
    "updated_at": "2020-04-06T21:14:35Z",
    "body": "This particular feature is a real need within the game development community for obvious performance reasons. Usually we'd want this for hot-spot optimizations, however, it's also common to blanket enable `-ffast-math` for the entire (C++) game codebase.\r\n\r\nI'd like to propose two things:\r\n - A per function syntax where we can opt-in to fast-math style optimizations along the lines of `#[fast-math(no-trapping-math)]` or `#[fast-math(all)]` so we can use it specifically on our math-heavy cpu hot-spots.\r\n - A per-crate _override_ so we can enable-disable fast-math optimizations through the already existing profile overrides mechanism.\r\n\r\nFor example to opt out of fast-math everywhere one would simply:\r\n```\r\n[profile.dev.package.'*']\r\nfast-math: none\r\n```\r\n\r\nThis would allow both the more scientific community to disable fast-math where they want (say if a crate they use enables it), and allow us to opt-in where needed (and it is needed).",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610040329/reactions",
      "total_count": 5,
      "+1": 5,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610056408",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610056408",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610056408,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDA1NjQwOA==",
    "user": {
      "login": "kornelski",
      "id": 72159,
      "node_id": "MDQ6VXNlcjcyMTU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kornelski",
      "html_url": "https://github.com/kornelski",
      "followers_url": "https://api.github.com/users/kornelski/followers",
      "following_url": "https://api.github.com/users/kornelski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions",
      "organizations_url": "https://api.github.com/users/kornelski/orgs",
      "repos_url": "https://api.github.com/users/kornelski/repos",
      "events_url": "https://api.github.com/users/kornelski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kornelski/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-06T21:52:32Z",
    "updated_at": "2020-04-06T21:52:32Z",
    "body": "@Jasper-Bekkers having it per-function (or per-crate) makes inlining difficult. intrinsics or types are more predictable: https://github.com/rust-lang/rust/issues/21690#issuecomment-574063304",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610056408/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610070451",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610070451",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610070451,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDA3MDQ1MQ==",
    "user": {
      "login": "Jasper-Bekkers",
      "id": 49594,
      "node_id": "MDQ6VXNlcjQ5NTk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jasper-Bekkers",
      "html_url": "https://github.com/Jasper-Bekkers",
      "followers_url": "https://api.github.com/users/Jasper-Bekkers/followers",
      "following_url": "https://api.github.com/users/Jasper-Bekkers/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jasper-Bekkers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jasper-Bekkers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jasper-Bekkers/subscriptions",
      "organizations_url": "https://api.github.com/users/Jasper-Bekkers/orgs",
      "repos_url": "https://api.github.com/users/Jasper-Bekkers/repos",
      "events_url": "https://api.github.com/users/Jasper-Bekkers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jasper-Bekkers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-06T22:29:42Z",
    "updated_at": "2020-04-06T22:29:42Z",
    "body": "@kornelski LLVM doesn't allow for it?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610070451/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610234925",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610234925",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610234925,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDIzNDkyNQ==",
    "user": {
      "login": "Jasper-Bekkers",
      "id": 49594,
      "node_id": "MDQ6VXNlcjQ5NTk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jasper-Bekkers",
      "html_url": "https://github.com/Jasper-Bekkers",
      "followers_url": "https://api.github.com/users/Jasper-Bekkers/followers",
      "following_url": "https://api.github.com/users/Jasper-Bekkers/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jasper-Bekkers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jasper-Bekkers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jasper-Bekkers/subscriptions",
      "organizations_url": "https://api.github.com/users/Jasper-Bekkers/orgs",
      "repos_url": "https://api.github.com/users/Jasper-Bekkers/repos",
      "events_url": "https://api.github.com/users/Jasper-Bekkers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jasper-Bekkers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T07:52:46Z",
    "updated_at": "2020-04-07T07:53:20Z",
    "body": "> @kornelski LLVM doesn't allow for it?\r\n\r\nIt looks like LLVM is at least fine with all of this - it allows specificity fast-math on a per-instruction level: http://blog.llvm.org/2019/03/llvm-numerics-blog.html & https://www.duskborn.com/posts/fpscev/ so that argument sounds like a bit of a red-herring.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610234925/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610266381",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610266381",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610266381,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDI2NjM4MQ==",
    "user": {
      "login": "kornelski",
      "id": 72159,
      "node_id": "MDQ6VXNlcjcyMTU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kornelski",
      "html_url": "https://github.com/kornelski",
      "followers_url": "https://api.github.com/users/kornelski/followers",
      "following_url": "https://api.github.com/users/kornelski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions",
      "organizations_url": "https://api.github.com/users/kornelski/orgs",
      "repos_url": "https://api.github.com/users/kornelski/repos",
      "events_url": "https://api.github.com/users/kornelski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kornelski/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T08:58:54Z",
    "updated_at": "2020-04-07T08:58:54Z",
    "body": "The per-function/per-crate problem is with MIR and just ambiguity of what that means when the code is moved between scopes and crates. \r\n\r\nOTOH the more precise solution of having fast math *functions* or fast math *types* use the LLVM per-instruction mechanism you've pointed out.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610266381/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610281342",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610281342",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610281342,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDI4MTM0Mg==",
    "user": {
      "login": "Jasper-Bekkers",
      "id": 49594,
      "node_id": "MDQ6VXNlcjQ5NTk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jasper-Bekkers",
      "html_url": "https://github.com/Jasper-Bekkers",
      "followers_url": "https://api.github.com/users/Jasper-Bekkers/followers",
      "following_url": "https://api.github.com/users/Jasper-Bekkers/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jasper-Bekkers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jasper-Bekkers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jasper-Bekkers/subscriptions",
      "organizations_url": "https://api.github.com/users/Jasper-Bekkers/orgs",
      "repos_url": "https://api.github.com/users/Jasper-Bekkers/repos",
      "events_url": "https://api.github.com/users/Jasper-Bekkers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jasper-Bekkers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T09:30:37Z",
    "updated_at": "2020-04-07T09:30:37Z",
    "body": "> The per-function/per-crate problem is with MIR and just ambiguity of what that means when the code is moved between scopes and crates.\r\n\r\nMIR is under the control of the rust team so that should be fixable, and there are other situations where similar infrastructure is desirable as well (think per-function overrides of opt-level for debugging optimized builds which is also pretty common in the games industry).\r\n\r\n> OTOH the more precise solution of having fast math functions or fast math types use the LLVM per-instruction mechanism you've pointed out.\r\n\r\nOn the other hand, it's vastly un-ergonomic and impossible to override without running into similar problems.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610281342/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610293893",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610293893",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610293893,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDI5Mzg5Mw==",
    "user": {
      "login": "hanna-kruppe",
      "id": 2311707,
      "node_id": "MDQ6VXNlcjIzMTE3MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2311707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hanna-kruppe",
      "html_url": "https://github.com/hanna-kruppe",
      "followers_url": "https://api.github.com/users/hanna-kruppe/followers",
      "following_url": "https://api.github.com/users/hanna-kruppe/following{/other_user}",
      "gists_url": "https://api.github.com/users/hanna-kruppe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hanna-kruppe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hanna-kruppe/subscriptions",
      "organizations_url": "https://api.github.com/users/hanna-kruppe/orgs",
      "repos_url": "https://api.github.com/users/hanna-kruppe/repos",
      "events_url": "https://api.github.com/users/hanna-kruppe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hanna-kruppe/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T09:57:49Z",
    "updated_at": "2020-04-07T09:57:49Z",
    "body": "IR representations for fine-grained opt-in are mostly a solved or solvable problem, the more serious issue is one of language and library design: per-function is often *too fine-grained*, some mechanism for selectively propagating FMFs across function boundaries is needed. For example, `f32::sqrt` is just ordinary library code (which wraps an unstable intrinsic that is the actual compiler magic), it won't by itself opt into any FMFs, but we still need code that opts into FMFs to obtain a version of `f32::sqrt` that also has the same FMFs applied. If we just consider `f32::sqrt` to be \"a function that does not opt into any FMFs\" then fine-grained per-instruction FMFs will lead to the sqrt operation not having any FMFs even after inlining. So *something* different needs to happen to propagate FMFs from callers to callees, but only some callees, otherwise we're back to the problems that motivate fine-grained FMFs in the first place (accidental contamination of adjacent code that doesn't opt into FMFs).\r\n\r\nHow can we achieve this? C and C++ do not really have a solution for this, other than by special-casing a few standard library functions in the compiler front-end. I think the Rust project has more aversion to such special-casing and more reliance on user-defined library code and abstractions, so the incentives are probably different here. New types offer a solution that leans on an existing mechanism (generics + monomorphization) but this comes with downsides (e.g., type incompatibilities, potential code size explosion from pointless monomorphizations). It's a tricky problem IMO.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610293893/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610299081",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610299081",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610299081,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDI5OTA4MQ==",
    "user": {
      "login": "Jasper-Bekkers",
      "id": 49594,
      "node_id": "MDQ6VXNlcjQ5NTk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jasper-Bekkers",
      "html_url": "https://github.com/Jasper-Bekkers",
      "followers_url": "https://api.github.com/users/Jasper-Bekkers/followers",
      "following_url": "https://api.github.com/users/Jasper-Bekkers/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jasper-Bekkers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jasper-Bekkers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jasper-Bekkers/subscriptions",
      "organizations_url": "https://api.github.com/users/Jasper-Bekkers/orgs",
      "repos_url": "https://api.github.com/users/Jasper-Bekkers/repos",
      "events_url": "https://api.github.com/users/Jasper-Bekkers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jasper-Bekkers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T10:09:04Z",
    "updated_at": "2020-04-07T10:09:04Z",
    "body": "@hanna-kruppe That's why I proposed the two pronged approach above, both per function and per crate. Typically in a game there are a few sub-systems that, at their core, rely heavily on math operations. Those functions I'd like to be able to decorate with `#[fast-math(all)]`, think for example decorating the constraint solver of a physics engine with this, while leaving it un-affected in the larger part of the system or the rest of the engine. \r\n\r\n```\r\n#[fast-math(all)]\r\nfn solve_my_physics_constraints() {\r\n    ...\r\n}\r\n```\r\n\r\nSolving this in the type system imho isn't the right approach; like you've pointed out it's extremely hairy, and it's a huge annoyance when going in and trying things out speculatively - which - like it or not is a part of the optimization workflow that's very important.\r\n\r\nAlso, having a few \"fast math\" intrinsics similar to what's in nightly at the moment isn't enough - by far.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610299081/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610346789",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610346789",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610346789,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDM0Njc4OQ==",
    "user": {
      "login": "hanna-kruppe",
      "id": 2311707,
      "node_id": "MDQ6VXNlcjIzMTE3MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2311707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hanna-kruppe",
      "html_url": "https://github.com/hanna-kruppe",
      "followers_url": "https://api.github.com/users/hanna-kruppe/followers",
      "following_url": "https://api.github.com/users/hanna-kruppe/following{/other_user}",
      "gists_url": "https://api.github.com/users/hanna-kruppe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hanna-kruppe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hanna-kruppe/subscriptions",
      "organizations_url": "https://api.github.com/users/hanna-kruppe/orgs",
      "repos_url": "https://api.github.com/users/hanna-kruppe/repos",
      "events_url": "https://api.github.com/users/hanna-kruppe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hanna-kruppe/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T12:03:41Z",
    "updated_at": "2020-04-07T12:03:41Z",
    "body": "I don't understand how either \"prong\" helps with the problem I described. `f32::sqrt` is neither in any module of your game engine, nor in any crate you control. If you write\r\n\r\n```rust\r\nlet x = something.sqrt();\r\n```\r\n\r\n... then a localized `#[fast_math(all)]` on the surrounding function, module, or crate will not result in LLVM IR that contains a `call fast @llvm.sqrt.f32(...)` instruction, which is the IR you'd want to match `sqrt(something)` in C or C++ under `-ffast-math`. You'll just get the same old `call @llvm.sqrt.f32(...)` (no FMF) from the library function in `src/libstd/f32.rs` that has no opt-in applied. Something beyond attributes applied to limited lexical scopes is needed to avoid this, not necessarily something involving the type system, but certainly *something* beyond scoped attributes.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610346789/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610353223",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610353223",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610353223,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDM1MzIyMw==",
    "user": {
      "login": "pedrocr",
      "id": 246322,
      "node_id": "MDQ6VXNlcjI0NjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/246322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pedrocr",
      "html_url": "https://github.com/pedrocr",
      "followers_url": "https://api.github.com/users/pedrocr/followers",
      "following_url": "https://api.github.com/users/pedrocr/following{/other_user}",
      "gists_url": "https://api.github.com/users/pedrocr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pedrocr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pedrocr/subscriptions",
      "organizations_url": "https://api.github.com/users/pedrocr/orgs",
      "repos_url": "https://api.github.com/users/pedrocr/repos",
      "events_url": "https://api.github.com/users/pedrocr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pedrocr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T12:18:46Z",
    "updated_at": "2020-04-07T12:18:46Z",
    "body": "> Something beyond attributes applied to limited lexical scopes is needed to avoid this, not necessarily something involving the type system, but certainly something beyond scoped attributes.\r\n\r\nWouldn't it work to have scoped attributes both for enabling fast-math stuff and also for allowing it to pass-through if called from such context? That way the sqrt example would work something like:\r\n\r\n```rust\r\n#[fast-math(all)]\r\nfn need_all_the_speed(val: f32) -> f32 {\r\n    val.sqrt()\r\n}\r\n\r\n(...) somewhere in the stdlib\r\n\r\n#[fast-math-passthrough-allow(all)]\r\nfn sqrt(val: f32) -> f32 { ... }\r\n```\r\n\r\nWhen `sqrt()` gets called from a `fast-math` context it uses that and if not behaves normally. No idea if this is feasible in the compiler as it requires compiling the stdlib `sqrt()` in how many ways there are contexts calling it with different `fast-math` contexts.\r\n\r\nThis together with other proposals of specifying subsets of `fast-math` would allow specifying what is and isn't valid for each function decided by whoever wrote the code. Instead of doing what C/C++ does and allowing who is building the code to overwrite that and generate broken code by fiddling with compiler flags. In all the discussions I've seen about this it was fairly clear that should not be done. Overriding `fast-math` on a per-project or per-crate level is a footgun.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610353223/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610361995",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610361995",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610361995,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDM2MTk5NQ==",
    "user": {
      "login": "hanna-kruppe",
      "id": 2311707,
      "node_id": "MDQ6VXNlcjIzMTE3MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2311707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hanna-kruppe",
      "html_url": "https://github.com/hanna-kruppe",
      "followers_url": "https://api.github.com/users/hanna-kruppe/followers",
      "following_url": "https://api.github.com/users/hanna-kruppe/following{/other_user}",
      "gists_url": "https://api.github.com/users/hanna-kruppe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hanna-kruppe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hanna-kruppe/subscriptions",
      "organizations_url": "https://api.github.com/users/hanna-kruppe/orgs",
      "repos_url": "https://api.github.com/users/hanna-kruppe/repos",
      "events_url": "https://api.github.com/users/hanna-kruppe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hanna-kruppe/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T12:38:47Z",
    "updated_at": "2020-04-07T12:38:47Z",
    "body": "Right, an attribute opting into \"inheriting\" FMFs from callers is a possible direction, but it's not clear how to best integrate it with Rust's (or most other language's, for that matter) compilation model. While `f32::sqrt` is a trivial wrapper function that should pretty much always be inlined anyway, for other functions that would benefit from pass-through, simply duplicating all code for every distinct set of FMFs used is not the right choice.\r\n\r\nAnd even if it was, implementing it in the compiler requires the same machinery as monomorphization for type and constant parameters. Bolting yet another kind of parameter on this code seems potentially quite ugly, especially because it would *not* apply in other parts of the compiler that currently share concepts and code (the type system and everything that interacts with generic types). Leaning on the type system has its own drawbacks, but it neatly side-steps these concerns.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610361995/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610395129",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610395129",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610395129,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDM5NTEyOQ==",
    "user": {
      "login": "kornelski",
      "id": 72159,
      "node_id": "MDQ6VXNlcjcyMTU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kornelski",
      "html_url": "https://github.com/kornelski",
      "followers_url": "https://api.github.com/users/kornelski/followers",
      "following_url": "https://api.github.com/users/kornelski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions",
      "organizations_url": "https://api.github.com/users/kornelski/orgs",
      "repos_url": "https://api.github.com/users/kornelski/repos",
      "events_url": "https://api.github.com/users/kornelski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kornelski/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T13:44:06Z",
    "updated_at": "2020-04-07T13:47:49Z",
    "body": "But why weird attribute pass-throughs when you can have `f32::sqrt()` that is always precise, and `fastf32::sqrt()` that is always fast? \r\n\r\nTypes match what LLVM is doing, so having non-types layer of attributes on top of that that rust will have to translate back to types is weird.  It's like `#[u32_is_signed_here]` attribute for a function that should be using `i32`.\r\n\r\nInstead of putting an attribute, you can make your functions take the fast-float type. You could also make them generic over f32/fastf32. \r\n\r\nSeparate types also give fine-grained control, e.g. you may want calculation fast, but some accumulator to use precise math. You can have `f32 += fast32` to express that, instead even more special attributes.\r\n\r\nTypes also match what Rust is already doing with `Wrapping` type. There's no `#[integers_can_wrap_here]` `#[ambivalent_about_integer_wrapping]`, but precise per-operation control.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610395129/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610397023",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610397023",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610397023,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDM5NzAyMw==",
    "user": {
      "login": "pedrocr",
      "id": 246322,
      "node_id": "MDQ6VXNlcjI0NjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/246322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pedrocr",
      "html_url": "https://github.com/pedrocr",
      "followers_url": "https://api.github.com/users/pedrocr/followers",
      "following_url": "https://api.github.com/users/pedrocr/following{/other_user}",
      "gists_url": "https://api.github.com/users/pedrocr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pedrocr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pedrocr/subscriptions",
      "organizations_url": "https://api.github.com/users/pedrocr/orgs",
      "repos_url": "https://api.github.com/users/pedrocr/repos",
      "events_url": "https://api.github.com/users/pedrocr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pedrocr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T13:47:35Z",
    "updated_at": "2020-04-07T13:47:35Z",
    "body": "Types could work, but you're going to need much more than one as `fast-math` should not be a single toggle. It also makes the code uglier from the conversions but that can probably be worked around with macros that convert types automatically.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610397023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610411285",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610411285",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610411285,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDQxMTI4NQ==",
    "user": {
      "login": "Jasper-Bekkers",
      "id": 49594,
      "node_id": "MDQ6VXNlcjQ5NTk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jasper-Bekkers",
      "html_url": "https://github.com/Jasper-Bekkers",
      "followers_url": "https://api.github.com/users/Jasper-Bekkers/followers",
      "following_url": "https://api.github.com/users/Jasper-Bekkers/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jasper-Bekkers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jasper-Bekkers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jasper-Bekkers/subscriptions",
      "organizations_url": "https://api.github.com/users/Jasper-Bekkers/orgs",
      "repos_url": "https://api.github.com/users/Jasper-Bekkers/repos",
      "events_url": "https://api.github.com/users/Jasper-Bekkers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jasper-Bekkers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T14:13:21Z",
    "updated_at": "2020-04-07T14:13:21Z",
    "body": "> You'll just get the same old call @llvm.sqrt.f32(...) (no FMF) from the library function in src/libstd/f32.rs that has no opt-in applied. \r\n\r\nThe idea would be that the flag / attribute gets inherited, without it it wouldn't work to begin with for reasons you've listed.\r\n\r\n> But why weird attribute pass-throughs when you can have f32::sqrt() that is always precise, and fastf32::sqrt() that is always fast?\r\n\r\nBecause:\r\n - This makes it extremely difficult & tedious to switch between the two\r\n - There's no easy opt-out for the scientific community\r\n - It's not even clear what the semantics would be then; do they opt in to all fast-math operations? Should we have a flush_to_zero_fastf32 as well?\r\n\r\n> There's no #[integers_can_wrap_here] #[ambivalent_about_integer_wrapping], but precise per-operation control.\r\n\r\nExcept that precise control is more or less exactly what you're opting out of when compiling with fast math enabled.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610411285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610413475",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610413475",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610413475,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDQxMzQ3NQ==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T14:17:19Z",
    "updated_at": "2020-04-07T14:17:19Z",
    "body": "Is the f32 vs fastf32 dichotomy enough? Has anyone looked at which fast-math flags agree with Rust's language guarantees and which not? It looks like to me, some are entirely harmless / only affect the value level, and some others more or less have preconditions and may even need to be guarded by `unsafe`?\r\n\r\nCompare for example the `nnan` flag and the `reassoc` flag. [Langref](https://llvm.org/docs/LangRef.html#fast-math-flags) - from just reading, `nnan` is potentially unsafe (I don't know off hand what poison value means for Rust) and `reassoc` not.\r\n\r\nHopefully, maybe, the \"safe\" flags are enough for most optimizations.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610413475/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610428706",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610428706",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610428706,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDQyODcwNg==",
    "user": {
      "login": "Jasper-Bekkers",
      "id": 49594,
      "node_id": "MDQ6VXNlcjQ5NTk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jasper-Bekkers",
      "html_url": "https://github.com/Jasper-Bekkers",
      "followers_url": "https://api.github.com/users/Jasper-Bekkers/followers",
      "following_url": "https://api.github.com/users/Jasper-Bekkers/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jasper-Bekkers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jasper-Bekkers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jasper-Bekkers/subscriptions",
      "organizations_url": "https://api.github.com/users/Jasper-Bekkers/orgs",
      "repos_url": "https://api.github.com/users/Jasper-Bekkers/repos",
      "events_url": "https://api.github.com/users/Jasper-Bekkers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jasper-Bekkers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T14:44:03Z",
    "updated_at": "2020-04-07T14:44:03Z",
    "body": "@bluss I don't think any of the flags currently would be seen as unsafe. The spec doesn't make any reference to f32 safety and explicitly mentions [integer overflow](https://doc.rust-lang.org/reference/behavior-not-considered-unsafe.html?highlight=unsafe#deadlocks) as /not/ unsafe. As a matter of fact, there are only two references to IEEE 754 floats in the spec that I can find, one is to specify the [data-storage](https://doc.rust-lang.org/reference/types/numeric.html?highlight=iee#floating-point-types) as `binary32` and `binary64` for f32 and f64 respectively, and the other is to specify what happens during certain [casting operations](https://doc.rust-lang.org/reference/expressions/operator-expr.html?highlight=iee#semantics).\r\n\r\nHowever, from a ideological point of view, I have no objections to fast-math having to be unsafe (whatever that means from a language point of view).",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610428706/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610458654",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610458654",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610458654,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDQ1ODY1NA==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T15:35:41Z",
    "updated_at": "2020-04-07T15:36:20Z",
    "body": "I haven't followed the discussions unfortunately, but from a quick read it seems like anything that produces a poison value could be problematic. (See link https://github.com/rust-lang/unsafe-code-guidelines/issues/6#issuecomment-417850175) But the unsafe-c-g wg would be able to discuss it.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610458654/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610459562",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610459562",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610459562,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDQ1OTU2Mg==",
    "user": {
      "login": "hanna-kruppe",
      "id": 2311707,
      "node_id": "MDQ6VXNlcjIzMTE3MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2311707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hanna-kruppe",
      "html_url": "https://github.com/hanna-kruppe",
      "followers_url": "https://api.github.com/users/hanna-kruppe/followers",
      "following_url": "https://api.github.com/users/hanna-kruppe/following{/other_user}",
      "gists_url": "https://api.github.com/users/hanna-kruppe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hanna-kruppe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hanna-kruppe/subscriptions",
      "organizations_url": "https://api.github.com/users/hanna-kruppe/orgs",
      "repos_url": "https://api.github.com/users/hanna-kruppe/repos",
      "events_url": "https://api.github.com/users/hanna-kruppe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hanna-kruppe/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-07T15:37:14Z",
    "updated_at": "2020-04-07T15:37:14Z",
    "body": "Yes, `nnan` flag is very much unsafe, as it can result in several uses of the same value observing different values non-deterministically, which is a gadet that can be used to e.g. defeat bounds checks ([example](https://github.com/rust-lang/rust/issues/10184#issuecomment-139858153)). I am not 100% sure if any other flags are safe. It seems they are all at risk, if a computation gets duplicated (which is generally allowed!) and then the two copies get optimized differently.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610459562/reactions",
      "total_count": 4,
      "+1": 4,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610704722",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610704722",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610704722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDcwNDcyMg==",
    "user": {
      "login": "bitshifter",
      "id": 135700,
      "node_id": "MDQ6VXNlcjEzNTcwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/135700?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bitshifter",
      "html_url": "https://github.com/bitshifter",
      "followers_url": "https://api.github.com/users/bitshifter/followers",
      "following_url": "https://api.github.com/users/bitshifter/following{/other_user}",
      "gists_url": "https://api.github.com/users/bitshifter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bitshifter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bitshifter/subscriptions",
      "organizations_url": "https://api.github.com/users/bitshifter/orgs",
      "repos_url": "https://api.github.com/users/bitshifter/repos",
      "events_url": "https://api.github.com/users/bitshifter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bitshifter/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-08T01:44:02Z",
    "updated_at": "2020-04-08T01:44:02Z",
    "body": "I personally would be fine with per function and per crate attributes that enable some fast math flags without the need for callees inheriting the flags if that simplifies things. It gives the game dev community something to work with without needing a more elaborate solution. Fast math attributes could be ignored by the compiler by default unless explicitly allowed by compiler flags. No surprise foot guns there, only the foot guns I've asked for.\r\n\r\nI'm fine to call a fast sqrt from my fast math enabled code, often games write their own sqrt/sin/cos etc approximations anyway so I don't have an issue with being explicit. If the compiler switch isn't enabled then fast sqrt results in regular old sqrt.\r\n\r\nI think this would be a lot more ergonomic to work with than new types and gives some level of control over float opts.\r\n\r\nFor safety concerns perhaps an initial implementation could not allow problematic flags or alternatively require functions to be labelled as unsafe. The latter would be a lot less ergonomic though.\r\n\r\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610704722/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610795182",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-610795182",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 610795182,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDc5NTE4Mg==",
    "user": {
      "login": "Jasper-Bekkers",
      "id": 49594,
      "node_id": "MDQ6VXNlcjQ5NTk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jasper-Bekkers",
      "html_url": "https://github.com/Jasper-Bekkers",
      "followers_url": "https://api.github.com/users/Jasper-Bekkers/followers",
      "following_url": "https://api.github.com/users/Jasper-Bekkers/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jasper-Bekkers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jasper-Bekkers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jasper-Bekkers/subscriptions",
      "organizations_url": "https://api.github.com/users/Jasper-Bekkers/orgs",
      "repos_url": "https://api.github.com/users/Jasper-Bekkers/repos",
      "events_url": "https://api.github.com/users/Jasper-Bekkers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jasper-Bekkers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-08T07:20:59Z",
    "updated_at": "2020-04-08T07:31:08Z",
    "body": "> I'm fine to call a fast sqrt from my fast math enabled code, often games write their own sqrt/sin/cos etc approximations anyway so I don't have an issue with being explicit. If the compiler switch isn't enabled then fast sqrt results in regular old sqrt.\r\n\r\nActually, for these I think it would be totally fine to just have a bunch of `sqrt_native`, `sin_native` functions on f32 directly. It's always been one of the few nice things about OpenCL as well.\r\n\r\nhttps://www.khronos.org/registry/OpenCL/sdk/1.0/docs/man/xhtml/sqrt.html",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/610795182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/611437490",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-611437490",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 611437490,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMTQzNzQ5MA==",
    "user": {
      "login": "Jasper-Bekkers",
      "id": 49594,
      "node_id": "MDQ6VXNlcjQ5NTk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jasper-Bekkers",
      "html_url": "https://github.com/Jasper-Bekkers",
      "followers_url": "https://api.github.com/users/Jasper-Bekkers/followers",
      "following_url": "https://api.github.com/users/Jasper-Bekkers/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jasper-Bekkers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jasper-Bekkers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jasper-Bekkers/subscriptions",
      "organizations_url": "https://api.github.com/users/Jasper-Bekkers/orgs",
      "repos_url": "https://api.github.com/users/Jasper-Bekkers/repos",
      "events_url": "https://api.github.com/users/Jasper-Bekkers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jasper-Bekkers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-09T09:47:18Z",
    "updated_at": "2020-04-09T09:47:18Z",
    "body": "@hanna-kruppe I tried coming up with a list of llvm builtin ops that can listen to the `afn` flag, the llvm reference docs seem to suggest there are only a few, however, it looks like opencl has a bunch more `native_` ops then this. (And I'm aware of fast-math style approximations for many more, as are you most likely). Could you help out set up a list for this so we can make a proposal and evaluate having these as extensions on `f32` and `f64`?\r\n\r\n```\r\nllvm.exp.*\r\nllvm.exp2.*\r\nllvm.log.*\r\nllvm.log10.*\r\nllvm.log2.*\r\nllvm.fma.*\r\nllvm.sqrt.*\r\nllvm.sin.*\r\nllvm.cos.*\r\nllvm.pow.*\r\n```",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/611437490/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/611463888",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-611463888",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 611463888,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMTQ2Mzg4OA==",
    "user": {
      "login": "hanna-kruppe",
      "id": 2311707,
      "node_id": "MDQ6VXNlcjIzMTE3MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2311707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hanna-kruppe",
      "html_url": "https://github.com/hanna-kruppe",
      "followers_url": "https://api.github.com/users/hanna-kruppe/followers",
      "following_url": "https://api.github.com/users/hanna-kruppe/following{/other_user}",
      "gists_url": "https://api.github.com/users/hanna-kruppe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hanna-kruppe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hanna-kruppe/subscriptions",
      "organizations_url": "https://api.github.com/users/hanna-kruppe/orgs",
      "repos_url": "https://api.github.com/users/hanna-kruppe/repos",
      "events_url": "https://api.github.com/users/hanna-kruppe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hanna-kruppe/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-04-09T10:51:18Z",
    "updated_at": "2020-04-09T10:51:18Z",
    "body": "I can't invest significant time into this subject. But if it helps, I don't believe `afn` is the only or primary mechanism by which these and other functions get mapped to approximations. Depending on platform and operation, other options include:\r\n\r\n- gated on other LLVM IR attributes (e.g., `\"unsafe-fp-math\"` function attribute)\r\n- frontend emitting (or headers `#define`-ing) the symbols as different inline code or calls to different function symbols, possibly even bypassing the intrinsics altogether\r\n- just linking to a different libm implementation in the end\r\n\r\nThe whole subject is a real jungle of implementation details that still changes ([example](https://sourceware.org/git/?p=glibc.git;a=commit;h=7bdb921d70bf9f93948e2e311fef9ef439314e41) from less than a year ago) and varies between compilers, vendors and target platforms.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/611463888/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/695870867",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-695870867",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 695870867,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NTg3MDg2Nw==",
    "user": {
      "login": "workingjubilee",
      "id": 46493976,
      "node_id": "MDQ6VXNlcjQ2NDkzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/workingjubilee",
      "html_url": "https://github.com/workingjubilee",
      "followers_url": "https://api.github.com/users/workingjubilee/followers",
      "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}",
      "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions",
      "organizations_url": "https://api.github.com/users/workingjubilee/orgs",
      "repos_url": "https://api.github.com/users/workingjubilee/repos",
      "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/workingjubilee/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-09-21T02:01:22Z",
    "updated_at": "2020-09-21T02:01:22Z",
    "body": "@rustbot modify labels: +A-floating-point",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/695870867/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/735533971",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-735533971",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 735533971,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNTUzMzk3MQ==",
    "user": {
      "login": "JRF63",
      "id": 7283601,
      "node_id": "MDQ6VXNlcjcyODM2MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7283601?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JRF63",
      "html_url": "https://github.com/JRF63",
      "followers_url": "https://api.github.com/users/JRF63/followers",
      "following_url": "https://api.github.com/users/JRF63/following{/other_user}",
      "gists_url": "https://api.github.com/users/JRF63/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JRF63/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JRF63/subscriptions",
      "organizations_url": "https://api.github.com/users/JRF63/orgs",
      "repos_url": "https://api.github.com/users/JRF63/repos",
      "events_url": "https://api.github.com/users/JRF63/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JRF63/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-11-30T04:13:46Z",
    "updated_at": "2020-12-03T13:35:21Z",
    "body": "~~`-ffast-math` analysis [also applies to vector intrinsics](https://stackoverflow.com/questions/44134061/strict-aliasing-ffast-math-and-sse). I don't think we want to create a `_fast` version of _every_ floating-point intrinsic for _every_ architecture.~~ Turns out this was clang lowering _mm_cmpord_ps to native LLVM IR fcmp.\r\n\r\n[Relevant part on LLVM](https://github.com/rust-lang/llvm-project/blob/ee1617457899ef2eb55dcf7ee2758b4340b6533f/llvm/include/llvm/IR/Operator.h#L402). I read that as function calls (that return float types?) on floating-points or floating-point vectors being amenable to fast-math optimizations.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/735533971/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/905513362",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-905513362",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 905513362,
    "node_id": "IC_kwDOAAsO6M41-QmS",
    "user": {
      "login": "sollyucko",
      "id": 15565481,
      "node_id": "MDQ6VXNlcjE1NTY1NDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/15565481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sollyucko",
      "html_url": "https://github.com/sollyucko",
      "followers_url": "https://api.github.com/users/sollyucko/followers",
      "following_url": "https://api.github.com/users/sollyucko/following{/other_user}",
      "gists_url": "https://api.github.com/users/sollyucko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sollyucko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sollyucko/subscriptions",
      "organizations_url": "https://api.github.com/users/sollyucko/orgs",
      "repos_url": "https://api.github.com/users/sollyucko/repos",
      "events_url": "https://api.github.com/users/sollyucko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sollyucko/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-08-25T13:43:10Z",
    "updated_at": "2021-08-25T13:43:10Z",
    "body": "How would the attribute work if `with_attribute` called `with_slow_sqrt` or vice versa?",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/905513362/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/905563606",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-905563606",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 905563606,
    "node_id": "IC_kwDOAAsO6M41-c3W",
    "user": {
      "login": "jgarvin",
      "id": 102322,
      "node_id": "MDQ6VXNlcjEwMjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/102322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jgarvin",
      "html_url": "https://github.com/jgarvin",
      "followers_url": "https://api.github.com/users/jgarvin/followers",
      "following_url": "https://api.github.com/users/jgarvin/following{/other_user}",
      "gists_url": "https://api.github.com/users/jgarvin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jgarvin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jgarvin/subscriptions",
      "organizations_url": "https://api.github.com/users/jgarvin/orgs",
      "repos_url": "https://api.github.com/users/jgarvin/repos",
      "events_url": "https://api.github.com/users/jgarvin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jgarvin/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-08-25T14:43:03Z",
    "updated_at": "2021-08-25T14:43:03Z",
    "body": "@LiamTheProgrammer All the operations is vast because it includes intrinsics. [Anything here](https://software.intel.com/sites/landingpage/IntrinsicsGuide/) with `__mm512`, `__mm512d`, `__mm256`, `__mm256d`, `__mm128`, `__mm128d` etc.  \r\n\r\nAnecdotally in the C++ code bases I've worked on that used fast math they've generally done the inverse -- use fast math everywhere then by hand annotate specific functions where it would be problematic with pragmas to disable the optimization for those functions. This works in practice because If you care strongly about floating point performance you're probably also using vector operations, and vector operations tend to mitigate precision problems (e.g. to implement vectorized dot product you have 8 separate accumulators effectively instead of just the one in a scalar implementation).\r\n\r\nIt's almost guaranteed that in a system where you have to bless particular operations that somebody is going to ship a crate with a newtype wrapper for floats that just lists every single operation and that will become the way most people end up using the operations.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/905563606/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/923673831",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-923673831",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 923673831,
    "node_id": "IC_kwDOAAsO6M43DiTn",
    "user": {
      "login": "Artoria2e5",
      "id": 6459309,
      "node_id": "MDQ6VXNlcjY0NTkzMDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6459309?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Artoria2e5",
      "html_url": "https://github.com/Artoria2e5",
      "followers_url": "https://api.github.com/users/Artoria2e5/followers",
      "following_url": "https://api.github.com/users/Artoria2e5/following{/other_user}",
      "gists_url": "https://api.github.com/users/Artoria2e5/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Artoria2e5/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Artoria2e5/subscriptions",
      "organizations_url": "https://api.github.com/users/Artoria2e5/orgs",
      "repos_url": "https://api.github.com/users/Artoria2e5/repos",
      "events_url": "https://api.github.com/users/Artoria2e5/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Artoria2e5/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-09-21T06:17:41Z",
    "updated_at": "2021-09-21T06:19:19Z",
    "body": "Adding a wishlist item when it eventually becomes true: Rust should get a way to temporarily avoid reordering in a certain part of an expression. Fortran compilers usually reorder as they please, but avoid breaking up parenthesized stuff. (I mean, I would love to have it in C too\u2026)",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/923673831/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/923702077",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-923702077",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 923702077,
    "node_id": "IC_kwDOAAsO6M43DpM9",
    "user": {
      "login": "workingjubilee",
      "id": 46493976,
      "node_id": "MDQ6VXNlcjQ2NDkzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/workingjubilee",
      "html_url": "https://github.com/workingjubilee",
      "followers_url": "https://api.github.com/users/workingjubilee/followers",
      "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}",
      "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions",
      "organizations_url": "https://api.github.com/users/workingjubilee/orgs",
      "repos_url": "https://api.github.com/users/workingjubilee/repos",
      "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/workingjubilee/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-09-21T07:09:44Z",
    "updated_at": "2021-09-21T07:09:44Z",
    "body": "However these optimizations are approached, the consequences can be quite dire: shared objects emitted by some compilers with this style of optimizations can, upon being linked to, **change the floating point CSR for the entire program** and leave it that way, altering results in unrelated code. While Rust is more commonly a standalone binary and thus largely in control of its execution and not interfering with others, rather than a `.so`, `.dll`, or other dynamic library, the day that people frequently link against Rust dylibs is not far off:\r\n\r\nhttps://bugzilla.redhat.com/show_bug.cgi?id=1127544",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/923702077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/923704791",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-923704791",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 923704791,
    "node_id": "IC_kwDOAAsO6M43Dp3X",
    "user": {
      "login": "Artoria2e5",
      "id": 6459309,
      "node_id": "MDQ6VXNlcjY0NTkzMDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6459309?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Artoria2e5",
      "html_url": "https://github.com/Artoria2e5",
      "followers_url": "https://api.github.com/users/Artoria2e5/followers",
      "following_url": "https://api.github.com/users/Artoria2e5/following{/other_user}",
      "gists_url": "https://api.github.com/users/Artoria2e5/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Artoria2e5/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Artoria2e5/subscriptions",
      "organizations_url": "https://api.github.com/users/Artoria2e5/orgs",
      "repos_url": "https://api.github.com/users/Artoria2e5/repos",
      "events_url": "https://api.github.com/users/Artoria2e5/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Artoria2e5/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-09-21T07:14:04Z",
    "updated_at": "2021-09-21T07:14:04Z",
    "body": "Saw that thread too! Still not sure whether it affects Rust at all \u2014 crtfastmath.o is a linkage thing and the decision seems to be due to the compiler driver, not the backend codegen. ",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/923704791/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/923708838",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-923708838",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 923708838,
    "node_id": "IC_kwDOAAsO6M43Dq2m",
    "user": {
      "login": "thomcc",
      "id": 860665,
      "node_id": "MDQ6VXNlcjg2MDY2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/860665?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thomcc",
      "html_url": "https://github.com/thomcc",
      "followers_url": "https://api.github.com/users/thomcc/followers",
      "following_url": "https://api.github.com/users/thomcc/following{/other_user}",
      "gists_url": "https://api.github.com/users/thomcc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thomcc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thomcc/subscriptions",
      "organizations_url": "https://api.github.com/users/thomcc/orgs",
      "repos_url": "https://api.github.com/users/thomcc/repos",
      "events_url": "https://api.github.com/users/thomcc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thomcc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-09-21T07:20:03Z",
    "updated_at": "2021-09-21T07:20:03Z",
    "body": "Everywhere I've worked using Rust, people have been linking against Rust dylibs, so it's already fairly common in my experience, just not when the program itself is written in Rust. That said, I don't think this needs to be worried that much about so long as we don't do the wrong thing when calling the linker.\r\n\r\nI think this is a very tricky problem, and the right solution might be to have different scoped-enabled fast math options. For a while I had an RFC I was working on that was going to propose enabling them in a manner similar to target_feature, which I think would be a good model for it. It explicitly allowed you to say \"this function requires strict floating point semantics, even if they required allowed in the caller\", but by default you'd inherit them from the caller...\r\n\r\nThere are a lot of cases where this can benefit stuff in portable_simd, and without *some* way of doing this, portable handling of edge cases like NaNs could easily make things... substantially slower (for example, fixing https://github.com/rust-lang/stdarch/pull/1155 sped up my code in a tight loop by 50%, and the code had... more to do than just min)\r\n\r\nThat said, I'm very sympathetic to the point made here: https://twitter.com/johnregehr/status/1440090854383706116, that defining \"fast-math\" in terms optimizations performed rather than semantics is just going to be a mess.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/923708838/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/923888973",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-923888973",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 923888973,
    "node_id": "IC_kwDOAAsO6M43EW1N",
    "user": {
      "login": "sollyucko",
      "id": 15565481,
      "node_id": "MDQ6VXNlcjE1NTY1NDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/15565481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sollyucko",
      "html_url": "https://github.com/sollyucko",
      "followers_url": "https://api.github.com/users/sollyucko/followers",
      "following_url": "https://api.github.com/users/sollyucko/following{/other_user}",
      "gists_url": "https://api.github.com/users/sollyucko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sollyucko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sollyucko/subscriptions",
      "organizations_url": "https://api.github.com/users/sollyucko/orgs",
      "repos_url": "https://api.github.com/users/sollyucko/repos",
      "events_url": "https://api.github.com/users/sollyucko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sollyucko/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-09-21T11:26:12Z",
    "updated_at": "2021-09-21T11:26:12Z",
    "body": "Drawing some inspiration from [the CakeML paper](https://cakeml.org/cav19.pdf), perhaps we could have an annotation to mark possible values (ranges and inf/NaN), and have an annotation to allow any value in the range spanned by every combination of real number and floating point evaluation (this should allow widening and fma, I think? - it could require some tolerance for rounding in the wrong direction; perhaps returning an adjacent floating point value (1 ulp away) should be allowed), as well as some way to specify looser error bounds (e.g. within this factor of either end of the range described).\r\nAdditionally, to deal with the issue of a subexpression being optimized differently in different places, perhaps it would have to be treated as a variable (\u201clet binding\u201d) when optimizing the outer expression, and meanwhile itself optimized independently. Also, should calling the same function multiple times with the same value be guaranteed to return the same output? This would probably require more attention around function inlining.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/923888973/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/924322207",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-924322207",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 924322207,
    "node_id": "IC_kwDOAAsO6M43GAmf",
    "user": {
      "login": "workingjubilee",
      "id": 46493976,
      "node_id": "MDQ6VXNlcjQ2NDkzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/workingjubilee",
      "html_url": "https://github.com/workingjubilee",
      "followers_url": "https://api.github.com/users/workingjubilee/followers",
      "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}",
      "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions",
      "organizations_url": "https://api.github.com/users/workingjubilee/orgs",
      "repos_url": "https://api.github.com/users/workingjubilee/repos",
      "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/workingjubilee/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-09-21T19:35:15Z",
    "updated_at": "2021-09-21T19:35:15Z",
    "body": "> Still not sure whether it affects Rust at all \u2014 crtfastmath.o is a linkage thing and the decision seems to be due to the compiler driver, not the backend codegen.\r\n\r\nDirectly? No. I am more noting it as a potential consequence of missteps: we shouldn't allow Rust code to be a \"bad citizen\" and change the results in unaffected programs, so we should be careful about e.g. allowing changing the FPCSR as an optimization.\r\n\r\nI agree with a scope-oriented model that would allow defining functions that have stricter or looser FP semantics, with a broadly similar model to `target_feature`. I envision something more equivalent to a particular kind of closure, but either way it would inherently describe the boundaries of such optimizations, and yes, it would be a massive boon to the portable SIMD planning, since such sites are likely going to see such annotations anyways.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/924322207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/969213918",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-969213918",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 969213918,
    "node_id": "IC_kwDOAAsO6M45xQfe",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-11-15T18:52:20Z",
    "updated_at": "2021-11-15T18:52:20Z",
    "body": "https://simonbyrne.github.io/notes/fastmath/ makes some good points about the perils of fast-math.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/969213918/reactions",
      "total_count": 6,
      "+1": 6,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/969844714",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-969844714",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 969844714,
    "node_id": "IC_kwDOAAsO6M45zqfq",
    "user": {
      "login": "JRF63",
      "id": 7283601,
      "node_id": "MDQ6VXNlcjcyODM2MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7283601?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JRF63",
      "html_url": "https://github.com/JRF63",
      "followers_url": "https://api.github.com/users/JRF63/followers",
      "following_url": "https://api.github.com/users/JRF63/following{/other_user}",
      "gists_url": "https://api.github.com/users/JRF63/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JRF63/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JRF63/subscriptions",
      "organizations_url": "https://api.github.com/users/JRF63/orgs",
      "repos_url": "https://api.github.com/users/JRF63/repos",
      "events_url": "https://api.github.com/users/JRF63/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JRF63/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-11-16T04:20:39Z",
    "updated_at": "2021-11-16T04:20:39Z",
    "body": "There's quite a lot of comments about rounding modes. Is it about GCC and other backends? Pretty sure LLVM's fast-math flags doesn't even touch that so there shouldn't be any problem of fast-math enabled Rust libraries messing up other code that will link to it.\r\n\r\nBesides couldn't we already do the really dangerous floating-point environment stuff like\r\n```rust\r\n#![feature(link_llvm_intrinsics)]\r\nextern {\r\n    #[link_name=\"llvm.set.rounding\"]\r\n    fn set_rounding(mode: i32);\r\n}\r\n```\r\nand also via the CSR intrinsics in `core::arch`?",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/969844714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1589427278",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-1589427278",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 1589427278,
    "node_id": "IC_kwDOAAsO6M5evLxO",
    "user": {
      "login": "stephanemagnenat",
      "id": 390278,
      "node_id": "MDQ6VXNlcjM5MDI3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/390278?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stephanemagnenat",
      "html_url": "https://github.com/stephanemagnenat",
      "followers_url": "https://api.github.com/users/stephanemagnenat/followers",
      "following_url": "https://api.github.com/users/stephanemagnenat/following{/other_user}",
      "gists_url": "https://api.github.com/users/stephanemagnenat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stephanemagnenat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stephanemagnenat/subscriptions",
      "organizations_url": "https://api.github.com/users/stephanemagnenat/orgs",
      "repos_url": "https://api.github.com/users/stephanemagnenat/repos",
      "events_url": "https://api.github.com/users/stephanemagnenat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stephanemagnenat/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-06-13T14:27:17Z",
    "updated_at": "2023-06-13T15:24:45Z",
    "body": "Just a note from a user here, attempting to progress on [Rust CV](https://github.com/rust-cv) by [optimizing the Akaze visual feature detector](https://github.com/rust-cv/cv/pull/68). The lack of even opt-in location-specific fast math (such as [`fadd_fast`](https://doc.rust-lang.org/std/intrinsics/fn.fadd_fast.html) and [`fmul_fast`](https://doc.rust-lang.org/std/intrinsics/fn.fmul_fast.html)) on stable hinders the use of Rust in some key algorithms for computer vision, robotics and augmented reality applications. For example, in some cases, the same simple filters are 5-7 times slower than they could be (see [this comparison](https://github.com/ZiCog/rust_convolution)). An alternative is to use SIMD directly, but the portable initiative has not landed yet and it is more work to rewrite the code in SIMD than simply writing reasonable loops that get auto-vectorized.\r\n\r\nI hope that such a user's perspective can be considered when discussing the dangers of fast math. Because for the language adoption in several modern fields, there is also something to lose by not having something like `fmul_fast` and `fadd_fast` (as unsafe operations for example) on stable.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1589427278/reactions",
      "total_count": 7,
      "+1": 7,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1589545878",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-1589545878",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 1589545878,
    "node_id": "IC_kwDOAAsO6M5evouW",
    "user": {
      "login": "jedbrown",
      "id": 3303,
      "node_id": "MDQ6VXNlcjMzMDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3303?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jedbrown",
      "html_url": "https://github.com/jedbrown",
      "followers_url": "https://api.github.com/users/jedbrown/followers",
      "following_url": "https://api.github.com/users/jedbrown/following{/other_user}",
      "gists_url": "https://api.github.com/users/jedbrown/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jedbrown/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jedbrown/subscriptions",
      "organizations_url": "https://api.github.com/users/jedbrown/orgs",
      "repos_url": "https://api.github.com/users/jedbrown/repos",
      "events_url": "https://api.github.com/users/jedbrown/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jedbrown/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-06-13T15:30:03Z",
    "updated_at": "2023-06-13T15:30:03Z",
    "body": "Are you able to probe (perhaps most easily in the C code since clang [exposes flags for each](https://clang.llvm.org/docs/UsersManual.html#cmdoption-ffast-math)) which of the flags are necessary? In particular, some like `-ffinite-math-only` must be unsafe in Rust, while others like `-ffp-contract=fast` can be made safe (with suitable intrinsics on stable).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1589545878/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1589604978",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-1589604978",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 1589604978,
    "node_id": "IC_kwDOAAsO6M5ev3Jy",
    "user": {
      "login": "stephanemagnenat",
      "id": 390278,
      "node_id": "MDQ6VXNlcjM5MDI3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/390278?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stephanemagnenat",
      "html_url": "https://github.com/stephanemagnenat",
      "followers_url": "https://api.github.com/users/stephanemagnenat/followers",
      "following_url": "https://api.github.com/users/stephanemagnenat/following{/other_user}",
      "gists_url": "https://api.github.com/users/stephanemagnenat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stephanemagnenat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stephanemagnenat/subscriptions",
      "organizations_url": "https://api.github.com/users/stephanemagnenat/orgs",
      "repos_url": "https://api.github.com/users/stephanemagnenat/repos",
      "events_url": "https://api.github.com/users/stephanemagnenat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stephanemagnenat/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-06-13T16:02:43Z",
    "updated_at": "2023-06-13T16:11:01Z",
    "body": "Ok, so using the C code in [the comparison](https://github.com/ZiCog/rust_convolution/blob/master/convolution.c), enabling `-Ofast` leads to factor 19 improvement compared to `-O3`! The smallest subset that leads to the improvement is `-fno-signed-zeros -fassociative-math` together. Removing either of them cancels it.\r\n\r\nThe comparison code is likely an extreme case as it looks like the compiler could really inline a lot.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1589604978/reactions",
      "total_count": 3,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1601798819",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-1601798819",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 1601798819,
    "node_id": "IC_kwDOAAsO6M5feYKj",
    "user": {
      "login": "workingjubilee",
      "id": 46493976,
      "node_id": "MDQ6VXNlcjQ2NDkzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/workingjubilee",
      "html_url": "https://github.com/workingjubilee",
      "followers_url": "https://api.github.com/users/workingjubilee/followers",
      "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}",
      "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions",
      "organizations_url": "https://api.github.com/users/workingjubilee/orgs",
      "repos_url": "https://api.github.com/users/workingjubilee/repos",
      "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/workingjubilee/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-06-21T23:00:13Z",
    "updated_at": "2023-06-21T23:00:13Z",
    "body": "@stephanemagnenat I assume you're using x86? What about with `RUSTFLAGS=-Ctarget-feature=+fma`?",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1601798819/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1638405165",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-1638405165",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 1638405165,
    "node_id": "IC_kwDOAAsO6M5hqBQt",
    "user": {
      "login": "Juke-Crusader",
      "id": 80852904,
      "node_id": "MDQ6VXNlcjgwODUyOTA0",
      "avatar_url": "https://avatars.githubusercontent.com/u/80852904?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Juke-Crusader",
      "html_url": "https://github.com/Juke-Crusader",
      "followers_url": "https://api.github.com/users/Juke-Crusader/followers",
      "following_url": "https://api.github.com/users/Juke-Crusader/following{/other_user}",
      "gists_url": "https://api.github.com/users/Juke-Crusader/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Juke-Crusader/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Juke-Crusader/subscriptions",
      "organizations_url": "https://api.github.com/users/Juke-Crusader/orgs",
      "repos_url": "https://api.github.com/users/Juke-Crusader/repos",
      "events_url": "https://api.github.com/users/Juke-Crusader/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Juke-Crusader/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-07-17T15:44:45Z",
    "updated_at": "2023-07-17T15:44:45Z",
    "body": "Does anyone know if the developers even remember that we need -ffast-math?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1638405165/reactions",
      "total_count": 5,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 5,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1639730112",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-1639730112",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 1639730112,
    "node_id": "IC_kwDOAAsO6M5hvEvA",
    "user": {
      "login": "stephanemagnenat",
      "id": 390278,
      "node_id": "MDQ6VXNlcjM5MDI3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/390278?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stephanemagnenat",
      "html_url": "https://github.com/stephanemagnenat",
      "followers_url": "https://api.github.com/users/stephanemagnenat/followers",
      "following_url": "https://api.github.com/users/stephanemagnenat/following{/other_user}",
      "gists_url": "https://api.github.com/users/stephanemagnenat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stephanemagnenat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stephanemagnenat/subscriptions",
      "organizations_url": "https://api.github.com/users/stephanemagnenat/orgs",
      "repos_url": "https://api.github.com/users/stephanemagnenat/repos",
      "events_url": "https://api.github.com/users/stephanemagnenat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stephanemagnenat/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-07-18T08:11:17Z",
    "updated_at": "2023-07-18T08:11:58Z",
    "body": "@workingjubilee yes I'm using x86-64. Using [that bench](https://github.com/ZiCog/rust_convolution), I got worst results using the `-Ctarget-feature=+fma` (except for the C version that sees a 8% improvement):\r\n\r\n```\r\ncargo +nightly bench\r\n[...]\r\ntest tests::bench_alice_convolution_parallel ... bench:      36,066 ns/iter (+/- 1,526)\r\ntest tests::bench_alice_convolution_serial   ... bench:       1,511 ns/iter (+/- 2)\r\ntest tests::bench_bjorn3_convolution         ... bench:       4,078 ns/iter (+/- 12)\r\ntest tests::bench_dodomorandi_convolution    ... bench:       3,459 ns/iter (+/- 17)\r\ntest tests::bench_pcpthm_convolution         ... bench:       1,507 ns/iter (+/- 5)\r\ntest tests::bench_zicog_convolution          ... bench:       1,595 ns/iter (+/- 3)\r\ntest tests::bench_zicog_convolution_fast     ... bench:       1,597 ns/iter (+/- 4)\r\ntest tests::bench_zicog_convolution_safe     ... bench:       3,456 ns/iter (+/- 12)\r\ntest tests::bench_zso_convolution            ... bench:      13,078 ns/iter (+/- 7)\r\ntest tests::bench_zso_convolution_ffi        ... bench:       1,209 ns/iter (+/- 48)\r\n```\r\n\r\nvs\r\n\r\n```\r\nRUSTFLAGS=-Ctarget-feature=+fma cargo +nightly bench\r\n[...]\r\ntest tests::bench_alice_convolution_parallel ... bench:      36,376 ns/iter (+/- 1,729)\r\ntest tests::bench_alice_convolution_serial   ... bench:       6,499 ns/iter (+/- 74)\r\ntest tests::bench_bjorn3_convolution         ... bench:       4,057 ns/iter (+/- 24)\r\ntest tests::bench_dodomorandi_convolution    ... bench:       3,463 ns/iter (+/- 28)\r\ntest tests::bench_pcpthm_convolution         ... bench:       6,602 ns/iter (+/- 25)\r\ntest tests::bench_zicog_convolution          ... bench:       3,723 ns/iter (+/- 71)\r\ntest tests::bench_zicog_convolution_fast     ... bench:       6,787 ns/iter (+/- 40)\r\ntest tests::bench_zicog_convolution_safe     ... bench:       3,437 ns/iter (+/- 15)\r\ntest tests::bench_zso_convolution            ... bench:      13,073 ns/iter (+/- 86)\r\ntest tests::bench_zso_convolution_ffi        ... bench:       1,120 ns/iter (+/- 38)\r\n```\r\n\r\nUsing an AMD Ryzen 9 7950X CPU. This is somewhat surprising. The `+fma` seems to break std::simd parallelization.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1639730112/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1641524906",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-1641524906",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 1641524906,
    "node_id": "IC_kwDOAAsO6M5h166q",
    "user": {
      "login": "workingjubilee",
      "id": 46493976,
      "node_id": "MDQ6VXNlcjQ2NDkzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/workingjubilee",
      "html_url": "https://github.com/workingjubilee",
      "followers_url": "https://api.github.com/users/workingjubilee/followers",
      "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}",
      "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions",
      "organizations_url": "https://api.github.com/users/workingjubilee/orgs",
      "repos_url": "https://api.github.com/users/workingjubilee/repos",
      "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/workingjubilee/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-07-19T06:59:18Z",
    "updated_at": "2023-07-19T06:59:18Z",
    "body": "That's... Very Weird, given that usually it significantly improves it.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1641524906/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1641528500",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-1641528500",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 1641528500,
    "node_id": "IC_kwDOAAsO6M5h17y0",
    "user": {
      "login": "stephanemagnenat",
      "id": 390278,
      "node_id": "MDQ6VXNlcjM5MDI3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/390278?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stephanemagnenat",
      "html_url": "https://github.com/stephanemagnenat",
      "followers_url": "https://api.github.com/users/stephanemagnenat/followers",
      "following_url": "https://api.github.com/users/stephanemagnenat/following{/other_user}",
      "gists_url": "https://api.github.com/users/stephanemagnenat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stephanemagnenat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stephanemagnenat/subscriptions",
      "organizations_url": "https://api.github.com/users/stephanemagnenat/orgs",
      "repos_url": "https://api.github.com/users/stephanemagnenat/repos",
      "events_url": "https://api.github.com/users/stephanemagnenat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stephanemagnenat/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-07-19T07:02:27Z",
    "updated_at": "2023-07-19T07:02:27Z",
    "body": "> That's... Very Weird, given that usually it significantly improves it.\r\n\r\nI fully agree, I don't think I made a mistake but that's always a possibility. It would be interesting for others to try to replicate this little experiment, it is very easy to do: just clone the repo, and run the benchmark, with and without the `+fma` flag.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1641528500/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1642015630",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-1642015630",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 1642015630,
    "node_id": "IC_kwDOAAsO6M5h3yuO",
    "user": {
      "login": "Demindiro",
      "id": 17316999,
      "node_id": "MDQ6VXNlcjE3MzE2OTk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/17316999?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Demindiro",
      "html_url": "https://github.com/Demindiro",
      "followers_url": "https://api.github.com/users/Demindiro/followers",
      "following_url": "https://api.github.com/users/Demindiro/following{/other_user}",
      "gists_url": "https://api.github.com/users/Demindiro/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Demindiro/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Demindiro/subscriptions",
      "organizations_url": "https://api.github.com/users/Demindiro/orgs",
      "repos_url": "https://api.github.com/users/Demindiro/repos",
      "events_url": "https://api.github.com/users/Demindiro/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Demindiro/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-07-19T12:43:26Z",
    "updated_at": "2023-07-19T12:43:26Z",
    "body": "@stephanemagnenat I observe the same slowdown with `-C target-cpu=native` (CPU is 5800X)\r\n\r\n```\r\n$ cargo bench\r\n...\r\ntest tests::bench_alice_convolution_parallel ... bench:      16,976 ns/iter (+/- 2,312)\r\ntest tests::bench_alice_convolution_serial   ... bench:       1,803 ns/iter (+/- 83)\r\ntest tests::bench_bjorn3_convolution         ... bench:       5,006 ns/iter (+/- 183)\r\ntest tests::bench_dodomorandi_convolution    ... bench:       4,033 ns/iter (+/- 124)\r\ntest tests::bench_pcpthm_convolution         ... bench:       1,570 ns/iter (+/- 23)\r\ntest tests::bench_zicog_convolution          ... bench:       1,800 ns/iter (+/- 34)\r\ntest tests::bench_zicog_convolution_fast     ... bench:       1,803 ns/iter (+/- 41)\r\ntest tests::bench_zicog_convolution_safe     ... bench:       4,207 ns/iter (+/- 106)\r\ntest tests::bench_zso_convolution            ... bench:      17,090 ns/iter (+/- 525)\r\ntest tests::bench_zso_convolution_ffi        ... bench:       1,750 ns/iter (+/- 21)\r\n\r\nRUSTFLAGS='-C target-cpu=native' cargo bench\r\n...\r\ntest tests::bench_alice_convolution_parallel ... bench:      18,092 ns/iter (+/- 2,504)\r\ntest tests::bench_alice_convolution_serial   ... bench:       5,406 ns/iter (+/- 94)\r\ntest tests::bench_bjorn3_convolution         ... bench:       5,298 ns/iter (+/- 111)\r\ntest tests::bench_dodomorandi_convolution    ... bench:       4,285 ns/iter (+/- 19)\r\ntest tests::bench_pcpthm_convolution         ... bench:       7,642 ns/iter (+/- 73)\r\ntest tests::bench_zicog_convolution          ... bench:       5,214 ns/iter (+/- 42)\r\ntest tests::bench_zicog_convolution_fast     ... bench:       4,979 ns/iter (+/- 90)\r\ntest tests::bench_zicog_convolution_safe     ... bench:       4,447 ns/iter (+/- 129)\r\ntest tests::bench_zso_convolution            ... bench:      17,767 ns/iter (+/- 799)\r\ntest tests::bench_zso_convolution_ffi        ... bench:       1,613 ns/iter (+/- 14)\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1642015630/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1642017997",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-1642017997",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 1642017997,
    "node_id": "IC_kwDOAAsO6M5h3zTN",
    "user": {
      "login": "Demindiro",
      "id": 17316999,
      "node_id": "MDQ6VXNlcjE3MzE2OTk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/17316999?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Demindiro",
      "html_url": "https://github.com/Demindiro",
      "followers_url": "https://api.github.com/users/Demindiro/followers",
      "following_url": "https://api.github.com/users/Demindiro/following{/other_user}",
      "gists_url": "https://api.github.com/users/Demindiro/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Demindiro/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Demindiro/subscriptions",
      "organizations_url": "https://api.github.com/users/Demindiro/orgs",
      "repos_url": "https://api.github.com/users/Demindiro/repos",
      "events_url": "https://api.github.com/users/Demindiro/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Demindiro/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-07-19T12:45:12Z",
    "updated_at": "2023-07-19T12:45:12Z",
    "body": "... which in hindsight is obvious, as it enables the feature :facepalm: ",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1642017997/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2167610256",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2167610256",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2167610256,
    "node_id": "IC_kwDOAAsO6M6BMxuQ",
    "user": {
      "login": "StHagel",
      "id": 43622971,
      "node_id": "MDQ6VXNlcjQzNjIyOTcx",
      "avatar_url": "https://avatars.githubusercontent.com/u/43622971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StHagel",
      "html_url": "https://github.com/StHagel",
      "followers_url": "https://api.github.com/users/StHagel/followers",
      "following_url": "https://api.github.com/users/StHagel/following{/other_user}",
      "gists_url": "https://api.github.com/users/StHagel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StHagel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StHagel/subscriptions",
      "organizations_url": "https://api.github.com/users/StHagel/orgs",
      "repos_url": "https://api.github.com/users/StHagel/repos",
      "events_url": "https://api.github.com/users/StHagel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StHagel/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-06-14T09:17:39Z",
    "updated_at": "2024-06-14T09:17:39Z",
    "body": "While I do think that adding an option to enable fast-math in Rust is definitely desireable,  I don't like the idea of making a new type for it however.\r\n\r\nI would rather make it an optional compiler flag, that is not set by default in `--release`. This way I can run my existing code with fast-math enabled if I want to and not use fast-math if I don't want to. Adding a new type would require me to either change all `f64`s to `f64fast` in my entire codebase or go through every function and think about whether it makes sense to use `f64fast` here or not and add `var as f64` and `var as f64fast` all over the place.\r\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2167610256/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2167631104",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2167631104",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2167631104,
    "node_id": "IC_kwDOAAsO6M6BM20A",
    "user": {
      "login": "NobodyXu",
      "id": 30436523,
      "node_id": "MDQ6VXNlcjMwNDM2NTIz",
      "avatar_url": "https://avatars.githubusercontent.com/u/30436523?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NobodyXu",
      "html_url": "https://github.com/NobodyXu",
      "followers_url": "https://api.github.com/users/NobodyXu/followers",
      "following_url": "https://api.github.com/users/NobodyXu/following{/other_user}",
      "gists_url": "https://api.github.com/users/NobodyXu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NobodyXu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NobodyXu/subscriptions",
      "organizations_url": "https://api.github.com/users/NobodyXu/orgs",
      "repos_url": "https://api.github.com/users/NobodyXu/repos",
      "events_url": "https://api.github.com/users/NobodyXu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NobodyXu/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-06-14T09:28:52Z",
    "updated_at": "2024-06-14T09:28:52Z",
    "body": "Putting it in profile,  allowing each crate to set it, and allowing the binary crate to override it per-crate seems to make sense.\n\nYou could then enable it for your library crate if you know it is safe , and for binary crate they can disable it if it turns out doesn't work, or enable it if they know what they are doing.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2167631104/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2167664644",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2167664644",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2167664644,
    "node_id": "IC_kwDOAAsO6M6BM_AE",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-06-14T09:47:47Z",
    "updated_at": "2024-06-14T09:49:43Z",
    "body": "Making it a compile flag that applies to *other crates* sounds like a terrible idea. When you download a crate from the internet, you can't know whether it was written in a way that is compatible with fast-math semantics. It is very important not to apply fast-math semantics to code that assumes IEEE semantics.\r\n\r\nWe could have a crate-level attribute meaning \"all floating-point ops in this crate are fast-math\", but under no circumstances should you be able to force fast-math on other people's code. That would ultimately even undermine Rust's safety promise.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2167664644/reactions",
      "total_count": 9,
      "+1": 7,
      "-1": 1,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2167677724",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2167677724",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2167677724,
    "node_id": "IC_kwDOAAsO6M6BNCMc",
    "user": {
      "login": "StHagel",
      "id": 43622971,
      "node_id": "MDQ6VXNlcjQzNjIyOTcx",
      "avatar_url": "https://avatars.githubusercontent.com/u/43622971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StHagel",
      "html_url": "https://github.com/StHagel",
      "followers_url": "https://api.github.com/users/StHagel/followers",
      "following_url": "https://api.github.com/users/StHagel/following{/other_user}",
      "gists_url": "https://api.github.com/users/StHagel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StHagel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StHagel/subscriptions",
      "organizations_url": "https://api.github.com/users/StHagel/orgs",
      "repos_url": "https://api.github.com/users/StHagel/repos",
      "events_url": "https://api.github.com/users/StHagel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StHagel/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-06-14T09:55:36Z",
    "updated_at": "2024-06-14T09:55:36Z",
    "body": "> We could have a crate-level attribute meaning \"all floating-point ops in this crate are fast-math\", but under no circumstances should you be able to force fast-math on other people's code.\r\n\r\nThat sounds like a good path to go on in my eyes. Being able to set an attribute in the Cargo.toml which basically means \"This crate is fast-math-safe\". Compiling your code with fast-math on would then check every dependency whether it is fast-math-safe or not and compile it accordingly.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2167677724/reactions",
      "total_count": 5,
      "+1": 5,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2167711288",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2167711288",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2167711288,
    "node_id": "IC_kwDOAAsO6M6BNKY4",
    "user": {
      "login": "usamoi",
      "id": 79277854,
      "node_id": "MDQ6VXNlcjc5Mjc3ODU0",
      "avatar_url": "https://avatars.githubusercontent.com/u/79277854?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/usamoi",
      "html_url": "https://github.com/usamoi",
      "followers_url": "https://api.github.com/users/usamoi/followers",
      "following_url": "https://api.github.com/users/usamoi/following{/other_user}",
      "gists_url": "https://api.github.com/users/usamoi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/usamoi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/usamoi/subscriptions",
      "organizations_url": "https://api.github.com/users/usamoi/orgs",
      "repos_url": "https://api.github.com/users/usamoi/repos",
      "events_url": "https://api.github.com/users/usamoi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/usamoi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-06-14T10:15:41Z",
    "updated_at": "2024-06-14T10:15:41Z",
    "body": "I use `core::intrinsics::f*_fast` or `core::intrinsics::f*_algebraic` to hint compiler for auto vectorization and it totally works. The only thing that I care about is these functions are gated with `core_intrinsics`, which seems quite awkward.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2167711288/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2629547436",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2629547436",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2629547436,
    "node_id": "IC_kwDOAAsO6M6cu7Ws",
    "user": {
      "login": "calder",
      "id": 52222,
      "node_id": "MDQ6VXNlcjUyMjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/52222?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/calder",
      "html_url": "https://github.com/calder",
      "followers_url": "https://api.github.com/users/calder/followers",
      "following_url": "https://api.github.com/users/calder/following{/other_user}",
      "gists_url": "https://api.github.com/users/calder/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/calder/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/calder/subscriptions",
      "organizations_url": "https://api.github.com/users/calder/orgs",
      "repos_url": "https://api.github.com/users/calder/repos",
      "events_url": "https://api.github.com/users/calder/events{/privacy}",
      "received_events_url": "https://api.github.com/users/calder/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-02T20:42:14Z",
    "updated_at": "2025-02-02T23:45:55Z",
    "body": "What's preventing us from stabilizing `core::intrinsics::f*_algebraic` today? Those are probably sufficient for 90% of cases where you're optimizing an inner loop and are fine with individual ops being reassociated.\n\nHere's a simple example where stable Rust is 8x slower than C++ (dot product of two 100,000 element `f32` vectors) because there's no way of telling the compiler that it's OK to reorder ops to enable vectorization:\n* C++ with `#pragma clang fp reassociate(on)`: **10us**\n* Rust nightly with `core::intrinsics::f[add|mul]_fast`: **10us**\n* Rust stable: **84us**\n\nhttps://github.com/calder/dot-bench\n\n**EDIT:** Confirmed this would work great and close the performance gap with nightly: https://github.com/calder/rust/commit/c3c7fabe5e55e2fc4fbaae3cb963df7d156c5015",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2629547436/reactions",
      "total_count": 5,
      "+1": 5,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2630671556",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2630671556",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2630671556,
    "node_id": "IC_kwDOAAsO6M6czNzE",
    "user": {
      "login": "StHagel",
      "id": 43622971,
      "node_id": "MDQ6VXNlcjQzNjIyOTcx",
      "avatar_url": "https://avatars.githubusercontent.com/u/43622971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StHagel",
      "html_url": "https://github.com/StHagel",
      "followers_url": "https://api.github.com/users/StHagel/followers",
      "following_url": "https://api.github.com/users/StHagel/following{/other_user}",
      "gists_url": "https://api.github.com/users/StHagel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StHagel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StHagel/subscriptions",
      "organizations_url": "https://api.github.com/users/StHagel/orgs",
      "repos_url": "https://api.github.com/users/StHagel/repos",
      "events_url": "https://api.github.com/users/StHagel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StHagel/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-03T11:23:54Z",
    "updated_at": "2025-02-03T11:23:54Z",
    "body": "> **EDIT:** Confirmed this would work great and close the performance gap with nightly: [calder@c3c7fab](https://github.com/calder/rust/commit/c3c7fabe5e55e2fc4fbaae3cb963df7d156c5015)\n\nThat looks awesome, thanks for putting in the work!\nHow would one use algebraic operations in practice then? Only with `a.add_algebraic(b)` or would there be an option to overwrite the usual operators (`+-*/%`) with algebraic ones, so one doesn't have to rewrite lots of code?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2630671556/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2632629140",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2632629140",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2632629140,
    "node_id": "IC_kwDOAAsO6M6c6ruU",
    "user": {
      "login": "calder",
      "id": 52222,
      "node_id": "MDQ6VXNlcjUyMjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/52222?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/calder",
      "html_url": "https://github.com/calder",
      "followers_url": "https://api.github.com/users/calder/followers",
      "following_url": "https://api.github.com/users/calder/following{/other_user}",
      "gists_url": "https://api.github.com/users/calder/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/calder/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/calder/subscriptions",
      "organizations_url": "https://api.github.com/users/calder/orgs",
      "repos_url": "https://api.github.com/users/calder/repos",
      "events_url": "https://api.github.com/users/calder/events{/privacy}",
      "received_events_url": "https://api.github.com/users/calder/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-04T02:30:59Z",
    "updated_at": "2025-02-04T02:31:40Z",
    "body": "Only `a.algebraic_*(b)` functions for now to unblock 90% of use cases with as little controversy as possible (this issue has been open for 10 years and there's _still_ no way to tell stable Rust to allow reordering) but other people / library authors can follow up with more.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2632629140/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2661836756",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2661836756",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2661836756,
    "node_id": "IC_kwDOAAsO6M6eqGfU",
    "user": {
      "login": "RReverser",
      "id": 557590,
      "node_id": "MDQ6VXNlcjU1NzU5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/557590?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RReverser",
      "html_url": "https://github.com/RReverser",
      "followers_url": "https://api.github.com/users/RReverser/followers",
      "following_url": "https://api.github.com/users/RReverser/following{/other_user}",
      "gists_url": "https://api.github.com/users/RReverser/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RReverser/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RReverser/subscriptions",
      "organizations_url": "https://api.github.com/users/RReverser/orgs",
      "repos_url": "https://api.github.com/users/RReverser/repos",
      "events_url": "https://api.github.com/users/RReverser/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RReverser/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-17T02:48:50Z",
    "updated_at": "2025-02-17T02:48:50Z",
    "body": "> We could have a crate-level attribute meaning \"all floating-point ops in this crate are fast-math\", but under no circumstances should you be able to force fast-math on other people's code. That would ultimately even undermine Rust's safety promise.\n\nIt sounds like an even better fit could be a custom `target_feature`, although not sure if we are allowed to extend it with what is not, in fact, a \"target\" CPU feature.\n\nThe syntax seems like a very good fit though:\n\n```rust\n#[target_feature(enable = \"fast_math\")]\nunsafe fn i_promise_its_ok_to_reorder_math_in_me() { ... }\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2661836756/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2661901301",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2661901301",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2661901301,
    "node_id": "IC_kwDOAAsO6M6eqWP1",
    "user": {
      "login": "jgarvin",
      "id": 102322,
      "node_id": "MDQ6VXNlcjEwMjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/102322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jgarvin",
      "html_url": "https://github.com/jgarvin",
      "followers_url": "https://api.github.com/users/jgarvin/followers",
      "following_url": "https://api.github.com/users/jgarvin/following{/other_user}",
      "gists_url": "https://api.github.com/users/jgarvin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jgarvin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jgarvin/subscriptions",
      "organizations_url": "https://api.github.com/users/jgarvin/orgs",
      "repos_url": "https://api.github.com/users/jgarvin/repos",
      "events_url": "https://api.github.com/users/jgarvin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jgarvin/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-17T03:45:57Z",
    "updated_at": "2025-02-17T03:45:57Z",
    "body": "> Making it a compile flag that applies to _other crates_ sounds like a terrible idea. When you download a crate from the internet, you can't know whether it was written in a way that is compatible with fast-math semantics. It is very important not to apply fast-math semantics to code that assumes IEEE semantics.\n\nMost float code doesn't assume or even consider IEEE semantics though. Most users of floating point don't know anything about the rounding guarantees or numerical stability or how the encoding works. Unfortunately likely a lot of code that works just fine with `-ffast-math` or equivalent and gets a significant performance benefit. I don't know the history but I suspect this is one of the reasons the flag exists in GCC. I have definitely seen it make autovec work when it otherwise didn't.\n\n> We could have a crate-level attribute meaning \"all floating-point ops in this crate are fast-math\", but under no circumstances should you be able to force fast-math on other people's code. That would ultimately even undermine Rust's safety promise.\n\nI think it would be consistent with the rest of Rust if you were allowed to but it required using `unsafe` in Cargo.toml and when invoking an associated rustc flag. I don't think there's a concept of unsafe compile options currently but I can think of others that would be interesting like disabling bounds checks (even if you intend to use them, useful for measuring to make the case it's not a big perf impact).",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2661901301/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2662290441",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2662290441",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2662290441,
    "node_id": "IC_kwDOAAsO6M6er1QJ",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-17T07:42:01Z",
    "updated_at": "2025-02-17T07:50:56Z",
    "body": "No, a target feature is definitely wrong as that can be set via `-Ctarget-feature` globally, but you must never be able to apply this flag to other people's code without them opting-in. This is *definitely* true for the UB-inducing `-ffast-math`; Rust will *not* compromise its memory safety over floating-point performance concerns. \"Most code would still be sound\" is not good enough. The chances of Rust adopting an approach that can break soundness are 0, no matter how many flags GCC has (which are equally unsound but being C, that's fine for them).\n\nA blanket global explicitly unsafe flag is also not going to fly; what would the safety comment for that even look like? \"I audited all the code in my entire dependency tree\"? The point of `unsafe` is to make things locally auditable; this flag cannot achieve that.\n\nIMO the same goes even for the \"just produces wrong results\" variant (not sure if that has a standard name, it corresponds to the operations described in https://github.com/rust-lang/libs-team/issues/532). We don't just go and alter the semantics of other people's code. In particular, this would be a breaking change as we'd have to take back what we say in https://doc.rust-lang.org/nightly/std/primitive.f32.html.\n\nSo, I would recommend the discussion to focus on ways to opt-in to these semantics locally, in a way controlled by the author of the respective code. Everything else is either an outright no-go (if it can break soundness) or at least highly unlikely to lead anywhere (if it breaks stable semantic promises).",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2662290441/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 1,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2662812439",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2662812439",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2662812439,
    "node_id": "IC_kwDOAAsO6M6et0sX",
    "user": {
      "login": "RReverser",
      "id": 557590,
      "node_id": "MDQ6VXNlcjU1NzU5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/557590?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RReverser",
      "html_url": "https://github.com/RReverser",
      "followers_url": "https://api.github.com/users/RReverser/followers",
      "following_url": "https://api.github.com/users/RReverser/following{/other_user}",
      "gists_url": "https://api.github.com/users/RReverser/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RReverser/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RReverser/subscriptions",
      "organizations_url": "https://api.github.com/users/RReverser/orgs",
      "repos_url": "https://api.github.com/users/RReverser/repos",
      "events_url": "https://api.github.com/users/RReverser/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RReverser/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-17T11:18:17Z",
    "updated_at": "2025-02-17T11:18:17Z",
    "body": "> No, a target feature is definitely wrong as that can be set via `-Ctarget-feature` globally, but you must never be able to apply this flag to other people's code without them opting-in.\n\nAh, true enough, forgot about the global switch. To me, the primary appeal of this syntax is the locality - ability to turn it on on per-function basis, and that sounds like something we agree on. I'm equally happy if it was a different attribute that can still be applied on per-function granularity.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2662812439/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2663208253",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2663208253",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2663208253,
    "node_id": "IC_kwDOAAsO6M6evVU9",
    "user": {
      "login": "kornelski",
      "id": 72159,
      "node_id": "MDQ6VXNlcjcyMTU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kornelski",
      "html_url": "https://github.com/kornelski",
      "followers_url": "https://api.github.com/users/kornelski/followers",
      "following_url": "https://api.github.com/users/kornelski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions",
      "organizations_url": "https://api.github.com/users/kornelski/orgs",
      "repos_url": "https://api.github.com/users/kornelski/repos",
      "events_url": "https://api.github.com/users/kornelski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kornelski/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-17T13:55:24Z",
    "updated_at": "2025-02-17T13:55:24Z",
    "body": "Per-function attributes have a hard to resolve issue of how \"deep\" they apply. If the attributes applied to all code called or inlined in the function body, then they could affect code of other crates, which is a no-no. If the attributes applied only in a shallow way, not through method calls, then it could be frustrating that methods on f32 won't be affected (since they're in core), and there would be visible difference between `f32 + f32` lowered to a dedicated MIR instruction and a call to `f32::add`. Attributes on closures aren't fully supported. Specifying how to control the exact scope of attributes may turn out to be a big task.\n\nPreviously I've proposed having a fast float type built-in into Rust, like `r32`, but there are many different guarantees/optimizations that users could theoretically want (finite, non-NaN, no subnormals, rounding), so this proposal died in bikeshedding.\n\nTherefore, stabilization of fast-math intrinsics seems like the most realistic path forward: https://github.com/rust-lang/rust/issues/21690#issuecomment-2629547436\n\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2663208253/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2663440124",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2663440124",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2663440124,
    "node_id": "IC_kwDOAAsO6M6ewN78",
    "user": {
      "login": "RReverser",
      "id": 557590,
      "node_id": "MDQ6VXNlcjU1NzU5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/557590?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RReverser",
      "html_url": "https://github.com/RReverser",
      "followers_url": "https://api.github.com/users/RReverser/followers",
      "following_url": "https://api.github.com/users/RReverser/following{/other_user}",
      "gists_url": "https://api.github.com/users/RReverser/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RReverser/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RReverser/subscriptions",
      "organizations_url": "https://api.github.com/users/RReverser/orgs",
      "repos_url": "https://api.github.com/users/RReverser/repos",
      "events_url": "https://api.github.com/users/RReverser/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RReverser/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-17T15:26:56Z",
    "updated_at": "2025-02-17T15:26:56Z",
    "body": "> If the attributes applied to all code called or inlined in the function body, then they could affect code of other crates, which is a no-no\n\nI'm not sure I agree with that. I agree with the sentiment above, that global toggle affecting arbitrary crates is a no-no, but I'd say anything invoked from a function marked with such attribute is a fair game - same as, when you mark a function with target_feature, the autovectorizer can roam free over both direct function body and any code indirectly inlined in it. (this is also the reason why, like with target_feature, I think this should require `unsafe`)\n\nIf anything, not being able to leverage same optimisations for std and existing third-party APIs that work on floats, despite an explicit attribute on my function, would make this near-useless except for very niche microoptimisations. At that point, if I have to do those microoptimisations manually anyway, I might as well reorder code and use 3rd party crates myself instead of using new intrinsics.\n\nIt's specifically the \"automatic optimisation\" that makes fast-math so valuable.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2663440124/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2663524807",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2663524807",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2663524807,
    "node_id": "IC_kwDOAAsO6M6ewinH",
    "user": {
      "login": "hanna-kruppe",
      "id": 2311707,
      "node_id": "MDQ6VXNlcjIzMTE3MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2311707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hanna-kruppe",
      "html_url": "https://github.com/hanna-kruppe",
      "followers_url": "https://api.github.com/users/hanna-kruppe/followers",
      "following_url": "https://api.github.com/users/hanna-kruppe/following{/other_user}",
      "gists_url": "https://api.github.com/users/hanna-kruppe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hanna-kruppe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hanna-kruppe/subscriptions",
      "organizations_url": "https://api.github.com/users/hanna-kruppe/orgs",
      "repos_url": "https://api.github.com/users/hanna-kruppe/repos",
      "events_url": "https://api.github.com/users/hanna-kruppe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hanna-kruppe/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-17T16:01:42Z",
    "updated_at": "2025-02-17T16:01:42Z",
    "body": "Target feature is only unsafe because you have to make sure the CPU you\u2019re running on will recognize the instructions that the compiler may emit in that function. It doesn\u2019t otherwise affect the semantics of the code and especially not of any code that happens to get inlined into it. If it did, we couldn\u2019t have it apply to inlined code because it would face the same problem as fast math flags: the caller is generally not able to judge whether the callee could handle the change in semantics gracefully or not. Yes, this makes it very hard to use any third party code in loops that you want to see auto-vectorized. The proper solution is to get the authors of the third party loop to opt into it (this is already possible today), or to declare that they\u2019re fine with either semantics (needs language design).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2663524807/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2663548885",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2663548885",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2663548885,
    "node_id": "IC_kwDOAAsO6M6ewofV",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-17T16:09:48Z",
    "updated_at": "2025-02-17T16:09:48Z",
    "body": "The autovectorizer does not change program semantics. So these situations are not comparable. Fast-math is not an \"optimization\", it is askinh for different program behavior.\n\nExposing (a version of) the intrinsics is tracked at <https://github.com/rust-lang/rust/issues/136469>. Thanks for taking the initiative on that! It is not clear to me if this long-winded thread still serves any purpose. There is more design space to explore here, but keeping open an issue with 100 comments (many outdated) is not useful for that purpose. Is there anything reasonably concrete / actionable we still want to track here?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2663548885/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 1,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2664008758",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2664008758",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2664008758,
    "node_id": "IC_kwDOAAsO6M6eyYw2",
    "user": {
      "login": "tgross35",
      "id": 13724985,
      "node_id": "MDQ6VXNlcjEzNzI0OTg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13724985?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tgross35",
      "html_url": "https://github.com/tgross35",
      "followers_url": "https://api.github.com/users/tgross35/followers",
      "following_url": "https://api.github.com/users/tgross35/following{/other_user}",
      "gists_url": "https://api.github.com/users/tgross35/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tgross35/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tgross35/subscriptions",
      "organizations_url": "https://api.github.com/users/tgross35/orgs",
      "repos_url": "https://api.github.com/users/tgross35/repos",
      "events_url": "https://api.github.com/users/tgross35/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tgross35/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-17T20:20:18Z",
    "updated_at": "2025-02-17T20:20:18Z",
    "body": "Agreeing with Ralf, I am going to close this. The reassociation part of fast math is unstably available at https://github.com/rust-lang/rust/issues/136469. If anybody still has a need for FTZ/DAZ variants or unsafe variants that poison NaN/inf, feel free to open a fresh issue or propose directly as an ACP.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2664008758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2664167534",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2664167534",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2664167534,
    "node_id": "IC_kwDOAAsO6M6ey_hu",
    "user": {
      "login": "jgarvin",
      "id": 102322,
      "node_id": "MDQ6VXNlcjEwMjMyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/102322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jgarvin",
      "html_url": "https://github.com/jgarvin",
      "followers_url": "https://api.github.com/users/jgarvin/followers",
      "following_url": "https://api.github.com/users/jgarvin/following{/other_user}",
      "gists_url": "https://api.github.com/users/jgarvin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jgarvin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jgarvin/subscriptions",
      "organizations_url": "https://api.github.com/users/jgarvin/orgs",
      "repos_url": "https://api.github.com/users/jgarvin/repos",
      "events_url": "https://api.github.com/users/jgarvin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jgarvin/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-17T22:28:19Z",
    "updated_at": "2025-02-17T22:28:19Z",
    "body": "> Rust will not compromise its memory safety over floating-point performance concerns. \"Most code would still be sound\" is not good enough. \n\nRust compromises its memory safety all the time when you use an `unsafe`, that's why I only suggested it being behind a use of `unsafe`.\n\n> A blanket global explicitly unsafe flag is also not going to fly; what would the safety comment for that even look like? \"I audited all the code in my entire dependency tree\"? The point of unsafe is to make things locally auditable; this flag cannot achieve that.\n\nNo, you would attach it to specific dependencies. It's a similar procedure to any time you have optional unsafe code. When you suspect unsafety is causing a problem you turn off the unsafe flag everywhere and if that fixes the issue you begin binary searching your dependencies.\n\n> Everything else is either an outright no-go (if it can break soundness) or at least highly unlikely to lead anywhere (if it breaks stable semantic promises).\n\nThere is no promise being broken unless a library author has specifically advertised their library as being safe to use with it (and some probably would).\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2664167534/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2664787927",
    "html_url": "https://github.com/rust-lang/rust/issues/21690#issuecomment-2664787927",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21690",
    "id": 2664787927,
    "node_id": "IC_kwDOAAsO6M6e1W_X",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-02-18T07:10:46Z",
    "updated_at": "2025-02-18T07:15:35Z",
    "body": "> No, you would attach it to specific dependencies. It's a similar procedure to any time you have optional unsafe code.\n\nNo, this is not even remotely similar to anything we have currently. Nothing in Rust currently lets you unilaterally alter the behavior of *code in your dependencies*. Even if you did audit that entire crate, it's totally permitted under semver for a minor version bump of the crate to start using floating-point operations in a new way, voiding your audit.\n\nRust is generally carefully designed so that the only thing you ever can or have to know about another crate is its public API surface and the associated documentation. This would completely undermine that.\n\nEverything about this flag fundamentally clashes with the idea of robust, compositional system design. It was a terrible mistake to ever add it to C compilers, and Rust should not repeat that mistake. Rust should instead explore alternative, less fragile ways of exposing those semantics. (That's just my personal opinion, I am not speaking for any team here. But I consider it quite likely that many t-lang and t-opsem people will agree with this sentiment.) A first step has been done and is tracked in https://github.com/rust-lang/rust/issues/136469. Maybe a second step is a per-function / per-module / per-crate attribute, though that will have to explain convincingly which issue is solved by this that the algebraic operations do not solve yet. A sort of pre-RFC on IRLO would likely be a good starting point here; please do not try to design something from scratch in this issue.\n\nAlso please stop rehashing points that have already been made many times above. I get that not everyone agrees with the Rust design philosophy, but it's not going to change without demonstrating that all conceivable alternatives have been explored and they are all clearly inferior.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2664787927/reactions",
      "total_count": 6,
      "+1": 3,
      "-1": 3,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
