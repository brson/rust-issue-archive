[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/18115126",
    "html_url": "https://github.com/rust-lang/rust/issues/6613#issuecomment-18115126",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/6613",
    "id": 18115126,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4MTE1MTI2",
    "user": {
      "login": "cscott",
      "id": 156080,
      "node_id": "MDQ6VXNlcjE1NjA4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/156080?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cscott",
      "html_url": "https://github.com/cscott",
      "followers_url": "https://api.github.com/users/cscott/followers",
      "following_url": "https://api.github.com/users/cscott/following{/other_user}",
      "gists_url": "https://api.github.com/users/cscott/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cscott/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cscott/subscriptions",
      "organizations_url": "https://api.github.com/users/cscott/orgs",
      "repos_url": "https://api.github.com/users/cscott/repos",
      "events_url": "https://api.github.com/users/cscott/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cscott/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-05-19T09:53:23Z",
    "updated_at": "2013-05-19T09:53:23Z",
    "body": "http://paste.debian.net/5129/ is the original longer example.  (But I'm mostly commenting here just to add myself to the cc list.)\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/18115126/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/18127661",
    "html_url": "https://github.com/rust-lang/rust/issues/6613#issuecomment-18127661",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/6613",
    "id": 18127661,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4MTI3NjYx",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-05-20T00:23:56Z",
    "updated_at": "2013-05-20T00:23:56Z",
    "body": "Closing as a dup of #6393. The borrow checker is not in fact confused by return statements, but rather is defending you against a subtle and non-obvious possible error, albeit in its simple minded sort of way.\n\nTo demonstrate what I mean, consider this version of your code which works fine:\n\n```\nfn insert_and_get_borrow<'r>(arr: &'r mut ~[int], i: int) -> &'r int {\n    let mut j = 0, n = arr.len();\n    while j < n {\n        if arr[j] == i { return &arr[j]; }\n    }\n    // If not included yet, add it\n    arr.push(i);\n    &arr[arr.len() - 1]\n}\n\nfn main() { }\n```\n\nNow consider this version, which generates an error:\n\n```\nfn insert_and_get_borrow<'r>(arr: &'r mut ~[int], i: int) -> &'r int {\n    let mut j = 0, n = arr.len();\n    while j < n {\n        let p = &arr[j]; // (*)\n        if *p == i { return p; }\n    }\n    // If not included yet, add it\n    arr.push(i);\n    &arr[arr.len() - 1]\n}\n\nfn main() { }\n```\n\nThe reason that an error is generated is because the _scope of the pointer `p` is `'r`_. This means that when the pointer is created on the line `(*)`, that pointer is valid from that point until the end of the function. Now, to the reader, it's obvious that if we do not return `p`, then it is out of scope and so the borrow can be ended. However, the borrow checker does not attempt to track aliasing, so it has no way to know that the pointer is not copied and hidden away. Similarly, in your original example, the borrow checker does not know that the `each` function doesn't keep it's own copy of the pointers it is giving you in some location. If it did so, those pointers would be invalidated by `arr.push`.\n\n(Note: it is also true that the borrow checker does not know that the `each` function implements the `for` protocol correctly, so it's possible that more loop iterations could continue to run even after a `return` statement, though I think that after the loop a return would always be honored in any case, at least the way that `trans` works right now)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/18127661/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30720312",
    "html_url": "https://github.com/rust-lang/rust/issues/6613#issuecomment-30720312",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/6613",
    "id": 30720312,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzIwMzEy",
    "user": {
      "login": "ezyang",
      "id": 13564,
      "node_id": "MDQ6VXNlcjEzNTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/13564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ezyang",
      "html_url": "https://github.com/ezyang",
      "followers_url": "https://api.github.com/users/ezyang/followers",
      "following_url": "https://api.github.com/users/ezyang/following{/other_user}",
      "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions",
      "organizations_url": "https://api.github.com/users/ezyang/orgs",
      "repos_url": "https://api.github.com/users/ezyang/repos",
      "events_url": "https://api.github.com/users/ezyang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ezyang/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-17T02:03:32Z",
    "updated_at": "2013-12-17T02:03:32Z",
    "body": "Hey @nikomatsakis, there is one thing I don't quite understand about your explanation, which is why the first code fragment you posted _does_ compile. After all, it is performing a borrow with lifetime `'r`, just as in the first case, but somehow, borrowck doesn't consider this borrow live for the rest of the function. So what's different about actually assigning a variable?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30720312/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30742499",
    "html_url": "https://github.com/rust-lang/rust/issues/6613#issuecomment-30742499",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/6613",
    "id": 30742499,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzQyNDk5",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-17T11:05:32Z",
    "updated_at": "2013-12-17T11:05:32Z",
    "body": "It is not assigning to a variable that makes a difference but rather the control flow. In the first fragment, there is a `return` that unconditionally follows the borrow, so we know that the borrow is never live after the loop. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30742499/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
