[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61913180",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-61913180",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 61913180,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTEzMTgw",
    "user": {
      "login": "rust-highfive",
      "id": 7378925,
      "node_id": "MDQ6VXNlcjczNzg5MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7378925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rust-highfive",
      "html_url": "https://github.com/rust-highfive",
      "followers_url": "https://api.github.com/users/rust-highfive/followers",
      "following_url": "https://api.github.com/users/rust-highfive/following{/other_user}",
      "gists_url": "https://api.github.com/users/rust-highfive/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rust-highfive/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rust-highfive/subscriptions",
      "organizations_url": "https://api.github.com/users/rust-highfive/orgs",
      "repos_url": "https://api.github.com/users/rust-highfive/repos",
      "events_url": "https://api.github.com/users/rust-highfive/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rust-highfive/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T01:24:24Z",
    "updated_at": "2014-11-06T01:24:24Z",
    "body": "<img src=\"http://www.joshmatthews.net/warning.svg\" alt=\"warning\" height=20> **Warning** <img src=\"http://www.joshmatthews.net/warning.svg\" alt=\"warning\" height=20>\n- These commits modify **unsafe code**. Please review it carefully!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61913180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61914572",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-61914572",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 61914572,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTE0NTcy",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T01:40:58Z",
    "updated_at": "2014-11-06T01:40:58Z",
    "body": "I'm a bit wary of this. Replacing malloc is pretty sneaky and I can imagine it causing unintended side effects (I feel like this has come up before - the first time we integrated jemalloc we did not use a custom prefix and had malloc/free mismatches). Like to get some other feedback.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61914572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61915241",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-61915241",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 61915241,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTE1MjQx",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T01:48:56Z",
    "updated_at": "2014-11-06T01:48:56Z",
    "body": "> Replacing malloc is pretty sneaky\n\nIt's explicitly supported by the C standard library implementations by going out of the way to use weak symbols for the platform allocator. It's the _normal_ way to use jemalloc and tcmalloc and it isn't a hack or sneaky at all.\n\n> the first time we integrated jemalloc we did not use a custom prefix and had malloc/free mismatches\n\nIt defaults to a `je_` prefix on Windows and OS X so the problems that were encountered there were being wrongly attributed to jemalloc. It wasn't being used on those platforms at all.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61915241/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61916386",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-61916386",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 61916386,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTE2Mzg2",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T02:02:41Z",
    "updated_at": "2014-11-06T02:02:41Z",
    "body": "Rust is causing undefined behaviour by opting out of replacing the system allocator but not disabling jemalloc's support for dss. It's not well-defined to call `brk` / `sbrk` from outside of `malloc`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61916386/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61925903",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-61925903",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 61925903,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTI1OTAz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T04:23:36Z",
    "updated_at": "2014-11-06T04:23:36Z",
    "body": "I'm also somewhat wary of this, but it has been quite some time since the bugs we had last. (cc https://github.com/rust-lang/rust/issues/9925 and https://github.com/rust-lang/rust/pull/9933). A lot has changed about the runtime/compiler since then, particularly in the form of how we link all our libraries together. We're also not ourselves calling `malloc` or `free` any more, but rather some of the more flavorful jemalloc functions.\n\nI'd be willing to give this a shot as it's pretty easy to undo, I'd just want to keep a close eye on the queue for the next few days. Changes like this often have quite surprising fallout. The wins seems significant enough that it may be worth just trying out.\n\n@brson, does that sound ok to you?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61925903/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61927805",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-61927805",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 61927805,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTI3ODA1",
    "user": {
      "login": "richo",
      "id": 476418,
      "node_id": "MDQ6VXNlcjQ3NjQxOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/476418?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/richo",
      "html_url": "https://github.com/richo",
      "followers_url": "https://api.github.com/users/richo/followers",
      "following_url": "https://api.github.com/users/richo/following{/other_user}",
      "gists_url": "https://api.github.com/users/richo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/richo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/richo/subscriptions",
      "organizations_url": "https://api.github.com/users/richo/orgs",
      "repos_url": "https://api.github.com/users/richo/repos",
      "events_url": "https://api.github.com/users/richo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/richo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T05:00:16Z",
    "updated_at": "2014-11-06T05:00:16Z",
    "body": "It seems that all things considered, given that Rust itself will under the hood still use jemalloc for allocation, the key change to this would be foreign code linked into a rust binary? Not suggesting this is bad, but wanted to check I was reading this correctly.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61927805/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61936468",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-61936468",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 61936468,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTM2NDY4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T07:21:09Z",
    "updated_at": "2014-11-06T07:21:09Z",
    "body": "@richo: Yes, this means code using the C allocator API (like LLVM) will make use of jemalloc.\n\nMixed allocator usage is pretty much the definition of external fragmentation as unused capacity in one allocator is not usable by the other. It also means that virtual memory is fragmented into smaller spans managed by either allocator which hurts large allocations / reallocations. Finally, it means that it's not possible to have jemalloc safely use dss (which has the potential to speed up reallocations).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61936468/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62055572",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62055572",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62055572,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMDU1NTcy",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T21:36:05Z",
    "updated_at": "2014-11-06T21:36:05Z",
    "body": "@thestinger If it is a problem for jemalloc to be calling sbrk then we could change it to use mmap if we had to. Do you have a source for your assertion that the current behavior is not ok, and do you know why it is working anyway on all platforms?\n\nAre you aware of precedent in other language stacks for overriding the C allocator by default, e.g. does Java override malloc, python?\n\nIf we were to do this then it would be a Linux-specific behavior for a major subsystem.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62055572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62059497",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62059497",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62059497,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMDU5NDk3",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T22:02:00Z",
    "updated_at": "2014-11-06T22:13:40Z",
    "body": "> Do you have a source for your assertion that the current behavior is not ok, and do you know why it is working anyway on all platforms?\n\nIt's not okay to call `sbrk` / `brk` from outside of the malloc implementation. The default for jemalloc is `dss:secondary` so it will only be called when `mmap` fails. That's an edge case, but that doesn't make it okay - jemalloc defends against races expanding the heap by leaking, but it can't do anything about a race shrinking the heap. It's possible to set `dss:primary` at runtime which should be expected to work but it will not be sane with how Rust is configuring jemalloc.\n\nhttp://lifecs.likai.org/2010/02/sbrk-is-not-thread-safe.html (or see the man pages)\n\n> Are you aware of precedent in other language stacks for overriding the C allocator by default, e.g. does Java override malloc, python?\n\nI'm not aware of a language shipping an alternative allocator implementation like Rust. I'm also not aware of a language implementation providing features like `reallocate_inplace` or sized deallocation (C++14 has sized deallocation, but implementations don't leverage it). I would think that if another language was providing their own allocator, they would want to eliminate external fragmentation caused by a secondary general purpose allocator in the same process. Replacing the platform allocator is explicitly supported by OS X (zone allocator API) and other *nix operating systems (via weak symbols). It's how it's intended to be done by the people who wrote the standard C libraries.\n\n> If we were to do this then it would be a Linux-specific behavior for a major subsystem.\n\nNo, it's not Linux-specific. It will be doing it on all platforms that aren't explicitly blacklisted by jemalloc like FreeBSD and the Android variant of Linux. It also works on Solaris, AIX and most other *nix operating systems. The inability to replace the Windows allocator is considered an important missing feature upstream and will be fixed at some point - hopefully soon.\n\nOn OS X, jemalloc replaces the system allocator by registering itself as the default zone allocator. Rust isn't passing `--disable-zone-allocator` so it's already attempting to replace the platform allocator there but I don't have access to OS X to verify whether it already works.\n\nThis is the _normal_ way to make use of jemalloc because mixing general purpose allocators is bad for performance and memory usage. On FreeBSD (and perhaps NetBSD), the system allocator _is_ jemalloc and Rust is causing two instances of it to be used in the same process. It means external fragmentation (2 fully independent allocators), lower performance (loss of data locality, separate caches) and fragmented virtual memory.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62059497/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62108519",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62108519",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62108519,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMTA4NTE5",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-07T07:35:34Z",
    "updated_at": "2014-11-07T07:38:56Z",
    "body": "Java, V8, and SpiderMonkey certainly do ship their own allocators and don't replace the C allocator, although at least V8 could in theory. I'm not going to declare myself opposed to this, but I would like to understand why Rust is different from those three languages in this regard. Replacing malloc with jemalloc for the whole process seems rather intrusive for e.g. embedding scenarios. Of course it should be possible to do so for the reasons you describe, but I suspect that, for example, a Java user would not expect this behavior by default.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62108519/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62114169",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62114169",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62114169,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMTE0MTY5",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-07T08:47:54Z",
    "updated_at": "2014-11-07T08:49:16Z",
    "body": "> Replacing malloc with jemalloc for the whole process seems rather intrusive for e.g. embedding scenarios.\n\nI don't see any problems with this in an embedding scenario. The platform C libraries are designed with support for cleanly replacing the system allocator. Rust already provides the choice being using the C standard library API or the non-standard jemalloc API for allocation via the `configure` script. If it's using a bundled jemalloc then it doesn't add any bloat to have it replace the system allocator.\n\nIf Rust ever intends to use the system jemalloc as required by Debian / Fedora packaging standards (#13945), then it needs to use the default prefix because distribution packages don't add a non-default prefix to the APIs.\n\nRust mixing two general purpose allocators in the same process increases memory usage through external fragmentation, fragmented spans of virtual memory and poor data locality. If the system allocator is jemalloc, then what Rust is doing is _strictly_ worse than calling into that. I think it's far less intrusive to have jemalloc use the system provided methods for replacing the platform allocator (weak symbols, OS X zone allocator API) than it is to have it live alongside it and fight with it for resources.\n\n>  I'm not going to declare myself opposed to this, but I would like to understand why Rust is different from those three languages in this regard.\n\nIt uses an allocator with the same kind of design and performance characteristics as the platform allocator. Using jemalloc is justified because it provides a consistent performance profile across platforms and allows Rust to leverage advanced API features like sized deallocation, alignment support, in-place reallocation and more. However, that value proposition isn't as strong if jemalloc is going to be hamstrung with a non-default configuration flag that's significantly hurting performance and memory usage.\n\n> Java, V8, and SpiderMonkey certainly do ship their own allocators and don't replace the C allocator, although at least V8 could in theory.\n\nGarbage collectors have drastically different performance and memory usage characteristics. Both Chromium and Firefox replace the system allocators with TCMalloc / jemalloc despite shipping those garbage collector implementations.\n\n> Of course it should be possible to do so for the reasons you describe, but I suspect that, for example, a Java user would not expect this behavior by default.\n\nI doubt that many Java users have expectations about whether the system allocator is replaced. It wouldn't really matter if they did, because it's a low-level implementation detail with no API impact. The impact is a performance improvement, reduction in memory usage and _far_ more accurate allocator statistics since in practice it will cover everything other than stacks (I'll get to that later...) and memory mapped files (might be interesting to manage those via the same chunk allocator).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62114169/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62207230",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62207230",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62207230,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjA3MjMw",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-07T20:30:40Z",
    "updated_at": "2014-11-07T20:35:32Z",
    "body": "> I think it's far less intrusive to have jemalloc use the system provided methods for replacing the platform allocator (weak symbols, OS X zone allocator API) than it is to have it live alongside it and fight with it for resources.\n\nI'm not disagreeing that we should support this mode, but I'm questioning why it should be the default.\n\n> Both Chromium and Firefox replace the system allocators with TCMalloc / jemalloc despite shipping those garbage collector implementations.\n\nNeither are designed for embedding.\n\n> I doubt that many Java users have expectations about whether the system allocator is replaced.\n\nI'm not sure that's true.\n\n> It wouldn't really matter if they did, because it's a low-level implementation detail with no API impact.\n\nWhat if your C app has two libraries you want to use, one written in Rust and one written in some other language that uses tcmalloc?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62207230/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62235261",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62235261",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62235261,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjM1MjYx",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-08T00:25:46Z",
    "updated_at": "2014-11-08T00:25:46Z",
    "body": "Building for Fedora etc. using the system allocator can be done just by disabling jemalloc in the build. That point at least doesn't seem relevant here.\n\nLikewise I don't understand the point about Rust on systems that already use jemalloc. For such systems wouldn't we want to disable our build of jemalloc and use the system allocator?\n\nYou claimed that the current configuration is 'significantly hurting performance and memory usage'. I can imagine the memory usage aspect since there are two active allocators, but how does it hurt performance? Aren't we using jemalloc because it has better performance than the system allocator?\n\nHave you done measurements on the increased memory usage we are causing by having two active allocators? ISTM that Rust programs by default should not be calling malloc much (if at all), so the impact may not be great.\n\nI'm still not convinced that it is Rust's place to be messing with C's allocator. If we did this then are others still able to override the allocator in the expected way or do they have to use Rust's allocator?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62235261/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62241696",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62241696",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62241696,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjQxNjk2",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-08T02:22:49Z",
    "updated_at": "2014-11-08T02:22:49Z",
    "body": "> Building for Fedora etc. using the system allocator can be done just by disabling jemalloc in the build. That point at least doesn't seem relevant here.\n\nThe goal would to be build it against the distribution's jemalloc package via the same non-standard API with features like sized deallocation, not the normal system allocator. It's certainly relevant here because the only choice Rust is offering right now is between lower performance in Rust with the system allocator (whether or not it is jemalloc) and inefficient mixed allocator usage.\n\n> Likewise I don't understand the point about Rust on systems that already use jemalloc. For such systems wouldn't we want to disable our build of jemalloc and use the system allocator?\n\nWe would still want to use the non-standard API for the significant performance advantages. I would expect the benefits of sized deallocation to cause a widening of the performance gap between the APIs once jemalloc gains support for arena caches.\n\n> You claimed that the current configuration is 'significantly hurting performance and memory usage'. I can imagine the memory usage aspect since there are two active allocators, but how does it hurt performance? Aren't we using jemalloc because it has better performance than the system allocator?\n\nMixing the allocators spreads out data more sparsely, and it's not keeping the thread caches as hot as they would be if the C memory allocations were also hitting it. Since both allocators are grabbing virtual memory via `mmap`, the virtual memory is fragmented between them. In jemalloc, virtual memory is reused rather than unmapped and it's important for it to be as contiguous as possible to satisfy huge allocations / reallocations via the existing memory. It also means that jemalloc can't safety make use of `dss`, and that would offer _significant_ performance advantages for reallocations.\n\n> Have you done measurements on the increased memory usage we are causing by having two active allocators? ISTM that Rust programs by default should not be calling malloc much (if at all), so the impact may not be great.\n\nRust programs often call `malloc` via C libraries, such as the usage of LLVM in `rustc`. Switching to jemalloc for Rust allocations only reduced memory usage by a few percent, while switching for both reduces it by a total of ~20%. I haven't measured the impact of having two instances of jemalloc in the same process but it means that there are 2x the number of arenas without any concurrency benefit, as each thread is assigned to 2 independent arenas rather than 1.\n\n> I'm still not convinced that it is Rust's place to be messing with C's allocator. If we did this then are others still able to override the allocator in the expected way or do they have to use Rust's allocator?\n\nIt's still possible to override the system allocator by linking a library like TCMalloc before liballoc. I don't think it makes much sense to mix allocators in the same process though. \n\nHowever, I don't think it would make sense for someone to do this. Mixing allocators in the same process is not a good idea and it would make far more sense to build Rust with the system allocator API if the intent is to use another allocator like TCMalloc.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62241696/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62242010",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62242010",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62242010,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjQyMDEw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-08T02:30:23Z",
    "updated_at": "2014-11-08T02:30:23Z",
    "body": "I think it makes sense to offer two choices:\n- use the default jemalloc symbols via the non-standard API, with the ability to use a sufficiently up-to-date distribution package if available\n- use the system allocator from Rust - eliminating the dependency on an external / internal jemalloc while hurting performance\n\nI don't think it makes sense to offer the middle ground that Rust is currently using. It still has the disadvantage of an extra library dependency. It doesn't need to have the disadvantage of mixed allocator usage. I don't see any benefits to avoiding the normal configuration where it replaces the system allocator on platforms with support for doing so. It's a significant performance and memory usage loss relative to a default build.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62242010/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62242717",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62242717",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62242717,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjQyNzE3",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-08T02:51:27Z",
    "updated_at": "2014-11-08T02:51:27Z",
    "body": "> I'm not disagreeing that we should support this mode, but I'm questioning why it should be the default.\n\nIt could build against the platform allocator by default, but I don't see why this crippled build of jemalloc should be supported.\n\n> Neither are designed for embedding.\n\nI don't think significantly hurting performance / memory usage in processes making heavy use of the C allocator is friendly to embedding. Rust supports using the platform allocator but if it's built against the non-standard jemalloc API instead then it makes sense to leverage the ability to replace the system allocator that's provided by the platform.\n\n> What if your C app has two libraries you want to use, one written in Rust and one written in some other language that uses tcmalloc?\n\nIt will work correctly. Only one of the allocators will replace the system allocator, depending on which was loaded first - that's how weak symbols work. Rust doesn't permit mixing the `alloc::heap` API with the C allocator API so it won't cause any problems for the C allocator to be TCMalloc. However, it's really not ideal to have multiple allocators in the same process. It would make more sense to disable TCMalloc in that language or build Rust against the platform allocator API so it also uses jemalloc. The current non-default jemalloc prefix wouldn't make things any better.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62242717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62247508",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62247508",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62247508,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjQ3NTA4",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-08T06:14:07Z",
    "updated_at": "2014-11-08T06:14:07Z",
    "body": "Was the main concern about embedding the possibility that jemalloc might replace the system allocator _during_ the runtime of a C program?\nWhile that would be extremely dangerous, it wouldn't happen if you were to simply load a dynamic library, e.g. as a plugin.\nIf it's possible, it would require manual fiddling inside the GOT and PLT sections.\nMaybe @thestinger could have been more clear about that, but he did just answer it.\n\nI am not seeing other potential disadvantages being mentioned, and 20% less memory usage is _huge_, especially given that we get it by doing nothing, instead of sabotaging jemalloc.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62247508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62247689",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62247689",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62247689,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjQ3Njg5",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-08T06:23:11Z",
    "updated_at": "2014-11-08T06:23:11Z",
    "body": "It's not possible to `dlopen` jemalloc because it marks the TLS variables as `initial-exec` to get pointer offsets instead of linker calls. So it's already not possible to load a dynamic library bundling a jemalloc-based liballoc as a plugin. The lack of a prefix doesn't really make things any different.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62247689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62247760",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62247760",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62247760,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjQ3NzYw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-08T06:26:40Z",
    "updated_at": "2014-11-08T06:27:23Z",
    "body": "@eddyb: It's ~10-15% less peak `rustc` memory usage from disabling the custom prefix, the 20% figure is the total win over a build using glibc's allocator everywhere.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62247760/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62247848",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62247848",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62247848,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjQ3ODQ4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-08T06:29:00Z",
    "updated_at": "2014-11-08T06:29:00Z",
    "body": "The Rust compiler and LLVM make a _lot_ of small allocations so metadata overhead is a big deal. They also do a lot of repeated vector reallocations, so fragmented virtual memory doesn't help.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62247848/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62323959",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62323959",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62323959,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzIzOTU5",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-09T22:54:06Z",
    "updated_at": "2014-11-09T22:54:06Z",
    "body": "I will bring this up during the meeting. My current position is that I am not in favor of doing this by default for _libraries_ because I am concerned about surprising embedders. Sure, jemalloc may well be the best allocator ever, but it's still a somewhat antisocial thing to do. If I'm invited over to your house for dinner, and when I get there I suddenly smash your old CRT TV and replace it with a brand new flat screen, the fact that I upgraded your TV is not going to stop me from getting kicked out of your house and arrested.\n\nExecutables, however, are a separate story, because it makes sense that Rust \"owns\" the runtime environment of a Rust executable. So I would be fine with doing this for executables. (Note that this would address the `rustc` use case.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62323959/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62329332",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62329332",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62329332,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzI5MzMy",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T01:10:38Z",
    "updated_at": "2014-11-10T01:10:38Z",
    "body": "I don't see how it could just be done for executable crates but not library ones.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62329332/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62330044",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62330044",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62330044,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzMwMDQ0",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T01:24:35Z",
    "updated_at": "2014-11-10T01:29:34Z",
    "body": "> I don't see how it could just be done for executable crates but not library ones.\n\nWell, we could just get rid of the prefix for jemalloc and only link it in for executable crates (at the top level). That way, library crates would use whatever the system allocator is (which, for Rust executable projects, would be jemalloc; for non-Rust executable projects that would be jemalloc if the embedder explicitly opts in and otherwise would be their native allocator).\n\n> So it's already not possible to load a dynamic library bundling a jemalloc-based liballoc as a plugin. The lack of a prefix doesn't really make things any different.\n\nWait, does this mean that it's impossible to `dlopen` most Rust code? This is a huge issue for embedding, and if it cannot be solved that leads me toward the conclusion that we should not use jemalloc for Rust plugins at all without the embedder opting in.\n\n> However, it's really not ideal to have multiple allocators in the same process.\n\nThe issue is that that's for the embedder to decide; we should not be making that decision for them if we're a guest in their process.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62330044/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62330793",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62330793",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62330793,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzMwNzkz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T01:39:23Z",
    "updated_at": "2014-11-10T01:39:23Z",
    "body": "> Well, we could just get rid of the prefix for jemalloc and only link it in for executable crates (at the top level). That way, library crates would use whatever the system allocator is (which, for Rust executable projects, would be jemalloc; for non-Rust executable projects that would be jemalloc if the embedder explicitly opts in and otherwise would be their native allocator).\n\nThat won't work because we want to be calling into jemalloc's non-standard API from those libraries.\n\n> Wait, does this mean that it's impossible to `dlopen` most Rust code? This is a huge issue for embedding, and if it cannot be solved that leads me toward the conclusion that we should not use jemalloc for Rust plugins at all without the embedder opting in.\n\nIt's one of several reasons that `dlopen` of Rust code doesn't work correctly (without `#![no_std]`).\n\n> The issue is that that's for the embedder to decide; we should not be making that decision for them if we're a guest in their process.\n\nRust doesn't make the decision for them. It has a configure option for using the platform allocator API instead of jemalloc's non-standard API. I don't see any way to make the choice at runtime between the more performant jemalloc-specific API (sized deallocation, etc.) and the platform API.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62330793/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62339475",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62339475",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62339475,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzM5NDc1",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T04:18:18Z",
    "updated_at": "2014-11-10T04:19:19Z",
    "body": "> That won't work because we want to be calling into jemalloc's non-standard API from those libraries.\n\nCan't we make weak symbol shims over jemalloc's nonstandard API that call into the system allocator and are overridden by jemalloc if it's linked in?\n\n> It's one of several reasons that dlopen of Rust code doesn't work correctly (without #![no_std]).\n\nWell, I'd prefer to fix that instead of sealing off the possibility entirely.\n\n> Rust doesn't make the decision for them. It has a configure option for using the platform allocator API instead of jemalloc's non-standard API.\n\nHaving to rebuild Rust is an awfully big sledgehammer to hit this problem with.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62339475/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62341145",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62341145",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62341145,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzQxMTQ1",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T04:51:16Z",
    "updated_at": "2014-11-10T04:51:37Z",
    "body": "> Can't we make weak symbol shims over jemalloc's nonstandard API that call into the system allocator and are overridden by jemalloc if it's linked in?\n\nNo, there's no way to map the non-standard API to the standard C API. For example, `xallocx` returns the real size of the memory allocation, so it returns the current size of the allocation if it fails to resize in-place. Some platforms offer an API like `malloc_usable_size` for that, but it doesn't exist everywhere.\n\nThere are similar issues with alignment, as `rallocx` takes the _new alignment_ but not the _old alignment_ and it's not possible to mix `realloc` with `_aligned_realloc` (Windows) or `posix_memalign` (except on certain platforms).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62341145/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62342978",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62342978",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62342978,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzQyOTc4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T05:26:47Z",
    "updated_at": "2014-11-10T05:26:47Z",
    "body": "It could be done if jemalloc had variants of the reallocation functions with sized deallocation, but it's unclear if that would be accepted upstream and my PR adding `srallocx` to the Rust fork was turned down.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62342978/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62364300",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62364300",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62364300,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzY0MzAw",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T10:11:17Z",
    "updated_at": "2014-11-10T10:11:17Z",
    "body": "Well, given the choice between being able to `dlopen` standard Rust crates and the performance gains from a better reallocation API I'm inclined to choose the former. It's simply too important from an embedding perspective (think Python `ctypes`, for example), and we have production users (e.g. Skylight) depending on this. I'm probably OK with settling on the lowest common denominator between the system API (e.g. glibc) and Rust, so, for example, we could depend on something like `malloc_usable_size` being present, although even that is a borderline case\u2026\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62364300/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62371803",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62371803",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62371803,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzcxODAz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T11:26:05Z",
    "updated_at": "2014-11-10T11:28:07Z",
    "body": "> Well, given the choice between being able to `dlopen` standard Rust crates and the performance gains from a better reallocation API I'm inclined to choose the former.\n\nYou've misunderstood my statement about the reallocation API. I said it would be possible to provide a stub implementation of the non-standard API via weak symbols if the reallocation API supported sized deallocation. It is not possible right now because the size and old alignment is not passed to the functions, but a stub implementation of `xallocx` would need to return the old size and a `rallocx` implementation on top of `realloc` would need to fall back to a different API to cope with a high old alignment.\n\n>  It's simply too important from an embedding perspective (think Python `ctypes`, for example), and we have production users (e.g. Skylight) depending on this.\n\nThe `dlopen` issue has nothing to do with whether or not it uses a prefix. It's out of the scope of this pull request, as no new issues are being introduced here. This pull request provides a significant performance improvement, memory usage reduction and eliminates the memory safety issues caused by mixed usage of the `sbrk` API. It does not impact `dlopen` and it does not preclude further work to make jemalloc optional at runtime via weak symbols.\n\nThis is also not a change from the current policy, as Rust is already asking jemalloc to replace the platform allocator on OS X via the zone allocator API. It has never passed `--disable-zone-allocator` to disable it because it has not been a problem. The only reported problems with the earlier integration of jemalloc with the default prefix occurred on Windows and OS X, and it turns out that jemalloc was still using a prefix on both so it could not have been the issue.\n\n> I'm probably OK with settling on the lowest common denominator between the system API (e.g. glibc) and Rust, so, for example, we could depend on something like `malloc_usable_size` being present, although even that is a borderline case\u2026\n\nUsing `malloc_usable_size` would not only be non-portable but would perform very poorly so it wasn't a serious suggestion. If jemalloc provided a version of `xallocx` and `rallocx` with sized deallocation, then it would be possible to provide a portable and sane implementation of the API via weak symbols calling into the C standard library.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62371803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62376066",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62376066",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62376066,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzc2MDY2",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T12:12:37Z",
    "updated_at": "2014-11-10T12:12:47Z",
    "body": "I filed an issue about making it possible to replace the allocator without recompiling Rust (https://github.com/rust-lang/rust/issues/18838). I don't think it has any relevance to this pull request, because no one has raised an issue that would apply with the default prefix but not with a custom one.\n\nThis fixes soundness issues caused by mixed usage of `sbrk`, makes the allocator statistics into a useful tool for `rustc` and other programs with heavy usage of FFI and provides significant performance and memory usage improvements. It doesn't have any apparent drawbacks so I don't understand why it is so controversial. There are no user-facing changes to the language / libraries here, and no increase in pain for the embedding use case. Debating whether using jemalloc by default or at all is a good idea can happen somewhere else.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62376066/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62410511",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62410511",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62410511,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDEwNTEx",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T16:28:51Z",
    "updated_at": "2014-11-10T16:32:52Z",
    "body": "> You've misunderstood my statement about the reallocation API. I said it would be possible to provide a stub implementation of the non-standard API via weak symbols if the reallocation API supported sized deallocation.\n\nThat's right. What I'm suggesting is that Rust not use the nonstandard reallocation API at all.\n\n>  It doesn't have any apparent drawbacks so I don't understand why it is so controversial. There are no user-facing changes to the language / libraries here, and no increase in pain for the embedding use case.\n\nAs I explained, it means that embedders of Rust crates will have their allocator ripped out from under them without warning. That is a drawback because the Rust crate is a guest in their process and that is not what people will expect. See my TV analogy.\n\nThis is relevant to whether we should merge this pull request because we may not want to take this pull request until the nonstandard reallocation API is removed and the weak symbol shim is introduced.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62410511/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62428932",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62428932",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62428932,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDI4OTMy",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T18:21:25Z",
    "updated_at": "2014-11-10T18:21:25Z",
    "body": "> It's not possible to dlopen jemalloc because it marks the TLS variables as initial-exec to get pointer offsets instead of linker calls. So it's already not possible to load a dynamic library bundling a jemalloc-based liballoc as a plugin. The lack of a prefix doesn't really make things any different.\n\nDoes this mean that's it's not possible to dlopen Rust code at all since all Rust code depends on jemalloc?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62428932/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62429141",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62429141",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62429141,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDI5MTQx",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T18:22:49Z",
    "updated_at": "2014-11-10T18:22:49Z",
    "body": "Hm, I see you already answered the above question - yes, it is impossible to dlopen Rust code because of jemalloc. This seems like a pretty big surprise and a problem.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62429141/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62429287",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62429287",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62429287,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDI5Mjg3",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T18:23:51Z",
    "updated_at": "2014-11-10T18:23:51Z",
    "body": "> It's one of several reasons that dlopen of Rust code doesn't work correctly (without #![no_std]).\n\nIf there are others you know of can you enumerate them or file bugs?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62429287/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62430181",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62430181",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62430181,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDMwMTgx",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T18:29:09Z",
    "updated_at": "2014-11-10T18:29:09Z",
    "body": "> It's still possible to override the system allocator by linking a library like TCMalloc before liballoc. I don't think it makes much sense to mix allocators in the same process though. \n\nSo does this mean that it is no longer possible after this patch to override the C allocator with LD_PRELOAD?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62430181/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62431108",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62431108",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62431108,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDMxMTA4",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T18:34:59Z",
    "updated_at": "2014-11-10T18:34:59Z",
    "body": "> So does this mean that it is no longer possible after this patch to override the C allocator with LD_PRELOAD?\n\nIt sounds like Rust is _unable_ to use the C allocator unless reconfigured at this point, due to heavy use of the jemalloc nonstandard API. :(\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62431108/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62435884",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62435884",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62435884,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDM1ODg0",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T19:04:14Z",
    "updated_at": "2014-11-10T19:04:14Z",
    "body": "@thestinger IIUC after this patch we will be override the C allocator everywhere but Linux, on OS X and iOS through the zone allocator API. If it is a problem to be using two allocators, should we disable jemalloc on Windows?\n\nI'm still pretty unclear about the complications with dlopen. Presumably some people are dlopening Rust libraries successfully from e.g. Ruby.\n\nOn Linux if somebody dlopen's a library that exports `malloc` does the weak `malloc` symbol get overridden dynamically (at an arbitrary time), or does it not get overridden? \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62435884/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62446503",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62446503",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62446503,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ2NTAz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T20:10:33Z",
    "updated_at": "2014-11-10T20:10:33Z",
    "body": "> That's right. What I'm suggesting is that Rust not use the nonstandard reallocation API at all.\n\nSo no more efficient support for alignment, no more sized deallocation (20% performance improvement to deallocation, ~10-15% for the allocation pair), no more in-place reallocation and no support for sized deallocation + used size parameter (shorter copies, ~5-40% concatenation improvement) for reallocation.\n\n> As I explained, it means that embedders of Rust crates will have their allocator ripped out from under them without warning. That is a drawback because the Rust crate is a guest in their process and that is not what people will expect. See my TV analogy.\n> \n> This is relevant to whether we should merge this pull request because we may not want to take this pull request until the nonstandard reallocation API is removed and the weak symbol shim is introduced.\n\nIt's not a user-facing change, so their expectations don't matter. There are _real_ technical issues with mixed allocator usage. I don't see how making jemalloc optional without a rebuild is tied to this pull request. It's an entirely orthogonal enhancement.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62446503/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62446693",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62446693",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62446693,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ2Njkz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T20:11:48Z",
    "updated_at": "2014-11-10T20:11:48Z",
    "body": "> Does this mean that's it's not possible to dlopen Rust code at all since all Rust code depends on jemalloc?\n\nIt's possible to `dlopen` dynamic libraries but liballoc also needs to be dynamically linked against the executable.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62446693/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62446868",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62446868",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62446868,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ2ODY4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T20:12:53Z",
    "updated_at": "2014-11-10T20:12:53Z",
    "body": "The `dlopen` issue has to do with the TLS model jemalloc chooses to use for performance. The normal use case for jemalloc is replacing the platform allocator so it needs to be loaded at the start, since otherwise it would not replace the symbols.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62446868/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62446928",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62446928",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62446928,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ2OTI4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T20:13:23Z",
    "updated_at": "2014-11-10T20:13:23Z",
    "body": "> So does this mean that it is no longer possible after this patch to override the C allocator with LD_PRELOAD?\n\nNo, it doesn't mean that. It is possible to override the C allocator with `LD_PRELOAD` before and after this patch. I have already stated this in my comments.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62446928/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62447300",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62447300",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62447300,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ3MzAw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T20:15:55Z",
    "updated_at": "2014-11-10T20:15:55Z",
    "body": "> It sounds like Rust is unable to use the C allocator unless reconfigured at this point, due to heavy use of the jemalloc nonstandard API. :(\n\nIt isn't able to use the C allocator dynamically because no one has put in the work to make it an option at executable compile-time. It is orthogonal to this change, and I don't see why it should be discussed here.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62447300/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62448665",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62448665",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62448665,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ4NjY1",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T20:24:31Z",
    "updated_at": "2014-11-10T20:24:31Z",
    "body": "> IIUC after this patch we will be override the C allocator everywhere but Linux, on OS X and iOS through the zone allocator API. If it is a problem to be using two allocators, should we disable jemalloc on Windows?\n\nBefore the patch, jemalloc is only attempting to replace the allocator on iOS / OS X via the zone allocator API. This extends it to platforms where the replacement is done via weak symbols (all other *nix platforms).\n\nWindows doesn't have `sbrk` so there isn't a soundness issue there. The improvement from using jemalloc there is more than enough to make up for the external fragmentation and performance hit from using two allocators. The virtual memory fragmentation issue doesn't really apply since jemalloc doesn't manage virtual memory on Windows as it does elsewhere. In the future, jemalloc will support replacing the allocator on Windows as TCMalloc already does but it isn't implemented yet.\n\nFreeBSD (and some other *BSDs) already use jemalloc, so it's strictly worse (beyond improvements in master) to be using an internal version there rather than calling into the system's non-standard jemalloc API. On Linux, using jemalloc without replacing the allocator does provide significant improvements, but it also has a negative impact in some cases. It manages to reduce the committed required by `rustc` by ~5-10% but increases virtual memory usage by ~5-10%. Replacing the system allocator by leaving the configuration defaults intact results in 15-20% less committed memory and ~5% _less_ peak virtual memory.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62448665/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62633592",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62633592",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62633592,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjMzNTky",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T22:27:48Z",
    "updated_at": "2014-11-11T22:27:48Z",
    "body": "There was some discussion of this at the meeting today: https://github.com/rust-lang/meeting-minutes/blob/master/weekly-meetings/2014-11-11.md#jemalloc\n\nThe view of the team is that, while unifying the C and Rust allocators is desirable for performance, the problems with dlopening a malloc that overrides the weak symbols (it results in modules using different implementations of malloc) make this PR in specific undesirable, and unfortunately also calls into question the current approach to integrating jemalloc.\n\nSince we do want to use jemalloc for the increased performance, and we also want users to be able to dlopen Rust libraries, we will need to do some redesign of how jemalloc integrates with Rust.\n\n@pnkfelix wants to follow up on these issues to make sure he understands them better, so leaving this open until he has a say.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62633592/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62638580",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62638580",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62638580,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjM4NTgw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T23:05:19Z",
    "updated_at": "2014-11-11T23:05:19Z",
    "body": "> The view of the team is that, while unifying the C and Rust allocators is desirable for performance\n\nYes, it's desirable. It also doesn't come with any negative consequences so blocking it makes no sense.\n\n> the problems with dlopening a malloc that overrides the weak symbols (it results in modules using different implementations of malloc) make this PR in specific undesirable, and unfortunately also calls into question the current approach to integrating jemalloc.\n\nNo, that's **completely** untrue. Please read my comments here where this misinformation has been refuted several times. Using `dlopen` with jemalloc is broken because it chooses to use the `initial-exec` TLS model. Fixing this issue is not related to this pull request at all.\n\nThis pull request is orthogonal to the ability to use `dlopen`. The `dlopen` problem is caused by the TLS model. I find it ridiculous that my statements here are being completely ignored.\n\n> Since we do want to use jemalloc for the increased performance, and we also want users to be able to dlopen Rust libraries, we will need to do some redesign of how jemalloc integrates with Rust.\n\nSure, but that's entirely unrelated to this issue. I filed an issue about this, and the choice of prefix will not make it any easier or harder to implement: https://github.com/rust-lang/rust/issues/18838.\n\n> Since we do want to use jemalloc for the increased performance, and we also want users to be able to dlopen Rust libraries, we will need to do some redesign of how jemalloc integrates with Rust.\n\nSure, which is totally unrelated to this pull request.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62638580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62638831",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62638831",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62638831,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjM4ODMx",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T23:07:31Z",
    "updated_at": "2014-11-11T23:07:31Z",
    "body": "In the interim, since rustc does benefit significantly from using jemalloc with LLVM, a patch that specifically applies jemalloc to rustc would be seemingly be worthwhile to consider.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62638831/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62638921",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62638921",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62638921,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjM4OTIx",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T23:08:20Z",
    "updated_at": "2014-11-11T23:08:29Z",
    "body": "> In the interim\n\nIn what interim? You have yet to raise any actual issues with this pull request, so it's totally unclear what you expect to happen before it would be okay...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62638921/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62640485",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62640485",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62640485,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjQwNDg1",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T23:21:29Z",
    "updated_at": "2014-11-11T23:21:29Z",
    "body": "@thestinger 'Interim' here refers to the time between now and when we redesign jemalloc integration such that we can satisfy the motivation for this pull request (unifying the C and Rust allocators) while also ensuring that dlopen works correctly. We'll need to iron out a design for the latter, which you should help with if you are so inclined, but since that will take a while, we can do a more limited patch to improve rustc's performance.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62640485/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62651655",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62651655",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62651655,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjUxNjU1",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T00:47:59Z",
    "updated_at": "2014-11-12T00:47:59Z",
    "body": "Based on the discussion on IRC, I do not want to get in the situation whereby `malloc` and `mallocx` go to different allocators. That is not a supported setup for jemalloc. if jemalloc is present without a prefix, then `malloc` and `mallocx` should go to the same allocator. This PR could, however, cause `malloc` and `mallocx` to end up with different allocators in some cases in which `dlopen` is used. That would be a gotcha for unsafe code as well as C code that uses jemalloc-specific functionality.\n\nThe way to fix this will be to implement #18838 on top of weak symbols.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62651655/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62652065",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62652065",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62652065,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjUyMDY1",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T00:51:42Z",
    "updated_at": "2014-11-12T00:51:42Z",
    "body": "Your claims are completely wrong. You're continuing to misrepresent the facts and make up dubious excuses for this is wrong.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62652065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62652280",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62652280",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62652280,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjUyMjgw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T00:53:40Z",
    "updated_at": "2014-11-12T00:54:54Z",
    "body": "It's very simple:\n\nRust can call `sbrk` right now, because jemalloc is built with dss support. It defaults to `dss:secondary`, but `dss:primary` is also supported at runtime.\n\nThe glibc allocator is also making use of `sbrk`.\n\nTwo allocators making use of `sbrk` at the same time is unsound, so the current situation is broken without this pull request.\n\nIt's not just a performance improvement without any drawbacks - it's also required for correctness.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62652280/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62653429",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62653429",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62653429,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjUzNDI5",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T01:05:40Z",
    "updated_at": "2014-11-12T01:05:40Z",
    "body": "`dlopen` is broken because jemalloc uses `initial-exec` for the thread local data\n\n`dlopen` does not replace existing symbols without `RTLD_DEEPBIND` (Linux specific, and known to be very dangerous) which is why it's still correct to remove the prefix\n\nImplementing #18838 is not necessary for this to be a strict improvement over the status quo. It _is_ necessary to remove the prefix in order to fix #13945 and #18838.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62653429/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62659119",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62659119",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62659119,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjU5MTE5",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T02:15:23Z",
    "updated_at": "2014-11-12T02:15:23Z",
    "body": "I'll add a commit with the weak symbols to fix #18838 after it passes tests but it doesn't mean I agree with forcing these things to be tied together. I just don't want to suffer through this any more.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62659119/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62678425",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62678425",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62678425,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjc4NDI1",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T07:03:14Z",
    "updated_at": "2014-11-12T07:17:39Z",
    "body": "> Your claims are completely wrong. You're continuing to misrepresent the facts and make up dubious excuses for this is wrong.\n\nI don't want to keep circling this over and over, but since people are confused on Reddit: the claim that, on Linux, `malloc` and `free` in the embedded dlopen case will redirect to the system allocator while `mallocx` and `dallocx` will redirect to jemalloc is true. We disagree as to whether this is a problem. You believe that it's not a problem because we tell people not to do that. I believe that it is a problem because jemalloc's documentation _does_ say you can do that. That's all this is.\n\nThere was a significant amount of confusion earlier that, as far as I can tell, all stemmed from not realizing that the dlopen use case works _only because we use the nonstandard API_. (In particular, both the jemalloc author's claim that using jemalloc in this way is broken and your claim that it works are _both_ right\u2014according to the documentation, jemalloc _is_ broken because you cannot pass a pointer allocated with `malloc` to `dallocx`, but if you don't mix the nonstandard and standard APIs then it just happens to work.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62678425/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62682374",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62682374",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62682374,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjgyMzc0",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T07:57:50Z",
    "updated_at": "2014-11-12T07:59:43Z",
    "body": "It's not a technical disagreement. It's a repeated pattern of obstructionism on my pull requests via misrepresentation of the issues and grasping for any dubious counter-argument you can think of. As your bogus information is refuted countless times you grasp for more mud to sling. Eventually, the waters are muddied enough that it's hard for anyone to tell what the real facts are. It doesn't change the fact that you're being repeatedly dishonest and manipulative.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62682374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62682850",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62682850",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62682850,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjgyODUw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T08:03:35Z",
    "updated_at": "2014-11-12T08:03:35Z",
    "body": "The fact that you let a personal grudge get in the way of technical designs is quite obvious to many people, and this issue has thrown fuel onto the fire calling for a fork. The number of people expressing interest in a fork continues to grow because of political nonsense like this. You're going to lose far more than just one contributor to the project by turning even small technical improvements into a FUD slinging contest.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62682850/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62687531",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62687531",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62687531,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjg3NTMx",
    "user": {
      "login": "pepp-cz",
      "id": 7118958,
      "node_id": "MDQ6VXNlcjcxMTg5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7118958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pepp-cz",
      "html_url": "https://github.com/pepp-cz",
      "followers_url": "https://api.github.com/users/pepp-cz/followers",
      "following_url": "https://api.github.com/users/pepp-cz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pepp-cz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pepp-cz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pepp-cz/subscriptions",
      "organizations_url": "https://api.github.com/users/pepp-cz/orgs",
      "repos_url": "https://api.github.com/users/pepp-cz/repos",
      "events_url": "https://api.github.com/users/pepp-cz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pepp-cz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T08:56:18Z",
    "updated_at": "2014-11-12T08:56:49Z",
    "body": "I am very sad to see such heated discussion.\n\nCorrect me if I am wrong. I get it that using jemalloc specific APIs can give rust programs noticable performance boost from using sized deallocations. On the other hand it breaks ability to mix standard malloc/free calls with jemalloc specific calls in some scenarios, namely dlopening Rust library.\n\nI wonder if it would be possible to solve the issue by linking to jemalloc and using jemalloc API for building standalone binaries and not linking to jemalloc and using jemalloc API when building dynamic library as in that case you value other things more than performance.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62687531/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62689033",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62689033",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62689033,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjg5MDMz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:10:27Z",
    "updated_at": "2014-11-12T09:10:27Z",
    "body": "> On the other hand it breaks ability to mix standard malloc/free calls with jemalloc specific calls in some scenarios, namely dlopening Rust library.\n\nMixing the low-level Rust allocation API with the C API is not permitted for several reasons. Defining the low-level allocation API as being the C allocator would tie Rust to a legacy API design forever. Instead, it provides an API designed around the desires of modern custom allocators and provides a best effort implementation on top of jemalloc, POSIX and win32.\n\nRust supports making allocations with alignment beyond the default minimum, sized deallocation and in-place reallocation. Support for in-place reallocation is especially useful for higher-level allocators and anything allocating chunks of data unable to be moved in memory like `TypedArena` or a chunked list. The C allocator API can be called directly but there's no guarantee that it's the same allocator.\n\nOn Windows, it's not sane to make assumptions about allocators across library boundaries at all so defining it as being compatible with `malloc` / `free` would **not** allow people to make assumptions in use cases like embedding.\n\nOn most platforms, using jemalloc for just Rust allocations is a significant performance improvement. However, the fact that the C allocator is still in use has a negative impact compared to the default where everything calls into jemalloc. It increases memory usage, hurts performance and causes some subtle soundness issues like usage of `dss` being broken (despite it being enabled as a fallback by default, and runtime support for making it the primary memory source). That's not to say that having the same high level allocator design for both Rust and the C allocation will always be desired, but I do think using the same code at a low level (at a minimum, chunk recycling) will always be desired to avoid virtual memory fragmentation and external fragmentation for huge allocations.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62689033/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62689701",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62689701",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62689701,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjg5NzAx",
    "user": {
      "login": "bill-myers",
      "id": 4647491,
      "node_id": "MDQ6VXNlcjQ2NDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4647491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bill-myers",
      "html_url": "https://github.com/bill-myers",
      "followers_url": "https://api.github.com/users/bill-myers/followers",
      "following_url": "https://api.github.com/users/bill-myers/following{/other_user}",
      "gists_url": "https://api.github.com/users/bill-myers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bill-myers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bill-myers/subscriptions",
      "organizations_url": "https://api.github.com/users/bill-myers/orgs",
      "repos_url": "https://api.github.com/users/bill-myers/repos",
      "events_url": "https://api.github.com/users/bill-myers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bill-myers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:16:34Z",
    "updated_at": "2014-11-12T09:22:32Z",
    "body": "It seems to me that:\n1. If mallocx/etc. is globally visible, then malloc/free must also point to jemalloc, otherwise things are just wrong and other libraries using jemalloc may break\n2. It must be possible to dlopen Rust libraries, and malloc can of course not be replaced by dlopen libraries as allocations have already been made\n\nIt follows that dlopening must not cause mallocx to become a globally visible symbol. Hence, in the dlopen case, either Rust uses the C default allocator, or jemalloc is used in a private way (either by prefixing, or by using RTLD_LOCAL if there are no issues with that).\n\nLibraries loaded at program start should probably follow the same behavior (especially if C++ constructors from other libraries might have called malloc before the library can replace malloc). However, I'm not sure if it is possible to get RTLD_LOCAL behavior for libraries that are static dependencies.\n\nIf the main binary is a Rust executable, then replacing the allocator could be the default as long as the platform allows it without breaking.\n\nIMHO the simplest and cleanest approach is to keep jemalloc prefixed, but add code to rust executables (and not libraries) that redirects malloc/etc. to je_malloc/etc., ideally using function redirection features offered by the executable format (depending on platform and with a compiler flag to enable/disable this).\n\nThat does however mean that a C library that calls free on a Box will work when the main executable is a Rust program, but will break otherwise.\n\nThe other option is to only link Rust executables but not libraries to an unprefixed jemalloc (again, depending on platform and complier flags) and have liballoc bind weakly to the unprefixed mallocx etc. and revert to using the C malloc API if the jemalloc-specific weak symbols are null. This way, jemalloc would be used if and only if the main executable is a Rust program, and free() can always be used to free Boxes.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62689701/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62690066",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62690066",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62690066,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkwMDY2",
    "user": {
      "login": "pepp-cz",
      "id": 7118958,
      "node_id": "MDQ6VXNlcjcxMTg5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7118958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pepp-cz",
      "html_url": "https://github.com/pepp-cz",
      "followers_url": "https://api.github.com/users/pepp-cz/followers",
      "following_url": "https://api.github.com/users/pepp-cz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pepp-cz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pepp-cz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pepp-cz/subscriptions",
      "organizations_url": "https://api.github.com/users/pepp-cz/orgs",
      "repos_url": "https://api.github.com/users/pepp-cz/repos",
      "events_url": "https://api.github.com/users/pepp-cz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pepp-cz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:19:37Z",
    "updated_at": "2014-11-12T09:19:37Z",
    "body": "@Thiez Then the dynamic library uses globaly visible malloc and free so it uses the same allocator as the binary.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62690066/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62690368",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62690368",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62690368,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkwMzY4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:22:30Z",
    "updated_at": "2014-11-12T09:22:30Z",
    "body": "`dlopen` of jemalloc is broken for other reasons like usage of `initial-exec` TLS\n\nhttps://github.com/rust-lang/rust/issues/18838 covers dealing with that, as it's orthogonal to the issue of the allocator prefix. Note that the allocator prefix is not the only way that jemalloc overrides the system allocator. It uses the zone allocator API on OS X, glibc malloc hooks on Linux and some other platforms where they are available and will likely gain support for the CRT allocator replacement technique from TCMalloc / Firefox.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62690368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62690578",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62690578",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62690578,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkwNTc4",
    "user": {
      "login": "pepp-cz",
      "id": 7118958,
      "node_id": "MDQ6VXNlcjcxMTg5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7118958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pepp-cz",
      "html_url": "https://github.com/pepp-cz",
      "followers_url": "https://api.github.com/users/pepp-cz/followers",
      "following_url": "https://api.github.com/users/pepp-cz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pepp-cz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pepp-cz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pepp-cz/subscriptions",
      "organizations_url": "https://api.github.com/users/pepp-cz/orgs",
      "repos_url": "https://api.github.com/users/pepp-cz/repos",
      "events_url": "https://api.github.com/users/pepp-cz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pepp-cz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:24:10Z",
    "updated_at": "2014-11-12T09:24:10Z",
    "body": "@thestinger So you are basically saying that my proposal will break programs because memory allocated by dynamic library through malloc will not meet assumtions that jemalloc specific freeX function has. :-(\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62690578/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62690625",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62690625",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62690625,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkwNjI1",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:24:33Z",
    "updated_at": "2014-11-12T09:24:33Z",
    "body": "@strcat, I think it would help your case if you stopped for a minute and explained how the whole thing works point-by-point in one place, rather than responding to individual comments in 10 different threads.\nThis is a complicated subject and things that are obvious to you may be not quite so obvious to someone who did not spend several weeks tuning jemalloc and thinking about allocators.\n\nI've read this exchange twice now and I still don't understand what is going to happen as a result of this change with all different OSes and linking modes involved.  For example:\n- Why would loading Rust modules into a C program be safe?   Is this because Rust-allocated memory never gets free'ed \n  outside of Rust modules (and vice-versa)?   Or is this because jemalloc does something to interoperate with the system malloc?\n- How would one in practice ensure that when linking with Rust static libraries, the whole program's allocator does not get \n  replaced with jemalloc?\n- What is \"dss\", \"initial-exec\", \"zone allocator\", and other allocator-specific jargon?\n- ... and so on.  \n\nI'd love to see something written in RFC style, for a moderately competent audience.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62690625/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692011",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62692011",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62692011,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkyMDEx",
    "user": {
      "login": "bill-myers",
      "id": 4647491,
      "node_id": "MDQ6VXNlcjQ2NDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4647491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bill-myers",
      "html_url": "https://github.com/bill-myers",
      "followers_url": "https://api.github.com/users/bill-myers/followers",
      "following_url": "https://api.github.com/users/bill-myers/following{/other_user}",
      "gists_url": "https://api.github.com/users/bill-myers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bill-myers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bill-myers/subscriptions",
      "organizations_url": "https://api.github.com/users/bill-myers/orgs",
      "repos_url": "https://api.github.com/users/bill-myers/repos",
      "events_url": "https://api.github.com/users/bill-myers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bill-myers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:36:41Z",
    "updated_at": "2014-11-12T09:37:17Z",
    "body": "Dlopen of Rust libraries by C programs must of course be possible, so either dlopen of jemalloc is fixed, or Rust has to not use jemalloc unless the main executable is a Rust program (you can still use the jemalloc API if you bind weakly to it in that case).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692092",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62692092",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62692092,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkyMDky",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:37:20Z",
    "updated_at": "2014-11-12T09:37:20Z",
    "body": "@pepp-cz Apologies for deleting my comment, I posted by accident while I was still typing the thing, and figured if I deleted quickly enough nobody would notice...\n\nAnyway, it seems clear from this thread that using the globally visible malloc and free would be slower than using the special api, even if jemalloc is behind malloc and free, so it would be preferable to avoid that. Wouldn't it be better to just document prominently that when mixing Rust code with other languages, one should not go around `free`ing memory that Rust has allocated, and the Rust code should do the same thing? You probably don't want to do that anyway, because when (in C, for example) you simply `free` a boxed value you received from Rust you do not run the destructor.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692092/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692205",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62692205",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62692205,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkyMjA1",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:38:17Z",
    "updated_at": "2014-11-12T09:38:46Z",
    "body": "> Dlopen of Rust libraries by C programs must of course be possible, so either dlopen of jemalloc is fixed, or Rust has to not use jemalloc unless the main executable is a Rust program.\n\nThat's part of implementing https://github.com/rust-lang/rust/issues/18838 which is orthogonal to whether jemalloc replaces the system allocator in an executable. This does not impact the ability to `dlopen` Rust code. This pull request doesn't make the current plugin situation any better or worse.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692205/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692304",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62692304",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62692304,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkyMzA0",
    "user": {
      "login": "pepp-cz",
      "id": 7118958,
      "node_id": "MDQ6VXNlcjcxMTg5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7118958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pepp-cz",
      "html_url": "https://github.com/pepp-cz",
      "followers_url": "https://api.github.com/users/pepp-cz/followers",
      "following_url": "https://api.github.com/users/pepp-cz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pepp-cz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pepp-cz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pepp-cz/subscriptions",
      "organizations_url": "https://api.github.com/users/pepp-cz/orgs",
      "repos_url": "https://api.github.com/users/pepp-cz/repos",
      "events_url": "https://api.github.com/users/pepp-cz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pepp-cz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:39:07Z",
    "updated_at": "2014-11-12T09:39:07Z",
    "body": "@thestinger The problem I see is that the system is already \"broken\" (fragile may be better word) even for C and C++ but people are used to it. The concern here is that Rust libraries should fit into usual brokeness boundaries. With your change the breakage may be worse.\n\nBut I realize that I made wrong conclusion from your last previous post. If the Rust dynamic library uses only global malloc and free then it can free anything that it receives from the the binary. When the alignment restrictions of malloc are more strict then requirements of the freex then the binary can free anything it receives from the library. The rallocx may fall into the same reasoning category.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692304/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692444",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62692444",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62692444,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkyNDQ0",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:40:15Z",
    "updated_at": "2014-11-12T09:40:15Z",
    "body": "> The problem I see is that the system is already \"broken\" (fragile may be better word) even for C and C++ but people are used to it. The concern here is that Rust libraries should fit into usual brokeness boundaries. With your change the breakage may be worse.\n\nThis pull request doesn't break anything.\n\n> But I realize that I made wrong conclusion from your last previous post. If the Rust dynamic library uses only global malloc and free then it can free anything that it receives from the the binary. When the alignment restrictions of malloc are more strict then requirements of the freex then the binary can free anything it receives from the library. The rallocx may fall into the same reasoning category.\n\nI don't really think we're talking about the same things.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692444/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692513",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62692513",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62692513,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkyNTEz",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:40:46Z",
    "updated_at": "2014-11-12T09:40:46Z",
    "body": "@bill-myers when you are in another language and you `free` memory that was allocated by Rust you do not run the `drop` code, so that is already very very wrong (and could potentially leak a lot of resources, break invariants, etc.). Just say 'no' to freeing the memory allocated by other languages :p\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692750",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62692750",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62692750,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkyNzUw",
    "user": {
      "login": "pepp-cz",
      "id": 7118958,
      "node_id": "MDQ6VXNlcjcxMTg5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7118958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pepp-cz",
      "html_url": "https://github.com/pepp-cz",
      "followers_url": "https://api.github.com/users/pepp-cz/followers",
      "following_url": "https://api.github.com/users/pepp-cz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pepp-cz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pepp-cz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pepp-cz/subscriptions",
      "organizations_url": "https://api.github.com/users/pepp-cz/orgs",
      "repos_url": "https://api.github.com/users/pepp-cz/repos",
      "events_url": "https://api.github.com/users/pepp-cz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pepp-cz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:42:56Z",
    "updated_at": "2014-11-12T09:42:56Z",
    "body": "@Thiez Of course the performance of the Rust library will be worse with only the malloc/free. The key part is the assumption that it can be done so that library uses the malloc/free interface to allocator while the binary uses mallocx/freex interface to the same allocator and nothing breaks.\n\nThe other assumtion is that when you decide to use dynamic library then you do not care about performance so much.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692750/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692842",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62692842",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62692842,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkyODQy",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:43:43Z",
    "updated_at": "2014-11-12T09:43:43Z",
    "body": "> Anyway, it seems clear from this thread that using the globally visible malloc and free would be slower than using the special api, even if jemalloc is behind malloc and free, so it would be preferable to avoid that. Wouldn't it be better to just document prominently that when mixing Rust code with other languages, one should not go around `free`ing memory that Rust has allocated, and the Rust code should do the same thing? You probably don't want to do that anyway, because when (in C, for example) you simply `free` a boxed value you received from Rust you do not run the destructor.\n\nIt's already documented, and is not something that would be a good idea to permit in any scenario. It's a _really_ bad idea to mix allocators across library boundaries this way on Windows. There is often more than one \"platform\" allocator in the same process there and it varies across the library boundaries. You need to free stuff with the API provided by the library / language itself.\n\nIn general, it's not something that should be permitted because it would tie the hands of Rust in the future. It would _always_ need to use an allocator stack fully interchangeable with \"the\" (which?) platform allocator if that was a guarantee. It would hamstring future improvements by forcing the whole allocator to be based around a legacy API.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62692842/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62693363",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62693363",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62693363,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkzMzYz",
    "user": {
      "login": "bill-myers",
      "id": 4647491,
      "node_id": "MDQ6VXNlcjQ2NDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4647491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bill-myers",
      "html_url": "https://github.com/bill-myers",
      "followers_url": "https://api.github.com/users/bill-myers/followers",
      "following_url": "https://api.github.com/users/bill-myers/following{/other_user}",
      "gists_url": "https://api.github.com/users/bill-myers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bill-myers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bill-myers/subscriptions",
      "organizations_url": "https://api.github.com/users/bill-myers/orgs",
      "repos_url": "https://api.github.com/users/bill-myers/repos",
      "events_url": "https://api.github.com/users/bill-myers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bill-myers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:47:49Z",
    "updated_at": "2014-11-12T09:49:06Z",
    "body": "Also keep in mind that some platform-specific C libraries might have broken code that relies on unspecified behavior of the system malloc, such as the way it aligns allocations, the way it rounds sizes up and the portion of address space it uses (esp. where it is located relative to the 2GB/4GB limit).\n\nIf the system allocator is replaced with jemalloc, then jemalloc has to provide those same guarantees, which might possibly result in wasting memory if the system allocator rounds sizes up a lot.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62693363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62693746",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62693746",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62693746,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkzNzQ2",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:50:55Z",
    "updated_at": "2014-11-12T09:50:55Z",
    "body": "@bill-myers in that case the broken library should be fixed. If it's broken for us it will also be broken programs that also use an alternative allocator, and probably on systems that use jemalloc as the system allocator (e.g. freebsd). I see no reason why Rust should suffer to support what is essentially hypothetical wrong third-party code.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62693746/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62694353",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62694353",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62694353,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjk0MzUz",
    "user": {
      "login": "bill-myers",
      "id": 4647491,
      "node_id": "MDQ6VXNlcjQ2NDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4647491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bill-myers",
      "html_url": "https://github.com/bill-myers",
      "followers_url": "https://api.github.com/users/bill-myers/followers",
      "following_url": "https://api.github.com/users/bill-myers/following{/other_user}",
      "gists_url": "https://api.github.com/users/bill-myers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bill-myers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bill-myers/subscriptions",
      "organizations_url": "https://api.github.com/users/bill-myers/orgs",
      "repos_url": "https://api.github.com/users/bill-myers/repos",
      "events_url": "https://api.github.com/users/bill-myers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bill-myers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T09:56:00Z",
    "updated_at": "2014-11-12T09:57:11Z",
    "body": "Well, for instance the binary-only Adobe Flash on Linux famously used memcpy() on overlapping memory areas and relied on glibc copying in the forward direction.\n\nSince the allocator is usually never replaced by normal C programs, I would definitely expect that there is code that does things like allocate 24 bytes and use 32 and that works reliably because the system malloc rounds up to powers of two.\n\nThinking more about it, I think prefixing jemalloc, never replacing the system allocator and thus always having two allocators running is the only thing that is both guaranteed to be bug-free and prevents libraries from depending on free on Boxes working.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62694353/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62694908",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62694908",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62694908,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjk0OTA4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T10:00:36Z",
    "updated_at": "2014-11-12T10:00:36Z",
    "body": "> I think it would help your case if you stopped for a minute and explained how the whole thing works point-by-point in one place, rather than responding to individual comments in 10 different threads.\n> This is a complicated subject and things that are obvious to you may be not quite so obvious to someone who did not spend several weeks tuning jemalloc and thinking about allocators.\n\nAll of the relevant information is in the original pull request. It doesn't make any changes to the user-facing semantics that are exposed today. It is an under the hood performance improvement, and 95% of the discussion here is off-topic for this pull request. The pull request has nothing to do with the ability to choose the allocator without compiling Rust and has no impact on the ability to `dlopen` Rust code. It is not a step towards or away from the ability to do these things. I noted that `dlopen` was already broken for other reasons when that was brought up along with explaining that the lack of a prefix is not incompatible with it.\n\n> I've read this exchange twice now and I still don't understand what is going to happen as a result of this change with all different OSes and linking modes involved.\n\nThat's exactly what was intended:\n\n> It's not a technical disagreement. It's a repeated pattern of obstructionism on my pull requests via misrepresentation of the issues and grasping for any dubious counter-argument you can think of. As your bogus information is refuted countless times you grasp for more mud to sling. Eventually, the waters are muddied enough that it's hard for anyone to tell what the real facts are. It doesn't change the fact that you're being repeatedly dishonest and manipulative.\n\nI have to keep addressing misinformation and repeated misrepresentation of my statements, so there is no way that anyone is going to be able to follow the conversation here.\n\n> Why would loading Rust modules into a C program be safe? Is this because Rust-allocated memory never gets free'ed outside of Rust modules (and vice-versa)? Or is this because jemalloc does something to interoperate with the system malloc?\n\nRust's allocator API is entirely separate from the C allocator API. It is explicitly documented as not being interchangeable with it for reasons that I have gotten into above. Dynamically loading a library with `dlopen` does not clobber the existing symbols so it really has no impact.\n\nIf foreign code is using a function like `mallocx`, then it is already linked against jemalloc without a prefix and Rust has _no say in the matter_. It doesn't make any sense to me that it's being used as an argument against this...\n\n> How would one in practice ensure that when linking with Rust static libraries, the whole program's allocator does not get replaced with jemalloc?\n\nRust already provides the option of the `alloc::heap` API using the C allocator API instead of the jemalloc API. The ability to make that decision for each executable / library is covered by https://github.com/rust-lang/rust/issues/18838 and is orthogonal to this pull request.\n\n> What is \"dss\", \"initial-exec\", \"zone allocator\", and other allocator-specific jargon?\n\ndss (data storage segment) refers to the heap data section, which is managed by `sbrk`. It is only possible to use it from a single allocator or there will be unsoundness. This article covers some of the issues involved: http://lifecs.likai.org/2010/02/sbrk-is-not-thread-safe.html\n\njemalloc has a runtime option setting the preference of mmap vs. sbrk. The default is `dss:secondary` so it will call it if `mmap` fails to provide the memory it wants. It can be set to `dss:primary` at runtime via an environment variable (or the mallctl API) and there's a performance argument for doing that by default. However, this is completely unsound if there's another allocator expanding / shrinking the heap with `sbrk` which is the case if the glibc allocator is being used in the same process.\n\nThe zone allocator API is an API provided by OS X / iOS for the explicit purpose of replacing the system allocator. Rust is currently making use of it, since it doesn't pass `--disable-zone-allocator` for configure. I have been mentioning this because I find it odd that people are totally fine with doing that but yet oppose the same thing on other platforms.\n\n`initial-exec` is not an allocator thing, it's a model for thread-local variables where the code is _guaranteeing_ that it is not loaded dynamically. Since jemalloc currently uses this for the thread local storage, it is not possible to dlopen it without clobbering TLS. This really has nothing to do with this pull request, but I was countering other off-topic claims.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62694908/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62695403",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62695403",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62695403,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjk1NDAz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T10:04:25Z",
    "updated_at": "2014-11-12T10:04:25Z",
    "body": "> Since allocators are never replaced by C programs\n\nThat's not true. This is the normal way to use the TCMalloc and jemalloc libraries, and C programs already need to cope with endless churn in the design of the glibc allocator and portability to various other allocators.\n\n> Thinking more about it, I think prefixing jemalloc, never replacing the system allocator and thus always having two allocators running is the only thing that is both guaranteed to be bug-free and prevents libraries from depending on free on Boxes working.\n\nI don't understand how you've managed to draw that conclusion. The FreeBSD, glibc, Windows and OS X allocators have been drastically changed over the years and it has never resulted in what you're claiming.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62695403/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62695843",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62695843",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62695843,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjk1ODQz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T10:08:16Z",
    "updated_at": "2014-11-12T10:08:16Z",
    "body": "Rust is already doing stuff like enabling full ASLR by default and having the linker remove unused sections which is far more relevant to the issue of breaking code that depends on undefined behaviour. Rust makes the assumption that `unsafe` code is correct, and making life friendly to broken code with memory corruption issues has never been part of the design process. The jemalloc guarantees about stuff like alignment are compatible with the operating system's allocator.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62695843/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62695974",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62695974",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62695974,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjk1OTc0",
    "user": {
      "login": "reem",
      "id": 4745181,
      "node_id": "MDQ6VXNlcjQ3NDUxODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4745181?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/reem",
      "html_url": "https://github.com/reem",
      "followers_url": "https://api.github.com/users/reem/followers",
      "following_url": "https://api.github.com/users/reem/following{/other_user}",
      "gists_url": "https://api.github.com/users/reem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/reem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/reem/subscriptions",
      "organizations_url": "https://api.github.com/users/reem/orgs",
      "repos_url": "https://api.github.com/users/reem/repos",
      "events_url": "https://api.github.com/users/reem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/reem/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T10:09:24Z",
    "updated_at": "2014-11-12T10:10:16Z",
    "body": "It is also trivially easy to define a `CBox<T>` which acts just like `Box<T>`, or at least it will be when we get `DerefMove`, that allocates using `libc` `malloc` and `free` and just use that to create allocations meant to be freed by C code.\n\nMy impression from past discussion was that C code being able to `free` `Box<T>` was an explicit non-goal, and that one should use the appropriate allocator if that is the desired use case, as the Rust allocator is _not defined_ as part of the Rust API.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62695974/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62702096",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62702096",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62702096,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzAyMDk2",
    "user": {
      "login": "pepp-cz",
      "id": 7118958,
      "node_id": "MDQ6VXNlcjcxMTg5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7118958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pepp-cz",
      "html_url": "https://github.com/pepp-cz",
      "followers_url": "https://api.github.com/users/pepp-cz/followers",
      "following_url": "https://api.github.com/users/pepp-cz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pepp-cz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pepp-cz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pepp-cz/subscriptions",
      "organizations_url": "https://api.github.com/users/pepp-cz/orgs",
      "repos_url": "https://api.github.com/users/pepp-cz/repos",
      "events_url": "https://api.github.com/users/pepp-cz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pepp-cz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:01:56Z",
    "updated_at": "2014-11-12T11:01:56Z",
    "body": "@thestinger After rereading the commit and some key parts of the discussion my understading is that the concern is that dynamic Rust libraries become \"poisonous\" because of the malloc/free. My question is: would it be possible to export unprefixed jemalloc symbols only for Rust binaries and use prefixed symbols in all Rust code? That way the Rust programs will benefit from single memory allocator with low risk of breaking any external code and on the other side dlopening Rust library will not change behaviour at the cost of using additional allocator alongside the system allocator (but when you decide to use dynamic library than performance presumably does not matter so much).\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62702096/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62702885",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62702885",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62702885,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzAyODg1",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:09:05Z",
    "updated_at": "2014-11-12T11:09:05Z",
    "body": "`dlopen` of a Rust library will not change the system allocator with this pull request.\n\nThe current situation is that liballoc can be compiled with or without `--cfg jemalloc` (`--disable-jemalloc` configure flag) which toggles whether it uses the jemalloc API and bundles jemalloc or builds on top of the C API. There is an issue filed about making the allocator configurable without recompiling all of Rust (#18838) but doing it well requires some thought.\n\n> My question is: would it be possible to export unprefixed jemalloc symbols only for Rust binaries and use prefixed symbols in all Rust code? \n\nI don't know how linking would work in this case. If the libraries use the prefixed symbols then those symbols need to provided by something for linking to complete.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62702885/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62702985",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62702985",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62702985,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzAyOTg1",
    "user": {
      "login": "bill-myers",
      "id": 4647491,
      "node_id": "MDQ6VXNlcjQ2NDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4647491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bill-myers",
      "html_url": "https://github.com/bill-myers",
      "followers_url": "https://api.github.com/users/bill-myers/followers",
      "following_url": "https://api.github.com/users/bill-myers/following{/other_user}",
      "gists_url": "https://api.github.com/users/bill-myers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bill-myers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bill-myers/subscriptions",
      "organizations_url": "https://api.github.com/users/bill-myers/orgs",
      "repos_url": "https://api.github.com/users/bill-myers/repos",
      "events_url": "https://api.github.com/users/bill-myers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bill-myers/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:09:57Z",
    "updated_at": "2014-11-12T11:09:57Z",
    "body": "If there are any widely-used large programs (Firefox or Chrome perhaps?) replacing the default allocator on Linux, that would give some confidence that at least the basic system libraries are not broken with non-default allocators.\n\nIn addition to the bugs issue, there is also the issue of things starting to depend on malloc() and the Rust allocator being interchangeable.\n\nIf we really want to allow replacing the system allocator I think it should be optional, and ideally a choice that can be overridden at runtime with an environment variable.\n\nMaybe what could be done is keep jemalloc prefixed or dlopen it with RTLD_LOCAL, and add code to Rust executables (not libraries) to use either glibc malloc hooks or GNU ifuncs to replace the system allocator, depending on both an environment variable and a default setting specified at compile time.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62702985/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62703092",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62703092",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62703092,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzAzMDky",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:10:58Z",
    "updated_at": "2014-11-12T11:10:58Z",
    "body": "> If there are any widely-used large programs (Firefox or Chrome perhaps?) replacing the default allocator on Linux, that would give some confidence that at least the basic system libraries are not broken with non-default allocators.\n\nFirefox, Chrome and MariaDB among others. It's the _normal_ way to use TCMalloc / jemalloc and putting either of them in `LD_PRELOAD` works perfectly fine across Linux distributions.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62703092/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62703574",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62703574",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62703574,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzAzNTc0",
    "user": {
      "login": "netvl",
      "id": 280456,
      "node_id": "MDQ6VXNlcjI4MDQ1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/280456?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/netvl",
      "html_url": "https://github.com/netvl",
      "followers_url": "https://api.github.com/users/netvl/followers",
      "following_url": "https://api.github.com/users/netvl/following{/other_user}",
      "gists_url": "https://api.github.com/users/netvl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/netvl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/netvl/subscriptions",
      "organizations_url": "https://api.github.com/users/netvl/orgs",
      "repos_url": "https://api.github.com/users/netvl/repos",
      "events_url": "https://api.github.com/users/netvl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/netvl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:15:20Z",
    "updated_at": "2014-11-12T11:17:38Z",
    "body": "I'm not experienced in allocation stuff, but I just do not understand why everyone states that this pull request affects dlopen while the pull request author states it does not. Again, I don't know in detail how allocators and dlopen-related functionality works, but it seems very clear to me from @thestinger's explanations that just renaming symbols per this PR **does not** affect dlopening, and dlopen is broken now anyway due to jemalloc implementation.\nI urge everyone to read the discussion more thoroughly, because there seems to be a great misunderstanding here.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62703574/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62703601",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62703601",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62703601,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzAzNjAx",
    "user": {
      "login": "pepp-cz",
      "id": 7118958,
      "node_id": "MDQ6VXNlcjcxMTg5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7118958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pepp-cz",
      "html_url": "https://github.com/pepp-cz",
      "followers_url": "https://api.github.com/users/pepp-cz/followers",
      "following_url": "https://api.github.com/users/pepp-cz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pepp-cz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pepp-cz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pepp-cz/subscriptions",
      "organizations_url": "https://api.github.com/users/pepp-cz/orgs",
      "repos_url": "https://api.github.com/users/pepp-cz/repos",
      "events_url": "https://api.github.com/users/pepp-cz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pepp-cz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:15:36Z",
    "updated_at": "2014-11-12T11:15:36Z",
    "body": "@bill-myers I have added jemalloc to couple large in-house developed programs running on linux without any problems. You can easily google results of benchmarks that many people did by preloading jemalloc or tcmalloc in different SQL databases, interpreters and other programs.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62703601/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62704248",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62704248",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62704248,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzA0MjQ4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:21:25Z",
    "updated_at": "2014-11-12T11:21:25Z",
    "body": "I don't care enough about Rust's performance to deal with this. That's all folks.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62704248/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62704739",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62704739",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62704739,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzA0NzM5",
    "user": {
      "login": "pepp-cz",
      "id": 7118958,
      "node_id": "MDQ6VXNlcjcxMTg5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7118958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pepp-cz",
      "html_url": "https://github.com/pepp-cz",
      "followers_url": "https://api.github.com/users/pepp-cz/followers",
      "following_url": "https://api.github.com/users/pepp-cz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pepp-cz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pepp-cz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pepp-cz/subscriptions",
      "organizations_url": "https://api.github.com/users/pepp-cz/orgs",
      "repos_url": "https://api.github.com/users/pepp-cz/repos",
      "events_url": "https://api.github.com/users/pepp-cz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pepp-cz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:25:56Z",
    "updated_at": "2014-11-12T11:25:56Z",
    "body": "@thestinger Excuse me that I ask another question but the pull request says \"The lack of a\nprefix allows jemalloc to override the weak symbols from the C standard\nlibrary to replace the system allocator.\" Recently you posted that \"dlopen of a Rust library will not change the system allocator with this pull request.\" Is it contradiction or I just misundestood something?\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62704739/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62704855",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62704855",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62704855,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzA0ODU1",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:27:05Z",
    "updated_at": "2014-11-12T11:27:05Z",
    "body": "It replaces the C allocator if and only if it's linked into the executable at initialization (ignoring `RTLD_DEEPBIND`, which is broken with nearly everything).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62704855/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62705245",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62705245",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62705245,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzA1MjQ1",
    "user": {
      "login": "pepp-cz",
      "id": 7118958,
      "node_id": "MDQ6VXNlcjcxMTg5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7118958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pepp-cz",
      "html_url": "https://github.com/pepp-cz",
      "followers_url": "https://api.github.com/users/pepp-cz/followers",
      "following_url": "https://api.github.com/users/pepp-cz/following{/other_user}",
      "gists_url": "https://api.github.com/users/pepp-cz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pepp-cz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pepp-cz/subscriptions",
      "organizations_url": "https://api.github.com/users/pepp-cz/orgs",
      "repos_url": "https://api.github.com/users/pepp-cz/repos",
      "events_url": "https://api.github.com/users/pepp-cz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pepp-cz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:30:51Z",
    "updated_at": "2014-11-12T11:30:51Z",
    "body": "@thestinger You mean dynamically linked at program initialization? What about RTLD_GLOBAL? Wouldn't it replace C allocator for other dlopened libraries?\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62705245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62705561",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62705561",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62705561,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzA1NTYx",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T11:34:15Z",
    "updated_at": "2014-11-12T11:34:15Z",
    "body": "It won't clobber the existing symbols without `RTLD_DEEPBIND`. I'm not pursuing this anymore so none of it really matters.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62705561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62775745",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62775745",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62775745,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzc1NzQ1",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T19:14:46Z",
    "updated_at": "2014-11-12T19:14:46Z",
    "body": "> It replaces the C allocator if and only if it's linked into the executable at initialization (ignoring RTLD_DEEPBIND, which is broken with nearly everything).\n\nI think this is the critical piece of information that was missing from the PR, and what most people were confused/wary about.   This was mentioned in this thread, but not prominently enough.    Very few people will have the energy to carefully read a long-ish thread, then hunt down the rest of info in the IRC logs, previous PRs, etc.   Least of all Rust core team, who, I imagine, are pretty busy these days.\nThis is exactly why I suggested that you write a mini-RFC, or a FAQ, to collect all information in one place that you can refer people to, instead of trying to put out fires in a zillion individual conversations.\n\n> I'm not pursuing this anymore so none of it really matters.\n\nI hope things look less bleak in the morning :-)\nWe value your contributions, but please try to keep your calm when people do not understand you.  I assure you, this is not entirely their fault.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62775745/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62780398",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62780398",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62780398,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzgwMzk4",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T19:42:30Z",
    "updated_at": "2014-11-12T19:42:30Z",
    "body": "Oh, and regarding LLVM allocator: can't we link rustc_llvm with `--defsym=malloc=je_malloc`, or something like that?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62780398/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62810510",
    "html_url": "https://github.com/rust-lang/rust/pull/18678#issuecomment-62810510",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18678",
    "id": 62810510,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyODEwNTEw",
    "user": {
      "login": "vks",
      "id": 33460,
      "node_id": "MDQ6VXNlcjMzNDYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/33460?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vks",
      "html_url": "https://github.com/vks",
      "followers_url": "https://api.github.com/users/vks/followers",
      "following_url": "https://api.github.com/users/vks/following{/other_user}",
      "gists_url": "https://api.github.com/users/vks/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vks/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vks/subscriptions",
      "organizations_url": "https://api.github.com/users/vks/orgs",
      "repos_url": "https://api.github.com/users/vks/repos",
      "events_url": "https://api.github.com/users/vks/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vks/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T22:52:56Z",
    "updated_at": "2014-11-14T08:55:35Z",
    "body": "@vadimcn Citing [pcwalton from the reddit thread](http://www.reddit.com/r/rust/comments/2m109d/weekly_meeting_111114/cm0hbf3):\n\n> Eventually we all came to the conclusion that the better way to avoid this is to use jemalloc the way it was designed: Rust executables should link against jemalloc, and shared Rust libraries should use whatever allocator that their host executable was linked with.\n> The submitter of that PR has stated that he'll be working on that quite soon, actually, and I'd be quite happy to take that revised PR that, as far as I can tell, pleases everyone involved.\n\nThis sounds less bleak I think.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62810510/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
