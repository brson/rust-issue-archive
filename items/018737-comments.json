[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62160016",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-62160016",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 62160016,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMTYwMDE2",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-07T15:27:48Z",
    "updated_at": "2014-11-07T15:27:48Z",
    "body": "Nominating for P-backcompat-lang, 1.0.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62160016/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62967077",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-62967077",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 62967077,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyOTY3MDc3",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-13T21:13:30Z",
    "updated_at": "2014-11-13T21:13:30Z",
    "body": "P-backcompat-lang, 1.0, but its possible that this is lesser priority than other P-backcompat-lang issues (i.e. we may be able to hold off on fixing this until the beta period).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62967077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62967153",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-62967153",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 62967153,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyOTY3MTUz",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-13T21:13:58Z",
    "updated_at": "2014-11-13T21:13:58Z",
    "body": "If push came to shove, we could live with this behavior.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62967153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69237621",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-69237621",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 69237621,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjM3NjIx",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-08T19:49:47Z",
    "updated_at": "2015-01-08T19:49:47Z",
    "body": "Nominating. It sounds like this should _not_ be on the -beta milestone, but we should discuss.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69237621/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69256945",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-69256945",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 69256945,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjU2OTQ1",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-08T21:57:04Z",
    "updated_at": "2015-01-08T21:57:10Z",
    "body": "Assigning 1.0-beta milestone based on potential for breaking lots of code according to nrc.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69256945/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/70016721",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-70016721",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 70016721,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDE2NzIx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-14T23:55:13Z",
    "updated_at": "2015-01-14T23:55:13Z",
    "body": "An example that this may fix (or maybe a good smoke test)\n\n``` rust\npub trait Any: 'static {}\npub struct Box2<T: ?Sized>(Box<T>);\n\nimpl Box2<Any> {\n    pub fn foo(self) {}\n}\n\nfn t2(t: Box2<Any + Send>) {\n    t.foo(); // type `Box2<Any + Send>` does not implement any method in scope named `foo`\n} \n```\n\nThis is largely in relation to the `BoxAny` trait we currently have.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/70016721/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78450798",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-78450798",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 78450798,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDUwNzk4",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-12T09:53:21Z",
    "updated_at": "2015-03-12T09:53:21Z",
    "body": "OK, so I have a fix for this issue, but there is a bit of a complication. In particular, removing the subtyping relation means that methods implemented on (say) `&Any` are not available when the receiver is `Box<Any+Send>`. The reason that this worked before is because, when we autoderef `Box<Any+Send>` to `&(Any+Send)`, we found that `&(Any+Send)` was a subtype of `&Any`, but that is no longer true. This was expected and I figured I would fix it as part of this patch (it was, indeed, the anticipated \"hard part\"). However, I am now having second thoughts about fixing this right now, and instead am contemplating landing a patch that breaks it a bit further. Read on for the explanation. :) Or, skip to the end to see what I propose to do.\n\nHere are people I think might have an opinion on this that are not already familiar with the details: @reem @alexcrichton \n\n### Detailed explanation\n\nSo, after this patch, `&(Any+Send)` can indeed be coerced to `&Any` through a new kind of unsize coercion-- an upcast. Right now, upcasts are no-ops at runtime, but this will not always be true, because we'd eventually like to extend upcasts to cover the cases where vtables have to be adjusted. This is indeed one of the primary reasons to remove this subtyping relation and replace it with coercion.\n\nMethod dispatch already makes some effort to accommodate unsizing. The idea is that it begins by creating a series of autoderef steps based on the type of the receiver (e.g., `&Box<[T;N]>` => `Box<[T;N]>` => `[T;N]`). If the final step is a fixed-length vector like `[T;N]`, then we add one additional step to `[T]`. We will then walk those steps in order, searching for a method. At each step, we first try the type `U` itself, then we try `&U` and `&mut U` (\"autoref\"). So that means that `&Box<[T;N]>` could match to an expected receiver type of `&[T]`, for example, by autoderefing 2 times to `[T;N]`, unsizing once to `[T]`, and then autorefing to `&[T]`. However, this process would _never_ match something like `Box<[T]>` -- because at that step, the unsizing hasn't happened yet, and so we only search for `Box<[T;N]>`, `&Box[T;N]`, and `&mut Box<[T;N]>`. This is unfortunate -- and in particular, the current API for the `Any` type includes a method `downcast` that is implemented for `Box<Any>` but frequently invoked on `Box<Any+Send>`, and a method invocation like that wouldn't fit into this model.\n\nBesides the limitation around matching `Box<[T]>` There is another problem with the existing unsizing -- something which makes it somewhat unapplicable to trait objects. In particular, while unsizing a fixed-length vector type like `[T;N]` has a deterministic result (`[T]`), upcasting a trait object does not. If you have a type like `A+B+C+D` (thinking forward to the future), it could be upcast to `A+B+C`, `A+B+D`, `A+C+D`, etc. And in fact there are even more combinations, since any one of those traits may have supertraits as well. \n\nOK, I've laid the groundwork. Now let me tell you about two things. First, what I tried so far, and second, what I think we probably eventually want.\n\nWhat I implemented so far is a simple hack. Basically I extended the unsize support that we have today (`[T;N]` => `[T]`) to trait objects. This relies on the current limitations that are in place for trait objects. In particular, trait objects today must have a _primary_ trait and some number of _builtin_ traits (`Copy`, `Send`, `Sync`, `Sized`). In practice, these are always `Send` and `Sync`. Which is unfortunate, because those are the two traits we want to remove from the compiler entirely. :) Anyway, I tried a hack where if the final type is an object type with builtin traits, we will drop _all_ the builtin traits. Which means we will unsize `Any+Send` to `Any`. If we had `Any+Send+Sync`, we'd also unsize _that_ to `Any`.  This scheme is _almost_ sufficient to type-check the existing `Any` API, _except_ for the fact that `downcast` is implemented on `Box<Any>`. As I described above when talking about unsizing `[T;N]`, even with this additional unsize step, we only wind up searching for `&Any`, and not `Box<Any>`.  This hack is also not very future proof. It relies on the notion of a primary trait, which is going away, and on a distinction around builtin traits that is going away. Bad.\n\nWhat I think we probably _want_ to do is extend method dispatching beyond subtyping to also consider (at least some) implicit coercions. I'm not entirely sure how we want to do this, I see a lot of options. For example, we might consider all implicit coercions. We might try only fat pointer coercions. We might not even want to try _all_ fat pointer coercions. There are lots of potential interactions and more than a few unknowns here. For example, will we have widening coercions in the future? How exactly will DST coercions work and what will they cover? Will people _even care_ if these coercions are missing from method dispatch? (Oh, and also, these more general solutions are kind of a pain to implement right now, though feasible.)\n\nLet me give you one example of a potentially bad interaction I was concerned about. Imagine that at each step, where we now consider subtyping, we also considered fat pointer coercion. One of the fat pointer coercions is that `Box<T>` can be coerced to `Box<Trait>` where `T:Trait`. Now, imagine that I have a receiver `x` of some type `Box<Foo>` where `Foo:Bar`, and I call `x.bar()` (here, `bar()` is an `&self` method defined in the `Bar` trait). This would normally autoderef by one step to `Foo` and then autoref to `&Foo` and we would statically dispatch. OK, now imagine I added an impl like `impl Bar for Box<Bar>`. This seems harmless enough. But we'll see that in fact it's a kind of footgun -- because now with our receiver `x` we could do a fat pointer coercion from `Box<Foo>` to `Box<Bar>` and dispatch that way.\n\nThis led me to two options:\n1. Don't consider the full set of fat-pointer coercions at each step, just upcasts and array unsizing (from `[T;N]` to `[T]`). But that's weird because now method dispatch uses a distinct set of coercions from other things.\n2. First do the full walk based on subtyping, as we do today, and then do a second walk based on coercions. This has the advantage of (a) being backwards compatible; (b) preferring tighter types whenever possible; and (c) not costing anything in compile time for programs that compile today (and for most method calls in the future too, I anticipate).\n\nSo option 2 seems good, but it also seems like an extension we can toy with in the future, and in particular we can experiment around the precise set of coercions we want to consider.\n\n### What I propose to do\n\nRemove the subtyping relation and add upcast coercions (implemented).\n\nLeave method dispatch as it is (implemented). This includes the `[T;N]` to `[T]` unsizing but no others. That could prove to be a slight asymmetry but removing it seems like it would break a lot of code. There is a slight risk in keeping this coercion, because if we add more general coercion support in the future, it could induce backwards incompatibilities around receiver types like `Box<[T;N]>`. In particular, if there were impls available for `Box<[T]>` and `&[T]`, we would dispatch to the latter today, but in the future with a more general solution we'd probably prefer the former. I expect we'd be able to change this without getting complaints (in fact, it seems like a bug fix), but it's a risk.\n\nThis does affect the `Any` API. In particular, if you have a `Any+Send` object, you can't use method form. You have two options then: upcast, or use free fns / UFCS form. The latter works because you get upcast coercions in that cast. Today that means writing `Any::is::<T>(obj)` instead of `obj.is::<T>()` and `<Box<Any>>::downcast::<T>(obj)` instead of `obj.downcast::<T>()`. Arguably we could/should just change those to be functions in the `any` module (`any::is::<T>(obj)`, `any::downcast::<T>(obj)`), since the method form isn't especially convenient.\n\nThis may affect other APIs outside of std, but I am not sure. This is partly why I cc'd @reem, because I know he does various bits of magic, though I don't think the things I've seen would have their public APIs affected by these changes.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78450798/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78501004",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-78501004",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 78501004,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTAxMDA0",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-12T15:19:27Z",
    "updated_at": "2015-03-12T15:19:27Z",
    "body": "I also posted the above comment to discuss: http://internals.rust-lang.org/t/impact-of-fixing-subtyping-for-object-types-18737/1709\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78501004/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78505086",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-78505086",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 78505086,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTA1MDg2",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-12T15:38:00Z",
    "updated_at": "2015-03-12T15:38:00Z",
    "body": "Hmm, I encountered a bit of a footgun. It's kind of related to all of the method dispatch above actually (and suggests, in fact, that more general fat pointer coercion would make the `Any` API harder to use). In particular, what would you expect this code to do:\n\n``` rust\nstruct S { .. }\nfn foo(x: Box<Any+Send>) -> bool {\n    Any::is::<S>(&x)\n}\n```\n\nPresuming that `x` is, in fact, a `Box<S>`, I would expect this to return true. But it returns false. The reason is that `Any` expects a `&Any`. It is supplied a `&Box<Any+Send>`. Rather than deref coercions kicking in, as I expected, we get a trait coercion where `Box<Any+Send>` is coerced to the trait object `Any`, and thus the type test fails because `S != Box<Any+Send>`. The code works fine if you write `&*x`, in particular. Note that if we did the full fat-pointer-based method dispatch I described above, the same phenomenon would arise.\n\nThis problem is somewhat specific to the `Any` API, because it is implemented basically for all `T`, but it suggests that free-fns can also be easily misused. It'd be nice to have an API form that is downright _hard_ to misuse. I'm not sure what's the best fix here.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78505086/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78603591",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-78603591",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 78603591,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NjAzNTkx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-12T20:32:44Z",
    "updated_at": "2015-03-12T20:32:44Z",
    "body": "If the `Any+Send` case is generalized to `Foo+X`, does this mean that methods defined via `impl Foo` will not be available on `Box<Foo+X>` (regardless of `X`)?\n\n> Hmm, I encountered a bit of a footgun.\n\nHm that is... unfortunate! I do agree though that it is `Any`-specific, however. I recall running across this footgun in the past (both myself and via questions on IRC), so I wouldn't be too too worried about it. I think it's fine to move to free functions or require UFCS (perhaps favoring UFCS as the methods are `#[stable]` currently)\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78603591/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78676608",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-78676608",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 78676608,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4Njc2NjA4",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-12T22:59:34Z",
    "updated_at": "2015-03-12T22:59:48Z",
    "body": "@nikomatsakis \n\nHow would moving to UFCS solve it? Isn't the problem that with `<&Any as Any>::is::<S>(&ex)` rustc coerces `ex` to `Any` by an autoref (to `&Box<Any>`) followed by an unsize rather than by an autoderef to `Box<Any>` followed by an autoref?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78676608/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/81707004",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-81707004",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 81707004,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNzA3MDA0",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-16T14:44:20Z",
    "updated_at": "2015-03-16T14:44:20Z",
    "body": "@alexcrichton \n\n> If the `Any+Send` case is generalized to `Foo+X`, does this mean that methods defined via `impl Foo` will not be available on `Box<Foo+X>` (regardless of `X`)?\n\nYes.\n\n> I think it's fine to move to free functions or require UFCS (perhaps favoring UFCS as the methods are #[stable] currently)\n\nI think I favor free fns only because I find it somewhat more ergonomic. For example, you can do `use any::is` and then write `is::<T>(x)` vs `Any::is(x)`. Similarly, `<Box<Any>>::downcast()` is fairly annoying.\n\n> Hm that is... unfortunate! I do agree though that it is Any-specific, however. I recall running across this footgun in the past (both myself and via questions on IRC), so I wouldn't be too too worried about it. \n\nI don't see any clear sol'n -- but I did find forward porting some tests to be fairly annoying due to this. This was mostly a problem in various \"torture tests\" that seemed to have particularly confusing type casts going on though.  \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/81707004/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/81708074",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-81708074",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 81708074,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNzA4MDc0",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-16T14:46:06Z",
    "updated_at": "2015-03-16T14:46:27Z",
    "body": "@arielb1 \n\n> How would moving to UFCS solve it? Isn't the problem that with `<&Any as Any>::is::<S>(&ex)` rustc coerces `ex` to `Any` by an autoref (to `&Box<Any>`) followed by an unsize rather than by an autoderef to `Box<Any>` followed by an autoref?\n\nSorry, I'm not sure what comment of mine you are referring to, but:\n1. UFCS solves the problem where I supply a `&(Any+Send)` and a `&Any` is expected. This is because we can't make an `Any` object from an `Any+Send` object except by upcasting (you can only make an object from a sized type). \n2. UFCS does _not_ solve the footgun I mentioned where you supply an `&Box<Any+Send>` and an `&Any` is expected, because `Box<Any+Send>` can be \"objectified\" to `Any`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/81708074/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/81968708",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-81968708",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 81968708,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxOTY4NzA4",
    "user": {
      "login": "reem",
      "id": 4745181,
      "node_id": "MDQ6VXNlcjQ3NDUxODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4745181?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/reem",
      "html_url": "https://github.com/reem",
      "followers_url": "https://api.github.com/users/reem/followers",
      "following_url": "https://api.github.com/users/reem/following{/other_user}",
      "gists_url": "https://api.github.com/users/reem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/reem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/reem/subscriptions",
      "organizations_url": "https://api.github.com/users/reem/orgs",
      "repos_url": "https://api.github.com/users/reem/repos",
      "events_url": "https://api.github.com/users/reem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/reem/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-16T22:34:04Z",
    "updated_at": "2015-03-16T22:34:04Z",
    "body": "@nikomatsakis sorry I didn't get to this sooner. Your approach sounds reasonable, but the footguns surrounding the use of `Any` and other traits which are implemented for most/all T make me less enthused about this. I can work around anything in a downstream library, but it would make me a lot more apprehensive about using [unsafe-any](https://github.com/reem/rust-unsafe-any/blob/master/src/lib.rs), since the chance of something going horribly wrong is much higher.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/81968708/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/82260455",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-82260455",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 82260455,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMjYwNDU1",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-17T10:21:59Z",
    "updated_at": "2015-03-17T10:21:59Z",
    "body": "@reem yes, I was wondering about what's the best solution here. Definitely I found working with `Any` to be... precarious when I was forward-porting tests. One possibility is of course a custom lint to watch out for things like coercing a `&Box<Any+Send>` into a `&Any` as an argument of `any::is` and friends, but that won't help for `unsafe_any` (and feels...very tailored!).\n\nAnother possibility is that I could keep the simple hack that dropped all builtin bounds from method dispatch (i.e., step from `Trait+Send` to `Trait`). But that feels unfortunate because it is involving a lot of concepts I would like to go away. It's not a very general mechanism so I'd hate to be relying on it forever.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/82260455/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/82262809",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-82262809",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 82262809,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMjYyODA5",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-17T10:30:46Z",
    "updated_at": "2015-03-17T10:30:46Z",
    "body": "Well, something else just occurred to me. One other simple fix here might be to implement the relevant methods for `Any` on `Any+Send` as well. Kind of a hack, but at least we'd only have to get the code that does the upcasting correct once, and this is a very common case due to the thread error propagation APIs.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/82262809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/82323023",
    "html_url": "https://github.com/rust-lang/rust/issues/18737#issuecomment-82323023",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18737",
    "id": 82323023,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMzIzMDIz",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-17T12:38:13Z",
    "updated_at": "2015-03-17T12:38:13Z",
    "body": "I implemented the approach of adding extra impls for `Any`. This causes all existing code in libstd to work and seems to address the footgun problem, while still leaving us room in the future to expand method dispatch to handle more such cases (this basically just builds in one particular upcast).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/82323023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
