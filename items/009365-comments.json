[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24837151",
    "html_url": "https://github.com/rust-lang/rust/issues/9365#issuecomment-24837151",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9365",
    "id": 24837151,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0ODM3MTUx",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-20T19:55:52Z",
    "updated_at": "2013-09-20T19:55:52Z",
    "body": "cc #8752\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24837151/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/36420270",
    "html_url": "https://github.com/rust-lang/rust/issues/9365#issuecomment-36420270",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9365",
    "id": 36420270,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDIwMjcw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-03-01T09:16:59Z",
    "updated_at": "2014-03-01T09:16:59Z",
    "body": "Closing, this is done. Rlibs don't have compressed metadata, but dylibs still do (due to linker restrictions)\n\nWe prefer reading rlibs, so we're getting all the benefits anyway.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/36420270/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58792861",
    "html_url": "https://github.com/rust-lang/rust/issues/9365#issuecomment-58792861",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9365",
    "id": 58792861,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzkyODYx",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-12T11:48:30Z",
    "updated_at": "2014-10-12T11:48:30Z",
    "body": "What was the perf gain from not compressing metadata?\n\nI am trying to create a dynamically linked snapshot and I would rather not increase its size significantly.\n\nInitial increase was from `49MB` to `108MB` which is unacceptable IMO. Disabling [this rather wasteful functionality](https://github.com/rust-lang/rust/blob/86509d8d7ab68c5e4202dea9ff1bfb79409f2f8d/src/librbml/lib.rs#L816) brought it down to `96MB`.\nOn top of not having field names output in RBML (which that `DEBUG` is controlling), compressing libcore's `14MB` `rust.metadata.bin` with gzip gives me `2MB`, while xz takes it to `1.1MB`, though adding xz support to the compiler is not exactly trivial.\n\nI understand compression can add to the compilation time, but I think it's faster without field names _and_ I only really need it turned on for snapshots.\n\n@alexcrichton Any ideas? Perhaps I should open another issue for shrinking binary sizes in general, I believe #14527 might help with that - also, bundling all the crates behind the std facade within a dynamically linked std and something similar for `librustc_llvm` - but that's really offtopic by now.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58792861/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58794171",
    "html_url": "https://github.com/rust-lang/rust/issues/9365#issuecomment-58794171",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9365",
    "id": 58794171,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4Nzk0MTcx",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-12T12:10:30Z",
    "updated_at": "2014-10-12T12:10:30Z",
    "body": "Turns out I completely forgot the snapshot is compressed, and with `xz -9 -e` (thanks @thestinger), I get `26MB` for the dynamically linked snapshot and `12MB` for the old one.\nEven just `gz` is less than twice that, so I'm less worried about it (for `xz` support we would need [this python library](https://pypi.python.org/pypi/backports.lzma)).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58794171/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58816593",
    "html_url": "https://github.com/rust-lang/rust/issues/9365#issuecomment-58816593",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9365",
    "id": 58816593,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4ODE2NTkz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-12T18:57:51Z",
    "updated_at": "2014-10-12T18:57:51Z",
    "body": "I'm a bit hazy on the details at this point, so I decided to re-run the numbers:\n\n``` rust\nextern crate alloc;\nextern crate arena;\nextern crate collections;\nextern crate core;\nextern crate debug;\nextern crate flate;\nextern crate getopts;\nextern crate glob;\nextern crate graphviz;\nextern crate green;\nextern crate libc;\nextern crate log;\nextern crate native;\nextern crate num;\nextern crate rand;\nextern crate rbml;\nextern crate regex;\nextern crate rlibc;\nextern crate rustrt;\nextern crate semver;\nextern crate serialize;\nextern crate sync;\nextern crate term;\nextern crate test;\nextern crate time;\nextern crate unicode;\nextern crate url;\n#[cfg(so)] extern crate rustc;\n#[cfg(so)] extern crate rustdoc;\n#[cfg(so)] extern crate uuid;\n\nfn main() {}\n```\n\n## Reading rlib metadata\n\n```\n$ RUST_LOG=rustc::metadata::loader rustc foo.rs -Lrlib -Lcommon 2>&1 | grep 'reading.*=>'  \nINFO:rustc::metadata::loader: reading libstd-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading liballoc-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libcore-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading liblibc-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libunicode-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libcollections-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading librand-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libsync-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading librustrt-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libnative-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libarena-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libdebug-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libflate-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libgetopts-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libglob-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libgraphviz-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libgreen-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading liblog-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libregex-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libnum-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading librbml-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libserialize-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading librlibc-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libsemver-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libterm-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libtest-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libtime-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading liburl-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libuuid-4e7c5e5c.rlib => 0ms\n```\n\n## Reading dylib metadata\n\n```\n$ RUST_LOG=rustc::metadata::loader rustc foo.rs --cfg so -Lso -Lcommon 2>&1 | grep 'reading.*=>'\nINFO:rustc::metadata::loader: reading libstd-4e7c5e5c.so => 16ms\nINFO:rustc::metadata::loader: reading liballoc-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libcore-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading liblibc-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libunicode-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libcollections-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading librand-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libsync-4e7c5e5c.so => 5ms\nINFO:rustc::metadata::loader: reading librustrt-4e7c5e5c.so => 2ms\nINFO:rustc::metadata::loader: reading libnative-4e7c5e5c.so => 1ms\nINFO:rustc::metadata::loader: reading libarena-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading libdebug-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading libflate-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading libgetopts-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading libglob-4e7c5e5c.so => 1ms\nINFO:rustc::metadata::loader: reading libgraphviz-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading libgreen-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading liblog-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading libregex-4e7c5e5c.so => 1ms\nINFO:rustc::metadata::loader: reading libregex_macros-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading libnum-4e7c5e5c.so => 3ms\nINFO:rustc::metadata::loader: reading librbml-4e7c5e5c.so => 1ms\nINFO:rustc::metadata::loader: reading libserialize-4e7c5e5c.so => 6ms\nINFO:rustc::metadata::loader: reading librlibc-4e7c5e5c.rlib => 0ms\nINFO:rustc::metadata::loader: reading libsemver-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading libterm-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading libtest-4e7c5e5c.so => 2ms\nINFO:rustc::metadata::loader: reading libtime-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading liburl-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading librustc_llvm-4e7c5e5c.so => 1ms\nINFO:rustc::metadata::loader: reading librustc_back-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading librustc-4e7c5e5c.so => 43ms\nINFO:rustc::metadata::loader: reading libsyntax-4e7c5e5c.so => 34ms\nINFO:rustc::metadata::loader: reading libfmt_macros-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading librustc_llvm-4e7c5e5c.so => 1ms\nINFO:rustc::metadata::loader: reading librustc_back-4e7c5e5c.so => 0ms\nINFO:rustc::metadata::loader: reading librustdoc-4e7c5e5c.so => 10ms\nINFO:rustc::metadata::loader: reading libuuid-4e7c5e5c.so => 0ms\n```\n\nNote that reading compressed metadata adds an extra 22ms to all rust compilations, and as we continue to proliferate libraries through cargo I suspect that this will only get worse. The benefit of an uncompressed metadata file is that it can be `mmap`'d directly by LLVM which is basically an instantaneous operation (as you can see).\n\nI had no idea we had some sort of \"debug\" flag turned on for rbml, we should definitely turn that off if it's just bloating metadata!\n\nAlso, as you seem to have figured out, metadata is super compressable, so I would only worry about the gzip sizes. I wouldn't worry too much about the distribution size of the snapshot as it's not like it's downloaded on every rust compile!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58816593/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
