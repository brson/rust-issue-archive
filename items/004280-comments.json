[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/11664555",
    "html_url": "https://github.com/rust-lang/rust/issues/4280#issuecomment-11664555",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4280",
    "id": 11664555,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjY0NTU1",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-12-24T18:40:12Z",
    "updated_at": "2012-12-24T18:45:41Z",
    "body": "I ran into an annoying problem with the borrow checker for a very common sort of operation: maintaining a cache with a LinearMap. Here is an example:\n\n```\nextern mod std;\nuse core::send_map::linear::{LinearMap};\n\npub type Cache = LinearMap<~str, ~str>;\n\nfn animal_noise(cache: &mut Cache, animal: ~str) -> ~str\n{\n    fn find_noise(animal: ~str) -> ~str\n    {\n        let noises = ~[(~\"dog\", ~\"The dog barks.\"), (~\"cat\", ~\"The cat meows.\"), (~\"cow\", ~\"The cow moos.\")];\n        match do noises.position |x| {x.first_ref() == &animal}\n        {\n            option::Some(index) => copy *noises[index].second_ref(),\n            option::None => fmt!(\"Don't know what %s does.\", animal)\n        }\n    }\n\n    match cache.find_ref(&animal)   // currently can't call this because cache is mutable\n    {\n            Some(noise) => copy *noise,\n            None =>\n            {\n                let noise = find_noise(copy animal);\n                cache.insert(animal, copy noise);\n                noise\n            }\n    }\n}\n\n#[test]\nfn test_noises()\n{\n    let mut cache = LinearMap();\n    assert animal_noise(&mut cache, ~\"dog\") == ~\"The dog barks.\";\n    assert animal_noise(&mut cache, ~\"dog\") == ~\"The dog barks.\";\n    assert animal_noise(&mut cache, ~\"cat\") == ~\"The cat meows.\";\n}\n```\n\nBest fix I have found is to move the cache in and out of the function and introduce a helper function that works like LinearMap::find_ref but returns a copy instead. Bu INHTWAMA would allow &mut pointers to be temporarily frozen which should allow the above to be written in a much more natural manner.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/11664555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/15505633",
    "html_url": "https://github.com/rust-lang/rust/issues/4280#issuecomment-15505633",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4280",
    "id": 15505633,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1NTA1NjMz",
    "user": {
      "login": "sanxiyn",
      "id": 45249,
      "node_id": "MDQ6VXNlcjQ1MjQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/45249?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sanxiyn",
      "html_url": "https://github.com/sanxiyn",
      "followers_url": "https://api.github.com/users/sanxiyn/followers",
      "following_url": "https://api.github.com/users/sanxiyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/sanxiyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sanxiyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sanxiyn/subscriptions",
      "organizations_url": "https://api.github.com/users/sanxiyn/orgs",
      "repos_url": "https://api.github.com/users/sanxiyn/repos",
      "events_url": "https://api.github.com/users/sanxiyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sanxiyn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-03-27T05:57:27Z",
    "updated_at": "2013-03-27T05:57:27Z",
    "body": "@nikomatsakis, this is done?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/15505633/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/15711228",
    "html_url": "https://github.com/rust-lang/rust/issues/4280#issuecomment-15711228",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4280",
    "id": 15711228,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1NzExMjI4",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-04-01T10:33:38Z",
    "updated_at": "2013-04-01T10:33:38Z",
    "body": "It's done enough. #5074 is still pending, but that's a more concrete issue.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/15711228/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
