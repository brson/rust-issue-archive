[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1668698",
    "html_url": "https://github.com/rust-lang/rust/pull/753#issuecomment-1668698",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/753",
    "id": 1668698,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2Njg2OTg=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-07-27T23:05:55Z",
    "updated_at": "2011-07-27T23:05:55Z",
    "body": "I haven't reviewed everything thoroughly, but I agree in principle with what's going on here. I'm not sure about the atomic reference counting for tasks - having those have special reference counting needs kinda smells funny.\n\nThere's a good bit of asserts and logging that are lost in these patches.\n\nRunning this locally I see regressions in multithreaded runs of the make check, invalid reads that didn't exist before. They all seem to originate in task::worker, which is really terribly unsafe, so I'm in the process of removing it from the codebase. I'll see if I get better results then.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1668698/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1668767",
    "html_url": "https://github.com/rust-lang/rust/pull/753#issuecomment-1668767",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/753",
    "id": 1668767,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2Njg3Njc=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-07-27T23:16:48Z",
    "updated_at": "2011-07-27T23:16:48Z",
    "body": "OK, I checked in a commit that removed task::worker and things seem much more reliable now\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1668767/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1668790",
    "html_url": "https://github.com/rust-lang/rust/pull/753#issuecomment-1668790",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/753",
    "id": 1668790,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2Njg3OTA=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-07-27T23:20:27Z",
    "updated_at": "2011-07-27T23:20:27Z",
    "body": "Well, single-threaded anyway. With 'RUST_THREADS=32 make check-stage1-cfail' I get errors like:\n\n==2124== Thread 5:\n==2124== Invalid read of size 4\n==2124==    at 0x48FFE5D: rust_chan::disassociate() (sync.h:32)\n==2124==    by 0x48FFF36: rust_chan::destroy() (rust_chan.cpp:148)\n==2124==    by 0x4901580: upcall_del_chan (rust_upcall.cpp:155)\n==2124==    by 0x8078A08: glue_free322 (in /home/banderson/Dev/rust/build/test/compiletest.stage1)\n==2124==    by 0x80789C2: glue_drop321 (in /home/banderson/Dev/rust/build/test/compiletest.stage1)\n==2124==    by 0x807890F: glue_drop320 (in /home/banderson/Dev/rust/build/test/compiletest.stage1)\n==2124==    by 0x80724C8: compiletest::procsrv::worker (in /home/banderson/Dev/rust/build/test/compiletest.stage1)\n==2124==    by 0x8078130: compiletest::procsrv::mk::anon298 (in /home/banderson/Dev/rust/build/test/compiletest.stage1)\n==2124==    by 0x8077F88: compiletest::procsrv::mk::spawn_wrapper297 (in /home/banderson/Dev/rust/build/test/compiletest.stage1)\n==2124==    by 0x48FF050: task_start_wrapper (rust_task.cpp:126)\n\nand \n\nfree: ptr 0xcd64fb4 is not in allocation_list\nrt: fatal, 'not in allocation_list' failed, ../src/rt/memory_region.cpp:47 \n==4557== 144 bytes in 1 blocks are possibly lost in loss record 33 of 115\n==4557==    at 0x48E8327: calloc (vg_replace_malloc.c:467)\n==4557==    by 0x4410FC7: allocate_dtv (dl-tls.c:300)\n==4557==    by 0x441175B: _dl_allocate_tls (dl-tls.c:464)\n==4557==    by 0x4C025A6: pthread_create@@GLIBC_2.1 (allocatestack.c:570)\n==4557==    by 0x48F8A4F: rust_thread::start() (sync.cpp:47)\n==4557==    by 0x48F92EB: rust_start (rust.cpp:147)\n==4557==    by 0x807A397: main (in /home/banderson/Dev/rust/build/test/compiletest.stage1)\n==4557== \n==4557== 4,608 bytes in 32 blocks are possibly lost in loss record 97 of 115\n==4557==    at 0x48E8327: calloc (vg_replace_malloc.c:467)\n==4557==    by 0x4410FC7: allocate_dtv (dl-tls.c:300)\n==4557==    by 0x441175B: _dl_allocate_tls (dl-tls.c:464)\n==4557==    by 0x4C025A6: pthread_create@@GLIBC_2.1 (allocatestack.c:570)\n==4557==    by 0x48F8A4F: rust_thread::start() (sync.cpp:47)\n==4557==    by 0x4905EFB: rust_kernel::start_task_threads() (rust_kernel.cpp:257)\n==4557==    by 0x48F954D: rust_start (rust.cpp:164)\n==4557==    by 0x807A397: main (in /home/banderson/Dev/rust/build/test/compiletest.stage1)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1668790/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1668795",
    "html_url": "https://github.com/rust-lang/rust/pull/753#issuecomment-1668795",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/753",
    "id": 1668795,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2Njg3OTU=",
    "user": {
      "login": "eholk",
      "id": 105766,
      "node_id": "MDQ6VXNlcjEwNTc2Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eholk",
      "html_url": "https://github.com/eholk",
      "followers_url": "https://api.github.com/users/eholk/followers",
      "following_url": "https://api.github.com/users/eholk/following{/other_user}",
      "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eholk/subscriptions",
      "organizations_url": "https://api.github.com/users/eholk/orgs",
      "repos_url": "https://api.github.com/users/eholk/repos",
      "events_url": "https://api.github.com/users/eholk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eholk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-07-27T23:20:57Z",
    "updated_at": "2011-07-27T23:20:57Z",
    "body": "Thanks, brson!\n\nAtomic reference counting is there because tasks are reference by multiple threads. No other data (well... almost) is shared between tasks, which is why the task structure itself is special. This is a temporary measure anyway, eventually we'll just have handles.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1668795/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1669610",
    "html_url": "https://github.com/rust-lang/rust/pull/753#issuecomment-1669610",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/753",
    "id": 1669610,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2Njk2MTA=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-07-28T02:32:34Z",
    "updated_at": "2011-07-28T02:32:34Z",
    "body": "After further experimentation I don't think the valgrind problems I reported are caused by this patch set.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1669610/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1674857",
    "html_url": "https://github.com/rust-lang/rust/pull/753#issuecomment-1674857",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/753",
    "id": 1674857,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2NzQ4NTc=",
    "user": {
      "login": "eholk",
      "id": 105766,
      "node_id": "MDQ6VXNlcjEwNTc2Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eholk",
      "html_url": "https://github.com/eholk",
      "followers_url": "https://api.github.com/users/eholk/followers",
      "following_url": "https://api.github.com/users/eholk/following{/other_user}",
      "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eholk/subscriptions",
      "organizations_url": "https://api.github.com/users/eholk/orgs",
      "repos_url": "https://api.github.com/users/eholk/repos",
      "events_url": "https://api.github.com/users/eholk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eholk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-07-28T17:56:54Z",
    "updated_at": "2011-07-28T17:56:54Z",
    "body": "Integrated.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1674857/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
