[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68621886",
    "html_url": "https://github.com/rust-lang/rust/issues/20475#issuecomment-68621886",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20475",
    "id": 68621886,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NjIxODg2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-04T05:32:40Z",
    "updated_at": "2015-01-04T05:32:40Z",
    "body": "cc https://github.com/rust-lang/rust/pull/20507, The purpose of `CString` is changing pretty radically in that redesign, but this still sounds relevant to the added `c_str_to_bytes` functions.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68621886/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68661032",
    "html_url": "https://github.com/rust-lang/rust/issues/20475#issuecomment-68661032",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20475",
    "id": 68661032,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NjYxMDMy",
    "user": {
      "login": "chrish42",
      "id": 632858,
      "node_id": "MDQ6VXNlcjYzMjg1OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/632858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chrish42",
      "html_url": "https://github.com/chrish42",
      "followers_url": "https://api.github.com/users/chrish42/followers",
      "following_url": "https://api.github.com/users/chrish42/following{/other_user}",
      "gists_url": "https://api.github.com/users/chrish42/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chrish42/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chrish42/subscriptions",
      "organizations_url": "https://api.github.com/users/chrish42/orgs",
      "repos_url": "https://api.github.com/users/chrish42/repos",
      "events_url": "https://api.github.com/users/chrish42/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chrish42/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-05T02:14:34Z",
    "updated_at": "2015-01-05T02:14:34Z",
    "body": "Actually, I guess what I was really asking was for that use case to be made easier. Ideally, I think something like this would be nice: \n1. a constructor that builds a CString, which contains a [c_char, ..MAX_LEN], initialized to \\0;\n2. a function that can convert this to a *mut c_char, to pass to C code (which may write a C string into this buffer);\n3. once the C function has returned, a function that converts the array into a Rust string, panicking if there is no \\0 within MAX_LEN. (Without needing to repeat said max length.)\n\nAnyways, I think the use case of \"allocate a buffer, pass it to a function, which may write a string into it\" is not that uncommon for C FFI, and it's be nice if it was easy to do (and in a way that's not error-prone).\n\n(Apologies if I'm getting some of the Rust terminology wrong here. I just started learning Rust about a week ago.)\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68661032/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68675281",
    "html_url": "https://github.com/rust-lang/rust/issues/20475#issuecomment-68675281",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20475",
    "id": 68675281,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4Njc1Mjgx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-05T07:17:20Z",
    "updated_at": "2015-01-05T07:17:20Z",
    "body": "Note that one idea I had on https://github.com/rust-lang/rust/pull/20507 was that this use case could be handled with `slice::from_raw_buf` because the length is known so it can be converted to a slice immediately (and then a find for the 0 and slice afterwards).\n\n@chrish42 for your use cases I would expect:\n1. This should in theory be handled with a small vector optimization which can store data inline in the `CString` itself (which now uses `Vec` internally).\n2. You can currently do that today with `let mut buf = [0; LEN]; foo(buf.as_mut_ptr(), buf.len());`, I don't think we need to involve `CString` with that.\n3. I think that this is the use case for this bug, which may be solvable with my idea above.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68675281/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/117241092",
    "html_url": "https://github.com/rust-lang/rust/issues/20475#issuecomment-117241092",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20475",
    "id": 117241092,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNzI0MTA5Mg==",
    "user": {
      "login": "jimrandomh",
      "id": 101191,
      "node_id": "MDQ6VXNlcjEwMTE5MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/101191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimrandomh",
      "html_url": "https://github.com/jimrandomh",
      "followers_url": "https://api.github.com/users/jimrandomh/followers",
      "following_url": "https://api.github.com/users/jimrandomh/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimrandomh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimrandomh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimrandomh/subscriptions",
      "organizations_url": "https://api.github.com/users/jimrandomh/orgs",
      "repos_url": "https://api.github.com/users/jimrandomh/repos",
      "events_url": "https://api.github.com/users/jimrandomh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimrandomh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-30T16:11:41Z",
    "updated_at": "2015-06-30T16:11:41Z",
    "body": "This isn't just for error buffers, and this is very problematic even if the function is guaranteed to set the buffer and terminate it with a null. As part of my first Rust project, I'm trying to call ptsname_r to get a string, and pass the result to open(2). Hours later, I still haven't found a way to do this correctly, even awkwardly. The given example does not compile in current versions of Rust because CString::new doesn't take a second argument, and CString::new panics if there are any nulls in the Vec (including the trailing null). I could write my own strlen, slice the vec, and make a CString that way... but at that point it's clear the language isn't ready for this and my project would need a rewrite later.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/117241092/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/345493381",
    "html_url": "https://github.com/rust-lang/rust/issues/20475#issuecomment-345493381",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20475",
    "id": 345493381,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTQ5MzM4MQ==",
    "user": {
      "login": "dtolnay",
      "id": 1940490,
      "node_id": "MDQ6VXNlcjE5NDA0OTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dtolnay",
      "html_url": "https://github.com/dtolnay",
      "followers_url": "https://api.github.com/users/dtolnay/followers",
      "following_url": "https://api.github.com/users/dtolnay/following{/other_user}",
      "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions",
      "organizations_url": "https://api.github.com/users/dtolnay/orgs",
      "repos_url": "https://api.github.com/users/dtolnay/repos",
      "events_url": "https://api.github.com/users/dtolnay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dtolnay/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-11-19T05:30:00Z",
    "updated_at": "2017-11-19T05:30:00Z",
    "body": "I believe the new *(as of 1.0.0-alpha \ud83d\ude1b)* CString API supports \"within max length\" use cases as follows.\r\n\r\n```rust\r\nuse std::cmp;\r\nuse std::ffi::CString;\r\nuse std::mem;\r\nuse std::ptr;\r\n\r\nunsafe fn c_function(buf: *mut u8, len: usize) {\r\n    let data = b\"hello\\0\";\r\n\r\n    // buf may or may not end with \\0 depending on whether there was room for it\r\n    ptr::copy(data.as_ptr(), buf, cmp::min(len, data.len()));\r\n}\r\n\r\nfn call_the_thing() -> CString {\r\n    unsafe {\r\n        let mut buf = mem::uninitialized::<[u8; 256]>();\r\n        c_function(buf.as_mut_ptr(), buf.len());\r\n        let end = buf.iter().position(|ch| *ch == b'\\0').unwrap_or(buf.len());\r\n        CString::from_vec_unchecked(buf[..end].to_vec())\r\n    }\r\n}\r\n\r\nfn main() {\r\n    println!(\"{:?}\", call_the_thing().as_bytes());\r\n}\r\n```\r\n\r\nI would welcome a PR to support this better.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/345493381/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/354523268",
    "html_url": "https://github.com/rust-lang/rust/issues/20475#issuecomment-354523268",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20475",
    "id": 354523268,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDUyMzI2OA==",
    "user": {
      "login": "dtolnay",
      "id": 1940490,
      "node_id": "MDQ6VXNlcjE5NDA0OTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dtolnay",
      "html_url": "https://github.com/dtolnay",
      "followers_url": "https://api.github.com/users/dtolnay/followers",
      "following_url": "https://api.github.com/users/dtolnay/following{/other_user}",
      "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions",
      "organizations_url": "https://api.github.com/users/dtolnay/orgs",
      "repos_url": "https://api.github.com/users/dtolnay/repos",
      "events_url": "https://api.github.com/users/dtolnay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dtolnay/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-12-30T02:44:16Z",
    "updated_at": "2017-12-30T02:44:16Z",
    "body": "@Diggsey made an excellent crate to support this use case and others involving a fixed size buffer which may or may not contain a null terminator, so I think we are ready to close the issue.\r\n\r\n```rust\r\nlet mut buf = mem::uninitialized::<[c_char; 256]>();\r\nlet ptr = buf.as_ptr();\r\nlet len = buf.len();\r\n\r\n/* ... */\r\n\r\n// copy the fixed length stack buffer which may or may not\r\n// have null terminator into an owned CString\r\nCFixedStr::from_ptr(ptr, len).to_owned().into_c_string()\r\n```",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/354523268/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/354543730",
    "html_url": "https://github.com/rust-lang/rust/issues/20475#issuecomment-354543730",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20475",
    "id": 354543730,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDU0MzczMA==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-12-30T12:29:41Z",
    "updated_at": "2017-12-30T12:29:41Z",
    "body": "The crate is https://crates.io/crates/c_fixed_string\r\n\r\nBit early to say it's excellent just yet but thanks \ud83d\ude1b ",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/354543730/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/354552631",
    "html_url": "https://github.com/rust-lang/rust/issues/20475#issuecomment-354552631",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20475",
    "id": 354552631,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDU1MjYzMQ==",
    "user": {
      "login": "dtolnay",
      "id": 1940490,
      "node_id": "MDQ6VXNlcjE5NDA0OTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dtolnay",
      "html_url": "https://github.com/dtolnay",
      "followers_url": "https://api.github.com/users/dtolnay/followers",
      "following_url": "https://api.github.com/users/dtolnay/following{/other_user}",
      "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions",
      "organizations_url": "https://api.github.com/users/dtolnay/orgs",
      "repos_url": "https://api.github.com/users/dtolnay/repos",
      "events_url": "https://api.github.com/users/dtolnay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dtolnay/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-12-30T15:44:30Z",
    "updated_at": "2017-12-30T15:44:30Z",
    "body": "\ud83d\ude06 I promise I meant to link to the crate.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/354552631/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/354553110",
    "html_url": "https://github.com/rust-lang/rust/issues/20475#issuecomment-354553110",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20475",
    "id": 354553110,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDU1MzExMA==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-12-30T15:54:02Z",
    "updated_at": "2017-12-30T15:54:02Z",
    "body": "Also, it would be better to write `CFixedStr::from_ptr(ptr, len).to_c_str()` as that will avoid copying data past the first null byte and will not perform an allocation unless required.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/354553110/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
