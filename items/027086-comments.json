[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122349891",
    "html_url": "https://github.com/rust-lang/rust/issues/27086#issuecomment-122349891",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27086",
    "id": 122349891,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjM0OTg5MQ==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-17T17:34:22Z",
    "updated_at": "2015-07-17T17:34:33Z",
    "body": "Isn't this only important from a function-local perspective? Because of the lack of HKT, extra-function closures are present only when they are substituted into other types - and in that case, the exact value of the substitutions doesn't matter (in fact, AFAIK closure signatures can even contain `ReScope`-s from their containing function).\n\nActually, that's not exactly correct - as you said, closures can essentially use `InvariantType` for some of their type parameters - they can reference a type parameter but not be affected by its OIBIT. If the set of OIBIT is fixed, this can be done by the equivalent of\n\n``` Rust\nuse std::marker::PhantomData;\npub struct InvariantType<T>(PhantomData<*mut T>);\nimpl<T> Copy for InvariantType<T> {}\nimpl<T> Clone for InvariantType<T> { fn clone(&self) -> Self { *self } }\nunsafe impl<T> Send for InvariantType<T> {}\nunsafe impl<T> Sync for InvariantType<T> {}\n```\n\nIt may be wise to introduce `InvariantType<T>`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122349891/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122369398",
    "html_url": "https://github.com/rust-lang/rust/issues/27086#issuecomment-122369398",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27086",
    "id": 122369398,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjM2OTM5OA==",
    "user": {
      "login": "eefriedman",
      "id": 12769964,
      "node_id": "MDQ6VXNlcjEyNzY5OTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/12769964?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eefriedman",
      "html_url": "https://github.com/eefriedman",
      "followers_url": "https://api.github.com/users/eefriedman/followers",
      "following_url": "https://api.github.com/users/eefriedman/following{/other_user}",
      "gists_url": "https://api.github.com/users/eefriedman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eefriedman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eefriedman/subscriptions",
      "organizations_url": "https://api.github.com/users/eefriedman/orgs",
      "repos_url": "https://api.github.com/users/eefriedman/repos",
      "events_url": "https://api.github.com/users/eefriedman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eefriedman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-17T18:38:00Z",
    "updated_at": "2015-07-17T18:38:00Z",
    "body": "I can't remember who pointed this out, but it's currently possible to use PhantomData with a function pointer type:\n\n``` rust\nuse std::marker::PhantomData;\npub struct Invariant<T>(PhantomData<fn(&T)>);\nfn send<T:Send>(_:T) {}\nfn foo<T:Default>() {\n    send(Invariant::<T>(PhantomData));\n}\nfn main() {\n    foo::<i32>();\n}\n```\n\nrustc correctly figures out that Invariant<T> is Send.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122369398/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122406581",
    "html_url": "https://github.com/rust-lang/rust/issues/27086#issuecomment-122406581",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27086",
    "id": 122406581,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjQwNjU4MQ==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-17T20:39:21Z",
    "updated_at": "2015-07-19T17:31:51Z",
    "body": "@eefriedman\n\nThat's contravariant. `PhantomData<fn(*mut T)>` would be invariant.\n\nThat's just a nit, anyway.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122406581/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122690801",
    "html_url": "https://github.com/rust-lang/rust/issues/27086#issuecomment-122690801",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27086",
    "id": 122690801,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjY5MDgwMQ==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-19T18:24:20Z",
    "updated_at": "2015-07-19T18:31:51Z",
    "body": "You can in fact semantic-equivalently desugar closures using fn-items (with ABI differences, mostly involving fn-items not being zero-sized):\n\n``` Rust\nstruct MutClosure<B, E> {\n    body: B,\n    environment: E\n}\nimpl<B, E, P> FnOnce<P> for MutClosure<B,E> where B: Fn<(&mut E, P)> {\n    type Output = B::Output;\n    extern \"rust-call\" fn call_once(self, args: P) -> B::Output {\n        self.body.call((&mut self.environment, args))\n    }\n}\nimpl<B, E, P> FnMut<P> for MutClosure<B,E> where B: Fn<(&mut E, P)> {\n    extern \"rust-call\" fn call_mut(&mut self, args: P) -> B::Output {\n        self.body.call((&mut self.environment, args))\n    }\n}\nfn foo<T: Default>() {\n    let foo = ...;\n    let bar = ...;\n    hof(|arg1, arg2| { /* closure body */ })\n}\nfn foo_desugared<T: Default>() {\n    let foo = ...;\n    let bar = ...;\n    // it really doesn't matter if you pass extra early lifetimes in - they are substituted\n    // early anyway.\n    fn closure<'\u03c0, T: Default>((foo, bar): (&'\u03c0 mut _, &'\u03c0 mut _), (arg1, arg2): (_, _)) -> _ {\n        // closure body\n    }\n    hof(MutClosure { body: closure::<T>, environment: (&mut foo, &mut bar) })\n    //^ note we are creating a MutClosure<fn(...) {closure}, (_, _)>\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122690801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122692757",
    "html_url": "https://github.com/rust-lang/rust/issues/27086#issuecomment-122692757",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27086",
    "id": 122692757,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjY5Mjc1Nw==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-19T18:33:13Z",
    "updated_at": "2015-07-19T18:33:13Z",
    "body": "In other words, closures basically get their type-lifetime-erasing power from fn-items.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122692757/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/263731270",
    "html_url": "https://github.com/rust-lang/rust/issues/27086#issuecomment-263731270",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27086",
    "id": 263731270,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MzczMTI3MA==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-11-29T23:14:55Z",
    "updated_at": "2016-11-29T23:15:01Z",
    "body": "Triage: looks like a discussion that didn't really go anywhere. Not sure what to do.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/263731270/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/274612060",
    "html_url": "https://github.com/rust-lang/rust/issues/27086#issuecomment-274612060",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27086",
    "id": 274612060,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NDYxMjA2MA==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-01-23T20:48:09Z",
    "updated_at": "2017-01-23T20:48:09Z",
    "body": "Now fn items are always zero-sized, so closures can always be converted to the `XxxClosure<[\"rust-call\"\u00a0fn\u00a0item],\u00a0env>` form.\r\n\r\nThe fn item \"truncation\" issue is still present. It's more of a formalization issue than a compiler issue, through, so I'm closing this.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/274612060/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
