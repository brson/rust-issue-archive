{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/4610",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/4610/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/4610/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/4610/events",
  "html_url": "https://github.com/rust-lang/rust/pull/4610",
  "id": 10264748,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MzgxNjE3OA==",
  "number": 4610,
  "title": "Rustpkg",
  "user": {
    "login": "z0w0",
    "id": 676417,
    "node_id": "MDQ6VXNlcjY3NjQxNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/676417?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/z0w0",
    "html_url": "https://github.com/z0w0",
    "followers_url": "https://api.github.com/users/z0w0/followers",
    "following_url": "https://api.github.com/users/z0w0/following{/other_user}",
    "gists_url": "https://api.github.com/users/z0w0/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/z0w0/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/z0w0/subscriptions",
    "organizations_url": "https://api.github.com/users/z0w0/orgs",
    "repos_url": "https://api.github.com/users/z0w0/repos",
    "events_url": "https://api.github.com/users/z0w0/events{/privacy}",
    "received_events_url": "https://api.github.com/users/z0w0/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 35,
  "created_at": "2013-01-24T08:22:50Z",
  "updated_at": "2014-06-14T03:05:57Z",
  "closed_at": "2013-02-05T02:05:59Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/4610",
    "html_url": "https://github.com/rust-lang/rust/pull/4610",
    "diff_url": "https://github.com/rust-lang/rust/pull/4610.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/4610.patch",
    "merged_at": null
  },
  "body": "Rustpkg is a revamp of Cargo for the Rust suite that I've been working on for the past week. It's a purely functional package manager that has no central sources of any kind,\nbut rather installs via URLs. It's similar to how Go's `go get` tool works, except\nrustpkg requires a central metadata file (`package.rs`) in the repository, archive or folder\nin order to figure out how to build the package. This is a side effect of rustpkg\nallowing multiple crates to be defined in a single package (i.e. a package is defined\nas a set of crates rather than a package being exactly the same as one crate).\n\nThe metadata is written in Rust. This is both good and bad. One con is that\nRust's syntax is going to be moderately unstable until v1.0 (as I was told),\nso compiling an old package might spring up weird compiling errors. On the other hand,\nyou get to write the build process in Rust itself which is so incredibly meta and fun\nand you get to use an awesome language to build projects in that same awesome language.\n\nRustpkg also doubles as a powerful build system that gives you two ways to\ndescribe the build process of projects: declarative and imperative. The declarative\nsyntax allows you to declare the build process using Rust's attribute syntax.\nA simplistic declarative package script (`package.rs`) would be something\nlike the following (Servo doesn't actually use rustpkg, it's just an example):\n\n``` rust\n#[pkg(id = \"org.mozilla.servo\",\n      vers = \"0.5.6\")];\n\n#[pkg_crate(file = \"src/servo.rc\")];\n#[pkg_crate(file = \"src/servo-gfx.rc\")];\n```\n\nThe imperative API is for when you need a more powerful build process, such\nas probing the system for important configuration, running shell scripts (or\neven autotools, which is a planned builtin feature that I want to add). A simple\nexample using the imperative API is as follows (rustpkg is automatically included):\n\n``` rust\n#[pkg(id = \"org.mozilla.servo\",\n      vers = \"0.5.6\")];\n\n#[pkg_do(build)]\nfn build() {\n   let platform = if os::is_toaster() { ~\"platform=toaster\" } else { ~\"platform=alien\" };\n   let crate = rustpkg::Crate(~\"src/servo.rc\").cfg(platform).flag(~\"-g\");\n\n   rustpkg::build(~[crate]);\n}\n```\n\nWhen a package's crates are installed, they are stored under a unique name (Rust's library crates work like this out of the box) in `~/.rustpkg/bin` or `~/.rustpkg/lib`. This allows packages to coexist in a purely functional manner. However, if you want to easily\nuse a binary crate that has been installed from the `~/.rustpkg/bin` path (after\nadding it to your `$PATH`) then rustpkg provides \"preferring\" functionality\nto symlink a generic name for the crate into the binary directory (which\nvoids the purely functional label, which is why it's explicitly optional). For example, if you had a crate with the name `servo` and it's uniquely installed to `~/.rustpkg/bin/servo-<hash>-0.5.6` then `rustpkg prefer servo` would link it to `~/.rustpkg/bin/servo` which you can then easily run as just `servo` if the binary directory is in your `$PATH`.\n\nThere's also `rustpkg do <cmd>` which allows you to create scripts callable by the user in the package script:\n\n``` rust\n// ...\n\n#[pkg_do(configure)]\nfn configure() {\n    io::println(~\"let us configure things\");\n}\n```\n\n```\n$ rustpkg do configure\nlet us configure things\n```\n\nThere's more detailed per-command info in `rustpkg --help`.\n\nPreferring is currently pretty rusty, along with some of the other features. But that's to\nbe expected due to this being the initial implementation and I plan to perfect it\nover time (including documentation). This pull request also adds `std::semver`, which is originally made by @erickt but I've ported it to the latest syntax and added it into std with his permission.\n\nI still really want to add the following but they're not important for the initial pull request:\n- Improvements to the user interface based on feedback\n- More features of the imperative API\n- Use the JIT compiler for package scripts (JIT segfaults for me at the moment)\n- Use `std::workcache` for only compiling things that have changed\n- Add wrappers around autotools that also use workcache\n",
  "closed_by": {
    "login": "graydon",
    "id": 14097,
    "node_id": "MDQ6VXNlcjE0MDk3",
    "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/graydon",
    "html_url": "https://github.com/graydon",
    "followers_url": "https://api.github.com/users/graydon/followers",
    "following_url": "https://api.github.com/users/graydon/following{/other_user}",
    "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
    "organizations_url": "https://api.github.com/users/graydon/orgs",
    "repos_url": "https://api.github.com/users/graydon/repos",
    "events_url": "https://api.github.com/users/graydon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/graydon/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/4610/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/4610/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
