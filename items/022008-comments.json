[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73287428",
    "html_url": "https://github.com/rust-lang/rust/issues/22008#issuecomment-73287428",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22008",
    "id": 73287428,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMjg3NDI4",
    "user": {
      "login": "renato-zannon",
      "id": 486508,
      "node_id": "MDQ6VXNlcjQ4NjUwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/486508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/renato-zannon",
      "html_url": "https://github.com/renato-zannon",
      "followers_url": "https://api.github.com/users/renato-zannon/followers",
      "following_url": "https://api.github.com/users/renato-zannon/following{/other_user}",
      "gists_url": "https://api.github.com/users/renato-zannon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/renato-zannon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/renato-zannon/subscriptions",
      "organizations_url": "https://api.github.com/users/renato-zannon/orgs",
      "repos_url": "https://api.github.com/users/renato-zannon/repos",
      "events_url": "https://api.github.com/users/renato-zannon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/renato-zannon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-06T18:28:02Z",
    "updated_at": "2015-02-06T18:37:33Z",
    "body": "Reduced test case:\n\n``` rust\nfn main() {\n    let command = \"a\";\n\n    match command {\n        \"foo\" => println!(\"foo\"),\n        _     => println!(\"{}\", command),\n    }\n}\n```\n\nThis segfaults with `opt-level` >= 2 (on Linux x86-64, `rustc 1.0.0-dev (f3573aa83 2015-02-06 05:52:20 +0000)`)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73287428/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73299499",
    "html_url": "https://github.com/rust-lang/rust/issues/22008#issuecomment-73299499",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22008",
    "id": 73299499,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMjk5NDk5",
    "user": {
      "login": "renato-zannon",
      "id": 486508,
      "node_id": "MDQ6VXNlcjQ4NjUwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/486508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/renato-zannon",
      "html_url": "https://github.com/renato-zannon",
      "followers_url": "https://api.github.com/users/renato-zannon/followers",
      "following_url": "https://api.github.com/users/renato-zannon/following{/other_user}",
      "gists_url": "https://api.github.com/users/renato-zannon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/renato-zannon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/renato-zannon/subscriptions",
      "organizations_url": "https://api.github.com/users/renato-zannon/orgs",
      "repos_url": "https://api.github.com/users/renato-zannon/repos",
      "events_url": "https://api.github.com/users/renato-zannon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/renato-zannon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-06T19:40:50Z",
    "updated_at": "2015-02-06T19:45:17Z",
    "body": "This goes back to at least 0.12 - though it prints garbage values instead of segfaulting. 0.11 seems unaffected.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73299499/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73381312",
    "html_url": "https://github.com/rust-lang/rust/issues/22008#issuecomment-73381312",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22008",
    "id": 73381312,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzgxMzEy",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-07T20:24:20Z",
    "updated_at": "2015-02-07T20:54:17Z",
    "body": "I've done some hacky [introspection](https://play.rust-lang.org/?code=%23%5Binline%28never%29%5D%0Afn%20format%28args%3A%20std%3A%3Afmt%3A%3AArguments%29%20%7B%0A%20%20%20%20let%20args%20%3D%20unsafe%20%7B%0A%20%20%20%20%20%20%20%20std%3A%3Amem%3A%3Atransmute%3A%3A%3C_%2C%20%28%26%5Bu8%5D%2C%20Option%3C%26%5Bu8%5D%3E%2C%20%26%5B%28%26%26%5Bu8%5D%2C%20fn%28%29%29%5D%29%3E%28args%29%0A%20%20%20%20%7D%3B%0A%20%20%20%20let%20arg%20%3D%20args.2%5B0%5D%3B%0A%20%20%20%20let%20len%20%3D%20arg.0.len%28%29%20as%20*const%20%5Bu8%3B%2032%5D%3B%0A%20%20%20%20let%20data%20%3D%20arg.0.as_ptr%28%29%20as%20*const%20%5Bu8%3B%2032%5D%3B%0A%20%20%20%20println%21%28%22data%3D%7B%3Ap%7D%20%7B%3A%3F%7D%22%2C%20data%2C%20unsafe%20%7B*data%7D%29%3B%0A%20%20%20%20println%21%28%22%20len%3D%7B%3Ap%7D%20%7B%3A%3F%7D%22%2C%20len%2C%20unsafe%20%7B*len%7D%29%3B%0A%7D%0A%0Afn%20main%28%29%20%7B%0A%20%20%20%20let%20command%20%3D%20b%22a%22%3B%0A%0A%20%20%20%20match%20command%20%7B%0A%20%20%20%20%20%20%20%20b%22%22%20%3D%3E%20%7B%7D%0A%20%20%20%20%20%20%20%20_%20%3D%3E%20format%28format_args%21%28%22%7B%3A%3F%7D%22%2C%20command%29%29%0A%20%20%20%20%7D%0A%7D).\nI'm not seeing the original data in the IR.\ncc @dotdash Is this another memcpy metadata bug? Or a lifetime intrinsic issue.\n\n**EDIT**: turns out `str::eq_slice`, which is used here, calls `llvm.lifetime.end` on its arguments, as if it was certain they were temporaries that didn't outlive the call (which is wrong, in this case).\nNot sure if `trans::_match` needs to create a temporary for the value it's trying to compare with a constant, or the lifetime intrinsic calls shouldn't be emitted for `str::eq_slice`.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73381312/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73383227",
    "html_url": "https://github.com/rust-lang/rust/issues/22008#issuecomment-73383227",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22008",
    "id": 73383227,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzgzMjI3",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-07T21:09:03Z",
    "updated_at": "2015-02-07T21:09:03Z",
    "body": "This has two parts. When I extended rustc to emit lifetime intrinsics, I chose to put a call to lifetime.end at the end of functions to mark arguments as dead that are passed by value on the stack. This allows LLVM to remove dead stores at the end of functions that it normally can't remove. This works because normally, the caller makes a copy of the value it passes in.\n\nNow, the call that match generates to compare the strings is to `eq_slice`, which accepts two slices by-value, and slices are large enough to be passed on the stack. Thus, calls to lifetime.end are emitted. But, the call the match generates does _not_ actually make copies of the slices, but passes in pointers to the original slices. That means that the lifetime.end call marks the original alloca as dead, and then things fall apart.\n\nQuestion: Do we want to drop the lifetime.end call for by-value on-stack arguments, or fix the call to eq_slice to make copies?\n\ncc @nikomatsakis @brson \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73383227/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74155695",
    "html_url": "https://github.com/rust-lang/rust/issues/22008#issuecomment-74155695",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22008",
    "id": 74155695,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTU1Njk1",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-12T21:24:32Z",
    "updated_at": "2015-02-12T21:24:32Z",
    "body": "just-a-bug; P-high, not 1.0 milestone.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74155695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
