{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/8631",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/8631/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/8631/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/8631/events",
  "html_url": "https://github.com/rust-lang/rust/pull/8631",
  "id": 18271778,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NzcxMzgyMA==",
  "number": 8631,
  "title": "Thread Safe IO",
  "user": {
    "login": "anasazi",
    "id": 591682,
    "node_id": "MDQ6VXNlcjU5MTY4Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/591682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/anasazi",
    "html_url": "https://github.com/anasazi",
    "followers_url": "https://api.github.com/users/anasazi/followers",
    "following_url": "https://api.github.com/users/anasazi/following{/other_user}",
    "gists_url": "https://api.github.com/users/anasazi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/anasazi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/anasazi/subscriptions",
    "organizations_url": "https://api.github.com/users/anasazi/orgs",
    "repos_url": "https://api.github.com/users/anasazi/repos",
    "events_url": "https://api.github.com/users/anasazi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/anasazi/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 4,
  "created_at": "2013-08-20T00:29:05Z",
  "updated_at": "2014-06-19T21:49:58Z",
  "closed_at": "2013-08-21T01:41:56Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/8631",
    "html_url": "https://github.com/rust-lang/rust/pull/8631",
    "diff_url": "https://github.com/rust-lang/rust/pull/8631.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/8631.patch",
    "merged_at": null
  },
  "body": "libuv handles are tied to the event loop that created them. In order to perform IO, the handle must be on the thread with its home event loop. Thus, when as task wants to do IO it must first go to the IO handle's home event loop and pin itself to the corresponding scheduler while the IO action is in flight. Once the IO action completes, the task is unpinned and either returns to its home scheduler if it is a pinned task, or otherwise stays on the current scheduler.\n\nMaking new blocking IO implementations (i.e. files) thread safe is rather simple. Add a home field to the IO handle's struct in uvio and implement the HomingIO trait. Wrap every IO call in the HomingIO.home_for_io method, which will take care of the scheduling.\n\nI'm not sure if this remains thread safe in the presence of asynchronous IO at the libuv level. If we decide to do that, then this set up should be revisited.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/8631/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/8631/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
