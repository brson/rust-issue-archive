{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/30587",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/30587/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/30587/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/30587/events",
  "html_url": "https://github.com/rust-lang/rust/pull/30587",
  "id": 124067260,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NTQ2NTUwOTQ=",
  "number": 30587,
  "title": "typestrong const integers",
  "user": {
    "login": "oli-obk",
    "id": 332036,
    "node_id": "MDQ6VXNlcjMzMjAzNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/oli-obk",
    "html_url": "https://github.com/oli-obk",
    "followers_url": "https://api.github.com/users/oli-obk/followers",
    "following_url": "https://api.github.com/users/oli-obk/following{/other_user}",
    "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions",
    "organizations_url": "https://api.github.com/users/oli-obk/orgs",
    "repos_url": "https://api.github.com/users/oli-obk/repos",
    "events_url": "https://api.github.com/users/oli-obk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/oli-obk/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "nikomatsakis",
    "id": 155238,
    "node_id": "MDQ6VXNlcjE1NTIzOA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nikomatsakis",
    "html_url": "https://github.com/nikomatsakis",
    "followers_url": "https://api.github.com/users/nikomatsakis/followers",
    "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
    "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
    "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
    "repos_url": "https://api.github.com/users/nikomatsakis/repos",
    "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 70,
  "created_at": "2015-12-28T13:27:59Z",
  "updated_at": "2016-03-14T21:47:31Z",
  "closed_at": "2016-03-14T21:44:53Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/30587",
    "html_url": "https://github.com/rust-lang/rust/pull/30587",
    "diff_url": "https://github.com/rust-lang/rust/pull/30587.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/30587.patch",
    "merged_at": "2016-03-14T21:44:53Z"
  },
  "body": "~~It would be great if someone could run crater on this PR, as this has a high danger of breaking valid code~~ Crater ran. Good to go.\n\n---\n\nSo this PR does a few things:\n1. ~~const eval array values when const evaluating an array expression~~\n2. ~~const eval repeat value when const evaluating a repeat expression~~\n3. ~~const eval all struct and tuple fields when evaluating a struct/tuple expression~~\n4. remove the `ConstVal::Int` and `ConstVal::Uint` variants and replace them with a single enum (`ConstInt`) which has variants for all integral types\n   - `usize`/`isize` are also enums with variants for 32 and 64 bit. At creation and various usage steps there are assertions in place checking if the target bitwidth matches with the chosen enum variant\n5. enum discriminants (`ty::Disr`) are now `ConstInt`\n6. trans has its own `Disr` type now (newtype around `u64`)\n\nThis obviously can't be done without breaking changes (the ones that are noticable in stable)\nWe could probably write lints that find those situations and error on it for a cycle or two. But then again, those situations are rare and really bugs imo anyway:\n\n``` rust\nlet v10 = 10 as i8;\nlet v4 = 4 as isize;\nassert_eq!(v10 << v4 as usize, 160 as i8);\n```\n\nstops compiling because 160 is not a valid i8\n\n``` rust\nstruct S<T, S> {\n    a: T,\n    b: u8,\n    c: S\n}\nlet s = S { a: 0xff_ff_ff_ffu32, b: 1, c: 0xaa_aa_aa_aa as i32 };\n```\n\nstops compiling because `0xaa_aa_aa_aa` is not a valid i32\n\n---\n\ncc @eddyb @pnkfelix \n\nrelated: https://github.com/rust-lang/rfcs/issues/1071\n#13768\n#23833\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/30587/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/30587/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
