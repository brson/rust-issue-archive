[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7925533",
    "html_url": "https://github.com/rust-lang/rust/issues/3248#issuecomment-7925533",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3248",
    "id": 7925533,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MjU1MzM=",
    "user": {
      "login": "nejucomo",
      "id": 480497,
      "node_id": "MDQ6VXNlcjQ4MDQ5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/480497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nejucomo",
      "html_url": "https://github.com/nejucomo",
      "followers_url": "https://api.github.com/users/nejucomo/followers",
      "following_url": "https://api.github.com/users/nejucomo/following{/other_user}",
      "gists_url": "https://api.github.com/users/nejucomo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nejucomo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nejucomo/subscriptions",
      "organizations_url": "https://api.github.com/users/nejucomo/orgs",
      "repos_url": "https://api.github.com/users/nejucomo/repos",
      "events_url": "https://api.github.com/users/nejucomo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nejucomo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-22T06:11:00Z",
    "updated_at": "2012-08-22T06:11:00Z",
    "body": "Here's a simpler macro expansion test that _does_ succeed in passing the test whether or not we do the manual expansion.  It would be consistent with the above results if macros are truly hygienic.\n\nThe original input:\n\n```\n$ cat ./simple_expansion_test.rs\nuse std;\n\nmacro_rules! unwrap_something (\n  ($some_expr:expr, $default:expr) => (\n    match $some_expr {\n      some(x) => x,\n      none => $default\n    }\n  )\n)\n\nfn unwrap_42() -> int { unwrap_something!(some(42), -1) }\n\n#[test]\nfn test_unwrap_42() {\n  assert (unwrap_42() == 42);\n}\n```\n\nCompiling and running the test:\n\n```\n$ rustc --test ./simple_expansion_test.rs\n\n$ ./simple_expansion_test\n\nrunning 1 test\ntest test_unwrap_42 ... ok\n\nresult: ok. 1 passed; 0 failed; 0 ignored\n```\n\nCreating the expanded (then doctored to include the test function) version:\n\n```\n$ rustc --pretty expanded ./simple_expansion_test.rs > ./simple_expansion_test_expanded.rs\n\n$ cat >> ./simple_expansion_test_expanded.rs\n#[test]\nfn test_unwrap_42() {\n  assert (unwrap_42() == 42);\n}\n```\n\nThe expanded version:\n\n```\n$ cat ./simple_expansion_test_expanded.rs\nuse std;\n\n\nfn unwrap_42() -> int { match some(42) { some(x) => x, none => -1 } }\n\n#[test]\nfn test_unwrap_42() {\n  assert (unwrap_42() == 42);\n}\n```\n\nCompiling and testing:\n\n```\n$ rustc --test ./simple_expansion_test_expanded.rs\n\n$ ./simple_expansion_test_expanded\n\nrunning 1 test\ntest test_unwrap_42 ... ok\n\nresult: ok. 1 passed; 0 failed; 0 ignored\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7925533/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7925839",
    "html_url": "https://github.com/rust-lang/rust/issues/3248#issuecomment-7925839",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3248",
    "id": 7925839,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MjU4Mzk=",
    "user": {
      "login": "nejucomo",
      "id": 480497,
      "node_id": "MDQ6VXNlcjQ4MDQ5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/480497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nejucomo",
      "html_url": "https://github.com/nejucomo",
      "followers_url": "https://api.github.com/users/nejucomo/followers",
      "following_url": "https://api.github.com/users/nejucomo/following{/other_user}",
      "gists_url": "https://api.github.com/users/nejucomo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nejucomo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nejucomo/subscriptions",
      "organizations_url": "https://api.github.com/users/nejucomo/orgs",
      "repos_url": "https://api.github.com/users/nejucomo/repos",
      "events_url": "https://api.github.com/users/nejucomo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nejucomo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-22T06:36:10Z",
    "updated_at": "2012-08-22T06:36:10Z",
    "body": "Ok, here's a test which I believe shows that macros are not hygienic, or that assignment/mutation-analysis rules otherwise get confused by colliding reference names in macro bodies:\n\nFirst we define a macro whose body defines \"x\" and then mutates x as well as a macro parameter $i, then we call it twice, once with $i as \"x\" and once as \"y\":\n\n```\n$ cat ./hygienic_macro_test.rs\nuse std;\n\nmacro_rules! refer_to_x (\n  ( $i:ident ) => (\n    if true {\n      let mut x = 2;\n      x = x - 1;\n      $i = $i - x;\n    }\n  )\n)\n\nfn foo() -> (int, int) {\n  let mut x = 10;\n  let mut y = 20;\n\n  refer_to_x!(x);\n  refer_to_x!(y);\n\n  return (x, y);\n}\n\n\n#[test]\nfn test_foo() {\n  assert foo() == (9, 19);\n}\n```\n\nThis leads to a compiler error, complaining that the macro-body variable \"x\" is never read in the case where we pass the identifier \"x\" as $i:\n\n```\n$ rustc --test ./hygienic_macro_test.rs\n./hygienic_macro_test.rs:8:7: 8:8 warning: value assigned to `x` is never read\n./hygienic_macro_test.rs:8       $i = $i - x;\n                                  ^\n./hygienic_macro_test.rs:3:0: 11:1 note: in expansion of #refer_to_x\n./hygienic_macro_test.rs:17:2: 17:17 note: expansion site\n```\n\nNow if we comment out the call to the macro which passes the identifier \"x\" and leave the call that passes the identifier \"y\", there is no compilation error:\n\n```\n$ sed 's/refer_to_x..x.;/\\/\\/ \\0/' ./hygienic_macro_test.rs | tee ./hygienic_macro_test2.rs\nuse std;\n\nmacro_rules! refer_to_x (\n  ( $i:ident ) => (\n    if true {\n      let mut x = 2;\n      x = x - 1;\n      $i = $i - x;\n    }\n  )\n)\n\nfn foo() -> (int, int) {\n  let mut x = 10;\n  let mut y = 20;\n\n  // refer_to_x!(x);\n  refer_to_x!(y);\n\n  return (x, y);\n}\n\n\n#[test]\nfn test_foo() {\n  assert foo() == (9, 19);\n}\n```\n\nNo error:\n\n```\n$ rustc --test ./hygienic_macro_test2.rs\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7925839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7925875",
    "html_url": "https://github.com/rust-lang/rust/issues/3248#issuecomment-7925875",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3248",
    "id": 7925875,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MjU4NzU=",
    "user": {
      "login": "nejucomo",
      "id": 480497,
      "node_id": "MDQ6VXNlcjQ4MDQ5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/480497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nejucomo",
      "html_url": "https://github.com/nejucomo",
      "followers_url": "https://api.github.com/users/nejucomo/followers",
      "following_url": "https://api.github.com/users/nejucomo/following{/other_user}",
      "gists_url": "https://api.github.com/users/nejucomo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nejucomo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nejucomo/subscriptions",
      "organizations_url": "https://api.github.com/users/nejucomo/orgs",
      "repos_url": "https://api.github.com/users/nejucomo/repos",
      "events_url": "https://api.github.com/users/nejucomo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nejucomo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-22T06:38:31Z",
    "updated_at": "2012-08-22T06:38:31Z",
    "body": "Because the last test demonstrates macros are not hygienic, and the first case shows that _if_ macros are not hygienic, then there is some bug where direct compilation or --pretty expanded then compilation produce different results.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7925875/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/19426292",
    "html_url": "https://github.com/rust-lang/rust/issues/3248#issuecomment-19426292",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3248",
    "id": 19426292,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NDI2Mjky",
    "user": {
      "login": "msullivan",
      "id": 340349,
      "node_id": "MDQ6VXNlcjM0MDM0OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/msullivan",
      "html_url": "https://github.com/msullivan",
      "followers_url": "https://api.github.com/users/msullivan/followers",
      "following_url": "https://api.github.com/users/msullivan/following{/other_user}",
      "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions",
      "organizations_url": "https://api.github.com/users/msullivan/orgs",
      "repos_url": "https://api.github.com/users/msullivan/repos",
      "events_url": "https://api.github.com/users/msullivan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/msullivan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-06-13T21:28:19Z",
    "updated_at": "2013-06-13T21:28:19Z",
    "body": "Macros aren't hygienic yet. jclements is working on this, I believe. I want to close this as a dupe of the bug for implementing hygiene, but there does seem to be one....\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/19426292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21739547",
    "html_url": "https://github.com/rust-lang/rust/issues/3248#issuecomment-21739547",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3248",
    "id": 21739547,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNzM5NTQ3",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-29T18:13:36Z",
    "updated_at": "2013-07-29T18:13:36Z",
    "body": "Visiting for bug triage; carry on.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21739547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25392557",
    "html_url": "https://github.com/rust-lang/rust/issues/3248#issuecomment-25392557",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3248",
    "id": 25392557,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1MzkyNTU3",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-30T18:54:40Z",
    "updated_at": "2013-09-30T18:54:40Z",
    "body": "This should be fixed now that hygiene has landed. Reopen if you have a test case that demonstrates there's still an issue!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/25392557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
