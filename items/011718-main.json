{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/11718",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/11718/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/11718/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/11718/events",
  "html_url": "https://github.com/rust-lang/rust/pull/11718",
  "id": 26068296,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTE3NDQ4NTA=",
  "number": 11718,
  "title": "Make some borrow checker errors more user friendly",
  "user": {
    "login": "ktt3ja",
    "id": 1735399,
    "node_id": "MDQ6VXNlcjE3MzUzOTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1735399?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ktt3ja",
    "html_url": "https://github.com/ktt3ja",
    "followers_url": "https://api.github.com/users/ktt3ja/followers",
    "following_url": "https://api.github.com/users/ktt3ja/following{/other_user}",
    "gists_url": "https://api.github.com/users/ktt3ja/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ktt3ja/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ktt3ja/subscriptions",
    "organizations_url": "https://api.github.com/users/ktt3ja/orgs",
    "repos_url": "https://api.github.com/users/ktt3ja/repos",
    "events_url": "https://api.github.com/users/ktt3ja/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ktt3ja/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 3,
  "created_at": "2014-01-22T05:48:17Z",
  "updated_at": "2014-06-13T12:40:07Z",
  "closed_at": "2014-01-24T08:01:34Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/11718",
    "html_url": "https://github.com/rust-lang/rust/pull/11718",
    "diff_url": "https://github.com/rust-lang/rust/pull/11718.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/11718.patch",
    "merged_at": "2014-01-24T08:01:34Z"
  },
  "body": "A mutable and immutable borrow place some restrictions on what you can\nwith the variable until the borrow ends. This commit attempts to convey\nto the user what those restrictions are. Also, if the original borrow is\na mutable borrow, the error message has been changed (more specifically,\ni. \"cannot borrow `x` as immutable because it is also borrowed as\nmutable\" and ii. \"cannot borrow `x` as mutable more than once\" have\nbeen changed to \"cannot borrow `x` because it is already borrowed as\nmutable\").\n\nIn addition, this adds a (custom) span note to communicate where the\noriginal borrow ends.\n\n``` rust\nfn main() {\n    match true {\n        true => {\n            let mut x = 1;\n            let y = &x;\n            let z = &mut x;\n        }\n        false => ()\n    }\n}\n\ntest.rs:6:21: 6:27 error: cannot borrow `x` as mutable because it is already borrowed as immutable\ntest.rs:6             let z = &mut x;\n                              ^~~~~~\ntest.rs:5:21: 5:23 note: previous borrow of `x` occurs here; the immutable borrow prevents subsequent moves or mutable borrows of `x` until the borrow ends\ntest.rs:5             let y = &x;\n                              ^~\ntest.rs:7:10: 7:10 note: previous borrow ends here\ntest.rs:3         true => {\ntest.rs:4             let mut x = 1;\ntest.rs:5             let y = &x;\ntest.rs:6             let z = &mut x;\ntest.rs:7         }\n                  ^\n```\n\n``` rust\nfn foo3(t0: &mut &mut int) {\n    let t1 = &mut *t0;\n    let p: &int = &**t0;\n}\n\nfn main() {}\n\ntest.rs:3:19: 3:24 error: cannot borrow `**t0` because it is already borrowed as mutable\ntest.rs:3     let p: &int = &**t0;\n                            ^~~~~\ntest.rs:2:14: 2:22 note: previous borrow of `**t0` as mutable occurs here; the mutable borrow prevents subsequent moves, borrows, or modification of `**t0` until the borrow ends\ntest.rs:2     let t1 = &mut *t0;\n                       ^~~~~~~~\ntest.rs:4:2: 4:2 note: previous borrow ends here\ntest.rs:1 fn foo3(t0: &mut &mut int) {\ntest.rs:2     let t1 = &mut *t0;\ntest.rs:3     let p: &int = &**t0;\ntest.rs:4 }\n          ^\n```\n\nFor the \"previous borrow ends here\" note, if the span is too long (has too many lines), then only the first and last lines are printed, and the middle is replaced with dot dot dot:\n\n``` rust\nfn foo3(t0: &mut &mut int) {\n    let t1 = &mut *t0;\n    let p: &int = &**t0;\n\n\n\n}\n\nfn main() {}\n\ntest.rs:3:19: 3:24 error: cannot borrow `**t0` because it is already borrowed as mutable\ntest.rs:3     let p: &int = &**t0;\n                            ^~~~~\ntest.rs:2:14: 2:22 note: previous borrow of `**t0` as mutable occurs here; the mutable borrow prevents subsequent moves, borrows, or modification of `**t0` until the borrow ends\ntest.rs:2     let t1 = &mut *t0;\n                       ^~~~~~~~\ntest.rs:7:2: 7:2 note: previous borrow ends here\ntest.rs:1 fn foo3(t0: &mut &mut int) {\n...\ntest.rs:7 }\n          ^\n```\n\n(Sidenote: the `span_end_note` currently also has issue #11715)\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/11718/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/11718/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
