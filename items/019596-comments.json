[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66379860",
    "html_url": "https://github.com/rust-lang/rust/issues/19596#issuecomment-66379860",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19596",
    "id": 66379860,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2Mzc5ODYw",
    "user": {
      "login": "gereeter",
      "id": 2328242,
      "node_id": "MDQ6VXNlcjIzMjgyNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2328242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gereeter",
      "html_url": "https://github.com/gereeter",
      "followers_url": "https://api.github.com/users/gereeter/followers",
      "following_url": "https://api.github.com/users/gereeter/following{/other_user}",
      "gists_url": "https://api.github.com/users/gereeter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gereeter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gereeter/subscriptions",
      "organizations_url": "https://api.github.com/users/gereeter/orgs",
      "repos_url": "https://api.github.com/users/gereeter/repos",
      "events_url": "https://api.github.com/users/gereeter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gereeter/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-09T23:39:29Z",
    "updated_at": "2014-12-09T23:39:29Z",
    "body": "This seems like expected behavior to me. Passing a closure to either of the `method_bad`s will cause a specialized version of that `method_bad` to be created, including a new type for the wrapper unboxed closure. This is then passed to `method_bad`, creating a new specialized version and a second new type for the wrapper closure. The cycle repeats indefinitely.\n\nThe only only way that I could see `rustc` accepting this would be if it were to recognize the `|x| f(x)` idiom and replace it with `f`. This seems very distateful, though I would be happy to see a lint recommending it.\n\nThis should work as a replacement:\n\n``` rust\nfn method_ok_unboxed<F>(&self, f: F) -> bool where F: Fn(()) -> bool {\n    self.method_ok_unboxed(f);\n}\n```\n\nAdditionally, it should be faster, as it won't be going through the useless indirection of `|x| f(x)`. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66379860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66381993",
    "html_url": "https://github.com/rust-lang/rust/issues/19596#issuecomment-66381993",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19596",
    "id": 66381993,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2MzgxOTkz",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-09T23:59:24Z",
    "updated_at": "2014-12-09T23:59:24Z",
    "body": "@gereeter Sure, that works in the reduced case, but in the [`TrieMap` code](https://github.com/rust-lang/rust/blob/6f4c11be3b9706d1ba0e1b74b89de1478410a56f/src/libcollections/trie/map.rs#L709-712), it won't work because the method call is inside a for loop, and the operation you are suggesting moves the closure.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66381993/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66389716",
    "html_url": "https://github.com/rust-lang/rust/issues/19596#issuecomment-66389716",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19596",
    "id": 66389716,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2Mzg5NzE2",
    "user": {
      "login": "gereeter",
      "id": 2328242,
      "node_id": "MDQ6VXNlcjIzMjgyNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2328242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gereeter",
      "html_url": "https://github.com/gereeter",
      "followers_url": "https://api.github.com/users/gereeter/followers",
      "following_url": "https://api.github.com/users/gereeter/following{/other_user}",
      "gists_url": "https://api.github.com/users/gereeter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gereeter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gereeter/subscriptions",
      "organizations_url": "https://api.github.com/users/gereeter/orgs",
      "repos_url": "https://api.github.com/users/gereeter/repos",
      "events_url": "https://api.github.com/users/gereeter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gereeter/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-10T01:19:02Z",
    "updated_at": "2014-12-10T01:19:02Z",
    "body": "@japaric Why not have it just take the closure by reference, then?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66389716/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66449703",
    "html_url": "https://github.com/rust-lang/rust/issues/19596#issuecomment-66449703",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19596",
    "id": 66449703,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NDQ5NzAz",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-10T13:17:10Z",
    "updated_at": "2014-12-10T13:17:10Z",
    "body": "Changing the signature to always take the closure by reference is a loss in ergonomics:\n\n``` rust\ntrie_map.each_reverse(&mut |a, b| /* body */);\n// vs\ntrie_map.each_reverse(|a, b| /* body */);\n```\n\nWhat we probably want to do is add the following `impl`:\n\n``` rust\nimpl<'a, Args, Result> FnMut<Args, Result> for &'a mut F where F: FnMut<Args, Result> { /* */ }\n```\n\nThat way we can pass the closure either by value or by reference. However, due to #18835/#19032 we can't do that at the moment.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66449703/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69533422",
    "html_url": "https://github.com/rust-lang/rust/issues/19596#issuecomment-69533422",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19596",
    "id": 69533422,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NTMzNDIy",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-12T06:27:26Z",
    "updated_at": "2015-01-12T06:27:26Z",
    "body": "> This seems like expected behavior to me.\n\nI agree, but I think this is so subtle and hard to debug (the infinite chain of unique types is unexpected, since they all look the same in the source) that this is at least worth special error messages.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69533422/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69864105",
    "html_url": "https://github.com/rust-lang/rust/issues/19596#issuecomment-69864105",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19596",
    "id": 69864105,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5ODY0MTA1",
    "user": {
      "login": "SecondNature",
      "id": 931228,
      "node_id": "MDQ6VXNlcjkzMTIyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/931228?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SecondNature",
      "html_url": "https://github.com/SecondNature",
      "followers_url": "https://api.github.com/users/SecondNature/followers",
      "following_url": "https://api.github.com/users/SecondNature/following{/other_user}",
      "gists_url": "https://api.github.com/users/SecondNature/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SecondNature/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SecondNature/subscriptions",
      "organizations_url": "https://api.github.com/users/SecondNature/orgs",
      "repos_url": "https://api.github.com/users/SecondNature/repos",
      "events_url": "https://api.github.com/users/SecondNature/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SecondNature/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-14T03:30:42Z",
    "updated_at": "2015-01-14T21:22:12Z",
    "body": "The compiler never returns when compiling this code. If you remove the predicate closure then you get \"error: reached the recursion limit during monomorphization\". But with both closures included it just loops and never returns. I would assume that the \"recursion limit\" test in the error message is failing with two closures.\n\nrustc 1.0.0-nightly (3d0d9bb6f 2015-01-12 22:56:20 +0000)\n\n#![crate_name = \"compiler_bug\"]\n\n#![crate_type = \"bin\"]\n\n#![allow(unused_variables)]\n\nfn main() {\n  recursive(|| { false } , || { })\n}\n\npub fn recursive< P: Fn() -> bool, F: Fn()>(predicate : P , function : F )  {\n  recursive( ||predicate(), ||function() );\n}\n\nI read that the error message may be expected behaviour. But this endless loop behaviour may influence your design choice or encourage a error to be added.\n\nCan someone private message me a version of the included code that will compile.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69864105/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/154650619",
    "html_url": "https://github.com/rust-lang/rust/issues/19596#issuecomment-154650619",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19596",
    "id": 154650619,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1NDY1MDYxOQ==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-07T07:40:37Z",
    "updated_at": "2015-11-07T07:40:37Z",
    "body": "We now have a better message. Updated code:\n\n```\n#![feature(unboxed_closures)]\n#![feature(core)]\n\nstruct Struct;\n\nimpl Struct {\n    fn method_bad<F>(&self, f: F) -> bool where F: Fn(()) -> bool {\n        self.method_bad(|t| f(t))\n    }\n\n    fn method_bad2<F>(&self, f: F) -> bool where F: Fn(()) -> bool {\n        let f: &Fn(()) -> bool = &f;\n\n        self.method_bad2(|t| f.call((t,)))\n    }\n}\n\nfn main() {\n    // Pick one\n    Struct.method_bad(|_| true);\n    //Struct.method_bad2(|_| true);\n}\n\n```\n\nerrors:\n\n```\nhello.rs:11:5: 15:6 warning: method is never used: `method_bad2`, #[warn(dead_code)] on by default\nhello.rs:11     fn method_bad2<F>(&self, f: F) -> bool where F: Fn(()) -> bool {\nhello.rs:12         let f: &Fn(()) -> bool = &f;\nhello.rs:13 \nhello.rs:14         self.method_bad2(|t| f.call((t,)))\nhello.rs:15     }\nhello.rs:7:5: 9:6 warning: function cannot return without recurring, #[warn(unconditional_recursion)] on by default\nhello.rs:7     fn method_bad<F>(&self, f: F) -> bool where F: Fn(()) -> bool {\nhello.rs:8         self.method_bad(|t| f(t))\nhello.rs:9     }\nhello.rs:8:9: 8:34 note: recursive call site\nhello.rs:8         self.method_bad(|t| f(t))\n                   ^~~~~~~~~~~~~~~~~~~~~~~~~\nhello.rs:7:5: 9:6 help: a `loop` may express intention better if this is on purpose\nhello.rs:11:5: 15:6 warning: function cannot return without recurring, #[warn(unconditional_recursion)] on by default\nhello.rs:11     fn method_bad2<F>(&self, f: F) -> bool where F: Fn(()) -> bool {\nhello.rs:12         let f: &Fn(()) -> bool = &f;\nhello.rs:13 \nhello.rs:14         self.method_bad2(|t| f.call((t,)))\nhello.rs:15     }\nhello.rs:14:9: 14:43 note: recursive call site\nhello.rs:14         self.method_bad2(|t| f.call((t,)))\n                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nhello.rs:11:5: 15:6 help: a `loop` may express intention better if this is on purpose\nhello.rs:7:5: 9:6 error: reached the recursion limit during monomorphization\nhello.rs:7     fn method_bad<F>(&self, f: F) -> bool where F: Fn(()) -> bool {\nhello.rs:8         self.method_bad(|t| f(t))\nhello.rs:9     }\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/154650619/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/220357324",
    "html_url": "https://github.com/rust-lang/rust/issues/19596#issuecomment-220357324",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19596",
    "id": 220357324,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyMDM1NzMyNA==",
    "user": {
      "login": "oli-obk",
      "id": 332036,
      "node_id": "MDQ6VXNlcjMzMjAzNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/oli-obk",
      "html_url": "https://github.com/oli-obk",
      "followers_url": "https://api.github.com/users/oli-obk/followers",
      "following_url": "https://api.github.com/users/oli-obk/following{/other_user}",
      "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions",
      "organizations_url": "https://api.github.com/users/oli-obk/orgs",
      "repos_url": "https://api.github.com/users/oli-obk/repos",
      "events_url": "https://api.github.com/users/oli-obk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/oli-obk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-05-19T15:18:22Z",
    "updated_at": "2016-05-19T15:18:22Z",
    "body": "this doesn't look fixed to me, there's still various `FIXME(#19596)` in the source with workarounds, and fixing them still gives the following error message:\n\n```\nerror: overflow evaluating the requirement `[closure@src/librustc/hir/pat_util.rs:177:14: 184:6 dm:&'static &'static std::collections::HashMap<u32, hir::def::PathResolution, core::hash::BuildHasherDefault<rustc_data_structures::fnv::FnvHasher>>, contains_bindings:&'static mut bool]: core::ops::FnMut<(&'static hir::Pat,)>` [E0275]\nsrc/librustc/lib.rs:1:1: 1:1 note: consider adding a `#![recursion_limit=\"128\"]` attribute to your crate\nerror: aborting due to previous error\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/220357324/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
