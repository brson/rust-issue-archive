[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89093342",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89093342",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89093342,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5MDkzMzQy",
    "user": {
      "login": "rust-highfive",
      "id": 7378925,
      "node_id": "MDQ6VXNlcjczNzg5MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7378925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rust-highfive",
      "html_url": "https://github.com/rust-highfive",
      "followers_url": "https://api.github.com/users/rust-highfive/followers",
      "following_url": "https://api.github.com/users/rust-highfive/following{/other_user}",
      "gists_url": "https://api.github.com/users/rust-highfive/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rust-highfive/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rust-highfive/subscriptions",
      "organizations_url": "https://api.github.com/users/rust-highfive/orgs",
      "repos_url": "https://api.github.com/users/rust-highfive/repos",
      "events_url": "https://api.github.com/users/rust-highfive/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rust-highfive/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T00:31:23Z",
    "updated_at": "2015-04-03T00:31:23Z",
    "body": "r? @nikomatsakis\n\n(rust_highfive has picked a reviewer for you, use r? to override)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89093342/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89100093",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89100093",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89100093,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5MTAwMDkz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T00:59:07Z",
    "updated_at": "2015-04-03T00:59:07Z",
    "body": "In the benchmarks the same vector is being pushed onto on each iteration of the loop, and the 64k benchmark doesn't reserve 64k of space (it just reserves 64 bytes), were these both intentional? I tried tweaking both of these and got these [before and after numbers](https://gist.github.com/alexcrichton/31122565e893d6599453).\n\nI'm somewhat wary of optimizing for microbenchmarks like this, I feel like the implementation of these common functions should be expressible in concise terms, but this `read_to_end` function continues to become more sprawling over time. This also issues 2x more syscalls when the reader is backed by something like a `File` or `TcpStream`, which may or may not be desirable. \n\nSo I suppose I have a few questions:\n- Can you measure how this compares when backed by a syscall-oriented reader?\n- Would it be possible to make this more concise? The two `match` statements are very similar and are a little unsightly to have duplicated.\n\nThanks for continuing to press on this function!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89100093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89116735",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89116735",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89116735,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5MTE2NzM1",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T01:52:46Z",
    "updated_at": "2015-04-03T01:53:49Z",
    "body": "> In the benchmarks the same vector is being pushed onto on each iteration of the loop, and the 64k benchmark doesn't reserve 64k of space (it just reserves 64 bytes), were these both intentional?\n\nThe first of these was not intentional, the second of these was (I wanted to do one where it continued to expand, the other where it did not. The 64 reserved at the end will continue being rounded up to the nearest power of two, which means it will eventually meet the 64k requirement exactly, and thus be expanded to 128k by the original but kept at 64k by the modified version.)\n\n> I tried tweaking both of these and got these before and after numbers.\n\nOn my computer your test gives:\n\nBefore:\ntest read_to_end_1024        ... bench:      7812 ns/iter (+/- 1498)\ntest read_to_end_64k         ... bench:   2185142 ns/iter (+/- 260208)\ntest read_to_end_normal_test ... bench:   2180402 ns/iter (+/- 498111)\ntest read_to_end_small_test  ... bench:      7876 ns/iter (+/- 1808)\n\nAfter:\ntest read_to_end_1024        ... bench:      7936 ns/iter (+/- 3158)\ntest read_to_end_64k         ... bench:    147839 ns/iter (+/- 95546)\ntest read_to_end_normal_test ... bench:   1981639 ns/iter (+/- 343215)\ntest read_to_end_small_test  ... bench:       802 ns/iter (+/- 342)\n\nI ran these a few times, they seemed pretty consistent.  You can see it's considerably faster for the largest case where the old would need to reallocate, and the new would not.  It's obvious your computer is much beefier than mine- maybe running with a larger buffer on your machine would bring out the performance difference?\n\n> I'm somewhat wary of optimizing for microbenchmarks like this, I feel like the implementation of these common functions should be expressible in concise terms, but this read_to_end function continues to become more sprawling over time.\n\nI would generally agree, but in this case I think it's an important benchmark, since it is a fairly common use case to treat a vector as a dynamic array rather than a variable length array, assigning it a capacity exactly what you know it will reach and then never growing it past that capacity (eg, I know the file is exactly this long, let me reserve that much up front so it never has to grow).  In this function, using a vector in this way will result in using up twice as much memory as necessary, as well as reallocating the entire vector for no reason.\n\nRight now the only way to get optimal performance in this case is to reserve exactly one more byte than you need.  It seems better to make this function more complex rather than requiring every Rust programmer to remember to reserve the extra byte when using this function.\n\nGiven that though...\n\n> Can you measure how this compares when backed by a syscall-oriented reader?\n\nThis is a good point.  I'll look into this, and try testing on a file.  It could be that the syscall will wipe out any performance increases.\n\n> Would it be possible to make this more concise? The two match statements are very similar and are a little unsightly to have duplicated.\n\nYeah this would be nice.  I'll look into this as well.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89116735/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89238431",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89238431",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89238431,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5MjM4NDMx",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T09:48:53Z",
    "updated_at": "2015-04-03T09:48:53Z",
    "body": "r? @alexcrichton (changing review since Alex basically owns this code)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89238431/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89341060",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89341060",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89341060,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5MzQxMDYw",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T16:17:04Z",
    "updated_at": "2015-04-03T16:18:27Z",
    "body": "I tested it on files of different sizes, and in every case got either a large performance increase (sometimes twice as fast) or, if it was slower, was on the order of a few percent or so (within the errors of the bench).  https://gist.github.com/bcoopers/c5b363a4effc4f78509b\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89341060/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89345071",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89345071",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89345071,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5MzQ1MDcx",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T16:32:35Z",
    "updated_at": "2015-04-03T16:32:35Z",
    "body": "Looking at it, I don't see a way to reduce the complexity of the code.  Though the results of the match are similar, what they are actually doing is entirely different.  You could combine them by having one match statement, with an if statement saying whether to write it to a temporary buffer or the end of the vector, and another one inside the results saying whether to copy the byte from the buffer over or not- but I think this would make the function look more cluttered, not less.\n\nI'll keep thinking about it, but the solution isn't apparent to me right now.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89345071/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89393758",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89393758",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89393758,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5MzkzNzU4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T19:11:32Z",
    "updated_at": "2015-04-03T19:11:32Z",
    "body": "> On my computer your test gives:\n\nWhoa, I have a feeling my box isn't 150x faster than yours! How are you compiling/running the benchmarks? I was compiling as `rustc foo.rs --test -Clto -Copt-level=3` and then running via `./foo --bench`. Did you perhaps forget to optimize?\n\n> I would generally agree, but in this case I think it's an important benchmark ...  In this function, using a vector in this way will result in using up twice as much memory as necessary, as well as reallocating the entire vector for no reason.\n\nYeah I do agree with this, it does seem bad! I just want to get a handle on what sort of overhead we're talking about :)\n\n> in every case got either a large performance increase (sometimes twice as fast)\n\nHm, I'm getting [quite different numbers](https://gist.github.com/7c660b0bee6dd7c82de0) myself. For me it looks like this PR is a little faster, but only slightly so. This may be related to the answer to my first question though!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89393758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89409824",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89409824",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89409824,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NDA5ODI0",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T20:19:09Z",
    "updated_at": "2015-04-03T20:19:09Z",
    "body": "You're absolutely right, I did not turn the optimizer on for my tests.  Sorry about that.\n\nWith the optimizer on, I get pretty different results from yours still... https://gist.github.com/bcoopers/cd2465904a3c7760c577\n\nOn my machine the change seems to hurt more at smaller read sizes (which makes sense, since the syscall stays the same price while the copy/reallocate gets more expensive as the vector gets larger) and results in maybe a 15% improvement for a large (10 megabyte) file.\n\nI'll leave it up to you at this point, whether to merge or close it. It's not particularly clear whether this change is beneficial or not, as my results suggest it strongly depends on how much data is being read in.  It certainly wasn't as beneficial as I had hoped, or as my initial (mistaken) benchmark suggested.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89409824/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89410159",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89410159",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89410159,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NDEwMTU5",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T20:20:54Z",
    "updated_at": "2015-04-03T20:21:51Z",
    "body": "I (somehow) accidentally closed it, and then inadvertently reopened it... sorry about this I'm kinda new to GitHub.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89410159/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89415918",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89415918",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89415918,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NDE1OTE4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T20:50:27Z",
    "updated_at": "2015-04-03T20:50:27Z",
    "body": "> You're absolutely right, I did not turn the optimizer on for my tests.\n\nNo worries! Just trying to make sense of the huge gap in numbers we were seeing :)\n\n> With the optimizer on, I get pretty different results from yours still\n\nOh dear, it looks like I made an error and was reusing the same binary! [My corrected numbers](https://gist.github.com/alexcrichton/6a45f407d83cbb60de3c) align much more closely with yours.\n\n> I'll leave it up to you at this point, whether to merge or close it.\n\nHm ok, so the numbers seem to yield these conclusions:\n- For cases with a pre-allocated vector, this change results in a speedup across the board of ~15%\n- For cases under 1MB without a pre-allocated capacity, this change results in a slowdown of almost 2x\n- For cases over 1MB without a pre-allocated capacity, this change results in a speedup of ~10%\n\nThese conclusions make me think that this change may not be worth it for now. I believe that you can regain this change's performance win by preallocating one extra byte (so the final read of length 1 can hit EOF), so it's pretty easy to recover.\n\nDoes that sound ok to you?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89415918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89417991",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89417991",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89417991,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NDE3OTkx",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T20:57:47Z",
    "updated_at": "2015-04-03T20:57:47Z",
    "body": "Yes I think that's reasonable, and our results seem more or less in agreement now. You can go ahead and close this.\n\n> I believe that you can regain this change's performance win by preallocating one extra byte\n\nLooking at the code, you might have to actually preallocate as much as an extra 64k as written.  I might experiment with this a little further, trying with only the change:\n\n```\nlet remaining_capacity = buf.capacity() - buf.len();\nbuf.extend(iter::repeat(0).take(cmp::min(new_write_size, remaining_capacity)));\n```\n\nwhich would allow you to preallocate only one extra byte, and also has the advantage of not reallocing in certain cases.  If this results in a reasonable performance increase (now that I know how to bench properly haha) I'll probably make a new pull request, otherwise I'll just drop it.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89417991/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89418526",
    "html_url": "https://github.com/rust-lang/rust/pull/23991#issuecomment-89418526",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23991",
    "id": 89418526,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NDE4NTI2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T21:01:51Z",
    "updated_at": "2015-04-03T21:01:51Z",
    "body": ">  I might experiment with this a little further, trying with only the change:\n\nOk cool, thanks for investigating! \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89418526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
