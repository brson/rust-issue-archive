[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47103032",
    "html_url": "https://github.com/rust-lang/rust/pull/15139#issuecomment-47103032",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15139",
    "id": 47103032,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTAzMDMy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-25T13:51:52Z",
    "updated_at": "2014-06-25T13:51:52Z",
    "body": "I was under the impression that the `Bitv` type was a fixed-size bit vector while the `BitvSet` type was a growable and shrinkable bit vector. It does seem a little odd to have two types though, so perhaps they're good candidates for merging? The line between them is definitely getting blurred with a `push` and `pop` method on the old fix-sized variant.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47103032/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47111984",
    "html_url": "https://github.com/rust-lang/rust/pull/15139#issuecomment-47111984",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15139",
    "id": 47111984,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTExOTg0",
    "user": {
      "login": "apoelstra",
      "id": 1351933,
      "node_id": "MDQ6VXNlcjEzNTE5MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apoelstra",
      "html_url": "https://github.com/apoelstra",
      "followers_url": "https://api.github.com/users/apoelstra/followers",
      "following_url": "https://api.github.com/users/apoelstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/apoelstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
      "organizations_url": "https://api.github.com/users/apoelstra/orgs",
      "repos_url": "https://api.github.com/users/apoelstra/repos",
      "events_url": "https://api.github.com/users/apoelstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apoelstra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-25T14:55:30Z",
    "updated_at": "2014-06-25T14:55:30Z",
    "body": "Oh, my bad, the description of `BitvSet` is \"An implementation of a set using a bit vector as an underlying representation for holding numerical elements.\", which sounds nothing at all like \"resizable bit vector\", so I didn't realize that this was its purpose.\n\nI'm happy to write code to merge these (and introduce more Vec-like functionality) if there would be support for that.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47111984/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47120751",
    "html_url": "https://github.com/rust-lang/rust/pull/15139#issuecomment-47120751",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15139",
    "id": 47120751,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTIwNzUx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-25T15:53:08Z",
    "updated_at": "2014-06-25T15:53:08Z",
    "body": "Oh dear, I think both of these types are a little out of date! I think that `Bitv`'s major benefit is that it will use inline storage of just a `uint` if possible, but I'm not entirely sure how much that wins in the long run.\n\nPerhaps the methods could be added to `BitvSet` for now? I'm not entirely sure what the best design for these two types are. Perhaps they could get merged, but they're generally used in perf-sensitive situations and it'd be tough to ensure that nothing was lost during the merge. For the time being, given two types, they likely belong on `BitvSet` rather than `Bitv`, and we could merge the two types in the future if necessary.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47120751/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47187555",
    "html_url": "https://github.com/rust-lang/rust/pull/15139#issuecomment-47187555",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15139",
    "id": 47187555,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTg3NTU1",
    "user": {
      "login": "apoelstra",
      "id": 1351933,
      "node_id": "MDQ6VXNlcjEzNTE5MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apoelstra",
      "html_url": "https://github.com/apoelstra",
      "followers_url": "https://api.github.com/users/apoelstra/followers",
      "following_url": "https://api.github.com/users/apoelstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/apoelstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
      "organizations_url": "https://api.github.com/users/apoelstra/orgs",
      "repos_url": "https://api.github.com/users/apoelstra/repos",
      "events_url": "https://api.github.com/users/apoelstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apoelstra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-26T04:52:52Z",
    "updated_at": "2014-06-26T04:52:52Z",
    "body": "Ok, it is not much work at all to move these functions into `BitvSet`, but there is more functionality missing that I would need to port from `Bitv`. In particular, `Bitv::iter()` returns an iterator of `uint`s which yields each of the indices at which the `BitvSet` has a 1 (in keeping with its nominal usecase of \"set of integers\"). There is no way to nondestructively get a `bool` iterator from a `BitvSet`, and adding one requires either (a) retooling the `Bitv` iterator code to support both structures or (b) duplicating the code almost, but not quite, exactly. Neither option is trivial.\n\nMy feeling is that we should merge these two data structures into a single `Bitv` which supports the small and large representations and can be resized. Then `BitvSet` can be implemented as `struct BitvSet(Bitv)` which implements the set operations (and only set operations) on top of the underlying `Bitv`.\n\nIs this a dramatic enough change to warrant an RFC? Note that `Bitv` would retain its original interface, plus new additions. While the `BitvSet` interface would possibly be reduced, we could support `.get_ref()` and `.get_mut_ref()` methods to access the underlying `Bitv` (this is impossible with the current implementation). And besides, `BitvSet` is used only once in all of rustc, in `src/libsyntax/attr.rs`, and the only methods used are assignment and `.contains()`. So it would suffice for rustc to just impl `Set` on `Bitv`, define `type BitvSet = Bitv` and call that a day.\n\nWhat are your thoughts?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47187555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47399311",
    "html_url": "https://github.com/rust-lang/rust/pull/15139#issuecomment-47399311",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15139",
    "id": 47399311,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3Mzk5MzEx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-27T20:56:54Z",
    "updated_at": "2014-06-27T20:56:59Z",
    "body": "Sounds like `Bitv` and `BitvSet` should be merged! I don't think this will require an RFC due to it being only a lightly used type and this will provide a migration path forward in all cases.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47399311/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47428944",
    "html_url": "https://github.com/rust-lang/rust/pull/15139#issuecomment-47428944",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15139",
    "id": 47428944,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDI4OTQ0",
    "user": {
      "login": "apoelstra",
      "id": 1351933,
      "node_id": "MDQ6VXNlcjEzNTE5MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apoelstra",
      "html_url": "https://github.com/apoelstra",
      "followers_url": "https://api.github.com/users/apoelstra/followers",
      "following_url": "https://api.github.com/users/apoelstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/apoelstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
      "organizations_url": "https://api.github.com/users/apoelstra/orgs",
      "repos_url": "https://api.github.com/users/apoelstra/repos",
      "events_url": "https://api.github.com/users/apoelstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apoelstra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T14:34:11Z",
    "updated_at": "2014-06-28T14:34:11Z",
    "body": "Thanks Alex.\n\nI'm cutting into the code now to merge the data structures, and there are some... interesting things. For one thing, `BitvSet` exposes several methods like `symmetric_difference`, which takes two `BitvSet`s and a function `bool -> bool`, computes their bitwise symmetric difference, runs the function on each bit, and returns true iff the function accepted on every bit. This function is not used anywhere in rustc, its functionality is IMHO very specified, its name does not match its functionality, and there is no documentation. My feeling is that these functions should be removed.\n\nAlso, the existing code is not very performant at all. For example, on every `BitvSet` set operation the current `size` (number of ones in the bit vector) is effectively recomputed twice. The `size` is used only as a return value for `.len()`, so why not compute it once there? Also the method of computation is to count the bits in every `uint` with a loop. Why not use `num::Int::count_ones` which is a passthrough to the appropriate variant of `intrinsics::ctlz64`?\n\nAlso there is some very creative use of iterators, most of which can be greatly simplified and made more efficient. Perhaps this is an artifact of Rust's immaturity when the module was written; `Bitv` has not been changed at least since it was part of `libextra`.\n\nAnd perhaps there is more that remains to be seen. :)\n\nSo I'm going to close this, and I'll submit a new PR \"revamp `Bitv` and `BitvSet`\" with my suggested changes spread across several commits. The goal is to minimize interface changes (except to remove `symmetric_difference` and friends) but there will be a lot of rewritten code and improved documentation.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47428944/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47429141",
    "html_url": "https://github.com/rust-lang/rust/pull/15139#issuecomment-47429141",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15139",
    "id": 47429141,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDI5MTQx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T14:42:59Z",
    "updated_at": "2014-06-28T14:42:59Z",
    "body": "> For one thing, BitvSet exposes several methods like symmetric_difference, which takes two BitvSets and a function bool -> bool, computes their bitwise symmetric difference, runs the function on each bit, and returns true iff the function accepted on every bit. This function is not used anywhere in rustc, its functionality is IMHO very specified, its name does not match its functionality, and there is no documentation. My feeling is that these functions should be removed.\n\nI think this should be converted into an external iterator (e.g. the [equlvaient things on `TreeSet`](http://doc.rust-lang.org/master/std/collections/struct.TreeSet.html#method.difference)). I would assume they were just missed in the internal -> external iterator changes (since, as you say, it hasn't changed for a long time).\n\n(Thanks for taking on this task :heart:)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47429141/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47440228",
    "html_url": "https://github.com/rust-lang/rust/pull/15139#issuecomment-47440228",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15139",
    "id": 47440228,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDQwMjI4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T22:26:23Z",
    "updated_at": "2014-06-28T22:26:23Z",
    "body": "> For one thing, BitvSet exposes several methods like symmetric_difference\n\nIndeed, as @huonw mentioned, these are ancient methods! If they don't make it through in the rewrite, it's probably not the end of the world.\n\n> Also, the existing code is not very performant at all. For example, on every BitvSet set operation the current size (number of ones in the bit vector) is effectively recomputed twice.\n\nOh dear!\n\n> Why not use num::Int::count_ones which is a passthrough to the appropriate variant of intrinsics::ctlz64?\n\nWe weren't clever enough when this was written :)\n\n> So I'm going to close this, and I'll submit a new PR \"revamp Bitv and BitvSet\" with my suggested changes spread across several commits\n\nAwesome! I'll definitely chime in with @huonw and say thanks for taking this on!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47440228/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
