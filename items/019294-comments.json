[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64332820",
    "html_url": "https://github.com/rust-lang/rust/pull/19294#issuecomment-64332820",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19294",
    "id": 64332820,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0MzMyODIw",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-25T09:42:39Z",
    "updated_at": "2014-11-25T09:42:39Z",
    "body": "https://github.com/Grieverheart/dsfmt-rs/pull/2 is a real-world example of something this helps.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64332820/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64401262",
    "html_url": "https://github.com/rust-lang/rust/pull/19294#issuecomment-64401262",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19294",
    "id": 64401262,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NDAxMjYy",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-25T13:46:42Z",
    "updated_at": "2014-11-25T13:46:54Z",
    "body": "What does this do for `transmute::<(), ()>(())`? I know it's not a real world usecase, but [`()` is currently classified as a scalar](https://github.com/rust-lang/rust/blob/f6cb58caeedf509cc80dd376bbb2541a0446046b/src/librustc/middle/ty.rs#L2403) and its LLVM type is `{}` which I suspect is not valid for a `bitcast`.\n\nIMO the use of `type_is_scalar` is ad-hoc and fragile, could we not use the LLVM type instead?\nI'm thinking integers, floating-point and vectors ought to be enough for now.\n\nThis way we could also (easily) handle pointer -> pointer and pointer -> integer / integer -> pointer casts, even when the Rust type doesn't readily provide this information (`trans::adt` could very well flatten an `enum`+newtype hierarchy many levels deep into a single pointer).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64401262/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64409692",
    "html_url": "https://github.com/rust-lang/rust/pull/19294#issuecomment-64409692",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19294",
    "id": 64409692,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NDA5Njky",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-25T14:48:06Z",
    "updated_at": "2014-11-25T14:48:06Z",
    "body": "I think in principle this makes sense. @eddyb is probably right that examining the LLVM types may be a good idea.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64409692/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64484039",
    "html_url": "https://github.com/rust-lang/rust/pull/19294#issuecomment-64484039",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19294",
    "id": 64484039,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NDg0MDM5",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-25T22:37:19Z",
    "updated_at": "2014-11-25T22:37:19Z",
    "body": "Updated to look at the LLVM type. This also now includes detecting the pointer -> pointer case for bitcast.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64484039/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64520104",
    "html_url": "https://github.com/rust-lang/rust/pull/19294#issuecomment-64520104",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19294",
    "id": 64520104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NTIwMTA0",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-26T06:21:36Z",
    "updated_at": "2014-11-26T06:21:36Z",
    "body": "I expect this to work fine for types that implement Drop if `datum.to_llscalarish()` is replaced with something like `if datum.kind.is_by_ref() { load_ty(bcx, datum.val, datum.ty) } else { datum.val }`.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64520104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64790245",
    "html_url": "https://github.com/rust-lang/rust/pull/19294#issuecomment-64790245",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19294",
    "id": 64790245,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NzkwMjQ1",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-27T13:28:01Z",
    "updated_at": "2014-11-27T13:29:02Z",
    "body": "Making this change:\n\n``` diff\n--- a/src/librustc_trans/trans/intrinsic.rs\n+++ b/src/librustc_trans/trans/intrinsic.rs\n@@ -192,11 +192,8 @@ pub fn trans_intrinsic_call<'a, 'blk, 'tcx>(mut bcx: Block<'blk, 'tcx>,\n                     (nonpointer_nonaggregate(in_kind) && nonpointer_nonaggregate(ret_kind)) || {\n                         in_kind == TypeKind::Pointer && ret_kind == TypeKind::Pointer\n                     };\n-                let primitive =\n-                    !ty::type_needs_drop(ccx.tcx(), in_type) &&\n-                    !ty::type_needs_drop(ccx.tcx(), ret_ty.unwrap());\n\n-                let dest = if bitcast_compatible && primitive {\n+                let dest = if bitcast_compatible {\n                     // if we're here, the type is scalar-like (a primitive or a\n                     // SIMD type), and so can be handled as a by-value ValueRef\n                     // and can also be directly bitcast to the target type.\n@@ -205,7 +202,11 @@ pub fn trans_intrinsic_call<'a, 'blk, 'tcx>(mut bcx: Block<'blk, 'tcx>,\n                     // are done efficiently implicitly in C with the `__m128i`\n                     // type and so this means Rust doesn't lose out there).\n                     let datum = unpack_datum!(bcx, expr::trans(bcx, &*arg_exprs[0]));\n-                    let val = datum.to_llscalarish(bcx);\n+                    let val = if datum.kind.is_by_ref() {\n+                        load_ty(bcx, datum.val, datum.ty)\n+                    } else {\n+                        datum.val\n+                    };\n                     let cast_val = BitCast(bcx, val, llret_ty);\n\n                     match dest {\n```\n\ngives me aborts compiling stage2 core (i.e. the stage1 compiler is codegened incorrectly):\n\n```\nrustc: x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore\n\nYou've met with a terrible fate, haven't you?\n\nfatal runtime error:  assertion failed: self.state != Armed\n```\n\nI assume, if it exists, destructor of the input (i.e. `datum.val`) needs to be cancelled, but I do not know how to do this. Handling destructors correctly would seem to be significantly more error prone, which may not be what we want for this minor tweak mainly designed to allow slightly better handling of SIMD types.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64790245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66652606",
    "html_url": "https://github.com/rust-lang/rust/pull/19294#issuecomment-66652606",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19294",
    "id": 66652606,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NjUyNjA2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-11T17:09:12Z",
    "updated_at": "2014-12-11T17:09:12Z",
    "body": "Looks like bors stalled out on this PR, but it passed all platforms but the one slave that was lost, so I have merged this manually.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66652606/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
