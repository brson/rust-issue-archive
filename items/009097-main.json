{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/9097",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/9097/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/9097/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/9097/events",
  "html_url": "https://github.com/rust-lang/rust/pull/9097",
  "id": 19269315,
  "node_id": "MDExOlB1bGxSZXF1ZXN0ODIxNjE1Ng==",
  "number": 9097,
  "title": "debuginfo: Support for namespaces",
  "user": {
    "login": "michaelwoerister",
    "id": 1825894,
    "node_id": "MDQ6VXNlcjE4MjU4OTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelwoerister",
    "html_url": "https://github.com/michaelwoerister",
    "followers_url": "https://api.github.com/users/michaelwoerister/followers",
    "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelwoerister/orgs",
    "repos_url": "https://api.github.com/users/michaelwoerister/repos",
    "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelwoerister/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 4,
  "created_at": "2013-09-10T16:15:58Z",
  "updated_at": "2022-02-07T09:28:05Z",
  "closed_at": "2013-09-11T14:31:06Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/9097",
    "html_url": "https://github.com/rust-lang/rust/pull/9097",
    "diff_url": "https://github.com/rust-lang/rust/pull/9097.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/9097.patch",
    "merged_at": null
  },
  "body": "Who would have thought that namespaces are such a can of worms `:P` This is mostly because of some GDB idiosyncrasies (does not use namespace information but linkage-name attributes for displaying items contained in namespaces, also cannot handle functions lexically nested within functions), monomorphization, and information about external items only available from metadata.\n\nThis pull request tries to tackle the problem anyway:\n- The `DW_AT_linkage_name` for functions is generated just to make GDB display a proper namespace-enabled function name. To this end, a pseudo-mangled name is generated, not corresponding to the real linkage name. This approach shows some success and could be extended to make GDB also show proper parameter types.\n- As GDB won't accept subprogram DIEs nested within other subprogram DIEs, the `debuginfo` module now generates a _companion namespace_ for each functions (iff needed). A function `fn abc()` will get a companion namespace with name `abc()`, which contains all items (modules, types, functions) declared within the functions scope. The real, proper solution, in my opinion, would be to faithfully reflect the program's lexical structure within DWARF (which allows arbitrary nesting of DIEs, afaik), but I am not sure LLVM's source level debugging implementation would like that and I am pretty sure GDB won't support this in the foreseeable future.\n- Monomorphization leads to functions and companion namespaces like `somelib::some_func<int, float>()::some_other_function<bool, bool, bool>()`, which I think is the desired behaviour. There is some design space here, however. Maybe you people prefer `somelib::some_func()::some_other_function<bool, bool, bool>()` or `somelib::some_func()::some_other_function::<int, float, bool, bool, bool>()`.\n\nThe solution will work for now but there are a few things on my 'far future wish list':\n- A real specification somewhere, what language constructs are mapped to what DWARF structures.\n- Proper tests that directly compare the generated DWARF information to the expected results (possibly using something like [pyelftools](https://github.com/eliben/pyelftools) or llvm-dwarfdump)\n- A unified implementation for crate-local and crate-external items (which would possibly involve beefing up `ast_map::path` and metadata a bit)\n\nAny comments are welcome!\n\nCloses #1541\nCloses #1542 (there might be other issues with function name prettiness, but this specific issue should be fixed)\nCloses #7715 (source locations for structs and enums are now read correctly from the AST)\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/9097/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/9097/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
