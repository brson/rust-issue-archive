[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2735673",
    "html_url": "https://github.com/rust-lang/rust/issues/1175#issuecomment-2735673",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1175",
    "id": 2735673,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MzU2NzM=",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-14T19:58:38Z",
    "updated_at": "2011-11-14T19:58:38Z",
    "body": "``` rust\nfn get_compile_unit_metadata(cache: metadata_cache, full_path: str)\n    -> @metadata<compile_unit_md> unsafe {\n    ret alt *cache[0] {\n      compile_unit_metadata(md) { unsafe::reinterpret_cast(md) }\n    };\n}\n```\n\nLooks like the unsafe::reinterpret_cast here is the catalyst. This version of get_compile_unit_metadata displays the valgrind errors, and the one that just returns md without the cast does not.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2735673/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2736616",
    "html_url": "https://github.com/rust-lang/rust/issues/1175#issuecomment-2736616",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1175",
    "id": 2736616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MzY2MTY=",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-14T21:11:25Z",
    "updated_at": "2011-11-14T21:11:25Z",
    "body": "``` rust\nimport std::unsafe;\nuse std;\n\ntag test {\n    a(@int);\n}\n\nfn main() unsafe {\n    let val = a(@1);\n    log_err alt val {\n      a(i) { unsafe::reinterpret_cast::<@int, @int>(i) }\n    };\n}\n```\n\n16:08 <brson> 13:06 < brson> jdm: the problem is thaht when you reinterpret cast that box, now you have two typed pointers to a box, but you didn't ever bump the refcount, so you ending  up dropping the ref twice\n16:08 <brson> 13:06 < brson> the solution here is that after you do the reinterpret cast, run unsafe::leak on the old pointer\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2736616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2737438",
    "html_url": "https://github.com/rust-lang/rust/issues/1175#issuecomment-2737438",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1175",
    "id": 2737438,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3Mzc0Mzg=",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-14T22:06:53Z",
    "updated_at": "2011-11-14T22:06:53Z",
    "body": "Brian's suggestion resolved the valgrind messages.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2737438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
