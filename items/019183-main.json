{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/19183",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/19183/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/19183/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/19183/events",
  "html_url": "https://github.com/rust-lang/rust/pull/19183",
  "id": 49706525,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MjQ4NDU1MTE=",
  "number": 19183,
  "title": "rustc_trans: Link archives with `--whole-archive`",
  "user": {
    "login": "klutzy",
    "id": 1589355,
    "node_id": "MDQ6VXNlcjE1ODkzNTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/klutzy",
    "html_url": "https://github.com/klutzy",
    "followers_url": "https://api.github.com/users/klutzy/followers",
    "following_url": "https://api.github.com/users/klutzy/following{/other_user}",
    "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions",
    "organizations_url": "https://api.github.com/users/klutzy/orgs",
    "repos_url": "https://api.github.com/users/klutzy/repos",
    "events_url": "https://api.github.com/users/klutzy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/klutzy/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 2,
  "created_at": "2014-11-21T15:10:08Z",
  "updated_at": "2014-11-27T02:32:33Z",
  "closed_at": "2014-11-27T02:32:33Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/19183",
    "html_url": "https://github.com/rust-lang/rust/pull/19183",
    "diff_url": "https://github.com/rust-lang/rust/pull/19183.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/19183.patch",
    "merged_at": null
  },
  "body": "If archives are passed to linker, linker does not add all object files\nbut instead scans each object in archive then adds it only if it\ndefines some symbols which has been undefined.\nIt is problematic when rlib needs to be contained in dylib, since\nsome portion of rlib is stripped out if unused by dylib itself.\n\nThis patch uses `--whole-archive` flag which changes linker behavior\nthat the linker just adds all objects in archive.\nUnfortunately, ld does not accept rlib as-is because it contains\nnon-object files, so they are manually removed before passed to ld.\n\nAlso, this change can be problematic if several archives actually\ncontain same symbol. For example, this patch breaks code like:\n\n``` Rust\n    #![crate_type = \"rlib\"]\n\n    // `libcfoo.a` contains `foo`.\n    #![link(name = \"cfoo\", kind = \"static\")]\n    extern {}\n\n    // `foo` is also defined here!\n    #[no_mangle]\n    pub fn foo() {}\n\n    // so this rlib archive has two `foo` symbols.\n```\n\nPreviously it worked because linker stripped out `cfoo`.\n\nFixes #14344\n",
  "closed_by": {
    "login": "klutzy",
    "id": 1589355,
    "node_id": "MDQ6VXNlcjE1ODkzNTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/klutzy",
    "html_url": "https://github.com/klutzy",
    "followers_url": "https://api.github.com/users/klutzy/followers",
    "following_url": "https://api.github.com/users/klutzy/following{/other_user}",
    "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions",
    "organizations_url": "https://api.github.com/users/klutzy/orgs",
    "repos_url": "https://api.github.com/users/klutzy/repos",
    "events_url": "https://api.github.com/users/klutzy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/klutzy/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/19183/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/19183/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
