{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/11509",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/11509/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/11509/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/11509/events",
  "html_url": "https://github.com/rust-lang/rust/pull/11509",
  "id": 25477912,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTE0NDA5ODQ=",
  "number": 11509,
  "title": "Alternative Mutex implementation",
  "user": {
    "login": "bill-myers",
    "id": 4647491,
    "node_id": "MDQ6VXNlcjQ2NDc0OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4647491?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bill-myers",
    "html_url": "https://github.com/bill-myers",
    "followers_url": "https://api.github.com/users/bill-myers/followers",
    "following_url": "https://api.github.com/users/bill-myers/following{/other_user}",
    "gists_url": "https://api.github.com/users/bill-myers/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bill-myers/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bill-myers/subscriptions",
    "organizations_url": "https://api.github.com/users/bill-myers/orgs",
    "repos_url": "https://api.github.com/users/bill-myers/repos",
    "events_url": "https://api.github.com/users/bill-myers/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bill-myers/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 9,
  "created_at": "2014-01-13T04:44:34Z",
  "updated_at": "2014-07-08T13:20:51Z",
  "closed_at": "2014-01-13T22:36:03Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/11509",
    "html_url": "https://github.com/rust-lang/rust/pull/11509",
    "diff_url": "https://github.com/rust-lang/rust/pull/11509.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/11509.patch",
    "merged_at": null
  },
  "body": "Pull #11462 implements a Mutex using a lockless algorithm that has to use thread_yield.\n\nThis is an alternative approach that removes all yields by introducing an internal lock, while still keeping the principle that in the native case the mutex must reduce to the native mutex.\n\nFurthermore, this implementation should be fair even when mixing native and green mutexes (assuming that the OS mutex is fair), can always detect recursive mutex locking, and support for green threads can be disabled by changing a constant to improve performance.\n\nThere is no longer a need for the MPSC intrusive queue since we now protect the queue with the internal queue_lock.\n\nIt compiles and passes tests, but of course would need review.\n\nContention on the internal lock with green tasks shouldn't be a problem, since such a contention would happen anyway if the tasks were native, and the MPSC queue still involves atomics on a common cacheline, which also generates contention.\n\nThe Linux kernel also uses a spinlock to protect its own sleepable mutexes in the contended case (note that in the Linux kernel mutexes all threads behave as green tasks since there is no OS mutex to fallback to, so the requirements are a bit different).\n\nSomeone with access to a large server could perhaps benchmark both approaches if desired.\n\nThis does not provide the \"as soon as unlock() returns you can obliterate the mutex\" guarantee, but this is unnecessary for Rust mutexes as discussed in pull #11462.\n",
  "closed_by": {
    "login": "bill-myers",
    "id": 4647491,
    "node_id": "MDQ6VXNlcjQ2NDc0OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4647491?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bill-myers",
    "html_url": "https://github.com/bill-myers",
    "followers_url": "https://api.github.com/users/bill-myers/followers",
    "following_url": "https://api.github.com/users/bill-myers/following{/other_user}",
    "gists_url": "https://api.github.com/users/bill-myers/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bill-myers/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bill-myers/subscriptions",
    "organizations_url": "https://api.github.com/users/bill-myers/orgs",
    "repos_url": "https://api.github.com/users/bill-myers/repos",
    "events_url": "https://api.github.com/users/bill-myers/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bill-myers/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/11509/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/11509/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
