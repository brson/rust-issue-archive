[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158795607",
    "html_url": "https://github.com/rust-lang/rust/issues/29988#issuecomment-158795607",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29988",
    "id": 158795607,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1ODc5NTYwNw==",
    "user": {
      "login": "abonander",
      "id": 3198595,
      "node_id": "MDQ6VXNlcjMxOTg1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3198595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/abonander",
      "html_url": "https://github.com/abonander",
      "followers_url": "https://api.github.com/users/abonander/followers",
      "following_url": "https://api.github.com/users/abonander/following{/other_user}",
      "gists_url": "https://api.github.com/users/abonander/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/abonander/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/abonander/subscriptions",
      "organizations_url": "https://api.github.com/users/abonander/orgs",
      "repos_url": "https://api.github.com/users/abonander/repos",
      "events_url": "https://api.github.com/users/abonander/events{/privacy}",
      "received_events_url": "https://api.github.com/users/abonander/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-22T20:31:00Z",
    "updated_at": "2015-11-22T20:31:00Z",
    "body": "Isn't this subject to alignment by LLVM?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158795607/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158799328",
    "html_url": "https://github.com/rust-lang/rust/issues/29988#issuecomment-158799328",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29988",
    "id": 158799328,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1ODc5OTMyOA==",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-22T21:01:53Z",
    "updated_at": "2015-11-22T21:01:53Z",
    "body": "@cybergeek94 what do you mean? The alloca is only 12 bytes large. That's also the amount of bytes we write in the `memcpy`, but then we ask to read data for a type that is 16 bytes large. I don't see how alignment is relevant here.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158799328/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158799624",
    "html_url": "https://github.com/rust-lang/rust/issues/29988#issuecomment-158799624",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29988",
    "id": 158799624,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1ODc5OTYyNA==",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-22T21:04:59Z",
    "updated_at": "2015-11-22T21:04:59Z",
    "body": "@cybergeek94 here's a demo: https://gist.github.com/dotdash/2da61d4d24fa79e0a9bb\n\nBuild without optimizations on x86_64 Linux, and you should be able to observe `z` in the C code, although it hasn't been passed as an argument. The mismatch in the struct type definitions is deliberate to show the problem.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158799624/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158855082",
    "html_url": "https://github.com/rust-lang/rust/issues/29988#issuecomment-158855082",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29988",
    "id": 158855082,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1ODg1NTA4Mg==",
    "user": {
      "login": "eefriedman",
      "id": 12769964,
      "node_id": "MDQ6VXNlcjEyNzY5OTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/12769964?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eefriedman",
      "html_url": "https://github.com/eefriedman",
      "followers_url": "https://api.github.com/users/eefriedman/followers",
      "following_url": "https://api.github.com/users/eefriedman/following{/other_user}",
      "gists_url": "https://api.github.com/users/eefriedman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eefriedman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eefriedman/subscriptions",
      "organizations_url": "https://api.github.com/users/eefriedman/orgs",
      "repos_url": "https://api.github.com/users/eefriedman/repos",
      "events_url": "https://api.github.com/users/eefriedman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eefriedman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-23T05:16:16Z",
    "updated_at": "2015-11-23T05:16:16Z",
    "body": "Reading past the end of an alloca has well-defined behavior in LLVM IR.  I guess we might end up with false positives if we ever support msan.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158855082/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158875101",
    "html_url": "https://github.com/rust-lang/rust/issues/29988#issuecomment-158875101",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29988",
    "id": 158875101,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1ODg3NTEwMQ==",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-23T08:21:45Z",
    "updated_at": "2015-11-23T08:21:45Z",
    "body": "@eefriedman are you implying that the generated IR is fine? If so, what is the defined behaviour / where can I read up on that?\n\nhttp://llvm.org/docs/LangRef.html#pointeraliasing reads as if it is undefined.\n\nWithout optimizations, this gives random output:\n\n``` rust\nfn foo() -> (i64, i64) {\n    let x = (0i32, 0i32, 0i32);\n    let y = &x as *const _ as *const (i64, i64);\n    unsafe {\n        *y\n    }\n}\n\nfn main() {\n    println!(\"foo() = {:?}\", foo());\n}\n```\n\nWith optimizations, SROA ignores the out-of-bounds read and emits a warning in debug mode, which doesn't seem like it is well-defined behaviour to me either. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158875101/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/159030626",
    "html_url": "https://github.com/rust-lang/rust/issues/29988#issuecomment-159030626",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29988",
    "id": 159030626,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1OTAzMDYyNg==",
    "user": {
      "login": "eefriedman",
      "id": 12769964,
      "node_id": "MDQ6VXNlcjEyNzY5OTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/12769964?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eefriedman",
      "html_url": "https://github.com/eefriedman",
      "followers_url": "https://api.github.com/users/eefriedman/followers",
      "following_url": "https://api.github.com/users/eefriedman/following{/other_user}",
      "gists_url": "https://api.github.com/users/eefriedman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eefriedman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eefriedman/subscriptions",
      "organizations_url": "https://api.github.com/users/eefriedman/orgs",
      "repos_url": "https://api.github.com/users/eefriedman/repos",
      "events_url": "https://api.github.com/users/eefriedman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eefriedman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-23T19:09:02Z",
    "updated_at": "2015-11-23T19:09:02Z",
    "body": "Basically, if a pointer points to valid memory, and is sufficiently aligned, you can load bytes up to the alignment... LLVM itself does this at https://github.com/llvm-mirror/llvm/blob/ef4e0adfe75684bf9017c8a9c5309e77b8aa3b7b/lib/Analysis/MemoryDependenceAnalysis.cpp#L322 etc.\n\nThat said, looking a bit more closely, the given testcase performs an \"align 8\" load from an \"align 4\" pointer, which is more problematic.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/159030626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/159035234",
    "html_url": "https://github.com/rust-lang/rust/issues/29988#issuecomment-159035234",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29988",
    "id": 159035234,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1OTAzNTIzNA==",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-23T19:21:39Z",
    "updated_at": "2015-11-23T19:21:39Z",
    "body": "Thanks! That looks like it just assumes that the load won't trap. Part of my concern here is that we might expose additional data this way, like observing `z` in that C code example. Though I guess optimizations might eventually leave the upper 32bits undefined and expose data anyway, so this might be moot.\n\nThe alignment problem is probably due to bad usage of `load_ty`. Ultimately, we should load and pass the struct elements individually anyway.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/159035234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/299713235",
    "html_url": "https://github.com/rust-lang/rust/issues/29988#issuecomment-299713235",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29988",
    "id": 299713235,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTcxMzIzNQ==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-07T15:21:15Z",
    "updated_at": "2017-05-07T15:21:15Z",
    "body": "This has been fixed, we now only load 12 bytes: `{i64, i32}` instead of `{i64, i64}`. Marking as E-needstest.\r\n\r\n```rust\r\n#[repr(C)]\r\nstruct S {\r\n    f1: i32,\r\n    f2: i32,\r\n    f3: i32,\r\n}\r\n\r\nextern {\r\n    fn foo(s: S);\r\n}\r\n\r\nfn main() {\r\n    let s = S { f1: 1, f2: 2, f3: 3 };\r\n    unsafe {\r\n        foo(s);\r\n    }\r\n}\r\n```\r\n\r\n```llvm\r\n  %_3 = alloca %S\r\n  %s = alloca %S\r\n  %0 = getelementptr inbounds %S, %S* %s, i32 0, i32 0\r\n  store i32 1, i32* %0\r\n  %1 = getelementptr inbounds %S, %S* %s, i32 0, i32 2\r\n  store i32 2, i32* %1\r\n  %2 = getelementptr inbounds %S, %S* %s, i32 0, i32 4\r\n  store i32 3, i32* %2\r\n  %3 = bitcast %S* %s to i8*\r\n  %4 = bitcast %S* %_3 to i8*\r\n  ; Copy 12 bytes with alignment of 4\r\n  call void @llvm.memcpy.p0i8.p0i8.i64(i8* %4, i8* %3, i64 12, i32 4, i1 false)\r\n  %5 = bitcast %S* %_3 to { i64, i32 }*\r\n  ; Load 12 bytes -- this is now fine, not loading 16 bytes\r\n  %6 = load { i64, i32 }, { i64, i32 }* %5, align 4\r\n  call void @foo({ i64, i32 } %6)\r\n  br label %bb1\r\n```",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/299713235/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
