[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8432828",
    "html_url": "https://github.com/rust-lang/rust/issues/3445#issuecomment-8432828",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3445",
    "id": 8432828,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MzI4Mjg=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-10T18:23:59Z",
    "updated_at": "2012-09-10T21:53:41Z",
    "body": "Full text of reddit comment:\n\nIf anyone's thinking of doing this on Windows, please make sure you do it correctly:\n\nUse CreateFiber() and SwitchToFiber() to create and swap in new stack segments. Do not attempt to allocate stack space yourself. This is the only supported way to update the stack bounds in the thread environment block (TEB).\n\nMaintain the singly-linked Structured Exception Handling (SEH) chain pointed to by FS:[0]. This must always consist of singly linked nodes at ascending addresses within the current OS stack. If you are copying out stack blocks, you must either add handlers to bridge across the segments or appropriately link and unlink nodes in each segment. Debugging this problem in Stackless Python was not fun.\n\nFailure to handle either case will lead to hard termination of the process on an exception due to corrupted stack state. I'm not sure if Go handles this in its version, but I didn't see FS: updating code....\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8432828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/18009323",
    "html_url": "https://github.com/rust-lang/rust/issues/3445#issuecomment-18009323",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3445",
    "id": 18009323,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4MDA5MzIz",
    "user": {
      "login": "metajack",
      "id": 28357,
      "node_id": "MDQ6VXNlcjI4MzU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/28357?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/metajack",
      "html_url": "https://github.com/metajack",
      "followers_url": "https://api.github.com/users/metajack/followers",
      "following_url": "https://api.github.com/users/metajack/following{/other_user}",
      "gists_url": "https://api.github.com/users/metajack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/metajack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/metajack/subscriptions",
      "organizations_url": "https://api.github.com/users/metajack/orgs",
      "repos_url": "https://api.github.com/users/metajack/repos",
      "events_url": "https://api.github.com/users/metajack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/metajack/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-05-16T15:40:22Z",
    "updated_at": "2013-05-16T15:40:22Z",
    "body": "Nominating for production ready.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/18009323/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/18016072",
    "html_url": "https://github.com/rust-lang/rust/issues/3445#issuecomment-18016072",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3445",
    "id": 18016072,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4MDE2MDcy",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-05-16T17:29:35Z",
    "updated_at": "2013-05-16T17:29:35Z",
    "body": "accepted for production-ready milestone\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/18016072/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/19841958",
    "html_url": "https://github.com/rust-lang/rust/issues/3445#issuecomment-19841958",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3445",
    "id": 19841958,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5ODQxOTU4",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-06-21T21:31:05Z",
    "updated_at": "2013-06-21T21:31:05Z",
    "body": "Fibers are designed for cooperative multitasking, not for segmented stacks, and will likely create too much overhead to be useful for implementing the latter.   Specifically:\n- Fiber stack sizes will be rounded up to the nearest page boundary, so super-small stacks become impossible.\n- SwitchToFiber swaps out the entire CPU context (just like a thread switch would), whereas for segmented stacks you actually need to only switch the stack and keep the rest.  You'd probably have to update thread context saved in the other fiber before switching to it (which isn't supported via Win32 API, BTW).  Not to mention that it would be orders of magnitude slower than the current morestack() implementation.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/19841958/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22645850",
    "html_url": "https://github.com/rust-lang/rust/issues/3445#issuecomment-22645850",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3445",
    "id": 22645850,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyNjQ1ODUw",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-14T15:55:53Z",
    "updated_at": "2013-08-14T15:55:53Z",
    "body": "visiting for bug triage, email 2013-08-05.\n\nI don't have anything to add beyond what's written on the bug currently, though there certainly seem to be a lot of interesting nitty gritty details here.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22645850/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22679411",
    "html_url": "https://github.com/rust-lang/rust/issues/3445#issuecomment-22679411",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3445",
    "id": 22679411,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyNjc5NDEx",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-15T01:17:00Z",
    "updated_at": "2013-08-15T01:17:00Z",
    "body": "Page boundaries may well be a requirement anyways. I believe they were in the last version of segmented stacks we had. Beyond that, the original poster seems to be trying to help us write non-crashy code when handling exception not fast code. If it's truly the only way to live through an SEH call, we'll have to do _something_ like the recommended thing. Maybe not exactly it, but something that preserves the SEH chain.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22679411/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26114839",
    "html_url": "https://github.com/rust-lang/rust/issues/3445#issuecomment-26114839",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3445",
    "id": 26114839,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MTE0ODM5",
    "user": {
      "login": "klutzy",
      "id": 1589355,
      "node_id": "MDQ6VXNlcjE1ODkzNTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klutzy",
      "html_url": "https://github.com/klutzy",
      "followers_url": "https://api.github.com/users/klutzy/followers",
      "following_url": "https://api.github.com/users/klutzy/following{/other_user}",
      "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions",
      "organizations_url": "https://api.github.com/users/klutzy/orgs",
      "repos_url": "https://api.github.com/users/klutzy/repos",
      "events_url": "https://api.github.com/users/klutzy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klutzy/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-11T05:03:03Z",
    "updated_at": "2013-10-11T05:10:01Z",
    "body": "The comment says we must be aware of stack info at TEB (TIB) which is only officially available by using fiber functions.\nHowever, the internal is well-known ([wikipedia link](http://en.wikipedia.org/wiki/Win32_Thread_Information_Block)) and the structure is defined at winnt.h (both mingw and msvc).\nIn the header, [struct NT_TIB](http://sourceforge.net/p/mingw/mingw-org-wsl/ci/master/tree/include/winnt.h#l3417) has two members named `StackBase` and `StackLimit`. They indicates the stack range (StackLimit~StackBase) and Windows internally uses them for [page check](http://www.microsoft.com/msj/archive/S2CE.aspx).\nAlso msvcrt functions (e.g. `puts` or `MessageBoxW`) may buzz if ESP is below StackLimit (I got it on win64).\n\nWhen I did mingw-w64 work (#8488), I [added](https://github.com/klutzy/rust/commit/442f4a5f2ca6f7f4082c09968e0fd83601a50d2a#diff-9d01c0fd27d0f8e50aa8885076123ed2R93) management code for them.\nHowever we lack of TIB support on 32-bit Windows. I'm not totally sure why it even works well :-/ Maybe msvcrt does not use TIB for stack checking.\n\nFactor and Go do similar to what I did. Factor developer left a [blog post](http://factor-language.blogspot.kr/2010/04/switching-call-stacks-on-different.html) which is great source for this issue. [Here](https://github.com/slavapestov/factor/blob/master/basis/cpu/x86/windows/bootstrap.factor) is relevant Factor code I guess.\nGo does somewhat tricky: they just sets `StacLimit = 0; StackBase = 0xffffffffffff`. ([sys_windows_amd64.s](http://golang.org/src/pkg/runtime/sys_windows_amd64.s), `setstacklimits` routine) This is simple but there may be some issues regarding ffi (e.g. what if Go routine calls C function then it exceeds the stack limit?)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26114839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27330340",
    "html_url": "https://github.com/rust-lang/rust/issues/3445#issuecomment-27330340",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3445",
    "id": 27330340,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MzMwMzQw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-29T18:33:10Z",
    "updated_at": "2013-10-29T18:33:10Z",
    "body": "In [today's meeting](https://github.com/mozilla/rust/wiki/Meeting-weekly-2013-10-29) we have decided to jettison segmented stacks. Additionally, we are currently managing custom stack bounds in the TEB/TIB on win64 (as pointed out by @klutzy), so I believe that this is closed.\n\nIf this should stay open though, then feel free to reopen!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27330340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
