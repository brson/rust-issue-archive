[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27124801",
    "html_url": "https://github.com/rust-lang/rust/pull/10070#issuecomment-27124801",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10070",
    "id": 27124801,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MTI0ODAx",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-25T20:53:21Z",
    "updated_at": "2013-10-25T20:53:21Z",
    "body": "The invariants here are really hard to follow. I wish that we weren't playing this dance of swapping out `Task.home`, and I don't understand why it's necessary. It seems like we should be able to just look at the IO handle's home and call `handle.home.send(TaskFromFriend(task))`, and then what is now `restore_original_home` is just checking whether the task is on the correct scheduler for resuming execution.\n\nIf we can get this to work though I don't mind leaving the complexity for now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27124801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27134321",
    "html_url": "https://github.com/rust-lang/rust/pull/10070#issuecomment-27134321",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10070",
    "id": 27134321,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MTM0MzIx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-25T23:57:58Z",
    "updated_at": "2013-10-25T23:57:58Z",
    "body": "I've updated this with your suggestions and what we talked about on IRC, it's a lot simpler now, and it seems to achieve the same goal (all tests passed locally).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27134321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28100904",
    "html_url": "https://github.com/rust-lang/rust/pull/10070#issuecomment-28100904",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10070",
    "id": 28100904,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTAwOTA0",
    "user": {
      "login": "anasazi",
      "id": 591682,
      "node_id": "MDQ6VXNlcjU5MTY4Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/591682?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/anasazi",
      "html_url": "https://github.com/anasazi",
      "followers_url": "https://api.github.com/users/anasazi/followers",
      "following_url": "https://api.github.com/users/anasazi/following{/other_user}",
      "gists_url": "https://api.github.com/users/anasazi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/anasazi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/anasazi/subscriptions",
      "organizations_url": "https://api.github.com/users/anasazi/orgs",
      "repos_url": "https://api.github.com/users/anasazi/repos",
      "events_url": "https://api.github.com/users/anasazi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/anasazi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-08T21:50:22Z",
    "updated_at": "2013-11-08T21:50:22Z",
    "body": "I don't think this change maintains thread safety. As far as I can tell, this doesn't change the home of the task to be the I/O home, which means that you can get this sequence of events:\n1. go to I/O home (home_for_io)\n2. start executing I/O action\n    a)   unblock task and yield (puts task on work queue)\n    b)   task is stolen\n    c)   task wakes up on wrong thread and calls I/O function ===> bad things happen here\n3. if the task miraculously survives to restore_original_home, then we fail the task.\n\nIn the original version:\n1. go to I/O home (home_for_io) and swap out task's home with I/O home\n2. start executing I/O action\n    a)  unblock task and yield (puts task on work queue)\n    b) task is stolen\n    c) task starts to wake up, notices it's on the wrong thread, and sends itself home\n    d) wakes up home and does I/O\n3. original home is swapped back\n\nTemporarily setting the task's home to the I/O home is necessary for thread safety in I/O or else the scheduler will happily execute I/O on the wrong thread.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28100904/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28119904",
    "html_url": "https://github.com/rust-lang/rust/pull/10070#issuecomment-28119904",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10070",
    "id": 28119904,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTE5OTA0",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-09T05:31:59Z",
    "updated_at": "2013-11-09T05:31:59Z",
    "body": "I can see how this would be a problem if the task is ever placed on a work queue, but I don't think that it's ever found in a work queue. During the homing operation, it's found in a specific scheduler's message queue. After the homing operation, it will get descheduled and won't be on any queue. When the task is reawoken, it's awoken with `resume_blocked_task_immediately` which never places it on a work queue.\n\nI agree that if the task resumption didn't happen with the \"immediately\" function we would have problems, but so long as the uv bindings all resume immediately, I don't think that a task is on a work queue at any point in time during an I/O operation.\n\nAlthough you are probably more familiar with the scheduler than I am, so am I missing something?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28119904/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
