[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60450757",
    "html_url": "https://github.com/rust-lang/rust/pull/18289#issuecomment-60450757",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18289",
    "id": 60450757,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDUwNzU3",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-24T21:18:29Z",
    "updated_at": "2014-10-24T21:18:29Z",
    "body": "r? @aturon @alexcrichton \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60450757/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60451007",
    "html_url": "https://github.com/rust-lang/rust/pull/18289#issuecomment-60451007",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18289",
    "id": 60451007,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDUxMDA3",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-24T21:20:56Z",
    "updated_at": "2014-10-24T21:20:56Z",
    "body": "Once this has been merged, some Reader functions can be simplified. E.g., read_u8 currently calls a large function (read_at_least) which then repeatedly calls read (up to 1000 times if read returns 0.) This might be the reason that read_u8 is significantly slower than read(buf) where buf has size 1.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60451007/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60485255",
    "html_url": "https://github.com/rust-lang/rust/pull/18289#issuecomment-60485255",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18289",
    "id": 60485255,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDg1MjU1",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-25T14:53:13Z",
    "updated_at": "2014-10-25T14:53:13Z",
    "body": "I forgot about the case where the buffer is empty. I think it's best to leave this case up to the implementation.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60485255/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60520758",
    "html_url": "https://github.com/rust-lang/rust/pull/18289#issuecomment-60520758",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18289",
    "id": 60520758,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTIwNzU4",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-26T15:27:55Z",
    "updated_at": "2014-10-26T15:27:55Z",
    "body": "Even after this, I think splitting Reader up into a basic trait and a specialized trait for blocking readers is inevitable. The documentation of Reader already makes a passing remark that \n\n> `read` [...] will block until data is available\n\nbut this should not be required in general and is not true in today's rust programs, even in the stdlib. E.g., there is a long issue talking about stdout being non-blocking in some cases and how this case should be handled (libnative currently doesn't handle this case.)\n\nThe `read` function itself and some extension methods are still useful in the non-blocking case and restricting a trait as common as Reader to blocking implementations will inevitably result in broken implementations.\n\nThe following methods can theoretically work fine with non-blocking read:\n- read\n- read_u8\n- read_i8\n- push\n\nThe rest will not work. Consider a reader implemented on top of a large but finite non-blocking byte stream. \n\n`read_u16` and friends might read one byte and then an error. At this point you have to decide if you loop indefinitely or discard the first byte. The second alternative will most likely trash the whole stream.\n\n`read_to_end` and `bytes` should be obvious.\n\nIn general, everything that might call `read` more than once doesn't work.\n\nHow should this be handled? Some ideas:\n- Add a method `is_blocking` to `Reader`. All methods that call `read` multiple times will first check this function and return an error immediately.\n- Add a method `read_blocking` which does ^\n- Split Reader into a general and a blocking trait.\n\nA basic implementation of the third version including optimized versions of `read_u16` and friends can be found here: https://gist.github.com/anonymous/a580fa6c6fd0564c7240\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60520758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60611460",
    "html_url": "https://github.com/rust-lang/rust/pull/18289#issuecomment-60611460",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18289",
    "id": 60611460,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjExNDYw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-27T15:25:51Z",
    "updated_at": "2014-10-27T15:25:51Z",
    "body": "The worry of non-blocking reads has been brought up in the past, and it definitely seems similar to the UDP where it's packet-oriented instead of byte-oriented. I'm somewhat wary to bolt on this \"return of 0 is undefined\" behavior clause to `Reader` in an attempt to fix it without considering it as a more holistic design. As it looks like you're describing, the `Reader` trait is mostly incompatible with nonblocking reads in terms of discarding data.\n\nFor `Reader` specifically (as written), I do not think we should say that a return value of 0 is undefined. This seems very similar to the \"iterator protocol\" question of what to do after an iterator returns `None` once, and I've definitely had 0-length reads come up in practice occasionally.\n\nAll in all, I do understand that the story of `Reader` + nonblocking IO isn't so hot, but I'd want to move carefully in this space rather than just tack on assumptions here and there to band-aid it up. The split you've made of `Reader` and `BlockingReader` seems like a great start! \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60611460/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64107424",
    "html_url": "https://github.com/rust-lang/rust/pull/18289#issuecomment-64107424",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18289",
    "id": 64107424,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0MTA3NDI0",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-23T05:31:35Z",
    "updated_at": "2014-11-23T05:31:35Z",
    "body": "@mahkoh @alexcrichton any update on this? It's been sitting for almost a month now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64107424/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64140041",
    "html_url": "https://github.com/rust-lang/rust/pull/18289#issuecomment-64140041",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18289",
    "id": 64140041,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0MTQwMDQx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-23T23:23:30Z",
    "updated_at": "2014-11-23T23:23:30Z",
    "body": "@cmr thanks for the reminder. I think that I'm going to close this out of inactivity, and I think that this will definitely come up when we get around to stabilizing `std::io`. There are thoughts to cut back on the scope of `Reader` to purely just a `read` method, for example, which should address at least some of the concerns here. For now though it may be best to clear up @bors's queue.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64140041/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
