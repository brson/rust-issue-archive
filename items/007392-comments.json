[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20015840",
    "html_url": "https://github.com/rust-lang/rust/pull/7392#issuecomment-20015840",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7392",
    "id": 20015840,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDE1ODQw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-06-25T23:25:16Z",
    "updated_at": "2013-06-25T23:25:16Z",
    "body": "cc @bblum\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20015840/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20018397",
    "html_url": "https://github.com/rust-lang/rust/pull/7392#issuecomment-20018397",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7392",
    "id": 20018397,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDE4Mzk3",
    "user": {
      "login": "bblum",
      "id": 1820515,
      "node_id": "MDQ6VXNlcjE4MjA1MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bblum",
      "html_url": "https://github.com/bblum",
      "followers_url": "https://api.github.com/users/bblum/followers",
      "following_url": "https://api.github.com/users/bblum/following{/other_user}",
      "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bblum/subscriptions",
      "organizations_url": "https://api.github.com/users/bblum/orgs",
      "repos_url": "https://api.github.com/users/bblum/repos",
      "events_url": "https://api.github.com/users/bblum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bblum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-06-26T00:12:39Z",
    "updated_at": "2013-06-26T00:20:40Z",
    "body": "I'm not sure having an `unpoison` method is the right approach here. Any task that wants to do this will presumably need to atomically make sure their unpoison attempt was successful w.r.t a subsequent access to the RWARC. I have two ideas for how it should be --\n\nWhen I first wrote poisoning, I thought of it as making an RWARC implicitly be sort of a back-channel for linked failure propagation. I could imagine a use case that wanted to avoid poisoning, and at the time figured the best way would actually be to offer a `RWARC::new_without_poisoning()` way to construct them, which simply disables the check (by stashing a bool inside the rwarc representation; a negligible performance hit). Keep in mind that, as it is, the poisoning is not actually important for interface soundness, and maybe it should even be off by default.\n\nThe thing I think this function wants to be, which could coexist with the above, is an access function that provides optional data instead of failing automatically:\n\n```\nfn read_unless_poisoned(blk: fn(Option<&T>) -> U) -> U\nfn write_unless_poisoned(blk: fn(Option<&mut T>) -> U) -> U\nfn write_cond_unless_poisoned(blk: fn(Option<(&mut T, &Condvar)>) -> U) -> U\nfn write_downgrade_unless_poisoned(blk: fn(Option<RWWriteMode>) -> U) -> U\n```\n\nThe current access functions could, of course, be implemented using those and `option::unwrap`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20018397/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20018491",
    "html_url": "https://github.com/rust-lang/rust/pull/7392#issuecomment-20018491",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7392",
    "id": 20018491,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDE4NDkx",
    "user": {
      "login": "bblum",
      "id": 1820515,
      "node_id": "MDQ6VXNlcjE4MjA1MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bblum",
      "html_url": "https://github.com/bblum",
      "followers_url": "https://api.github.com/users/bblum/followers",
      "following_url": "https://api.github.com/users/bblum/following{/other_user}",
      "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bblum/subscriptions",
      "organizations_url": "https://api.github.com/users/bblum/orgs",
      "repos_url": "https://api.github.com/users/bblum/repos",
      "events_url": "https://api.github.com/users/bblum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bblum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-06-26T00:15:27Z",
    "updated_at": "2013-06-26T00:15:27Z",
    "body": "Also, implementing write as a nonprimitive on top of read and unpoison would break the atomicity provided by the write-locked rwlock.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20018491/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20018892",
    "html_url": "https://github.com/rust-lang/rust/pull/7392#issuecomment-20018892",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7392",
    "id": 20018892,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDE4ODky",
    "user": {
      "login": "basic-calculus",
      "id": 4070335,
      "node_id": "MDQ6VXNlcjQwNzAzMzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4070335?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/basic-calculus",
      "html_url": "https://github.com/basic-calculus",
      "followers_url": "https://api.github.com/users/basic-calculus/followers",
      "following_url": "https://api.github.com/users/basic-calculus/following{/other_user}",
      "gists_url": "https://api.github.com/users/basic-calculus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/basic-calculus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/basic-calculus/subscriptions",
      "organizations_url": "https://api.github.com/users/basic-calculus/orgs",
      "repos_url": "https://api.github.com/users/basic-calculus/repos",
      "events_url": "https://api.github.com/users/basic-calculus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/basic-calculus/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-06-26T00:27:20Z",
    "updated_at": "2013-06-26T00:27:20Z",
    "body": "@bblum I think having it be not higher order would be cleaner but I heard that having a thunk can be optimized better than just regular parameter passing. Having a thunk is ugly though so I'll make it just be a normal parameter. I don't think doing a micro-optimization in this case is worth it. Besides now the poison on fail stuff can be removed.\n\nI feel silly that I missed the race condition with spawn_unsupervised.\n\nOkay! The zeroing of destroyed data makes much more sense to me now after reading your comment on the failure check stuff mistake. I don't think I'll make that kind of mistake again.\n\nI don't follow what you mean by saying that any task that wants to do this will need to make sure their unpoison attempt was successful. This sort of check would be nicer in a monadic style though (although as mentioned above I really don't know how to make that style rustic.) For example,\n\n```\natomically $ do\n    var $= 0\n    is_failed var\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20018892/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20019464",
    "html_url": "https://github.com/rust-lang/rust/pull/7392#issuecomment-20019464",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/7392",
    "id": 20019464,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDE5NDY0",
    "user": {
      "login": "basic-calculus",
      "id": 4070335,
      "node_id": "MDQ6VXNlcjQwNzAzMzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4070335?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/basic-calculus",
      "html_url": "https://github.com/basic-calculus",
      "followers_url": "https://api.github.com/users/basic-calculus/followers",
      "following_url": "https://api.github.com/users/basic-calculus/following{/other_user}",
      "gists_url": "https://api.github.com/users/basic-calculus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/basic-calculus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/basic-calculus/subscriptions",
      "organizations_url": "https://api.github.com/users/basic-calculus/orgs",
      "repos_url": "https://api.github.com/users/basic-calculus/repos",
      "events_url": "https://api.github.com/users/basic-calculus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/basic-calculus/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-06-26T00:43:33Z",
    "updated_at": "2013-06-26T00:43:33Z",
    "body": "Personally, I feel that a RWARC::new_without_poisoning is an ugly approach because it introduces polymorphism of behaviour in a bad, and inelegant way. A better approach might be to make RWARC an interface that could be tightened, or relaxed as needed. For example, a naively written function that took a RWARC could simply take a CheckedRWARC value, and a function that was written, and confirmed not to poison a value could be polymorphic over any value that implemented the RWARC interface. Though this approach would be better, I still think it's silly. Why not go with a simpler approach?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20019464/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
