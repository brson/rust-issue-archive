[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/98884009",
    "html_url": "https://github.com/rust-lang/rust/issues/25097#issuecomment-98884009",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25097",
    "id": 98884009,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk4ODg0MDA5",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-04T23:27:55Z",
    "updated_at": "2015-05-04T23:27:55Z",
    "body": "You do not need vec for the implementation. Something like the following would work:\n\n``` rust\nstruct BoxBuild<T> {\n    progress: Option<std::raw::Slice<T>>,\n    total: usize,\n}\n\nimpl<T> Drop for BoxBuild<T> {\n    fn drop(&mut self) {\n        use std::mem::{size_of, min_align_of};\n        unsafe {\n            if let Some(slice) = self.progress.take() {\n                for n in 0..slice.len {\n                    std::ptr::read(slice.data.offset(n as isize));\n                }\n                std::rt::heap::deallocate(\n                    slice.data as *mut u8,\n                    size_of::<T>() * self.total,\n                    min_align_of::<T>());\n            }\n        }\n    }\n}\n\nfn box_clone<T: Clone>(old: &Box<[T]>) -> Box<[T]> {\n    use std::mem::{size_of, min_align_of, transmute};\n    unsafe {\n        // Ignore OOM. #yolo\n        let mut alloc = (std::rt::heap::allocate(\n                    size_of::<T>() * old.len(),\n                    min_align_of::<T>())) as *mut T;\n        let mut new = BoxBuild{\n            progress: Some(std::raw::Slice {\n                data: alloc as *const T,\n                len: 0,\n            }),\n            total: old.len()\n        };\n        for o in old.iter() {\n            std::ptr::write(alloc, o.clone());\n            alloc = alloc.offset(1);\n            new.progress.as_mut().map(|s|s.len += 1);\n        }\n        let result = new.progress.take().unwrap();\n        transmute(result)\n    }\n}\n```\n\nNote that because `clone()` can panic it is required to keep track of the partial result so the correct stuff is dropped.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/98884009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/98894556",
    "html_url": "https://github.com/rust-lang/rust/issues/25097#issuecomment-98894556",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25097",
    "id": 98894556,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk4ODk0NTU2",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-05T00:50:02Z",
    "updated_at": "2015-05-05T00:50:02Z",
    "body": "Yes, that's nice that it can be carefully solved by essentially extracting the needed parts from what Vec does. But the Box code is otherwise so clean, it doesn't feel like the right way to do it. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/98894556/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/99029214",
    "html_url": "https://github.com/rust-lang/rust/issues/25097#issuecomment-99029214",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25097",
    "id": 99029214,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk5MDI5MjE0",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-05T10:38:31Z",
    "updated_at": "2015-05-05T10:38:31Z",
    "body": "You're welcome to suggest an alternative but I doubt it can be done in a manner that is both correct and significantly cleaner :)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/99029214/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/99030308",
    "html_url": "https://github.com/rust-lang/rust/issues/25097#issuecomment-99030308",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25097",
    "id": 99030308,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk5MDMwMzA4",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-05T10:43:02Z",
    "updated_at": "2015-05-05T10:43:02Z",
    "body": "Your fundamental analysis is great: `Box<[T]>` just isn't an exception safe representation while filling it with elements. It needs to keep track of the fill level, so a representation like Vec or BoxBuild is needed...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/99030308/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/124558772",
    "html_url": "https://github.com/rust-lang/rust/issues/25097#issuecomment-124558772",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25097",
    "id": 124558772,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNDU1ODc3Mg==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-24T15:27:29Z",
    "updated_at": "2015-07-24T15:27:29Z",
    "body": "Clone is also wanted for `Box<str>`, but that can be much simpler: There is no panic issue, and it can use a simple memcpy of the data.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/124558772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
