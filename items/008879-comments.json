[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27139982",
    "html_url": "https://github.com/rust-lang/rust/issues/8879#issuecomment-27139982",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8879",
    "id": 27139982,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MTM5OTgy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-26T05:32:26Z",
    "updated_at": "2013-10-26T05:32:26Z",
    "body": "I'm not entirely sure that there's a whole lot we can do about this. I believe that the reason for this is that libuv opens a bunch of file descriptors (for communication and such), and then we create even more by making lots of async handles.\n\nWe might be able to reduce the number of async handles we make, but otherwise I think this is just an issue of raising the file descriptor limits.\n\nI'm not closing this though, because I would like to investigate if we can reduce the number of file descriptors we force libuv to generate, this is just a hunch of mine.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27139982/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27140522",
    "html_url": "https://github.com/rust-lang/rust/issues/8879#issuecomment-27140522",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8879",
    "id": 27140522,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MTQwNTIy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-26T06:26:09Z",
    "updated_at": "2013-10-26T06:26:09Z",
    "body": "OK, I looked a bit more into this. This all from OSX's point of view, the reality is probably different for other platforms. \n\nFor me, the maximum file descriptor limit is 256. I was able to create ~128 pipes (2 per syscall) and then `pipe` started failing. It also turns out that libuv starts up 5 file descriptors per loop. Each event loop looks like it has one \"event file descriptor\", one pair of pipes for a signal handler, and one pair of pipes for an async watcher. All of this initialization always happens, it's not configurable. What this means is that you can create ~50 threads, at this rate (at least on my system), which is we we get an abort after creating the 52nd thread.\n\nWith this information in mind, I don't think that there's really anything we can do to fix this. The best action we can take is to alert the libuv folks to see if they can optimize the number of file descriptors they make per loop. In reality, I think this just means that the file descriptor limits need to be raised if you want this many threads. I suppose the other thing we could do is fail a bit more gracefully, but again this is kinda up to libuv b/c the abort is happening inside of libuv, not inside of our code.\n\nI'm closing this because I don't think that there's enough actionable here by us. It'd be nice if we could spawn a million threads, but rust is optimized for spawning millions of tasks, not threads.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27140522/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
