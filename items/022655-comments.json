[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75415815",
    "html_url": "https://github.com/rust-lang/rust/issues/22655#issuecomment-75415815",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22655",
    "id": 75415815,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDE1ODE1",
    "user": {
      "login": "blaenk",
      "id": 84680,
      "node_id": "MDQ6VXNlcjg0Njgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/84680?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blaenk",
      "html_url": "https://github.com/blaenk",
      "followers_url": "https://api.github.com/users/blaenk/followers",
      "following_url": "https://api.github.com/users/blaenk/following{/other_user}",
      "gists_url": "https://api.github.com/users/blaenk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blaenk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blaenk/subscriptions",
      "organizations_url": "https://api.github.com/users/blaenk/orgs",
      "repos_url": "https://api.github.com/users/blaenk/repos",
      "events_url": "https://api.github.com/users/blaenk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blaenk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-22T02:29:27Z",
    "updated_at": "2015-02-22T02:29:27Z",
    "body": "cc @nikomatsakis @pnkfelix \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75415815/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75416077",
    "html_url": "https://github.com/rust-lang/rust/issues/22655#issuecomment-75416077",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22655",
    "id": 75416077,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDE2MDc3",
    "user": {
      "login": "blaenk",
      "id": 84680,
      "node_id": "MDQ6VXNlcjg0Njgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/84680?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blaenk",
      "html_url": "https://github.com/blaenk",
      "followers_url": "https://api.github.com/users/blaenk/followers",
      "following_url": "https://api.github.com/users/blaenk/following{/other_user}",
      "gists_url": "https://api.github.com/users/blaenk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blaenk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blaenk/subscriptions",
      "organizations_url": "https://api.github.com/users/blaenk/orgs",
      "repos_url": "https://api.github.com/users/blaenk/repos",
      "events_url": "https://api.github.com/users/blaenk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blaenk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-22T02:39:23Z",
    "updated_at": "2015-02-22T02:39:23Z",
    "body": "My suspicion (which I removed from the first post because I'm not quite sure if it's the reason) is that it has to do with variance. Creating my own `Unique` similar to the one in rust but with a `*mut T` instead of a `*const T`, _OR_ with `PhantomData<*mut T>` instead of `PhantomData<T>` seemed to solve the issue, but again I'm not sure if that's the reason. I figured it was because `*const T` is ok to have as a covariant but `*mut T` must be an invariant, from my limited understanding of variance.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75416077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75592913",
    "html_url": "https://github.com/rust-lang/rust/issues/22655#issuecomment-75592913",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22655",
    "id": 75592913,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTkyOTEz",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-23T17:45:48Z",
    "updated_at": "2015-02-23T17:45:59Z",
    "body": "(More) reduced test case (reduced in that it's isolated from the stdlib):\n\n``` rust\nuse std::marker::PhantomData;\n\nunsafe impl<T: Send + ?Sized> Send for Unique<T> { }\nunsafe impl<T: Sync + ?Sized> Sync for Unique<T> { }\n\npub struct Unique<T:?Sized> {\n    pointer: *const T,\n    _marker: PhantomData<T>,\n}\n\npub struct Node<V> {\n    vals: V,\n    edges: Unique<Node<V>>,\n}\n\nfn is_send<T: Send>() {}\n\nfn main() {\n    is_send::<Node<&'static ()>>();\n}\n```\n\nthere is in fact an interaction with variance. The problem is that the \"infinite cycle\" detection doesn't seem to be kicking in here because an endless set of new region variables are being generated. This is probably due to the variance of `Send`. I have to think on this a second.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75592913/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75595948",
    "html_url": "https://github.com/rust-lang/rust/issues/22655#issuecomment-75595948",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22655",
    "id": 75595948,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTk1OTQ4",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-23T18:00:52Z",
    "updated_at": "2015-02-23T18:00:52Z",
    "body": "(Er, the variance of various things. :)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75595948/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75622972",
    "html_url": "https://github.com/rust-lang/rust/issues/22655#issuecomment-75622972",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22655",
    "id": 75622972,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjIyOTcy",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-23T20:18:10Z",
    "updated_at": "2015-02-23T20:19:56Z",
    "body": "So I've kind of thought this through. I think the _right_ fix is to enhance the trait matching system to understand that there is in fact no need to keep generating new constraints. This seems to be a bit complicated (it interacts with, among other things, #21974). \n\nThe short-term pragmatic fix is probably to modify MarkerTrait to be invariant, not contravariant. This is stricter than necessary but probably not terrible. The implication is that if one knows that e.g. `&'static T : Send` holds, that alone would not be enough to conclude that `&'a T : Send`. It is probably possible for us to loosen this in the future, even after 1.0, though _strictly speaking_ it would not be backwards compatible. (I guess a more limited fix would just be to change the variance of `Send` and `Sync` specifically.) (The reason it is not 100% backwards compat is because impls that are not overlapping for an invariant trait _can_ overlap for a contravariant trait; but this is unlikely to occur except for with object types.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75622972/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75979926",
    "html_url": "https://github.com/rust-lang/rust/issues/22655#issuecomment-75979926",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22655",
    "id": 75979926,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTc5OTI2",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-25T15:27:16Z",
    "updated_at": "2015-02-25T15:27:16Z",
    "body": "I plan to work around this problem for now by changing the definition of `MarkerTrait`. The underlying issue has been splintered off into #22806.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75979926/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
