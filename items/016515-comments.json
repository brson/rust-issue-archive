[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53134167",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-53134167",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 53134167,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTM0MTY3",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-22T23:28:01Z",
    "updated_at": "2014-08-22T23:28:01Z",
    "body": "There's already an LLVM pass which converts the `noalias` attributes to the new metadata during inlining. It's just not enabled by default now, but you can try it out by passing `-C llvm-args=\"-enable-noalias-to-md-conversion\"`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53134167/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53134780",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-53134780",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 53134780,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTM0Nzgw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-22T23:40:11Z",
    "updated_at": "2014-08-22T23:40:11Z",
    "body": "I'm aware of that, but we have lots of aliasing information beyond just the outermost pointer in a parameter.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53134780/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158213793",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-158213793",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 158213793,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1ODIxMzc5Mw==",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-19T22:05:36Z",
    "updated_at": "2015-11-19T22:23:02Z",
    "body": "In the following code, one would expect `b`, `c`, and `d` to generate the same code. Instead, `a` and `c` generate the same code because the aliasing guarantees of `&` are not used in `c`.\n\n``` rust\n#![crate_type = \"lib\"]\n\npub unsafe fn a(p: *const usize, g: fn()) -> usize {\n    let a = *p;\n    g();\n    let b = *p;\n    a ^ b\n}\n\npub unsafe fn b(p: &usize, g: fn()) -> usize {\n    let a = *p;\n    g();\n    let b = *p;\n    a ^ b\n}\n\npub unsafe fn c(p: *const usize, g: fn()) -> usize {\n    let p = &*p;\n\n    let a = *p;\n    g();\n    let b = *p;\n    a ^ b\n}\n\npub unsafe fn d(p: *const usize, g: fn()) -> usize {\n    let p = &*p;\n\n    b(p, g)\n}\n```\n\nApplying the information suggested in this issue manually to the IR fixes the issue.\n\n```\nb:\n    pushq   %rax\n    callq   *%rsi\n    xorl    %eax, %eax\n    popq    %rdx\n    retq\n\nc:\n    pushq   %r14\n    pushq   %rbx\n    pushq   %rax\n    movq    %rdi, %r14\n    movq    (%r14), %rbx\n    callq   *%rsi\n    xorq    (%r14), %rbx\n    movq    %rbx, %rax\n    addq    $8, %rsp\n    popq    %rbx\n    popq    %r14\n    retq\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/158213793/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/333317746",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-333317746",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 333317746,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMzMxNzc0Ng==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-09-30T15:59:13Z",
    "updated_at": "2017-09-30T15:59:13Z",
    "body": "Triage: https://github.com/rust-lang/rust/issues/38941 is related, as is https://github.com/rust-lang/rust/issues/31681",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/333317746/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/350903980",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-350903980",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 350903980,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDkwMzk4MA==",
    "user": {
      "login": "varkor",
      "id": 3943692,
      "node_id": "MDQ6VXNlcjM5NDM2OTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varkor",
      "html_url": "https://github.com/varkor",
      "followers_url": "https://api.github.com/users/varkor/followers",
      "following_url": "https://api.github.com/users/varkor/following{/other_user}",
      "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varkor/subscriptions",
      "organizations_url": "https://api.github.com/users/varkor/orgs",
      "repos_url": "https://api.github.com/users/varkor/repos",
      "events_url": "https://api.github.com/users/varkor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varkor/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-12-12T00:28:49Z",
    "updated_at": "2017-12-12T00:28:49Z",
    "body": "@mahkoh: I'm interested in looking into this \u2014 could you provide any more details on what metadata you added to successfully reduce the code generated for `c` to that for `b` and `d` (and how you tested it)?",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/350903980/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/351188181",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-351188181",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 351188181,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTE4ODE4MQ==",
    "user": {
      "login": "varkor",
      "id": 3943692,
      "node_id": "MDQ6VXNlcjM5NDM2OTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varkor",
      "html_url": "https://github.com/varkor",
      "followers_url": "https://api.github.com/users/varkor/followers",
      "following_url": "https://api.github.com/users/varkor/following{/other_user}",
      "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varkor/subscriptions",
      "organizations_url": "https://api.github.com/users/varkor/orgs",
      "repos_url": "https://api.github.com/users/varkor/repos",
      "events_url": "https://api.github.com/users/varkor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varkor/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-12-12T20:43:49Z",
    "updated_at": "2018-04-01T13:17:29Z",
    "body": "Following up on this particular test case, the optimised (`opt-level=3`) LLVM IR for the bodies of both `a` and `c` is:\r\n```llvm\r\n; a, c\r\n%0 = load i64, i64* %p, align 8\r\ntail call void %g()\r\n%1 = load i64, i64* %p, align 8\r\n%2 = xor i64 %1, %0\r\nret i64 %2\r\n```\r\nwhereas the ideal IR for `c` (already generated for `b` and `d`) is:\r\n```llvm\r\n; b, d\r\ntail call void %g()\r\nret i64 0\r\n```\r\n\r\nIf we manually annotate the IR, so that the body of `c` is:\r\n```llvm\r\n; c\r\n%0 = load i64, i64* %p, align 8, !alias.scope !0\r\ntail call void %g(), !noalias !0\r\n%1 = load i64, i64* %p, align 8, !alias.scope !0\r\n%2 = xor i64 %1, %0\r\nret i64 %2\r\n```\r\nand we add the following domain and scope:\r\n```llvm\r\n!2 = distinct !{!2} ; domain\r\n!1 = distinct !{!1, !2} ; scope\r\n!0 = distinct !{!1} ; scope list\r\n```\r\nthen, after running LLVM's `opt -O3`, the body of `c` is reduced to:\r\n```llvm\r\n; c\r\ntail call void %g(), !noalias !0\r\nret i64 0\r\n```\r\nas we want.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/351188181/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/353225810",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-353225810",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 353225810,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzIyNTgxMA==",
    "user": {
      "login": "varkor",
      "id": 3943692,
      "node_id": "MDQ6VXNlcjM5NDM2OTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varkor",
      "html_url": "https://github.com/varkor",
      "followers_url": "https://api.github.com/users/varkor/followers",
      "following_url": "https://api.github.com/users/varkor/following{/other_user}",
      "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varkor/subscriptions",
      "organizations_url": "https://api.github.com/users/varkor/orgs",
      "repos_url": "https://api.github.com/users/varkor/repos",
      "events_url": "https://api.github.com/users/varkor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varkor/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-12-21T00:50:50Z",
    "updated_at": "2017-12-21T00:50:50Z",
    "body": "Update: the semantics for aliasing guarantees have not by this time been completely well defined \u2014 in particular the above transformation is guaranteed (at least now) to be correct. It's probably necessary to wait before implementing any features based on `alias.scope` or `noalias` because of this.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/353225810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/356680099",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-356680099",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 356680099,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjY4MDA5OQ==",
    "user": {
      "login": "varkor",
      "id": 3943692,
      "node_id": "MDQ6VXNlcjM5NDM2OTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varkor",
      "html_url": "https://github.com/varkor",
      "followers_url": "https://api.github.com/users/varkor/followers",
      "following_url": "https://api.github.com/users/varkor/following{/other_user}",
      "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varkor/subscriptions",
      "organizations_url": "https://api.github.com/users/varkor/orgs",
      "repos_url": "https://api.github.com/users/varkor/repos",
      "events_url": "https://api.github.com/users/varkor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varkor/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-01-10T17:45:08Z",
    "updated_at": "2018-01-10T17:45:08Z",
    "body": "Just in case this is ever useful in the future, [I have a branch which optimises the test case](https://github.com/rust-lang/rust/compare/master...varkor:llvm-alias-metadata-new) using the metadata. Even though it may not be semantically correct, it might be helpful to look at for other alias optimisations in the future.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/356680099/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377677590",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-377677590",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 377677590,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NzY3NzU5MA==",
    "user": {
      "login": "nox",
      "id": 123095,
      "node_id": "MDQ6VXNlcjEyMzA5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/123095?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nox",
      "html_url": "https://github.com/nox",
      "followers_url": "https://api.github.com/users/nox/followers",
      "following_url": "https://api.github.com/users/nox/following{/other_user}",
      "gists_url": "https://api.github.com/users/nox/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nox/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nox/subscriptions",
      "organizations_url": "https://api.github.com/users/nox/orgs",
      "repos_url": "https://api.github.com/users/nox/repos",
      "events_url": "https://api.github.com/users/nox/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nox/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-03-31T08:47:24Z",
    "updated_at": "2018-03-31T08:48:02Z",
    "body": "Cc @rust-lang/wg-codegen @rust-lang/compiler This looks like it should be carried to completion by one of us, after @varkor's concern about it being semantically correct or not is addressed.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377677590/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377709880",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-377709880",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 377709880,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NzcwOTg4MA==",
    "user": {
      "login": "varkor",
      "id": 3943692,
      "node_id": "MDQ6VXNlcjM5NDM2OTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varkor",
      "html_url": "https://github.com/varkor",
      "followers_url": "https://api.github.com/users/varkor/followers",
      "following_url": "https://api.github.com/users/varkor/following{/other_user}",
      "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varkor/subscriptions",
      "organizations_url": "https://api.github.com/users/varkor/orgs",
      "repos_url": "https://api.github.com/users/varkor/repos",
      "events_url": "https://api.github.com/users/varkor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varkor/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-03-31T17:34:11Z",
    "updated_at": "2018-03-31T17:34:11Z",
    "body": "@nox: in particular, we need some examples of test cases that are improved by some `alias.scope` annotations, which are also sound. I think after we have some concrete examples, it shouldn't prove too difficult to adapt [the previous work](https://github.com/rust-lang/rust/issues/16515#issuecomment-356680099).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377709880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377742892",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-377742892",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 377742892,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Nzc0Mjg5Mg==",
    "user": {
      "login": "Manishearth",
      "id": 1617736,
      "node_id": "MDQ6VXNlcjE2MTc3MzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Manishearth",
      "html_url": "https://github.com/Manishearth",
      "followers_url": "https://api.github.com/users/Manishearth/followers",
      "following_url": "https://api.github.com/users/Manishearth/following{/other_user}",
      "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions",
      "organizations_url": "https://api.github.com/users/Manishearth/orgs",
      "repos_url": "https://api.github.com/users/Manishearth/repos",
      "events_url": "https://api.github.com/users/Manishearth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Manishearth/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-04-01T04:28:43Z",
    "updated_at": "2018-04-01T04:28:43Z",
    "body": "IIRC this is blocked on the unsafe code guidelines folks figuring out where aliasing UB starts? cc @RalfJung ",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377742892/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377784761",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-377784761",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 377784761,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Nzc4NDc2MQ==",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-04-01T12:51:30Z",
    "updated_at": "2018-04-01T12:51:30Z",
    "body": "Sounds reasonable. ;) I'd be hesitant to commit to anything right now though. However, I am fairly close to having a model that (I think) determines some kind of \"lower bound\" (in the sense of \"we want at least this much UB\"), so I could try to understand if the examples you have here work under that model. However, longer-term, it'd also be useful for me to actually understand what LLVM's scoped metadata means in general, and how you plan to emit it, so that we can try to get certainty not just for some examples.\r\n\r\nSo, looking at <https://github.com/rust-lang/rust/issues/16515#issuecomment-158213793>, we seem to be in agreement that `a` cannot be optimized. `b` should be optimizable under any model we come up with, I hope. Optimizing `c` is an explicit goal of the \"lower bound\" model I have been toying around with at the all-hands (and that I plan to work on more during the summer). `d` is almost equivalent to `c` (though it doesn't seem unlikely that function boundaries will have *some* significance), but with `b` optimizable the same of course holds for `d`.\r\n\r\n@varkor did you mean to write `c` at the bottom of <https://github.com/rust-lang/rust/issues/16515#issuecomment-351188181>? I thought `b` is already optimized right now, without additional metadata?\r\n\r\nSo, the only \"new\" example here (that would get optimized now but was not optimized before) is `c`? I think we want that to happen. And I think for shared references, this should not be too hard. Not sure how important it is that we proceed here?\r\n\r\nBut please hold on with anything related to mutable references. There are some strange corner cases where optimizing within a function is illegal but after moving some code to a separate function it becomes legal:\r\n```rust\r\nfn legal(x: &mut i32) { unsafe {\r\n  let x = x as *mut _ as usize;\r\n  let y1 = &mut *(x as *mut i32);\r\n  let y2 = &mut *(y1 as *mut i32 as usize as *mut i32);\r\n  // these two writes are legal -- y2 is reborrowing from y1, but because \r\n  // we went though usize we cannot possibly track where they are \"derived from\"\r\n  *y2 = 4;\r\n  *y1 = 3;\r\n  // Using y2 again here would be UB\r\n} }\r\n\r\nfn illegal(x: &mut i32) { unsafe {\r\n  let x = x as *mut _ as usize;\r\n  let y1 = &mut *(x as *mut i32);\r\n  let y2 = &mut *(y1 as *mut i32 as usize as *mut i32);\r\n\r\n  bar(y1, y2); // this call must trigger UB\r\n} }\r\nfn bar(y1: &mut i32, y2: &mut i32) {\r\n  // we will certainly want to optimize this\r\n  *y2 = 4;\r\n  *y1 = 3;\r\n}\r\n```\r\n`illegal` and `legal` look like they do the same thing, but we have to rule out `illegal` and most likely have to allow `legal`. We want to understand this better before we start optimizing more.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377784761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377786314",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-377786314",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 377786314,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Nzc4NjMxNA==",
    "user": {
      "login": "varkor",
      "id": 3943692,
      "node_id": "MDQ6VXNlcjM5NDM2OTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varkor",
      "html_url": "https://github.com/varkor",
      "followers_url": "https://api.github.com/users/varkor/followers",
      "following_url": "https://api.github.com/users/varkor/following{/other_user}",
      "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varkor/subscriptions",
      "organizations_url": "https://api.github.com/users/varkor/orgs",
      "repos_url": "https://api.github.com/users/varkor/repos",
      "events_url": "https://api.github.com/users/varkor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varkor/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-04-01T13:18:45Z",
    "updated_at": "2018-04-01T13:18:45Z",
    "body": "> @varkor did you mean to write `c` at the bottom of #16515 (comment)? I thought `b` is already optimized right now, without additional metadata?\r\n\r\nYes, I did, thanks \u2014 I've fixed the comment.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/377786314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/445986857",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-445986857",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 445986857,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTk4Njg1Nw==",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-12-10T21:48:35Z",
    "updated_at": "2018-12-10T21:48:35Z",
    "body": "It seems that besides the `noalias` attribute (that Rust already uses) and the `noalias` metadata (that this issue proposes to use), there is the `llvm.noalias` intrinsic.  And [judging from the PR introducing that intrinsic](https://reviews.llvm.org/D9375), the metadata has some issues that are solved by the intrinsic.\r\n\r\nThis issue is older than the intrinsic.  With the intrinsic now being available, do y'all think that the intrinsic should be better suited than the metadata for Rust's purpose, or is the metadata still preferred?\r\n\r\n(One of the reasons I am asking is that I hope to start looking at LLVM's `noalias` stuff from a formal perspective, and it'd be helpful if we didn't have to look at three different mechanisms to do very similar things.)",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/445986857/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/445989025",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-445989025",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 445989025,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTk4OTAyNQ==",
    "user": {
      "login": "nikic",
      "id": 216080,
      "node_id": "MDQ6VXNlcjIxNjA4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikic",
      "html_url": "https://github.com/nikic",
      "followers_url": "https://api.github.com/users/nikic/followers",
      "following_url": "https://api.github.com/users/nikic/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikic/subscriptions",
      "organizations_url": "https://api.github.com/users/nikic/orgs",
      "repos_url": "https://api.github.com/users/nikic/repos",
      "events_url": "https://api.github.com/users/nikic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikic/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-12-10T21:55:24Z",
    "updated_at": "2018-12-10T21:55:24Z",
    "body": "@RalfJung The `llvm.noalias` intrinsic never landed. In https://bugs.llvm.org/show_bug.cgi?id=39282 Hal mentioned that somebody is working on this area again, but I haven't heard anything since.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/445989025/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/445995141",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-445995141",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 445995141,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTk5NTE0MQ==",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-12-10T22:16:00Z",
    "updated_at": "2018-12-10T22:16:26Z",
    "body": "> The llvm.noalias intrinsic never landed.\r\n\r\nOh, seems I misinterpreted the \"Accepted\" label then.\r\n\r\nIn that case, take my question as the hypothetical \"if those patches landed, would Rust prefer that over the metadata?\"^^",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/445995141/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/476384314",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-476384314",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 476384314,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NjM4NDMxNA==",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2019-03-25T21:27:31Z",
    "updated_at": "2019-03-25T21:27:31Z",
    "body": "An RFC has been posted on the LLVM side for extending the support for `restrict`/`noalias`: https://lists.llvm.org/pipermail/llvm-dev/2019-March/131127.html",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/476384314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/538592492",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-538592492",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 538592492,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODU5MjQ5Mg==",
    "user": {
      "login": "cuviper",
      "id": 36186,
      "node_id": "MDQ6VXNlcjM2MTg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cuviper",
      "html_url": "https://github.com/cuviper",
      "followers_url": "https://api.github.com/users/cuviper/followers",
      "following_url": "https://api.github.com/users/cuviper/following{/other_user}",
      "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions",
      "organizations_url": "https://api.github.com/users/cuviper/orgs",
      "repos_url": "https://api.github.com/users/cuviper/repos",
      "events_url": "https://api.github.com/users/cuviper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cuviper/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2019-10-04T23:38:50Z",
    "updated_at": "2019-10-04T23:38:50Z",
    "body": "Here's the followup to that RFC:\r\nhttp://lists.llvm.org/pipermail/llvm-dev/2019-October/135667.html\r\nhttps://reviews.llvm.org/D68484",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/538592492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1179621364",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1179621364",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1179621364,
    "node_id": "IC_kwDOAAsO6M5GT5f0",
    "user": {
      "login": "workingjubilee",
      "id": 46493976,
      "node_id": "MDQ6VXNlcjQ2NDkzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/workingjubilee",
      "html_url": "https://github.com/workingjubilee",
      "followers_url": "https://api.github.com/users/workingjubilee/followers",
      "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}",
      "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions",
      "organizations_url": "https://api.github.com/users/workingjubilee/orgs",
      "repos_url": "https://api.github.com/users/workingjubilee/repos",
      "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/workingjubilee/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-07-09T23:32:13Z",
    "updated_at": "2022-07-09T23:32:13Z",
    "body": "Seems stalled at the moment.\r\n\r\nWhen there are manipulations to a Rust struct that is otherwise a flat \"by value\" entity, we could consider emitting appropriate information to hint about aliasing or lack thereof. Currently, LLVM avoids making assumptions that it would in fact make for separate variables, even in the same scope.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1179621364/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234514526",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234514526",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234514526,
    "node_id": "IC_kwDOAAsO6M5JlTJe",
    "user": {
      "login": "archshift",
      "id": 5377832,
      "node_id": "MDQ6VXNlcjUzNzc4MzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377832?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/archshift",
      "html_url": "https://github.com/archshift",
      "followers_url": "https://api.github.com/users/archshift/followers",
      "following_url": "https://api.github.com/users/archshift/following{/other_user}",
      "gists_url": "https://api.github.com/users/archshift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/archshift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/archshift/subscriptions",
      "organizations_url": "https://api.github.com/users/archshift/orgs",
      "repos_url": "https://api.github.com/users/archshift/repos",
      "events_url": "https://api.github.com/users/archshift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/archshift/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T16:29:50Z",
    "updated_at": "2022-09-01T16:29:50Z",
    "body": "@bjorn3 @felix91gr taking this conversation here from #82834.\r\n\r\nI was under the impression that if, for example, we have:\r\n```\r\npub struct Foo<'a, 'b> {\r\n    r1: &'a mut u32,\r\n    r2: &'b mut u32,\r\n}\r\n\r\npub fn use_foo(foo: &mut Foo) -> u32 {\r\n    *foo.r1 = 1;\r\n    *foo.r2 = 2;\r\n    return *foo.r1;\r\n}\r\n```\r\n\r\nThere's no case in which we couldn't elide the final load and optimize the last statement of `use_foo` to `return 1;`. But because we don't emit scoped aliasing metadata, we get the following optimized LLVM IR:\r\n\r\n```\r\ndefine i32 @example::use_foo({ i32*, i32* }* noalias nocapture noundef readonly align 8 dereferenceable(16) %0) unnamed_addr #0 !dbg !5 {\r\n  %2 = bitcast { i32*, i32* }* %0 to i32**, !dbg !10\r\n  %3 = load i32*, i32** %2, align 8, !dbg !10, !nonnull !9, !align !11\r\n  store i32 1, i32* %3, align 4, !dbg !10\r\n  %4 = getelementptr inbounds { i32*, i32* }, { i32*, i32* }* %0, i64 0, i32 1, !dbg !12\r\n  %5 = load i32*, i32** %4, align 8, !dbg !12, !nonnull !9, !align !11, !noundef !9\r\n  store i32 2, i32* %5, align 4, !dbg !12\r\n  %6 = load i32, i32* %3, align 4, !dbg !13\r\n  ret i32 %6, !dbg !14\r\n}\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234514526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234526464",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234526464",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234526464,
    "node_id": "IC_kwDOAAsO6M5JlWEA",
    "user": {
      "login": "cuviper",
      "id": 36186,
      "node_id": "MDQ6VXNlcjM2MTg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cuviper",
      "html_url": "https://github.com/cuviper",
      "followers_url": "https://api.github.com/users/cuviper/followers",
      "following_url": "https://api.github.com/users/cuviper/following{/other_user}",
      "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions",
      "organizations_url": "https://api.github.com/users/cuviper/orgs",
      "repos_url": "https://api.github.com/users/cuviper/repos",
      "events_url": "https://api.github.com/users/cuviper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cuviper/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T16:41:15Z",
    "updated_at": "2022-09-01T16:47:57Z",
    "body": "It seems like that example would really want **type**-level `noalias`, with `Foo` something like `{ i32* noalias, i32* noalias }`.\r\n\r\nThe optimization does work if you pass `Foo` by value, but only because we split up the `ScalarPair` into separate args that can each have `noalias`. That doesn't work if `Foo` has more than two fields.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234526464/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234535529",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234535529",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234535529,
    "node_id": "IC_kwDOAAsO6M5JlYRp",
    "user": {
      "login": "felix91gr",
      "id": 11747623,
      "node_id": "MDQ6VXNlcjExNzQ3NjIz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11747623?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/felix91gr",
      "html_url": "https://github.com/felix91gr",
      "followers_url": "https://api.github.com/users/felix91gr/followers",
      "following_url": "https://api.github.com/users/felix91gr/following{/other_user}",
      "gists_url": "https://api.github.com/users/felix91gr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/felix91gr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/felix91gr/subscriptions",
      "organizations_url": "https://api.github.com/users/felix91gr/orgs",
      "repos_url": "https://api.github.com/users/felix91gr/repos",
      "events_url": "https://api.github.com/users/felix91gr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/felix91gr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T16:50:18Z",
    "updated_at": "2022-09-01T16:50:18Z",
    "body": "@archshift I believe your impression is founded. To my eyes, that is already what the semantics should allow to be optimized.\r\n\r\nI'm not as versed as cuviper is in LLVM itself, so I'll let them help you on that front ^^\r\n\r\nBut I do believe that you're right in that the current language model should already allow for that optimization to happen :)",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234535529/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234754189",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234754189",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234754189,
    "node_id": "IC_kwDOAAsO6M5JmNqN",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T20:37:06Z",
    "updated_at": "2022-09-01T20:37:06Z",
    "body": "@archshift that case is pretty tricky actually since it involves double-indirection. I would agree that the following is definitely noalias:\r\n```rust\r\npub struct Foo<'a, 'b> {\r\n    r1: &'a mut u32,\r\n    r2: &'b mut u32,\r\n}\r\n\r\npub fn use_foo(foo: &mut Foo) -> u32 {\r\n    let r1 = &mut *foo.r1;\r\n    *r1 = 1;\r\n    *foo.r2 = 2;\r\n    return *r1;\r\n}\r\n```\r\nbut I am fairly sure that there are cases where Stacked Borrows would allow your code to pass.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234754189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234756401",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234756401",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234756401,
    "node_id": "IC_kwDOAAsO6M5JmOMx",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T20:39:02Z",
    "updated_at": "2022-09-01T20:40:08Z",
    "body": "Indeed, [here is a counterexample for that optimization](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=7349835ca64cde46e855a1f7ae1ce5f8). It passes Miri, so if we want this to be UB, we need an aliasing model that is even more aggressive than Stacked Borrows (and very few unsafe code authors would be happy with that...).",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234756401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234769355",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234769355",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234769355,
    "node_id": "IC_kwDOAAsO6M5JmRXL",
    "user": {
      "login": "cuviper",
      "id": 36186,
      "node_id": "MDQ6VXNlcjM2MTg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cuviper",
      "html_url": "https://github.com/cuviper",
      "followers_url": "https://api.github.com/users/cuviper/followers",
      "following_url": "https://api.github.com/users/cuviper/following{/other_user}",
      "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions",
      "organizations_url": "https://api.github.com/users/cuviper/orgs",
      "repos_url": "https://api.github.com/users/cuviper/repos",
      "events_url": "https://api.github.com/users/cuviper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cuviper/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T20:54:41Z",
    "updated_at": "2022-09-01T20:54:41Z",
    "body": "Then how about [this](https://play.rust-lang.org/?version=stable&mode=release&edition=2021&gist=97ee47ee597836cf2ad06c04e9297da1)? It also passes miri, and fails the assertion in debug mode, but that's optimized away in release mode.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234769355/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234778886",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234778886",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234778886,
    "node_id": "IC_kwDOAAsO6M5JmTsG",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T21:02:46Z",
    "updated_at": "2022-09-01T21:02:46Z",
    "body": "@cuviper that would fail in Miri with `-Zmiri-retag-fields`. This is currently the last gap I am aware of between Miri and what we tell LLVM.\r\n```\r\nerror: Undefined Behavior: trying to retag from <3260> for Unique permission at alloc1702[0x0], but that tag does not exist in the borrow stack for this location\r\n  --> test.rs:6:16\r\n   |\r\n6  | pub fn use_foo(foo: Foo) {\r\n   |                ^^^\r\n   |                |\r\n   |                trying to retag from <3260> for Unique permission at alloc1702[0x0], but that tag does not exist in the borrow stack for this location\r\n   |                this error occurs as part of FnEntry retag at alloc1702[0x0..0x4]\r\n   |\r\n   = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental\r\n   = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information\r\nhelp: <3260> was created by a Unique retag at offsets [0x0..0x4]\r\n  --> test.rs:17:17\r\n   |\r\n17 |         use_foo(std::mem::transmute(pair));\r\n   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^\r\nhelp: <3260> was later invalidated at offsets [0x0..0x4] by a Unique retag\r\n  --> test.rs:17:17\r\n   |\r\n17 |         use_foo(std::mem::transmute(pair));\r\n   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n   = note: BACKTRACE:\r\n   = note: inside `use_foo` at test.rs:6:16\r\nnote: inside `main` at test.rs:17:9\r\n  --> test.rs:17:9\r\n   |\r\n17 |         use_foo(std::mem::transmute(pair));\r\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n```",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234778886/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234785633",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234785633",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234785633,
    "node_id": "IC_kwDOAAsO6M5JmVVh",
    "user": {
      "login": "felix91gr",
      "id": 11747623,
      "node_id": "MDQ6VXNlcjExNzQ3NjIz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11747623?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/felix91gr",
      "html_url": "https://github.com/felix91gr",
      "followers_url": "https://api.github.com/users/felix91gr/followers",
      "following_url": "https://api.github.com/users/felix91gr/following{/other_user}",
      "gists_url": "https://api.github.com/users/felix91gr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/felix91gr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/felix91gr/subscriptions",
      "organizations_url": "https://api.github.com/users/felix91gr/orgs",
      "repos_url": "https://api.github.com/users/felix91gr/repos",
      "events_url": "https://api.github.com/users/felix91gr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/felix91gr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T21:09:07Z",
    "updated_at": "2022-09-01T21:09:07Z",
    "body": "@RalfJung question: say we don't make it UB. Then, what can we do wrt `noalias`?\r\n\r\nIn scenarios like your counterexample, emitting `noalias` becomes UB. Or at least it would be UB from the point of view of LLVM, I think. Is that okay?\r\n\r\nAlso, tangentially related to this: I think Jeroen Dobbeleare has made large strides in the provenance model and semantics required for alias analysis inside of LLVM. He's been working on this for the past 2-3 years. Lemme go to the computer and see what I can find. \r\nAm I correct in thinking that LLVM's semantics affect what we consider UB as well?",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234785633/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234812686",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234812686",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234812686,
    "node_id": "IC_kwDOAAsO6M5Jmb8O",
    "user": {
      "login": "cuviper",
      "id": 36186,
      "node_id": "MDQ6VXNlcjM2MTg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cuviper",
      "html_url": "https://github.com/cuviper",
      "followers_url": "https://api.github.com/users/cuviper/followers",
      "following_url": "https://api.github.com/users/cuviper/following{/other_user}",
      "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions",
      "organizations_url": "https://api.github.com/users/cuviper/orgs",
      "repos_url": "https://api.github.com/users/cuviper/repos",
      "events_url": "https://api.github.com/users/cuviper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cuviper/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T21:43:08Z",
    "updated_at": "2022-09-01T21:43:08Z",
    "body": "@RalfJung working from your example, even this is bad according to miri:\r\n\r\n```rust\r\nfn noalias(_: &mut u32, _: &mut u32) {}\r\n\r\npub fn use_foo(foo: &mut Foo) {\r\n    let Foo { r1, r2 } = foo;\r\n    noalias(r1, r2);\r\n}\r\n```\r\n\r\n```\r\nerror: Undefined Behavior: not granting access to tag <3104> because incompatible item [Unique for <3105>] is protected by call 944\r\n  --> src/main.rs:6:1\r\n   |\r\n6  | fn noalias(_: &mut u32, _: &mut u32) {}\r\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not granting access to tag <3104> because incompatible item [Unique for <3105>] is protected by call 944\r\n   |\r\n   = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental\r\n   = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information\r\nhelp: <3104> was created by a SharedReadWrite retag at offsets [0x0..0x4]\r\n  --> src/main.rs:10:17\r\n   |\r\n10 |     noalias(r1, r2);\r\n   |                 ^^\r\nhelp: <3104> was protected due to <3095> which was created here\r\n  --> src/main.rs:10:13\r\n   |\r\n10 |     noalias(r1, r2);\r\n   |             ^^\r\nhelp: this protector is live for this call\r\n  --> src/main.rs:6:1\r\n   |\r\n6  | fn noalias(_: &mut u32, _: &mut u32) {}\r\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n   = note: backtrace:\r\n   = note: inside `noalias` at src/main.rs:6:1\r\nnote: inside `use_foo` at src/main.rs:10:5\r\n  --> src/main.rs:10:5\r\n   |\r\n10 |     noalias(r1, r2);\r\n   |     ^^^^^^^^^^^^^^^\r\nnote: inside `main` at src/main.rs:18:9\r\n  --> src/main.rs:18:9\r\n   |\r\n18 |         use_foo(std::mem::transmute(&mut pair));\r\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nnote: some details are omitted, run with `MIRIFLAGS=-Zmiri-backtrace=full` for a verbose backtrace\r\n```\r\n\r\nBut my change was only in safe code! Which says to me that the `unsafe` block is unsound, no?",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234812686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234824591",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234824591",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234824591,
    "node_id": "IC_kwDOAAsO6M5Jme2P",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T21:57:51Z",
    "updated_at": "2022-09-01T21:59:43Z",
    "body": "@felix91gr \r\n> In scenarios like your counterexample, emitting noalias becomes UB. Or at least it would be UB from the point of view of LLVM, I think. Is that okay?\r\n\r\nEmitting noalias where? noalias is a by-value annotation, and the reason the example is tricky is that it is talking about aliasing of a reference *behind a reference*.\r\n\r\nBut in general, yes -- emitting incorrect LLVM annotations, that lead to LLVM UB in programs without Rust UB, is a bug in rustc codegen. I wouldn't say \"emitting noalias is UB\" (that's a category error -- Rust/LLVM programs have UB, not the act of generating them), but emitting noalias is wrong and the generated LLVM IR is not a correct compilation of the source Rust code (because the target LLVM IR has UB for executions that are fine in the source Rust code).\r\n\r\n> Am I correct in thinking that LLVM's semantics affect what we consider UB as well?\r\n\r\nWell, to an extent, yes, but in general we keep this to a minimum. We'd rather define and design the Rust semantics to make sense on their own, and then find ways to convey the information our choices grant the compiler (i.e., the UB we specify) to LLVM, and work with the LLVM people where that is not yet possible. LLVM is not the only backend Rust will ever have, and LLVM has plenty of idiosyncracies that it inherits from C, which IMO should not affect Rust semantics. But in cases where we think LLVM is designed well, it certainly makes sense to be inspired by its specification. And in cases where LLVM does not give us the freedom we need, sometimes we are [forced to choose a Rust semantics that we don't like](https://rust-lang.zulipchat.com/#narrow/stream/187780-t-compiler.2Fwg-llvm/topic/.60getelementptr.20nowrap.60).\r\n\r\nI have seen mentions of those efforts to re-do the noalias/restrict specification in LLVM, and I am curious to see what will come out of them. I am not sure if that is related to what you talk about though -- so far I have seen basically no work at all (except for my own) that talks very much about the provenance model of LLVM. The LangRef does not mention provenance and [bugs that obviously violate basically any kind of provenance model remain unfixed for years](https://github.com/llvm/llvm-project/issues/34577). I would be delighted to hear that LLVM officially acknowledges the existence of provenance and hope that means there is a chance for these bugs to be finally fixed. :D\r\n\r\n@cuviper \r\n> even this is bad according to miri:\r\n\r\nYes, here you are explicitly going below the double-indirection -- this is very similar to [my example from earlier](https://github.com/rust-lang/rust/issues/16515#issuecomment-1234754189).\r\n\r\n> Which says to me that the unsafe block is unsound, no?\r\n\r\n\"soundness of an unsafe block\" is not a well-defined term -- soundness is a term that applies to the safe public API surface of a library. Inside a module that contains any unsafe code, it is [fairly common that safe code can introduce UB](https://www.ralfj.de/blog/2016/01/09/the-scope-of-unsafe.html).",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234824591/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234847725",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1234847725",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1234847725,
    "node_id": "IC_kwDOAAsO6M5Jmkft",
    "user": {
      "login": "felix91gr",
      "id": 11747623,
      "node_id": "MDQ6VXNlcjExNzQ3NjIz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11747623?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/felix91gr",
      "html_url": "https://github.com/felix91gr",
      "followers_url": "https://api.github.com/users/felix91gr/followers",
      "following_url": "https://api.github.com/users/felix91gr/following{/other_user}",
      "gists_url": "https://api.github.com/users/felix91gr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/felix91gr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/felix91gr/subscriptions",
      "organizations_url": "https://api.github.com/users/felix91gr/orgs",
      "repos_url": "https://api.github.com/users/felix91gr/repos",
      "events_url": "https://api.github.com/users/felix91gr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/felix91gr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-01T22:22:37Z",
    "updated_at": "2022-09-01T22:23:18Z",
    "body": "> I would be delighted to hear that LLVM officially acknowledges the existence of provenance and hope that means there is a chance for these bugs to be finally fixed. :D\r\n\r\nThey absolutely do! Down below I'll put links that might interest you in that regard :)\r\n\r\n> I have seen mentions of those efforts to re-do the noalias/restrict specification in LLVM, and I am curious to see what will come out of them. I am not sure if that is related to what you talk about though -- so far I have seen basically no work at all (except for my own) that talks very much about the provenance model of LLVM. The LangRef does not mention provenance and https://github.com/llvm/llvm-project/issues/34577. \r\n\r\nOh yes. The documentation is lacking, so very much. I was once in a call actually with Jeroen and other folks who work on this, and asked about it. J said that... basically yes, the docs are pretty outdated and incomplete, and that nobody was really working on them :cry: \r\n\r\nBasically a lot of the current knowledge about these details is living inside oral tradition more than anything else.\r\n\r\n> that's a category error -- Rust/LLVM programs have UB, not the act of generating them\r\n\r\nWhoops. Thank you for correcting me on that :)\r\n\r\n---\r\n\r\nHere are the links I promised above.\r\n\r\n1) There is a public Alias Analysis (and pointer provenance) call every 4 weeks. The notes reside here: https://docs.google.com/document/d/17U-WvX8qyKc3S36YUKr3xfF-GHunWyYowXbxEdpHscw/edit#\r\n\r\nIn the older notes down below, I worked last year or so on tidying them up and in general, in making them more accessible. I have yet to go through the newer ones ^^.\r\n\r\n2) On November last year, Jeroen did a presentation on his (then, current) work on AA and provenance: https://www.youtube.com/watch?v=Uz_Xt-CctKc\r\nI think it's pretty good and that maybe it can help answer a lot of your questions regarding both topics :)\r\n\r\nI have to read through the notes again, since now I understand provenance a lot better than I used to.\r\nBut going through the most recent notes, there's a lot I see there that reminds me of Gankra's recent writings on provenance. I think Jeroen is working towards a very similar goal, which is super encouraging.\r\n\r\nCheers :slightly_smiling_face: ",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1234847725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1235137377",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1235137377",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1235137377,
    "node_id": "IC_kwDOAAsO6M5JnrNh",
    "user": {
      "login": "nikic",
      "id": 216080,
      "node_id": "MDQ6VXNlcjIxNjA4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikic",
      "html_url": "https://github.com/nikic",
      "followers_url": "https://api.github.com/users/nikic/followers",
      "following_url": "https://api.github.com/users/nikic/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikic/subscriptions",
      "organizations_url": "https://api.github.com/users/nikic/orgs",
      "repos_url": "https://api.github.com/users/nikic/repos",
      "events_url": "https://api.github.com/users/nikic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikic/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-02T06:54:04Z",
    "updated_at": "2022-09-02T06:54:04Z",
    "body": "> I have seen mentions of those efforts to re-do the noalias/restrict specification in LLVM, and I am curious to see what will come out of them. I am not sure if that is related to what you talk about though -- so far I have seen basically no work at all (except for my own) that talks very much about the provenance model of LLVM. The LangRef does not mention provenance and [bugs that obviously violate basically any kind of provenance model remain unfixed for years](https://github.com/llvm/llvm-project/issues/34577). I would be delighted to hear that LLVM officially acknowledges the existence of provenance and hope that means there is a chance for these bugs to be finally fixed. :D\r\n\r\nWhile LangRef does not use the term \"provenance\", it obviously does have provenance, as documented in https://llvm.org/docs/LangRef.html#pointer-aliasing-rules. Of course, the actual rules specified there are both incorrect (the inttoptr rule is unlikely to be tenable and does not match optimizer behavior) and incomplete (no mention of type punning) in the area where provenance semantics are tricky (which is incidentally also the area where all the provenance-related bugs are).\r\n\r\nAs for Jeroen's full restrict patches, I don't have particularly high hopes for these, because I think he's not approaching their introduction in the best way, which is why this has been stalled for so long. I expect that trying to introduce the new base model before trying to introducing the provenance side channel optimizations would have gone down a lot better, and allowed for earlier testing and evaluation.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1235137377/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1235215918",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1235215918",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1235215918,
    "node_id": "IC_kwDOAAsO6M5Jn-Yu",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-02T08:22:05Z",
    "updated_at": "2022-09-02T08:25:22Z",
    "body": "@felix91gr \r\nThanks for these links!\r\n\r\nYou might also enjoy my writings on provenance, then. ;) [Part 1](https://www.ralfj.de/blog/2018/07/24/pointers-and-bytes.html), [Part 2](https://www.ralfj.de/blog/2020/12/14/provenance.html), [Part 3](https://www.ralfj.de/blog/2022/04/11/provenance-exposed.html).\r\n\r\n@nikic \r\n> While LangRef does not use the term \"provenance\", it obviously does have provenance, as documented in https://llvm.org/docs/LangRef.html#pointer-aliasing-rules.\r\n\r\nA lot of these could be explained with an \"emergent\" notion of provenance, where provenance is just used to talk about static analysis facts that can be deduced from the operational semantics. It is not clear to me that this acknowledges the existence of provenance as a concept in the operational semantics. (After all, that document is somewhat similar to C, and I would not say that the C standard acknowledges the existence of provenance.)",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1235215918/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1236006475",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1236006475",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1236006475,
    "node_id": "IC_kwDOAAsO6M5Jq_ZL",
    "user": {
      "login": "archshift",
      "id": 5377832,
      "node_id": "MDQ6VXNlcjUzNzc4MzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377832?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/archshift",
      "html_url": "https://github.com/archshift",
      "followers_url": "https://api.github.com/users/archshift/followers",
      "following_url": "https://api.github.com/users/archshift/following{/other_user}",
      "gists_url": "https://api.github.com/users/archshift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/archshift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/archshift/subscriptions",
      "organizations_url": "https://api.github.com/users/archshift/orgs",
      "repos_url": "https://api.github.com/users/archshift/repos",
      "events_url": "https://api.github.com/users/archshift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/archshift/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-03T00:47:01Z",
    "updated_at": "2022-09-03T00:47:01Z",
    "body": "@RalfJung it seems bizarre to me that the example I gave (and the counter example you ran through miri) are \"sanctioned\" forms of aliasing under stacked borrows. This goes against the commonly taught mental model of \"creating (via `unsafe`) multiple concurrently used unshared borrows to the same data is UB\", and precludes optimizations that I think most rust users would expect.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1236006475/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1236065729",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1236065729",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1236065729,
    "node_id": "IC_kwDOAAsO6M5JrN3B",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-09-03T07:19:34Z",
    "updated_at": "2022-09-03T07:19:34Z",
    "body": "The mental model we teach is an overapproximation of the actual rules, which are still open. The rules proposed by Stacked Borrows already rule out some unsafe code patterns that are frequently found in the wild, meaning Rust programmers expect both less strict rules and even more strict rules. There is a fundamental tension here and we will end up meeting somewhere in the middle.\n\nBut I doubt we will end up with a model that makes aliasing requirements for nested references. There has not been a credible proposal for how to even do that in a systematic way.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1236065729/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1326945496",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1326945496",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1326945496,
    "node_id": "IC_kwDOAAsO6M5PF5TY",
    "user": {
      "login": "felix91gr",
      "id": 11747623,
      "node_id": "MDQ6VXNlcjExNzQ3NjIz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11747623?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/felix91gr",
      "html_url": "https://github.com/felix91gr",
      "followers_url": "https://api.github.com/users/felix91gr/followers",
      "following_url": "https://api.github.com/users/felix91gr/following{/other_user}",
      "gists_url": "https://api.github.com/users/felix91gr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/felix91gr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/felix91gr/subscriptions",
      "organizations_url": "https://api.github.com/users/felix91gr/orgs",
      "repos_url": "https://api.github.com/users/felix91gr/repos",
      "events_url": "https://api.github.com/users/felix91gr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/felix91gr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-11-25T02:01:20Z",
    "updated_at": "2022-11-25T02:01:20Z",
    "body": "I believe this update posted by Jeroen Dobbelaere after the recent LLVM roundtable is relevant to this thread https://discourse.llvm.org/t/aa-ptr-provenance-full-restrict-llvm-dev-round-table-summary/66722\r\n\r\nTLDR: the LLVM machinery to enable full alias analysis and optimizations seems to be closing in to the last stretch.\r\n\r\nJeroen has been working on this feature for the last couple of years, and progress on the review of his patches has been slow.\r\n\r\nAt the roundtable though, there was unanimous agreement from the participants for the need to add these patches to LLVM, which is very good news to me. There were also reports from Google, who spent time extensively testing the feature, who said that to their eyes it seemed solid.\r\n\r\nAnyway, thought it might be useful for some of y'all to have an update on how things are going on the backend side. Have a good weekend! :heart:\r\n\r\n(PS: I'm sorry I pinged a lot of you at the wrong thread aaaaa)",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1326945496/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1337888244",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-1337888244",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 1337888244,
    "node_id": "IC_kwDOAAsO6M5Pvo30",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-12-05T18:15:03Z",
    "updated_at": "2022-12-05T18:15:03Z",
    "body": "Now we just need someone to figure out how that patchset relates to Stacked Borrows. :)",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1337888244/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2543077349",
    "html_url": "https://github.com/rust-lang/rust/issues/16515#issuecomment-2543077349",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16515",
    "id": 2543077349,
    "node_id": "IC_kwDOAAsO6M6XlEfl",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-12-14T12:03:28Z",
    "updated_at": "2024-12-14T12:04:03Z",
    "body": "If my understanding of LLVM noalias scopes is correct, using them for Rust is non-trivial, at least with our current aliasing models. This is because determining the exact noaliasing scope of a reference can be non-trivial:\n```rust\nlet r = &mut *ptr;\n*r = 13;\nextern_fn();\n*r = 15;\n```\nThe scope does *not* necessarily extend all the way to the end of the function because `extern_fn` may loop forever or unwind, and in those cases both Stacked Borrows and Tree Borrows do allow `r` to be invalidated by operations in `extern_fn` (since `r` is never used again).\n\nWithout a more precise description of what exactly the semantics of noalias scopes are in all conceivable corner cases, it's really hard to say how Rust could use them.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2543077349/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
