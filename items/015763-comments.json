[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49692413",
    "html_url": "https://github.com/rust-lang/rust/issues/15763#issuecomment-49692413",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15763",
    "id": 49692413,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjkyNDEz",
    "user": {
      "login": "apoelstra",
      "id": 1351933,
      "node_id": "MDQ6VXNlcjEzNTE5MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apoelstra",
      "html_url": "https://github.com/apoelstra",
      "followers_url": "https://api.github.com/users/apoelstra/followers",
      "following_url": "https://api.github.com/users/apoelstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/apoelstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
      "organizations_url": "https://api.github.com/users/apoelstra/orgs",
      "repos_url": "https://api.github.com/users/apoelstra/repos",
      "events_url": "https://api.github.com/users/apoelstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apoelstra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-22T02:51:36Z",
    "updated_at": "2014-07-22T03:34:53Z",
    "body": "Hi, I have encountered this bug in the wild. Here it is causing a segfault:\n\n``` rust\n\nuse std::io::IoResult;\nuse std::io::{standard_error, InvalidInput};\n\nfn build_vec_fail() -> IoResult<Vec<uint>> {\n  Err(standard_error(InvalidInput))\n}\n\nfn build_vec() -> IoResult<Vec<uint>> {\n  Ok(vec![])\n}\n\nstruct MyStruct {\n  field1: Vec<uint>,\n  field2: Vec<uint>\n}\n\nfn real_main() -> IoResult<MyStruct> {\n  // This is fine if we assign it to a variable then return the\n  // variable. As written this segfaults.\n  Ok(MyStruct {\n    field1: try!(build_vec()),\n    field2: try!(build_vec_fail()),\n  })\n}\n\nfn main() { real_main(); }\n```\n\nA simple workaround is to assign the return value of `real_main` to a variable, which you return in the next line.\n\n<b>Edit:</b> Oops, I posted the wrong source code! Fixed.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49692413/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49724363",
    "html_url": "https://github.com/rust-lang/rust/issues/15763#issuecomment-49724363",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15763",
    "id": 49724363,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzI0MzYz",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-22T10:56:38Z",
    "updated_at": "2014-07-22T10:56:38Z",
    "body": "This bug causes code like\n\n``` rust\nextern crate serialize;\nuse serialize::json;\n\n#[deriving(Decodable)]\nstruct Foo {\n    field1: String,\n    field2: String\n}\n\nfn main() {\n    let data = r##\"\n    {\n        \"field1\": \"something\",\n        \"non_existing_field\": \"something_else\"\n    }\n    \"##;\n    let _ = json::decode::<Foo>(data.as_slice());\n}\n```\n\nto segfault. It expands to the following, which contains a `return` inside a struct initialiser (causing the `String` destructor of `field1` to misbehave):\n\n``` rust\n#![feature(phase)]\n#![no_std]\n#![feature(globs)]\n#[phase(plugin, link)]\nextern crate std;\nextern crate native;\nextern crate serialize;\nuse std::prelude::*;\nuse serialize::json;\n\nstruct Foo {\n    field1: String,\n    field2: String,\n}\n#[automatically_derived]\nimpl <__D: ::serialize::Decoder<__E>, __E> ::serialize::Decodable<__D, __E>\n     for Foo {\n    fn decode(__arg_0: &mut __D) -> ::std::result::Result<Foo, __E> {\n        __arg_0.read_struct(\"Foo\", 2u,\n                            |_d|\n                                ::std::result::Ok(Foo{field1:\n                                                          match _d.read_struct_field(\"field1\",\n                                                                                     0u,\n                                                                                     |_d|\n                                                                                         ::serialize::Decodable::decode(_d))\n                                                              {\n                                                              Ok(__try_var) =>\n                                                              __try_var,\n                                                              Err(__try_var)\n                                                              =>\n                                                              return Err(__try_var)\n                                                          },\n                                                      field2:\n                                                          match _d.read_struct_field(\"field2\",\n                                                                                     1u,\n                                                                                     |_d|\n                                                                                         ::serialize::Decodable::decode(_d))\n                                                              {\n                                                              Ok(__try_var) =>\n                                                              __try_var,\n                                                              Err(__try_var)\n                                                              =>\n                                                              return Err(__try_var)\n                                                          },}))\n    }\n}\n\nfn main() {\n    let data =\n        r##\"\n    {\n        \"field1\": \"something\",\n        \"non_existing_field\": \"something_else\"\n    }\n    \"##;\n    let _ = json::decode::<Foo>(data.as_slice());\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49724363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49817270",
    "html_url": "https://github.com/rust-lang/rust/issues/15763#issuecomment-49817270",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15763",
    "id": 49817270,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODE3Mjcw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-22T23:59:14Z",
    "updated_at": "2014-07-22T23:59:14Z",
    "body": "Nominating, decoders are pretty important!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49817270/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49825774",
    "html_url": "https://github.com/rust-lang/rust/issues/15763#issuecomment-49825774",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15763",
    "id": 49825774,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODI1Nzc0",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-23T02:19:12Z",
    "updated_at": "2014-07-23T02:19:12Z",
    "body": "Note that this is not P-backcompat-lang.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49825774/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50080195",
    "html_url": "https://github.com/rust-lang/rust/issues/15763#issuecomment-50080195",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15763",
    "id": 50080195,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMDgwMTk1",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-24T21:22:59Z",
    "updated_at": "2014-07-24T21:22:59Z",
    "body": "Assigning P-high, 1.0 milestone.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50080195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50216024",
    "html_url": "https://github.com/rust-lang/rust/issues/15763#issuecomment-50216024",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15763",
    "id": 50216024,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMjE2MDI0",
    "user": {
      "login": "apoelstra",
      "id": 1351933,
      "node_id": "MDQ6VXNlcjEzNTE5MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apoelstra",
      "html_url": "https://github.com/apoelstra",
      "followers_url": "https://api.github.com/users/apoelstra/followers",
      "following_url": "https://api.github.com/users/apoelstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/apoelstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
      "organizations_url": "https://api.github.com/users/apoelstra/orgs",
      "repos_url": "https://api.github.com/users/apoelstra/repos",
      "events_url": "https://api.github.com/users/apoelstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apoelstra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-25T23:48:05Z",
    "updated_at": "2014-07-26T00:16:23Z",
    "body": "Same story with tuples:\n\n``` rust\n\nuse std::io::{IoResult, InvalidInput, standard_error};\n\nfn deserialize() -> IoResult<(Box<uint>, ())> {\n  Ok((try!(Ok(box 0)),\n      try!(Err(standard_error(InvalidInput)))))\n}\n\nfn main() {\n  println!(\"{}\", deserialize());\n}\n```\n\nalso segfaults.\n\n<b>Edit:</b> Here is a maybe more enlightening test case:\n\n``` rust\n\nstruct MyStruct(Box<int>);\n\nimpl Drop for MyStruct {\n  fn drop(&mut self) {\n    let &MyStruct(ref n) = self;\n    println!(\"dropping {}\", n);\n  }\n}\n\nfn foo() -> Result<(MyStruct, MyStruct), MyStruct> {\n  Ok((MyStruct(box 0), try!(Err(MyStruct(box 1)))))\n}\n\nfn main() {\n  foo();\n}\n```\n\nThis outputs `dropping 1` twice and never `dropping 0`. Valgrind shows a double-free.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50216024/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51131610",
    "html_url": "https://github.com/rust-lang/rust/issues/15763#issuecomment-51131610",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15763",
    "id": 51131610,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMTMxNjEw",
    "user": {
      "login": "apoelstra",
      "id": 1351933,
      "node_id": "MDQ6VXNlcjEzNTE5MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1351933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apoelstra",
      "html_url": "https://github.com/apoelstra",
      "followers_url": "https://api.github.com/users/apoelstra/followers",
      "following_url": "https://api.github.com/users/apoelstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/apoelstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apoelstra/subscriptions",
      "organizations_url": "https://api.github.com/users/apoelstra/orgs",
      "repos_url": "https://api.github.com/users/apoelstra/repos",
      "events_url": "https://api.github.com/users/apoelstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apoelstra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-04T23:28:00Z",
    "updated_at": "2014-08-04T23:28:00Z",
    "body": "@luqmana can you rebase and retry this one? It should pass the tests with the recent TCP changes.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51131610/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51147600",
    "html_url": "https://github.com/rust-lang/rust/issues/15763#issuecomment-51147600",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15763",
    "id": 51147600,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMTQ3NjAw",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-05T04:04:18Z",
    "updated_at": "2014-08-05T04:04:18Z",
    "body": "@apoelstra yup! works now!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51147600/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
