[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/135893228",
    "html_url": "https://github.com/rust-lang/rust/issues/28073#issuecomment-135893228",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28073",
    "id": 135893228,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNTg5MzIyOA==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-28T21:31:10Z",
    "updated_at": "2015-08-28T21:31:10Z",
    "body": "Do you think it's a trap even with the BufReader? It's surprisingly good.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/135893228/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/135895861",
    "html_url": "https://github.com/rust-lang/rust/issues/28073#issuecomment-135895861",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28073",
    "id": 135895861,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNTg5NTg2MQ==",
    "user": {
      "login": "eefriedman",
      "id": 12769964,
      "node_id": "MDQ6VXNlcjEyNzY5OTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/12769964?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eefriedman",
      "html_url": "https://github.com/eefriedman",
      "followers_url": "https://api.github.com/users/eefriedman/followers",
      "following_url": "https://api.github.com/users/eefriedman/following{/other_user}",
      "gists_url": "https://api.github.com/users/eefriedman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eefriedman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eefriedman/subscriptions",
      "organizations_url": "https://api.github.com/users/eefriedman/orgs",
      "repos_url": "https://api.github.com/users/eefriedman/repos",
      "events_url": "https://api.github.com/users/eefriedman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eefriedman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-28T21:46:49Z",
    "updated_at": "2015-08-28T21:46:49Z",
    "body": "The performance with BufReader seems fine... the problem is really the performance without BufReader.\n\nActually, hmm... maybe the implementation of bytes() for File should build a BufReader?  That seems a little awkward, but I guess it's potentially workable.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/135895861/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/135950581",
    "html_url": "https://github.com/rust-lang/rust/issues/28073#issuecomment-135950581",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28073",
    "id": 135950581,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNTk1MDU4MQ==",
    "user": {
      "login": "abonander",
      "id": 3198595,
      "node_id": "MDQ6VXNlcjMxOTg1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3198595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/abonander",
      "html_url": "https://github.com/abonander",
      "followers_url": "https://api.github.com/users/abonander/followers",
      "following_url": "https://api.github.com/users/abonander/following{/other_user}",
      "gists_url": "https://api.github.com/users/abonander/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/abonander/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/abonander/subscriptions",
      "organizations_url": "https://api.github.com/users/abonander/orgs",
      "repos_url": "https://api.github.com/users/abonander/repos",
      "events_url": "https://api.github.com/users/abonander/events{/privacy}",
      "received_events_url": "https://api.github.com/users/abonander/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-29T07:11:38Z",
    "updated_at": "2015-08-29T07:16:58Z",
    "body": "I can see where several `Read` impls could be performance traps with this method. Since `impl<R: Read> Iterator for Bytes<R>` essentially reads one byte for each call to `next()`, it can interact poorly with any `Read` impl that isn't tolerant of small, extremely frequent reads--basically exactly what `BufReader` is meant to help with.\n\nThe easiest fix would be to document this on the `Read::bytes()` method to let users know they should use a buffer for some cases. But without any way to warn them directly, a lot of users could still be bitten in the butt by this.\n\n`Bytes<R>` can inherently use `BufReader`, and then `BufReader` can override `Read::bytes()` to return itself in `Bytes` instead of constructing a new `BufReader`. But this will be unnecessary for other `Read` impls that don't need buffering, like `Cursor<Vec<u8>>`. \n\nAnother solution could be to let `Bytes` be dynamically buffered or raw:\n\n``` rust\npub struct Bytes<R> {\n    inner: BytesInner<R>,\n}\n\nenum BytesInner<R> {\n    Raw(R),\n    Buffered(BufReader<R>),\n}\n```\n\nThen the `Read` impl can return `Raw` by default, or be overridden to return `Buffered`. The drawback here is that the enum would have to be matched on with each call to `Bytes::next()`, which would be a bit of a performance hit, though likely not nearly as bad as the performance problem it fixes, and should be ironed out by branch prediction after a few iterations.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/135950581/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/136354535",
    "html_url": "https://github.com/rust-lang/rust/issues/28073#issuecomment-136354535",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28073",
    "id": 136354535,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNjM1NDUzNQ==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-31T12:14:10Z",
    "updated_at": "2015-08-31T12:14:10Z",
    "body": "@cybergeek94 BytesInner sounds good, but I'm not sure if we can actually do it. The problem is that it's a hidden buffer that the user can't recover -- think of the case `reader.by_ref().bytes()`, after iterating only a few bytes, then stopping, the rest of the buffered data is unreachable.\n\nIt's not just about `.bytes()`, it's about non-buffered I/O in general.\n- We need to make it clear to users that files and network streams opened are unbuffered by default.\n- Stdin is buffered. But you have less overhead if you `.lock()` it for multiple operations or for access access to the buffer methods.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/136354535/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/136439803",
    "html_url": "https://github.com/rust-lang/rust/issues/28073#issuecomment-136439803",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28073",
    "id": 136439803,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNjQzOTgwMw==",
    "user": {
      "login": "abonander",
      "id": 3198595,
      "node_id": "MDQ6VXNlcjMxOTg1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3198595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/abonander",
      "html_url": "https://github.com/abonander",
      "followers_url": "https://api.github.com/users/abonander/followers",
      "following_url": "https://api.github.com/users/abonander/following{/other_user}",
      "gists_url": "https://api.github.com/users/abonander/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/abonander/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/abonander/subscriptions",
      "organizations_url": "https://api.github.com/users/abonander/orgs",
      "repos_url": "https://api.github.com/users/abonander/repos",
      "events_url": "https://api.github.com/users/abonander/events{/privacy}",
      "received_events_url": "https://api.github.com/users/abonander/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-31T17:40:12Z",
    "updated_at": "2015-08-31T17:40:12Z",
    "body": "The best solution with the least commitment is to educate the user better about buffers and when to use them.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/136439803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/137572730",
    "html_url": "https://github.com/rust-lang/rust/issues/28073#issuecomment-137572730",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28073",
    "id": 137572730,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNzU3MjczMA==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-03T20:56:45Z",
    "updated_at": "2015-09-03T20:56:45Z",
    "body": "Filing as a doc bug. We talk about this in BufReader, but not Read. Seems bad.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/137572730/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
