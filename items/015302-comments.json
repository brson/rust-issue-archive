[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47716953",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-47716953",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 47716953,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzE2OTUz",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-01T22:28:59Z",
    "updated_at": "2014-07-01T22:28:59Z",
    "body": "@huonw I addressed your comment.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47716953/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47929206",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-47929206",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 47929206,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTI5MjA2",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-03T13:29:27Z",
    "updated_at": "2014-07-03T13:29:27Z",
    "body": "The use case for this is something along the lines of being able to typesafely convert a read `BigEndianU32` to `u32`, like this C code (for little-endian machines).\n\n```\nuint32_t *array;\nsize_t array_length;\nfor(size_t i = 0; i < array_length; i++)\n{\n    uint8_t *bytes = &array[i];\n    array[i] = (bytes[0]<<24) | (bytes[1]<<16) | (bytes[2]<<8) | (bytes[3])\n}\n```\n\nIn Rust with that change it would be:\n\n```\nstruct BigEndianU32(...);\nlet array: Vec<BigEndianU32>;\nlet array: Vec<u32> = array.map_inplace(|x| x.to_u32());\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47929206/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48095580",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-48095580",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 48095580,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDk1NTgw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-05T20:20:46Z",
    "updated_at": "2014-07-05T20:20:46Z",
    "body": "While this seems like a very real problem, adding a specific solution for only the `Vec` container and no other seems like it's not the best solution to take here. Additionally, as noted in the FIXME, there is no static assertion that the two types are of the same size, encouraging dynamic failure, which the standard library in general avoids.\n\nDo you know if it would be possible to extend this to the `map().collect()` pattern in general? This, for example, doesn't work with hash maps, hash sets, tree maps, etc. (which all suffer the same problem).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48095580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48095623",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-48095623",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 48095623,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDk1NjIz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-05T20:22:53Z",
    "updated_at": "2014-07-05T20:22:53Z",
    "body": "There's always the option of just using `mut_iter()`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48095623/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48099276",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-48099276",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 48099276,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDk5Mjc2",
    "user": {
      "login": "heinrich5991",
      "id": 366230,
      "node_id": "MDQ6VXNlcjM2NjIzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/366230?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/heinrich5991",
      "html_url": "https://github.com/heinrich5991",
      "followers_url": "https://api.github.com/users/heinrich5991/followers",
      "following_url": "https://api.github.com/users/heinrich5991/following{/other_user}",
      "gists_url": "https://api.github.com/users/heinrich5991/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/heinrich5991/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/heinrich5991/subscriptions",
      "organizations_url": "https://api.github.com/users/heinrich5991/orgs",
      "repos_url": "https://api.github.com/users/heinrich5991/repos",
      "events_url": "https://api.github.com/users/heinrich5991/events{/privacy}",
      "received_events_url": "https://api.github.com/users/heinrich5991/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-05T23:49:28Z",
    "updated_at": "2014-07-05T23:49:55Z",
    "body": "@thestinger This only works if the source and the target type are the same, `Vec<BigEndianU32>` to `Vec<u32>` wouldn't work.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48099276/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48120033",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-48120033",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 48120033,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MTIwMDMz",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-06T18:59:01Z",
    "updated_at": "2014-07-06T18:59:01Z",
    "body": "@alexcrichton I thought about extending it to other containers, and it looks like this isn't easily possible, as the container's internal memory layout could differ between a `Container<uint>` and a `Container<&uint>`. This could be illustrated by the `SmallIntMap`: Although `uint` and `&uint` have the same size, the representation of the entries in the `SmallIntMap` does not, as the `SmallIntMap` uses `Option<T>` internally, making `SmallIntMap<uint>` not convertible in place to `SmallIntMap<&uint>`.\n\nThat being said, the general pattern could be applied to different containers as well, such as for the keys of a hashmap, the entries of a linked list, the keys in a tree, etc.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48120033/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48130460",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-48130460",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 48130460,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MTMwNDYw",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-06T23:30:59Z",
    "updated_at": "2014-07-06T23:30:59Z",
    "body": "Is it useful to expose the `PartialVec` as part of public API? Can it be enough to only provide map-inplace?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48130460/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48181686",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-48181686",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 48181686,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MTgxNjg2",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-07T14:01:53Z",
    "updated_at": "2014-07-07T14:01:53Z",
    "body": "Yes, that would work too.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48181686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49581579",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49581579",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49581579,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTgxNTc5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T08:26:26Z",
    "updated_at": "2014-07-21T08:26:26Z",
    "body": "I'm not a fan of the usage of `pop()` to remove the first element of the vector. It should perhaps be `shift()` instead.\n\nI'd also love to see the zero-sized type restriction lifted. An `if` condition testing for a zero-size type on every function should allow you to deal with this, e.g. by repurposing the pointers as counters instead. It should be compiled away during monomorphization so each instance of `PartialVec` only contains the correct code (the zero-sized type vs the non-zero-sized type).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49581579/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49584381",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49584381",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49584381,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTg0Mzgx",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T09:04:19Z",
    "updated_at": "2014-07-21T09:04:19Z",
    "body": "As for generalizing this to other containers, it could actually theoretically work for any container that has the following invariants:\n1. The `Drop` impl for the container drops all the elements and deallocates any allocated memory, and does nothing else.\n2. The container provides some equivalent of `set_len(0)` that causes the `Drop` impl to merely deallocate allocated memory.\n3. The container provides an `Iterator<&mut T>` iterator. The method that provides it does not mutate the container, and calling `.next()` on the iterator does not mutate the container.\n4. The mutable iterator yields the same sequence of elements every time, if the container has not been otherwise mutated\n\nGiven this, the `PartialVec` impl could use a counter to keep track of how many elements it's popped or pushed, and maintain two parallel mutable iterators (which unfortunately does violate the lifetime system, but I believe it's safe given the above invariants), one for elements to read from and one for slots to write to. Given the counters and the iterators, it can then handle traversing arbitrary container structures to rewrite the elements, and similarly handle traversing the container to destruct the elements.\n\nThis does require less obviously-safe code, of course. And I am a bit uncomfortable about maintaining parallel iterators like that, because if the iterator uses a `&mut` reference internally then it's technically a violation of the aliasing rules, but since it never actually writes through that `&mut` reference then I think it's not UB. The individual `&mut T` references yielded by the iterator would in fact be ensured to remain unique. This whole issue could also be avoided by using `RandomAccessIterator` instead, but that would severely limit the collections this would work with.\n\nAnd of course there's no way for the compiler to enforce the above invariants. A trait would have to be written that documents the invariants (and provides the relevant methods), and all implementors would have to be sure they meet said invariants.\n\nFor the trait itself, HKTs would be extremely helpful in representing the type signature, but they're not actually necessary. If the trait takes two type parameters, the \"from\" container type and the \"to\" container type, then it can work. In fact, this would actually let you map between two disparate container definitions if they use the same memory layout under the hood (and opted in to this via the trait conformance). Unfortunately, due to the need for defining a `mut_iter()` function, the type signature of the trait gets extremely complicated, and would look something like:\n\n``` rust\npub trait InPlaceIterable<'a, T, It: Iterator<&'a mut T>> {\n    fn in_place_mut_iter(&'a mut self) -> It;\n}\n\n/// Implementors of this trait must follow the documented invariants.\n/// Any implementor of this trait will also need to implement\n/// InPlaceIterable to actually be useful\npub trait InPlaceMappable {\n    fn ensure_drop_no_elements(&mut self); // set_len(0)\n}\n\n// C_T is the \"source\" collection, e.g. Vec<T>\n// C_U is the \"destination\" collection e.g. Vec<U>\npub struct PartialMapper<C_T, C_U> { ... }\n\nimpl<'a, T, U, T_It: Iterator<&'a mut T>,\n        C_T: InPlaceIterable<'a, T, T_It> + InPlaceMappable,\n        // C_U doesn't need InPlaceIterable because we only construct iterators from\n        // C_T, and transmute the &mut T to &mut U as necessary.\n        // Similarly it doesn't need InPlaceMappable\n        C_U> PartialMapper<C_T, C_U> {\n    pub fn new(source: C_T) -> PartialMapper<C_T, C_U> { ... }\n    pub fn to_dest(self) -> C_U { ... }\n    pub fn shift(&mut self) -> Option<T> { ... }\n    pub fn push(&mut self, val: U) { ... }\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49584381/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49611652",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49611652",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49611652,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjExNjUy",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T14:23:53Z",
    "updated_at": "2014-07-21T14:23:53Z",
    "body": "@kballard I have explained above why it can't work unless we know the internal memory layout of the container, see for example `SmallIntMap`. If you add to your requirements that the elements of `T` are laid out in memory as simple instances of `T`, that's fine, but once it's something like `Option<T>` it won't work anymore.\n\nOtherwise, this still has some problems. What about containers that keep their elements sorted, or hashed, like HashSet, some kind of binary tree or else. In the end it looks like this can almost only meaningfully be supported for `Vec`-like structures.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49611652/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49645180",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49645180",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49645180,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjQ1MTgw",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T18:27:20Z",
    "updated_at": "2014-07-21T18:27:20Z",
    "body": "@tbu- Well, it can work for any container that can vend an `Iterator<&mut T>`. You're right that things like `SmallIntMap` and containers that sort based on value can't do that, but you could e.g. use this to map the value type of a `HashMap<K,V>` (you wouldn't be able to use the key in the mapping though). Similarly, you could use this for things like `DList`.\n\nThat said, I think you're right in assuming that `Vec` is the primary use-case for this kind of functionality.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49645180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49653959",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49653959",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49653959,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjUzOTU5",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T19:33:24Z",
    "updated_at": "2014-07-21T19:33:24Z",
    "body": "@kballard It doesn't really work for `SmallIntMap` which _can_ (could) give out an `Iterator<&mut T>` (the `Option` thing is not preventing it, you can get a `Option<&mut T>` from a `Option<T>`.\n\nBut you're right that it could be useful for `DList` or even on the values of a `HashMap`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49653959/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49661833",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49661833",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49661833,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjYxODMz",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T20:37:12Z",
    "updated_at": "2014-07-21T20:37:12Z",
    "body": "@tbu- I was making assumptions about `SmallIntMap` based on your claim that it doesn't work, but looking at how `SmallIntMap` works, well, theoretically in a perfect world it would work. But AFAIK, it can't work only due to the null-pointer optimization, e.g. if either `T` XOR `U` are null-pointer-optimized then the layout of `Option<T>` and `Option<U>` would differ. This could theoretically be asserted at runtime by an `InPlaceMappable` method that is designed for this purpose, but the addition of yet more runtime failure is really unfortunate (especially as the runtime failure would differ for types that care about null-pointer-optimization vs types that don't).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49661833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49662231",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49662231",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49662231,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjYyMjMx",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T20:39:53Z",
    "updated_at": "2014-07-21T20:39:53Z",
    "body": "Incidentally, the `size_of` assertions are actually wrong, they need to be `min_align_of` instead, as that's what `Vec` actually uses for the stride between two elements.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49662231/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49673580",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49673580",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49673580,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjczNTgw",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T22:13:42Z",
    "updated_at": "2014-07-21T22:13:42Z",
    "body": "@kballard I don't think so:\n\n```\npub fn with_capacity(capacity: uint) -> Vec<T> {\n    [...] {\n        let size = capacity.checked_mul(&mem::size_of::<T>())\n                           .expect(\"capacity overflow\");\n        let ptr = unsafe { allocate(size, mem::min_align_of::<T>()) };\n        Vec { len: 0, cap: capacity, ptr: ptr as *mut T }\n    }\n}\n```\n\nThe `mem::min_align_of::<T>()` parameter of `allocate` seems to be the `alignment`:\n\n```\npub unsafe fn allocate(size: uint, align: uint) -> *mut u8;\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49673580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49676121",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49676121",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49676121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Njc2MTIx",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T22:41:22Z",
    "updated_at": "2014-07-21T22:41:22Z",
    "body": "@kballard It's not just null-pointer optimization btw, we have also have unspecified struct layout, so other enum optimizations could come.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49676121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49681237",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49681237",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49681237,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjgxMjM3",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T23:46:11Z",
    "updated_at": "2014-07-21T23:46:11Z",
    "body": "@tbu- Err yeah, you're right, I misinterpreted. It's not used as the stride between two elements. But it _is_ used. So I guess you need to assert that both `size_of` _and_ `min_align_of` are the same for `T` and `U`, otherwise deallocation of the resulting `Vec` will be wrong.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49681237/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49681779",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49681779",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49681779,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjgxNzc5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T23:53:54Z",
    "updated_at": "2014-07-21T23:53:54Z",
    "body": "@tbu- I'm actually unclear on how the unspecified struct layout is supposed to behave in the face of type parameters. On the one hand, transmuting between differently-parameterized variants of the same type assumes that the layout is stable for all type parameters, but on the other hand, allowing the layout to differ depending on the parameters is a potential optimization that we'd like to have.\n\nAssuming that the layout is not required to be stable for all possible parameters to a type, it's actually technically not even correct to transmute between `Vec<T>` and `Vec<U>`. There's no good reason for the layouts to differ as the type parameter is hidden behind a pointer, but that doesn't mean it's correct to assume the layout is stable.\n\nGiven that, I think that you need to verify what guarantees are made about the layout of generic types. If the layout of `Vec<T>` and `Vec<U>` cannot actually be guaranteed to be stable (according to the rules, rather than the current compiler implementation), then I think you're going to have to submit an RFC to modify the struct layout guarantees to guarantee that the layout is the same for all pairs of instances `Type<T>` and `Type<U>` where `size_of::<T>() = size_of::<U>()` and `min_align_of::<T>() == min_align_of::<U>()`. Those two requirements are the ones you're relying on already (well, you're relying on size right now, but you need to rely on min align as well). They're also required in order to transmute between two versions of the struct where the type is used directly, although I'm pretty sure that right now it's a compiler error to use `transmute()` when a type parameter can influence the size of the overall type.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49681779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49681884",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49681884",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49681884,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjgxODg0",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T23:55:34Z",
    "updated_at": "2014-07-21T23:55:34Z",
    "body": "I think it would be very reasonable for `Vec` to have a fixed layout. There's not much reordering the fields of a `Vec` will do in terms of optimisation.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49681884/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49682238",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49682238",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49682238,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjgyMjM4",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-22T00:00:31Z",
    "updated_at": "2014-07-22T00:00:31Z",
    "body": "@kballard That `Vec` transmute can be fixed, get the raw parts ([not possible with destructuring](http://discuss.rust-lang.org/t/destructuring-structs-which-implement-drop/137) unfortunately, needs to be done manually), `forget` the old `Vec` and construct a new one.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49682238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49684192",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49684192",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49684192,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Njg0MTky",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-22T00:28:41Z",
    "updated_at": "2014-07-22T00:28:41Z",
    "body": "@tbu- True, you can build from raw parts. If you're doing that as a transmute-equivalent you will need to make sure that e.g. `.as_mut_ptr()` actually always returns the underlying pointer. Right now it does, but until very recently it actually returned different values depending on whether the element was a zero size. I promoted getting this fixed, but if you're going to rely on it you'll probably want to add a comment to the `as_ptr()` and `as_mut_ptr()` methods documenting that they _must_ return the pointer field as-is.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49684192/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49684327",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-49684327",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 49684327,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Njg0MzI3",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-22T00:30:28Z",
    "updated_at": "2014-07-22T00:30:28Z",
    "body": "Of course, you could also have `InPlaceMappable` take the destination type and provide `fn xmute(self) -> C_U;` itself, thus requiring that the type ensure that the transformation is valid.\n\nAt this point I'm going to stop talking about how we could theoretically do this for arbitrary collections. I do like exploring the topic, but I'm uncomfortable with the number of invariants that the compiler is unable to check, and as you pointed out most collections actually can't take advantage of this.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49684327/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51343412",
    "html_url": "https://github.com/rust-lang/rust/pull/15302#issuecomment-51343412",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15302",
    "id": 51343412,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMzQzNDEy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-06T14:38:36Z",
    "updated_at": "2014-08-06T14:38:36Z",
    "body": "Closing due to inactivity, but feel free to reopen with a rebase!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51343412/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
