[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29633940",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-29633940",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 29633940,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjMzOTQw",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-02T16:43:41Z",
    "updated_at": "2013-12-02T16:43:41Z",
    "body": "I am of two minds on this issue.\n\nOne part of me likes simple rules of thumb like: \"eschew fn foo(~self); do foo(self) instead.\" (as noted on niko's [Thoughts on DST part I](http://smallcultfollowing.com/babysteps/blog/2013/11/26/thoughts-on-dst-1/)).  So that part of me would like such methods to actually be supported on object types.\n\nAnother part of me likes to have a simplified compilation model in my mind, with as little magic as possible (or at least the _potential_ for ALMAP ... I am after all still a GC guy...).  And that part of me figures we should keep things the way that they are; if you want a method to be invokable on the objects of a trait, then the type for the self pointer needs to be reflected in the method's type, including which kind of pointer it is.\n\n---\n\nHaving said that, I haven't thought of a concrete reason to disallow the generalization suggested here, beyond mental complexity when trying to understand the control flow from the invocation point to the entry to the method itself.\n\nFor which pointer-variants would we generate these shim functions?  Will it only work for `~Trait` objects?  Seeing as how we are taking `self` by value, it seems like we could get into trouble if we allow it for `&Trait` and even `&mut Trait` (especially since `self` might have non-copyable state, and so implicitly loading a copy from `&mut Trait` seems bad).\n\nOr is this something that we can infer on a impl by impl basis, choosing the most general option that is sound?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29633940/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29644843",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-29644843",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 29644843,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjQ0ODQz",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-02T18:41:10Z",
    "updated_at": "2013-12-02T18:41:10Z",
    "body": "On Mon, Dec 02, 2013 at 08:43:47AM -0800, Felix S Klock II wrote:\n\n> Another part of me likes to have a simplified compilation model in\n> my mind, with as little magic as possible (or at least the\n> _potential_ for ALMAP ... I am after all still a GC guy...).\n\nIn general I agree, but, if we don't wind up with a DST-based system,\nthis makes it impossible to have an object method that \"gives up\" the\nvalue without a double-`~`. That seems pretty bad. I also don't\nconsider simple adaptation methods in the vtable to be particularly magic.\n\n> For which pointer-variants would we generate these shim functions?\n> Will it only work for `~Trait` objects?  Seeing as how we are taking\n> `self` by value, it seems like we could get into trouble if we allow\n> it for `&Trait` and even `&mut Trait` (especially since `self` might\n> have non-copyable state, and so implicitly loading a copy from `&mut\n> Trait` seems bad).\n\nAs magic goes, what I proposed is pretty minimal. Basically a variant\nwhere the `self` pointer is _always_ taken indirectly -- to put another\nway, it'd be roughly equivalent to:\n\n```\nfn shim(self: *Self, ...) {\n    unsafe { actual(*self, ...) }\n}\n```\n\nThat said, this interacts with the smart pointers. I outlined some\ndetails [in a recent blog post](http://smallcultfollowing.com/babysteps/blog/2013/12/02/thoughts-on-dst-4/).  In particular supporting types\nlike `Smaht<T>` may require generating shims for each method that\nperform the necessary derefs, in which case handling `fn(self)`\nmight get folded in.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29644843/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29666384",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-29666384",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 29666384,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjY2Mzg0",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-02T22:48:54Z",
    "updated_at": "2013-12-02T22:48:54Z",
    "body": "I have closed #9893 in favor of this bug, but if this bug is rejected then that bug should be re-opened (because the error message today isn't exactly ideal).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29666384/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29939937",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-29939937",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 29939937,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTM5OTM3",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-05T21:28:46Z",
    "updated_at": "2013-12-05T21:28:46Z",
    "body": "As part of another discussion, I realized that this is a special case of a more general sort of pointer. For want of a better name, I'll call it a \"my\" pointer: `my 'a T` -- this kind of pointer would mean that you own the referent of the pointer, but not the memory itself. In other words, you are obligated to free the `T`, but not the memory where the `T` is stored -- that memory will be otherwise freed sometime after the end of lifetime `'a`.\n\nSo the \"adapter\" methods I described for `fn(self)` are really accepting a `fn(my self)` -- you get to use the contents of the memory, but the memory itself you do not own.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29939937/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29981320",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-29981320",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 29981320,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTgxMzIw",
    "user": {
      "login": "glaebhoerl",
      "id": 1216629,
      "node_id": "MDQ6VXNlcjEyMTY2Mjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1216629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glaebhoerl",
      "html_url": "https://github.com/glaebhoerl",
      "followers_url": "https://api.github.com/users/glaebhoerl/followers",
      "following_url": "https://api.github.com/users/glaebhoerl/following{/other_user}",
      "gists_url": "https://api.github.com/users/glaebhoerl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glaebhoerl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glaebhoerl/subscriptions",
      "organizations_url": "https://api.github.com/users/glaebhoerl/orgs",
      "repos_url": "https://api.github.com/users/glaebhoerl/repos",
      "events_url": "https://api.github.com/users/glaebhoerl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glaebhoerl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-06T11:20:36Z",
    "updated_at": "2013-12-06T11:20:58Z",
    "body": "Is this the same mythical pointer type that's needed to make once stack closures as DSTs work? (Maybe that's what the `my` stands for?;)\n\nI think it makes sense to view this as a natural progression on `&` and `&mut`: with `&` you can only read, `&mut` gives you permission to write, and this new one (`&my`? `&once`? `&take`? `&move`?) also gives you permission to move (and the associated obligation to deinitialize).\n\nI think it also makes sense to think about the converse: a pointer to potentially-unitialized memory which you have the obligation to initialize, corresponding to C#'s concept of an `out` parameter. Presumably once you initialize it, it would go out of scope, and perhaps leave you with an `&mut`. This also happens to be exactly the same thing as the return values on functions, as far as I can tell, just a little more flexible.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29981320/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30017364",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-30017364",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 30017364,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwMDE3MzY0",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-06T18:32:03Z",
    "updated_at": "2013-12-06T18:32:03Z",
    "body": "Yes, i've spent some time thinking about \"obliation to initialize\" -- that is much harder. In particular, that would have to be a _linear_ value -- meaning it could not be 'dropped' (except possibly by failure -- but even there we have to be careful). Currently, though, we assume _all_ values can be dropped, and hence permit generic functions like the following:\n\n```\nfn drop<T>(x: T) { }\n```\n\nand I invoke with a `&out` pointer, that data will never be initialized.\n\nThe natural implication is that either (1) dropping a type parameter must become an explicit operation:\n\n```\nfn drop<T:Drop>(x: T) { ... x.drop() ... }\n```\n\n(Incidentally this only works if `drop()` takes self by-value, I guess, but we could address this somehow) or (2) we need some kind of default bound setup like sized/unsized.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30017364/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30017436",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-30017436",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 30017436,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwMDE3NDM2",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-06T18:32:54Z",
    "updated_at": "2013-12-06T18:32:54Z",
    "body": "I guess that the natural pointer type for `drop()` would be `&my`, actually. It would avoid all the annoying problems we found trying to make drop have time `fn(self)`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30017436/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30057575",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-30057575",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 30057575,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwMDU3NTc1",
    "user": {
      "login": "glaebhoerl",
      "id": 1216629,
      "node_id": "MDQ6VXNlcjEyMTY2Mjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1216629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glaebhoerl",
      "html_url": "https://github.com/glaebhoerl",
      "followers_url": "https://api.github.com/users/glaebhoerl/followers",
      "following_url": "https://api.github.com/users/glaebhoerl/following{/other_user}",
      "gists_url": "https://api.github.com/users/glaebhoerl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glaebhoerl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glaebhoerl/subscriptions",
      "organizations_url": "https://api.github.com/users/glaebhoerl/orgs",
      "repos_url": "https://api.github.com/users/glaebhoerl/repos",
      "events_url": "https://api.github.com/users/glaebhoerl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glaebhoerl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-07T15:46:30Z",
    "updated_at": "2013-12-07T15:47:52Z",
    "body": "You're right, I was sloppy in my thinking about the out-pointer. I was thinking it would error if you reached the end of the function without initializing through it, but that obviously didn't take generic functions into account.\n\nI wonder how many generic functions would actually wind up needing a `Drop` constraint under this scheme. Sounds like it would be a lot, but it's not like I've actually checked - maybe it's less than I assume (or maybe it's more). If the only benefit were having `&out` pointers I'd say it's not remotely worth it, but maybe it would also be helpful/necessary for the existential/erased/higher-rank things.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30057575/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/31961043",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-31961043",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 31961043,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxOTYxMDQz",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-09T18:22:52Z",
    "updated_at": "2014-01-09T18:22:52Z",
    "body": "Not a backcompat risk; so accepting at P-low.  (If one finds more evidence to up its priority, then renominate.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/31961043/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32342797",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-32342797",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 32342797,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMzQyNzk3",
    "user": {
      "login": "glaebhoerl",
      "id": 1216629,
      "node_id": "MDQ6VXNlcjEyMTY2Mjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1216629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glaebhoerl",
      "html_url": "https://github.com/glaebhoerl",
      "followers_url": "https://api.github.com/users/glaebhoerl/followers",
      "following_url": "https://api.github.com/users/glaebhoerl/following{/other_user}",
      "gists_url": "https://api.github.com/users/glaebhoerl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glaebhoerl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glaebhoerl/subscriptions",
      "organizations_url": "https://api.github.com/users/glaebhoerl/orgs",
      "repos_url": "https://api.github.com/users/glaebhoerl/repos",
      "events_url": "https://api.github.com/users/glaebhoerl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glaebhoerl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-15T08:32:31Z",
    "updated_at": "2014-01-28T12:15:07Z",
    "body": "I couldn't fall asleep last night because I was thinking about pointer types; how's that for fun? `&out`, `&mut`, and`&move` (yes, I think that's the right name - goes well with `&mut`) have some fascinating and non-obvious interactions.\n\nAs you alluded to, the problem of `&out` and generics could possibly be resolved, in a worse is better kind of way, by just making its destructor invoke `fail!()`. (As before, assigning through the pointer would count as a move, and thus \"cancel\" it.) When the types are known to the compiler, it can issue a warning or error statically (so similar to how `@mut` was). Certainly not ideal, but possibly a solution. EDIT: I think the precise requirement is that if an `&out 's T` is allowed to die without being assigned through, its destructor must run before the end of the borrow, i.o.w. the lifetime `'s`. The code it was borrowing the `T` from will be prevented from accessing it until after `'s`, so as long as this holds, I think we should be fine.\n\n(I also don't see any reason why making `&out` copyable would be unsafe, it's just that... you would rather not. Its presence is an obligation, and why multiply your obligations? EDIT: Scratch this, this is doubly hogwash if `&out` pointers can turn into `&mut`, as below.)\n\nAs before, after assigning through an `&out` it could leave you with an `&mut`:\n\n```\nfn assign<'s, T>(to: &out 's T, from: &move T) -> &mut 's T\n```\n\nI think this is fine, because if someone lends you an `&out` pointer to their uninitialized memory, even if it's declared immutable, they can't observe whether you've written to it only once or many times before they regain access. (Interestingly, you can safely borrow an `&out` to either uninitialized data of any mutability or to initialized, mutable data, just not to initialized, immutable data.) There's also something like the reverse operation: you can deinitialize an `&mut` if you promise to reinitialize it again before control passes back:\n\n```\nfn take_then_put_back<'s, T>(from: &mut 's T, take: |&move T| once) -> &out 's T\n```\n\nThese two effectively reify the cycling of data between initialized and uninitialized states as a first class abstraction for the programmer.\n\nUsing the above we can implement `swap` in safe code:\n\n```\nfn swap<T>(mut_a: &mut T, mut_b: &mut T) {\n    let mut x: T;\n    let out_x = &out x;\n    // `take_then_put_back` taking a once fn is important so we can move `out_x` into it\n    let out_b = take_then_put_back(mut_b, |move_b| *out_x = *move_b);\n    let out_a = take_then_put_back(mut_a, |move_a| *out_b = *move_a);\n    *out_a = x;\n}\n```\n\nI suspect this means that arbitrary permutations could also be expressed using only safe code.\n\n`&out` is also useful for placement new:\n\n```\nfn emplace_back<'s, T>(self: &mut 's Vec<T>) -> &out 's T\n```\n\nwhere it allocates an element and returns the obligation to initialize it. Smart pointers:\n\n```\nfn new_rc<'s, T>(self: &out 's Rc<T>) -> &out 's T\n```\n\nwhere it initializes the pointer, allocates the box, and returns the obligation to initialize its contents.\n\n(I also suspect it could be used to [tie the knot](https://github.com/mozilla/rust/issues/7082), though I haven't figured out a way to do it without `unsafe`.)\n\nAnyway, I used to think `&out` is just a curiosity, but now I kinda want it.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32342797/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33474855",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-33474855",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 33474855,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDc0ODU1",
    "user": {
      "login": "glaebhoerl",
      "id": 1216629,
      "node_id": "MDQ6VXNlcjEyMTY2Mjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1216629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glaebhoerl",
      "html_url": "https://github.com/glaebhoerl",
      "followers_url": "https://api.github.com/users/glaebhoerl/followers",
      "following_url": "https://api.github.com/users/glaebhoerl/following{/other_user}",
      "gists_url": "https://api.github.com/users/glaebhoerl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glaebhoerl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glaebhoerl/subscriptions",
      "organizations_url": "https://api.github.com/users/glaebhoerl/orgs",
      "repos_url": "https://api.github.com/users/glaebhoerl/repos",
      "events_url": "https://api.github.com/users/glaebhoerl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glaebhoerl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-28T12:44:01Z",
    "updated_at": "2014-01-28T12:44:11Z",
    "body": "@nikomatsakis I'm starting to have second thoughts, not about `&my`/`&move` itself, whose semantics are clear (permits moving out, destructs otherwise), but its interaction with `~T`. You wrote:\n\n> this kind of pointer would mean that you own the referent of the pointer, but not the memory itself. In other words, you are obligated to free the T, but not the memory where the T is stored -- that memory will be otherwise freed sometime after the end of lifetime 'a.\n\nI suppose, if it stays part of the language, we could hardcode this for `~`, but how could this possibly be generalized to library smart pointer types without some kind of runtime drop flag? How could the destructor of a library `Ownedish<T>` know whether or not its contained object has been `&move`d out, and therefore whether to run its destructor and/or whether it is otherwise safe to access?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33474855/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33481378",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-33481378",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 33481378,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDgxMzc4",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-28T14:15:43Z",
    "updated_at": "2014-01-28T14:15:43Z",
    "body": "> I suppose, if it stays part of the language, we could hardcode this for ~, but how could this possibly be generalized to\n> library smart pointer types without some kind of runtime drop flag?\n\nI envisioned a distinct method being called for shallow drop, in this case. Clearly the pointer type would have to opt-in. It's actually already an issue of sorts, in that we would like to be able to move out of smart pointer types.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33481378/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45798430",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-45798430",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 45798430,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1Nzk4NDMw",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-11T20:53:41Z",
    "updated_at": "2014-06-11T20:53:41Z",
    "body": "cc @pcwalton \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45798430/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45798494",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-45798494",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 45798494,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1Nzk4NDk0",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-11T20:54:14Z",
    "updated_at": "2014-06-11T20:54:14Z",
    "body": "Nominating, P-backcompat-lang\u2014needed for unboxed closures to replace `proc()`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45798494/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45949745",
    "html_url": "https://github.com/rust-lang/rust/issues/10672#issuecomment-45949745",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10672",
    "id": 45949745,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1OTQ5NzQ1",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-12T21:22:17Z",
    "updated_at": "2014-06-12T21:22:17Z",
    "body": "Already marked P-backcompat-lang; adding to the 1.0 milestone.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45949745/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
