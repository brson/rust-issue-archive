[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58250302",
    "html_url": "https://github.com/rust-lang/rust/issues/17844#issuecomment-58250302",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17844",
    "id": 58250302,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MjUwMzAy",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-07T19:57:47Z",
    "updated_at": "2014-10-07T19:57:47Z",
    "body": "Can't reproduce on x86_64 using either `rustc 0.12.0-dev (dfbe9eb3b 2014-10-05 09:07:06 +0000)` or `rustc 0.12.0-dev (683e40f35 2014-10-07 14:32:09 +0000)`.\n\n```\nrunning 6 tests\ntest clone_str                  ... bench:    198461 ns/iter (+/- 2769)\ntest clone_vec_from_fn          ... bench:    197538 ns/iter (+/- 4357)\ntest clone_vec_from_incremental ... bench:    196808 ns/iter (+/- 3055)\ntest fast_clone_vec             ... bench:    268492 ns/iter (+/- 20548)\ntest memory_copy                ... bench:     64533 ns/iter (+/- 7712)\ntest naive_clone_vec            ... bench:    700255 ns/iter (+/- 17326)\n```\n\nWhich rustc version are you using? Also I'm curious why your output says that it's running 7 tests but shows only 6 results.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58250302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58278849",
    "html_url": "https://github.com/rust-lang/rust/issues/17844#issuecomment-58278849",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17844",
    "id": 58278849,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4Mjc4ODQ5",
    "user": {
      "login": "rusty-nail2",
      "id": 9051135,
      "node_id": "MDQ6VXNlcjkwNTExMzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9051135?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rusty-nail2",
      "html_url": "https://github.com/rusty-nail2",
      "followers_url": "https://api.github.com/users/rusty-nail2/followers",
      "following_url": "https://api.github.com/users/rusty-nail2/following{/other_user}",
      "gists_url": "https://api.github.com/users/rusty-nail2/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rusty-nail2/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rusty-nail2/subscriptions",
      "organizations_url": "https://api.github.com/users/rusty-nail2/orgs",
      "repos_url": "https://api.github.com/users/rusty-nail2/repos",
      "events_url": "https://api.github.com/users/rusty-nail2/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rusty-nail2/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-07T23:22:12Z",
    "updated_at": "2014-10-07T23:22:12Z",
    "body": "I removed an irrelevant test, but the results themselves are correct.\n\nI'm using Windows nightlies downloaded a few hours before filing the issue, namely\n\n```\n$ rustc --version\nrustc 0.12.0-nightly (dc987adfc 2014-10-04 23:42:07 +0000)\n```\n\nI just realized that `-C target-cpu=x86-64` doesn't generate 64-bit binaries, it only enables things like SSE2 (`-C target-feature=+sse2` has equivalent performance). So all my benchmarks are 32 bit.\n\nSo there are two problems:\n- low performance when SSE is not enabled; `String::clone` could use `copy_memory` for a 3x speedup in this configuration, which is the default on Windows and will be widely used.\n- odd behavior for `clone_str`.\n\nBizarrely, if you duplicate `clone_str`, the problem disappears from the second instance, making its performance match `clone_vec_from_incremental`.\n\nMinimal test case:\n\n```\n#![crate_type = \"lib\"]\n\nextern crate test;\nuse test::Bencher;\n\n// These two functions are exactly the same.\npub fn clone_str_bad(x: &String, bh: &mut Bencher) {\n    bh.iter(|| x.clone());\n}\npub fn clone_str_good(x: &String, bh: &mut Bencher) {\n    bh.iter(|| x.clone());\n}\n```\n\nLLVM generates a non-inlined call to `Vec::push_all` that copies byte by byte for `clone_str_bad`, while `clone_str_good` optimizes into a fast SSE copy. If both functions were optimized correctly, LLVM would reduce the second one to a single jmp to the first one.\n\nPerhaps this sort of thing is why https://github.com/rust-lang/rust/commit/f39ba69aaa0b50d7aaa130306f3f12d89583d501 claimed that \"LLVM is easily confused\".\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58278849/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/99556567",
    "html_url": "https://github.com/rust-lang/rust/issues/17844#issuecomment-99556567",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17844",
    "id": 99556567,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk5NTU2NTY3",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-06T18:09:23Z",
    "updated_at": "2015-05-06T18:09:23Z",
    "body": "I found that String::push_str and Vec::push_all didn't compile to memcpy either. Following you @rusty-nail2, it could be that in a bigger program, some instances of them will compile correctly?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/99556567/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/186012778",
    "html_url": "https://github.com/rust-lang/rust/issues/17844#issuecomment-186012778",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17844",
    "id": 186012778,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4NjAxMjc3OA==",
    "user": {
      "login": "briansmith",
      "id": 16816,
      "node_id": "MDQ6VXNlcjE2ODE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/16816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/briansmith",
      "html_url": "https://github.com/briansmith",
      "followers_url": "https://api.github.com/users/briansmith/followers",
      "following_url": "https://api.github.com/users/briansmith/following{/other_user}",
      "gists_url": "https://api.github.com/users/briansmith/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/briansmith/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/briansmith/subscriptions",
      "organizations_url": "https://api.github.com/users/briansmith/orgs",
      "repos_url": "https://api.github.com/users/briansmith/repos",
      "events_url": "https://api.github.com/users/briansmith/events{/privacy}",
      "received_events_url": "https://api.github.com/users/briansmith/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-02-19T02:08:00Z",
    "updated_at": "2016-02-19T02:08:00Z",
    "body": "Maybe #31414 will help with this.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/186012778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/186029942",
    "html_url": "https://github.com/rust-lang/rust/issues/17844#issuecomment-186029942",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17844",
    "id": 186029942,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4NjAyOTk0Mg==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-02-19T03:25:02Z",
    "updated_at": "2016-02-19T03:25:02Z",
    "body": "This seems to be fixed? String::clone could still be improved to unconditionally use memcpy (benefits debug perf)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/186029942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/246149296",
    "html_url": "https://github.com/rust-lang/rust/issues/17844#issuecomment-246149296",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17844",
    "id": 246149296,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NjE0OTI5Ng==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-09-10T22:50:08Z",
    "updated_at": "2016-09-10T22:50:08Z",
    "body": "String::clone is not slow (is not generic and is supplied by libstd). Vec::<T>::clone uses .extend_from_slice(), but it looks good except in cases where #33518 hits, so it will be fixed with that issue.\n\nUpdated benchmark shows no problem. https://gist.github.com/bluss/3a0afb7345000ec76bb2baeadf10f921\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/246149296/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
