{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/26926",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/26926/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/26926/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/26926/events",
  "html_url": "https://github.com/rust-lang/rust/pull/26926",
  "id": 94170322,
  "node_id": "MDExOlB1bGxSZXF1ZXN0Mzk2MzcwMzA=",
  "number": 26926,
  "title": "trans: Use LLVM's writeArchive to modify archives",
  "user": {
    "login": "alexcrichton",
    "id": 64996,
    "node_id": "MDQ6VXNlcjY0OTk2",
    "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexcrichton",
    "html_url": "https://github.com/alexcrichton",
    "followers_url": "https://api.github.com/users/alexcrichton/followers",
    "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
    "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
    "repos_url": "https://api.github.com/users/alexcrichton/repos",
    "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 223796632,
      "node_id": "MDU6TGFiZWwyMjM3OTY2MzI=",
      "url": "https://api.github.com/repos/rust-lang/rust/labels/relnotes",
      "name": "relnotes",
      "color": "fad8c7",
      "default": false,
      "description": "Marks issues that should be documented in the release notes of the next release."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "brson",
    "id": 147214,
    "node_id": "MDQ6VXNlcjE0NzIxNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/brson",
    "html_url": "https://github.com/brson",
    "followers_url": "https://api.github.com/users/brson/followers",
    "following_url": "https://api.github.com/users/brson/following{/other_user}",
    "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
    "organizations_url": "https://api.github.com/users/brson/orgs",
    "repos_url": "https://api.github.com/users/brson/repos",
    "events_url": "https://api.github.com/users/brson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/brson/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 19,
  "created_at": "2015-07-09T22:52:20Z",
  "updated_at": "2015-07-13T20:41:23Z",
  "closed_at": "2015-07-10T22:50:12Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/26926",
    "html_url": "https://github.com/rust-lang/rust/pull/26926",
    "diff_url": "https://github.com/rust-lang/rust/pull/26926.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/26926.patch",
    "merged_at": "2015-07-10T22:50:12Z"
  },
  "body": "We have previously always relied upon an external tool, `ar`, to modify archives\nthat the compiler produces (staticlibs, rlibs, etc). This approach, however, has\na number of downsides:\n- Spawning a process is relatively expensive for small compilations\n- Encoding arguments across process boundaries often incurs unnecessary overhead\n  or lossiness. For example `ar` has a tough time dealing with files that have\n  the same name in archives, and the compiler copies many files around to ensure\n  they can be passed to `ar` in a reasonable fashion.\n- Most `ar` programs found do **not** have the ability to target arbitrary\n  platforms, so this is an extra tool which needs to be found/specified when\n  cross compiling.\n\nThe LLVM project has had a tool called `llvm-ar` for quite some time now, but it\nwasn't available in the standard LLVM libraries (it was just a standalone\nprogram). Recently, however, in LLVM 3.7, this functionality has been moved to a\nlibrary and is now accessible by consumers of LLVM via the `writeArchive`\nfunction.\n\nThis commit migrates our archive bindings to no longer invoke `ar` by default\nbut instead make a library call to LLVM to do various operations. This solves\nall of the downsides listed above:\n- Archive management is now much faster, for example creating a \"hello world\"\n  staticlib is now 6x faster (50ms => 8ms). Linking dynamic libraries also\n  recently started requiring modification of rlibs, and linking a hello world\n  dynamic library is now 2x faster.\n- The compiler is now one step closer to \"hassle free\" cross compilation because\n  no external tool is needed for managing archives, LLVM does the right thing!\n\nThis commit does not remove support for calling a system `ar` utility currently.\nWe will continue to maintain compatibility with LLVM 3.5 and 3.6 looking forward\n(so the system LLVM can be used wherever possible), and in these cases we must\nshell out to a system utility. All nightly builds of Rust, however, will stop\nneeding a system `ar`.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/26926/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/26926/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
