[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53999649",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-53999649",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 53999649,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzOTk5NjQ5",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-31T20:06:05Z",
    "updated_at": "2014-08-31T20:07:12Z",
    "body": "If you are wiling to review this, I suggest viewing the whole file [here](https://github.com/Gankro/rust/blob/btree/src/libcollections/btree.rs), rather than the diff. This is a true clean-room rewrite.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53999649/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54052331",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54052331",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54052331,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MDUyMzMx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-01T12:11:55Z",
    "updated_at": "2014-09-01T12:11:55Z",
    "body": "There is _so_ much unwinding in this code; at a guess, the landing pads etc. generated by the `unwrap`s and `[]` indexing would be a significant proportion of the final code (and generally a compile-time and runtime performance drain); I would be very interested in seeing this reduced as much as possible.\n\nI noted several places where this could be remove easily (anything with `if is_leaf { ...` basically).\n\nAnother possibility would be a method on `Node` like \n\n``` rust\nfn view_parts(&self) -> (&[Option<K>], &[&Node<K,V>], &[Option<V>])\n```\n\nwhere each slice is cut to exactly the right length. It would be implemented unsafely, to coerce from `Option<Box<Node<K,V>>>` to `&Node<K,V>` (with a `debug_assert!` that the appropriate number of `Option`s are actually `Some`).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54052331/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54056030",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54056030",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54056030,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MDU2MDMw",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-01T12:56:39Z",
    "updated_at": "2014-09-01T12:56:39Z",
    "body": "@huonw I think mostly we just need a `keys` iterator that yields the keys. I imagine something like this:\n\n```\nKeys{ it: self.keys.iter() }\n...\nfn next() {\n    self.it.next().and_then(|x| x.as_ref())\n}\n```\n\n(and something similar for mut_keys)\n\nI could also probably pass around keys/values in their Options more, since I think there's some places where I unwrap them for a function boundary, and then just rewrap them at the caller. \n\nI could also probably replaces some foo[i]'s with foo.unsafe_get's?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54056030/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54331849",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54331849",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54331849,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MzMxODQ5",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-03T17:15:44Z",
    "updated_at": "2014-09-03T17:15:44Z",
    "body": "Okay, sorry I went radio silent on this for a bit. I just moved, so everything was a bit hectic. I can now begin working at cleaning this up and optimizing.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54331849/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54563042",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54563042",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54563042,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NTYzMDQy",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-05T00:11:22Z",
    "updated_at": "2014-09-05T00:11:22Z",
    "body": "So yeah, I think I'm going to go forward with a RawNode design that would basically be mini RawTables as seen in #16628. The option dance, while being _really_ nice for a correctness and safety check is a serious bloat on the whole thing. Although I haven't reflected too hard on detailed RawNode design, so it might all be rubbish to do.\n\nAs such this is going to get _pretty_ aggressively refactored, and so I'm considering just closing this now, pending that work. \n\nThat said, the main search/insert/remove logic shouldn't change _too much_, as RawNodes should just be providing a safe interface to the basic iteration/indexing/shifting/splicing stuff. Further, this is still a _decent_ base to work, as demonstrated by my benchmarks.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54563042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54565191",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54565191",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54565191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NTY1MTkx",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-05T00:43:57Z",
    "updated_at": "2014-09-05T00:43:57Z",
    "body": "Regardless of how I proceed, I've applied many of the suggested fixes. I've also factored out search into a method, which _significantly_ reduced code duplication, unwraps, and indexing while produced much more rustic code! Nice!\n\nThis also provides a hint of what RawNode might look like. I started toying with Found and Bound being structs in their own right with relevant interfaces (Bound only supports going to the next node and getting the index; Found gives full access). However I stopped once I settled on a larger refactor.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54565191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54566475",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54566475",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54566475,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NTY2NDc1",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-05T01:05:35Z",
    "updated_at": "2014-09-05T01:07:37Z",
    "body": "I opened https://github.com/rust-lang/rust/issues/16998 which would remove all the `unwrap`s (at least, we could use that infrastructure, somewhat); could you add a fixme?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54566475/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54757516",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54757516",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54757516,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NzU3NTE2",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-07T19:29:51Z",
    "updated_at": "2014-09-07T19:29:51Z",
    "body": "Updated perf results (on a different machine than the first batch):\n\n```\ntest treemap::bench::find_rand_100                         ... bench:        75 ns/iter (+/- 7)\ntest treemap::bench::find_rand_10_000                      ... bench:       194 ns/iter (+/- 8)\ntest treemap::bench::find_seq_100                          ... bench:        71 ns/iter (+/- 7)\ntest treemap::bench::find_seq_10_000                       ... bench:        98 ns/iter (+/- 2)\n\ntest treemap::bench::insert_rand_100                       ... bench:       174 ns/iter (+/- 16)\ntest treemap::bench::insert_rand_10_000                    ... bench:      1171 ns/iter (+/- 35)\ntest treemap::bench::insert_seq_100                        ... bench:       551 ns/iter (+/- 8)\ntest treemap::bench::insert_seq_10_000                     ... bench:       904 ns/iter (+/- 12)\n```\n\n```\ntest btree::bench::find_rand_100                           ... bench:        95 ns/iter (+/- 9)\ntest btree::bench::find_rand_10_000                        ... bench:       220 ns/iter (+/- 5)\ntest btree::bench::find_seq_100                            ... bench:        92 ns/iter (+/- 4)\ntest btree::bench::find_seq_10_000                         ... bench:       155 ns/iter (+/- 15)\n\ntest btree::bench::insert_rand_100                         ... bench:       376 ns/iter (+/- 41)\ntest btree::bench::insert_rand_10_000                      ... bench:       671 ns/iter (+/- 15)\ntest btree::bench::insert_seq_100                          ... bench:       440 ns/iter (+/- 5)\ntest btree::bench::insert_seq_10_000                       ... bench:       543 ns/iter (+/- 12)\n```\n\nInteresting that search seems to have regressed, maybe some `#[inline]`'s are in order.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54757516/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54757580",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54757580",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54757580,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NzU3NTgw",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-07T19:31:44Z",
    "updated_at": "2014-09-07T19:31:44Z",
    "body": "@huonw Is the current state sufficient to include as a \"okay start\" (assuming I impl all the iterator/cmp/hash stuff too), or would you like to see some more refactors and `unsafe_get's`?  \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54757580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54874267",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54874267",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54874267,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0ODc0MjY3",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-08T19:32:05Z",
    "updated_at": "2014-09-08T19:32:05Z",
    "body": "@huonw nvm, I'm going forward with RawNode because I had a flash of design insight that should make the code _super_ nice.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54874267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54899600",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54899600",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54899600,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0ODk5NjAw",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-08T22:54:06Z",
    "updated_at": "2014-09-08T22:54:06Z",
    "body": "I'm very happy to go with the as-safe-as-possible version with `Option<T>` etc, fwiw.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54899600/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54906022",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54906022",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54906022,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0OTA2MDIy",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-09T00:04:50Z",
    "updated_at": "2014-09-09T00:05:49Z",
    "body": "The current design is frustrating to me for a few reasons:\n- The Options are hacking around the fact that there we can't have partially initialized arrays\n- Leaves \"have\" children, when they shouldn't (and in fact, a leaf never \"becomes\" internal, so having them there is truly worthless).\n- We have to choose to either duplicate code for internal and leaf nodes, or be inefficient by uselessly shifting around None's in leaves.\n- Leaves and Internal nodes are not represented in the type system at all, you just have to know when to do what.\n\nMy proposed redesign has the following primary structure:\n\n```\n/// A Raw node handles the common code between Internal and Leaf nodes. Generally, it does all the\n/// work assuming the Node is Internal, and for Leaf nodes the edge manipulation should just get\n/// optimized away because of how empty types are treated.\nstruct RawNode<K, V, E> {\n    length: uint,\n    elems: *mut K,\n    marker:   marker::CovariantType<(K, V, E)>,\n}\n\npub struct InternalNode<K, V> {\n    raw: RawNode<K, V, Node<K,V>>,\n}\n\npub struct LeafNode<K, V> {\n    raw: RawNode<K, V, ()>,\n}\n\npub enum Node<K, V> {\n    Internal(InternalNode<K, V>),\n    Leaf(LeafNode<K, V>),\n}\n```\n\nWhere RawNode's \"elems\" is in fact a buffer allocated to fit all the maximum amount of keys, nodes, and edges a B-Tree node can hold by-value, mirroring the design of RawTable from the current HashMap design.\n\nWith this design, we get rid of all the Option dancing, and leaves don't allocate space for edges. Further, by implementing all the operations on RawNode, we get impls for Leaves and Internal nodes at once, while optimizing away the edge manipulation, and letting the distinction appear in the type system.\n\nHowever, this is all of course _very_ unsafe. So we expose a \"safe\" interface in the same way that RawTable does: by exposing a cursor-based interface for walking through the node's elements.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54906022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54914223",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-54914223",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 54914223,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0OTE0MjIz",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-09T01:58:13Z",
    "updated_at": "2014-09-09T01:58:13Z",
    "body": "Hrm... I'm running into issues with being able to express that all of a RawNode's children should be the same type of Node, which makes handle_underflow super awkward.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54914223/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55030717",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-55030717",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 55030717,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MDMwNzE3",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-09T20:38:40Z",
    "updated_at": "2014-09-09T20:38:40Z",
    "body": "@huonw I've experimentally refactored the array-based design to use Vec's and inline nodes rather than arrays and boxed nodes. The performance seems comparable and the implementation is _much_ safer _and_ saner. I gotta go atm, but I'll push up that design as a candidate replacement later today hopefully. In the mean time interested parties can check it out in isolation at: https://github.com/Gankro/rust-datastructures/tree/btree-vec/src/btree\n\nAlso: as an added bonus, Vec's permit us to have configurable B again!  Whoo!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55030717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55504182",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-55504182",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 55504182,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTA0MTgy",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-13T19:29:37Z",
    "updated_at": "2014-09-13T19:29:37Z",
    "body": "Closing while I finish this up out-of-tree.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55504182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55549182",
    "html_url": "https://github.com/rust-lang/rust/pull/16906#issuecomment-55549182",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16906",
    "id": 55549182,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTQ5MTgy",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-15T03:02:42Z",
    "updated_at": "2014-09-15T03:02:42Z",
    "body": "Update: impl is done, just need to write (read: steal from TreeMap) more tests. Need to patch Vec's MoveItems first, though.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55549182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
