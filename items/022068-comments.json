[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73390822",
    "html_url": "https://github.com/rust-lang/rust/issues/22068#issuecomment-73390822",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22068",
    "id": 73390822,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzkwODIy",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-08T00:38:58Z",
    "updated_at": "2015-02-08T00:38:58Z",
    "body": "cc me\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73390822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73391600",
    "html_url": "https://github.com/rust-lang/rust/issues/22068#issuecomment-73391600",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22068",
    "id": 73391600,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzkxNjAw",
    "user": {
      "login": "kmcallister",
      "id": 444997,
      "node_id": "MDQ6VXNlcjQ0NDk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kmcallister",
      "html_url": "https://github.com/kmcallister",
      "followers_url": "https://api.github.com/users/kmcallister/followers",
      "following_url": "https://api.github.com/users/kmcallister/following{/other_user}",
      "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions",
      "organizations_url": "https://api.github.com/users/kmcallister/orgs",
      "repos_url": "https://api.github.com/users/kmcallister/repos",
      "events_url": "https://api.github.com/users/kmcallister/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kmcallister/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-08T01:08:41Z",
    "updated_at": "2015-02-08T01:08:53Z",
    "body": "Above test is on a fairly heavily loaded machine.  With light load, it's 2.6 seconds in coherence, total real time 8.4s, user time 7.4s.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73391600/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73400894",
    "html_url": "https://github.com/rust-lang/rust/issues/22068#issuecomment-73400894",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22068",
    "id": 73400894,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNDAwODk0",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-08T07:48:01Z",
    "updated_at": "2015-02-08T07:48:01Z",
    "body": "Yeah, single core ARM devices are pretty slow. On my beaglebone, I get:\n\n```\n> rustc -Z time-passes hello-world.rs | grep -v '0.000'\ntime: 0.002     parsing\ntime: 0.042     plugin loading\ntime: 0.023     expansion\ntime: 0.001     assigning node ids and indexing ast\ntime: 0.063     resolution\ntime: 0.001     type collecting\ntime: 1.166     coherence checking\ntime: 0.015     type checking\ntime: 0.020     check static items\ntime: 0.032     borrow checking\ntime: 0.005     rvalue checking\ntime: 0.001     lint checking\ntime: 0.083     translation\n  time: 0.003   llvm function passes\n  time: 0.002   llvm module passes\n  time: 0.056   codegen passes\n  time: 0.005   codegen passes\ntime: 0.112     LLVM passes\n  time: 3.648   running linker\ntime: 3.656     linking\nrustc -Z time-passes hello-world.rs  4.83s user 0.69s system 98% cpu 5.588 total\n```\n\nThe RPi does spend more relative time in coherence checking in comparison to other devices, but all of them spend a significant amount of time there:\n\nRaspberry Pi: 2.6s out of 8.4s (31%) (your numbers)\nBeaglebone: 1.166s out of 5.588s (21%)\nOdroid XU: 0.264s out of 1.261s (21%)\nCore i7 laptop: 0.051s out of 0.349s (14.6%)\n\nNo idea why though. Given that the three ARM devices are executing the same binary/instructions, perhaps is just a difference in CPU models (ARMv6 vs ARMv7a)?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73400894/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75456081",
    "html_url": "https://github.com/rust-lang/rust/issues/22068#issuecomment-75456081",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22068",
    "id": 75456081,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDU2MDgx",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-22T20:32:26Z",
    "updated_at": "2015-02-22T20:32:26Z",
    "body": "This might be due to the RBML/EBML decoding code that looks like it would cause lots of unaligned loads. Older ARMs probably handle those worse than newer ones.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75456081/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75456236",
    "html_url": "https://github.com/rust-lang/rust/issues/22068#issuecomment-75456236",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22068",
    "id": 75456236,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDU2MjM2",
    "user": {
      "login": "kmcallister",
      "id": 444997,
      "node_id": "MDQ6VXNlcjQ0NDk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kmcallister",
      "html_url": "https://github.com/kmcallister",
      "followers_url": "https://api.github.com/users/kmcallister/followers",
      "following_url": "https://api.github.com/users/kmcallister/following{/other_user}",
      "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions",
      "organizations_url": "https://api.github.com/users/kmcallister/orgs",
      "repos_url": "https://api.github.com/users/kmcallister/repos",
      "events_url": "https://api.github.com/users/kmcallister/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kmcallister/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-22T20:35:34Z",
    "updated_at": "2015-02-22T20:35:34Z",
    "body": "Oh, interesting! Is coherence checking a hot spot for metadata parsing?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75456236/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75458005",
    "html_url": "https://github.com/rust-lang/rust/issues/22068#issuecomment-75458005",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22068",
    "id": 75458005,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDU4MDA1",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-22T21:08:26Z",
    "updated_at": "2015-02-22T21:08:26Z",
    "body": "I guess it's not in general, but the metadata is loaded on demand, and coherence seems to be the first thing that wants some.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75458005/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/100448751",
    "html_url": "https://github.com/rust-lang/rust/issues/22068#issuecomment-100448751",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22068",
    "id": 100448751,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMDQ0ODc1MQ==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-09T08:34:11Z",
    "updated_at": "2015-05-09T08:34:11Z",
    "body": "I've hit this on my [rid3](https://github.com/eddyb/r3) demo: loading all 120 `.rs` files (a crate each) in rust-by-example at once used up around **2GB** of RAM.\n\nTurns out coherence checking is using **16MB** per crate which uses `std`, even if it has no `impl` blocks, and that also takes some time.\n\nI've looked at it, and I don't know what could be using all the external `impl`s: `coherence::overlap` checking already loads all the `impl`s it needs (which would be none, in this case).\n\nHere are \"desktop\" timings for `fn main(){}`:\n\n```\ntime: 0.000     parsing\ntime: 0.000     recursion limit\ntime: 0.000     configuration 1\ntime: 0.000     gated macro checking\ntime: 0.000     crate injection\ntime: 0.019     macro loading\ntime: 0.000     plugin loading\ntime: 0.000     plugin registration\ntime: 0.003     expansion\ntime: 0.000     complete gated feature checking 1\ntime: 0.000     configuration 2\ntime: 0.000     maybe building test harness\ntime: 0.000     prelude injection\ntime: 0.000     checking that all macro invocations are gone\ntime: 0.000     complete gated feature checking 2\ntime: 0.000     assigning node ids and indexing ast\ntime: 0.000     external crate/lib resolution\ntime: 0.000     language item collection\ntime: 0.002     resolution\ntime: 0.000     lifetime resolution\ntime: 0.000     looking for entry point\ntime: 0.000     looking for plugin registrar\ntime: 0.000     region resolution\ntime: 0.000     loop checking\ntime: 0.000     static item recursion checking\ntime: 0.000     type collecting\ntime: 0.000     variance inference\ntime: 0.368     coherence checking\ntime: 0.000     type checking\ntime: 0.000     const checking\ntime: 0.000     privacy checking\ntime: 0.000     stability index\ntime: 0.000     intrinsic checking\ntime: 0.000     effect checking\ntime: 0.000     match checking\ntime: 0.000     liveness checking\ntime: 0.000     borrow checking\ntime: 0.000     rvalue checking\ntime: 0.000     reachability checking\ntime: 0.000     death checking\ntime: 0.000     stability checking\ntime: 0.000     unused lib feature checking\ntime: 0.000     lint checking\ntime: 0.000     resolving dependency formats\ntime: 0.002     translation\n  time: 0.000   llvm function passes\n  time: 0.000   llvm module passes\n  time: 0.004   codegen passes\n  time: 0.000   codegen passes\ntime: 0.014     LLVM passes\n  time: 0.721   running linker\ntime: 0.722     linking\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/100448751/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/100833782",
    "html_url": "https://github.com/rust-lang/rust/issues/22068#issuecomment-100833782",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22068",
    "id": 100833782,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMDgzMzc4Mg==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-11T09:38:39Z",
    "updated_at": "2015-05-11T14:05:14Z",
    "body": "So it seems the \"load all impls ever\" logic in coherence is a workaround for the fact that `csearch::each_implementation_for_trait`, used by `populate_implementations_for_trait_if_necessary`, doesn't look in _every_ crate, but _only_ the crate where the trait was defined.\n\nHowever, [my initial fix](https://github.com/eddyb/rust/commits/coherent-coherence) doesn't actually seem to load any impls outside of the trait's definition crate, and I have no idea where else to look.\n\n**EDIT**: turns out I was looking for a tag which wasn't getting encoded in the list of all the impls in a crate. Should have a patch soon, if nothing else comes up.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/100833782/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
