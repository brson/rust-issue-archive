[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41301264",
    "html_url": "https://github.com/rust-lang/rust/issues/13732#issuecomment-41301264",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13732",
    "id": 41301264,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMzAxMjY0",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-24T16:28:18Z",
    "updated_at": "2014-04-24T16:28:18Z",
    "body": "see also, further irc discussion/debugging between myself and alexcrichton here: https://botbot.me/mozilla/rust-internals/msg/13776568/\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41301264/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41308269",
    "html_url": "https://github.com/rust-lang/rust/issues/13732#issuecomment-41308269",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13732",
    "id": 41308269,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMzA4MjY5",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-24T17:26:57Z",
    "updated_at": "2014-04-24T17:33:11Z",
    "body": "I resolved where the rpath into my `$HOME/opt/rust-dbg/lib/rustlib/x86_64-apple-darwin/lib` was coming from: the `config.mk` file in my build tree has this setting\n\n```\nCFG_LIBDIR           := /Users/fklock/opt/rust-dbg/lib\n```\n\n~~(I am still a bit confused because this particular build directory almost always doesn't use that particular `--prefix`)~~ (update: no, it was correct, I shouldn't have been confused at all.  I forgot I keep the non-optimized build in `rust-dbg-nopt`)\n\nAnyway, so this is getting installed as  the fallback rpath, as indicated here in a verbose log:\n\n```\nrelative rpaths:\n    @loader_path/../../../stage1/lib/rustlib/x86_64-apple-darwin/lib\n    @loader_path/../../../stage1/lib/rustlib/x86_64-apple-darwin/lib\n    @loader_path/../../../stage1/lib/rustlib/x86_64-apple-darwin/lib\n    @loader_path/../../../stage1/lib/rustlib/x86_64-apple-darwin/lib\n    @loader_path/../../../stage1/lib/rustlib/x86_64-apple-darwin/lib\nfallback rpaths:\n    /Users/fklock/opt/rust-dbg/lib/rustlib/x86_64-apple-darwin/lib\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41308269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41310707",
    "html_url": "https://github.com/rust-lang/rust/issues/13732#issuecomment-41310707",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13732",
    "id": 41310707,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMzEwNzA3",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-24T17:48:58Z",
    "updated_at": "2014-04-24T17:48:58Z",
    "body": "Looking at the code in [`librustc/back/rpath.rs`](../blob/4ac89cd27613ffe574a6fc6009793c1900e5cfca/src/librustc/back/rpath.rs#L136), we hard-code a reference to the install prefix into `rustc` itself.\n\nI don't have a problem with that, but we probably should have a compiler flag to either remove the usage of that fallback rpath, or override the path that rustc uses for the fallback.  Then the Makefile could actually run `rustc` but have it referencing its own build tree for the fallback by using the overriding option.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41310707/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41382065",
    "html_url": "https://github.com/rust-lang/rust/issues/13732#issuecomment-41382065",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13732",
    "id": 41382065,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMzgyMDY1",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-25T11:17:20Z",
    "updated_at": "2014-04-25T11:17:20Z",
    "body": "Okay, so I hacked up a patch to add a `--install-prefix` option to `rustc` that overrides the embedded one in the `librustc` library.\n\nAfter doing that and using it in the `run-make/bootstrap-from-c-with-green/Makefile`, I still hit the problem.\n\nI did some more digging and determined that there is some funky effect being introduced by the setting of the `DYLD_LIBRARY_PATH` environment variable.  (I added a call to `env` to the start of the Makefile rule to print out the environment before running the recipe, that helped a lot).\n\nFrom the settings of the `DYLD_LIBRARY_PATH` and `LD_LIBRARY_PATH` environment variables, I determined that you need at least one of these environment variables to be set if you want this test to run at all; if both are unset, you get:\n\n```\n% /Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/test/run-make/bootstrap-from-c-with-green/main\ndyld: Library not loaded: @rpath/libboot-c9bec0e5-0.1.dylib\n  Referenced from: /Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/test/run-make/bootstrap-from-c-with-green/main\n  Reason: image not found\nTrace/BPT trap: 5\n% \n```\n\nSo I transcribed the settings that the Makefiles are current establishing for the two environment variables at the time that this recipe is run (by the aforementioned `env` printout), and found the following distinct behaviors.\n\n```\n% DYLD_LIBRARY_PATH=/Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/test/run-make/bootstrap-from-c-with-green::/Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/stage1/lib LD_LIBRARY_PATH=/Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/test/run-make/bootstrap-from-c-with-green: /Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/test/run-make/bootstrap-from-c-with-green/main\ndyld: Symbol not found: __ZN10event_loop20h1197db882d44291cDOf9v0.11.preE\n  Referenced from: /Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/test/run-make/bootstrap-from-c-with-green/libboot-c9bec0e5-0.1.dylib\n  Expected in: /Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/stage1/lib/librustuv-30cdf6fe-0.11-pre.dylib\n in /Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/test/run-make/bootstrap-from-c-with-green/libboot-c9bec0e5-0.1.dylib\nTrace/BPT trap: 5\n% LD_LIBRARY_PATH=/Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/test/run-make/bootstrap-from-c-with-green: /Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/test/run-make/bootstrap-from-c-with-green/main\nhello\n% \n```\n\nIt seems like the `DYLD_LIBRARY_PATH` is causing my problem here at this point.  In particular the entry for `/Users/fklock/Dev/Mozilla/rust.git/objdir-check1-dbgopt/x86_64-apple-darwin/stage1/lib` is causing problems.  Should that be pointing instead to `x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib` ?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41382065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41466618",
    "html_url": "https://github.com/rust-lang/rust/issues/13732#issuecomment-41466618",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13732",
    "id": 41466618,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNDY2NjE4",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-26T11:45:09Z",
    "updated_at": "2014-04-26T11:45:09Z",
    "body": "attempting to fix, work in progress, see PR #13753 \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41466618/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/42373972",
    "html_url": "https://github.com/rust-lang/rust/issues/13732#issuecomment-42373972",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13732",
    "id": 42373972,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMzczOTcy",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-06T23:50:07Z",
    "updated_at": "2014-05-06T23:50:07Z",
    "body": "(closed #13753 in favor of PR #14000)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/42373972/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/42452695",
    "html_url": "https://github.com/rust-lang/rust/issues/13732#issuecomment-42452695",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13732",
    "id": 42452695,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNDUyNjk1",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-07T16:51:52Z",
    "updated_at": "2014-05-07T16:51:52Z",
    "body": "part of #8058 \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/42452695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
