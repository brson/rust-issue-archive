[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65170787",
    "html_url": "https://github.com/rust-lang/rust/issues/19281#issuecomment-65170787",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19281",
    "id": 65170787,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MTcwNzg3",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-02T01:40:27Z",
    "updated_at": "2014-12-02T01:40:27Z",
    "body": "It looks like this is coming from cf3b2e4fe6044cce018b723de9b21c500c6eac41, where `Vec::reserve*` was rewritten. It appears that the old `Vec::reserve_additional` behavior was about 2-10 times faster according to this [micro-benchmark](https://gist.github.com/erickt/003211d6ad2210a19824).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65170787/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65189445",
    "html_url": "https://github.com/rust-lang/rust/issues/19281#issuecomment-65189445",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19281",
    "id": 65189445,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MTg5NDQ1",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-02T06:40:45Z",
    "updated_at": "2014-12-02T06:40:45Z",
    "body": "This is definitely getting out of my area of expertise, but apparently switching `Vec::reserve` from this:\n\n``` rust\n    pub fn reserve(&mut self, additional: uint) {\n        if self.cap - self.len < additional {\n            match self.len.checked_add(additional) {\n                None => panic!(\"Vec::reserve: `uint` overflow\"),\n                // if the checked_add\n                Some(new_cap) => {\n                    let amort_cap = new_cap.next_power_of_two();\n                    // next_power_of_two will overflow to exactly 0 for really big capacities\n                    if amort_cap == 0 {\n                        self.grow_capacity(new_cap);\n                    } else {\n                        self.grow_capacity(amort_cap);\n                    }\n                }\n            }\n        }\n    }\n```\n\nTo this:\n\n``` rust\n    pub fn reserve(&mut self, additional: uint) {\n        if self.cap - self.len < additional {\n            match self.len.checked_add(additional) {\n                None => panic!(\"Vec::reserve: `uint` overflow\"),\n                Some(new_cap) => {\n                    let amort_cap = new_cap.next_power_of_two();\n                    // next_power_of_two will overflow to exactly 0 for really big capacities\n                    let capacity = if amort_cap == 0 { new_cap } else { amort_cap };\n                    self.grow_capacity(capacity)\n                }\n            }\n        }\n    }\n```\n\nIs sufficient to get my micro-benchmark's `Vec::write` to perform like it did a week ago. I don't know enough about low-level optimization to know why this seemingly inconsequential change would have such an impact on performance. @pcwalton or @thestinger, you're pretty familiar with low-level stuff, do you know what could be going on here?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65189445/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
