[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8319427",
    "html_url": "https://github.com/rust-lang/rust/issues/3387#issuecomment-8319427",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3387",
    "id": 8319427,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzMTk0Mjc=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-06T01:16:12Z",
    "updated_at": "2012-09-06T01:16:12Z",
    "body": "The current fix for this, unfortunately, makes a lot of otherwise reasonable programs fail to borrow check and also causes an ICE in one case.  Nonetheless, I plan to land it as part of the trans rewrite.\n\nI will leave this issue open, though, and I have xfail-test'd a few tests and marked them with the issue #.  Immediately prior to landing the rewrite I'll try to get a proper fix and then close this issue.\n\nThe proper fix, I think, is to take a better approach to rvalue lifetimes, per recent discussions with Graydon.  The reason we get error messages is that the current rvalue lifetimes are too short in many cases.  The current plan is two fold: first, I will adjust how cleanups occur in trans so that they are grouped at statements rather than being arbitrarily tight (for example, bounded around calls).  This will help with the ICE, which occurs because borrowck decides that something should be preserved for a very small lifetime and trans doesn't install an appropriate cleanup scope.\n\nHowever, the second part is then to use inference to decide how long a particular rvalue should live based on whether its contents are borrowed.  It seems that there is no simple rule that accommodates all the use cases we'd like, so we are going to have borrowck make the decision.  The rule will be something like: \"temporaries live at least as long as the enclosing statement, but no longer than the innermost loop or fn body\".  If you want a precise lifetime, create a variable.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8319427/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/9740284",
    "html_url": "https://github.com/rust-lang/rust/issues/3387#issuecomment-9740284",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3387",
    "id": 9740284,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3NDAyODQ=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-10-24T14:00:01Z",
    "updated_at": "2012-10-24T14:00:01Z",
    "body": "In the end I opted not to land that patch, but this and related issues are cropping up again.  The basic problem I am encountering now\u2014which is related\u2014is that our current region hierarchy is too shallow.  That is, we allow call expressions, blocks, fn bodies, and loops to act as parent nodes, and arrange all of other expression nodes under them. We certainly wish to include operators (binary, index, etc) as possible parents\u2014and perhaps simply want to mirror the AST in its entirety.  The latter is often how I think of it in my head.\n\nThis requires some caution.  I know we are getting a bit of mileage now out of the shallowness of our tree and we have to be sure we don't introduce some unsoundness here or there.  An example:\n\n```\n    foo(&a, &b)\n        ^^   ^^\n    ^~~~~~~~~~~^\n```\n\nIf we are not careful, the lifetimes of &a and &b could be inferred just to those two expressions (as shown) and not to the call to foo as a whole.  Actually I guess this can already be a problem today, it's just mildly exacerbated by introducing more nodes.  So basically the shallowness of our tree may be hiding some bugs (I don't know that it is).\n\nTo fix this, and related errors, we just have to be very careful in the regionck.rs pass and elsewhere that the lower bounds we place on lifetimes is not too short.  Unfortunately this reasoning is currently a bit scattered between the type checker and regionck.  Probably it is best to move that reasoning into regionck as much as possible, because it runs after the type inferencer (but not the region inferencer) has acquired all the data it will ever have.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/9740284/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/17563773",
    "html_url": "https://github.com/rust-lang/rust/issues/3387#issuecomment-17563773",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3387",
    "id": 17563773,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NTYzNzcz",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-05-07T19:16:03Z",
    "updated_at": "2013-05-07T19:16:03Z",
    "body": "Fixed now.\n\ncompile-fail tests:\n\nborrowck-loan-in-overloaded-op.rs\nborrowck-loan-rcvr-overloaded-op.rs\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/17563773/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
