[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32284891",
    "html_url": "https://github.com/rust-lang/rust/pull/11539#issuecomment-32284891",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11539",
    "id": 32284891,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjg0ODkx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-14T17:10:59Z",
    "updated_at": "2014-01-14T17:10:59Z",
    "body": "Could you post some before/after code of what this change in types enables?\n\nIt's also probably worth adding to the comment on the definition of `c_void` as to why it's `u8` (which probably isn't what one would expect)\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32284891/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32285630",
    "html_url": "https://github.com/rust-lang/rust/pull/11539#issuecomment-32285630",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11539",
    "id": 32285630,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjg1NjMw",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-14T17:18:13Z",
    "updated_at": "2014-01-14T17:18:13Z",
    "body": "Test code:\n\n``` rust\nfn main() {\n    let x = ~3;\n}\n```\n\nCompile with `rustc --emit-llvm -S -O -Z lto issue11539.rs`\nBefore:\n\n``` llvm\ndefine internal void @main::hd4b0664c300788adah::v0.0({ i64, %tydesc*, i8*, i8*, i8 }* nocapture readnone) unnamed_addr #0 {\n\"function top level\":\n  %1 = tail call %\"enum.std::libc::types::common::c95::c_void[#1]\"* @malloc(i64 8)\n  %2 = icmp eq %\"enum.std::libc::types::common::c95::c_void[#1]\"* %1, null\n  br i1 %2, label %_ZN2rt11global_heap10malloc_raw19h000735e5ce40b7f3aR4v0.9E.exit.thread, label %cond.i\n\n_ZN2rt11global_heap10malloc_raw19h000735e5ce40b7f3aR4v0.9E.exit.thread: ; preds = %\"function top level\"\n  tail call void @abort()\n  call void @llvm.trap()\n  unreachable\n\ncond.i:                                           ; preds = %\"function top level\"\n  %3 = bitcast %\"enum.std::libc::types::common::c95::c_void[#1]\"* %1 to i64*\n  store i64 3, i64* %3, align 8\n  tail call void @free(%\"enum.std::libc::types::common::c95::c_void[#1]\"* %1) #1\n  ret void\n}\n```\n\nAfter:\n\n``` llvm\ndefine internal void @main::hd4b0664c300788adah::v0.0({ i64, %tydesc*, i8*, i8*, i8 }* nocapture readnone) unnamed_addr #0 {\n\"_ZN13_$UP$$LP$$RP$9glue_drop19h82dc7f896d315c35a8E.exit\":\n  ret void\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32285630/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32287204",
    "html_url": "https://github.com/rust-lang/rust/pull/11539#issuecomment-32287204",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11539",
    "id": 32287204,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjg3MjA0",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-14T17:34:20Z",
    "updated_at": "2014-01-14T17:34:20Z",
    "body": "`check-stage1-std TESTNAME=zero_1kb`\n\nBefore:\n\n```\nrun: x86_64-unknown-linux-gnu/stage1/test/stdtest-x86_64-unknown-linux-gnu\n\nrunning 5 tests\ntest vec::bench::zero_1kb_fixed_repeat                          ... bench:        74 ns/iter (+/- 4)\ntest vec::bench::zero_1kb_from_elem                             ... bench:       135 ns/iter (+/- 62)\ntest vec::bench::zero_1kb_loop_set                              ... bench:       810 ns/iter (+/- 254)\ntest vec::bench::zero_1kb_mut_iter                              ... bench:        73 ns/iter (+/- 2)\ntest vec::bench::zero_1kb_set_memory                            ... bench:        74 ns/iter (+/- 1)\n\nmetrics saved to: tmp/check-stage1-T-x86_64-unknown-linux-gnu-H-x86_64-unknown-linux-gnu-std-metrics.json\ntest result: ok. 0 passed; 0 failed; 0 ignored; 5 measured\n```\n\nAfter:\n\n```\nrun: x86_64-unknown-linux-gnu/stage1/test/stdtest-x86_64-unknown-linux-gnu\n\nrunning 5 tests\ntest vec::bench::zero_1kb_fixed_repeat                          ... bench:        74 ns/iter (+/- 3)\ntest vec::bench::zero_1kb_from_elem                             ... bench:        73 ns/iter (+/- 4)\ntest vec::bench::zero_1kb_loop_set                              ... bench:       550 ns/iter (+/- 3)\ntest vec::bench::zero_1kb_mut_iter                              ... bench:        72 ns/iter (+/- 3)\ntest vec::bench::zero_1kb_set_memory                            ... bench:        72 ns/iter (+/- 3)\n\nmetrics saved to: tmp/check-stage1-T-x86_64-unknown-linux-gnu-H-x86_64-unknown-linux-gnu-std-metrics.json\ntest result: ok. 0 passed; 0 failed; 0 ignored; 5 measured\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32287204/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32288268",
    "html_url": "https://github.com/rust-lang/rust/pull/11539#issuecomment-32288268",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11539",
    "id": 32288268,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjg4MjY4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-14T17:46:14Z",
    "updated_at": "2014-01-14T17:46:14Z",
    "body": "I played around a bit, and I think we can get the same optimization with\n\n``` rust\n#[repr(u8)]\npub enum c_void {\n   priv variant1,\n   priv variant2,\n}\n```\n\nIn order for `repr` to work, it needs to have at least two variants apparently? A comment could then explain why it looks like this (for optimization purposes), but this should also disallow accidental dereferencing or creation of `c_void` values.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32288268/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32291830",
    "html_url": "https://github.com/rust-lang/rust/pull/11539#issuecomment-32291830",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11539",
    "id": 32291830,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjkxODMw",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-14T18:24:57Z",
    "updated_at": "2014-01-14T19:14:29Z",
    "body": "The test suite isn't built with LTO. With LTO we get:\n\nBefore:\n\n```\nrunning 5 tests\ntest zero_1kb_fixed_repeat ... bench:        54 ns/iter (+/- 0)\ntest zero_1kb_from_elem    ... bench:        54 ns/iter (+/- 0)\ntest zero_1kb_loop_set     ... bench:       528 ns/iter (+/- 2)\ntest zero_1kb_mut_iter     ... bench:        54 ns/iter (+/- 0)\ntest zero_1kb_set_memory   ... bench:        54 ns/iter (+/- 0)\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 5 measured\n```\n\nAfter:\n\n```\nrunning 5 tests\ntest zero_1kb_fixed_repeat ... bench:         0 ns/iter (+/- 0)\ntest zero_1kb_from_elem    ... bench:         0 ns/iter (+/- 0)\ntest zero_1kb_loop_set     ... bench:       528 ns/iter (+/- 1)\ntest zero_1kb_mut_iter     ... bench:         0 ns/iter (+/- 0)\ntest zero_1kb_set_memory   ... bench:         0 ns/iter (+/- 0)\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 5 measured\n```\n\nThe \"before\" numbers are probably faster than before, because I copied the benchmarks into their own file and we still get better inlining behaviour when there is only one user of a function.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32291830/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
