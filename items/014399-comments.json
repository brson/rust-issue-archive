[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44080902",
    "html_url": "https://github.com/rust-lang/rust/issues/14399#issuecomment-44080902",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14399",
    "id": 44080902,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MDgwOTAy",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-24T08:11:34Z",
    "updated_at": "2014-05-24T08:11:50Z",
    "body": "Thanks for the report!\n\nI reduced it to the following (with the assistance of creduce):\n\n``` rust\nimpl Property for Vec3 {\n    fn get_property(&self, _: &str) -> PropertyType { Float(0.0) }\n}\nimpl Property for Quat {\n    fn get_property(&self, _: &str) -> PropertyType { Struct(self.v.clone()) }\n}\n#[deriving(Clone)]\nstruct Vec3;\nstruct Quat {\n    v: Box<Vec3>,\n}\nenum PropertyType { Float(f64), Struct(Box<Property>), }\ntrait Property {\n    fn get_property(&self, &str) -> PropertyType;\n}\n\nfn main() { }\n```\n\n```\nreduce.rs:9:1: 11:2 warning: code is never used: `Quat`, #[warn(dead_code)] on by default\nreduce.rs:9 struct Quat {\nreduce.rs:10     v: Box<Vec3>,\nreduce.rs:11 }\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'could not find method while translating', /home/rustbuild/src/rust-buildbot/slave/nightly-linux/build/src/libstd/option.rs:167\nstack backtrace:\n   1:     0x7fbe8942aed0 - rt::backtrace::imp::write::h829de4821815e280PUy::v0.11.0.pre\n   2:     0x7fbe893a7c50 - rt::unwind::begin_unwind_inner::h3c95a01106a60df1Xuy::v0.11.0.pre\n   3:     0x7fbe89e9b250 - rt::unwind::begin_unwind::h8363202580871814802::v0.11.0.pre\n   4:     0x7fbe89fe8790 - middle::trans::meth::method_with_name::h27fe9715defde429xnv::v0.11.0.pre\n   5:     0x7fbe89f1c610 - middle::trans::meth::trans_method_callee::he0d18bd58a692f20t8u::v0.11.0.pre\n   6:     0x7fbe89f1c5a0 - middle::trans::callee::trans_method_call::closure.58859\n   7:     0x7fbe89f1a0e0 - middle::trans::callee::trans_call_inner::h6ec9e97b2f0cf3a9xId::v0.11.0.pre\n   8:     0x7fbe89f1bef0 - middle::trans::callee::trans_method_call::hb058dc63facf7471NDd::v0.11.0.pre\n   9:     0x7fbe89f24c30 - middle::trans::expr::trans_rvalue_dps_unadjusted::hea9eb494db080d538hf::v0.11.0.pre\n  10:     0x7fbe89ee5430 - middle::trans::expr::trans_into::h15e286d35b829d1fgse::v0.11.0.pre\n  11:     0x7fbe89ee59e0 - middle::trans::controlflow::trans_block::h7d3f8bec55eca940I7a::v0.11.0.pre\n  12:     0x7fbe89f24c30 - middle::trans::expr::trans_rvalue_dps_unadjusted::hea9eb494db080d538hf::v0.11.0.pre\n  13:     0x7fbe89ee5430 - middle::trans::expr::trans_into::h15e286d35b829d1fgse::v0.11.0.pre\n  14:     0x7fbe89f31a40 - middle::trans::expr::trans_uniq_expr::hbc1817203acccbdah3f::v0.11.0.pre\n  15:     0x7fbe89f325b0 - middle::trans::expr::trans_unary::hca6bb9d2119494eeLXf::v0.11.0.pre\n  16:     0x7fbe89f23b00 - middle::trans::expr::trans_unadjusted::ha9f4b115887b34acmPe::v0.11.0.pre\n  17:     0x7fbe89ee5430 - middle::trans::expr::trans_into::h15e286d35b829d1fgse::v0.11.0.pre\n  18:     0x7fbe89ee59e0 - middle::trans::controlflow::trans_block::h7d3f8bec55eca940I7a::v0.11.0.pre\n  19:     0x7fbe89fa2a70 - middle::trans::base::trans_closure::h247c5303be3eb095Php::v0.11.0.pre\n  20:     0x7fbe89eae960 - middle::trans::base::trans_fn::hac7f31459ea86cc45pp::v0.11.0.pre\n  21:     0x7fbe89eaee60 - middle::trans::monomorphize::monomorphic_fn::h29e7539c7e7490a1Lka::v0.11.0.pre\n  22:     0x7fbe89f0fb10 - middle::trans::callee::trans_fn_ref_with_vtables::h739a9d33fff1d6b8Kjd::v0.11.0.pre\n  23:     0x7fbe89f0b2f0 - middle::trans::callee::trans_fn_ref::hf912bb2e1b25d34aScd::v0.11.0.pre\n  24:     0x7fbe89f1c610 - middle::trans::meth::trans_method_callee::he0d18bd58a692f20t8u::v0.11.0.pre\n  25:     0x7fbe89f1c5a0 - middle::trans::callee::trans_method_call::closure.58859\n  26:     0x7fbe89f1a0e0 - middle::trans::callee::trans_call_inner::h6ec9e97b2f0cf3a9xId::v0.11.0.pre\n  27:     0x7fbe89f1bef0 - middle::trans::callee::trans_method_call::hb058dc63facf7471NDd::v0.11.0.pre\n  28:     0x7fbe89f24c30 - middle::trans::expr::trans_rvalue_dps_unadjusted::hea9eb494db080d538hf::v0.11.0.pre\n  29:     0x7fbe89f23b00 - middle::trans::expr::trans_unadjusted::ha9f4b115887b34acmPe::v0.11.0.pre\n  30:     0x7fbe89ee7720 - middle::trans::expr::trans::h31b1d37217a231c6cwe::v0.11.0.pre\n  31:     0x7fbe89f1deb0 - middle::trans::callee::trans_args::h79811d38aa6e67c3N2d::v0.11.0.pre\n  32:     0x7fbe89f1a0e0 - middle::trans::callee::trans_call_inner::h6ec9e97b2f0cf3a9xId::v0.11.0.pre\n  33:     0x7fbe89f19eb0 - middle::trans::callee::trans_call::h16885ad67fa12e03FCd::v0.11.0.pre\n  34:     0x7fbe89f24c30 - middle::trans::expr::trans_rvalue_dps_unadjusted::hea9eb494db080d538hf::v0.11.0.pre\n  35:     0x7fbe89ee5430 - middle::trans::expr::trans_into::h15e286d35b829d1fgse::v0.11.0.pre\n  36:     0x7fbe89ee59e0 - middle::trans::controlflow::trans_block::h7d3f8bec55eca940I7a::v0.11.0.pre\n  37:     0x7fbe89fa2a70 - middle::trans::base::trans_closure::h247c5303be3eb095Php::v0.11.0.pre\n  38:     0x7fbe89eae960 - middle::trans::base::trans_fn::hac7f31459ea86cc45pp::v0.11.0.pre\n  39:     0x7fbe89fa6c40 - middle::trans::meth::trans_impl::hcad0b0d6fab6bc8cX3u::v0.11.0.pre\n  40:     0x7fbe89ea91a0 - middle::trans::base::trans_item::h62a895b39c0cb8ccCBp::v0.11.0.pre\n  41:     0x7fbe89fb11f0 - middle::trans::base::trans_crate::h3026657c475a7720poq::v0.11.0.pre\n  42:     0x7fbe8a76cd30 - driver::driver::phase_4_translate_to_llvm::h639e7dc77f10a518H1j::v0.11.0.pre\n  43:     0x7fbe8a762000 - driver::driver::compile_input::hc7e76cb3959dc3aeiJj::v0.11.0.pre\n  44:     0x7fbe8a82d820 - driver::run_compiler::ha4687608fe641c15bmm::v0.11.0.pre\n  45:     0x7fbe8a82d740 - driver::main_args::closure.93513\n  46:     0x7fbe8a842a20 - driver::monitor::closure.94585\n  47:     0x7fbe8a83dd10 - task::TaskBuilder::try::closure.94348\n  48:     0x7fbe899495a0 - task::spawn_opts::closure.7809\n  49:     0x7fbe89425050 - rt::task::Task::run::closure.25264\n  50:     0x7fbe89489b10 - rust_try\n  51:     0x7fbe89424fa0 - rt::task::Task::run::h82b2a3f233cfc4a9Ajw::v0.11.0.pre\n  52:     0x7fbe89949350 - task::spawn_opts::closure.7782\n  53:     0x7fbe894292d0 - rt::thread::thread_start::he85cc53b3abeddd182w::v0.11.0.pre\n  54:     0x7fbe86ecdfa0 - start_thread\n  55:     0x7fbe89070a09 - __clone\n  56:                0x0 - <unknown>\n\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44080902/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44081006",
    "html_url": "https://github.com/rust-lang/rust/issues/14399#issuecomment-44081006",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14399",
    "id": 44081006,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MDgxMDA2",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-24T08:16:24Z",
    "updated_at": "2014-05-24T08:16:38Z",
    "body": "Ah! But it works with an explicit cast to the trait object:\n\n``` rust\nfn get_property(&self, _: &str) -> PropertyType { Struct(self.v.clone() as Box<Property>) }\n```\n\ni.e. it seems to be problem with implicit trait object coercions. cc @luqmana \n\n(This has the same error message as https://github.com/mozilla/rust/issues/6334 but the causes don't look the same.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44081006/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45662198",
    "html_url": "https://github.com/rust-lang/rust/issues/14399#issuecomment-45662198",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14399",
    "id": 45662198,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjYyMTk4",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-10T19:46:08Z",
    "updated_at": "2014-06-11T22:04:25Z",
    "body": "The reason for this seems to be because in `typeck::check::vtable::early_resolve_expr` we first encounter the method call expr (`self.v.clone()` in this code) and lookup the vtables for it which we then insert into the `vtable_map`. The key for this map (essentially) being the expression's `NodeId`. (It's actually a struct containing the expression id and how many times to deref) Then we go on to check if there are any adjustments for the current expression. In this case there is, since we can coerce to a trait object here. So then go on to lookup vtables for the adjusted expression and once again we insert it into the `vtable_map`. The problem is that we use the same key, and thus we overwrite the entry from earlier. We don't run into this if you use an explicit cast since the method call and the cast would be 2 expressions we consider separately and thus no clash.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45662198/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
