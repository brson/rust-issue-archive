{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/16407",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/16407/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/16407/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/16407/events",
  "html_url": "https://github.com/rust-lang/rust/pull/16407",
  "id": 39918063,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTk1Nzc3Nzc=",
  "number": 16407,
  "title": "libnative: process spawning should not close inherited file descriptors",
  "user": {
    "login": "ipetkov",
    "id": 1638690,
    "node_id": "MDQ6VXNlcjE2Mzg2OTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1638690?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ipetkov",
    "html_url": "https://github.com/ipetkov",
    "followers_url": "https://api.github.com/users/ipetkov/followers",
    "following_url": "https://api.github.com/users/ipetkov/following{/other_user}",
    "gists_url": "https://api.github.com/users/ipetkov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ipetkov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ipetkov/subscriptions",
    "organizations_url": "https://api.github.com/users/ipetkov/orgs",
    "repos_url": "https://api.github.com/users/ipetkov/repos",
    "events_url": "https://api.github.com/users/ipetkov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ipetkov/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 4,
  "created_at": "2014-08-10T22:12:56Z",
  "updated_at": "2014-08-11T13:58:31Z",
  "closed_at": "2014-08-11T07:06:17Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/16407",
    "html_url": "https://github.com/rust-lang/rust/pull/16407",
    "diff_url": "https://github.com/rust-lang/rust/pull/16407.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/16407.patch",
    "merged_at": "2014-08-11T07:06:17Z"
  },
  "body": "When creating a subprocess via `std::io::process::Command` it is possible to allow the child to inherit certain open file descriptors. When the process is spawned (in `native::io::process`), however, the file descriptor is unconditionally closed. This is an error for the following reasons:\n1. The caller can safely create a file descriptor via `native::io::file::open`, which returns a `FileDesc` on success. Since there is no public interface for specifying that the internal fd should NOT be cleaned up, the `FileDesc` structure will attempt to close the fd when it is destroyed. Since spawning closes the file descriptor, when the `FileDesc` structure mentioned above goes out of scope, it will print an error message to screen. This behavior may be unwanted, and there is no way to prevent it without leaking the `FileDesc` structure (which is not a good alternative).\n2. Alternatively, it is possible for another file to be opened whose fd matches that stored by the `FileDesc` structure returned by `native::io::file::open` before said structure goes out of scope. Thus when it does, it will _incorrectly_ succeed at closing the file, causing unexpected errors for the task that opened the file.\n3. The caller may not wish to close the file descriptor just yet. Imagine a scenario where a lock file is created by a child process and unlinked when it exits. The parent may wish to keep the file on disk until it exits so that any other process looking for that lock file will see it. When it finally does exit and close its handle to the file, the OS will clean it up then.\n\nThus the caller must be solely responsible for cleaning up (or leaking if so desired) any opened file descriptors, especially since the `std::io::process:Command` interface for adding inherited file descriptors involves using a literal descriptor and not a wrapper like `FileDesc`.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/16407/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/16407/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
