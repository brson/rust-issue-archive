[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48828313",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48828313",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48828313,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODI4MzEz",
    "user": {
      "login": "errordeveloper",
      "id": 251467,
      "node_id": "MDQ6VXNlcjI1MTQ2Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/251467?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/errordeveloper",
      "html_url": "https://github.com/errordeveloper",
      "followers_url": "https://api.github.com/users/errordeveloper/followers",
      "following_url": "https://api.github.com/users/errordeveloper/following{/other_user}",
      "gists_url": "https://api.github.com/users/errordeveloper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/errordeveloper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/errordeveloper/subscriptions",
      "organizations_url": "https://api.github.com/users/errordeveloper/orgs",
      "repos_url": "https://api.github.com/users/errordeveloper/repos",
      "events_url": "https://api.github.com/users/errordeveloper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/errordeveloper/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-13T00:49:20Z",
    "updated_at": "2014-07-13T00:49:20Z",
    "body": "Wow, 20-30% :+1: \n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48828313/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48828550",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48828550",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48828550,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODI4NTUw",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-13T01:02:33Z",
    "updated_at": "2014-07-13T01:03:14Z",
    "body": "Just to be clear, there's no way to get similar speed in safe(r) code using `self.as_bytes().iter()` rather than the raw pointers directly because that does bounds checking for the end of the slice when decoding multibyte characters, even though the UTF8 requirement makes this unnecessary?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48828550/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48828929",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48828929",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48828929,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODI4OTI5",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-13T01:25:58Z",
    "updated_at": "2014-07-13T02:46:23Z",
    "body": "It may well be possible @huonw. An initial prototype doesn't beat the current libstd implementation though; I'll come back to that tomorrow\n\nHere we have to ask -- what's the cheapest way to do something like it.next().unwrap()?\n\n``` rust\npub struct Citems<'a> {\n    iter: std::slice::Items<'a, u8>\n}\n\nimpl<'a> Iterator<char> for Citems<'a>\n{\n    #[inline]\n    fn next(&mut self) -> Option<char>\n    {\n        #[inline(never)]\n        fn decode_multibyte<'a>(fst: u8, it: &mut std::slice::Items<'a, u8>)\n            -> Option<char>\n        {\n            let w = UTF8_CHAR_WIDTH[fst as uint];\n            let mut ch = utf8_first_byte!(fst, w as uint);\n            ch = utf8_acc_cont_byte!(ch, it.next().map_or(0, |x| *x));\n            if w > 2 {\n                ch = utf8_acc_cont_byte!(ch, it.next().map_or(0, |x| *x));\n                if w > 3 {\n                    ch = utf8_acc_cont_byte!(ch, it.next().map_or(0, |x| *x));\n                }\n            }\n            unsafe {\n                Some(transmute(ch))\n            }\n        }\n\n        match self.iter.next() {\n            Some(&next_byte) => {\n                if next_byte < 128 {\n                    Some(next_byte as char)\n                } else {\n                    decode_multibyte(next_byte, &mut self.iter)\n                }\n            }\n            None => None\n        }\n    }\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48828929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48830584",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48830584",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48830584,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODMwNTg0",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-13T03:21:24Z",
    "updated_at": "2014-07-13T03:21:24Z",
    "body": "This is awesome, thanks for optimizing this! I, like @huonw, am also interested if this could be done with a bytes iterator, it seems like it should be able to compile down to the same thing.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48830584/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48836717",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48836717",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48836717,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODM2NzE3",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-13T10:12:26Z",
    "updated_at": "2014-07-13T11:03:04Z",
    "body": "I agree -- but I haven't been able to write an implementation based on the slice iterator that performs as well. My understanding is simplified, but I tried to put the multibyte case in the slow path and make the ASCII-only case fast but the slice iterator doesn't perform as well as the pointer arithmetic based chars iterator, especially not on ASCII-dominated text.\n\nIs this related to  #11751 ?\n\nMy playground code for comparing the three iterator implementations [is here](https://gist.github.com/anonymous/239a911477868d827c6f), the [slice iterator based implementation is on this line](https://gist.github.com/anonymous/239a911477868d827c6f#file-chariter-rs-L156)\n\nBenchmarks from the playground code (wikitext is decoding the En Wikipedia front page source)\n\n```\ntest bench::char_iterator               ... bench:       112 ns/iter (+/- 0)\ntest bench::char_iterator_ascii         ... bench:       301 ns/iter (+/- 1)\ntest bench::char_iterator_rev           ... bench:       181 ns/iter (+/- 2)\ntest bench::char_iterator_wikitext      ... bench:     77445 ns/iter (+/- 1578)\ntest bench::citems_iterator             ... bench:       111 ns/iter (+/- 1)\ntest bench::citems_iterator_ascii       ... bench:       292 ns/iter (+/- 4)\ntest bench::citems_iterator_wikitext    ... bench:     77120 ns/iter (+/- 341)\ntest bench::new_chars_iterator          ... bench:        84 ns/iter (+/- 11)\ntest bench::new_chars_iterator_ascii    ... bench:       225 ns/iter (+/- 1)\ntest bench::new_chars_iterator_rev      ... bench:       109 ns/iter (+/- 3)\ntest bench::new_chars_iterator_wikitext ... bench:     54683 ns/iter (+/- 211)\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48836717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48840024",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48840024",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48840024,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODQwMDI0",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-13T13:05:02Z",
    "updated_at": "2014-07-13T13:05:02Z",
    "body": "Yes #11751 will get in the way, theoretically https://github.com/rust-lang/llvm/pull/14 will improve it (if you felt like it, you could manipulate your src/llvm submodule to include that to test; I'm not really sure how easy that is to do).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48840024/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48841622",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48841622",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48841622,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODQxNjIy",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-13T14:14:02Z",
    "updated_at": "2014-07-13T14:54:09Z",
    "body": "Updated comment because of major thinko -- nothing seems to be working the way I thought it was.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48841622/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48844779",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48844779",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48844779,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODQ0Nzc5",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-13T16:17:04Z",
    "updated_at": "2014-07-13T16:17:21Z",
    "body": "_Now_ I've managed to compile a rustc that knows about `-C null-check-elimination`  (pull in the llvm submodule; configure to disable submodule management; make)\n\nThe result is, no improvement (`citems` is the slice iterator-based impl)\n\n```\ntest bench::citems_iterator             ... bench:       115 ns/iter (+/- 15)\ntest bench::citems_iterator_ascii       ... bench:       311 ns/iter (+/- 44)\ntest bench::citems_iterator_wikitext    ... bench:     77793 ns/iter (+/- 630)\ntest bench::new_chars_iterator          ... bench:       104 ns/iter (+/- 12)\ntest bench::new_chars_iterator_ascii    ... bench:       223 ns/iter (+/- 4)\ntest bench::new_chars_iterator_rev      ... bench:       121 ns/iter (+/- 16)\ntest bench::new_chars_iterator_wikitext ... bench:     55178 ns/iter (+/- 323)\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48844779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48851952",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48851952",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48851952,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODUxOTUy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-13T21:07:59Z",
    "updated_at": "2014-07-13T21:07:59Z",
    "body": "I'm a little uneasy adding more unsafe iteration when it already exists for vectors (duplication of logic). Is there a performance win for this rewrite using safe iteration over the previous code, or is it only a win using unsafe code?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48851952/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48855331",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48855331",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48855331,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4ODU1MzMx",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-13T23:44:17Z",
    "updated_at": "2014-07-13T23:45:49Z",
    "body": "Duplication of logic is a good argument against, but in the end we need to provide a great Chars iterator. I don't feel that this code is particularly risky in any way, just that Rust's string handling is mature enough now that we don't have lots of holes to slip in invalid encoded data through libstd APIs anymore. \n\nThe implementation using the slice iterator is a none to a few percent performance increase by itself, we could wait to see if more code generation improvements make up for the rest there. It's not even important to merge that now, but it would be cool if @zwarich could say if his improvements are going to help us.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48855331/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48948838",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48948838",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48948838,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTQ4ODM4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-14T19:35:57Z",
    "updated_at": "2014-07-14T19:35:57Z",
    "body": "Perhaps we could land the other optimizations and hold off on the unsafe pointers until https://github.com/rust-lang/llvm/pull/14 is merged into master?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48948838/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48952547",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-48952547",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 48952547,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTUyNTQ3",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-14T20:07:07Z",
    "updated_at": "2014-07-14T20:07:07Z",
    "body": "I did test those changes already, but if there are more it would be very interesting to see. It's not unreasonable. I should complete the implementation using just the slice iterator (the chars().rev() impl is missing), and we can see if it's worth adding on its own, it's ok.\n\nI don't feel a reimplementation of the slice iterator is that scary, it's a great model of a useful pattern itself -- it will come back when users want to implement \"slices with stride > 1\" for example.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48952547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49241459",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-49241459",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 49241459,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MjQxNDU5",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-16T23:29:15Z",
    "updated_at": "2014-07-16T23:29:56Z",
    "body": "Tons of elbow grease creates a slice iterator decoder that's faster than both the present Chars iterator as well as the pointer arithmetic Chars iterator in all my testcases. It's not pretty, though. Will update PR tomorrow.\n\n``` rust\n#[deriving(Clone)]\npub struct CharItems<'a> {\n    iter: slice::Items<'a, u8>\n}\n\n#[inline]\nfn unwrap_or_0(opt: Option<&u8>) -> u8 {\n    match opt {\n        Some(&byte) => byte,\n        None => 0,\n    }\n}\n\nimpl<'a> Iterator<char> for CharItems<'a> {\n    #[inline]\n    fn next(&mut self) -> Option<char> {\n        fn decode_multibyte<'a>(x: u8, it: &mut slice::Items<'a, u8>) -> char {\n            // NOTE: Performance is very sensitive to the exact formulation here\n            // Decode from a byte combination out of: [[[x y] z] w]\n            let CONT_MASK = 0x3F; // continuation byte mask\n            let init = utf8_first_byte!(x, 2);\n            let mut ch;\n            let y = unwrap_or_0(it.next());\n            ch = init << 6 | (y & CONT_MASK) as u32;\n            if x >= 0xE0 {\n                let z = unwrap_or_0(it.next());\n\n                let y_z = (((y & CONT_MASK) as u32) << 6) | (z & CONT_MASK) as u32;\n                ch = init << 12 | y_z;\n                if x >= 0xF0 {\n                    let w = unwrap_or_0(it.next());\n                    ch = (init & 7) << 18 | y_z << 6 | (w & CONT_MASK) as u32;\n                }\n            }\n            unsafe {\n                mem::transmute(ch)\n            }\n        }\n\n        match self.iter.next() {\n            None => None,\n            Some(&next_byte) => {\n                if next_byte < 128 {\n                    Some(next_byte as char)\n                } else {\n                    Some(decode_multibyte(next_byte, &mut self.iter))\n                }\n            }\n        }\n    }\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49241459/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49339005",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-49339005",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 49339005,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzM5MDA1",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-17T17:37:43Z",
    "updated_at": "2014-07-17T18:41:30Z",
    "body": "~~There is no conclusive evidence for the new impl (wrapping `slice::Items<'a, u8>`) is faster.~~ How well it compiles heavily depends on the context -- even though that it's faster in a standalone testing program, for some reason it is slower in libcore bench tests. :(\n\nWhat worries me here is the result for the test called `char_iterator_for` -- that I added, which runs `for ch in s.chars() { black_box(ch) }`. Without that regression, I'd love to merge it.\n\nBefore\n\n``` rust\ntest str::bench::char_indicesator                          ... bench:       125 ns/iter (+/- 293)\ntest str::bench::char_indicesator_rev                      ... bench:       189 ns/iter (+/- 26)\ntest str::bench::char_iterator                             ... bench:       152 ns/iter (+/- 296)\ntest str::bench::char_iterator_ascii                       ... bench:       302 ns/iter (+/- 485)\ntest str::bench::char_iterator_for                         ... bench:       121 ns/iter (+/- 2)\ntest str::bench::char_iterator_rev                         ... bench:       418 ns/iter (+/- 357)\ntest str::bench::char_iterator_rev_for                     ... bench:       195 ns/iter (+/- 413)\n```\n\nafter\n\n``` rust\ntest str::bench::char_indicesator                          ... bench:       126 ns/iter (+/- 2)\ntest str::bench::char_indicesator_rev                      ... bench:       137 ns/iter (+/- 15)\ntest str::bench::char_iterator                             ... bench:       113 ns/iter (+/- 11)\ntest str::bench::char_iterator_ascii                       ... bench:       310 ns/iter (+/- 14)\ntest str::bench::char_iterator_for                         ... bench:       179 ns/iter (+/- 3)\ntest str::bench::char_iterator_rev                         ... bench:       107 ns/iter (+/- 8)\ntest str::bench::char_iterator_rev_for                     ... bench:       167 ns/iter (+/- 11)\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49339005/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49343894",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-49343894",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 49343894,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzQzODk0",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-17T18:18:11Z",
    "updated_at": "2014-07-17T18:24:15Z",
    "body": "It's the inlining decisions -- inlining even the multibyte case makes the difference -- how does that look with the update?\n\nBenching on a laptop always has you wondering, is that faster now because of some turbo boost stuff I can't control? Either way, the for loop test case sped up to the level of the others, using inline.\n\n``` rust\ntest str::bench::char_indicesator                          ... bench:        85 ns/iter (+/- 3)\ntest str::bench::char_indicesator_rev                      ... bench:        82 ns/iter (+/- 6)\ntest str::bench::char_iterator                             ... bench:        85 ns/iter (+/- 2)\ntest str::bench::char_iterator_ascii                       ... bench:       317 ns/iter (+/- 2)\ntest str::bench::char_iterator_for                         ... bench:        87 ns/iter (+/- 3)\ntest str::bench::char_iterator_rev                         ... bench:        79 ns/iter (+/- 1)\ntest str::bench::char_iterator_rev_for                     ... bench:        68 ns/iter (+/- 2)\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49343894/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49344199",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-49344199",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 49344199,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzQ0MTk5",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-17T18:20:42Z",
    "updated_at": "2014-07-17T18:20:42Z",
    "body": "Updating main PR text in case this is merged.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49344199/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49385172",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-49385172",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 49385172,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Mzg1MTcy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-18T01:02:31Z",
    "updated_at": "2014-07-18T01:02:31Z",
    "body": "Awesome work @blake2-ppc! It's always nice to hear that unsafe code isn't necessary when safe code suffices.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49385172/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49386515",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-49386515",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 49386515,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Mzg2NTE1",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-18T01:28:10Z",
    "updated_at": "2014-07-18T01:28:10Z",
    "body": "Could you add the benchmarks (or at least mention loose percentages) to a commit message? (So that someone history diving can understand the reasons that this code is designed like this.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49386515/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49506838",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-49506838",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 49506838,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTA2ODM4",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-19T11:23:36Z",
    "updated_at": "2014-07-19T11:23:36Z",
    "body": "Commits pushed to incorporate the excellent suggestions. Benchmarking results added to PR message (will be in merge commit log)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49506838/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49508173",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-49508173",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 49508173,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTA4MTcz",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-19T12:34:15Z",
    "updated_at": "2014-07-19T12:35:37Z",
    "body": "In-tree benchmarking is very time consuming, but I felt it was necessary to justify the change.\n\nThe development benchmark was using the html source of en.wikipedia.org/wiki/Main_Page, a typical almost ascii only document with small chunks of of UTF-8. Those benchmarks are even more convincing, for some reason. (Maybe code size? The size of the .next() method maybe pays off in a long-running simple loop like this)\n\n```\nnew Chars vs old \u2014 s.chars().count()\n\nNEW test bench::char_items_wikitext     ... bench:    126095 ns/iter (+/- 8568)\nNEW test bench::char_items_wikitext_rev ... bench:    120053 ns/iter (+/- 2175)\nOLD test bench::chars_wikitext          ... bench:    169647 ns/iter (+/- 4876)\nOLD test bench::chars_wikitext_rev      ... bench:    228570 ns/iter (+/- 2267)\n\nnew Chars vs old \u2014 for ch in s.chars() { black_box(ch) }\n\nNEW test bench::char_items_wikitext     ... bench:    120153 ns/iter (+/- 1482)\nNEW test bench::char_items_wikitext_rev ... bench:     83574 ns/iter (+/- 1181)\nOLD test bench::chars_wikitext          ... bench:    278724 ns/iter (+/- 2909)\nOLD test bench::chars_wikitext_rev      ... bench:    202086 ns/iter (+/- 1790)\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49508173/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49514649",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-49514649",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 49514649,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTE0NjQ5",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-19T16:52:32Z",
    "updated_at": "2014-07-19T16:52:32Z",
    "body": "I repeated the last benchmark suite (iterating over the wikipedia main page) using my criterion library, and got a consistent 20%+ improvement in all the benchmarks.\n\n```\nBenchmarking chars/count\n(...)\nComparing with previous sample\n> Bootstrapping with 100489 resamples\n  > mean    -20.243% \u00b1 0.0606% [-20.355% -20.117%] 95% CI\n  > median  -20.346% \u00b1 0.0103% [-20.349% -20.322%] 95% CI\n  > mean has improved by 20.24%\n  > median has improved by 20.35%\n\nBenchmarking chars/for\n(...)\nComparing with previous sample\n> Bootstrapping with 100489 resamples\n  > mean    -26.500% \u00b1 0.0571% [-26.608% -26.388%] 95% CI\n  > median  -26.493% \u00b1 0.0154% [-26.515% -26.461%] 95% CI\n  > mean has improved by 26.50%\n  > median has improved by 26.49%\n\nBenchmarking chars/rev_count\n(...)\nComparing with previous sample\n> Bootstrapping with 100489 resamples\n  > mean    -25.287% \u00b1 0.0624% [-25.418% -25.174%] 95% CI\n  > median  -25.298% \u00b1 0.0318% [-25.380% -25.252%] 95% CI\n  > mean has improved by 25.29%\n  > median has improved by 25.30%\n\nBenchmarking chars/rev_for\n(...)\nComparing with previous sample\n> Bootstrapping with 100489 resamples\n  > mean    -22.016% \u00b1 0.1673% [-22.364% -21.711%] 95% CI\n  > median  -21.800% \u00b1 0.0492% [-21.885% -21.698%] 95% CI\n  > mean has improved by 22.02%\n  > median has improved by 21.80%\n```\n\n@blake2-ppc Really nice speed-ups! :+1: \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49514649/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49526418",
    "html_url": "https://github.com/rust-lang/rust/pull/15638#issuecomment-49526418",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15638",
    "id": 49526418,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTI2NDE4",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-19T18:45:20Z",
    "updated_at": "2014-07-19T18:45:20Z",
    "body": "Thanks for running the benchmark, that is cool!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49526418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
