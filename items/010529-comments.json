[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28663979",
    "html_url": "https://github.com/rust-lang/rust/pull/10529#issuecomment-28663979",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10529",
    "id": 28663979,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NjYzOTc5",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-17T21:08:53Z",
    "updated_at": "2013-11-17T21:08:53Z",
    "body": "cc @Aatch @brson @bblum \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28663979/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28664493",
    "html_url": "https://github.com/rust-lang/rust/pull/10529#issuecomment-28664493",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10529",
    "id": 28664493,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NjY0NDkz",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-17T21:29:19Z",
    "updated_at": "2013-11-17T21:29:19Z",
    "body": "Can you try to add a test that exercises the concurrent aspect?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28664493/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28676052",
    "html_url": "https://github.com/rust-lang/rust/pull/10529#issuecomment-28676052",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10529",
    "id": 28676052,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4Njc2MDUy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-18T05:27:01Z",
    "updated_at": "2013-11-18T05:27:01Z",
    "body": "It troubles me that there are 0 comments in this code. Concurrent data structures are hard enough before you add lock-free components to them. Can you please add some comments explaining what's going on and where?\n\nAdditionally, the commit message \"improve work queue\" isn't very descriptive, can you expand that with a title and a description as to what was improved as well?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28676052/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28682497",
    "html_url": "https://github.com/rust-lang/rust/pull/10529#issuecomment-28682497",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10529",
    "id": 28682497,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NjgyNDk3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-18T08:51:21Z",
    "updated_at": "2013-11-18T08:51:21Z",
    "body": "As with the previous queues, I'm wary of having a \"safe way to use these unsafely.\" I would much rather have a safe interface exposing the invariants of this queue. I quickly got tripped up over myself thinking that there were multiple pushers/poppers.\n\nThis is an excellent candidate for a `WorkQueue` and a `WorkQueueHandle` where only one of the two is clone-able. It seems that there is a clear way to integrate this into the scheduler, and I think that it would be much cleaner than just hoping that the consumer of this queue doesn't have two pushers/poppers.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28682497/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28682586",
    "html_url": "https://github.com/rust-lang/rust/pull/10529#issuecomment-28682586",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10529",
    "id": 28682586,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NjgyNTg2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-18T08:53:06Z",
    "updated_at": "2013-11-18T08:53:06Z",
    "body": "Oh, I forgot to mention, but do you have any numbers on this queue about how the performance looks? I'm wary of using a try lock to steal work because it seems like if work queues are under high contention no one will end up stealing anything when there's lots of work to steal.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28682586/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28742539",
    "html_url": "https://github.com/rust-lang/rust/pull/10529#issuecomment-28742539",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10529",
    "id": 28742539,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzQyNTM5",
    "user": {
      "login": "toffaletti",
      "id": 145012,
      "node_id": "MDQ6VXNlcjE0NTAxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/145012?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/toffaletti",
      "html_url": "https://github.com/toffaletti",
      "followers_url": "https://api.github.com/users/toffaletti/followers",
      "following_url": "https://api.github.com/users/toffaletti/following{/other_user}",
      "gists_url": "https://api.github.com/users/toffaletti/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/toffaletti/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/toffaletti/subscriptions",
      "organizations_url": "https://api.github.com/users/toffaletti/orgs",
      "repos_url": "https://api.github.com/users/toffaletti/repos",
      "events_url": "https://api.github.com/users/toffaletti/events{/privacy}",
      "received_events_url": "https://api.github.com/users/toffaletti/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-18T22:01:11Z",
    "updated_at": "2013-11-18T22:01:11Z",
    "body": "I agree using the type system to enforce correct usage is a good idea. I'm wary of changing too many things at once though so I'd like to do the API changes in another patch.\n\nI ran some benchmarks on a C++ version of this and the performance seemed good, and comparable to the Chase-Lev implementation I was working on which is why I decided to try it out.\n\nThe test_steal test I added can be used to verify the balance of work between threads. I have a stand-alone version at https://github.com/toffaletti/rust-code/blob/master/work_queue.rs which you can run with `RUST_LOG=work_queue ./work_queue`. The output should look something like this:\n\n```\ncount: 133\ncount: 68\ncount: 106\ncount: 100\ncount: 127\ncount: 76\ncount: 92\ncount: 117\ncount: 181\ntest tests::test_steal ... ok\n```\n\nThe test simulates work by doing a task::deschedule.  I'd be interested in a better real-world test. In the past I tried using rust-http server and apache bench with different levels of concurrency, but it only utilizes a single core because of libuv+rust integration causing all IO to occur in a single thread.\n\nAs an aside, I've found it rather cumbersome to develop things inside libstd. Which is why I have stand-alone versions so I can just `rustc --test work_queue.rs` instead of having the overhead of `make check-stage1` for every little change. There must be a better way?\n\nFinally, I'll work on commenting the code and perhaps removing the mask magic, which is just a silly optimization a lot of these concurrent data structures backed by arrays use. If the size of the array is made to be a power of two, they can use `indexCounter & mask` instead of `indexCounter % arraySize` to get the real array index when indexCounter is an only atomically incrementing number because I guess bitwise AND is faster than modulus in silicon. My instinct doubts it makes a difference outside of synthetic benchmarks.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28742539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28755839",
    "html_url": "https://github.com/rust-lang/rust/pull/10529#issuecomment-28755839",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10529",
    "id": 28755839,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzU1ODM5",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-19T00:49:12Z",
    "updated_at": "2013-11-19T00:49:12Z",
    "body": "Can you add benchmarks to the tests, or in src/test/bench?\n\nOn Mon, Nov 18, 2013 at 5:01 PM, Jason Toffaletti\nnotifications@github.comwrote:\n\n> I agree using the type system to enforce correct usage is a good idea. I'm\n> wary of changing too many things at once though so I'd like to do the API\n> changes in another patch.\n> \n> I ran some benchmarks on a C++ version of this and the performance seemed\n> good, and comparable to the Chase-Lev implementation I was working on which\n> is why I decided to try it out.\n> \n> The test_steal test I added can be used to verify the balance of work\n> between threads. I have a stand-alone version at\n> https://github.com/toffaletti/rust-code/blob/master/work_queue.rs which\n> you can run with RUST_LOG=work_queue ./work_queue. The output should look\n> something like this:\n> \n> count: 133\n> count: 68\n> count: 106\n> count: 100\n> count: 127\n> count: 76\n> count: 92\n> count: 117\n> count: 181\n> test tests::test_steal ... ok\n> \n> The test simulates work by doing a task::deschedule. I'd be interested in\n> a better real-world test. In the past I tried using rust-http server and\n> apache bench with different levels of concurrency, but it only utilizes a\n> single core because of libuv+rust integration causing all IO to occur in a\n> single thread.\n> \n> As an aside, I've found it rather cumbersome to develop things inside\n> libstd. Which is why I have stand-alone versions so I can just rustc\n> --test work_queue.rs instead of having the overhead of make check-stage1for every little change. There must be a better way?\n> \n> Finally, I'll work on commenting the code and perhaps removing the mask\n> magic, which is just a silly optimization a lot of these concurrent data\n> structures backed by arrays use. If the size of the array is made to be a\n> power of two, they can use indexCounter & mask instead of indexCounter %\n> arraySize to get the real array index when indexCounter is an only\n> atomically incrementing number because I guess bitwise AND is faster than\n> modulus in silicon. My instinct doubts it makes a difference outside of\n> synthetic benchmarks.\n> \n> \u2014\n> Reply to this email directly or view it on GitHubhttps://github.com/mozilla/rust/pull/10529#issuecomment-28742539\n> .\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28755839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29558555",
    "html_url": "https://github.com/rust-lang/rust/pull/10529#issuecomment-29558555",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10529",
    "id": 29558555,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NTU4NTU1",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-30T18:59:29Z",
    "updated_at": "2013-11-30T18:59:29Z",
    "body": "Closing now that #10678 has landed\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29558555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
