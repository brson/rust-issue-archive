[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58761619",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58761619",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58761619,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzYxNjE5",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-11T19:32:16Z",
    "updated_at": "2014-10-11T19:32:16Z",
    "body": "Another route would just be disallowing _borrows_ as well, similar to how we only allow borrows of statics in statics.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58761619/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58761733",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58761733",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58761733,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzYxNzMz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-11T19:36:17Z",
    "updated_at": "2014-10-11T19:36:17Z",
    "body": "It could be allowed if it gave borrows something like a `'task` lifetime instead of `'static`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58761733/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58763260",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58763260",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58763260,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzYzMjYw",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-11T20:23:01Z",
    "updated_at": "2014-10-11T20:23:39Z",
    "body": "Where is the unsoundness there? `uint` implements `Sync`, so sending a reference to it to a subtask is completely fine (unless the inner task can outlive the outer task, in which case the proc shouldn't be `:'static` and the spawn should be illegal).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58763260/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58764571",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58764571",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58764571,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzY0NTcx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-11T21:07:50Z",
    "updated_at": "2014-10-11T21:07:50Z",
    "body": "The lifetime `'static` means that it outlives the entire program, but the lifetime of a thread-local variable is just for the thread that it's running on, which doesn't necessarily outlive the entire program. This means that interior pointers can be sent to other threads which become stale once the sending thread exits.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58764571/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58766718",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58766718",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58766718,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzY2NzE4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-11T22:24:09Z",
    "updated_at": "2014-10-11T22:24:29Z",
    "body": "It seems like it would be really easy to add `'task` and keep it behind the same feature gate to make this sound. Eventually, `#[thread_local]` will be available on all relevant platforms and it could be used directly to handle simple cases rather than using wrappers. It's missing C++11 style destructor support so it isn't able to completely eliminate the need for a higher-level API.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58766718/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58766792",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58766792",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58766792,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzY2Nzky",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-11T22:26:15Z",
    "updated_at": "2014-10-11T22:26:15Z",
    "body": "@alexcrichton: It also permits data races now that internal mutability in a `static` is permitted.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58766792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58767876",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58767876",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58767876,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzY3ODc2",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-11T23:14:16Z",
    "updated_at": "2014-10-11T23:14:16Z",
    "body": "Do we need `'task`? Couldn't we have a `NoSend` wrapper around `&'static T`, implementing `Deref`?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58767876/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58768002",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58768002",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58768002,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzY4MDAy",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-11T23:20:55Z",
    "updated_at": "2014-10-11T23:21:15Z",
    "body": "@eddyb: It needs `'task` to be sound as an unwrapped `static` variable. It's necessary to expose a proper `&T` reference regardless.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58768002/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58775238",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58775238",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58775238,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4Nzc1MjM4",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-12T06:32:48Z",
    "updated_at": "2014-10-12T06:34:32Z",
    "body": "@thestinger \n\nPreventing data races is a job for `Sync` (rather than `Send`), which (for some weird reason) `#[thread_local]` seem to require.\n\n@eddyb\nHaving values that are `'static` but not really does not seem like a good idea to me \u2013 it's fighting against the lifetime system.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58775238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58790558",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58790558",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58790558,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzkwNTU4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-12T11:01:35Z",
    "updated_at": "2014-10-12T11:01:35Z",
    "body": "> Preventing data races is a job for Sync (rather than Send), which (for some weird reason) #[thread_local] seem to require.\n\nA `#[thread_local]` `static` requiring `Sync` is a recently introduced bug. It's not a mitigating factor for this bug, which _does_ allow data races in the absence of that other bug.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58790558/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58968998",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58968998",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58968998,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4OTY4OTk4",
    "user": {
      "login": "pythonesque",
      "id": 923144,
      "node_id": "MDQ6VXNlcjkyMzE0NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/923144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pythonesque",
      "html_url": "https://github.com/pythonesque",
      "followers_url": "https://api.github.com/users/pythonesque/followers",
      "following_url": "https://api.github.com/users/pythonesque/following{/other_user}",
      "gists_url": "https://api.github.com/users/pythonesque/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pythonesque/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pythonesque/subscriptions",
      "organizations_url": "https://api.github.com/users/pythonesque/orgs",
      "repos_url": "https://api.github.com/users/pythonesque/repos",
      "events_url": "https://api.github.com/users/pythonesque/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pythonesque/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-13T23:19:31Z",
    "updated_at": "2014-10-13T23:19:31Z",
    "body": "I don't think adding a new 'task lifetime is actually that helpful for thread-locals.  If they are Send, and are using fork-join concurrency, 'task means something different in a child thread from a parent thread, so a child 'task might outlive a parent 'task--how do you disambiguate?  Does Rust know when the new 'task lifetime is created in the child so it can reason about this soundly?  If it does, and they have different lifetime names, why use 'task at all and not just a regular lifetime?\n\nOn the other hand, if you can't Send them, just make them NoSend and have done with it.  The only problem with making thread locals NoSend is that then you can't send them between tasks in fork-join style APIs.  If you can't resolve the issues above, there's probably no sane way of determining that anyway so you might as well ban it (and really, I think it's a pretty niche usecase to want shared thread local data).\n\nI don't think semantics are a good argument here.  There are lots of examples of things that aren't \"semantically\" 'static, like data in Rcs (which can never outlive its calling thread) that nonetheless get along without special lifetimes.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58968998/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58973297",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58973297",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58973297,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4OTczMjk3",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-14T00:15:18Z",
    "updated_at": "2014-10-14T00:19:43Z",
    "body": "The point of `'task` is that it would be like `'static` but would not be `Send`.\n\n> I don't think adding a new 'task lifetime is actually that helpful for thread-locals. If they are Send, and are using fork-join concurrency, 'task means something different in a child thread from a parent thread, so a child 'task might outlive a parent 'task--how do you disambiguate? Does Rust know when the new 'task lifetime is created in the child so it can reason about this soundly? If it does, and they have different lifetime names, why use 'task at all and not just a regular lifetime?\n\nIt would be trivial to add it, and it doesn't need to know anything about other tasks.\n\n> On the other hand, if you can't Send them, just make them NoSend and have done with it. The only problem with making thread locals NoSend is that then you can't send them between tasks in fork-join style APIs. If you can't resolve the issues above, there's probably no sane way of determining that anyway so you might as well ban it (and really, I think it's a pretty niche usecase to want shared thread local data).\n\nIt's possible to get a reference to the value inside the thread-local variable, and it should be considered as having a `'static` lifetime but without being considered `Send`. It will be possible to do this regardless of how you wrap it. It's possible to restrict the lifetime with a context object (like `RefCell`) but that's overly strict.\n\n> I don't think semantics are a good argument here. There are lots of examples of things that aren't \"semantically\" 'static, like data in Rcs (which can never outlive its calling thread) that nonetheless get along without special lifetimes.\n\nThat's not the point here. The `Rc` type isn't a form of static variable that needs to be provided by the compiler.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58973297/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58973743",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58973743",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58973743,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4OTczNzQz",
    "user": {
      "login": "pythonesque",
      "id": 923144,
      "node_id": "MDQ6VXNlcjkyMzE0NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/923144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pythonesque",
      "html_url": "https://github.com/pythonesque",
      "followers_url": "https://api.github.com/users/pythonesque/followers",
      "following_url": "https://api.github.com/users/pythonesque/following{/other_user}",
      "gists_url": "https://api.github.com/users/pythonesque/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pythonesque/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pythonesque/subscriptions",
      "organizations_url": "https://api.github.com/users/pythonesque/orgs",
      "repos_url": "https://api.github.com/users/pythonesque/repos",
      "events_url": "https://api.github.com/users/pythonesque/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pythonesque/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-14T00:21:28Z",
    "updated_at": "2014-10-14T00:23:06Z",
    "body": "There is already a way to identify 'statics that are not Send, NoSend.  As far as I know, it has all the properties you're looking for.  What is the purpose of adding something functionally identical?  Am I missing some way in which it would or could conceivably work differently?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58973743/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58973972",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58973972",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58973972,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4OTczOTcy",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-14T00:24:27Z",
    "updated_at": "2014-10-14T00:24:27Z",
    "body": "It's not functionally identical. It should be possible for a thread-local `static` to contain `Cell<u32>` and to obtain an `&Cell<u32>` reference to it with a static lifetime, but without it being sendable. The `NoSend` marker only helps when you're creating a new type, which is not able to express the same things.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58973972/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58974189",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58974189",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58974189,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4OTc0MTg5",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-14T00:26:57Z",
    "updated_at": "2014-10-14T00:29:19Z",
    "body": "There's _already_ a feature gate for `thread_local` and it makes sense to fix the soundness issues with it behind that feature gate. It makes sense to have macros wrapping it in the short-term before the compiler implementation is solid / sound and fully portable, but eventually it would be nice to have an implementation that's on par with C++ and D without the need for macro hacks. Using macros / wrappers reduces the expressiveness and makes it more painful to use.\n\nIn C++, you just mark a global variable as `thread_local` and _everything_ just works including lazy initialization on first access and destructors in reverse order of the lazy initialization. There's no reason this can't be implemented in Rust with macros for the near future and eventually by just fixing the edge cases in the compiler feature.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58974189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58974539",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58974539",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58974539,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4OTc0NTM5",
    "user": {
      "login": "pythonesque",
      "id": 923144,
      "node_id": "MDQ6VXNlcjkyMzE0NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/923144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pythonesque",
      "html_url": "https://github.com/pythonesque",
      "followers_url": "https://api.github.com/users/pythonesque/followers",
      "following_url": "https://api.github.com/users/pythonesque/following{/other_user}",
      "gists_url": "https://api.github.com/users/pythonesque/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pythonesque/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pythonesque/subscriptions",
      "organizations_url": "https://api.github.com/users/pythonesque/orgs",
      "repos_url": "https://api.github.com/users/pythonesque/repos",
      "events_url": "https://api.github.com/users/pythonesque/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pythonesque/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-14T00:31:51Z",
    "updated_at": "2014-10-14T00:31:51Z",
    "body": "Okay, I see your objection now, that makes sense.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58974539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58974748",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58974748",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58974748,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4OTc0NzQ4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-14T00:34:42Z",
    "updated_at": "2014-10-14T00:34:54Z",
    "body": "Also, the lifetime would likely be called `'thread_local` or `'thread`, not `'task`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58974748/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58975004",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-58975004",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 58975004,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4OTc1MDA0",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-14T00:37:13Z",
    "updated_at": "2014-10-14T00:38:22Z",
    "body": "Anyway, until Rust no longer has to worry about 32-bit iOS and old versions of Android it's a dead end. It doesn't really matter if it's safe or not at the moment because it's just an implementation detail for a safe library making use of it. I'm just pointing out that Rust _could_ have TLS that's as easy to use as it is in C++11 and D rather than doing it via library hacks.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/58975004/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/99832521",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-99832521",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 99832521,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk5ODMyNTIx",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-07T11:59:09Z",
    "updated_at": "2015-05-07T11:59:09Z",
    "body": "Updated code:\n\n```\n#![feature(thread_local)]\n#[thread_local]\nstatic FOO: usize = 3;\n\nfn main() {\n    let a = &FOO;\n    let jg = std::thread::spawn(move || {\n        println!(\"{}\", a);\n    });\n\n    jg.join().unwrap();\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/99832521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/196620105",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-196620105",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 196620105,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NjYyMDEwNQ==",
    "user": {
      "login": "bltavares",
      "id": 109474,
      "node_id": "MDQ6VXNlcjEwOTQ3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/109474?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bltavares",
      "html_url": "https://github.com/bltavares",
      "followers_url": "https://api.github.com/users/bltavares/followers",
      "following_url": "https://api.github.com/users/bltavares/following{/other_user}",
      "gists_url": "https://api.github.com/users/bltavares/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bltavares/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bltavares/subscriptions",
      "organizations_url": "https://api.github.com/users/bltavares/orgs",
      "repos_url": "https://api.github.com/users/bltavares/repos",
      "events_url": "https://api.github.com/users/bltavares/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bltavares/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-03-15T02:27:09Z",
    "updated_at": "2016-03-15T02:27:09Z",
    "body": "The updated code still compiles on `rustc 1.9.0-nightly (c9629d61c 2016-03-10)`, when it shouldn't.\n\nCode used:\n\n``` rust\n#![feature(thread_local)]\n#[thread_local]\nstatic FOO: usize = 3;\n\nfn main() {\n    let a = &FOO;\n    let jg = std::thread::spawn(move || {\n        println!(\"{}\", a);\n    });\n\n    jg.join().unwrap();\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/196620105/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/196653308",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-196653308",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 196653308,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NjY1MzMwOA==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-03-15T04:39:50Z",
    "updated_at": "2016-03-15T04:39:50Z",
    "body": "Coming back to this: I think I've come to accept the simpler solution of not giving TLS variables a specific named lifetime but rather the outermost scope of the current function.\n\nThat would require banning references from any other statics too.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/196653308/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/197473732",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-197473732",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 197473732,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NzQ3MzczMg==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-03-16T18:28:11Z",
    "updated_at": "2016-03-16T18:28:11Z",
    "body": "label: T-lang \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/197473732/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/197473792",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-197473792",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 197473792,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NzQ3Mzc5Mg==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-03-16T18:28:19Z",
    "updated_at": "2016-03-16T18:28:19Z",
    "body": "er, meant to add that as a tag...\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/197473792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/198094363",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-198094363",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 198094363,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5ODA5NDM2Mw==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-03-17T21:40:50Z",
    "updated_at": "2016-03-17T21:40:50Z",
    "body": "Removing nomination as it doesn't seem that important to resolve this imminently. It'd be good to have a summary comment though of major points in the thread.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/198094363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/198094434",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-198094434",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 198094434,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5ODA5NDQzNA==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-03-17T21:40:55Z",
    "updated_at": "2016-03-17T21:40:55Z",
    "body": "triage: P-medium\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/198094434/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/247127017",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-247127017",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 247127017,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NzEyNzAxNw==",
    "user": {
      "login": "nagisa",
      "id": 679122,
      "node_id": "MDQ6VXNlcjY3OTEyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nagisa",
      "html_url": "https://github.com/nagisa",
      "followers_url": "https://api.github.com/users/nagisa/followers",
      "following_url": "https://api.github.com/users/nagisa/following{/other_user}",
      "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions",
      "organizations_url": "https://api.github.com/users/nagisa/orgs",
      "repos_url": "https://api.github.com/users/nagisa/repos",
      "events_url": "https://api.github.com/users/nagisa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nagisa/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-09-14T19:29:05Z",
    "updated_at": "2016-09-14T19:29:05Z",
    "body": "## Short summary:\n- Is still a problem, thread-local accesses gain the `'static` lifetime;\n- Need `'task`/`'thread`/etc lifetime, which is equal to (or smaller than) lifetime of the thread which accesses the thread-local;\n- `NoSend`-equivalent is not a solution, because the static may contain some internal fields of which you could still take a `'static` reference of (i.e. `Something(Cell<T>)` \u2192 `&'static Cell<T>` and send _that_ reference);\n- Giving the TLS data accessed the function\u2019s outermost scope lifetime would work\u00b9;\n\n\u00b9: Can\u2019t freely use (e.g. return out of function which accesses the TLS) the reference within the thread either, though?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/247127017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/300594159",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-300594159",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 300594159,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwMDU5NDE1OQ==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-10T19:53:21Z",
    "updated_at": "2017-05-10T19:53:21Z",
    "body": "So since it seems we don't want the `'thread` lifetime (judging by comments on this RFC: https://github.com/rust-lang/rfcs/pull/1705, should we close this as well? It seems we can't implement this without that RFC's thread lifetime, and as such it's not worth keeping this open. Arguably, maybe `#[thread_local]` should be deprecated and removed in favor of `thread_local!`, though I don't know the differences between the two.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/300594159/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/300608454",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-300608454",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 300608454,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwMDYwODQ1NA==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-10T20:50:51Z",
    "updated_at": "2017-05-10T20:50:51Z",
    "body": "I still want the semantics that make thread-local accesses like function arguments: can't let them escape.\r\nIn @nagisa's list, it's the last option. IMO the only one we can be certain of soundness for (or at least it allows no more than what `thread_local!` already does) and it's fairly straight-forward to implement.\r\nIf you want you can assign to me (famous last words).",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/300608454/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/312025904",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-312025904",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 312025904,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMjAyNTkwNA==",
    "user": {
      "login": "pythonesque",
      "id": 923144,
      "node_id": "MDQ6VXNlcjkyMzE0NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/923144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pythonesque",
      "html_url": "https://github.com/pythonesque",
      "followers_url": "https://api.github.com/users/pythonesque/followers",
      "following_url": "https://api.github.com/users/pythonesque/following{/other_user}",
      "gists_url": "https://api.github.com/users/pythonesque/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pythonesque/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pythonesque/subscriptions",
      "organizations_url": "https://api.github.com/users/pythonesque/orgs",
      "repos_url": "https://api.github.com/users/pythonesque/repos",
      "events_url": "https://api.github.com/users/pythonesque/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pythonesque/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-29T16:48:56Z",
    "updated_at": "2017-06-29T16:48:56Z",
    "body": "To clarify: IMO it's still important to be able to be able to use thread locals directly, since thread_local! does have significant overhead by comparison.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/312025904/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/315783862",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-315783862",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 315783862,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNTc4Mzg2Mg==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-07-17T15:09:15Z",
    "updated_at": "2017-07-17T15:09:15Z",
    "body": "@pythonesque do you have benchmarks to back that up? IIRC, @alexcrichton gathered various numbers that seemed to suggest the opposite, but I may be mis-remembering.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/315783862/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320540222",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-320540222",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 320540222,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMDU0MDIyMg==",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-08-06T23:37:16Z",
    "updated_at": "2017-08-06T23:40:22Z",
    "body": "@nikomatsakis Can confirm that `thread_local!` is slow.\r\n\r\nI'm implementing my own channels (similar to `std::sync::mpsc`). When selecting over multiple channels, thread locals are accessed several times. I'm timing 2 million channel selects:\r\n\r\n* With `thread_local!`: 200 ms\r\n* With `#[thread_local]`: 130 ms\r\n\r\nThe difference is significant enough to be a real-world problem.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320540222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320561197",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-320561197",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 320561197,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMDU2MTE5Nw==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-08-07T03:37:08Z",
    "updated_at": "2017-08-07T03:37:08Z",
    "body": "Yes there's no debate that `thread_local!` has overhead, a [simple example](https://play.rust-lang.org/?gist=9616a817659dba2dc5e98c96c96d96ae&version=nightly) looking at the assembly and the IR will show that. What I gathered previously is that in all use cases we wanted `thread_local!` for in the standard library it had non-measurable overhead.\r\n\r\nTo actually quantify what's going on here, the `#[thread_local]` version of TLS keys [initializes itself with `None`](https://github.com/rust-lang/rust/blob/master/src/libstd/thread/local.rs#L399) and like all other `thread_local!` variables it's lazily initialized. This forces a branch on all accesses and stores of the TLS variable of \"am I initialized yet?\" The raw `#[thread_local]` version is obviously initialized as part of the `static`, so this check does not exist. This means that direct `#[thread_local]` will have fewer branches with it.\r\n\r\nI do not think we should strive to stabilize `#[thread_local]`. It's *incredibly* not portable which maeks it not too useful for most software. We should strive to improve `thread_local!`. The feature to implement is for the compiler to understand whether the initialization expression is a constant expression or not. If it's a constant expression then we can bypass the `None` storage and \"am I initialized checks\", making it equivalent to raw `#[thread_local]`",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320561197/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320626052",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-320626052",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 320626052,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMDYyNjA1Mg==",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-08-07T10:16:12Z",
    "updated_at": "2017-08-07T10:16:12Z",
    "body": "> I do not think we should strive to stabilize `#[thread_local]`. It's incredibly not portable which makes it not too useful for most software. We should strive to improve `thread_local!`. \r\n\r\nOk, since `#[thread_local]` isn't going to be stabilized, its only purpose is to allow faster implementation of `thread_local!` on some platforms. Can we then fix the soundness issue by making any access to a `#[thread_local]` unsafe and call it a day?\r\n\r\n> The feature to implement is for the compiler to understand whether the initialization expression is a constant expression or not.\r\n\r\nI like this idea. What would it take to implement this today, or at least what would be the first step forward?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320626052/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320627050",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-320627050",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 320627050,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMDYyNzA1MA==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-08-07T10:21:33Z",
    "updated_at": "2017-08-07T10:21:33Z",
    "body": "> Can we then fix the soundness issue by making any access to a `#[thread_local]` unsafe and call it a day?\r\n\r\nI'll just open a PR with my solution, it shouldn't be hard at all...\r\n\r\n> The feature to implement is for the compiler to understand whether the initialization expression is a constant expression or not.\r\n\r\nThat's easy *in the compiler* but `thread_local!` is not implemented in the compiler.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320627050/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320633610",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-320633610",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 320633610,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMDYzMzYxMA==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-08-07T10:56:14Z",
    "updated_at": "2017-08-07T10:56:14Z",
    "body": "> That's easy in the compiler but `thread_local!` is not implemented in the compiler.\r\n\r\n... But we could add an `eager_thread_local!` macro for that case.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320633610/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320659781",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-320659781",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 320659781,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMDY1OTc4MQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-08-07T13:14:24Z",
    "updated_at": "2017-08-07T13:14:24Z",
    "body": "@stjepang yeah right now `#[thread_local]` is just an implementation detail essentially of the `thread_local!` macro. Making all access to a `#[thread_local]` static would be fine by me, although I would personally still not advocate for its stabilization, even if this bug were fixed.\r\n\r\nAs for how to implement a \"const expr detection\" in a macro I'm not entirely sure. We could either move the implementation into the compiler (which I'd prefer to avoid) or take @arielb1's suggestion of a new macro or a variant of the current macro's syntax.\r\n\r\nFor example we could \"perverse\" the meaning via: `thread_local!(const A: i32 = 3);` where `static` in the macro means \"lazily initialized, but any expression valid\" and `const` means \"must be a constant expression\". I don't think this is a good idea, but an example of what we might do.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/320659781/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/321987340",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-321987340",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 321987340,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTk4NzM0MA==",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-08-12T15:14:34Z",
    "updated_at": "2017-08-12T15:15:06Z",
    "body": "Thanks @eddyb for fixing this issue!\r\n\r\nCan we create a new issue for the optimization part (thread locals initialized by a constant expression should bypass the \"am I initialized\" check on every access)?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/321987340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/321987709",
    "html_url": "https://github.com/rust-lang/rust/issues/17954#issuecomment-321987709",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17954",
    "id": 321987709,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTk4NzcwOQ==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-08-12T15:21:44Z",
    "updated_at": "2017-08-12T15:21:44Z",
    "body": "@stjepang Sure, but I'm not sure how to do that cleanly to be honest.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/321987709/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
