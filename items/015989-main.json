{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/15989",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/15989/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/15989/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/15989/events",
  "html_url": "https://github.com/rust-lang/rust/pull/15989",
  "id": 38775755,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTg5MjI2MTU=",
  "number": 15989,
  "title": "librustc: Disallow mutation and assignment in pattern guards, and modify",
  "user": {
    "login": "pcwalton",
    "id": 157897,
    "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pcwalton",
    "html_url": "https://github.com/pcwalton",
    "followers_url": "https://api.github.com/users/pcwalton/followers",
    "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
    "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
    "organizations_url": "https://api.github.com/users/pcwalton/orgs",
    "repos_url": "https://api.github.com/users/pcwalton/repos",
    "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pcwalton/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 3,
  "created_at": "2014-07-25T22:24:35Z",
  "updated_at": "2014-07-29T19:21:45Z",
  "closed_at": "2014-07-29T19:21:45Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/15989",
    "html_url": "https://github.com/rust-lang/rust/pull/15989",
    "diff_url": "https://github.com/rust-lang/rust/pull/15989.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/15989.patch",
    "merged_at": null
  },
  "body": "the CFG for match statements.\n\nThere were two bugs in issue #14684. One was simply that the borrow\ncheck didn't know about the correct CFG for match statements: the\npattern must be a predecessor of the guard. This disallows the bad\nbehavior if there are bindings in the pattern. But it isn't enough to\nprevent the memory safety problem, because of wildcards; thus, this\npatch introduces a more restrictive rule, which disallows assignments\nand mutable borrows inside guards outright.\n\nI discussed this with Niko and we decided this was the best plan of\naction.\n\nThis breaks code that performs mutable borrows in pattern guards. Most\ncommonly, the code looks like this:\n\n```\nimpl Foo {\n    fn f(&mut self, ...) {}\n    fn g(&mut self, ...) {\n        match bar {\n            Baz if self.f(...) => { ... }\n            _ => { ... }\n        }\n    }\n}\n```\n\nChange this code to not use a guard. For example:\n\n```\nimpl Foo {\n    fn f(&mut self, ...) {}\n    fn g(&mut self, ...) {\n        match bar {\n            Baz => {\n                if self.f(...) {\n                    ...\n                } else {\n                    ...\n                }\n            }\n            _ => { ... }\n        }\n    }\n}\n```\n\nSometimes this can result in code duplication, but often it illustrates\na hidden memory safety problem.\n\nCloses #14684.\n\n[breaking-change]\n\nr? @pnkfelix\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/15989/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/15989/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
