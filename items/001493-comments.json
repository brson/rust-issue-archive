[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3452990",
    "html_url": "https://github.com/rust-lang/rust/issues/1493#issuecomment-3452990",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1493",
    "id": 3452990,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTI5OTA=",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-01-11T20:29:39Z",
    "updated_at": "2012-01-11T20:29:39Z",
    "body": "If this ends up going through, please file a bug to update the debuginfo representation of boxes.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3452990/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3496305",
    "html_url": "https://github.com/rust-lang/rust/issues/1493#issuecomment-3496305",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1493",
    "id": 3496305,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTYzMDU=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-01-15T01:02:09Z",
    "updated_at": "2012-01-15T01:04:47Z",
    "body": "This is a major perf issue and is why our binarytrees shootout benchmark takes 20x as long as gcc. I'm going to be updating that benchmark to use unique pointers instead of boxes.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3496305/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3533458",
    "html_url": "https://github.com/rust-lang/rust/issues/1493#issuecomment-3533458",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1493",
    "id": 3533458,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzM0NTg=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-01-17T18:56:30Z",
    "updated_at": "2012-01-17T18:56:30Z",
    "body": "I started looking into fixing this.  What makes it annoying is that we currently rely on the map to enumerate the allocations we have done.  Probably the best way to fix this is to rewrite the allocators to use per-task arenas; as each allocation is self-describing, we could then walk the arena fairly easily by examining the type descriptors.  The annoying part is we'll have to handle the free logic ourselves (it is, admittedly, not terribly complex to do).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3533458/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3663601",
    "html_url": "https://github.com/rust-lang/rust/issues/1493#issuecomment-3663601",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1493",
    "id": 3663601,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NjM2MDE=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-01-26T02:55:39Z",
    "updated_at": "2012-01-26T02:55:39Z",
    "body": "I've thought about this some more.  I think the best thing for now is just to use some optimized allocator (jemalloc, say) and allocate a little header so that we can basically keep a doubly linked list of all outstanding allocations.  Basically, the header for every box would be:\n\n```\nstruct box_header {\n    type_desc *td;\n    int ref_count;\n    box_header *prev;\n    box_header *next;\n}\n```\n\nIt's a pity to have so much per-object overhead, but I do not believe the other schemes I was thinking about will not be efficient unless we have a compacting collector, and I have no interest in implementing THAT right now.  Basically, although we could keep a packed heap and walk from allocation to allocation, we'd have no efficient way to skip those allocations which have been freed, so we'd end up walking _all_ allocations that have been performed by the task.  This is ok if you're doing a compacting collector so your fragmentation is low but unless we try and get real smart it seems to me that fragmentation could become quite high.\n\nIf anyone thinks they have a better idea let me know. =) Otherwise I will implement it this way (might be worth doing as an intermediate step anyhow)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3663601/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3706595",
    "html_url": "https://github.com/rust-lang/rust/issues/1493#issuecomment-3706595",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1493",
    "id": 3706595,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDY1OTU=",
    "user": {
      "login": "ssylvan",
      "id": 1365415,
      "node_id": "MDQ6VXNlcjEzNjU0MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1365415?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ssylvan",
      "html_url": "https://github.com/ssylvan",
      "followers_url": "https://api.github.com/users/ssylvan/followers",
      "following_url": "https://api.github.com/users/ssylvan/following{/other_user}",
      "gists_url": "https://api.github.com/users/ssylvan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ssylvan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ssylvan/subscriptions",
      "organizations_url": "https://api.github.com/users/ssylvan/orgs",
      "repos_url": "https://api.github.com/users/ssylvan/repos",
      "events_url": "https://api.github.com/users/ssylvan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ssylvan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-01-29T04:43:27Z",
    "updated_at": "2012-01-29T04:43:27Z",
    "body": "A random idea to reduce the per-object overhead is the observation that you only _really_ need the \"next object\" pointer for objects located right before free space (for runs of non-free objects you just use the object sizes to get the next object). Well, since they're adjacent to free space, you can store the pointer _in_ that free space (so the header structure would be  just td+ref_count). So basically, the first header in a run of free objects would signifiy that it's been free'd somehow (e.g. ref_count==0), and also store a \"skip distance\" to the next non-free object. The skip distance could be stored in the space the \"td\" pointer would normally take, as its not needed for a free'd object.\n\nThis skip distance can be updated opportunistically when freeing an object (if the next object down is also free, set your skip distance to equal its skip distance plus your own size). This obviously won't get you all the way there (although stack-owned allocations tend to cause deallocations in reverse allocation order so it may work out well!). The first time you traverse the arena you'd do a real patch-up to merge runs of free space so the first object in the run skips past the whole thing. \nFor a pathological pattern of deallocations you can end up having to traverse every single object (including free'd ones) the first time through.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3706595/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3706914",
    "html_url": "https://github.com/rust-lang/rust/issues/1493#issuecomment-3706914",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1493",
    "id": 3706914,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDY5MTQ=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-01-29T06:25:26Z",
    "updated_at": "2012-01-29T06:25:26Z",
    "body": "That's an interesting idea.  I think what I'll do is implement this in stages: first, the \"large header\" variant.  Then, open a new bug to optimize local allocations better if it seems necessary.  The work towards the \"large header\" variant basically has to be done anyways. (I'm part of the way through now, still in testing phase)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3706914/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
