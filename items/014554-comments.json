[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44717811",
    "html_url": "https://github.com/rust-lang/rust/pull/14554#issuecomment-44717811",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14554",
    "id": 44717811,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NzE3ODEx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-31T04:37:52Z",
    "updated_at": "2014-05-31T04:37:52Z",
    "body": "Having syntax extensions forcibly depend on librustc seems to go against one of the major goals of refactoring syntax out of rustc, as well as the current design. I didn't see any wording about this in the RFC, can you explain why this dependency has been picked up?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44717811/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44759560",
    "html_url": "https://github.com/rust-lang/rust/pull/14554#issuecomment-44759560",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14554",
    "id": 44759560,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NzU5NTYw",
    "user": {
      "login": "kmcallister",
      "id": 444997,
      "node_id": "MDQ6VXNlcjQ0NDk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kmcallister",
      "html_url": "https://github.com/kmcallister",
      "followers_url": "https://api.github.com/users/kmcallister/followers",
      "following_url": "https://api.github.com/users/kmcallister/following{/other_user}",
      "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions",
      "organizations_url": "https://api.github.com/users/kmcallister/orgs",
      "repos_url": "https://api.github.com/users/kmcallister/repos",
      "events_url": "https://api.github.com/users/kmcallister/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kmcallister/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-31T20:58:21Z",
    "updated_at": "2014-05-31T20:58:21Z",
    "body": "This was discussed mainly in [@kballard's comment](https://github.com/rust-lang/rfcs/pull/86#discussion-diff-12978558) and then [on IRC](https://botbot.me/mozilla/rust-internals/2014-05-22/?msg=15075433&page=5) (linked on the RFC thread too).\n\nThe issue is that we want to register all plugins through a single interface, so that interface needs to use types from both `libsyntax` (for syntax extensions) and `librustc` (for lints etc.).  Putting it in `librustc` was the simplest way to accomplish this.\n\nIt makes sense to me that syntax extensions are `rustc` plugins not `libsyntax` plugins.  You're telling `rustc::driver` to open some crates, read their metadata, and pass some of the results to `libsyntax`.\n\nMetadata is defined within `librustc`; the old implementation only worked because of a `CrateLoader` trait defined in `libsyntax` and implemented by `librustc`.  A third-party user of `libsyntax` would need to implement this trait, as the old test cases in `expand.rs` did.  This isn't too different from the new situation, where you pass a vector of exported macros and a vector of syntax extensions to `expand_crate`.\n\nI'm not against moving plugin stuff to its own crate (along with metadata reading?) and implementing something like [@kballard's type-keyed map](https://github.com/rust-lang/rfcs/pull/86#issuecomment-43954366) to break the unconditional dependency on `librustc` and `libsyntax`.  But I don't think that design work should block landing plugins and loadable lints.  Plugins are feature-gated and the interface can continue to evolve as we get a better idea what external users of `libsyntax` want.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44759560/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44767562",
    "html_url": "https://github.com/rust-lang/rust/pull/14554#issuecomment-44767562",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14554",
    "id": 44767562,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NzY3NTYy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-01T04:47:39Z",
    "updated_at": "2014-06-01T04:47:39Z",
    "body": "By introducing a dependency on librustc, we're essentially exposing the _entire compiler_ as the interface that syntax extensions have to work with. It's bad enough exposing all of libsyntax where it itself doesn't have a stable interface.\n\nI don't think I understand the use case for depending on librustc to have a unified interface for registering plugins. Does this patch currently have examples of how a syntax extension now depends on librustc? The cited example is lints, but I can imagine a world where pluggable lints work without librustc.\n\nI think the idea of moving the syntax extension interface to its own crate is a great one because it can be a concrete stable API for future syntax extensions. That said, it probably won't happen for some time. \n\nAlso, while I agree that this is all feature gated and everything, it doesn't mean that we should throw caution to the wind and accidentally take steps backwards. We should always consider the future direction to go in, regardless of whether it is a large guiding presence at this time or not. I'm not saying that this should block for the perfect design, but \"we want this now, not later\" doesn't mean that we should basically accept anything that works.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44767562/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44802281",
    "html_url": "https://github.com/rust-lang/rust/pull/14554#issuecomment-44802281",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14554",
    "id": 44802281,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0ODAyMjgx",
    "user": {
      "login": "kmcallister",
      "id": 444997,
      "node_id": "MDQ6VXNlcjQ0NDk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kmcallister",
      "html_url": "https://github.com/kmcallister",
      "followers_url": "https://api.github.com/users/kmcallister/followers",
      "following_url": "https://api.github.com/users/kmcallister/following{/other_user}",
      "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions",
      "organizations_url": "https://api.github.com/users/kmcallister/orgs",
      "repos_url": "https://api.github.com/users/kmcallister/repos",
      "events_url": "https://api.github.com/users/kmcallister/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kmcallister/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-02T05:04:27Z",
    "updated_at": "2014-06-02T05:04:27Z",
    "body": "> By introducing a dependency on librustc, we're essentially exposing the entire compiler as the interface that syntax extensions have to work with.\n\nI don't think so.  It's already the case that syntax extension crates can link `librustc` if they want to.  There's a convention that you don't do so.  And in the new world there's a convention that you don't use modules outside of `rustc::plugin`.  We don't enforce either convention, but we don't yet ensure the `#[macro_registrar]` function has the right type, either.\n\nIf you think that convention should be documented more explicitly, I can certainly do that.\n\n> It's bad enough exposing all of libsyntax where it itself doesn't have a stable interface.\n\nYeah, that's part of why I don't think this is much of a regression. We're not currently getting some huge benefit from a stable, clean `libsyntax` API.  In fact there's no way to load syntax extension crates at all without importing the metadata parsing from `librustc` or reimplementing it yourself.\n\n> I don't think I understand the use case for depending on librustc to have a unified interface for registering plugins.\n\nTake a look at my [`lint_prototype`](https://github.com/kmcallister/rust/blob/lint_prototype/src/librustc/plugin/registry.rs#L77-L79) branch and [the demo](https://gist.github.com/kmcallister/f47ee925a16773be4f84).  (This is not merge-quality code! I'm working on implementing it \"for real\" right now.)  A `#[plugin_registrar]` gets a `Registry`; a `Registry` has methods for registering lints; a lint depends on `librustc` types.  So writing a `#[plugin_registrar]` requires linking `librustc` to get `Registry`, unless we do tricks [like @kballard proposed](https://github.com/rust-lang/rfcs/pull/86#issuecomment-43954366). Which, again, I'm not against doing, but I don't consider it necessary for v1 of this feature.\n\nNothing _in this branch_ requires `Registry` to be defined within `librustc`. The whole point of the branch is to clear the way for future work which will.  But this isn't premature overgeneralization; you can already see the necessity in the prototype above.\n\n> I can imagine a world where pluggable lints work without librustc\n\nMaybe some of them, but a lot of the existing lints talk to the typechecker, for example.  The lint I want to write for Servo will need to know the inferred types of `let` variables to ensure they don't contain `JS<T>`.  Preventing pluggable lints from talking to the typechecker would severely limit the utility of the feature.\n\n> Also, while I agree that this is all feature gated and everything, it doesn't mean that we should throw caution to the wind and accidentally take steps backwards.\n\nThis isn't accidental; it was discussed on the RFC thread and on IRC and again by us here.\n\n> \"we want this now, not later\" doesn't mean that we should basically accept anything that works\n\nSure, and of course I agree in general.  We're just disagreeing on whether this particular tradeoff is acceptable or not.  I think it is, because we're not losing any major capability _that we have today_.  Getting those capabilities would require a stable `libsyntax` API, as well as factoring out metadata reading into its own crate.  If somebody is doing that work, it's not much marginal work to also move the plugin registrar at that time.  It _is_ an (easily resolved) breaking change for user code, and _that's_ why the feature-gated aspect is important.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44802281/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45378259",
    "html_url": "https://github.com/rust-lang/rust/pull/14554#issuecomment-45378259",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14554",
    "id": 45378259,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1Mzc4MjU5",
    "user": {
      "login": "kmcallister",
      "id": 444997,
      "node_id": "MDQ6VXNlcjQ0NDk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kmcallister",
      "html_url": "https://github.com/kmcallister",
      "followers_url": "https://api.github.com/users/kmcallister/followers",
      "following_url": "https://api.github.com/users/kmcallister/following{/other_user}",
      "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions",
      "organizations_url": "https://api.github.com/users/kmcallister/orgs",
      "repos_url": "https://api.github.com/users/kmcallister/repos",
      "events_url": "https://api.github.com/users/kmcallister/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kmcallister/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-06T20:00:56Z",
    "updated_at": "2014-06-06T20:00:56Z",
    "body": "Rebased.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45378259/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45551961",
    "html_url": "https://github.com/rust-lang/rust/pull/14554#issuecomment-45551961",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14554",
    "id": 45551961,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTUxOTYx",
    "user": {
      "login": "kmcallister",
      "id": 444997,
      "node_id": "MDQ6VXNlcjQ0NDk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kmcallister",
      "html_url": "https://github.com/kmcallister",
      "followers_url": "https://api.github.com/users/kmcallister/followers",
      "following_url": "https://api.github.com/users/kmcallister/following{/other_user}",
      "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions",
      "organizations_url": "https://api.github.com/users/kmcallister/orgs",
      "repos_url": "https://api.github.com/users/kmcallister/repos",
      "events_url": "https://api.github.com/users/kmcallister/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kmcallister/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-09T22:22:26Z",
    "updated_at": "2014-06-09T22:22:26Z",
    "body": "Sorry about the repeated breakage. I was having trouble running `make check` before, but I can do it now and this branch passes.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45551961/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
