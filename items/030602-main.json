{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/30602",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/30602/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/30602/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/30602/events",
  "html_url": "https://github.com/rust-lang/rust/pull/30602",
  "id": 124148217,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NTQ2OTYxOTc=",
  "number": 30602,
  "title": "MIR graphviz prettification",
  "user": {
    "login": "solson",
    "id": 26806,
    "node_id": "MDQ6VXNlcjI2ODA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/solson",
    "html_url": "https://github.com/solson",
    "followers_url": "https://api.github.com/users/solson/followers",
    "following_url": "https://api.github.com/users/solson/following{/other_user}",
    "gists_url": "https://api.github.com/users/solson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/solson/subscriptions",
    "organizations_url": "https://api.github.com/users/solson/orgs",
    "repos_url": "https://api.github.com/users/solson/repos",
    "events_url": "https://api.github.com/users/solson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/solson/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "nikomatsakis",
    "id": 155238,
    "node_id": "MDQ6VXNlcjE1NTIzOA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nikomatsakis",
    "html_url": "https://github.com/nikomatsakis",
    "followers_url": "https://api.github.com/users/nikomatsakis/followers",
    "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
    "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
    "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
    "repos_url": "https://api.github.com/users/nikomatsakis/repos",
    "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 17,
  "created_at": "2015-12-29T01:22:18Z",
  "updated_at": "2016-01-04T22:16:36Z",
  "closed_at": "2016-01-04T22:09:58Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/30602",
    "html_url": "https://github.com/rust-lang/rust/pull/30602",
    "diff_url": "https://github.com/rust-lang/rust/pull/30602.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/30602.patch",
    "merged_at": "2016-01-04T22:09:58Z"
  },
  "body": "r? @nikomatsakis \n\ncc @eddyb @nagisa \n\nThis PR changes most of the MIR graphviz debug output, making it smaller and more consistent. Also, it changes all fonts to monospace and adds a graph label containing the type of the `fn` the MIR is for and all the values (arguments, named bindings, and compiler temporaries).\n\nI chose to re-write the graphviz output code instead of using the existing libgraphviz API because I found it much easier to prototype usage of various graphviz features when I had full control of the text output. It also makes the code simpler, I think.\n\nBelow are a bunch of example functions and links to their output images on the current nightly vs. this PR. File names starting with numbers (e.g. `80-factorial_fold-new.png`) are for closures. There's still a bunch of low hanging fruit to make it even better, particularly around aggregates and references.\n\nI also imagine the textual output for MIR will be able to closely match the graphviz output. The list of statements should look identical and the terminators will be the same except that the text form will have a list of target blocks (potentially using the same edge labels as the graphviz does). I can PR a simple text output right after this PR.\n\nThis is my first large change to the compiler, so if anything should be reorganized/renamed/etc, let me know! Also, feel free to bikeshed the details of the output, though any minor changes can come in future PRs.\n\n``` rust\n#[rustc_mir(graphviz = \"empty.dot\")]\nfn empty() {}\n```\n\nhttp://vps.solson.me/mir-graphviz/empty-new.png\nhttp://vps.solson.me/mir-graphviz/empty-old.png\n\n``` rust\n#[rustc_mir(graphviz = \"constant.dot\")]\nfn constant() -> i32 {\n    42\n}\n```\n\nhttp://vps.solson.me/mir-graphviz/constant-new.png\nhttp://vps.solson.me/mir-graphviz/constant-old.png\n\n``` rust\n#[rustc_mir(graphviz = \"increment.dot\")]\nfn increment(x: i32) -> i32 {\n    x + 1\n}\n```\n\nhttp://vps.solson.me/mir-graphviz/increment-new.png\nhttp://vps.solson.me/mir-graphviz/increment-old.png\n\n``` rust\n#[rustc_mir(graphviz = \"factorial_recursive.dot\")]\nfn factorial_recursive(n: usize) -> usize {\n    if n == 0 {\n        1\n    } else {\n        n * factorial_recursive(n - 1)\n    }\n}\n```\n\nhttp://vps.solson.me/mir-graphviz/factorial_recursive-new.png\nhttp://vps.solson.me/mir-graphviz/factorial_recursive-old.png\n\n``` rust\n#[rustc_mir(graphviz = \"factorial_iterative.dot\")]\nfn factorial_iterative(n: usize) -> usize {\n    let mut prod = 1;\n    for x in 1..n {\n        prod *= x;\n    }\n    prod\n}\n```\n\nhttp://vps.solson.me/mir-graphviz/factorial_iterative-new.png\nhttp://vps.solson.me/mir-graphviz/factorial_iterative-old.png\n\n``` rust\n#[rustc_mir(graphviz = \"factorial_fold.dot\")]\nfn factorial_fold(n: usize) -> usize {\n    (1..n).fold(1, |prod, x| prod * x)\n}\n```\n\nhttp://vps.solson.me/mir-graphviz/factorial_fold-new.png\nhttp://vps.solson.me/mir-graphviz/factorial_fold-old.png\nhttp://vps.solson.me/mir-graphviz/80-factorial_fold-new.png\nhttp://vps.solson.me/mir-graphviz/80-factorial_fold-old.png\n\n``` rust\n#[rustc_mir(graphviz = \"collatz.dot\")]\nfn collatz(mut n: usize) {\n    while n != 1 {\n        if n % 2 == 0 {\n            n /= 2;\n        } else {\n            n = 3 * n + 1;\n        }\n    }\n}\n```\n\nhttp://vps.solson.me/mir-graphviz/collatz-new.png\nhttp://vps.solson.me/mir-graphviz/collatz-old.png\n\n``` rust\n#[rustc_mir(graphviz = \"multi_switch.dot\")]\nfn multi_switch(n: usize) -> usize {\n    match n {\n        5 | 10 | 15 => 3,\n        20 | 30 => 2,\n        _ => 1,\n    }\n}\n```\n\nhttp://vps.solson.me/mir-graphviz/multi_switch-new.png\nhttp://vps.solson.me/mir-graphviz/multi_switch-old.png\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/30602/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/30602/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
