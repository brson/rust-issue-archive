[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/135988420",
    "html_url": "https://github.com/rust-lang/rust/issues/28072#issuecomment-135988420",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28072",
    "id": 135988420,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNTk4ODQyMA==",
    "user": {
      "login": "Ryman",
      "id": 994978,
      "node_id": "MDQ6VXNlcjk5NDk3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/994978?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ryman",
      "html_url": "https://github.com/Ryman",
      "followers_url": "https://api.github.com/users/Ryman/followers",
      "following_url": "https://api.github.com/users/Ryman/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ryman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ryman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ryman/subscriptions",
      "organizations_url": "https://api.github.com/users/Ryman/orgs",
      "repos_url": "https://api.github.com/users/Ryman/repos",
      "events_url": "https://api.github.com/users/Ryman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ryman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-29T13:50:51Z",
    "updated_at": "2015-08-29T13:50:51Z",
    "body": "I'm unsure about hygiene being broken here, if it leaked imports from the calling context into a generated module, I'd consider that to be really broken.\n\nThis might help you get what you need done: http://is.gd/Q9tXFx\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/135988420/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/154876112",
    "html_url": "https://github.com/rust-lang/rust/issues/28072#issuecomment-154876112",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28072",
    "id": 154876112,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1NDg3NjExMg==",
    "user": {
      "login": "nrc",
      "id": 762626,
      "node_id": "MDQ6VXNlcjc2MjYyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nrc",
      "html_url": "https://github.com/nrc",
      "followers_url": "https://api.github.com/users/nrc/followers",
      "following_url": "https://api.github.com/users/nrc/following{/other_user}",
      "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
      "organizations_url": "https://api.github.com/users/nrc/orgs",
      "repos_url": "https://api.github.com/users/nrc/repos",
      "events_url": "https://api.github.com/users/nrc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nrc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-08T21:35:41Z",
    "updated_at": "2015-11-08T21:35:41Z",
    "body": "As far as I understand it, Rust macros are not hygienic with respect to types at all. Since it would be a breaking change to fix this, it would need an RFC. Propose closing this issue or moving to RFC issues.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/154876112/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/156846403",
    "html_url": "https://github.com/rust-lang/rust/issues/28072#issuecomment-156846403",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28072",
    "id": 156846403,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1Njg0NjQwMw==",
    "user": {
      "login": "nejucomo",
      "id": 480497,
      "node_id": "MDQ6VXNlcjQ4MDQ5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/480497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nejucomo",
      "html_url": "https://github.com/nejucomo",
      "followers_url": "https://api.github.com/users/nejucomo/followers",
      "following_url": "https://api.github.com/users/nejucomo/following{/other_user}",
      "gists_url": "https://api.github.com/users/nejucomo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nejucomo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nejucomo/subscriptions",
      "organizations_url": "https://api.github.com/users/nejucomo/orgs",
      "repos_url": "https://api.github.com/users/nejucomo/repos",
      "events_url": "https://api.github.com/users/nejucomo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nejucomo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-15T19:45:32Z",
    "updated_at": "2015-11-15T19:45:32Z",
    "body": "Hi. I've just run across the same issue, and it took me a while to understand. My use is slightly different, although an interesting similarity is that I _first_ wanted to generate multiple functions in a macro expansion using gensym (or ident concatenation, or name mangling), and when I couldn't determine how to do that, I decided to introduce a module within the expansion.\n\nHere's the failing minimized example:\n\n```\nconst C: usize = 42;\n\nmacro_rules! mac {\n    ( $e:expr ) => {\n        mod a_test_mod {\n            #[test]\n            fn funky() {\n                println!(\"inside funky(), e is: {}\", $e);\n            }\n        }\n    }\n}\n\nmac!(C);\n```\n\nThe result is:\n\n```\n$ cargo test\n   Compiling macro-scoping-bug v0.1.0 (file:///home/n/sandbox/rust/macro-scoping-bug)\nsrc/main.rs:14:6: 14:7 error: unresolved name `C`\nsrc/main.rs:14 mac!(C);\n                    ^\nnote: in expansion of format_args!\n<std macros>:2:25: 2:56 note: expansion site\n<std macros>:1:1: 2:62 note: in expansion of print!\n<std macros>:3:1: 3:54 note: expansion site\n<std macros>:1:1: 3:58 note: in expansion of println!\nsrc/main.rs:8:17: 8:58 note: expansion site\nsrc/main.rs:3:1: 12:2 note: in expansion of mac!\nsrc/main.rs:14:1: 14:9 note: expansion site\nerror: aborting due to previous error\nCould not compile `macro-scoping-bug`.\n\nTo learn more, run the command again with --verbose.\n```\n\nHere is a \"fix\" which seems counter-intuitive without realizing that items and/or paths aren't hygienic:\n\n```\nconst C: usize = 42;\n\nmacro_rules! mac {\n    ( $e:expr ) => {\n        mod a_test_mod {\n            use super::C;\n\n            #[test]\n            fn funky() {\n                println!(\"inside funky(), e is: {}\", $e);\n            }\n        }\n    }\n}\n\nmac!(C);\n```\n\nHere's a second fix which is similarly counter-intuitive (for me at least):\n\n```\nconst C: usize = 42;\n\nmacro_rules! mac {\n    ( $e:expr ) => {\n        mod a_test_mod {\n            #[test]\n            fn funky() {\n                println!(\"inside funky(), e is: {}\", $e);\n            }\n        }\n    }\n}\n\nmac!(super::C);\n```\n\nNote that this macro defines items which should \"leak out\" so I think I want hygiene in one case, but not the other. Perhaps I want to eat my cake and have it, too. (See #28335 for an example of someone expecting some kind of \"exported item definition hygiene\".)\n\nOne final note to motivate my use case, I have something like:\n\n```\nconst C: usize = 42;\n\nmacro_rules! define_tests {\n    ( $name:ident $e:expr ) => {\n        mod $name {\n            #[test]\n            fn test_one_way() {\n                ...\n            }\n\n            #[test]\n            fn test_another_way() {\n                ...\n            }\n        }\n    }\n}\n\n/* Run both kinds of tests on various boundary conditions: */\ndefine_tests!(one_c, super::C);\ndefine_tests!(one_less_than_c, super::C - 1);\ndefine_tests!(one_more_than_c, super::C + 1);\ndefine_tests!(two_c, super::C + super::C);\n```\n\nAs I said above, another approach is to remove the intermediate module and then use name mangling to ensure all of the test functions have unique names. I haven't tried that yet, but from #12249 I'm lead to believe that approach won't work.  (I find this hierarchical mod approach to be \"cleaner\" anyway.)\n\nPhew, ok... so for the purpose of this ticket, given the current accepted design of \"partial hygiene\" for macros, maybe the best improvement is to have some of these examples in [the chapter on macros in the book](https://doc.rust-lang.org/book/macros.html).\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/156846403/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/299241538",
    "html_url": "https://github.com/rust-lang/rust/issues/28072#issuecomment-299241538",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28072",
    "id": 299241538,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTI0MTUzOA==",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-04T16:41:16Z",
    "updated_at": "2017-05-04T16:42:39Z",
    "body": "Current error\r\n\r\n```\r\n\r\n\r\nrustc 1.17.0 (56124baa9 2017-04-24)\r\nerror[E0433]: failed to resolve. Use of undeclared type or module `std`\r\n  --> <anon>:10:17\r\n   |\r\n10 | f! { fn bar(z: &std::io::Read); }\r\n   | ----------------^^^^^^^^^^^^^----\r\n   | |               |\r\n   | |               Use of undeclared type or module `std`\r\n   | in this macro invocation\r\n\r\nerror: aborting due to previous error\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/299241538/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/299242009",
    "html_url": "https://github.com/rust-lang/rust/issues/28072#issuecomment-299242009",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28072",
    "id": 299242009,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTI0MjAwOQ==",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-04T16:43:09Z",
    "updated_at": "2017-05-04T16:43:09Z",
    "body": "cc @jseyfried just seeing if this is interesting to you, or you know how to fix it.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/299242009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/299268787",
    "html_url": "https://github.com/rust-lang/rust/issues/28072#issuecomment-299268787",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28072",
    "id": 299268787,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTI2ODc4Nw==",
    "user": {
      "login": "jseyfried",
      "id": 8652869,
      "node_id": "MDQ6VXNlcjg2NTI4Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jseyfried",
      "html_url": "https://github.com/jseyfried",
      "followers_url": "https://api.github.com/users/jseyfried/followers",
      "following_url": "https://api.github.com/users/jseyfried/following{/other_user}",
      "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions",
      "organizations_url": "https://api.github.com/users/jseyfried/orgs",
      "repos_url": "https://api.github.com/users/jseyfried/repos",
      "events_url": "https://api.github.com/users/jseyfried/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jseyfried/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-04T18:23:15Z",
    "updated_at": "2017-05-04T18:23:28Z",
    "body": "This is a known limitation of `macro_rules!` -- only local variables (and labels) are hygienic, not items (including paths). As @nrc [mentioned](https://github.com/rust-lang/rust/issues/28072#issuecomment-154876112), this would be a breaking change to fix with `macro_rules!`.\r\n\r\nThis is fixed in [declarative macros 2.0](https://github.com/rust-lang/rust/pull/40847) (it will \"just work\"), see [this test case](https://github.com/rust-lang/rust/pull/40847/files#diff-56a2f56ab206c73d855e9e681ac92b77).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/299268787/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/310438291",
    "html_url": "https://github.com/rust-lang/rust/issues/28072#issuecomment-310438291",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28072",
    "id": 310438291,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMDQzODI5MQ==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-22T16:50:20Z",
    "updated_at": "2017-06-22T16:50:20Z",
    "body": "As a known limitation of macro_rules that we don't plan on fixing, I'm going to close this.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/310438291/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
