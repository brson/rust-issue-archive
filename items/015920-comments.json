[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49891740",
    "html_url": "https://github.com/rust-lang/rust/issues/15920#issuecomment-49891740",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15920",
    "id": 49891740,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODkxNzQw",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-23T15:39:36Z",
    "updated_at": "2014-07-23T15:39:36Z",
    "body": "I'm not sure this issue as described is really a problem. The bug here is that the `unsafe {}` block is buggy. Yes, the actual crash would occur in code outside of the `unsafe {}` block, but that can happen via a great number of ways, without `Unsafe`. The easiest way is to construct a `&` ref that refers to invalid memory.\n\n``` rust\nfn bad_code<'a>() -> &'a str {\n    let x = \"allocated string\".to_string();\n    unsafe { mem::transmute(x.as_slice()) }\n}\n```\n\nThe above returns a `&str` that refers to now-deallocated memory, so any safe code that uses this reference may crash.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49891740/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49892682",
    "html_url": "https://github.com/rust-lang/rust/issues/15920#issuecomment-49892682",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15920",
    "id": 49892682,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODkyNjgy",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-23T15:45:58Z",
    "updated_at": "2014-07-23T15:47:38Z",
    "body": "Your example is different - the drop glue invokes the unsafe function `free` on an aliased pointer - which is already UB before safe code can touch the invalid pointer (Of course, because UB, the crash can occur anytime not strictly before the return). Of course the buggy unsafe block is the transmute - but the unsafety occurs within an unsafe block but this is irrelevant.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49892682/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49910406",
    "html_url": "https://github.com/rust-lang/rust/issues/15920#issuecomment-49910406",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15920",
    "id": 49910406,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5OTEwNDA2",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-23T17:54:42Z",
    "updated_at": "2014-07-23T17:54:42Z",
    "body": "@arielb1 Seems to me that's roughly equivalent to your code with `Unsafe` though. Yes, the `&mut` you create does not alias an already-exsiting `&T` at the time it's created. But it _does_ alias a publicly-accessible `value` field on the `Unsafe` value (which is the field used to subsequently construct the `&T`). Remember that \"aliasing\" doesn't mean \"contains a pointer value equal to a pointer value stored elsewhere\" but really means \"allows for accessing a value that is accessible via a separate path\". The real bug here is that the `unsafe` code has returned a `&mut T` reference that does not borrow the `Unsafe` value. And thus, the bug still lies within the `unsafe` block.\n\nOf course, `Unsafe` exposes a `*mut T` instead of a `&mut T` precisely because it's producing the mutability from a `&Unsafe<T>` reference, which means it cannot know whether it's already aliased, and thus it's not safe to create the `&mut T`. That's why it's up to a wrapping type to provide the non-aliasing guarantees sufficient to allow valid creation of a `&mut T`.\n\nUltimately, the public `value` field is an issue, but as it stands today, it's not the fundamental safety-breaking issue that you seem to be suggesting. Just like a `*mut T` pointer, using `Unsafe` requires restricting access to the value such that all code that can use the value can make sure to maintain the appropriate invariants for safe access.\n\nOf course, if static items change as suggested in rust-lang/rfcs#177 such that you can then say `static FOO: Unsafe<uint>` then this does become a more serious issue. As long as `static mut` exists it's still not as bad as I think that RFC's proposal is (because we would still not expect, and would in fact discourage, normal Rust users from using `Unsafe`) but if `static mut` is dropped in favor of telling people to use `static FOO: Unsafe<uint>` then it becomes much more important to fix the public `value` field issue.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49910406/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49917439",
    "html_url": "https://github.com/rust-lang/rust/issues/15920#issuecomment-49917439",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15920",
    "id": 49917439,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5OTE3NDM5",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-23T18:47:57Z",
    "updated_at": "2014-07-23T18:52:27Z",
    "body": "@kballard \n\nNot really. I agree that the _bug_ is within the unsafe block - however this is exactly in the same manner that the _bug_ in a hypothetical method within std::vec that conjures a bogus vector and pushes something into it (causing UB) is not within `push` but within the method that conjured the vector.\n\nI'm quite sure that privacy should not be related to undefined behaviour, except in the trivial manner that it can reduce the amount of code that needs to be checked. Keeping this in mind, you can notice that RefCell ALSO creates an `&mut T` alias to an not-mutably-borrowed Unsafe<T> (which is externally safe because the Unsafe<T> is behind a private field and the code accessing it is careful not to create an additional reference).\n\nI never said that this was an unsoundness in Rust because it isn't - only an ugly point. Of course the issue would become less hidden if mut statics are removed - but it is still an issue even with them.\n\nBy the way, I currently think the best way to fix this would be to make accessing the fields of an `Unsafe<T>` unsafe and will probably write an RFC tomorrow.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49917439/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49918728",
    "html_url": "https://github.com/rust-lang/rust/issues/15920#issuecomment-49918728",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15920",
    "id": 49918728,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5OTE4NzI4",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-23T18:56:59Z",
    "updated_at": "2014-07-23T18:56:59Z",
    "body": "We already had an RFC for `unsafe` fields: rust-lang/rfcs#80. It was closed largely because it was felt that `Unsafe` already provided the desired functionality. But obviously, as it turns out, `Unsafe` itself actually needs this qualifier for its own use. Given that, I am in favor of you writing a new RFC (just be sure to read the old one first).\n\nThe alternative is to somehow mark a field as being usable in a struct literal expression, but private everywhere else. I can't think of a good way to denote that, though, or any use for that outside of `Unsafe<T>`, whereas an `unsafe`-qualified field is usable elsewhere.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49918728/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49934799",
    "html_url": "https://github.com/rust-lang/rust/issues/15920#issuecomment-49934799",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15920",
    "id": 49934799,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5OTM0Nzk5",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-23T21:01:14Z",
    "updated_at": "2014-07-23T21:01:14Z",
    "body": "This is now RFC PR rust-lang/rfcs#182\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49934799/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71289619",
    "html_url": "https://github.com/rust-lang/rust/issues/15920#issuecomment-71289619",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15920",
    "id": 71289619,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjg5NjE5",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-24T00:26:00Z",
    "updated_at": "2015-01-24T00:26:00Z",
    "body": "Closing in favor of the RFC thread.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71289619/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
