[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66684077",
    "html_url": "https://github.com/rust-lang/rust/pull/19755#issuecomment-66684077",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19755",
    "id": 66684077,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2Njg0MDc3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-11T20:35:14Z",
    "updated_at": "2014-12-11T20:35:14Z",
    "body": "cc @aturon, @erickt, can you verify that this reflects the outcome of what we were discussing in the work week about libserialize?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66684077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66691580",
    "html_url": "https://github.com/rust-lang/rust/pull/19755#issuecomment-66691580",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19755",
    "id": 66691580,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NjkxNTgw",
    "user": {
      "login": "emk",
      "id": 36963,
      "node_id": "MDQ6VXNlcjM2OTYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/36963?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emk",
      "html_url": "https://github.com/emk",
      "followers_url": "https://api.github.com/users/emk/followers",
      "following_url": "https://api.github.com/users/emk/following{/other_user}",
      "gists_url": "https://api.github.com/users/emk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emk/subscriptions",
      "organizations_url": "https://api.github.com/users/emk/orgs",
      "repos_url": "https://api.github.com/users/emk/repos",
      "events_url": "https://api.github.com/users/emk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-11T21:25:14Z",
    "updated_at": "2014-12-11T21:25:14Z",
    "body": "@alexcrichton I'm working on bindings to a JavaScript interpreter which support `Encode`, and I've discovered that the `deriving(Encodable)` support in the compiler seems to have a couple of weird minor issues, as described here: rust-lang/rust#19756.\n\nIf `RustcEncodable` is going to be stablized, it's probably worth deciding whether the current behavior with struct enum variants and tuple structs is actually intentional. (It feels like the current behavior might be an oversight or a bug.) I'd be interested in contributing a patch, if that seems like the right decision.\n\nAside from this, the current `deriving(Encodable)` appears to be correct and sensible, at least based on the unit tests I've been writing.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66691580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66696314",
    "html_url": "https://github.com/rust-lang/rust/pull/19755#issuecomment-66696314",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19755",
    "id": 66696314,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2Njk2MzE0",
    "user": {
      "login": "TyOverby",
      "id": 573215,
      "node_id": "MDQ6VXNlcjU3MzIxNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/573215?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TyOverby",
      "html_url": "https://github.com/TyOverby",
      "followers_url": "https://api.github.com/users/TyOverby/followers",
      "following_url": "https://api.github.com/users/TyOverby/following{/other_user}",
      "gists_url": "https://api.github.com/users/TyOverby/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TyOverby/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TyOverby/subscriptions",
      "organizations_url": "https://api.github.com/users/TyOverby/orgs",
      "repos_url": "https://api.github.com/users/TyOverby/repos",
      "events_url": "https://api.github.com/users/TyOverby/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TyOverby/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-11T21:56:13Z",
    "updated_at": "2014-12-11T21:56:13Z",
    "body": "Is it possible for e.g. serde to contain all of the functionality of our current serialization functionality?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66696314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66697040",
    "html_url": "https://github.com/rust-lang/rust/pull/19755#issuecomment-66697040",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19755",
    "id": 66697040,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2Njk3MDQw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-11T22:00:56Z",
    "updated_at": "2014-12-11T22:00:56Z",
    "body": "@emk I think we'd definitely be willing to accept updates in the pre-1.0 timeframe but we would not be able to afterwards. The library was designed in a time where struct variants weren't as much of a thing as they are now, so I wouldn't be too surprised if you ran into bugs :).\n\nThe good part is that in terms of functionality we ship we'd only have to update the `deriving` code (nothing in-tree), and we could catch up `rustc-serialize` afterwards.\n\n@TyOverby I'm sure @erickt could answer that question better than I, but I don't see why it couldn't!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66697040/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66915170",
    "html_url": "https://github.com/rust-lang/rust/pull/19755#issuecomment-66915170",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19755",
    "id": 66915170,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2OTE1MTcw",
    "user": {
      "login": "emk",
      "id": 36963,
      "node_id": "MDQ6VXNlcjM2OTYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/36963?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emk",
      "html_url": "https://github.com/emk",
      "followers_url": "https://api.github.com/users/emk/followers",
      "following_url": "https://api.github.com/users/emk/following{/other_user}",
      "gists_url": "https://api.github.com/users/emk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emk/subscriptions",
      "organizations_url": "https://api.github.com/users/emk/orgs",
      "repos_url": "https://api.github.com/users/emk/repos",
      "events_url": "https://api.github.com/users/emk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-14T14:39:33Z",
    "updated_at": "2014-12-14T14:39:49Z",
    "body": "Thank you, @alexcrichton. Further investigation reveals that `Decoder` and `Decodable` are even more broken than `Encoder` and `Encodable`. Specifically, `read_enum_struct_variant` is never used. What's worse, however, is that `read_enum` doesn't have any way to indicate to indicate to its caller whether to use `read_enum_variant` or `read_enum_struct_variant`. This is no surprise, because `deriving(Decodable)` has never even tried to invoke `read_enum_struct_variant`.\n\nIn short, it's not clear that the `Decoder` API even makes sense.\n\nI can see a couple ways forward:\n1. I could write up a detailed explanation of how to change `Decoder`, and then fix `deriving(Encodable)` and `deriving(Decodable)` to do the right thing.\n2. We could stop pretending that `Encoder` and `Decoder` have special support for enum struct variants and tuple structs, and we could rip the related functions out of the traits, since they've never been used and `Decoder`'s support for them doesn't seem to make sense.\n3. I could run away quickly and port my code to `serde`. :-)\n\nI guess the key question here is how `RustcEncodable` and `RustcDecodable` will actually work once `serialize` is moved into a standalone crate. How will they access `Encodable` and `Decodable`? Will libraries like `serde` just ignore  `RustcEncodable` and `RustcDecodable` completely?\n\nThank you for your feedback!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66915170/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66920677",
    "html_url": "https://github.com/rust-lang/rust/pull/19755#issuecomment-66920677",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19755",
    "id": 66920677,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2OTIwNjc3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-14T17:27:41Z",
    "updated_at": "2014-12-14T17:27:41Z",
    "body": "> Further investigation reveals that Decoder and Decodable are even more broken than Encoder and Encodable\n\nOh dear, this does sound bad! We should be able to make tweaks like this before 1.0, though.\n\n> I guess the key question here is how RustcEncodable and RustcDecodable will actually work once serialize is moved into a standalone crate\n\nI plan on modifying their expansion to references `::rustc_serialize::{Decodable, Encodable}` traits. This means that the traits in `rustc-serialize` on crates.io are forced to never change and the compiler will just blindly assume that you have `extern crate \"rustc-serialize\" as rustc_serialize;` at the top (as best as we can do, sadly).\n\n> Will libraries like serde just ignore RustcEncodable and RustcDecodable completely?\n\nSadly yes, the `deriving` expansion is fundamentally incompatible with the strategy that `serde` is taking. I'd love to just-as-nice deriving with `serde`, and there are two route to doing so:\n1. Support plugins in the stable channel of Rust. This means that `serde` can ship with its own set of `deriving`-mode expanders, making it even nicer than `RustcEncodable`!\n2. Leverage codegen to use the syntax-of-tomorrow today! @erickt could fill you in more on this :)\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66920677/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66922650",
    "html_url": "https://github.com/rust-lang/rust/pull/19755#issuecomment-66922650",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19755",
    "id": 66922650,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2OTIyNjUw",
    "user": {
      "login": "emk",
      "id": 36963,
      "node_id": "MDQ6VXNlcjM2OTYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/36963?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emk",
      "html_url": "https://github.com/emk",
      "followers_url": "https://api.github.com/users/emk/followers",
      "following_url": "https://api.github.com/users/emk/following{/other_user}",
      "gists_url": "https://api.github.com/users/emk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emk/subscriptions",
      "organizations_url": "https://api.github.com/users/emk/orgs",
      "repos_url": "https://api.github.com/users/emk/repos",
      "events_url": "https://api.github.com/users/emk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-14T18:23:58Z",
    "updated_at": "2014-12-14T18:23:58Z",
    "body": "> > Further investigation reveals that Decoder and Decodable are even more broken than Encoder and Encodable\n> \n> Oh dear, this does sound bad! We should be able to make tweaks like this before 1.0, though.\n\nOK, in that case, here's a short summary of what needs to be done:\n1. `RustcEncodable` and `RustcDecodable` need to be modified to know about enum struct variants and and tuple structs, as described here: rust-lang/rust#19756.\n2. The relationship between `read_enum`, `read_enum_variant` and `read_enum_struct_variant` needs to be rethought\u2014perhaps these three functions should be collapsed into 1 or 2 functions, or perhaps `read_enum` should indicate whether to call  `read_enum_variant` or  `read_enum_struct_variant` next.\n\nAnyway, here's the most most serious problem, illustrated by the JSON deserializer:\n\n``` rust\n    fn read_enum<T, F>(&mut self, name: &str, f: F) -> DecodeResult<T> where\n        F: FnOnce(&mut Decoder) -> DecodeResult<T>,\n    {\n        debug!(\"read_enum({})\", name);\n        f(self)\n    }\n\n    fn read_enum_variant<T, F>(&mut self, names: &[&str], f: F) -> DecodeResult<T> where\n        F: FnOnce(&mut Decoder, uint) -> DecodeResult<T>,\n    {\n        debug!(\"read_enum_variant(names={})\", names);\n        let name = match self.pop() {\n            Json::String(s) => s,\n            Json::Object(mut o) => {\n                // ...\n            }\n        };\n        let idx = match names.iter()\n                             .position(|n| str::eq_slice(*n, name.as_slice())) {\n            Some(idx) => idx,\n            None => return Err(UnknownVariantError(name))\n        };\n        f(self, idx)\n    }\n\n   // ...\n\n    // (NOT ACTUALLY CALLED?)\n    fn read_enum_struct_variant<T, F>(&mut self, names: &[&str], f: F) -> DecodeResult<T> where\n        F: FnOnce(&mut Decoder, uint) -> DecodeResult<T>,\n    {\n        debug!(\"read_enum_struct_variant(names={})\", names);\n        self.read_enum_variant(names, f)\n    }\n```\n\nHow do we get from `read_enum` to `read_enum_struct_variant`?\n\nOnce we know what we want to have happen here, the rest is easier.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66922650/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
