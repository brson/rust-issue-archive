{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/10196",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/10196/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/10196/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/10196/events",
  "html_url": "https://github.com/rust-lang/rust/pull/10196",
  "id": 21893939,
  "node_id": "MDExOlB1bGxSZXF1ZXN0OTU2MjI2MQ==",
  "number": 10196,
  "title": "std::rand: correct an off-by-one in the Ziggurat code.",
  "user": {
    "login": "huonw",
    "id": 1203825,
    "node_id": "MDQ6VXNlcjEyMDM4MjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/huonw",
    "html_url": "https://github.com/huonw",
    "followers_url": "https://api.github.com/users/huonw/followers",
    "following_url": "https://api.github.com/users/huonw/following{/other_user}",
    "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
    "organizations_url": "https://api.github.com/users/huonw/orgs",
    "repos_url": "https://api.github.com/users/huonw/repos",
    "events_url": "https://api.github.com/users/huonw/events{/privacy}",
    "received_events_url": "https://api.github.com/users/huonw/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 0,
  "created_at": "2013-10-31T12:53:08Z",
  "updated_at": "2014-06-17T13:31:48Z",
  "closed_at": "2013-11-01T09:21:21Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/10196",
    "html_url": "https://github.com/rust-lang/rust/pull/10196",
    "diff_url": "https://github.com/rust-lang/rust/pull/10196.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/10196.patch",
    "merged_at": "2013-11-01T09:21:22Z"
  },
  "body": "The code was using (in the notation of Doornik 2005) `f(x_{i+1}) -\nf(x_{i+2})` rather than `f(x_i) - f(x_{i+1})`. This corrects that, and\nremoves the F_DIFF tables which caused this problem in the first place.\n\nThey `F_DIFF` tables are a micro-optimisation (in theory, they could\neasily be a micro-pessimisation): that `if` gets hit about 1% of the\ntime for Exp/Normal, and the rest of the condition involves RNG calls\nand a floating point `exp`, so it is unlikely that saving a single FP\nsubtraction will be very useful (especially as more tables means more\nmemory reads and higher cache pressure, as well as taking up space in\nthe binary (although only ~2k in this case)).\n\nCloses #10084. Notably, unlike that issue suggests, this wasn't a\nproblem with the Exp tables. It affected Normal too, but since it is\nsymmetric, there was no bias in the mean (as the bias was equal on the\npositive and negative sides and so cancelled out) but it was visible as\na variance slightly lower than it should be.\n\nNew plot:\n\n![exp-density](https://f.cloud.github.com/assets/1203825/1445796/42218dfe-422a-11e3-9f98-2cd146b82b46.png)\n\nI've started writing some tests in [huonw/random-tests](https://github.com/huonw/random-tests) (not in the main repo because they can and do fail occasionally, due to randomness, but it is on Travis and Rust-CI so it will hopefully track the language), unsurprisingly, they're [currently failing](https://travis-ci.org/huonw/random-tests/builds/13313987) (note that both exp and norm are failing, the former due to both mean and variance the latter due to just variance), but pass at the 0.01 level reliably with this change.\n\n(Currently the only test is essentially a quantitative version of the plots I've been showing, which is run on the `f64` `Rand` instance (uniform 0 to 1), and the Normal and Exp distributions.)\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/10196/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/10196/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
