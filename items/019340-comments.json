[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64685515",
    "html_url": "https://github.com/rust-lang/rust/issues/19340#issuecomment-64685515",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19340",
    "id": 64685515,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0Njg1NTE1",
    "user": {
      "login": "drbawb",
      "id": 235438,
      "node_id": "MDQ6VXNlcjIzNTQzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235438?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/drbawb",
      "html_url": "https://github.com/drbawb",
      "followers_url": "https://api.github.com/users/drbawb/followers",
      "following_url": "https://api.github.com/users/drbawb/following{/other_user}",
      "gists_url": "https://api.github.com/users/drbawb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/drbawb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/drbawb/subscriptions",
      "organizations_url": "https://api.github.com/users/drbawb/orgs",
      "repos_url": "https://api.github.com/users/drbawb/repos",
      "events_url": "https://api.github.com/users/drbawb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/drbawb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-26T17:56:08Z",
    "updated_at": "2014-11-26T19:49:37Z",
    "body": "I've actually narrowed this down to a single match expression; I'm trying to make sense of it, or at least make a reproducible test-case.\n\nI don't see anything particularly interesting about the match:\n\n```\nmatch msg {\n    Resource{ method: verb, path: uri, payload: pl, .. } => {\n        let request = Request { uid: uid, method: verb, path: uri, payload: pl };\n        let result  = self.stack.process(request);\n        debug!(\"status {}\", result)\n    },\n\n    PasswordAuth{ password: pw, .. } => {\n        spawn(handlers::connections::password_auth(self.context.clone(),\n                                                   uid, pw, self.config.services_password));\n    },\n\n    _ => { info!(\"unhandled message type!\"); }, \n}\n```\n\nIt is matching a struct-like enum (defined in an external crate.)\nIf I take out both match-arms and leave the wildcard: the code compiles just fine. Otherwise I get the ICE w/ a similar backtrace to the one posted above.\n\nHere is an abbreviated definition of `Message` (the type being matched on):\n\n```\n#[deriving(Clone,Decodable,Encodable,Eq,Hash,PartialEq)]\npub enum Method {\n        Get,\n        Put,\n        Destroy,\n        Publish,\n        Subscribe,\n}\n\n#[deriving(Clone, Encodable, Decodable)] \npub enum Message {\n    PasswordAuth { password: String },\n    Resource { method: Method, path: String, payload: Option<String> },\n}\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64685515/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64686211",
    "html_url": "https://github.com/rust-lang/rust/issues/19340#issuecomment-64686211",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19340",
    "id": 64686211,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0Njg2MjEx",
    "user": {
      "login": "samnardoni",
      "id": 328421,
      "node_id": "MDQ6VXNlcjMyODQyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/328421?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/samnardoni",
      "html_url": "https://github.com/samnardoni",
      "followers_url": "https://api.github.com/users/samnardoni/followers",
      "following_url": "https://api.github.com/users/samnardoni/following{/other_user}",
      "gists_url": "https://api.github.com/users/samnardoni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/samnardoni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/samnardoni/subscriptions",
      "organizations_url": "https://api.github.com/users/samnardoni/orgs",
      "repos_url": "https://api.github.com/users/samnardoni/repos",
      "events_url": "https://api.github.com/users/samnardoni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/samnardoni/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-26T18:00:48Z",
    "updated_at": "2014-11-26T18:00:48Z",
    "body": "Is this an issue with namespaced enums? Perhaps it should be `match msg { Message::Resource { ...`?\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64686211/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64687368",
    "html_url": "https://github.com/rust-lang/rust/issues/19340#issuecomment-64687368",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19340",
    "id": 64687368,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0Njg3MzY4",
    "user": {
      "login": "drbawb",
      "id": 235438,
      "node_id": "MDQ6VXNlcjIzNTQzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235438?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/drbawb",
      "html_url": "https://github.com/drbawb",
      "followers_url": "https://api.github.com/users/drbawb/followers",
      "following_url": "https://api.github.com/users/drbawb/following{/other_user}",
      "gists_url": "https://api.github.com/users/drbawb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/drbawb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/drbawb/subscriptions",
      "organizations_url": "https://api.github.com/users/drbawb/orgs",
      "repos_url": "https://api.github.com/users/drbawb/repos",
      "events_url": "https://api.github.com/users/drbawb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/drbawb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-26T18:09:01Z",
    "updated_at": "2014-11-26T18:09:01Z",
    "body": "Tried using the namespaced variants, as well as removing the `, ..`\nI don't see any noticeable change in the backtrace.\n\nI'm wondering if it's related to the struct-like enums? This is the only code I have that uses them.\n\nThe other thing is that I'm moving values out of the enum: I'm wondering if it's interacting poorly with some of the recent changes to \"structural fragments\" (commit 0e06f717477).\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64687368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64687933",
    "html_url": "https://github.com/rust-lang/rust/issues/19340#issuecomment-64687933",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19340",
    "id": 64687933,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0Njg3OTMz",
    "user": {
      "login": "drbawb",
      "id": 235438,
      "node_id": "MDQ6VXNlcjIzNTQzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235438?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/drbawb",
      "html_url": "https://github.com/drbawb",
      "followers_url": "https://api.github.com/users/drbawb/followers",
      "following_url": "https://api.github.com/users/drbawb/following{/other_user}",
      "gists_url": "https://api.github.com/users/drbawb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/drbawb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/drbawb/subscriptions",
      "organizations_url": "https://api.github.com/users/drbawb/orgs",
      "repos_url": "https://api.github.com/users/drbawb/repos",
      "events_url": "https://api.github.com/users/drbawb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/drbawb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-26T18:12:52Z",
    "updated_at": "2014-11-26T18:12:52Z",
    "body": "If I match on `&msg` instead of `msg` and then bind the patterns `by-ref` and `#clone()` them where I was previously moving them: the code compiles as usual.\n\nSo it seems to be related to moving the values out of the struct-enum.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64687933/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64691855",
    "html_url": "https://github.com/rust-lang/rust/issues/19340#issuecomment-64691855",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19340",
    "id": 64691855,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NjkxODU1",
    "user": {
      "login": "drbawb",
      "id": 235438,
      "node_id": "MDQ6VXNlcjIzNTQzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235438?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/drbawb",
      "html_url": "https://github.com/drbawb",
      "followers_url": "https://api.github.com/users/drbawb/followers",
      "following_url": "https://api.github.com/users/drbawb/following{/other_user}",
      "gists_url": "https://api.github.com/users/drbawb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/drbawb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/drbawb/subscriptions",
      "organizations_url": "https://api.github.com/users/drbawb/orgs",
      "repos_url": "https://api.github.com/users/drbawb/repos",
      "events_url": "https://api.github.com/users/drbawb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/drbawb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-26T18:40:42Z",
    "updated_at": "2014-11-26T18:40:42Z",
    "body": "I do have a minimally reproducible test case; but so far as I can tell you need to define it in two completely separate crates.\n\n```\nenumice/src/lib.rs:\n\npub enum Foo {\n    Bar { name: String },\n}\n```\n\n```\nenumbin/src/main.rs:\n\nextern crate enumice;        \nuse enumice::Foo;            \n\nfn main() {\n    let foo = Foo::Bar { name: format!(\"test\") };\n    match foo { \n        Foo::Bar { name } => {},        \n    };\n} \n```\n\nWhen I defined `enum Foo { ... }` inside the same crate it did not produce the ICE.\nAlso interestingly enough: I had to add a variant with a `String` before I got the ICE.\nInitially I just had a variant with an `i32` and it worked fine.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64691855/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65089871",
    "html_url": "https://github.com/rust-lang/rust/issues/19340#issuecomment-65089871",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19340",
    "id": 65089871,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MDg5ODcx",
    "user": {
      "login": "ferreum",
      "id": 6669289,
      "node_id": "MDQ6VXNlcjY2NjkyODk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6669289?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ferreum",
      "html_url": "https://github.com/ferreum",
      "followers_url": "https://api.github.com/users/ferreum/followers",
      "following_url": "https://api.github.com/users/ferreum/following{/other_user}",
      "gists_url": "https://api.github.com/users/ferreum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ferreum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ferreum/subscriptions",
      "organizations_url": "https://api.github.com/users/ferreum/orgs",
      "repos_url": "https://api.github.com/users/ferreum/repos",
      "events_url": "https://api.github.com/users/ferreum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ferreum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-01T16:23:25Z",
    "updated_at": "2014-12-01T16:24:01Z",
    "body": "This also happens for me with `Vec` instead of `String`. Using `ref` to prevent moving the value compiles fine:\n`Foo::Bar { ref name } => {},`\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65089871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65099388",
    "html_url": "https://github.com/rust-lang/rust/issues/19340#issuecomment-65099388",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19340",
    "id": 65099388,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MDk5Mzg4",
    "user": {
      "login": "ogham",
      "id": 503760,
      "node_id": "MDQ6VXNlcjUwMzc2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/503760?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ogham",
      "html_url": "https://github.com/ogham",
      "followers_url": "https://api.github.com/users/ogham/followers",
      "following_url": "https://api.github.com/users/ogham/following{/other_user}",
      "gists_url": "https://api.github.com/users/ogham/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ogham/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ogham/subscriptions",
      "organizations_url": "https://api.github.com/users/ogham/orgs",
      "repos_url": "https://api.github.com/users/ogham/repos",
      "events_url": "https://api.github.com/users/ogham/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ogham/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-01T17:16:49Z",
    "updated_at": "2014-12-01T17:16:49Z",
    "body": "I'm getting this ICE as well, when I try to move values out of struct-like enums. It happens on these lines: https://github.com/ogham/arity/blob/94f7db622adb8cd51d56761f30af35d77e3c5d5b/src/ast.rs#L183\n\nThe stacktrace is somewhat different, though:\n<code><pre>stack backtrace:\n   1:        0x108744bf2 - rt::backtrace::imp::write::h391b8d7e50d47c199gy\n   2:        0x108747d10 - failure::on_fail::h4b208e46777c3262GEy\n   3:        0x10899a395 - unwind::begin_unwind_inner::he78fb85bab232941fJc\n   4:        0x108999fa6 - unwind::begin_unwind_fmt::haa2a8c3c78f20262qGc\n   5:        0x108999d32 - rust_begin_unwind\n   6:        0x1089e4cac - panicking::panic_fmt::ha89d80dab489d365VXl\n   7:        0x1089df732 - panicking::panic::hdc23f6ff1a41fa31XUl\n   8:        0x10577f703 - middle::borrowck::move_data::fragments::add_fragment_siblings_for_extension::closure.91613\n   9:        0x10577e5b4 - middle::borrowck::move_data::fragments::add_fragment_siblings::h457522ea517a9b413Rg\n  10:        0x10577bb11 - middle::borrowck::move_data::fragments::fixup_fragment_sets::h37b889f20647c9474yg\n  11:        0x1057855bd - middle::borrowck::move_data::FlowedMoveData<'a, 'tcx>::new::h7d515ea0e8cc9766x3h\n  12:        0x105791d76 - middle::borrowck::build_borrowck_dataflow_data::h4580914dc7f1219fHoi\n  13:        0x10578c870 - middle::borrowck::borrowck_fn::hc6a87f7f03f5c907Fli\n  14:        0x10578ec23 - visit::walk_item::h13605873315878884879\n  15:        0x10578d4e8 - visit::walk_mod::h14427983187000498433\n  16:        0x10578d4e8 - visit::walk_mod::h14427983187000498433\n  17:        0x10578cf72 - middle::borrowck::check_crate::h3c09169822075773bei\n  18:        0x1051d7eff - util::common::time::h17551334739901154900\n  19:        0x10536c424 - driver::driver::phase_3_run_analysis_passes::hdc7a5f34c31132abVlS\n  20:        0x1053600ec - driver::driver::compile_input::h0131bbb57744e4eb12R\n  21:        0x1053dd9b5 - driver::run_compiler::hc0b7f5c8dfa75d9190T\n  22:        0x1053dc04e - driver::run::closure.59940\n  23:        0x1051eface - task::TaskBuilder::try_future::closure.39054\n  24:        0x108716f33 - task::TaskBuilder::spawn_internal::closure.30356\n  25:        0x108997f3d - task::Task::spawn::closure.5573\n  26:        0x1089fc76c - rust_try_inner\n  27:        0x1089fc756 - rust_try\n  28:        0x108998017 - unwind::try::h3cc54dd2c93266c5Axc\n  29:        0x108997dec - task::Task::run::h53730485ea854581qMb\n  30:        0x108997aef - task::Task::spawn::closure.5549\n  31:        0x1089993f7 - thread::thread_start::h0f686b08caff7754t4b\n  32:     0x7fff93cc52fc - _pthread_body\n  33:     0x7fff93cc5279 - _pthread_body\n $ rustc --version\n rustc 0.13.0-nightly (fac5a0767 2014-11-26 22:37:06 +0000)\n</pre></code>\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65099388/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65833698",
    "html_url": "https://github.com/rust-lang/rust/issues/19340#issuecomment-65833698",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19340",
    "id": 65833698,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODMzNjk4",
    "user": {
      "login": "drbawb",
      "id": 235438,
      "node_id": "MDQ6VXNlcjIzNTQzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235438?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/drbawb",
      "html_url": "https://github.com/drbawb",
      "followers_url": "https://api.github.com/users/drbawb/followers",
      "following_url": "https://api.github.com/users/drbawb/following{/other_user}",
      "gists_url": "https://api.github.com/users/drbawb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/drbawb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/drbawb/subscriptions",
      "organizations_url": "https://api.github.com/users/drbawb/orgs",
      "repos_url": "https://api.github.com/users/drbawb/repos",
      "events_url": "https://api.github.com/users/drbawb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/drbawb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-05T18:35:40Z",
    "updated_at": "2014-12-05T18:35:40Z",
    "body": "barosl's PR compiles my code w/ no issues :+1:\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65833698/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
