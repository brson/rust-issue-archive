[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/168230340",
    "html_url": "https://github.com/rust-lang/rust/issues/18072#issuecomment-168230340",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18072",
    "id": 168230340,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2ODIzMDM0MA==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-31T18:01:11Z",
    "updated_at": "2015-12-31T18:01:11Z",
    "body": "Triage: I'm not aware of anyone having done any investigation since.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/168230340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305669653",
    "html_url": "https://github.com/rust-lang/rust/issues/18072#issuecomment-305669653",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18072",
    "id": 305669653,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNTY2OTY1Mw==",
    "user": {
      "login": "bstrie",
      "id": 865233,
      "node_id": "MDQ6VXNlcjg2NTIzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bstrie",
      "html_url": "https://github.com/bstrie",
      "followers_url": "https://api.github.com/users/bstrie/followers",
      "following_url": "https://api.github.com/users/bstrie/following{/other_user}",
      "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions",
      "organizations_url": "https://api.github.com/users/bstrie/orgs",
      "repos_url": "https://api.github.com/users/bstrie/repos",
      "events_url": "https://api.github.com/users/bstrie/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bstrie/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-02T02:08:04Z",
    "updated_at": "2017-06-02T02:08:04Z",
    "body": "Is any of this actionable? Is the UB documented somewhere, or described by a bug report? Given that this bug is going on three years old, it's also possible that this isn't relevant anymore. Can someone demonstrate this with a test case? If not, I'd consider closing this.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305669653/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/345150582",
    "html_url": "https://github.com/rust-lang/rust/issues/18072#issuecomment-345150582",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18072",
    "id": 345150582,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTE1MDU4Mg==",
    "user": {
      "login": "bstrie",
      "id": 865233,
      "node_id": "MDQ6VXNlcjg2NTIzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bstrie",
      "html_url": "https://github.com/bstrie",
      "followers_url": "https://api.github.com/users/bstrie/followers",
      "following_url": "https://api.github.com/users/bstrie/following{/other_user}",
      "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions",
      "organizations_url": "https://api.github.com/users/bstrie/orgs",
      "repos_url": "https://api.github.com/users/bstrie/repos",
      "events_url": "https://api.github.com/users/bstrie/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bstrie/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-11-17T05:39:43Z",
    "updated_at": "2017-11-17T05:39:43Z",
    "body": "It's been three years since this was filed and we still have no clue what this is referring to, no reproduction, and no way to know if this hasn't already been long since fixed on LLVM's side. Closing this, but feel free to reopen if anyone can find a relevant LLVM bug (though https://github.com/rust-lang/rust/issues/45839#issuecomment-343301085 has set the precedent of \"It doesn't make sense to have a bug for every LLVM bug\", so use your discretion).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/345150582/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/345268545",
    "html_url": "https://github.com/rust-lang/rust/issues/18072#issuecomment-345268545",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18072",
    "id": 345268545,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTI2ODU0NQ==",
    "user": {
      "login": "sunfishcode",
      "id": 4503403,
      "node_id": "MDQ6VXNlcjQ1MDM0MDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4503403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sunfishcode",
      "html_url": "https://github.com/sunfishcode",
      "followers_url": "https://api.github.com/users/sunfishcode/followers",
      "following_url": "https://api.github.com/users/sunfishcode/following{/other_user}",
      "gists_url": "https://api.github.com/users/sunfishcode/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sunfishcode/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sunfishcode/subscriptions",
      "organizations_url": "https://api.github.com/users/sunfishcode/orgs",
      "repos_url": "https://api.github.com/users/sunfishcode/repos",
      "events_url": "https://api.github.com/users/sunfishcode/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sunfishcode/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-11-17T15:06:37Z",
    "updated_at": "2017-11-17T15:06:37Z",
    "body": "I'm not aware of any specific undefined behavior, though there could well be bugs. Here's an experiment:\r\n```rust\r\npub fn bar(foo: &Fn(&[u8], &[u8], &[u8], &[u8], &[u8], &[u8])) {\r\n    let a = [0u8; 0x7fff_ffff];\r\n    let b = [0u8; 0x7fff_ffff];\r\n    let c = [0u8; 0x7fff_ffff];\r\n    let d = [0u8; 0x7fff_ffff];\r\n    let e = [0u8; 0x7fff_ffff];\r\n    let f = [0u8; 0x7fff_ffff];\r\n    foo(&a, &b, &c, &d, &e, &f);\r\n}\r\n```\r\nCompile with `rustc --crate-type rlib --emit asm -O` with a 32-bit x86 target gets this prologue:\r\n```asm\r\n        pushl   %ebp\r\n        pushl   %ebx\r\n        pushl   %edi\r\n        pushl   %esi\r\n        movl    $12884901884, %eax\r\n        calll   __rust_probestack\r\n        subl    %eax, %esp\r\n```\r\n12884901884 is the size we need, but this isn't valid 32-bit x86. llvm-mc silently wraps it, which is also what happens when LLVM uses it in integrated-as mode. GAS also wraps it, though at least gives a warning:\r\n```\r\nt.s:21: Warning: 00000002fffffffc shortened to 00000000fffffffc\r\n```\r\nI've now filed https://bugs.llvm.org/show_bug.cgi?id=35345 concerning this.\r\n\r\nSince this code is entirely pathological, it seems reasonable to have compilers just reject it. I assume the fix for the above should be to have LLVM use `report_fatal_error`. I don't know when that bug will be fixed though, so it may be desirable to issue an error based on a conservative approximation before LLVM as well.\r\n\r\nIf Rust ever has the ability to emit dynamic-sized allocas, that may introduce other concerns not covered here.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/345268545/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/345344120",
    "html_url": "https://github.com/rust-lang/rust/issues/18072#issuecomment-345344120",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18072",
    "id": 345344120,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTM0NDEyMA==",
    "user": {
      "login": "bstrie",
      "id": 865233,
      "node_id": "MDQ6VXNlcjg2NTIzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bstrie",
      "html_url": "https://github.com/bstrie",
      "followers_url": "https://api.github.com/users/bstrie/followers",
      "following_url": "https://api.github.com/users/bstrie/following{/other_user}",
      "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions",
      "organizations_url": "https://api.github.com/users/bstrie/orgs",
      "repos_url": "https://api.github.com/users/bstrie/repos",
      "events_url": "https://api.github.com/users/bstrie/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bstrie/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-11-17T19:33:00Z",
    "updated_at": "2017-11-17T19:33:00Z",
    "body": "@sunfishcode Thank you for investigating! I've reopened this for the time being, now that we have something to actually go on.\r\n\r\nAs for alloca, you may be interested in this RFC: https://github.com/rust-lang/rfcs/pull/1909 , which is currently in its final comment period, and your comments would be very welcome. :)",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/345344120/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/781729717",
    "html_url": "https://github.com/rust-lang/rust/issues/18072#issuecomment-781729717",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18072",
    "id": 781729717,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MTcyOTcxNw==",
    "user": {
      "login": "lahwran",
      "id": 550498,
      "node_id": "MDQ6VXNlcjU1MDQ5OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/550498?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lahwran",
      "html_url": "https://github.com/lahwran",
      "followers_url": "https://api.github.com/users/lahwran/followers",
      "following_url": "https://api.github.com/users/lahwran/following{/other_user}",
      "gists_url": "https://api.github.com/users/lahwran/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lahwran/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lahwran/subscriptions",
      "organizations_url": "https://api.github.com/users/lahwran/orgs",
      "repos_url": "https://api.github.com/users/lahwran/repos",
      "events_url": "https://api.github.com/users/lahwran/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lahwran/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-02-19T00:33:40Z",
    "updated_at": "2021-02-19T00:37:11Z",
    "body": "A few questions I have on reading this issue and discussion:\r\n\r\n1. Will MIRI detect this issue now? if not, should it?\r\n2. has this ever been encountered in practice, or what code would be most likely to accidentally generate this situation?\r\n3. can valid, useful code ever generate this situation, or does encountering this situation necessarily entail invalid code? I don't *think* it makes sense to have a stack frame greater than the size of your address space, unless I've missed something :)\r\n4. how can we establish a guarantee around what behavior in LLVM caused the unsoundness? eg if I was going to understand this issue through its entire compilation pipeline as a motivated but new contributor, what test setup do I need and how do I ensure I have a full taxonomy of relevant branches in llvm's internals that affect its understanding of its input?  \r\n    -> I'm guessing this is going to be eg a full build of rustc+llvm with debug symbols and then step through to find the place where code is generated, then look that up in the llvm source and figure out why the invalid output isn't prevented. Is there an easier version of that, eg does anyone know where to start reading?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/781729717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/781987066",
    "html_url": "https://github.com/rust-lang/rust/issues/18072#issuecomment-781987066",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18072",
    "id": 781987066,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MTk4NzA2Ng==",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-02-19T10:30:50Z",
    "updated_at": "2021-02-19T10:30:50Z",
    "body": "I don't think Miri can do anything here; Miri doesn't really have the concept of a stack frame with a given \"size\". Similar to \"protect against stack and heap overlapping\", this is below the level of abstraction that Miri works on, and needs to be handled by the codegen backend.\r\n\r\n> If Rust ever has the ability to emit dynamic-sized allocas, that may introduce other concerns not covered here.\r\n\r\nNote that Rust nowadays has that ability (for the unstable `unsized_locals` feature).\r\n\r\nCc @rust-lang/wg-llvm ",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/781987066/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1175713156",
    "html_url": "https://github.com/rust-lang/rust/issues/18072#issuecomment-1175713156",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18072",
    "id": 1175713156,
    "node_id": "IC_kwDOAAsO6M5GE_WE",
    "user": {
      "login": "workingjubilee",
      "id": 46493976,
      "node_id": "MDQ6VXNlcjQ2NDkzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/workingjubilee",
      "html_url": "https://github.com/workingjubilee",
      "followers_url": "https://api.github.com/users/workingjubilee/followers",
      "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}",
      "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions",
      "organizations_url": "https://api.github.com/users/workingjubilee/orgs",
      "repos_url": "https://api.github.com/users/workingjubilee/repos",
      "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/workingjubilee/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-07-06T02:37:26Z",
    "updated_at": "2022-07-06T02:37:26Z",
    "body": "> 3. can valid, useful code ever generate this situation, or does encountering this situation necessarily entail invalid code? I don't think it makes sense to have a stack frame greater than the size of your address space, unless I've missed something :)\r\n\r\nThis situation can be generated by safe Rust code. In that sense, while it a priori does not make sense, we should error here, not miscompile. That is, if there is a problem, it is not in trying to allocate more space than our address space can contain, it is that we may **fail** to try to allocate too much space and crash the program at this point, instead getting some sort of incorrect behavior after silently wrapping that allows the program to continue to function while thinking its previous expressions were satisfied, thus accessing wrong locations that may somehow still be mapped into memory.\r\n\r\nIn practice, what I just described is a very unlikely sequence of events, but still: if a Rust program expresses a desire to go to a hell of its own making, we are honor-bound to send it there.\r\n\r\n> 4. how can we establish a guarantee around what behavior in LLVM caused the unsoundness? eg if I was going to understand this issue through its entire compilation pipeline as a motivated but new contributor, what test setup do I need and how do I ensure I have a full taxonomy of relevant branches in llvm's internals that affect its understanding of its input?\r\n\r\nYeah you nailed it pretty much, there. That would be the way to get full understanding.\r\nHowever I believe that examining how we build code and thus emit LLVMIR, via our bindings to codegen backends and in particular LLVM, between `rustc_codegen_ssa`, `rustc_codegen_llvm`, and in particular `rustc_llvm`, may reveal a spot in pure Rust control flow where we would attempt to emit a request for nonsense code and allow us to block it there.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1175713156/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
