[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51550360",
    "html_url": "https://github.com/rust-lang/rust/issues/16339#issuecomment-51550360",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16339",
    "id": 51550360,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNTUwMzYw",
    "user": {
      "login": "kvark",
      "id": 107301,
      "node_id": "MDQ6VXNlcjEwNzMwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/107301?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kvark",
      "html_url": "https://github.com/kvark",
      "followers_url": "https://api.github.com/users/kvark/followers",
      "following_url": "https://api.github.com/users/kvark/following{/other_user}",
      "gists_url": "https://api.github.com/users/kvark/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kvark/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kvark/subscriptions",
      "organizations_url": "https://api.github.com/users/kvark/orgs",
      "repos_url": "https://api.github.com/users/kvark/repos",
      "events_url": "https://api.github.com/users/kvark/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kvark/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-08T00:28:09Z",
    "updated_at": "2014-08-08T00:28:09Z",
    "body": "Adding @nikomatsakis, @zwarich, @pnkfelix, as per @cmr request.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51550360/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51550937",
    "html_url": "https://github.com/rust-lang/rust/issues/16339#issuecomment-51550937",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16339",
    "id": 51550937,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNTUwOTM3",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-08T00:38:10Z",
    "updated_at": "2014-08-08T00:39:55Z",
    "body": "Minimal example:\n\n``` rust\nfn small(x: &mut ()) -> &mut () {\n    (|| &mut *x)()\n}\n\n\nfn main() { }\n```\n\n(At the very least, expanding the macro will make handling this issue nicer.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51550937/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51594068",
    "html_url": "https://github.com/rust-lang/rust/issues/16339#issuecomment-51594068",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16339",
    "id": 51594068,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNTk0MDY4",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-08T12:25:00Z",
    "updated_at": "2014-08-08T12:25:00Z",
    "body": "I find it helpful to also make the lifetimes more explicit, where we can:\n\n``` rust\nfn small<'a>(x: &'a mut ()) -> &'a mut () {\n    let f = || &mut *x;\n    f()\n}\n\nfn main() { }\n```\n\nsince now at least one of the error messages are written in terms of `'a` instead of anonymous lifetimes of various spans.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51594068/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51605858",
    "html_url": "https://github.com/rust-lang/rust/issues/16339#issuecomment-51605858",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16339",
    "id": 51605858,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjA1ODU4",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-08T14:01:40Z",
    "updated_at": "2014-08-08T14:01:57Z",
    "body": "I believe this error message is correct. The problem is that the closure has a lifetime tied to the stack frame where it was created -- it is not allowed to create **mutable** aliases of `x` longer than that lifetime. To really do what you want, you would have to _move_ the variable `x` into the closure and then return it by moving out. But that is not possible with the current closure design (it will be possible once unboxed closures are fully realized).\n\nFor the time being, you can work around this by using  mutable options to move the value into the closure:\n\n```\nfn small<'a>(x: &'a mut ()) -> &'a mut () {\n    let mut x = Some(x);\n    let f = || {\n        let x = x.take().unwrap();\n        x\n    };\n    f()\n}\n\nfn main() { }\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51605858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51606181",
    "html_url": "https://github.com/rust-lang/rust/issues/16339#issuecomment-51606181",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16339",
    "id": 51606181,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjA2MTgx",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-08T14:04:21Z",
    "updated_at": "2014-08-08T14:04:21Z",
    "body": "For extra information: this situation is specific to mutable references, because we must guarantee that the mutable reference is the only reference with access to its referent. This means that they must be moved from place to place -- or reborrowed, but if they are reborrowed, it must be for a shorter duration than they were originally intended (more or less).\n\nWhat happens here is that when the closure is desugared, the reference to `x` becomes a borrowed reference to `x` under the hood (let's call it `b_x`). And hence the code like `&mut *x` is desugared into `&mut **b_x`. The variable `b_x` has type `&'closure mut &'a mut ()`, where `'closure` is the lifetime of the closure. Therefore, the referent of `b_x` can only be reborrowed for `'closure` at most, and `'closure` cannot exceed the enclosing stack frame.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51606181/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
