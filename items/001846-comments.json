[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3974380",
    "html_url": "https://github.com/rust-lang/rust/issues/1846#issuecomment-3974380",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1846",
    "id": 3974380,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NzQzODA=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-15T03:17:30Z",
    "updated_at": "2012-02-15T03:17:30Z",
    "body": "@marijnh I took the liberty of assigning you. :)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3974380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3974550",
    "html_url": "https://github.com/rust-lang/rust/issues/1846#issuecomment-3974550",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1846",
    "id": 3974550,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NzQ1NTA=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-15T03:41:24Z",
    "updated_at": "2012-02-15T03:41:24Z",
    "body": "This similar code fails under valgrind:\n\n```\ntype foo<T> = {                                                                                                                                                               \n        mutable f: option<@T>                                                                                                                                                 \n};                                                                                                                                                                            \n\nfn upd<T>(&&f: foo<T>, g: fn(T)) {                                                                                                                                            \n    alt f.f {                                                                                                                                                                 \n      some(v) {                                                                                                                                                               \n            g(*(copy v));                                                                                                                                                     \n            let x = v;                                                                                                                                                        \n      }                                                                                                                                                                       \n      none { }                                                                                                                                                                \n    }                                                                                                                                                                         \n}                                                                                                                                                                             \n\nfn main() {                                                                                                                                                                   \n    let x = @{mutable f: some(@3u)};                                                                                                                                          \n    let y = x;                                                                                                                                                                \n    upd(*x) {|v|                                                                                                                                                              \n            y.f = none;                                                                                                                                                       \n    }                                                                                                                                                                         \n} \n```\n\n```\n==22826== Thread 3:\n==22826== Use of uninitialised value of size 8\n==22826==    at 0x401237: upd::_40f19aefb9a467f6 (in /home/brian/dev/rust/build/x86_64-unknown-linux-gnu/test/run-pass/test.stage1-x86_64-unknown-linux-gnu)\n==22826==    by 0x4013C2: main::_843f8e32b1779b32 (in /home/brian/dev/rust/build/x86_64-unknown-linux-gnu/test/run-pass/test.stage1-x86_64-unknown-linux-gnu)\n==22826==    by 0x401599: _rust_main (in /home/brian/dev/rust/build/x86_64-unknown-linux-gnu/test/run-pass/test.stage1-x86_64-unknown-linux-gnu)\n==22826==    by 0x5156395: task_start_wrapper(spawn_args*) (rust_task.cpp:181)\n==22826==\n==22826==\n==22826== Process terminating with default action of signal 11 (SIGSEGV)\n==22826==  Bad permissions for mapped region at address 0x4A2366C\n==22826==    at 0x401241: upd::_40f19aefb9a467f6 (in /home/brian/dev/rust/build/x86_64-unknown-linux-gnu/test/run-pass/test.stage1-x86_64-unknown-linux-gnu)\n==22826==    by 0x4013C2: main::_843f8e32b1779b32 (in /home/brian/dev/rust/build/x86_64-unknown-linux-gnu/test/run-pass/test.stage1-x86_64-unknown-linux-gnu)\n==22826==    by 0x401599: _rust_main (in /home/brian/dev/rust/build/x86_64-unknown-linux-gnu/test/run-pass/test.stage1-x86_64-unknown-linux-gnu)\n==22826==    by 0x5156395: task_start_wrapper(spawn_args*) (rust_task.cpp:181)\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3974550/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3974557",
    "html_url": "https://github.com/rust-lang/rust/issues/1846#issuecomment-3974557",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1846",
    "id": 3974557,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NzQ1NTc=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-15T03:42:34Z",
    "updated_at": "2012-02-15T03:42:34Z",
    "body": "Peering more closely, I think that there are implicit copies happening here, which explains the extra ref count.  In that case, requiring an explicit copy seems unnecessary, though not terribly harmful. Not sure what's going on with brson's valgrind results.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3974557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3977240",
    "html_url": "https://github.com/rust-lang/rust/issues/1846#issuecomment-3977240",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1846",
    "id": 3977240,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NzcyNDA=",
    "user": {
      "login": "marijnh",
      "id": 144427,
      "node_id": "MDQ6VXNlcjE0NDQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marijnh",
      "html_url": "https://github.com/marijnh",
      "followers_url": "https://api.github.com/users/marijnh/followers",
      "following_url": "https://api.github.com/users/marijnh/following{/other_user}",
      "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions",
      "organizations_url": "https://api.github.com/users/marijnh/orgs",
      "repos_url": "https://api.github.com/users/marijnh/repos",
      "events_url": "https://api.github.com/users/marijnh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marijnh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-15T09:22:21Z",
    "updated_at": "2012-02-15T09:22:21Z",
    "body": "Structurally mutable values and type parameters are not copied implicitly. This is why you need the explicit copy in `g(*(copy v))`.\n\nAs for the valgrind uncleanness -- that's not good. Investigating.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3977240/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
