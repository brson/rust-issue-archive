[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62308446",
    "html_url": "https://github.com/rust-lang/rust/issues/18784#issuecomment-62308446",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18784",
    "id": 62308446,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzA4NDQ2",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-09T16:12:38Z",
    "updated_at": "2014-11-09T16:12:58Z",
    "body": "Regardless of what else we do, reducing memory consumption would also, of course, be a good idea. I ran massif on master (16d80de, to be precise) and the [output is here](https://gist.github.com/nikomatsakis/ce749c0e76ad18cb4de0). I haven't had time to look yet. I suspect we can do a lot to reduce the type-checking peak; not sure what's the best way to approach the LLVM side -- perhaps the parallel compilation logic can help here.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62308446/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62309757",
    "html_url": "https://github.com/rust-lang/rust/issues/18784#issuecomment-62309757",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18784",
    "id": 62309757,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzA5NzU3",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-09T16:45:45Z",
    "updated_at": "2014-11-09T16:46:54Z",
    "body": "I've had this idea of splitting the type interner/context into a global and a local (per-function) one.\nThe reasoning is that most of the types being interned (almost **90%** [at the time I did some stats](https://gist.github.com/eddyb/20fb641bc5e3794049da)) have function-specific inference variables and never outlive the writeback phase of that function's type-checking.\n\nHowever, it's not an easy thing to do - #18483 aka `safe-ty` wasn't possible at all for many months, only a few weeks ago all the ICEs it was triggering were fixed, and it's still just a pre-requisite for the actual change.\n\nWhich is pretty much impossible right now. Certain lifetime elision features need to be implemented in order for further experimentation to be possible, and I can't do much, given school and personal defficiencies.\n\nIf desired, I can update the code generating those statistics, add indirect memory usage estimates and run it on master, to get us an estimation.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62309757/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62716658",
    "html_url": "https://github.com/rust-lang/rust/issues/18784#issuecomment-62716658",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18784",
    "id": 62716658,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzE2NjU4",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T13:23:27Z",
    "updated_at": "2014-11-12T13:23:27Z",
    "body": "So I think we have to attack this problem with a variety of approaches. It's blocking lots of important PRs and that has to stop -- at the same time, we should think about longer term fixes as well. From reading the massif output, I see that:\n1. The peak memory usage is indeed by LLVM, and it does (indeed) not go through jemalloc. Do we have actual measurements of how much jemalloc helps here?\n2. Another way to reduce the LLVM peak might be to use the work on parallel compilation to break the output into chunks and compile them sequentially, freeing memory in between.\n3. The second-highest peak occurs after monomorphization I believe. Looking at the massif output, it appears that roughly 20% of the type memory is due to types created during trans, and approximately 10% is created due to types created during memory matching. It may be possible to reduce those. I've done some instrumentation looking into the contents of those types but need to do more.\n4. It occurs to me that the easiest way to sidestep this in the short term is probably just to break librustc into crates, so as to reduce the overall size of the compilation unit.\n\ncc @aturon @pcwalton @alexcrichton \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62716658/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62753312",
    "html_url": "https://github.com/rust-lang/rust/issues/18784#issuecomment-62753312",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18784",
    "id": 62753312,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzUzMzEy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T17:05:41Z",
    "updated_at": "2014-11-12T17:05:41Z",
    "body": "I think that using jemalloc in LLVM or splitting up librustc is the best way to go for now.\n\nGetting the benefit of extra compilation units may be somewhat difficult. I think we'd have to translate/destroy each one of them in turn instead of what we do now which is to build all compilation units at once and _then_ compile them. I would suspect that there's a large amount of duplicated data between contexts so the trans peak would be higher. But then again of the LLVM peak is higher than the trans peak, maybe it wouldn't be so bad...\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62753312/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62822575",
    "html_url": "https://github.com/rust-lang/rust/issues/18784#issuecomment-62822575",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18784",
    "id": 62822575,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyODIyNTc1",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-13T00:44:43Z",
    "updated_at": "2014-11-13T00:44:43Z",
    "body": "On Wed, Nov 12, 2014 at 09:05:45AM -0800, Alex Crichton wrote:\n\n> I think that using jemalloc in LLVM or splitting up librustc is the best way to go for now.\n\nI've made some progress on splitting up librustc. I've also found that\nthe method dispatch PR I want to land winds up creating a lot of types\nand taking more memory. I'm going to see what can be done about that,\nI don't understand yet what's going on precisely.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62822575/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62822890",
    "html_url": "https://github.com/rust-lang/rust/issues/18784#issuecomment-62822890",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18784",
    "id": 62822890,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyODIyODkw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-13T00:48:03Z",
    "updated_at": "2014-11-13T00:48:03Z",
    "body": "https://github.com/rust-lang/rust/issues/18896 will be the new attempt at using jemalloc in just executables via symbol aliases\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62822890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63176116",
    "html_url": "https://github.com/rust-lang/rust/issues/18784#issuecomment-63176116",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18784",
    "id": 63176116,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMTc2MTE2",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-15T15:34:50Z",
    "updated_at": "2014-11-15T15:34:50Z",
    "body": "[This branch](https://github.com/nikomatsakis/rust/tree/crates) breaks up rustc into two crates. It builds up to rustdoc. The division is not \"logical\" necessarily, I based it purely on the dependencies in the modules, though it kind of makes sense -- basically it moves the overarching driver plus everything that occurs after trans into another crate. I haven't measured the overall effect on memory usage.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63176116/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63216919",
    "html_url": "https://github.com/rust-lang/rust/issues/18784#issuecomment-63216919",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18784",
    "id": 63216919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMjE2OTE5",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-16T12:10:10Z",
    "updated_at": "2014-11-16T12:10:10Z",
    "body": "https://github.com/rust-lang/rust/pull/19002 implements the proposed crate split.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63216919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66759484",
    "html_url": "https://github.com/rust-lang/rust/issues/18784#issuecomment-66759484",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18784",
    "id": 66759484,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NzU5NDg0",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-12T11:04:39Z",
    "updated_at": "2014-12-12T11:04:39Z",
    "body": "I think the crate splits have basically fixed this issue. Closing. Re-open if you disagree.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66759484/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
