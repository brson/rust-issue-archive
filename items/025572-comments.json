[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/103083616",
    "html_url": "https://github.com/rust-lang/rust/pull/25572#issuecomment-103083616",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25572",
    "id": 103083616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMzA4MzYxNg==",
    "user": {
      "login": "rust-highfive",
      "id": 7378925,
      "node_id": "MDQ6VXNlcjczNzg5MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7378925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rust-highfive",
      "html_url": "https://github.com/rust-highfive",
      "followers_url": "https://api.github.com/users/rust-highfive/followers",
      "following_url": "https://api.github.com/users/rust-highfive/following{/other_user}",
      "gists_url": "https://api.github.com/users/rust-highfive/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rust-highfive/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rust-highfive/subscriptions",
      "organizations_url": "https://api.github.com/users/rust-highfive/orgs",
      "repos_url": "https://api.github.com/users/rust-highfive/repos",
      "events_url": "https://api.github.com/users/rust-highfive/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rust-highfive/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-18T14:46:04Z",
    "updated_at": "2015-05-18T14:46:04Z",
    "body": "r? @aturon\n\n(rust_highfive has picked a reviewer for you, use r? to override)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/103083616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106551722",
    "html_url": "https://github.com/rust-lang/rust/pull/25572#issuecomment-106551722",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25572",
    "id": 106551722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjU1MTcyMg==",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-28T18:29:05Z",
    "updated_at": "2015-05-28T18:29:05Z",
    "body": "@nagisa Sorry for the long delay on this review! I have a few concerns.\n\nWhat's the rationale for restricting this change to the `read` function only? Presumably other methods of reading should behave similarly?\n\nHave you thought much about the potential for deadlock, given that you can actually acquire the lock for `stdout` separately, but that lock is also required to flush it? I.e., I'm worried about a situation where one thread is holding the lock for `stdout`, and another thread tries to read from `stdin` -- if those threads are also communicating with each other, there is potential for deadlock, which may be somewhat surprising if you don't realize that reading from `stdin` requires lock acquisition for `stdout`.\n\nI'm not sure that's a blocker per se, but definitely seems like a concern.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106551722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106566914",
    "html_url": "https://github.com/rust-lang/rust/pull/25572#issuecomment-106566914",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25572",
    "id": 106566914,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjU2NjkxNA==",
    "user": {
      "login": "nagisa",
      "id": 679122,
      "node_id": "MDQ6VXNlcjY3OTEyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nagisa",
      "html_url": "https://github.com/nagisa",
      "followers_url": "https://api.github.com/users/nagisa/followers",
      "following_url": "https://api.github.com/users/nagisa/following{/other_user}",
      "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions",
      "organizations_url": "https://api.github.com/users/nagisa/orgs",
      "repos_url": "https://api.github.com/users/nagisa/repos",
      "events_url": "https://api.github.com/users/nagisa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nagisa/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-28T19:00:55Z",
    "updated_at": "2015-05-28T19:00:55Z",
    "body": "> Minor nit: let _ = stdout().flush() is a bit more common than drop(stdout().flush()).\n\nNote, that all this patch does is really reverting #23087. \n\n> What's the rationale for restricting this change to the read function only? Presumably other methods of reading should behave similarly?\n\nSimilarly, this is just a revert of functionality available previously. I believe @alexcrichton would know better about why only `read` was flushing.\n\n> Have you thought much about the potential for deadlock, given that you can actually acquire the lock for stdout separately, but that lock is also required to flush it?\n\nDeadlock is indeed a possibility and I don\u2019t see us ever being able to avoid it fully if we want to implement something like this. Before it was very easy to cause the deadlock, which was a strong motivator to remove flushing; People are having issues with status quo now and might actually prefer occasional deadlocks to lack of hand holding.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106566914/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106629377",
    "html_url": "https://github.com/rust-lang/rust/pull/25572#issuecomment-106629377",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25572",
    "id": 106629377,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjYyOTM3Nw==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-28T23:36:16Z",
    "updated_at": "2015-05-28T23:36:16Z",
    "body": "> I believe @alexcrichton would know better about why only read was flushing.\n\nOne key difference is that it was previously flushing inside of `StdinLock` instead of `Stdin`, so this PR won't actually flush unless you call `read` specifically on `Stdin`, e.g. not `read_to_end`, `read_line`, etc.\n\n> Deadlock is indeed a possibility and I don\u2019t see us ever being able to avoid it fully if we want to implement something like this.\n\nI agree, and I personally also viewed the removal in #23087 as a stance that \"we're not ever going to do this\" as silent locking behind the scenes is inevitably going to trip some up and be difficult to debug. My own opinion is that this is not what the standard library should be doing, and instead it needs to be (and maybe already is) clearly documented about the buffering that the standard input/output streams do so users are aware of the need to flush. \n\nI would not be ready to say that 100% of users of `Stdin` want to flush stdout whenever it's read, which is what makes me wary of this.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106629377/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106870531",
    "html_url": "https://github.com/rust-lang/rust/pull/25572#issuecomment-106870531",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25572",
    "id": 106870531,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjg3MDUzMQ==",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-29T16:57:15Z",
    "updated_at": "2015-05-29T16:57:15Z",
    "body": "@alexcrichton \n\nThe main counterarguments are:\n- The lack of flushing is much more likely to be a footgun than the deadlock issue, since it's much more rare to explicitly take stdio locks, and we can clearly document the interaction with flushing. I believe that this flushing behavior is also pretty common in other languages, so not doing it may break people's expectations.\n- We already have a fair amount of \"magic\" going on here just in providing built-in locks, etc. So it's not a huge departure to also bake in a flush. Though it _is_ a bit concerning if there's no way to read without instigating a flush.\n\nI'm pretty on the fence about this one. Would be great to hear from others in @rust-lang/libs!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106870531/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106876262",
    "html_url": "https://github.com/rust-lang/rust/pull/25572#issuecomment-106876262",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25572",
    "id": 106876262,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjg3NjI2Mg==",
    "user": {
      "login": "BurntSushi",
      "id": 456674,
      "node_id": "MDQ6VXNlcjQ1NjY3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/456674?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/BurntSushi",
      "html_url": "https://github.com/BurntSushi",
      "followers_url": "https://api.github.com/users/BurntSushi/followers",
      "following_url": "https://api.github.com/users/BurntSushi/following{/other_user}",
      "gists_url": "https://api.github.com/users/BurntSushi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/BurntSushi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BurntSushi/subscriptions",
      "organizations_url": "https://api.github.com/users/BurntSushi/orgs",
      "repos_url": "https://api.github.com/users/BurntSushi/repos",
      "events_url": "https://api.github.com/users/BurntSushi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/BurntSushi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-29T17:20:50Z",
    "updated_at": "2015-05-29T17:20:50Z",
    "body": "I'm more inclined for the conservative approach here: don't flush stdout when reading from stdin. It seems incredibly surprising to me that this would be default behavior.\n\nI do recognize that _not_ flushing can also lead to surprising behavior based on experience with other languages. But I think Rust leans more toward the explicit end of things and flushing stdout when reading stdin leans more toward the implicit end of things IMO.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106876262/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106934021",
    "html_url": "https://github.com/rust-lang/rust/pull/25572#issuecomment-106934021",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25572",
    "id": 106934021,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjkzNDAyMQ==",
    "user": {
      "login": "sfackler",
      "id": 1455697,
      "node_id": "MDQ6VXNlcjE0NTU2OTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sfackler",
      "html_url": "https://github.com/sfackler",
      "followers_url": "https://api.github.com/users/sfackler/followers",
      "following_url": "https://api.github.com/users/sfackler/following{/other_user}",
      "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions",
      "organizations_url": "https://api.github.com/users/sfackler/orgs",
      "repos_url": "https://api.github.com/users/sfackler/repos",
      "events_url": "https://api.github.com/users/sfackler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sfackler/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-29T20:56:23Z",
    "updated_at": "2015-05-29T20:56:23Z",
    "body": "We could avoid the deadlock issues by having one reentrant lock around both stdin and stdout (might as well throw stderr in as well at that point). I don't _think_ it'd cause contention issues in reasonable code but I guess it's possible?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106934021/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106938212",
    "html_url": "https://github.com/rust-lang/rust/pull/25572#issuecomment-106938212",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25572",
    "id": 106938212,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjkzODIxMg==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-29T21:17:02Z",
    "updated_at": "2015-05-29T21:17:02Z",
    "body": "The idea of only one reentrant lock actually isn't so bad I think. I'm still a little uncomfortable with the reads-always-flush-no-matter-what behavior, but I believe that I could come to live with it as once you've already got a lock the overhead should be fairly negligible.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106938212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/110860578",
    "html_url": "https://github.com/rust-lang/rust/pull/25572#issuecomment-110860578",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25572",
    "id": 110860578,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMDg2MDU3OA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-10T18:13:16Z",
    "updated_at": "2015-06-10T18:13:16Z",
    "body": "It's looking like the consensus here is leaning more towards not taking this change, largely because of the surprising locking behavior. It's also unclear how much the standard library should be doing in this regard in terms of being as \"systemsy\" as possible where each operation has a clear implementation (after assuming the buffering/locking necessary, however). Additionally, the use case this is fixing doesn't quite seem to be worth the cost.\n\nI also think that @sfackler's idea for one global lock can also lead to surprising deadlocks, for example if one conceptually thinks of stdout/stdin being separately locked then it's possible to get into a deadlock when mixing another resource's lock.\n\nFor these reasons I'm going to close this for now, but I would encourage you to write up a discuss post if you want to pursue this to gauge the general opinion of others to see if this is a desirable change and what the possible impact could be. Regardless, though, thanks again for the PR!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/110860578/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
