[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69078638",
    "html_url": "https://github.com/rust-lang/rust/issues/20698#issuecomment-69078638",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20698",
    "id": 69078638,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDc4NjM4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-07T19:39:11Z",
    "updated_at": "2015-01-07T19:39:11Z",
    "body": "Can you get a backtrace at what's failing as well? I would be quite surprised if we destroyed a mutex twice, because that's certainly very bad! Can you also make sure that this passes successfully for you?\n\n``` c\n#include <assert.h>\n#include <pthread.h>\n\nint main() {\n  pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;\n  assert(pthread_mutex_destroy(&lock) == 0);\n}\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69078638/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69160235",
    "html_url": "https://github.com/rust-lang/rust/issues/20698#issuecomment-69160235",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20698",
    "id": 69160235,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTYwMjM1",
    "user": {
      "login": "mneumann",
      "id": 34112,
      "node_id": "MDQ6VXNlcjM0MTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/34112?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mneumann",
      "html_url": "https://github.com/mneumann",
      "followers_url": "https://api.github.com/users/mneumann/followers",
      "following_url": "https://api.github.com/users/mneumann/following{/other_user}",
      "gists_url": "https://api.github.com/users/mneumann/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mneumann/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mneumann/subscriptions",
      "organizations_url": "https://api.github.com/users/mneumann/orgs",
      "repos_url": "https://api.github.com/users/mneumann/repos",
      "events_url": "https://api.github.com/users/mneumann/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mneumann/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-08T10:15:54Z",
    "updated_at": "2015-01-08T10:15:54Z",
    "body": "It <b>fails</b> with error code 22, if I compile it like `cc -pthread test.c`. If I compile it without `-pthread` it works. I noticed that in general pthread functions (e.g. `pthread_key_create`) only work within a pthread-created thread, not in the main thread. I'll send this to the DragonFly specific mailing list for additional help.\n\nThe backtrace of the example program I gave above is:\n\n```\nthread '<main>' panicked at 'assertion failed: `(left == right) && (right == left)` (left: `22`, right: `0`)', /home/mneumann/disk/neu/rust-cross-dragonfly/stage2-linux/rust/src/libstd/sys/unix/mutex.rs:53\nstack backtrace:\n   1:          0x1050730 - sys::backtrace::write::h6c2cb1f1132defcbQft\n   2:          0x105e7a0 - failure::on_fail::h52cb2223a000b31akgz\n   3:          0x102ce30 - rt::unwind::begin_unwind_inner::h5cadd3b8e3af94baoUy\n   4:          0x102d780 - rt::unwind::begin_unwind_fmt::hdcce387453c77319VSy\n   5:          0x1028240 - sys::mutex::Mutex::destroy::h944d68132516e13eymu\n   6:          0x1028200 - sys_common::mutex::Mutex::destroy::h05060b7894b378a0U8w\n   7:          0x10281c0 - sync::mutex::Mutex<T>.Drop::drop::h9736437216186091782\n   8:          0x1028130 - std..sync..mutex..Mutex<bool>::glue_drop.1740::hc29669eec6ad0cb3\n   9:          0x10280d0 - std..thread..Inner::glue_drop.1737::h852294eb2538a0c8\n  10:          0x10280a0 - mem::drop::h5042620272860910571\n  11:          0x1027da0 - arc::Arc<T>.Drop::drop::h2578377223763874141\n  12:          0x1027d70 - alloc..arc..Arc<std..thread..Inner>::glue_drop.1734::hdefd71314919f852\n  13:          0x1027d40 - std..thread..Thread::glue_drop.1731::h5e295f37c79aa596\n  14:          0x102c900 - std..thread..JoinGuard<(*>::glue_drop.2140::h772f4f23477015a3\n  15:          0x102c7e0 - thread::JoinGuard<T>::join::h10970293053447468842\n  16:          0x1025630 - main::he5cc945d2fe13fb6faa\n  17:          0x1062540 - rt::lang_start::unboxed_closure.33933\n  18:          0x10624d0 - rt::unwind::try::try_fn::__rust_abi::h1667473091729999914\n  19:          0x1062490 - rt::unwind::try::try_fn::h1667473091729999914\n  20:          0x1070180 - rust_try_inner\n  21:          0x1070170 - rust_try\n  22:          0x1062060 - rt::unwind::try::h17451077907674403930\n  23:          0x1061d30 - rt::lang_start::h35714ae31d7a9360V9y\n  24:          0x10257b0 - main\n  25:                0x0 - <unknown>\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69160235/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69162062",
    "html_url": "https://github.com/rust-lang/rust/issues/20698#issuecomment-69162062",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20698",
    "id": 69162062,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTYyMDYy",
    "user": {
      "login": "mneumann",
      "id": 34112,
      "node_id": "MDQ6VXNlcjM0MTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/34112?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mneumann",
      "html_url": "https://github.com/mneumann",
      "followers_url": "https://api.github.com/users/mneumann/followers",
      "following_url": "https://api.github.com/users/mneumann/following{/other_user}",
      "gists_url": "https://api.github.com/users/mneumann/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mneumann/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mneumann/subscriptions",
      "organizations_url": "https://api.github.com/users/mneumann/orgs",
      "repos_url": "https://api.github.com/users/mneumann/repos",
      "events_url": "https://api.github.com/users/mneumann/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mneumann/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-08T10:32:53Z",
    "updated_at": "2015-01-08T10:32:53Z",
    "body": "Interestingly, it does not fail once it goes through a lock/unlock cycle prior of destruction:\n\n``` c\n#include <pthread.h>\n#include <stdio.h>\n\nint main() {\n    int err = 0;\n    pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;\n\n    err = pthread_mutex_lock(&mutex);\n    printf(\"lock: %d\\n\", err);\n\n    err = pthread_mutex_unlock(&mutex);\n    printf(\"unlock: %d\\n\", err);\n\n    err = pthread_mutex_destroy(&mutex);\n    printf(\"destroy1: %d\\n\", err);\n\n    err = pthread_mutex_destroy(&mutex);\n    printf(\"destroy2: %d\\n\", err);      \n\n    return 0;\n}\n```\n\nreturns:\n\n```\nlock: 0\nunlock: 0\ndestroy1: 0\ndestroy2: 22\n```\n\nAnd also, if I call `pthread_mutex_init()` prior of `pthread_mutex_destroy()` it works, too.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69162062/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/153917641",
    "html_url": "https://github.com/rust-lang/rust/issues/20698#issuecomment-153917641",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20698",
    "id": 153917641,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MzkxNzY0MQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-05T00:47:26Z",
    "updated_at": "2015-11-05T00:47:26Z",
    "body": "I believe this was mitigated in #20741\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/153917641/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/154202280",
    "html_url": "https://github.com/rust-lang/rust/issues/20698#issuecomment-154202280",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20698",
    "id": 154202280,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1NDIwMjI4MA==",
    "user": {
      "login": "mneumann",
      "id": 34112,
      "node_id": "MDQ6VXNlcjM0MTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/34112?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mneumann",
      "html_url": "https://github.com/mneumann",
      "followers_url": "https://api.github.com/users/mneumann/followers",
      "following_url": "https://api.github.com/users/mneumann/following{/other_user}",
      "gists_url": "https://api.github.com/users/mneumann/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mneumann/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mneumann/subscriptions",
      "organizations_url": "https://api.github.com/users/mneumann/orgs",
      "repos_url": "https://api.github.com/users/mneumann/repos",
      "events_url": "https://api.github.com/users/mneumann/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mneumann/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-05T21:42:59Z",
    "updated_at": "2015-11-05T21:42:59Z",
    "body": "Yes! #20741 fixed it!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/154202280/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
