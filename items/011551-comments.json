[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32328868",
    "html_url": "https://github.com/rust-lang/rust/issues/11551#issuecomment-32328868",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11551",
    "id": 32328868,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMzI4ODY4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-15T02:15:42Z",
    "updated_at": "2014-01-15T02:15:42Z",
    "body": "Another idea that @Aatch came up with was to put the discriminant at the end of the struct so we wouldn't have to worry about alignment at all (and we keep the same size calculations that we have today).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32328868/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32522074",
    "html_url": "https://github.com/rust-lang/rust/issues/11551#issuecomment-32522074",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11551",
    "id": 32522074,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNTIyMDc0",
    "user": {
      "login": "jld",
      "id": 254973,
      "node_id": "MDQ6VXNlcjI1NDk3Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/254973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jld",
      "html_url": "https://github.com/jld",
      "followers_url": "https://api.github.com/users/jld/followers",
      "following_url": "https://api.github.com/users/jld/following{/other_user}",
      "gists_url": "https://api.github.com/users/jld/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jld/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jld/subscriptions",
      "organizations_url": "https://api.github.com/users/jld/orgs",
      "repos_url": "https://api.github.com/users/jld/repos",
      "events_url": "https://api.github.com/users/jld/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jld/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-16T19:45:49Z",
    "updated_at": "2014-01-16T19:45:49Z",
    "body": "`Option<uint>` is more like:\n\n``` C\nunion {\n  struct { u8 tag; uint value; } Some;\n  struct { u8 tag; } None;\n}\n```\n\nAnd similarly for any other general-case enum.  I mention this because the nice thing about having the discriminant at the beginning is that we don't have to do anything fancy in the per-variant LLVM types to have it at the right offset.\n\nIf we just want to get rid of the `{ i8, [7 x i8], i64 }` thing, could we use `{ [8 x i8], i64 }` instead, and add another 0 to the GEP address of the discriminant?  Would LLVM fail to optimize things because of the array indexing involved?  Would copying the `[8 x i8]` be handled like copying an`i64` or would LLVM still do something weird?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32522074/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32522426",
    "html_url": "https://github.com/rust-lang/rust/issues/11551#issuecomment-32522426",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11551",
    "id": 32522426,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNTIyNDI2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-16T19:49:29Z",
    "updated_at": "2014-01-16T19:49:29Z",
    "body": "I've seen LLVM do some nice optimizations in the past of `memcpy` with size 8 becoming a load of a 64-bit value, so I think that changing to `[i8 x 8]` would also help this. The true solution is to use `tbaa.struct` to tell LLVM that it doesn't need to copy the intermediary.\n\nIf this is an involved solution, then it's not really worth it to pursue. Out of curiosity, is there a reason for `Option<uint>` to _not_ have a `uint` discriminant? I figured we'd just change some calculation somewhere to put the lower bound of the discriminant size at the maximum alignment and then everything else would be fixed, but I'm also not familiar with the code so I'm not sure how hard that would be.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32522426/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32682367",
    "html_url": "https://github.com/rust-lang/rust/issues/11551#issuecomment-32682367",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11551",
    "id": 32682367,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNjgyMzY3",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-18T13:50:59Z",
    "updated_at": "2014-01-18T13:50:59Z",
    "body": "If `Option<uint>` was like this:\n\n``` C\nstruct {\n    union {\n        uint value;\n    }\n    u8 tag;\n}\n```\n\nWouldn't that get avoid the alignment issue without requiring special handling for each variant? Basically the LLVM type would change from `{ i8, [7 x i8], [1 x i64] }` to `{ [1 x i64], i8 }`, which seems easier overall. Just passing 1 instead of 0 to GEP. Am I missing anything?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32682367/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32682423",
    "html_url": "https://github.com/rust-lang/rust/issues/11551#issuecomment-32682423",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11551",
    "id": 32682423,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNjgyNDIz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-18T13:53:36Z",
    "updated_at": "2014-01-18T13:53:36Z",
    "body": "@dotdash: You're missing that `struct { i64, i8 }` needs to have padding in order to maintain the correct alignment for `i64` in an array. Rust is responsible for handling padding in the frontend.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32682423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32682742",
    "html_url": "https://github.com/rust-lang/rust/issues/11551#issuecomment-32682742",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11551",
    "id": 32682742,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNjgyNzQy",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-18T14:11:26Z",
    "updated_at": "2014-01-18T14:11:26Z",
    "body": "@thestinger: Ah right, completely lost track of arrays somewhere in the middle of my thoughts.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/32682742/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33307376",
    "html_url": "https://github.com/rust-lang/rust/issues/11551#issuecomment-33307376",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11551",
    "id": 33307376,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMzA3Mzc2",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-26T02:38:58Z",
    "updated_at": "2014-01-26T02:38:58Z",
    "body": "cc https://github.com/mozilla/rust/issues/6736 for tbaa.struct.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33307376/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33311250",
    "html_url": "https://github.com/rust-lang/rust/issues/11551#issuecomment-33311250",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/11551",
    "id": 33311250,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMzExMjUw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-26T07:29:25Z",
    "updated_at": "2014-01-26T07:29:25Z",
    "body": "I've been led to believe that this isn't as easy a solution as I thought, and in some cases this may make structs larger. I'm going to close in favor of the correct solution, #6736 \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33311250/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
