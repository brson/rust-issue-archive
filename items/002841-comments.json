[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/6834984",
    "html_url": "https://github.com/rust-lang/rust/issues/2841#issuecomment-6834984",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2841",
    "id": 6834984,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzQ5ODQ=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-07-08T21:17:51Z",
    "updated_at": "2012-07-08T21:17:51Z",
    "body": "This seems to be even more serious than I thought: I rewrote my code to use select2 instead of peek and now the select2 is hanging...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/6834984/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/6836609",
    "html_url": "https://github.com/rust-lang/rust/issues/2841#issuecomment-6836609",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2841",
    "id": 6836609,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzY2MDk=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-07-09T00:43:08Z",
    "updated_at": "2012-07-09T00:43:08Z",
    "body": "Was able to work around this using task::spawn_sched:\n\n```\n// rustc --test multiple_tasks.rs && ./multiple_tasks\nuse std;\n\nenum control_event\n{\n    dup_event(str, comm::chan<str>),\n    close_event,\n}\n\n// This works with single_threaded and with manual_threads(4|16).\n// Also tried thread_per_core and thread_per_task but they are not\n// implemented.\nfn silly2(n: uint) -> comm::chan<control_event>\n{\n    let channel_port = comm::port();\n    let channel_channel = comm::chan(channel_port);\n\n    do task::spawn_sched(task::manual_threads(4))\n    {\n        let control_port: comm::port<control_event> = comm::port();    // this is bookkeeping that spawn_listener handles for us\n        let control_channel = comm::chan(control_port);\n        comm::send(channel_channel, control_channel);\n\n        io::println(#fmt[\"started task %?\", n]);\n        loop\n        {\n            libc::funcs::posix88::unistd::sleep(1);\n\n            if comm::peek(control_port)\n            {\n                alt comm::recv(control_port)\n                {\n                    dup_event(data, data_ch)\n                    {\n                        io::println(#fmt[\"task %? received %?\", n, data]);\n                        comm::send(data_ch, data + data);\n                    }\n                    close_event\n                    {\n                        io::println(#fmt[\"exiting task %?\", n]);\n                        break;\n                    }\n                }\n            }\n        }\n    };\n\n    comm::recv(channel_port)\n}\n\n#[test]\nfn blah()\n{\n    let po = comm::port();\n    let ch = comm::chan(po);\n\n    let silly_channels = do vec::from_fn(10) |n| {silly2(n)};\n\n    for vec::each(silly_channels)\n    |sc|\n    {\n        comm::send(sc, dup_event(\"hey\", ch));\n        assert comm::recv(po) == \"heyhey\";\n    }\n\n    for vec::each(silly_channels)\n    |sc|\n    {\n        comm::send(sc, close_event);\n    }\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/6836609/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/6853614",
    "html_url": "https://github.com/rust-lang/rust/issues/2841#issuecomment-6853614",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2841",
    "id": 6853614,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NTM2MTQ=",
    "user": {
      "login": "eholk",
      "id": 105766,
      "node_id": "MDQ6VXNlcjEwNTc2Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eholk",
      "html_url": "https://github.com/eholk",
      "followers_url": "https://api.github.com/users/eholk/followers",
      "following_url": "https://api.github.com/users/eholk/following{/other_user}",
      "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eholk/subscriptions",
      "organizations_url": "https://api.github.com/users/eholk/orgs",
      "repos_url": "https://api.github.com/users/eholk/repos",
      "events_url": "https://api.github.com/users/eholk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eholk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-07-09T17:33:57Z",
    "updated_at": "2012-07-09T17:33:57Z",
    "body": "I suspect the call to `libc::funcs::posix88::unistd::sleep(1)` might be part of the problem. `sleep` is outside of the realm of things the Rust scheduler is aware of, and so sleeping blocks a whole thread instead of allowing other tasks to run on that thread while the sleeping task is sleeping. I'd recommend using `std::timer::sleep`, which the Rust scheduler is aware of. That said, `unistd::sleep` should wake up eventually, so I'm surprised this is hanging rather than just taking a potentially very long time to finish.\n\nAlso, `recv` blocks until data is available on a port, so sleeping in the loop isn't really necessary. It may be that you want to periodically perform some other processing though. If this is the case, I'd suggest using `std::timer::recv_timeout`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/6853614/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/6963068",
    "html_url": "https://github.com/rust-lang/rust/issues/2841#issuecomment-6963068",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2841",
    "id": 6963068,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NjMwNjg=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-07-13T13:25:51Z",
    "updated_at": "2012-07-13T13:25:51Z",
    "body": "I don't think this behavior can be pinned on unistd::sleep (exclusively). Yesterday I saw the same symptom (task not starting up) and worked around it the same way (task::spawn_sched instead of task::spawn). There was a lot of code involved and a lot of tasks running around, but my code at least didn't call sleep.\n\n(The code above was from some sample code of mine which used sleep in a rather unrealistic manner to keep the sample simple. My real code is where I saw this new task hang).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/6963068/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/6984560",
    "html_url": "https://github.com/rust-lang/rust/issues/2841#issuecomment-6984560",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2841",
    "id": 6984560,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5ODQ1NjA=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-07-14T16:52:01Z",
    "updated_at": "2012-07-14T16:52:01Z",
    "body": "Found another place where tasks launched with spawn just hang: the test_server_client unit test in https://github.com/jdm/rust-socket on \"Linux shell 3.2.0-24-generic #39-Ubuntu SMP Mon May 21 16:52:17 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux\". Worked around again with spawn_sched.\n\nNote that those unit tests did work on my Mac which is where I do 99% of my rust work.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/6984560/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7056383",
    "html_url": "https://github.com/rust-lang/rust/issues/2841#issuecomment-7056383",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2841",
    "id": 7056383,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTYzODM=",
    "user": {
      "login": "tedhorst",
      "id": 113629,
      "node_id": "MDQ6VXNlcjExMzYyOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/113629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tedhorst",
      "html_url": "https://github.com/tedhorst",
      "followers_url": "https://api.github.com/users/tedhorst/followers",
      "following_url": "https://api.github.com/users/tedhorst/following{/other_user}",
      "gists_url": "https://api.github.com/users/tedhorst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tedhorst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tedhorst/subscriptions",
      "organizations_url": "https://api.github.com/users/tedhorst/orgs",
      "repos_url": "https://api.github.com/users/tedhorst/repos",
      "events_url": "https://api.github.com/users/tedhorst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tedhorst/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-07-18T04:21:06Z",
    "updated_at": "2012-07-18T04:21:06Z",
    "body": "Adding task::yield to comm::peek fixes the original case.  I'm not sure about the select2 case.  See pull request #2947.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7056383/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7070975",
    "html_url": "https://github.com/rust-lang/rust/issues/2841#issuecomment-7070975",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2841",
    "id": 7070975,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzA5NzU=",
    "user": {
      "login": "tedhorst",
      "id": 113629,
      "node_id": "MDQ6VXNlcjExMzYyOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/113629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tedhorst",
      "html_url": "https://github.com/tedhorst",
      "followers_url": "https://api.github.com/users/tedhorst/followers",
      "following_url": "https://api.github.com/users/tedhorst/following{/other_user}",
      "gists_url": "https://api.github.com/users/tedhorst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tedhorst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tedhorst/subscriptions",
      "organizations_url": "https://api.github.com/users/tedhorst/orgs",
      "repos_url": "https://api.github.com/users/tedhorst/repos",
      "events_url": "https://api.github.com/users/tedhorst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tedhorst/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-07-18T14:46:48Z",
    "updated_at": "2012-07-18T14:46:48Z",
    "body": "The select2 case works for me.  As a side note, I think there should be library sleep function that calls task::yield.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7070975/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7076195",
    "html_url": "https://github.com/rust-lang/rust/issues/2841#issuecomment-7076195",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2841",
    "id": 7076195,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzYxOTU=",
    "user": {
      "login": "eholk",
      "id": 105766,
      "node_id": "MDQ6VXNlcjEwNTc2Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eholk",
      "html_url": "https://github.com/eholk",
      "followers_url": "https://api.github.com/users/eholk/followers",
      "following_url": "https://api.github.com/users/eholk/following{/other_user}",
      "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eholk/subscriptions",
      "organizations_url": "https://api.github.com/users/eholk/orgs",
      "repos_url": "https://api.github.com/users/eholk/repos",
      "events_url": "https://api.github.com/users/eholk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eholk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-07-18T17:42:18Z",
    "updated_at": "2012-07-18T17:42:18Z",
    "body": "Nice work, @tedhorst. We don't currently insert yield checks on loop backedges like we should (#524), which means to loop around sleep and peek never yields. Adding a call to `task::yield` in `comm::peek` seems like kind of a hack, but I think it's reasonable for now given that we don't do yield checks like we should.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7076195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7262578",
    "html_url": "https://github.com/rust-lang/rust/issues/2841#issuecomment-7262578",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2841",
    "id": 7262578,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNjI1Nzg=",
    "user": {
      "login": "eholk",
      "id": 105766,
      "node_id": "MDQ6VXNlcjEwNTc2Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eholk",
      "html_url": "https://github.com/eholk",
      "followers_url": "https://api.github.com/users/eholk/followers",
      "following_url": "https://api.github.com/users/eholk/following{/other_user}",
      "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eholk/subscriptions",
      "organizations_url": "https://api.github.com/users/eholk/orgs",
      "repos_url": "https://api.github.com/users/eholk/repos",
      "events_url": "https://api.github.com/users/eholk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eholk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-07-25T21:22:58Z",
    "updated_at": "2012-07-25T21:22:58Z",
    "body": "This was fixed by #2947.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7262578/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
