[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47415769",
    "html_url": "https://github.com/rust-lang/rust/issues/15231#issuecomment-47415769",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15231",
    "id": 47415769,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDE1NzY5",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T02:30:16Z",
    "updated_at": "2014-06-28T02:30:16Z",
    "body": "cc @alexcrichton \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47415769/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47415837",
    "html_url": "https://github.com/rust-lang/rust/issues/15231#issuecomment-47415837",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15231",
    "id": 47415837,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDE1ODM3",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T02:34:37Z",
    "updated_at": "2014-06-28T02:35:53Z",
    "body": "I have acquired a backtrace by attaching gdb to a running process rather than running the process from gdb to begin with (why this works I have no idea)\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 5832.0x1738]\n0x004ccc9c in stream::read_cb::h0aa53bd142f22e38jZf::v0.11.0.pre ()\n(gdb) backtrace\n#0  0x004ccc9c in stream::read_cb::h0aa53bd142f22e38jZf::v0.11.0.pre ()\n#1  0x004db9ac in uv_process_tcp_read_req (loop=0x8010c8, handle=0x80ae88, req=0x80aebc) at src/win/tcp.c:885\n#2  0x004d121e in uv_process_reqs (loop=0x8010c8) at src/win/req-inl.h:152\n#3  0x004d1b92 in uv_run (loop=0x8010c8, mode=UV_RUN_DEFAULT) at src/win/core.c:345\n#4  0x0047d6ca in uvio::UvEventLoop.EventLoop::run::h1d15421f9e024ae3r1a::v0.11.0.pre ()\n#5  0x00452765 in sched::Scheduler::run::ha79c3ff2c3f823d5SWa::v0.11.0.pre ()\n#6  0x00451a61 in sched::Scheduler::bootstrap::h85fe42e0b2715604gSa::v0.11.0.pre ()\n#7  0x004707a0 in SchedPool::new::closure.6620 ()\n#8  0x0047070b in thread::Thread$LT$$LP$$RP$$GT$::start_stack::closure.6611 ()\n#9  0x0059a4ff in thread::thread_start::h5ba3e4810fa11878Ead::v0.11.0.pre ()\n#10 0x74d5495d in KERNEL32!BaseThreadInitThunk () from C:\\WINDOWS\\SYSTEM32\\kernel32.dll\n#11 0x76fb98ee in ntdll!RtlInitializeExceptionChain () from C:\\WINDOWS\\SYSTEM32\\ntdll.dll\n#12 0x76fb98c4 in ntdll!RtlInitializeExceptionChain () from C:\\WINDOWS\\SYSTEM32\\ntdll.dll\n#13 0x00000000 in ?? ()\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47415837/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47418422",
    "html_url": "https://github.com/rust-lang/rust/issues/15231#issuecomment-47418422",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15231",
    "id": 47418422,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDE4NDIy",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T04:45:24Z",
    "updated_at": "2014-06-28T04:45:24Z",
    "body": "After debugging with visual studio I figured out the exact line causing the segfault. At https://github.com/rust-lang/rust/blob/master/src/librustuv/stream.rs#L253 it is `rcx.result = nread;`. `rcx` here is a null reference, which was transmuted from getting the data of the handle, which is apparently 0. I don't know what is setting it to 0 though.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47418422/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47418557",
    "html_url": "https://github.com/rust-lang/rust/issues/15231#issuecomment-47418557",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15231",
    "id": 47418557,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDE4NTU3",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T04:54:46Z",
    "updated_at": "2014-06-28T04:54:46Z",
    "body": "It appears even sending packets to the connection causes it to die. Has anyone even tested libgreen on Windows with TCP?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47418557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47420296",
    "html_url": "https://github.com/rust-lang/rust/issues/15231#issuecomment-47420296",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15231",
    "id": 47420296,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDIwMjk2",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T07:00:10Z",
    "updated_at": "2014-06-28T07:00:10Z",
    "body": "I have determined the cause of the bug to be a race condition. Specifically every time I open up a connection, `StreamWatcher::new()` is called 3 times and `StreamWater::read()` is called once. If the 3 new streams all occur before the read call, the `handle->data` pointer remains non-zero. If one of them occurs after the read call, then the `handle->data` pointer becomes zero, and the read callback segfaults. I have verified this through multiple runs and `uverrln!` statements everywhere.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47420296/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47420414",
    "html_url": "https://github.com/rust-lang/rust/issues/15231#issuecomment-47420414",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15231",
    "id": 47420414,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDIwNDE0",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T07:08:29Z",
    "updated_at": "2014-06-28T07:59:32Z",
    "body": "To further expand, `StreamWater::new()` is called when a TcpStream is created, and also everytime I clone the `TcpStream`. Since cloning a `TcpStream` is the only way to share it across tasks (it doesn't impl `Share`), I had to spawn two tasks, one to read and one to write. Because I spawned the reading one first it would start a read before I cloned the tcp for the writing task, and once I cloned it, the data pointer got reset so the data pointer the read callback received was null thereby causing the segfault.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47420414/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47435351",
    "html_url": "https://github.com/rust-lang/rust/issues/15231#issuecomment-47435351",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15231",
    "id": 47435351,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDM1MzUx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-28T18:50:26Z",
    "updated_at": "2014-06-28T18:50:26Z",
    "body": "> Has anyone even tested libgreen on Windows with TCP?\n\nYes, no commit gets pushed to master unless it passes all tests on windows, and that includes many networking tests.\n\nDo you have a small test case which reproduces this bug? It's likely that there's just some different callback-invoking behavior on windows than on unix that was accidentally not dealt with.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47435351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47442599",
    "html_url": "https://github.com/rust-lang/rust/issues/15231#issuecomment-47442599",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15231",
    "id": 47442599,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDQyNTk5",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-29T00:42:35Z",
    "updated_at": "2014-06-29T00:45:38Z",
    "body": "Here is a minimal code example: https://gist.github.com/retep998/224bfb130448e086df76\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47442599/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
