[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89509870",
    "html_url": "https://github.com/rust-lang/rust/issues/24036#issuecomment-89509870",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24036",
    "id": 89509870,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NTA5ODcw",
    "user": {
      "login": "ebfull",
      "id": 3794471,
      "node_id": "MDQ6VXNlcjM3OTQ0NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3794471?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ebfull",
      "html_url": "https://github.com/ebfull",
      "followers_url": "https://api.github.com/users/ebfull/followers",
      "following_url": "https://api.github.com/users/ebfull/following{/other_user}",
      "gists_url": "https://api.github.com/users/ebfull/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ebfull/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ebfull/subscriptions",
      "organizations_url": "https://api.github.com/users/ebfull/orgs",
      "repos_url": "https://api.github.com/users/ebfull/repos",
      "events_url": "https://api.github.com/users/ebfull/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ebfull/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-04T05:57:54Z",
    "updated_at": "2015-04-04T05:57:54Z",
    "body": "The error is a bit confusing if you're not familiar with closures. Check out the chapters on [Closures](http://doc.rust-lang.org/book/closures.html) and [Static and Dynamic Dispatch](http://doc.rust-lang.org/book/static-and-dynamic-dispatch.html) in the book to understand the semantics and performance tradeoffs.\n\nCurrently in Rust, no two closures, even if identical, have the same type. Closures are essentially anonymous structs (containing the environment they close over) expanded at compile time, and made to impl the Fn\\* family of traits.\n\nIn your code, producing a bare closure from a match arm that could produce other closures is not possible. You must use trait objects. The easiest approach would probably be to just box each closure, and coerce it into a trait object with a type annotation.\n\n``` rust\nuse std::env;\n\nfn main() {\n    let args: Vec<_> = env::args().collect();\n    let op: Box<Fn(i32) -> i32> = match &args[1][..] {\n        \"foo\" => Box::new(|c: i32| c + 1),\n        \"bar\" => Box::new(|c: i32| c + 1),\n        \"baz\" => Box::new(|c: i32| c - 1),\n        \"other\" => Box::new(|c: i32| c - 1),\n        _ => return,\n    };\n    println!(\"{:?}\", op(11));\n}\n```\n\nThere may be other ways to accomplish what you want. And if you aren't closing over your environment, just use function pointers.\n\n``` rust\nuse std::env;\n\nfn first_thing(c: i32) -> i32 {\n    c + 1\n}\n\nfn second_thing(c: i32) -> i32 {\n    c - 1\n}\n\nfn main() {\n    let args: Vec<_> = env::args().collect();\n    let op: fn(i32) -> i32 = match &args[1][..] {\n        \"foo\" => first_thing,\n        \"bar\" => first_thing,\n        \"baz\" => second_thing,\n        \"other\" => second_thing,\n        _ => return,\n    };\n    println!(\"{:?}\", op(11));\n}\n\n```\n\nOr if your situation ultimately allows for it, use generics in some way.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89509870/reactions",
      "total_count": 17,
      "+1": 9,
      "-1": 0,
      "laugh": 0,
      "hooray": 5,
      "confused": 0,
      "heart": 3,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89514967",
    "html_url": "https://github.com/rust-lang/rust/issues/24036#issuecomment-89514967",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24036",
    "id": 89514967,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NTE0OTY3",
    "user": {
      "login": "richo",
      "id": 476418,
      "node_id": "MDQ6VXNlcjQ3NjQxOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/476418?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/richo",
      "html_url": "https://github.com/richo",
      "followers_url": "https://api.github.com/users/richo/followers",
      "following_url": "https://api.github.com/users/richo/following{/other_user}",
      "gists_url": "https://api.github.com/users/richo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/richo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/richo/subscriptions",
      "organizations_url": "https://api.github.com/users/richo/orgs",
      "repos_url": "https://api.github.com/users/richo/repos",
      "events_url": "https://api.github.com/users/richo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/richo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-04T07:15:05Z",
    "updated_at": "2015-04-04T10:14:23Z",
    "body": "Sorry, I forgot to mention that this is a regression from about a week ago when https://github.com/richo/karma-rs/blob/master/src/main.rs#L49-L55 built\nOn Friday, April 3, 2015, ebfull notifications@github.com wrote:\n\n> The error is a bit confusing if you're not familiar with closures. Check\n> out the chapters on Closures http://doc.rust-lang.org/book/closures.html\n> and Static and Dynamic Dispatch\n> http://doc.rust-lang.org/book/static-and-dynamic-dispatch.html in the\n> book to understand the semantics and performance tradeoffs.\n> \n> Currently in Rust, no two closures, even if identical, have the same type.\n> Closures are essentially anonymous structs (containing the environment they\n> close over) expanded at compile time, and made to impl the Fn\\* family of\n> traits.\n> \n> In your code, producing a bare closure from a match arm that could produce\n> other closures is not possible. You must use trait objects. The easiest\n> approach would probably be to just box each closure, and coerce it into a\n> trait object with a type annotation.\n> \n> use std::env;\n> fn main() {\n>     let args: Vec<_> = env::args().collect();\n>     let op: Box<Fn(i32) -> i32> = match &args[1][..] {\n>         \"foo\" => Box::new(|c: i32| c + 1),\n>         \"bar\" => Box::new(|c: i32| c + 1),\n>         \"baz\" => Box::new(|c: i32| c - 1),\n>         \"other\" => Box::new(|c: i32| c - 1),\n>         _ => return,\n>     };\n>     println!(\"{:?}\", op(11));\n> }\n> \n> There may be other ways to accomplish what you want. And if you aren't\n> closing over your environment, just use function pointers.\n> \n> use std::env;\n> fn first_thing(c: i32) -> i32 {\n>     c + 1\n> }\n> fn second_thing(c: i32) -> i32 {\n>     c - 1\n> }\n> fn main() {\n>     let args: Vec<_> = env::args().collect();\n>     let op: fn(i32) -> i32 = match &args[1][..] {\n>         \"foo\" => first_thing,\n>         \"bar\" => first_thing,\n>         \"baz\" => second_thing,\n>         \"other\" => second_thing,\n>         _ => return,\n>     };\n>     println!(\"{:?}\", op(11));\n> }\n> \n> Or if your situation ultimately allows for it, use generics in some way.\n> \n> \u2014\n> Reply to this email directly or view it on GitHub\n> https://github.com/rust-lang/rust/issues/24036#issuecomment-89509870.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89514967/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89608543",
    "html_url": "https://github.com/rust-lang/rust/issues/24036#issuecomment-89608543",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24036",
    "id": 89608543,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NjA4NTQz",
    "user": {
      "login": "ebfull",
      "id": 3794471,
      "node_id": "MDQ6VXNlcjM3OTQ0NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3794471?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ebfull",
      "html_url": "https://github.com/ebfull",
      "followers_url": "https://api.github.com/users/ebfull/followers",
      "following_url": "https://api.github.com/users/ebfull/following{/other_user}",
      "gists_url": "https://api.github.com/users/ebfull/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ebfull/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ebfull/subscriptions",
      "organizations_url": "https://api.github.com/users/ebfull/orgs",
      "repos_url": "https://api.github.com/users/ebfull/repos",
      "events_url": "https://api.github.com/users/ebfull/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ebfull/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-04T16:17:28Z",
    "updated_at": "2015-04-04T16:17:28Z",
    "body": "Closures in rust used to be \"boxed\" so they acted similar to my first example solution.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89608543/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89642002",
    "html_url": "https://github.com/rust-lang/rust/issues/24036#issuecomment-89642002",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24036",
    "id": 89642002,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NjQyMDAy",
    "user": {
      "login": "richo",
      "id": 476418,
      "node_id": "MDQ6VXNlcjQ3NjQxOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/476418?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/richo",
      "html_url": "https://github.com/richo",
      "followers_url": "https://api.github.com/users/richo/followers",
      "following_url": "https://api.github.com/users/richo/following{/other_user}",
      "gists_url": "https://api.github.com/users/richo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/richo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/richo/subscriptions",
      "organizations_url": "https://api.github.com/users/richo/orgs",
      "repos_url": "https://api.github.com/users/richo/repos",
      "events_url": "https://api.github.com/users/richo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/richo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-04T19:08:43Z",
    "updated_at": "2015-04-04T19:08:43Z",
    "body": "Great fix, and thanks for the explaination!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89642002/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/92144498",
    "html_url": "https://github.com/rust-lang/rust/issues/24036#issuecomment-92144498",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24036",
    "id": 92144498,
    "node_id": "MDEyOklzc3VlQ29tbWVudDkyMTQ0NDk4",
    "user": {
      "login": "ebfull",
      "id": 3794471,
      "node_id": "MDQ6VXNlcjM3OTQ0NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3794471?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ebfull",
      "html_url": "https://github.com/ebfull",
      "followers_url": "https://api.github.com/users/ebfull/followers",
      "following_url": "https://api.github.com/users/ebfull/following{/other_user}",
      "gists_url": "https://api.github.com/users/ebfull/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ebfull/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ebfull/subscriptions",
      "organizations_url": "https://api.github.com/users/ebfull/orgs",
      "repos_url": "https://api.github.com/users/ebfull/repos",
      "events_url": "https://api.github.com/users/ebfull/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ebfull/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-12T22:21:51Z",
    "updated_at": "2015-04-12T22:21:51Z",
    "body": "If you're satisfied the issue can be closed now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/92144498/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/92145682",
    "html_url": "https://github.com/rust-lang/rust/issues/24036#issuecomment-92145682",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24036",
    "id": 92145682,
    "node_id": "MDEyOklzc3VlQ29tbWVudDkyMTQ1Njgy",
    "user": {
      "login": "richo",
      "id": 476418,
      "node_id": "MDQ6VXNlcjQ3NjQxOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/476418?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/richo",
      "html_url": "https://github.com/richo",
      "followers_url": "https://api.github.com/users/richo/followers",
      "following_url": "https://api.github.com/users/richo/following{/other_user}",
      "gists_url": "https://api.github.com/users/richo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/richo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/richo/subscriptions",
      "organizations_url": "https://api.github.com/users/richo/orgs",
      "repos_url": "https://api.github.com/users/richo/repos",
      "events_url": "https://api.github.com/users/richo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/richo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-12T22:42:41Z",
    "updated_at": "2015-04-12T22:42:41Z",
    "body": "Thanks!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/92145682/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
