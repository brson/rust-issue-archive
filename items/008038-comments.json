[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21539313",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21539313",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21539313,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNTM5MzEz",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-25T08:16:10Z",
    "updated_at": "2013-07-25T08:16:10Z",
    "body": "Because deriving(Hash) won't be deriving ... a hash function. It'll be deriving a way-to-iterate-over-your-fields to feed to the hash function. The hash function is in a central location and very carefully chosen.\n\nThat said, we could probably rename it _somehow_. A lot of the ugliness in the way hash is implemented had to do with missing features in default methods and inheritence, which I think all work now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21539313/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21547542",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21547542",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21547542,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNTQ3NTQy",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-25T11:20:48Z",
    "updated_at": "2013-07-25T11:20:48Z",
    "body": "As an aside, I still think `IterBytes` and `Encodable` are the same thing.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21547542/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21556888",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21556888",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21556888,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNTU2ODg4",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-25T14:19:52Z",
    "updated_at": "2013-07-25T14:19:52Z",
    "body": "They're certainly related. Not sure if identical? I guess encoding is supposed to hit all the \"meaningful\" bytes and skip the \"meaningless\" ones. Maybe we could build a default method on the encode trait that funnels all the other encoding methods (including a prefix byte for each tycon) into a byte stream? Essentially a \"default encoder\" that delegates to an inner function with a byte slice?\n\nOr, I guess, hash could provide that encoder itself. But I bet it's useful elsewhere.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21556888/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21569381",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21569381",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21569381,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNTY5Mzgx",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-25T17:12:40Z",
    "updated_at": "2013-07-25T17:12:40Z",
    "body": "To put it another way, it seems like iterbytes could be trivially implemented in terms of encodable, but encodable provides higher-level information. The only reason I see to separate them is that perhaps there are bits of data that one wants to encode but which do not affect the value when used as a hash; but I think this is subtle and a bit error-prone. I would personally be inclined to separate out the \"hash key\" value from the rest, in such cases. Also, this last bit presumes that IterBytes is only used for hashing, which is currently true afaik, but not obvious from its name. I guess I personally would rather just have one way of serializing types into bytes (the Encodable trait) and then use that for multiple purposes than to have many distinct serialization traits.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21569381/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21570180",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21570180",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21570180,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNTcwMTgw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-25T17:25:36Z",
    "updated_at": "2013-07-25T17:26:40Z",
    "body": "By implementing `IterBytes`, you currently give up the ability to supply a custom `Hash` implementation. I don't think we have the machinery to implement a default method _for types implementing a trait_ at the moment. It might make sense to move it into the `hash` module and change the naming to reflect it being the standard way of making a type hashable.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21570180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21570778",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21570778",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21570778,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNTcwNzc4",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-25T17:34:25Z",
    "updated_at": "2013-07-25T17:34:25Z",
    "body": "@nikomatsakis: It shouldn't be that hard to reimplement the `IterBytes` trait in terms of `Encodable`. I can think of one big issue with it though. `Encodable` doesn't guarantee the output is ordered in any fashion. It would make sense for `HashMap` to implement `Encodable`, but it probably wouldn't make sense to support generating a hash for that structure because `Encodable doesn't guarantee order in the output.\n\nHowever, it would be nice for us to add a raw binary `Encoder`/`Decoder`. This would be handy for libraries like `extra::flatpipes` that can guarantee we are encoding/decoding the type so we don't need a binary format that tags each piece of data for type checking deserialization, like ebml.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21570778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21577057",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21577057",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21577057,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNTc3MDU3",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-25T19:06:13Z",
    "updated_at": "2013-07-25T19:06:13Z",
    "body": "@erickt I'm not sure what you mean by \"doesn't guarantee ordering\"? In my head, at least, most of the methods are in fact ordered (i.e., a tuple must try to encode each of its elements in order, a struct each of its fields, etc), but I guess the higher-order methods for emitting a map might not be. I was envisioning creating a \"HashEncoder\" that just hashed data in response to calls to the encoder methods. Still, now that we have deriving modes, it doesn't hurt to have them be separate interfaces, and I can imagine it might allow for looser or more efficient encoding around maps and other data structures that are not obviously ordered. I cared about this more when there was no deriving for iterbytes.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21577057/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21595582",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21595582",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21595582,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNTk1NTgy",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-26T01:06:00Z",
    "updated_at": "2013-07-26T01:06:00Z",
    "body": "@nikomatsakis: Yeah, I'm talking about the higher ordered methods for emitting a map. For example:\n\n```\nlet a = HashMap::new();\na.insert(1, 2);\na.insert(3, 4);\nlet a_bytes = io::with_bytes_writer(|wr| a.encode(&BytesEncoder::new(&wr)));\n\nlet b = HashMap::new();\nb.insert(3, 4);\nb.insert(1, 2);\nlet b_bytes = io::with_bytes_writer(|wr| b.encode(&BytesEncoder::new(&wr)));\n```\n\nThat hypothetical `BytesEncoder` won't necessarily guarantee that the keys are outputted in the same order, so while `a` equals `b`, `a_bytes` may or may not equal `b_bytes`.\n\nIf we wanted to prevent someone from using a `HashMap` as a key, we add a simple `Hashable` trait:\n\n```\ntrait Hashable {\n    fn hash(&self) -> uint;\n}\n```\n\nWe could then either use `#[deriving(Hashable)]` that depends on an implementation of `Encodable`, or we could start using default methods to do the same thing. Assuming this would actually work, we could mash together `Hashable` and `Encodable` into one `HashableEncodable` trait with a default method like this:\n\n```\ntrait HashableEncodable: Hashable + Encodable {\n    fn hash(&self) -> uint {\n         let hash_encoder = HashEncoder::new();\n         self.encode(&hash_encoder);\n         hash_encoder.hash\n    }\n}\n```\n\nThen to use it, we just write:\n\n```\n#[deriving(Encodable)]\nstruct Foo { ... }\n\nimpl HashableEncodable for Foo {}\n```\n\nThis would save us from having to write another deriving syntax extension. `HashableEncodable` is pretty ugly though, so I'm a little torn.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21595582/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21597785",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21597785",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21597785,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNTk3Nzg1",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-26T02:19:19Z",
    "updated_at": "2013-07-26T02:19:19Z",
    "body": "(fwiw, writing new `deriving`s is fairly easy.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21597785/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21631374",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21631374",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21631374,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNjMxMzc0",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-26T16:20:36Z",
    "updated_at": "2013-07-26T16:20:36Z",
    "body": "@huonw: It's true, but I worry that `deriving` is a crutch. Writing a new `deriving` extension isn't that hard, but it is a royal pain to do the snapshot dance if the underlying trait changes.  I hope that someday we'll figure out some mechanism to lift `deriving` out of the compiler and into a library.  I expect that would remove the need to do the snapshot dance, and it'd be much easier for third parties to add their own implementations.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21631374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21657756",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-21657756",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 21657756,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxNjU3NzU2",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-27T02:21:33Z",
    "updated_at": "2013-07-27T02:21:33Z",
    "body": "They're normal syntax extensions, so https://github.com/mozilla/rust/issues/1762 should cover that (if/when that happens).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21657756/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/31663208",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-31663208",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 31663208,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjYzMjA4",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-06T16:40:59Z",
    "updated_at": "2014-01-06T16:40:59Z",
    "body": "This is pretty messy. Should be fixed.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/31663208/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33045872",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-33045872",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 33045872,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMDQ1ODcy",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-22T17:27:19Z",
    "updated_at": "2014-01-22T17:27:19Z",
    "body": "I started playing around with a fix for this last night. Since we only seem to use `IterBytes` with `Hash`, it makes sense to me to try to merge the two constructs. I came up with two approaches. The first is a bit heavyweight. It entails moving `serialize.rs` into `libstd` and creating:\n\n```\nstruct HashEncoder<S> { state: S }\n\nimpl<S: Streaming> Encoder for HashEncoder<S> { ... }\n\ntrait HashEncodable<S: Streaming>: Encodable<HashEncoder<S>> { }\n\npub fn sip_hash<T: HashEncodable<hash::SipState>>(v: &T) -> u64 {\n    let mut encoder = HashEncoder::new(hash::SipState::new(0, 0));\n    v.encode(&mut encoder);\n    encoder.state.result_u64()\n}\n```\n\nAll hashable traits need to implement `HashEncodable` in order to be hashed. This allows `HashMap` to be encodable but not hashable. @cmr mentioned in IRC that he was not convinced that `serialize.rs` should live in `libstd`.\n\nThe other approach I had was to have a much lighter weight `StreamingHash` trait as in:\n\n```\npub trait StreamingHash<S> {\n    fn hash_stream(&self, state: &mut S);\n}\n\nimpl<S: Streaming> StreamingHash<S> for u8 {\n    fn hash_stream(&self, state: &mut S) {\n        state.input([*self])\n    }\n}\n\npub fn sip_hash<T: StreamingHash<hash::SipState>>(v: &T) -> u64 {\n    let mut state = hash::SipState::new(0, 0);\n    v.hash_stream(&mut state);\n    state.result_u64()\n}\n```\n\nThis is a much smaller change, but we do end up duplicating a lot of work that `serialize.rs` does for us.\n\nHere is a prototype implementation of both [schemes](https://gist.github.com/erickt/8562021). Performance is identical for an optimized build. For non-optimized, `HashEncodable` is a little slower than `IterBytes`, which is a little slower than `StreamingHash`.\n\nI expect that this approach would also allow us to fix both #9075 and #5195.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33045872/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33125395",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-33125395",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 33125395,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMTI1Mzk1",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-23T13:57:40Z",
    "updated_at": "2014-01-23T13:57:40Z",
    "body": "The `StreamingHash` approach certainly seems lighter weight, and I think (on first thought) it would be more appropriate for #5195 (since the general Encodable instance won't try to handle things like the random order of hashmap elements, etc).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33125395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33298139",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-33298139",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 33298139,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjk4MTM5",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-25T19:49:25Z",
    "updated_at": "2014-01-25T19:49:25Z",
    "body": "@huonw: I got an updated version of my `hash.rs` replacement [here](https://gist.github.com/erickt/8622289). It uses the same trick `Encodable` uses to break up the `impl<T: IterBytes> Hash for T { ... }` constraint by instead constraining the `Hasher` trait on the concrete type:\n\n```\npub trait Hasher {\n    fn result_u64(&mut self) -> u64;\n}\n\npub trait StreamHasher: Hasher {\n    fn input(&mut self, bytes: &[u8]);\n}\n\npub trait Hashable<H: Hasher> {\n    fn hash2(&self, h: &mut H);\n}\n\nimpl<H: StreamHasher> Hashable<H> for i8 { ... }\n```\n\nI'm going to start working on a PR to switch over to this approach.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33298139/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33339381",
    "html_url": "https://github.com/rust-lang/rust/issues/8038#issuecomment-33339381",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8038",
    "id": 33339381,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMzM5Mzgx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-01-27T03:00:19Z",
    "updated_at": "2014-01-27T03:01:45Z",
    "body": "@erickt  `i16` etc. are also `FixedHashable`, right? So it would be good to be able to have `Hashable<H> for u8` etc, because this may make a super-fast hashtable; however, I'm not sure of a good way to handle this.\n\n(Also, [some of your casts](https://gist.github.com/erickt/8622289#file-hash-rs-L167) seem to have suffered from copy-paste. (That looks macro-able, fwiw).)\n\nAlsoalso, @pcwalton was saying that the IterBytes closures only get inlined very rarely, but this scheme has static dispatch and so could feasibly be (much) faster. :)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33339381/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
