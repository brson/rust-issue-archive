[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71702906",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-71702906",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 71702906,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzAyOTA2",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-27T18:42:22Z",
    "updated_at": "2015-01-27T18:42:22Z",
    "body": "I'm confused as to what this is about. isn't https://github.com/rust-lang/rust/issues/18469 the tracking issue?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71702906/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71725755",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-71725755",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 71725755,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzI1NzU1",
    "user": {
      "login": "nrc",
      "id": 762626,
      "node_id": "MDQ6VXNlcjc2MjYyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nrc",
      "html_url": "https://github.com/nrc",
      "followers_url": "https://api.github.com/users/nrc/followers",
      "following_url": "https://api.github.com/users/nrc/following{/other_user}",
      "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
      "organizations_url": "https://api.github.com/users/nrc/orgs",
      "repos_url": "https://api.github.com/users/nrc/repos",
      "events_url": "https://api.github.com/users/nrc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nrc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-27T20:54:17Z",
    "updated_at": "2015-01-27T20:54:17Z",
    "body": "Yes, this is a specific part of 18469. Seems useful to have it by itself since it stands alone (goes for the other issues too).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71725755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/272583628",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-272583628",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 272583628,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjU4MzYyOA==",
    "user": {
      "login": "eternaleye",
      "id": 99404,
      "node_id": "MDQ6VXNlcjk5NDA0",
      "avatar_url": "https://avatars.githubusercontent.com/u/99404?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eternaleye",
      "html_url": "https://github.com/eternaleye",
      "followers_url": "https://api.github.com/users/eternaleye/followers",
      "following_url": "https://api.github.com/users/eternaleye/following{/other_user}",
      "gists_url": "https://api.github.com/users/eternaleye/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eternaleye/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eternaleye/subscriptions",
      "organizations_url": "https://api.github.com/users/eternaleye/orgs",
      "repos_url": "https://api.github.com/users/eternaleye/repos",
      "events_url": "https://api.github.com/users/eternaleye/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eternaleye/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-01-14T00:25:33Z",
    "updated_at": "2017-01-14T00:25:33Z",
    "body": "Is there anything that could be done to push this towards stabilization? I have some APIs in mind that would benefit significantly from the ability to bound on the `Unsize` trait.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/272583628/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277742155",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-277742155",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 277742155,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3Nzc0MjE1NQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-06T16:53:31Z",
    "updated_at": "2017-02-06T16:53:31Z",
    "body": "I was idly wondering about this the other date with a type such as:\r\n\r\n```rust\r\nstruct Foo {\r\n    flag: bool,\r\n    data: str,\r\n}\r\n```\r\n\r\nToday there's not a *huge* amount of support for that but I noticed one oddity. So in theory the only way to instantiate such a type is to start with a concrete type, right? Let's say:\r\n\r\n```rust\r\nstruct FooConcrete {\r\n    flag: bool,\r\n    data: [u8; 10],\r\n}\r\n```\r\n\r\nI would personally expect, then that if we had a function like:\r\n\r\n```rust\r\nfn foo(drop_me: Box<Foo>) {\r\n    drop(drop_me);\r\n}\r\n```\r\n\r\nThat function would simultaneously run the destructor for the underlying type and also free the memory. Currently, however, it only frees the memory and doesn't actually run any destructor. More interestingly this namely to me at least means that the `Box<Foo>` type needs *two* pieces of external data, both a vtable for the destructor but also a `usize` for the length of the dynamically sized data.\r\n\r\nI'm not sure if this is just an unsupported use case perhaps? Or maybe support for this is planned elsewhere? Or maybe this isn't part of this issue at all?\r\n\r\nIn any case just wanted to bring it up!",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277742155/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277747701",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-277747701",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 277747701,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3Nzc0NzcwMQ==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-06T17:12:05Z",
    "updated_at": "2017-02-06T20:54:01Z",
    "body": "What do you mean by the destructor not being called? I am quite sure it is:\r\n\r\n```Rust\r\nuse std::mem;\r\n\r\nstruct Foo {\r\n    flag: bool,\r\n    data: str,\r\n}\r\n\r\nstruct FooConcrete {\r\n    flag: bool,\r\n    data: [u8; 10],\r\n}\r\n\r\nimpl Drop for Foo {\r\n    fn drop(&mut self) {\r\n        println!(\"splat! {:?} {}\", self.flag, &self.data)\r\n    }\r\n}\r\n\r\n\r\nfn main() {\r\n    let _foo: Box<Foo> = unsafe { mem::transmute(\r\n        (Box::new(FooConcrete {\r\n            flag: false,\r\n            data: [0; 10]\r\n        }), 10)\r\n    )};\r\n}\r\n```\r\n\r\n## EDIT:\r\n\r\nCode above is buggy, better version:\r\n\r\n```Rust\r\nuse std::mem;\r\n\r\n#[repr(C)]\r\nstruct Foo {\r\n    flag: bool,\r\n    data: str,\r\n}\r\n\r\n#[repr(C)]\r\nstruct FooConcrete {\r\n    flag: bool,\r\n    data: [u8; 10],\r\n}\r\n\r\nimpl Drop for Foo {\r\n    fn drop(&mut self) {\r\n        println!(\"splat! {:?} {}\", self.flag, &self.data)\r\n    }\r\n}\r\n\r\n\r\nfn main() {\r\n    let _foo: Box<Foo> = unsafe { mem::transmute(\r\n        (Box::new(FooConcrete {\r\n            flag: false,\r\n            data: [0; 10]\r\n        }), 10usize)\r\n    )};\r\n}\r\n```\r\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277747701/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277754146",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-277754146",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 277754146,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3Nzc1NDE0Ng==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-06T17:34:21Z",
    "updated_at": "2017-02-06T17:34:21Z",
    "body": "Oh I mean when you implement the destructor for `FooConcrete` instead of `Foo`, that one isn't run. (your example gives a segfault locally for me as well...)\r\n\r\nI'm specifically thinking of something like this:\r\n\r\n```rust\r\npub struct Foo {\r\n    flag: bool,\r\n    data: str,\r\n}\r\n\r\n#[no_mangle]\r\npub extern fn drop(_b: Box<Foo>) {\r\n}\r\n```\r\n\r\nwhere the IR is:\r\n\r\n```ll\r\n; ModuleID = 'foo.cgu-0.rs'\r\nsource_filename = \"foo.cgu-0.rs\"\r\ntarget datalayout = \"e-m:e-i64:64-f80:128-n8:16:32:64-S128\"\r\ntarget triple = \"x86_64-unknown-linux-gnu\"\r\n\r\n%Foo = type { i8, i8 }\r\n%\"unwind::libunwind::_Unwind_Exception\" = type { i64, void (i32, %\"unwind::libunwind::_Unwind_Exception\"*)*, [6 x i64] }\r\n%\"unwind::libunwind::_Unwind_Context\" = type {}\r\n\r\n; Function Attrs: nounwind uwtable\r\ndefine void @drop(%Foo* noalias nonnull, i64) unnamed_addr #0 personality i32 (i32, i32, i64, %\"unwind::libunwind::_Unwind_Exception\"*, %\"unwind::libunwind::_Unwind_Context\"*)* @rust_eh\r\n_personality {\r\nentry-block:\r\n  %2 = add i64 %1, 1\r\n  %3 = icmp eq i64 %2, 0\r\n  br i1 %3, label %_ZN4drop17hc3530aa457fb35acE.exit, label %cond.i\r\n\r\ncond.i:                                           ; preds = %entry-block\r\n  %4 = getelementptr inbounds %Foo, %Foo* %0, i64 0, i32 0\r\n  tail call void @__rust_deallocate(i8* %4, i64 %2, i64 1) #1\r\n  br label %_ZN4drop17hc3530aa457fb35acE.exit\r\n\r\n_ZN4drop17hc3530aa457fb35acE.exit:                ; preds = %entry-block, %cond.i\r\n  ret void\r\n}\r\n\r\n; Function Attrs: nounwind\r\ndeclare void @__rust_deallocate(i8*, i64, i64) unnamed_addr #1\r\n\r\n; Function Attrs: nounwind\r\ndeclare i32 @rust_eh_personality(i32, i32, i64, %\"unwind::libunwind::_Unwind_Exception\"*, %\"unwind::libunwind::_Unwind_Context\"*) unnamed_addr #1\r\n\r\n```\r\n\r\nNotably there's some concrete type behind `Box<Foo>`, so presumably some dynamic call to a destructor needs to be made, but in this case it isn't :(",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277754146/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277761924",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-277761924",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 277761924,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3Nzc2MTkyNA==",
    "user": {
      "login": "Stebalien",
      "id": 310393,
      "node_id": "MDQ6VXNlcjMxMDM5Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/310393?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Stebalien",
      "html_url": "https://github.com/Stebalien",
      "followers_url": "https://api.github.com/users/Stebalien/followers",
      "following_url": "https://api.github.com/users/Stebalien/following{/other_user}",
      "gists_url": "https://api.github.com/users/Stebalien/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Stebalien/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Stebalien/subscriptions",
      "organizations_url": "https://api.github.com/users/Stebalien/orgs",
      "repos_url": "https://api.github.com/users/Stebalien/repos",
      "events_url": "https://api.github.com/users/Stebalien/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Stebalien/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-06T18:01:38Z",
    "updated_at": "2017-02-06T18:01:38Z",
    "body": "@alexcrichton transmuting `Box::new((..., 10usize))` instead of `Box::new((..., 10))` fixes the segfault (bug?).\r\n\r\nBack on topic, `Foo` isn't a trait so I don't see why `Box<Foo>` should have a vtable; `Box<Foo>` is a concrete type (just an unsized one). After transmuting, `Box<Foo>` should (and does) forget it ever was a `Box<FooConcrete>`.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277761924/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277777897",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-277777897",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 277777897,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3Nzc3Nzg5Nw==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-06T18:59:01Z",
    "updated_at": "2017-02-06T18:59:01Z",
    "body": "@Stebalien ah yes that does indeed fix it! \r\n\r\nFor me at least I'd expect `Box<Foo>` here to still run the destructor of the underlying type. It's not a trait object, yeah, but it's still erasing the underlying type. Otherwise this'd end up leaking resources, and would practically not be too useful I'd imagine?\r\n\r\n(that being said I'm still not sure of the practicality of the `Foo` type anyway)",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277777897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277802109",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-277802109",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 277802109,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzgwMjEwOQ==",
    "user": {
      "login": "Stebalien",
      "id": 310393,
      "node_id": "MDQ6VXNlcjMxMDM5Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/310393?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Stebalien",
      "html_url": "https://github.com/Stebalien",
      "followers_url": "https://api.github.com/users/Stebalien/followers",
      "following_url": "https://api.github.com/users/Stebalien/following{/other_user}",
      "gists_url": "https://api.github.com/users/Stebalien/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Stebalien/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Stebalien/subscriptions",
      "organizations_url": "https://api.github.com/users/Stebalien/orgs",
      "repos_url": "https://api.github.com/users/Stebalien/repos",
      "events_url": "https://api.github.com/users/Stebalien/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Stebalien/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-06T20:23:41Z",
    "updated_at": "2017-02-06T20:26:52Z",
    "body": "> For me at least I'd expect Box<Foo> here to still run the destructor of the underlying type. It's not a trait object, yeah, but it's still erasing the underlying type. Otherwise this'd end up leaking resources, and would practically not be too useful I'd imagine?\r\n\r\nWhy? They're totally unrelated types; `FooConcrete` isn't an underlying type, it's a *different* type. As a matter of fact, as-is, the code above is UB: rust could decide to lay out `FooConcrete` as `([u8; 10], bool)` instead of `(bool, [u8; 10])`. Only `Foo` is guaranteed to have the `data` field come last (because DSTs must always come last).\r\n\r\nIMO, the correct correct way to do this would be to allow `box Foo { flag: true, data: *\"my string\" }`, but, for now, I don't see any way to safely construct a `Foo` (without invoking UB).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277802109/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277806192",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-277806192",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 277806192,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzgwNjE5Mg==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-06T20:39:44Z",
    "updated_at": "2017-02-06T20:39:44Z",
    "body": "I mean... I'm stating my opinion. Today the destructor isn't run. I'm trying to clarify if it *should* be run. I believe it should be run. If we don't run the destructor then to me this isn't a very useful feature in practice because that just means resources are leaked which tends to want to be avoided.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277806192/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277809480",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-277809480",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 277809480,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzgwOTQ4MA==",
    "user": {
      "login": "Stebalien",
      "id": 310393,
      "node_id": "MDQ6VXNlcjMxMDM5Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/310393?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Stebalien",
      "html_url": "https://github.com/Stebalien",
      "followers_url": "https://api.github.com/users/Stebalien/followers",
      "following_url": "https://api.github.com/users/Stebalien/following{/other_user}",
      "gists_url": "https://api.github.com/users/Stebalien/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Stebalien/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Stebalien/subscriptions",
      "organizations_url": "https://api.github.com/users/Stebalien/orgs",
      "repos_url": "https://api.github.com/users/Stebalien/repos",
      "events_url": "https://api.github.com/users/Stebalien/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Stebalien/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-06T20:52:14Z",
    "updated_at": "2017-02-06T20:52:57Z",
    "body": "I just don't understand why it should be run. Would you expect the following to print \"dropping bar\" (it currently prints \"dropping baz\")?:\r\n\r\n```rust\r\nuse std::mem;\r\n\r\nstruct Bar;\r\nstruct Baz;\r\n\r\nimpl Drop for Bar {\r\n    fn drop(&mut self) {\r\n        println!(\"dropping bar\");\r\n    }\r\n}\r\n\r\nimpl Drop for Baz {\r\n    fn drop(&mut self) {\r\n        println!(\"dropping baz\");\r\n    }\r\n}\r\n\r\nfn main() {\r\n    unsafe {\r\n        let bar: Box<Bar> = Box::new(Bar);\r\n        let _baz: Box<Baz> = mem::transmute(bar);\r\n    }\r\n}\r\n```\r\n\r\nThe only difference is that `Baz` is sized.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277809480/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277809595",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-277809595",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 277809595,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzgwOTU5NQ==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-06T20:52:36Z",
    "updated_at": "2017-02-06T20:52:36Z",
    "body": "@alexcrichton \r\n\r\nOf course, I should make sure to be portable to 64-bit architectures and add `#[repr(C)]` everywhere to make it valid :-).\r\n\r\nI think the semantics of destructors are quite clear by this point. I have seen the pattern `struct\u00a0Foo([u8]);` used as a newtype several times (because there is no header field, you can create it by directly transmuting a `[u8]`).\r\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277809595/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277817438",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-277817438",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 277817438,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzgxNzQzOA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-06T21:21:58Z",
    "updated_at": "2017-02-06T21:21:58Z",
    "body": "Ok well if the answer here is \"no\" then it's no. \r\n\r\nMy intuition follows from that we always run the destructor of the type behind a trait object. I don't see how that's different here. There's an unsized type that represents some dynamic selection of a particular type at runtime. That unsized type, when dropped, is then responsible for cleaning up the runtime type.\r\n\r\n@Stebalien I think your example is missing the point, of course that destructor does not run. For this example:\r\n\r\n```rust\r\nstruct Foo {\r\n    a: bool,\r\n    b: str,\r\n}\r\n\r\nstruct FooConcrete {\r\n    a: bool,\r\n    b: [u8; 10],\r\n}\r\n\r\nimpl Drop for FooConcrete {\r\n    fn drop(&mut self) {\r\n        println!(\"drop\");\r\n    }\r\n}\r\n\r\nfn coerce(a: Box<FooConcrete>) -> Box<Foo> {\r\n    // ..\r\n}\r\n\r\nfn main() {\r\n    let a = Box::new(FooConcrete {\r\n        a: false,\r\n        b: *b\"helloworld\",\r\n    });\r\n    let b = coerce(a);\r\n    drop(b);\r\n}\r\n```\r\n\r\nI would expect that example to print `drop`, but it does not today and fundamentally seems to not have support for doing so.\r\n\r\nAgain I'm talking about my own personal intuition for where I thought we were taking dynamically sized types. If this is not the direction that we're going in then it just means `Box<Foo>` in this example isn't a very useful type and should be avoided.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/277817438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/278091710",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-278091710",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 278091710,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3ODA5MTcxMA==",
    "user": {
      "login": "eternaleye",
      "id": 99404,
      "node_id": "MDQ6VXNlcjk5NDA0",
      "avatar_url": "https://avatars.githubusercontent.com/u/99404?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eternaleye",
      "html_url": "https://github.com/eternaleye",
      "followers_url": "https://api.github.com/users/eternaleye/followers",
      "following_url": "https://api.github.com/users/eternaleye/following{/other_user}",
      "gists_url": "https://api.github.com/users/eternaleye/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eternaleye/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eternaleye/subscriptions",
      "organizations_url": "https://api.github.com/users/eternaleye/orgs",
      "repos_url": "https://api.github.com/users/eternaleye/repos",
      "events_url": "https://api.github.com/users/eternaleye/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eternaleye/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-07T18:18:17Z",
    "updated_at": "2017-02-07T18:29:36Z",
    "body": "@alexcrichton: My opinion is that there's confusion here around what \"the type behind a trait object\" means. Personally, I've seen two approaches taken:\r\n\r\n1. `Foo<Concrete> -> Foo<Dst>` - before your question, this was the only one I'd seen\r\n2. `FooConcrete -> FooDst`\r\n\r\nThe former seems to me like it has a clear relation via the `Unsize<Dst>` trait impl of its _parameter_.\r\n\r\nThe latter seems like it needs an `impl Unsize<FooDst> for FooConcrete`, which isn't a thing AFAIK.\r\n\r\nEDIT: In addition, I'm used to DSTification being done with `as`, not `transmute`. Since `transmute` is a _reinterpretation_, nothing more, I am wholly unsurprised by the behavior you observed. You reinterpreted a `FooConcrete` as a `FooDst`, and `FooDst` has no destructor. The type system lost that `FooConcrete` was involved at `transmute` - it is _not_ \"behind\" `FooDst`, as that's what `Unsize` is for..",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/278091710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/278170732",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-278170732",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 278170732,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3ODE3MDczMg==",
    "user": {
      "login": "Stebalien",
      "id": 310393,
      "node_id": "MDQ6VXNlcjMxMDM5Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/310393?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Stebalien",
      "html_url": "https://github.com/Stebalien",
      "followers_url": "https://api.github.com/users/Stebalien/followers",
      "following_url": "https://api.github.com/users/Stebalien/following{/other_user}",
      "gists_url": "https://api.github.com/users/Stebalien/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Stebalien/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Stebalien/subscriptions",
      "organizations_url": "https://api.github.com/users/Stebalien/orgs",
      "repos_url": "https://api.github.com/users/Stebalien/repos",
      "events_url": "https://api.github.com/users/Stebalien/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Stebalien/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-07T22:53:25Z",
    "updated_at": "2017-02-07T22:53:25Z",
    "body": "Thanks @eternaleye; now I see where you're coming from @alexcrichton. FYI, here's the relevant part of the RFC:\r\n\r\n> There is an `Unsize` trait and lang item. This trait signals that a type can be converted using the compiler's coercion machinery from a sized to an unsized type. All implementations of this trait are **implicit and compiler generated**. It is an error to implement this trait.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/278170732/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/396060571",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-396060571",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 396060571,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjA2MDU3MQ==",
    "user": {
      "login": "carado",
      "id": 407034,
      "node_id": "MDQ6VXNlcjQwNzAzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/407034?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carado",
      "html_url": "https://github.com/carado",
      "followers_url": "https://api.github.com/users/carado/followers",
      "following_url": "https://api.github.com/users/carado/following{/other_user}",
      "gists_url": "https://api.github.com/users/carado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carado/subscriptions",
      "organizations_url": "https://api.github.com/users/carado/orgs",
      "repos_url": "https://api.github.com/users/carado/repos",
      "events_url": "https://api.github.com/users/carado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carado/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-06-10T16:05:11Z",
    "updated_at": "2018-06-10T16:05:11Z",
    "body": "Hello ! I have noticed a weird lack of symmetry is the types for which `Unsize` is implemented. It seems to be reflexive for traits but not for slices; see:\r\n```rust\r\n#![feature(unsize)]\r\n\r\ntrait Trait {}\r\nstruct A; impl Trait for A {}\r\n\r\nfn f<T: ?Sized, U: ?Sized>() where T: std::marker::Unsize<U> {}\r\n\r\nfn main() {\r\n    // for traits:\r\n    f::<A, Trait>(); // works normally\r\n    f::<Trait, Trait>(); // works; Unsize is reflexive\r\n    \r\n    // for slices:\r\n    f::<[usize; 4], [usize]>(); // works normally\r\n    f::<[usize], [usize]>(); // error; Unsize isn't reflexive ?\r\n}\r\n```\r\nI was told that this could be an omission in design. Is that the case ?\r\nThank you for your time and great language.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/396060571/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/417938613",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-417938613",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 417938613,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzkzODYxMw==",
    "user": {
      "login": "alexreg",
      "id": 67036,
      "node_id": "MDQ6VXNlcjY3MDM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/67036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexreg",
      "html_url": "https://github.com/alexreg",
      "followers_url": "https://api.github.com/users/alexreg/followers",
      "following_url": "https://api.github.com/users/alexreg/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexreg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexreg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexreg/subscriptions",
      "organizations_url": "https://api.github.com/users/alexreg/orgs",
      "repos_url": "https://api.github.com/users/alexreg/repos",
      "events_url": "https://api.github.com/users/alexreg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexreg/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-09-02T15:27:34Z",
    "updated_at": "2018-09-02T15:27:34Z",
    "body": "@carado Looks like a fair point. Maybe open a new issue about it?",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/417938613/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/949482033",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-949482033",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 949482033,
    "node_id": "IC_kwDOAAsO6M44l_Ix",
    "user": {
      "login": "svenknobloch",
      "id": 15171965,
      "node_id": "MDQ6VXNlcjE1MTcxOTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/15171965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/svenknobloch",
      "html_url": "https://github.com/svenknobloch",
      "followers_url": "https://api.github.com/users/svenknobloch/followers",
      "following_url": "https://api.github.com/users/svenknobloch/following{/other_user}",
      "gists_url": "https://api.github.com/users/svenknobloch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/svenknobloch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/svenknobloch/subscriptions",
      "organizations_url": "https://api.github.com/users/svenknobloch/orgs",
      "repos_url": "https://api.github.com/users/svenknobloch/repos",
      "events_url": "https://api.github.com/users/svenknobloch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/svenknobloch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-10-22T10:10:54Z",
    "updated_at": "2021-10-22T10:10:54Z",
    "body": "Currently `CoerceUnsized` is only implementable for structs that have exactly **one** field being coerced.\r\nI would like to implement it for a type that that has **zero** coercible fields (i.e. only `PhantomData` fields).\r\n\r\nIs there any reason why type coercion couldn't work for a struct with only `PhantomData` fields?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/949482033/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1493251241",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1493251241",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1493251241,
    "node_id": "IC_kwDOAAsO6M5ZATSp",
    "user": {
      "login": "andrewgazelka",
      "id": 7644264,
      "node_id": "MDQ6VXNlcjc2NDQyNjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7644264?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewgazelka",
      "html_url": "https://github.com/andrewgazelka",
      "followers_url": "https://api.github.com/users/andrewgazelka/followers",
      "following_url": "https://api.github.com/users/andrewgazelka/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewgazelka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewgazelka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewgazelka/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewgazelka/orgs",
      "repos_url": "https://api.github.com/users/andrewgazelka/repos",
      "events_url": "https://api.github.com/users/andrewgazelka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewgazelka/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-04-02T07:11:33Z",
    "updated_at": "2023-04-02T09:02:40Z",
    "body": "Perhaps I do not understand correctly, but isn't nothing preventing `unsize` from being stabilized? ",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1493251241/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1493269904",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1493269904",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1493269904,
    "node_id": "IC_kwDOAAsO6M5ZAX2Q",
    "user": {
      "login": "bjorn3",
      "id": 17426603,
      "node_id": "MDQ6VXNlcjE3NDI2NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bjorn3",
      "html_url": "https://github.com/bjorn3",
      "followers_url": "https://api.github.com/users/bjorn3/followers",
      "following_url": "https://api.github.com/users/bjorn3/following{/other_user}",
      "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions",
      "organizations_url": "https://api.github.com/users/bjorn3/orgs",
      "repos_url": "https://api.github.com/users/bjorn3/repos",
      "events_url": "https://api.github.com/users/bjorn3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bjorn3/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-04-02T08:54:06Z",
    "updated_at": "2023-04-02T08:54:06Z",
    "body": "Stabilizing the current `CoerceUnsized` trait will prevent us from ever adding custom DST's that don't built on top of slices and trait objects. For example `CStr` except that the length is calculated when required rather than stored in the pointer metadata. Or `CppObject` where you call into C++ to get the size of the value behind a reference.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1493269904/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1493272003",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1493272003",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1493272003,
    "node_id": "IC_kwDOAAsO6M5ZAYXD",
    "user": {
      "login": "andrewgazelka",
      "id": 7644264,
      "node_id": "MDQ6VXNlcjc2NDQyNjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7644264?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewgazelka",
      "html_url": "https://github.com/andrewgazelka",
      "followers_url": "https://api.github.com/users/andrewgazelka/followers",
      "following_url": "https://api.github.com/users/andrewgazelka/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewgazelka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewgazelka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewgazelka/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewgazelka/orgs",
      "repos_url": "https://api.github.com/users/andrewgazelka/repos",
      "events_url": "https://api.github.com/users/andrewgazelka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewgazelka/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-04-02T09:02:31Z",
    "updated_at": "2023-04-02T09:02:43Z",
    "body": "> Stabilizing the current `CoerceUnsized` trait will prevent us from ever adding custom DST's that don't built on top of slices and trait objects. For example `CStr` except that the length is calculated when required rather than stored in the pointer metadata. Or `CppObject` where you call into C++ to get the size of the value behind a reference.\r\n\r\nFrom what I understand though, \r\n\r\n`#![feature(unsize)]` does not require `#![feature(coerce_unsized)]`?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1493272003/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1493278304",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1493278304",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1493278304,
    "node_id": "IC_kwDOAAsO6M5ZAZ5g",
    "user": {
      "login": "bjorn3",
      "id": 17426603,
      "node_id": "MDQ6VXNlcjE3NDI2NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bjorn3",
      "html_url": "https://github.com/bjorn3",
      "followers_url": "https://api.github.com/users/bjorn3/followers",
      "following_url": "https://api.github.com/users/bjorn3/following{/other_user}",
      "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions",
      "organizations_url": "https://api.github.com/users/bjorn3/orgs",
      "repos_url": "https://api.github.com/users/bjorn3/repos",
      "events_url": "https://api.github.com/users/bjorn3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bjorn3/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-04-02T09:29:33Z",
    "updated_at": "2023-04-02T09:29:33Z",
    "body": "I don't think `Unsize` is useful without `CoerceUnsized`. `Unsize` is used for implementing `CoerceUnsized`, but the actual unsizing operation uses `CoerceUnsized`. I also expect manually implementing `Unsize` to either be forbidden or be able to cause compiler crashes or unsoundness.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1493278304/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1493407953",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1493407953",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1493407953,
    "node_id": "IC_kwDOAAsO6M5ZA5jR",
    "user": {
      "login": "andrewgazelka",
      "id": 7644264,
      "node_id": "MDQ6VXNlcjc2NDQyNjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7644264?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewgazelka",
      "html_url": "https://github.com/andrewgazelka",
      "followers_url": "https://api.github.com/users/andrewgazelka/followers",
      "following_url": "https://api.github.com/users/andrewgazelka/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewgazelka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewgazelka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewgazelka/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewgazelka/orgs",
      "repos_url": "https://api.github.com/users/andrewgazelka/repos",
      "events_url": "https://api.github.com/users/andrewgazelka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewgazelka/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-04-02T18:21:07Z",
    "updated_at": "2023-04-02T18:30:08Z",
    "body": "> I don't think `Unsize` is useful without `CoerceUnsized`. `Unsize` is used for implementing `CoerceUnsized`, but the actual unsizing operation uses `CoerceUnsized`. I also expect manually implementing `Unsize` to either be forbidden or be able to cause compiler crashes or unsoundness.\r\n\r\nThis is a use case where `Unsize` is useful @bjorn3 \r\n\r\nhttps://github.com/getcollective-ai/collective/blob/d69c7c1549b6efde48529cd21bd5159e6a48160c/code/executor/src/command.rs#L35-L38\r\n\r\nUseful snippets:\r\n\r\n```rust\r\n/// The command we are executing\r\n#[derive(Discriminant)]\r\nenum Cmd {\r\n    /// a zsh script to execute\r\n    Zsh,\r\n    Bash,\r\n}\r\n\r\n#[async_trait]\r\ntrait Command {\r\n    async fn execute(&self, exec: Ctx, input: &str) -> anyhow::Result<String>;\r\n}\r\n\r\n#[async_trait]\r\nimpl Command for Zsh {\r\n    async fn execute(&self, exec: Ctx, input: &str) -> anyhow::Result<String> {\r\n        // ...\r\n    }\r\n}\r\n\r\n#[async_trait]\r\nimpl Command for Bash {\r\n    async fn execute(&self, exec: Ctx, input: &str) -> anyhow::Result<String> {\r\n        // ...\r\n    }\r\n}\r\n\r\nfn this_requires_unsize() {\r\n    let cmd1: Box<dyn Command> = Cmd::Zsh.cast();\r\n    let cmd2: Box<dyn Command> = Cmd::Bash.cast();\r\n}\r\n```\r\n\r\nwhere `Discriminant` generates\r\n\r\n```rust\r\nimpl From<Zsh> for Cmd {\r\n    fn from(value: Zsh) -> Self { Self::Zsh }\r\n}\r\nimpl std::convert::TryFrom<Cmd> for Zsh {\r\n    type Error = Cmd;\r\n    fn try_from(value: Cmd) -> Result<Self, Self::Error> { if let Cmd::Zsh = value { Ok(Zsh) } else { Err(value) } }\r\n}\r\n#[doc = \" a zsh script to execute\"]\r\nstruct Zsh;\r\nimpl From<Bash> for Cmd {\r\n    fn from(value: Bash) -> Self { Self::Bash }\r\n}\r\nimpl std::convert::TryFrom<Cmd> for Bash {\r\n    type Error = Cmd;\r\n    fn try_from(value: Cmd) -> Result<Self, Self::Error> { if let Cmd::Bash = value { Ok(Bash) } else { Err(value) } }\r\n}\r\nstruct Bash;\r\nimpl Cmd {\r\n    fn cast<U: ?Sized>(self) -> Box<U> where Zsh: ::core::marker::Unsize<U>, Bash: ::core::marker::Unsize<U> {\r\n        let value = self;\r\n        let value = match Zsh::try_from(value) {\r\n            Ok(v) => {\r\n                let x = Box::new(v);\r\n                return x;\r\n            }\r\n            Err(v) => v,\r\n        };\r\n        let value = match Bash::try_from(value) {\r\n            Ok(v) => {\r\n                let x = Box::new(v);\r\n                return x;\r\n            }\r\n            Err(v) => v,\r\n        };\r\n        unreachable!();\r\n    }\r\n}\r\n```",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1493407953/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1509909981",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1509909981",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1509909981,
    "node_id": "IC_kwDOAAsO6M5Z_2Xd",
    "user": {
      "login": "ahicks92",
      "id": 6968705,
      "node_id": "MDQ6VXNlcjY5Njg3MDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6968705?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahicks92",
      "html_url": "https://github.com/ahicks92",
      "followers_url": "https://api.github.com/users/ahicks92/followers",
      "following_url": "https://api.github.com/users/ahicks92/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahicks92/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahicks92/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahicks92/subscriptions",
      "organizations_url": "https://api.github.com/users/ahicks92/orgs",
      "repos_url": "https://api.github.com/users/ahicks92/repos",
      "events_url": "https://api.github.com/users/ahicks92/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahicks92/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-04-15T17:47:14Z",
    "updated_at": "2023-04-15T17:47:14Z",
    "body": "I'm curious why CoerceUnsized would prevent changing how dsts work.  It's a trait with no methods.  Could it be limited to derive, that is make it impossible for anyone to write a manual impl, and then the behavior could be changed later?  That is to say that while the restriction today would be struct of one field etc. because no one can manually implement it, the restriction could be lifted later once the behavior is more defined and/or someone decides what to do about the dst general case.\r\n\r\nMy use case not that long ago is that I'm writing audio code which needs to never deallocate on the audio thread, and I wanted to have custom smart pointers which would defer deallocation to another thread in the background.  They were also going to allocate objects from pools for cache friendliness.  This can't be built on top of `Arc` and `Weak` without stabilizing custom allocators (and maybe not even then?) but this would have neatly solved the problem as far as I can tell.  Instead, I dropped trying for it in favor of stdlib `Arc` and have moved to an architecture with custom 64-bit ids to do cross-thread addressing, wherein the user-side pieces are going to literally basically be `Arc<u64>`.  Perhaps I will go back to it eventually, only with very specific unsizing ops of my own to dedicated traits.\r\n\r\nIs anyone actively working on custom dsts?  I keep seeing people saying it's important but the only use case I think I've seen is async traits.  I don't find the \"get size from C++ to put thing on the stack\" use case that interesting because C++ itself doesn't really allow for that in the first place.  As far as I know no popular language is talking about trying to e.g. put virtual classes on the stack.  You can do it in C with alloca or gcc extensions but those just cause more problems than they're worth in my experience: suddenly you're open to stack overflows because of a math bug or whatever.  And a similar thing with `CStr` that doesn't store length: now you've got possibly-implicit strlen all over.\r\n\r\nI'm not saying \"O dsts are useless\" just that I see people talking about them as useful but never really having examples, and in \r\nthis case we have a general concrete usefulness for `CoerceUnsized` and it's easy to understand what that is.\r\n\r\nAlso, I see a soundness hole in many of the examples of custom dsts that get brought up from time to time in any case.  They can make Rust unsound: if someone figures out how to get a value into the program they can read any pointer relative to the stack, at least for most schemes which would involve bumping sp or similar (and presumably anything more complex would have enough overhead that you'd go to the system allocator).  It seems to me that custom dsts are years away but `CoerceUnsized` could probably be done in the very near future.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1509909981/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1509928023",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1509928023",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1509928023,
    "node_id": "IC_kwDOAAsO6M5Z_6xX",
    "user": {
      "login": "bjorn3",
      "id": 17426603,
      "node_id": "MDQ6VXNlcjE3NDI2NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bjorn3",
      "html_url": "https://github.com/bjorn3",
      "followers_url": "https://api.github.com/users/bjorn3/followers",
      "following_url": "https://api.github.com/users/bjorn3/following{/other_user}",
      "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions",
      "organizations_url": "https://api.github.com/users/bjorn3/orgs",
      "repos_url": "https://api.github.com/users/bjorn3/repos",
      "events_url": "https://api.github.com/users/bjorn3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bjorn3/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-04-15T19:00:35Z",
    "updated_at": "2023-04-15T19:00:35Z",
    "body": ">  I don't find the \"get size from C++ to put thing on the stack\" use case that interesting because C++ itself doesn't really allow for that in the first place. As far as I know no popular language is talking about trying to e.g. put virtual classes on the stack.\r\n\r\nHaving `Box<MyDst>` also requires the length to be known at runtime as it is passed to the deallocation function.\r\n\r\nFor your use case can you have a type that is equivalent to `Arc<[T]>` rather than `Arc<U>`? That is specializing it to only work with slices rather than any (dynamically sized) type? In that case I don't think you need `CoerceUnsized`.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1509928023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1509942326",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1509942326",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1509942326,
    "node_id": "IC_kwDOAAsO6M5Z_-Q2",
    "user": {
      "login": "ahicks92",
      "id": 6968705,
      "node_id": "MDQ6VXNlcjY5Njg3MDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6968705?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahicks92",
      "html_url": "https://github.com/ahicks92",
      "followers_url": "https://api.github.com/users/ahicks92/followers",
      "following_url": "https://api.github.com/users/ahicks92/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahicks92/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahicks92/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahicks92/subscriptions",
      "organizations_url": "https://api.github.com/users/ahicks92/orgs",
      "repos_url": "https://api.github.com/users/ahicks92/repos",
      "events_url": "https://api.github.com/users/ahicks92/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahicks92/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-04-15T19:44:43Z",
    "updated_at": "2023-04-15T19:44:43Z",
    "body": "My use case wouldn't have been a slice, it would have been `Arc<SineGenerator>` to `Arc<dyn Node>` on top of my own non-std smart pointers, where the actual raw stored pointer pointed into a slab.  It's been a bit since I tried to do it, but as I recall I gave up on a general solution because writing helpers to do the downcasting was getting gnarly.  I'll revisit more specific solutions eventually but only after benchmarks etc; I thought I could produce a generally useful library which could be published to crates.io but it turned out I couldn't because I was running into combinations of unergonomic APIs and type constraints.  It's a shame I didn't think to come here around the time I was doing it, if I had I'd have been able to articulate this better.\r\n\r\nEssentially, I wanted to do:\r\n\r\n```\r\nstruct SmartPointer<T> {\r\n    page: *mut SlabPage,\r\n    data: *const T,\r\n}\r\n```\r\n\r\nIt would have had to be:\r\n\r\n```\r\nstruct SmartPointer<T> {\r\n    data: *const T,\r\n}\r\n\r\n#[repr(C)]\r\nstruct SlabItem<T> {\r\n    header: *mut SlabPage,\r\n    data: T,\r\n}\r\n```\r\n\r\nWhich is a bit less ideal (the backpointers get in the way of a fully contiguous array) but workable with what we have here.  It would of course be possible to go further and do pointer arithmetic and always align slab pages to OS pages, but that's kinda beside the point.  these would have had Drop impls that pushed to a background thread if the slab page needed to go away, but that's also beside the point (tldr: you can write realtime-safe audio code if you assume reasonable limits for everything and glitch if someone makes the library have to allocate more on the audio thread).\r\n\r\nAlso I was conflating dsts on the stack with dsts in general which I realized a few minutes ago.  I'm still not sure I see any particular benefit to extending the model or any reason why `CoerceUnsized` is incompatible with a more advanced model.\r\n\r\nWhat is a realistic case wherein I'd be dealing with something that isn't effectively `(length, dst)`?  If the length has to be passed to the deallocator, then it needs to always be known somehow or other.  If the object came from C, then presumably it needs to be deallocated by C since Rust requires sizes and it's not guaranteed that Rust is using malloc.\r\n\r\nIs the issue that we would want to coerce from `struct MySizedType` to `dst MyUnsizedType` where the compiler doesn't understand the coercion as it does slices/trait objects?  E.g. the C trick of a header in the first field.  I could sort of see that being a problem but it seems like a derive-only restriction for now lets it be extended later.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1509942326/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1509943125",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1509943125",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1509943125,
    "node_id": "IC_kwDOAAsO6M5Z_-dV",
    "user": {
      "login": "Veykril",
      "id": 3757771,
      "node_id": "MDQ6VXNlcjM3NTc3NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Veykril",
      "html_url": "https://github.com/Veykril",
      "followers_url": "https://api.github.com/users/Veykril/followers",
      "following_url": "https://api.github.com/users/Veykril/following{/other_user}",
      "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions",
      "organizations_url": "https://api.github.com/users/Veykril/orgs",
      "repos_url": "https://api.github.com/users/Veykril/repos",
      "events_url": "https://api.github.com/users/Veykril/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Veykril/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-04-15T19:47:31Z",
    "updated_at": "2023-04-15T19:47:31Z",
    "body": "Fwiw, I've been experimenting with Unsize and CoerceUnsized recently, see https://github.com/ferrous-systems/unsize-experiments. I was planning on trying to write down my findings there as a pre-RFC next week.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1509943125/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1550921580",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1550921580",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1550921580,
    "node_id": "IC_kwDOAAsO6M5ccS9s",
    "user": {
      "login": "Veykril",
      "id": 3757771,
      "node_id": "MDQ6VXNlcjM3NTc3NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Veykril",
      "html_url": "https://github.com/Veykril",
      "followers_url": "https://api.github.com/users/Veykril/followers",
      "following_url": "https://api.github.com/users/Veykril/following{/other_user}",
      "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions",
      "organizations_url": "https://api.github.com/users/Veykril/orgs",
      "repos_url": "https://api.github.com/users/Veykril/repos",
      "events_url": "https://api.github.com/users/Veykril/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Veykril/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-05-17T07:50:08Z",
    "updated_at": "2023-05-17T07:50:08Z",
    "body": "Fwiw, I posted a pre-RFC on irlo: https://internals.rust-lang.org/t/pre-rfc-flexible-unsize-and-coerceunsize-traits/18789",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1550921580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1928326037",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1928326037",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1928326037,
    "node_id": "IC_kwDOAAsO6M5y7-uV",
    "user": {
      "login": "Zenithsiz",
      "id": 34359769,
      "node_id": "MDQ6VXNlcjM0MzU5NzY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/34359769?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Zenithsiz",
      "html_url": "https://github.com/Zenithsiz",
      "followers_url": "https://api.github.com/users/Zenithsiz/followers",
      "following_url": "https://api.github.com/users/Zenithsiz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Zenithsiz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Zenithsiz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Zenithsiz/subscriptions",
      "organizations_url": "https://api.github.com/users/Zenithsiz/orgs",
      "repos_url": "https://api.github.com/users/Zenithsiz/repos",
      "events_url": "https://api.github.com/users/Zenithsiz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Zenithsiz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-02-05T22:32:22Z",
    "updated_at": "2024-02-05T22:32:22Z",
    "body": "The [commit that implemented `CoerceUnsized` for `{Cell, RefCell, UnsafeCell}`](https://github.com/rust-lang/rust/commit/1fd791ad62a4bb901be465997d9efbf4090819f0) seems to not specify `?Sized` on the type parameters.\r\n\r\nIs this intentional? The documentation for `CoerceUnsized` just says:\r\n> For wrapper types that directly embed `T` like `Cell<T>` and `RefCell<T>`, you can directly implement `CoerceUnsized<Wrap<U>> for Wrap<T> where T: CoerceUnsized<U>`.\r\n\r\nFrom which I assume should allow `T: ?Sized` and `U: ?Sized`.\r\n\r\nThis prevents me from writing the following:\r\n```rust\r\nstruct Inner<T: ?Sized> {\r\n    meta: u32,\r\n    value: RefCell<T>,\r\n}\r\n\r\n// This errors because `RefCell<T>` only allows `T: Sized, U: Sized`.\r\nimpl<T: ?Sized, U: ?Sized> CoerceUnsized<Inner<U>> for Inner<T> where T: Unsize<U> {}\r\n\r\nlet rc: Rc<Inner<i32>> = /* ... */;\r\nlet rc = rc as Rc<Inner<dyn Any>>;\r\nlet rc = Rc::downcast::<Inner<i32>>(rc).expect(\"Unable to cast\");\r\n```\r\n\r\nWhich I think should be fine.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1928326037/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1930666614",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-1930666614",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 1930666614,
    "node_id": "IC_kwDOAAsO6M5zE6J2",
    "user": {
      "login": "fogti",
      "id": 1618343,
      "node_id": "MDQ6VXNlcjE2MTgzNDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1618343?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fogti",
      "html_url": "https://github.com/fogti",
      "followers_url": "https://api.github.com/users/fogti/followers",
      "following_url": "https://api.github.com/users/fogti/following{/other_user}",
      "gists_url": "https://api.github.com/users/fogti/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fogti/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fogti/subscriptions",
      "organizations_url": "https://api.github.com/users/fogti/orgs",
      "repos_url": "https://api.github.com/users/fogti/repos",
      "events_url": "https://api.github.com/users/fogti/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fogti/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-02-06T20:05:05Z",
    "updated_at": "2024-02-06T20:05:05Z",
    "body": "I think `U` should at least be `?Sized` (but I'm not sure if it makes sense for `T` to be `?Sized`, given the lack of \"super-fat\" pointers currently (wider than 2 `usize`s))",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1930666614/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2143408664",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-2143408664",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 2143408664,
    "node_id": "IC_kwDOAAsO6M5_wdIY",
    "user": {
      "login": "pczarn",
      "id": 3356767,
      "node_id": "MDQ6VXNlcjMzNTY3Njc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3356767?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pczarn",
      "html_url": "https://github.com/pczarn",
      "followers_url": "https://api.github.com/users/pczarn/followers",
      "following_url": "https://api.github.com/users/pczarn/following{/other_user}",
      "gists_url": "https://api.github.com/users/pczarn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pczarn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pczarn/subscriptions",
      "organizations_url": "https://api.github.com/users/pczarn/orgs",
      "repos_url": "https://api.github.com/users/pczarn/repos",
      "events_url": "https://api.github.com/users/pczarn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pczarn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-06-01T11:08:59Z",
    "updated_at": "2024-06-01T11:08:59Z",
    "body": "I'd love to see this stabilized so that we may comfortably use DSTs in the `bit-vec` crate, in particular for this feature: https://github.com/contain-rs/bit-vec/issues/46",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2143408664/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2901696012",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-2901696012",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 2901696012,
    "node_id": "IC_kwDOAAsO6M6s9F4M",
    "user": {
      "login": "yaksher",
      "id": 5308181,
      "node_id": "MDQ6VXNlcjUzMDgxODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5308181?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yaksher",
      "html_url": "https://github.com/yaksher",
      "followers_url": "https://api.github.com/users/yaksher/followers",
      "following_url": "https://api.github.com/users/yaksher/following{/other_user}",
      "gists_url": "https://api.github.com/users/yaksher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yaksher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yaksher/subscriptions",
      "organizations_url": "https://api.github.com/users/yaksher/orgs",
      "repos_url": "https://api.github.com/users/yaksher/repos",
      "events_url": "https://api.github.com/users/yaksher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yaksher/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-05-22T15:37:39Z",
    "updated_at": "2025-05-25T19:02:01Z",
    "body": "My understanding is that for any given pair `U` and `T` with `U: Unsize<T>` and any value `x` of type `U` if we do `ptr::metadata(&x as &T as *const T)`, this will yield the same value regardless of the choice of `x`. E.g., if `U = [X; N]` and `T = [X]` then the metadata is `N` regardless of the specific array of that length we choose. Similarly, if `U` is a concrete type implementing a trait and `T` is `dyn Trait` then the metadata is just a pointer to that trait's vtable, independent of the specific value `x`.\n\nI.e., the metadata associated with `&U as &T` depends _only_ on the types `U` and `T` and not on any runtime information, and so should probably be available somehow from just `U, T where U: Unsize<T>`. The simplest thing which comes to mind is to have `Unsize<T>` have an associated constant `const METADATA: <T as Pointee>::Metadata`. The other reasonable option is to do like for `Sized` and `size_of` where there's just a function in `std::mem` or `std::ptr` to fetch this metadata.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2901696012/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3014450094",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-3014450094",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 3014450094,
    "node_id": "IC_kwDOAAsO6M6zrNuu",
    "user": {
      "login": "samcowger",
      "id": 22037928,
      "node_id": "MDQ6VXNlcjIyMDM3OTI4",
      "avatar_url": "https://avatars.githubusercontent.com/u/22037928?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/samcowger",
      "html_url": "https://github.com/samcowger",
      "followers_url": "https://api.github.com/users/samcowger/followers",
      "following_url": "https://api.github.com/users/samcowger/following{/other_user}",
      "gists_url": "https://api.github.com/users/samcowger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/samcowger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/samcowger/subscriptions",
      "organizations_url": "https://api.github.com/users/samcowger/orgs",
      "repos_url": "https://api.github.com/users/samcowger/repos",
      "events_url": "https://api.github.com/users/samcowger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/samcowger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-06-27T22:10:40Z",
    "updated_at": "2025-06-27T22:10:40Z",
    "body": "Hello! I'm hoping this is an appropriate venue for this question; let me know if it isn't. I've noticed that [`E0375`](https://doc.rust-lang.org/stable/error_codes/E0375.html), the error code for attempting to implement `CoerceUnsized` with multiple unsized fields, does not mention `rustc`'s specific allowance of extra (\"unsized\") `PhantomData` fields, as described in https://github.com/rust-lang/rfcs/pull/1234 and implemented in https://github.com/rust-lang/rust/pull/28381.\n\nShould that detail be included in that error code's description, and if so, should it be included before or after stabilization of `CoerceUnsized`?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3014450094/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3483750502",
    "html_url": "https://github.com/rust-lang/rust/issues/18598#issuecomment-3483750502",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18598",
    "id": 3483750502,
    "node_id": "IC_kwDOAAsO6M7PpdBm",
    "user": {
      "login": "phisn",
      "id": 31885661,
      "node_id": "MDQ6VXNlcjMxODg1NjYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/31885661?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/phisn",
      "html_url": "https://github.com/phisn",
      "followers_url": "https://api.github.com/users/phisn/followers",
      "following_url": "https://api.github.com/users/phisn/following{/other_user}",
      "gists_url": "https://api.github.com/users/phisn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/phisn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/phisn/subscriptions",
      "organizations_url": "https://api.github.com/users/phisn/orgs",
      "repos_url": "https://api.github.com/users/phisn/repos",
      "events_url": "https://api.github.com/users/phisn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/phisn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-11-04T04:39:08Z",
    "updated_at": "2025-11-04T04:39:08Z",
    "body": "Since `CoerceUnsized` does not indicate which type it coerces to, it seems not possible to implement methods like `as_coerced` for `Option` or `Result`. I generally find it difficult to find a fitting `CoerceUnsized` that allows `as_coerced` since we are missing higher order types.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3483750502/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
