[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47275425",
    "html_url": "https://github.com/rust-lang/rust/issues/15203#issuecomment-47275425",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15203",
    "id": 47275425,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3Mjc1NDI1",
    "user": {
      "login": "Blei",
      "id": 52674,
      "node_id": "MDQ6VXNlcjUyNjc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/52674?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Blei",
      "html_url": "https://github.com/Blei",
      "followers_url": "https://api.github.com/users/Blei/followers",
      "following_url": "https://api.github.com/users/Blei/following{/other_user}",
      "gists_url": "https://api.github.com/users/Blei/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Blei/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Blei/subscriptions",
      "organizations_url": "https://api.github.com/users/Blei/orgs",
      "repos_url": "https://api.github.com/users/Blei/repos",
      "events_url": "https://api.github.com/users/Blei/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Blei/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-26T20:25:59Z",
    "updated_at": "2014-06-26T20:25:59Z",
    "body": "cc @dotdash, there's a suspicion that it's caused by the bool -> i1 conversion.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47275425/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47276055",
    "html_url": "https://github.com/rust-lang/rust/issues/15203#issuecomment-47276055",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15203",
    "id": 47276055,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3Mjc2MDU1",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-26T20:31:11Z",
    "updated_at": "2014-06-26T20:31:11Z",
    "body": "Okay, I have narrowed it down specifically to `let mut sieve = Vec::from_elem(size, true);` For some reason, that bit of code is responsible for almost all the time taken by that function. The old version simply ran memset across the Vec, while the new version is iterating over the entire Vec storing 1 in each element manually.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47276055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47279471",
    "html_url": "https://github.com/rust-lang/rust/issues/15203#issuecomment-47279471",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15203",
    "id": 47279471,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3Mjc5NDcx",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-26T21:00:45Z",
    "updated_at": "2014-06-26T21:00:45Z",
    "body": "``` rust\n    let mut sieve = Vec::with_capacity(size);\n    unsafe {\n        let p = sieve.as_mut_ptr();\n        std::ptr::set_memory(p, 1, size);\n        sieve.set_len(size);\n    }\n```\n\nThis generates code with memset. And it is much, much slower than the code that stores the 1s by hand. Lots of pagefaults too.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47279471/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47282366",
    "html_url": "https://github.com/rust-lang/rust/issues/15203#issuecomment-47282366",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15203",
    "id": 47282366,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MjgyMzY2",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-26T21:26:59Z",
    "updated_at": "2014-06-26T21:26:59Z",
    "body": "@mahkoh that code is almost three times faster that storing the ones for me.\n\nOriginal:\n\n```\nrunning 1 test\ntest bench_p3 ... bench:    315992 ns/iter (+/- 1850)\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 1 measured\n```\n\nWith your \"hack\":\n\n```\nrunning 1 test\ntest bench_p3 ... bench:    138248 ns/iter (+/- 304)\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 1 measured\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47282366/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47282815",
    "html_url": "https://github.com/rust-lang/rust/issues/15203#issuecomment-47282815",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15203",
    "id": 47282815,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MjgyODE1",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-26T21:31:33Z",
    "updated_at": "2014-06-26T21:31:33Z",
    "body": "Ha, you're right. It's the same here. I didn't realize that rust would change the benchmark depending on the results. I was looking at the output of perf only.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47282815/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47287279",
    "html_url": "https://github.com/rust-lang/rust/issues/15203#issuecomment-47287279",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15203",
    "id": 47287279,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3Mjg3Mjc5",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-26T22:16:08Z",
    "updated_at": "2014-06-26T22:16:36Z",
    "body": "LLVM's LoopIdionRecognize pass currently only considers integers that are byte width multiples, i.e. i8, i16 and so on, when looking for opportunities to replace stores by a memset. I've modified the relevant places to also accept values with a bitwidth < 8. With that, at least `opt` generates memset calls again, but it's just a hack so far and still crashes in the LLVM test suite. Also, we'll have to see what upstream thinks of this. I'll try to refine the patch this weekend and submit it to upstream then.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47287279/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47287984",
    "html_url": "https://github.com/rust-lang/rust/issues/15203#issuecomment-47287984",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15203",
    "id": 47287984,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3Mjg3OTg0",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-26T22:23:36Z",
    "updated_at": "2014-06-26T22:23:36Z",
    "body": "Actually, the test suite crash was just my fragile \"debugging\" code. Removing that made it pass the test suite. So I'll test the new patched LLVM version with rustc tomorrow and submit the patch upstream if it works as expected.\n\n@retep998 Thanks for spotting this!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47287984/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47470905",
    "html_url": "https://github.com/rust-lang/rust/issues/15203#issuecomment-47470905",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15203",
    "id": 47470905,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDcwOTA1",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-29T19:43:20Z",
    "updated_at": "2014-06-29T19:43:20Z",
    "body": "Just a small update since this takes longer than expected / \"announced\" ;-)\n\nLooking through LLVM's code I noticed a few more optz that won't trigger with `i1` used for the in-memory representation of boolean value. Extendind all those places to handle `i1` isn't trivial and IMHO not worth the trouble. \n\nAlso, I realized that I actually misread the comment in the clang sources that made me use `i1` for the memory representation of boolean value, instead of just for the SSA values. The latter is what clang does and means that the value is truncated on loads and zero-extended on stores.\n\nThe difference from what rust used to do, is that it happens on `load` and `store` instead of e.g. `br`. IOW it depends on where the value lives, not on its current usage. I'm now working on a patch to replicate clang's behaviour in rustc.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47470905/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
