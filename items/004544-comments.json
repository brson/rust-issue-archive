[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12460843",
    "html_url": "https://github.com/rust-lang/rust/issues/4544#issuecomment-12460843",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4544",
    "id": 12460843,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNDYwODQz",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-19T20:45:39Z",
    "updated_at": "2013-01-19T20:45:39Z",
    "body": "This is bugging me too.\nOn Jan 19, 2013 12:44 PM, \"Dretch\" notifications@github.com wrote:\n\n> The code used to work, but now it doesn't compile:\n> \n> fn double(x: int) -> int {\n>     x \\* 2\n> }\n> \n> fn main() {\n>     let v = (~[1, 2, 3]).map(double);\n> }\n> \n> Rustc says:\n> \n> test-extern-fn.rs:9:29: 9:35 error: mismatched types: expected `&fn(+:&<VI2>) -> <V8>` but found `extern fn(int) -> int` (expected &-ptr but found int)test-extern-fn.rs:9     let v = (~[1, 2, 3]).map(double);\n>                                                  ^~~~~~\n> test-extern-fn.rs:9:8: 9:36 error: cannot determine a type for this local variable: unconstrained typetest-extern-fn.rs:9     let v = (~[1, 2, 3]).map(double);\n>                             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~\n> error: aborting due to 2 previous errors\n> \n> This may be intentional but also might be a bug.\n> \n> \u2014\n> Reply to this email directly or view it on GitHubhttps://github.com/mozilla/rust/issues/4544.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12460843/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12472049",
    "html_url": "https://github.com/rust-lang/rust/issues/4544#issuecomment-12472049",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4544",
    "id": 12472049,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNDcyMDQ5",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-20T15:27:53Z",
    "updated_at": "2013-01-20T15:27:53Z",
    "body": "I think your problem here is that the type of `double` is wrong.  Map passes in pointers to the data in the vector.\n\nFor example, the following program compiles fine:\n\n```\nfn double(x: &int) -> int {\n    *x * 2\n}\n\nfn main() {\n    let v = (~[1, 2, 3]).map(double);\n}\n```\n\nThat said, as part of fn reform, I modified fn items so that their type is `extern fn()` and this is no longer a subtype of the closure type `&fn()`.  This is because the `extern fn()` value will eventually be JUST a function pointer, and not a pair of a function and an environment.  The compiler will automatically convert from one to the other when it does assignability checks, which means on function parameters, struct fields (but not records), and `let x: T = ...` locations.  This could be made to work differently if it's proving to be a big pain in practice, though I found it worked very well in our current codebase and was a relatively straightforward approach.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12472049/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12472054",
    "html_url": "https://github.com/rust-lang/rust/issues/4544#issuecomment-12472054",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4544",
    "id": 12472054,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNDcyMDU0",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-20T15:28:16Z",
    "updated_at": "2013-01-20T15:28:16Z",
    "body": "I should add: I am closing because this test case works.  If there are others you think should work but do not, please open a separate bug and we can discuss.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12472054/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12472689",
    "html_url": "https://github.com/rust-lang/rust/issues/4544#issuecomment-12472689",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4544",
    "id": 12472689,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNDcyNjg5",
    "user": {
      "login": "Dretch",
      "id": 1428731,
      "node_id": "MDQ6VXNlcjE0Mjg3MzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1428731?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Dretch",
      "html_url": "https://github.com/Dretch",
      "followers_url": "https://api.github.com/users/Dretch/followers",
      "following_url": "https://api.github.com/users/Dretch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Dretch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Dretch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Dretch/subscriptions",
      "organizations_url": "https://api.github.com/users/Dretch/orgs",
      "repos_url": "https://api.github.com/users/Dretch/repos",
      "events_url": "https://api.github.com/users/Dretch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Dretch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-20T16:12:44Z",
    "updated_at": "2013-01-20T16:12:44Z",
    "body": "Ah, indeed the test case I posted did not demonstrate the issue - which is, as you stated, that `extern fn` is no longer a subtype of `&fn()`.\n\nI think this is less convenient than the way it worked before, but I guess no more so than the implicit string pointer conversions.\n\nIn one of my actual use-cases I was bitten because I was passing a vector of `extern fn()` to a function expecting a vector of `fn()`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12472689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12520438",
    "html_url": "https://github.com/rust-lang/rust/issues/4544#issuecomment-12520438",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4544",
    "id": 12520438,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNTIwNDM4",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-21T22:16:06Z",
    "updated_at": "2013-01-21T22:16:06Z",
    "body": "I see.  Yes, this would no longer work.  An easy workaround would be to introduce a struct type.  Alternatively, the original design called for more comprehensive inference.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12520438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
