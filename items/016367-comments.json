[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51669238",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51669238",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51669238,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjY5MjM4",
    "user": {
      "login": "metajack",
      "id": 28357,
      "node_id": "MDQ6VXNlcjI4MzU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/28357?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/metajack",
      "html_url": "https://github.com/metajack",
      "followers_url": "https://api.github.com/users/metajack/followers",
      "following_url": "https://api.github.com/users/metajack/following{/other_user}",
      "gists_url": "https://api.github.com/users/metajack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/metajack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/metajack/subscriptions",
      "organizations_url": "https://api.github.com/users/metajack/orgs",
      "repos_url": "https://api.github.com/users/metajack/repos",
      "events_url": "https://api.github.com/users/metajack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/metajack/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-08T23:40:15Z",
    "updated_at": "2014-08-08T23:40:15Z",
    "body": "Have you clocked the resulting code performance difference? This seems like it would be great for servo.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51669238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51669487",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51669487",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51669487,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjY5NDg3",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-08T23:45:15Z",
    "updated_at": "2014-08-08T23:45:15Z",
    "body": "Very excited about this.\n\nI don't see the words 'codegen-threads' in this patch. Are you sure it exists? What happens when you specify `--codegen-units` but not `--codegen-threads`?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51669487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51672871",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51672871",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51672871,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjcyODcx",
    "user": {
      "login": "liigo",
      "id": 346530,
      "node_id": "MDQ6VXNlcjM0NjUzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/346530?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/liigo",
      "html_url": "https://github.com/liigo",
      "followers_url": "https://api.github.com/users/liigo/followers",
      "following_url": "https://api.github.com/users/liigo/following{/other_user}",
      "gists_url": "https://api.github.com/users/liigo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/liigo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/liigo/subscriptions",
      "organizations_url": "https://api.github.com/users/liigo/orgs",
      "repos_url": "https://api.github.com/users/liigo/repos",
      "events_url": "https://api.github.com/users/liigo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/liigo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-09T01:14:18Z",
    "updated_at": "2014-08-09T01:14:18Z",
    "body": "Replace the two with --codegen-tasks ?\n\n2014\u5e748\u67089\u65e5 \u4e0a\u53487:45\u4e8e \"Brian Anderson\" notifications@github.com\u5199\u9053\uff1a\n\n> Very excited about this.\n> \n> I don't see the words 'codegen-threads' in this patch. Are you sure it\n> exists? What happens when you specify --codegen-units but not\n> --codegen-threads?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51672871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51676034",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51676034",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51676034,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjc2MDM0",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-09T03:39:18Z",
    "updated_at": "2014-08-09T03:39:18Z",
    "body": "Could you describe some of the difficulties with sharing the `Session` and across worker threads? Was it mainly that `Rc` is used liberally inside of it? If so, do you think it would ever be feasible to share the `Session` in the worker threads?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51676034/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51676051",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51676051",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51676051,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjc2MDUx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-09T03:40:19Z",
    "updated_at": "2014-08-09T03:40:19Z",
    "body": "This is also some super amazing work, I'm incredibly excited to see where this goes! Major prosp @epdtry! :fish: \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51676051/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51692303",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51692303",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51692303,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjkyMzAz",
    "user": {
      "login": "asterite",
      "id": 209371,
      "node_id": "MDQ6VXNlcjIwOTM3MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/209371?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asterite",
      "html_url": "https://github.com/asterite",
      "followers_url": "https://api.github.com/users/asterite/followers",
      "following_url": "https://api.github.com/users/asterite/following{/other_user}",
      "gists_url": "https://api.github.com/users/asterite/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asterite/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asterite/subscriptions",
      "organizations_url": "https://api.github.com/users/asterite/orgs",
      "repos_url": "https://api.github.com/users/asterite/repos",
      "events_url": "https://api.github.com/users/asterite/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asterite/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-09T16:58:59Z",
    "updated_at": "2014-08-09T17:00:50Z",
    "body": "I don't know if it's applicable, but the way we do it in [Crystal](https://github.com/manastech/crystal) is to have one llvm module for each \"logical unit\". In our cases each logical unit is a class or a module. Maybe in Rust a \"logical unit\" is a struct, an array, etc., together will all its impls. Then you can also have another logical unit to be the top level functions.\n\nThen we fire up N threads and each one takes a task (an llvm module) to compile it. This greatly reduces the compilation time. When you split your whole program in N modules and fire up N threads to compile those (as you are proposing here), if a thread finishes early its left without a job to do, so a thread becomes idle. With M smaller modules and N threads, with N > M, when a thread finishes it can start working on another module, reducing the idle time.\n\nAdditionally, before compiling each module we write its bitcode to a .bc file in a hidden directory (.crystal, in our case). We then compare that .bc file to the .bc file generated by the previous run. If they turn out to be the same (and this will be true as long as you don't modify any impl of that logical unit), we can safely reuse the .o file of the previous run. This, again, reduces dramatically the times to recompile a project that had minimal changes.\n\nBits of the source code implementing this behaviour are [here](https://github.com/manastech/crystal/blob/master/src/compiler/crystal/compiler.cr#L299) and [here](https://github.com/manastech/crystal/blob/master/src/compiler/crystal/compiler.cr#L443), in case you want to take a look.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51692303/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51695436",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51695436",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51695436,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjk1NDM2",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-09T18:58:56Z",
    "updated_at": "2014-08-09T18:58:56Z",
    "body": "^THIS^ !!!   Please, please implement incremental compilation!\n\nThough I wonder if (transitively) unchanged modules could be culled right after resolution pass, based on source file timestamps and inter-module dependency info, which should be available at that point.  \nBut even if they are culled after translation, it would be a major boon in day-to-day development.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51695436/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51697667",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51697667",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51697667,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjk3NjY3",
    "user": {
      "login": "nrc",
      "id": 762626,
      "node_id": "MDQ6VXNlcjc2MjYyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nrc",
      "html_url": "https://github.com/nrc",
      "followers_url": "https://api.github.com/users/nrc/followers",
      "following_url": "https://api.github.com/users/nrc/following{/other_user}",
      "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
      "organizations_url": "https://api.github.com/users/nrc/orgs",
      "repos_url": "https://api.github.com/users/nrc/repos",
      "events_url": "https://api.github.com/users/nrc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nrc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-09T20:30:20Z",
    "updated_at": "2014-08-09T20:30:35Z",
    "body": "I would say that the 'logical unit' in Rust is a module, they tend to be fairly small (at least relative to crate size) and are naturally self contained. It is probably worth getting data (at least) for smaller units - thanks for the idea!\n\nIncremental compilation is the next part of the project - looking forward to what comes out of that :-)\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51697667/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51804046",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51804046",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51804046,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODA0MDQ2",
    "user": {
      "login": "spernsteiner",
      "id": 3031136,
      "node_id": "MDQ6VXNlcjMwMzExMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3031136?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/spernsteiner",
      "html_url": "https://github.com/spernsteiner",
      "followers_url": "https://api.github.com/users/spernsteiner/followers",
      "following_url": "https://api.github.com/users/spernsteiner/following{/other_user}",
      "gists_url": "https://api.github.com/users/spernsteiner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/spernsteiner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/spernsteiner/subscriptions",
      "organizations_url": "https://api.github.com/users/spernsteiner/orgs",
      "repos_url": "https://api.github.com/users/spernsteiner/repos",
      "events_url": "https://api.github.com/users/spernsteiner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/spernsteiner/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-11T16:27:13Z",
    "updated_at": "2014-08-11T16:27:13Z",
    "body": "@metajack:\n\n> Have you clocked the resulting code performance difference?\n\nCompiling `rustc` and all libraries using 4 compilation units produces a `rustc` that takes about 25% longer to run.\n\n@brson:\n\n> I don't see the words 'codegen-threads' in this patch. Are you sure it exists?\n\nIt's a codegen flag, so the flag name `codegen-threads` is generated by a macro from the variable name `codegen_threads`.\n\n> What happens when you specify `--codegen-units` but not `--codegen-threads`?\n\n`rustc` generates several compilation units, then runs optimization and codegen for them all sequentially.\n\n@alexcrichton:\n\n> Could you describe some of the difficulties with sharing the Session and across worker threads?\n\nLike most of `rustc`'s major data structures, `Session` uses `RefCell` all over the place.  I suppose we could share it using a `Mutex`, if we changed how the ownership is handled and were careful about the lifetimes of the mutex guards.\n\n@asterite:\n\n> When you split your whole program in N modules and fire up N threads to compile those (as you are proposing here), if a thread finishes early its left without a job to do, so a thread becomes idle.\n\nOne way I tried to address this problem was by adding some basic load balancing: `rustc` tries to make each LLVM module roughly the same size, so that each worker thread gets the same amount of work to do.  I also made `codegen-units` and `codegen-threads` separate flags so that you can have several smaller modules per worker thread.  (Though in the testing I've done so far, it doesn't seem to help.)\n\n@vadimcn:\n\n> Though I wonder if (transitively) unchanged modules could be culled right after resolution pass, based on source file timestamps and inter-module dependency info, which should be available at that point.\n\nThis is basically my next project.  Translation is the #2 time sink in `rustc` (after LLVM passes), so culling modules (or finer-grained items) before translation seems like the way to go.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51804046/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51844233",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51844233",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51844233,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODQ0MjMz",
    "user": {
      "login": "spernsteiner",
      "id": 3031136,
      "node_id": "MDQ6VXNlcjMwMzExMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3031136?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/spernsteiner",
      "html_url": "https://github.com/spernsteiner",
      "followers_url": "https://api.github.com/users/spernsteiner/followers",
      "following_url": "https://api.github.com/users/spernsteiner/following{/other_user}",
      "gists_url": "https://api.github.com/users/spernsteiner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/spernsteiner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/spernsteiner/subscriptions",
      "organizations_url": "https://api.github.com/users/spernsteiner/orgs",
      "repos_url": "https://api.github.com/users/spernsteiner/repos",
      "events_url": "https://api.github.com/users/spernsteiner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/spernsteiner/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-11T21:35:02Z",
    "updated_at": "2014-08-11T21:35:02Z",
    "body": "@alexcrichton:\nI think I've fixed all the things you mentioned, except that I haven't implemented LTO against separately compiled libraries yet.\n\nRegarding `ld -r` (since Github has unhelpfully collapsed that line comment), I haven't seen any problems yet on Linux or OSX.  On both I have bootstrapped rustc and run the test suite normally with no problems.  On Linux I have also run the test suite with `codegen-units > 1`, also with no problems.  I haven't tested it on Windows yet.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51844233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51875960",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51875960",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51875960,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODc1OTYw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-12T05:48:39Z",
    "updated_at": "2014-08-12T05:48:39Z",
    "body": "> Like most of rustc's major data structures, Session uses RefCell all over the place. I suppose we could share it using a Mutex, if we changed how the ownership is handled and were careful about the lifetimes of the mutex guards.\n\nI would definitely expect an `Arc<Mutex<Session>>` to be passed around (maybe `Option<Session>` so it could be unwrapped). I'm not entirely sure if this could be done because `Rc<T>` isn't `Send`, and I think that the session has a bunch of `Rc` pointers, but I'm not sure how hard it would be to get rid of those.\n\nIt looked like it would make parts of this much nicer to have access to the raw session rather than duplicating some logic here and there, but it may not be too worth it in the end.\n\n> Regarding ld -r (since Github has unhelpfully collapsed that line comment), I haven't seen any problems yet on Linux or OSX\n\nI don't think that any of our tests actually _use_ the object file emitted, they just emit it. I also recall that the linker always succeeded in creating an object, but the object itself was just unusable (for one reason or another). Again though, this could all just be misremembering, or some bug which has since been fixed!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51875960/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51937445",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51937445",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51937445,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxOTM3NDQ1",
    "user": {
      "login": "spernsteiner",
      "id": 3031136,
      "node_id": "MDQ6VXNlcjMwMzExMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3031136?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/spernsteiner",
      "html_url": "https://github.com/spernsteiner",
      "followers_url": "https://api.github.com/users/spernsteiner/followers",
      "following_url": "https://api.github.com/users/spernsteiner/following{/other_user}",
      "gists_url": "https://api.github.com/users/spernsteiner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/spernsteiner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/spernsteiner/subscriptions",
      "organizations_url": "https://api.github.com/users/spernsteiner/orgs",
      "repos_url": "https://api.github.com/users/spernsteiner/repos",
      "events_url": "https://api.github.com/users/spernsteiner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/spernsteiner/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-12T16:14:03Z",
    "updated_at": "2014-08-12T16:14:03Z",
    "body": "> I don't think that any of our tests actually use the object file emitted, they just emit it.\n\nThe `run-pass` tests link the object into an executable, run the resulting binary, and check that it works.  At least one step in that process should fail if `ld -r` emits a bad object file.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51937445/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51938353",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51938353",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51938353,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxOTM4MzUz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-12T16:21:02Z",
    "updated_at": "2014-08-12T16:21:02Z",
    "body": "Oh dear, I must be over looking a test! I only see two instances of `emit=.*obj` in the codebase, one is the `output-type-permutations` run-make test (no linking involved there), and the other is the codegen tests (no linking involved either). What was the test that uses the output of `ld -r`?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51938353/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51939865",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51939865",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51939865,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxOTM5ODY1",
    "user": {
      "login": "spernsteiner",
      "id": 3031136,
      "node_id": "MDQ6VXNlcjMwMzExMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3031136?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/spernsteiner",
      "html_url": "https://github.com/spernsteiner",
      "followers_url": "https://api.github.com/users/spernsteiner/followers",
      "following_url": "https://api.github.com/users/spernsteiner/following{/other_user}",
      "gists_url": "https://api.github.com/users/spernsteiner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/spernsteiner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/spernsteiner/subscriptions",
      "organizations_url": "https://api.github.com/users/spernsteiner/orgs",
      "repos_url": "https://api.github.com/users/spernsteiner/repos",
      "events_url": "https://api.github.com/users/spernsteiner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/spernsteiner/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-12T16:32:13Z",
    "updated_at": "2014-08-12T16:32:13Z",
    "body": "OK, let me back up.  I think the relevant part of the design was unclear.\n\nOn the master branch, `rustc` produces a single object file `crate.o`.  Then it feeds `crate.o` into the linker to produce an executable or shared object.\n\nOn this branch, `rustc` produces several object files `crate.0.o`, `crate.1.o`, etc.  It feeds those into `ld -r` to produce a combined object file `crate.o`.  Then `crate.o` is used to produce the final executable/library just like before.  (That's why this branch does not need any changes to `link_dylib` and such.)\n\nSo, on this branch, any test that involves compiling and running Rust code will end up using `ld -r` as part of the linking process.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51939865/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51940165",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-51940165",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 51940165,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxOTQwMTY1",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-12T16:34:44Z",
    "updated_at": "2014-08-12T16:34:44Z",
    "body": "Oh wow, I missed that entirely, I thought it was only used for `OutputTypeObject`! Sorry I missed that!\n\nIn that case, I'm definitely willing to trust `ld -r`.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51940165/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53141368",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-53141368",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 53141368,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTQxMzY4",
    "user": {
      "login": "nrc",
      "id": 762626,
      "node_id": "MDQ6VXNlcjc2MjYyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nrc",
      "html_url": "https://github.com/nrc",
      "followers_url": "https://api.github.com/users/nrc/followers",
      "following_url": "https://api.github.com/users/nrc/following{/other_user}",
      "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
      "organizations_url": "https://api.github.com/users/nrc/orgs",
      "repos_url": "https://api.github.com/users/nrc/repos",
      "events_url": "https://api.github.com/users/nrc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nrc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-23T03:28:22Z",
    "updated_at": "2014-08-23T03:28:22Z",
    "body": "OK, looks good! r=me with all the changes (most of which are nits, TBH) and with Alex's review. @alexcrichton r? (specifically the stuff in back and concerning linking, about which I have no idea).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53141368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53506131",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-53506131",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 53506131,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNTA2MTMx",
    "user": {
      "login": "spernsteiner",
      "id": 3031136,
      "node_id": "MDQ6VXNlcjMwMzExMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3031136?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/spernsteiner",
      "html_url": "https://github.com/spernsteiner",
      "followers_url": "https://api.github.com/users/spernsteiner/followers",
      "following_url": "https://api.github.com/users/spernsteiner/following{/other_user}",
      "gists_url": "https://api.github.com/users/spernsteiner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/spernsteiner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/spernsteiner/subscriptions",
      "organizations_url": "https://api.github.com/users/spernsteiner/orgs",
      "repos_url": "https://api.github.com/users/spernsteiner/repos",
      "events_url": "https://api.github.com/users/spernsteiner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/spernsteiner/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-26T23:06:03Z",
    "updated_at": "2014-08-26T23:06:03Z",
    "body": "The 32-bit Linux build failed because the partial link step was invoking `ld` directly without passing target-specific arguments, which resulted in trying to produce a 64-bit output from 32-bit inputs.  (The 32-bit builder seems to be running 64-bit Linux, so its `ld` defaults to 64-bit output.)  The latest commit fixes the problem by using `get_cc_prog()` and `target_strs.cc_args` instead of trying to invoke `ld` directly.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53506131/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53652494",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-53652494",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 53652494,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNjUyNDk0",
    "user": {
      "login": "spernsteiner",
      "id": 3031136,
      "node_id": "MDQ6VXNlcjMwMzExMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3031136?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/spernsteiner",
      "html_url": "https://github.com/spernsteiner",
      "followers_url": "https://api.github.com/users/spernsteiner/followers",
      "following_url": "https://api.github.com/users/spernsteiner/following{/other_user}",
      "gists_url": "https://api.github.com/users/spernsteiner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/spernsteiner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/spernsteiner/subscriptions",
      "organizations_url": "https://api.github.com/users/spernsteiner/orgs",
      "repos_url": "https://api.github.com/users/spernsteiner/repos",
      "events_url": "https://api.github.com/users/spernsteiner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/spernsteiner/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-27T22:55:59Z",
    "updated_at": "2014-08-27T22:55:59Z",
    "body": "I haven't been able to reproduce the win32 test failure, so I'm hoping it was just a transient error with the buildbot.  I did find an unrelated bug while investigating, so I've fixed that and rebased.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53652494/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53829479",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-53829479",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 53829479,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODI5NDc5",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-29T02:03:59Z",
    "updated_at": "2014-08-29T02:03:59Z",
    "body": "Hmm, looks like msys2's `rm` just \"knows\" that when I say \"`rm foo`\" I mean \"`rm foo.exe`\": \n\n```\n> echo foo >foo.exe\n> rm foo\n> rm foo\nrm: cannot remove `foo': No such file or directory\n```\n\nI guess this makes sense for compatibility with existing scripts.   But then Windows bot should not have had this problem to begin with... <shrug>\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53829479/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53927075",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-53927075",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 53927075,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzOTI3MDc1",
    "user": {
      "login": "spernsteiner",
      "id": 3031136,
      "node_id": "MDQ6VXNlcjMwMzExMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3031136?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/spernsteiner",
      "html_url": "https://github.com/spernsteiner",
      "followers_url": "https://api.github.com/users/spernsteiner/followers",
      "following_url": "https://api.github.com/users/spernsteiner/following{/other_user}",
      "gists_url": "https://api.github.com/users/spernsteiner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/spernsteiner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/spernsteiner/subscriptions",
      "organizations_url": "https://api.github.com/users/spernsteiner/orgs",
      "repos_url": "https://api.github.com/users/spernsteiner/repos",
      "events_url": "https://api.github.com/users/spernsteiner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/spernsteiner/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-29T20:38:02Z",
    "updated_at": "2014-08-29T20:38:02Z",
    "body": "@vadimcn: Wow, nice detective work!  I would never have expected `rm` to behave like that.\n\nHere's a second reason why the Windows bot should never have had a problem to begin with: `ld` is supposed to ignore `--force-exe-suffix` if `-r` is specified - and it's apparently worked that way since binutils version 2.7, released in 1996.  I don't know what kind of mingw build we've got installed on those Windows bots, but it's definitely not an up-to-date MSYS2, and on top of that it seems to have picked up some strange patches at some point.\n\nAnyway, I've added a workaround that should handle these inconsistencies between Windows toolchains.  Now (on Windows) `rustc` always adds `.exe` to the output file name when running `ld -r`, and then after linking renames the output file to the actual desired name.  This should give the correct behavior no matter how `ld` handles `--force-exe-suffix -r`.\n\nr? @alexcrichton\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53927075/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53950341",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-53950341",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 53950341,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzOTUwMzQx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-30T06:23:33Z",
    "updated_at": "2014-08-30T06:23:33Z",
    "body": "Well then, that's a new segfault I've never seen before!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53950341/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54687027",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-54687027",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 54687027,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0Njg3MDI3",
    "user": {
      "login": "spernsteiner",
      "id": 3031136,
      "node_id": "MDQ6VXNlcjMwMzExMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3031136?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/spernsteiner",
      "html_url": "https://github.com/spernsteiner",
      "followers_url": "https://api.github.com/users/spernsteiner/followers",
      "following_url": "https://api.github.com/users/spernsteiner/following{/other_user}",
      "gists_url": "https://api.github.com/users/spernsteiner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/spernsteiner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/spernsteiner/subscriptions",
      "organizations_url": "https://api.github.com/users/spernsteiner/orgs",
      "repos_url": "https://api.github.com/users/spernsteiner/repos",
      "events_url": "https://api.github.com/users/spernsteiner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/spernsteiner/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-05T21:59:51Z",
    "updated_at": "2014-09-05T21:59:51Z",
    "body": "Older versions of OSX's `ld64` linker parse object files using variable-size stack-allocated buffers for some temporary data structures.  The bus error seen on 6a60448 occurs because the object file contains too much stuff (mainly, too many unwinding table entries), and those stack allocated buffers overflow the 8MB stack limit of the parser thread.  This 8MB stack size is hard-coded inside `ld64`, so we can't work around the bug by bumping up stack size with `ulimit -s`.\n\nOn master, the `librustc` build works fine because `rustc.o` requires about 5MB of stack to parse.  This branch triggers a stack overflow because it uses `ld -r` to generate `rustc.o` (even with `-C codegen-units=1`), and `ld -r` adds a `__compact_unwind` section to the generated object file.  Parsing `librustc`'s `__compact_unwind` section uses an additional 4MB of stack, which puts the parser thread over its 8MB limit.  There is an undocumented flag `-no_compact_unwind` which is supposed to suppress the generation of the `__compact_unwind` section, but this flag is ignored when passed in combination with `-r`.\n\nNewer versions of `ld64` fix the stack overflow bug, by having the object file parser use `malloc` when the required buffer size is large.  Unfortunately, according to [wikipedia](http://en.wikipedia.org/wiki/Xcode#Versions_compare_table), the fixed `ld64` versions (224.1+) are available only with XCode 5+, for OSX 10.8+, while Rust is supposed to support building on OSX 10.7.  I'm not sure if there is any way to install newer `ld64` on older versions of OSX.\n\nThe latest commit on this branch avoids running `ld -r` when building with only a single compilation unit (which is probably a good idea regardless of the `ld64` bug).  This will let `librustc` build without errors (giant object file, but no `ld -r` doubling its stack use), and the separate compilation tests should also pass (`ld -r`, but tiny object files).  It doesn't fix the underlying problem, though - if anyone using XCode 4 tries to build a large crate with parallel codegen enabled, they will get a nasty segfault from the linker.  (Though note that `rustc` master can already trigger the same error without `ld -r`, for crates with about twice as many functions as `librustc`.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54687027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54703106",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-54703106",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 54703106,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NzAzMTA2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-06T05:25:16Z",
    "updated_at": "2014-09-06T05:25:16Z",
    "body": "@epdtry, oh my, that is quite the investigation! That's quite unfortunate that we'll segfault on older versions of OSX. It looks like there's not a whole lot we can do right now though. I'm sad that this may mean that we have to turn off parallel codegen for rustc itself by default (at least for osx), but we can cross that bridge later!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54703106/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54703113",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-54703113",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 54703113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NzAzMTEz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-06T05:25:32Z",
    "updated_at": "2014-09-06T05:25:32Z",
    "body": "Also, major major props for that investigation, that must have been quite a beast to track down!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54703113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54707663",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-54707663",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 54707663,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NzA3NjYz",
    "user": {
      "login": "l0kod",
      "id": 1286585,
      "node_id": "MDQ6VXNlcjEyODY1ODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1286585?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0kod",
      "html_url": "https://github.com/l0kod",
      "followers_url": "https://api.github.com/users/l0kod/followers",
      "following_url": "https://api.github.com/users/l0kod/following{/other_user}",
      "gists_url": "https://api.github.com/users/l0kod/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/l0kod/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/l0kod/subscriptions",
      "organizations_url": "https://api.github.com/users/l0kod/orgs",
      "repos_url": "https://api.github.com/users/l0kod/repos",
      "events_url": "https://api.github.com/users/l0kod/events{/privacy}",
      "received_events_url": "https://api.github.com/users/l0kod/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-06T09:36:13Z",
    "updated_at": "2014-09-06T09:36:13Z",
    "body": "Awesome work! Looks great for an efficient #2369.\n\n> Though I wonder if (transitively) unchanged modules could be culled right after resolution pass, based on source file timestamps and inter-module dependency info, which should be available at that point.\n\nI think the Ninja build system use hashes from the **compilation commands** and **source files** (all dependencies) instead of relying on timestamps. @bors should like it ;)\nShake can do it as well for source files: http://neilmitchell.blogspot.fr/2014/06/shake-file-hashesdigests.html\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54707663/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54713722",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-54713722",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 54713722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NzEzNzIy",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-06T14:28:11Z",
    "updated_at": "2014-09-06T14:28:11Z",
    "body": "Q: Is this flag ignored if `--test` is passed to the compiler?\n\nI just tried `rustc --test -L target/deps -C codegen-units=8 src/lib.rs` on my [library](https://github.com/japaric/linalg.rs) that has 300+ tests and the compile time is still 20 seconds, and CPU usage remained at 100% (one thread).\n\nDid I do something wrong? (Also `-C codegen-threads=8` returns `error: unknown codegen option`)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54713722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54714960",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-54714960",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 54714960,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NzE0OTYw",
    "user": {
      "login": "spernsteiner",
      "id": 3031136,
      "node_id": "MDQ6VXNlcjMwMzExMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3031136?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/spernsteiner",
      "html_url": "https://github.com/spernsteiner",
      "followers_url": "https://api.github.com/users/spernsteiner/followers",
      "following_url": "https://api.github.com/users/spernsteiner/following{/other_user}",
      "gists_url": "https://api.github.com/users/spernsteiner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/spernsteiner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/spernsteiner/subscriptions",
      "organizations_url": "https://api.github.com/users/spernsteiner/orgs",
      "repos_url": "https://api.github.com/users/spernsteiner/repos",
      "events_url": "https://api.github.com/users/spernsteiner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/spernsteiner/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-06T15:13:55Z",
    "updated_at": "2014-09-06T15:13:55Z",
    "body": "@japaric,\n\nThe flag is not ignored, it's just that your library is small enough that it doesn't get much benefit from this patch (especially when optimization is turned off).\n\nWith `-C codegen-units=1` (the default):\n\n```\ntime: 1.879 s   translation\n  time: 0.142 s llvm function passes\n  time: 0.067 s llvm module passes\n  time: 3.547 s codegen passes\n  time: 0.000 s codegen passes\ntime: 4.264 s   LLVM passes\n  time: 0.408 s running linker\ntime: 0.409 s   linking\n\nreal    0m16.718s\n```\n\nAnd with `-C codegen-units=4`:\n\n```\ntime: 2.927 s   translation\ntime: 0.054 s   llvm function passes\ntime: 0.055 s   llvm function passes\ntime: 0.056 s   llvm function passes\ntime: 0.055 s   llvm function passes\ntime: 0.022 s   llvm module passes\ntime: 0.025 s   llvm module passes\ntime: 0.025 s   llvm module passes\ntime: 0.026 s   llvm module passes\ntime: 1.422 s   codegen passes\ntime: 1.443 s   codegen passes\ntime: 1.448 s   codegen passes\ntime: 0.000 s   codegen passes\ntime: 1.474 s   codegen passes\ntime: 1.875 s   LLVM passes\n  time: 0.489 s running linker\ntime: 0.492 s   linking\n\nreal    0m15.472s\n```\n\nSince `rustc` spends only 4 seconds in LLVM passes to begin with, there is not much room for improvement.  Setting `codegen-units=4` reduces the time by about 2.5s, but also slows down translation and linking, so the overall benefit is tiny.  \n\n> Also -C codegen-threads=8 returns error: unknown codegen option\n\nI removed that flag because in my testing I found no benefit from setting `codegen-threads != codegen-units`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54714960/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54715498",
    "html_url": "https://github.com/rust-lang/rust/pull/16367#issuecomment-54715498",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16367",
    "id": 54715498,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NzE1NDk4",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-06T15:32:09Z",
    "updated_at": "2014-09-06T15:32:09Z",
    "body": "@epdtry Thanks for the detailed info!\n\nIt seems that the bottleneck is the type checking phase in my particular case, and now I'm wondering if spending 50%+ of the time in that phase is normal (but that's off-topic).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54715498/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
