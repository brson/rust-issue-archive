[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2700220",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2700220",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2700220,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDAyMjA=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-10T19:53:59Z",
    "updated_at": "2011-11-10T19:54:48Z",
    "body": "First off, thanks for the well-reasoned and written up proposal.  Here is another possible solution that seems a bit less invasive.  First, we add the ability to dereference unsafe pointers using `[]` syntax.  Therefore, for a value `x` of type `*T`, `x[5]` would do the same thing as in C, just as `*x` is currently permitted.  Both of course are only legal in unsafe code.  \n\nBased on this, one can implement the proposed unsafe vectors as a library.  Something like:\n\n```\nmod c_vec {\n    type t<T> = { base: *T, size: uint };\n    fn create<T>(base: *T, size: uint) -> @t<T> { ret @{ base:base, size:size}; }\n    fn get<T>(v: t<T>, idx: uint) -> T unsafe { assert idx < v.size; ret v.base[idx]; }\n}  \n```\n\nNow instances of c_vec can be used from safe code.  Besides syntax, the one issue is the re-use of higher-order functions from the `vec` module and so forth. I think that this could be addressed with traits or other similar solutions.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2700220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2702633",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2702633",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2702633,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDI2MzM=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-10T23:02:11Z",
    "updated_at": "2011-11-10T23:02:11Z",
    "body": "This is an important problem to solve, but I'm reluctant to solve it at the language level because vectors are likely going to change yet again and, as niko hinted, the language will probably become expressive enough solve it in std.\n\nEventually we should be able to implement c_vec and vec as implementations of a common interface and treat them more or less interchangeably.\n\nStill, we need some solution now since people are going to be writing more and more interop code. Can we implement a stopgap c_vec module now that would make writing this kind of code more convenient?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2702633/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2702759",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2702759",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2702759,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDI3NTk=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-10T23:14:09Z",
    "updated_at": "2011-11-10T23:14:09Z",
    "body": "so everything I described can be written today if the `[]` operation were added, which doesn't seem very difficult.  You would end up with some code duplication, I guess.  Also we need to think about when these arrays get freed---probably you want a resource?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2702759/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2702805",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2702805",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2702805,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDI4MDU=",
    "user": {
      "login": "jwise",
      "id": 87427,
      "node_id": "MDQ6VXNlcjg3NDI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/87427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jwise",
      "html_url": "https://github.com/jwise",
      "followers_url": "https://api.github.com/users/jwise/followers",
      "following_url": "https://api.github.com/users/jwise/following{/other_user}",
      "gists_url": "https://api.github.com/users/jwise/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jwise/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jwise/subscriptions",
      "organizations_url": "https://api.github.com/users/jwise/orgs",
      "repos_url": "https://api.github.com/users/jwise/repos",
      "events_url": "https://api.github.com/users/jwise/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jwise/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-10T23:19:05Z",
    "updated_at": "2011-11-10T23:19:05Z",
    "body": "Right.  Well, yeah, I could add the `[]` operation if that seems like the Right Way to do it.\n\nResources seem like a solution, but the question is where the resource goes ... take a look at the \"built in destructors\" extension proposal in my original post?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2702805/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2702854",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2702854",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2702854,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDI4NTQ=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-10T23:23:30Z",
    "updated_at": "2011-11-10T23:23:30Z",
    "body": "I think it could be done even without []. We have pointer math.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2702854/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2702979",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2702979",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2702979,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDI5Nzk=",
    "user": {
      "login": "msullivan",
      "id": 340349,
      "node_id": "MDQ6VXNlcjM0MDM0OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/msullivan",
      "html_url": "https://github.com/msullivan",
      "followers_url": "https://api.github.com/users/msullivan/followers",
      "following_url": "https://api.github.com/users/msullivan/following{/other_user}",
      "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions",
      "organizations_url": "https://api.github.com/users/msullivan/orgs",
      "repos_url": "https://api.github.com/users/msullivan/repos",
      "events_url": "https://api.github.com/users/msullivan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/msullivan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-10T23:35:19Z",
    "updated_at": "2011-11-10T23:35:19Z",
    "body": "Client code could be prevented from pulling out the vec by keeping mem abstract, I think?\n\n(Where by abstract I mean \"wrapping it in a tag and not exporting the constructor\", unless we have added more real abstract types while I was gone)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2702979/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2703160",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2703160",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2703160,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDMxNjA=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-10T23:55:29Z",
    "updated_at": "2011-11-10T23:55:29Z",
    "body": "Yes, except that #818 is still not fixed. Could also put it in an obj if you don't mind the vtable.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2703160/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2706056",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2706056",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2706056,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDYwNTY=",
    "user": {
      "login": "jwise",
      "id": 87427,
      "node_id": "MDQ6VXNlcjg3NDI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/87427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jwise",
      "html_url": "https://github.com/jwise",
      "followers_url": "https://api.github.com/users/jwise/followers",
      "following_url": "https://api.github.com/users/jwise/following{/other_user}",
      "gists_url": "https://api.github.com/users/jwise/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jwise/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jwise/subscriptions",
      "organizations_url": "https://api.github.com/users/jwise/orgs",
      "repos_url": "https://api.github.com/users/jwise/repos",
      "events_url": "https://api.github.com/users/jwise/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jwise/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-11T08:44:24Z",
    "updated_at": "2011-11-11T08:44:24Z",
    "body": "@msullivan: That would work.\n\n@brson: OK -- I can try hacking that up tomorrow or tomorrow evening.\n\nI'm still not convinced, though, that not unifying with the existing `vector` bits isn't the right way.  I thought about it some more today.  Having to call out to a function to safely do a set and a get on a native vector -- an operation that we probably want to be fast!  Adding typeclass dispatch for _all_ vectors creates quite a bit of overhead... is that really the right thing to do?\n\nI agree that where possible, \"more general\" solutions are better than \"more specific\".  But I'm not totally convinced that in this specific case, typeclassing vectors will lead to acceptable performance...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2706056/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2708562",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2708562",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2708562,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDg1NjI=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-11T14:23:46Z",
    "updated_at": "2011-11-11T14:27:41Z",
    "body": "There is no dynamic overhead to the categories that I proposed.  All calls would be dispatched statically.  I don't know the details of how Haskell typeclasses are implemented but I think categories are not 100% analogous.  Without inlining, it's true that there is some function call overhead to do the `get()` operations.  You will have overhead if you want to have some function that accepts _either_ a native or a non-native vector _and_ performs operations on it, because that will require an interface, which involves dynamic dispatch.\n\nHowever, there is one limitation that I was thinking about with the categories.  The implementations of higher-order functions like `map()` will be difficult to share because their type signatures are hard to express without knowledge the direct types involved.  This is the precise issue that the Scala people addressed in their [2.8 collection rewrite](http://www.scala-lang.org/docu/files/collections-api/collections.html).\n\nFor example, consider a trait `vec_like`:\n\n```\ntrait vec_like<T> {\n    req fn get(idx: uint) -> T;\n    req fn set(idx: uint, T value);\n    req fn len() -> uint;\n\n    // foreach works great\n    fn foreach(b: block(T) => ()) {\n        let i = 0u, n = len();\n        while i < n { b(get(i)); }\n    }\n\n    // map... not so great. what is the return type?\n    fn map<S>(b: block(T) => S) -> ??? {\n    }\n}\n```\n\nThe earlier versions of Scala addressed this problem through inheritance. The return type of `map()`, for example, would be `vec_like<T>`, and there would be a `req fn clone() -> vec_like<T>` function that duplicated the existing vector-like thing.  This is ok but not great and doesn't apply to us very well since `vec_like<T>` is not a type.  The newer versions use implicits to get much more precision but with _much_ more complexity. You also need parameterization by type constructors, not just types.  Again, another level of complexity.\n\nI still think native vectors don't need to be built into the language more than they already are, and much of the code can be shared, but without some significant design work there will be more redundancy than I originally envisioned.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2708562/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2708617",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2708617",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2708617,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDg2MTc=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-11T14:30:56Z",
    "updated_at": "2011-11-11T14:34:05Z",
    "body": "One \"worse is better\" solution to the problem I just described: functions like `map()` just return normal Rust vectors.  Actually, I think this is what the original proposal specified as well.\n\n```\ntrait vec_like<T> {\n    ...\n    fn map<S>(b: block(T) => S) -> [S] {\n        let res = [];\n        foreach { |e| res += [e]; }\n        return e;\n    }\n}\n```\n\nThis certainly works ok for this situation and may prove to be enough for us, depending on how rich our collections library becomes.  It's not as great if you have a linked list, say, and you want it to act \"vector-like\" but still be a linked list after a map operation.  Of course, then you can just redefine the `map()` function in your linked list library.  But then your linked list doesn't have a compatible type signature, which is too bad.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2708617/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2721353",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2721353",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2721353,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjEzNTM=",
    "user": {
      "login": "jwise",
      "id": 87427,
      "node_id": "MDQ6VXNlcjg3NDI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/87427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jwise",
      "html_url": "https://github.com/jwise",
      "followers_url": "https://api.github.com/users/jwise/followers",
      "following_url": "https://api.github.com/users/jwise/following{/other_user}",
      "gists_url": "https://api.github.com/users/jwise/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jwise/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jwise/subscriptions",
      "organizations_url": "https://api.github.com/users/jwise/orgs",
      "repos_url": "https://api.github.com/users/jwise/repos",
      "events_url": "https://api.github.com/users/jwise/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jwise/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-13T08:39:40Z",
    "updated_at": "2011-11-13T08:39:40Z",
    "body": "Right, indeed, \"map\" just returned Rust vectors in the original implementation.\n\nSo here's what I'm hearing: either way, there should be a `c_vec` module with manual \"get\" and \"set\" that wrap the `unsafe`ness inside of them.  There is substantial pain involved in not being able to use `[]`, but that pain might be resolved in the future by what you call traits (and what I call typeclasses).  The `c_vec` needs no language extensions -- just basis extensions, and would be sufficient to unblock a user of `fftw`.\n\n@brson commented that `[]` is not necessary on native pointers, but I'm not entirely convinced yet.  Strictly, there are a lot of things that are not \"needed\" in a language, but not having sugar makes a lot of operations pretty disgusting...\n\nI'll write a `mod c_vec` tonight, and see if using it makes me want to puke or not.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2721353/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2721828",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2721828",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2721828,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjE4Mjg=",
    "user": {
      "login": "jwise",
      "id": 87427,
      "node_id": "MDQ6VXNlcjg3NDI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/87427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jwise",
      "html_url": "https://github.com/jwise",
      "followers_url": "https://api.github.com/users/jwise/followers",
      "following_url": "https://api.github.com/users/jwise/following{/other_user}",
      "gists_url": "https://api.github.com/users/jwise/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jwise/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jwise/subscriptions",
      "organizations_url": "https://api.github.com/users/jwise/orgs",
      "repos_url": "https://api.github.com/users/jwise/repos",
      "events_url": "https://api.github.com/users/jwise/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jwise/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-13T11:26:05Z",
    "updated_at": "2011-11-13T11:26:20Z",
    "body": "So here's one thing that we don't have exposed from the language that we certainly do need in order to have `mod c_vec`.  In order to add pointers together, the best that we can get is something like:\n\n```\nfn p<T>(t: t<T>, ofs: uint) -> *mutable T {\n    // I'd like to do the following, but FIXME #1173\n    // (*t).base + (ofs as *T)\n    ((*t).base as uint + ofs) as *mutable T\n}\n```\n\nSpecifically, I cannot write `(*t).base + ofs` directly, since if I do:\n\n```\n./c_vec.rs:36:17: 36:20 error: mismatched types: expected *ps0 but found uint (types differ)\n./c_vec.rs:36     ((*t).base + ofs) as *mutable T\n```\n\nThis would be by itself just an annoyance, but the fatality here is that we can't know the size of a T at compile time -- I believe there is no `sizeof`-like operator.\n\nThoughts for a workaround?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2721828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2722812",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2722812",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2722812,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjI4MTI=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-13T15:45:10Z",
    "updated_at": "2011-11-13T15:56:37Z",
    "body": "What you want to do, I believe, is this:\n\n```\nmod c_vec {\n    import ptr;\n\n    type t<T> = {\n        base: *T;\n        len: uint;\n    };\n\n    unsafe create(base: *T, len: uint) -> t<T> {\n        ret { base: base, len: len };\n    }\n\n    fn get<T>(v: t<T>, idx: uint) -> T unsafe {\n        assert idx < v.len;\n        let ptr = ptr::offset(v.base, idx)\n        ret *ptr;\n    }\n\n    fn set<T>(v: t<T>, idx: uint, value: T) unsafe {\n        assert idx < v.len;\n        let ptr = ptr::offset(v.base, idx)\n        *ptr = value;\n    }\n}\n```\n\nThe key here is the `ptr::offset()` function, which performs pointer arithmetic.  I made the construction function unsafe because it has no way to verify the length or that the pointer is valid.  I also didn't pay any attention to freeing the vector.  I _also_ didn't try to compile this, but it _should_ work. :)\n\nWith respect to the annoyance of typing c_vec::get() and c_vec::set(), I hear you.  I think the only solution to that is user-defined operators.  I personally like the idea but others may disagree.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2722812/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2847917",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2847917",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2847917,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NDc5MTc=",
    "user": {
      "login": "jwise",
      "id": 87427,
      "node_id": "MDQ6VXNlcjg3NDI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/87427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jwise",
      "html_url": "https://github.com/jwise",
      "followers_url": "https://api.github.com/users/jwise/followers",
      "following_url": "https://api.github.com/users/jwise/following{/other_user}",
      "gists_url": "https://api.github.com/users/jwise/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jwise/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jwise/subscriptions",
      "organizations_url": "https://api.github.com/users/jwise/orgs",
      "repos_url": "https://api.github.com/users/jwise/repos",
      "events_url": "https://api.github.com/users/jwise/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jwise/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-23T12:06:24Z",
    "updated_at": "2011-11-23T12:08:28Z",
    "body": "Right, ptr::offset() did the right thing -- sort of.  There are a few other niggling details in there, but I have a pull request ready in pull request #1217. (Not ready to be pulled yet; an RFC at this stage.)\n\nOf note, there are a few things that I'm not sure about in there.  I'm not sure about whether `<copy T>` is the right thing -- this seems to be new as of this week?  Similarly, I'm not convinced (or unconvinced) that the `mutable T` cast is the right thing.  I asked Marijn about the `copy T` issue on IRC, so hopefully I'll get some clarification there.\n\nI haven't written tests for it yet, but I could easily do so as needed.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2847917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2880843",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2880843",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2880843,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4ODA4NDM=",
    "user": {
      "login": "jwise",
      "id": 87427,
      "node_id": "MDQ6VXNlcjg3NDI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/87427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jwise",
      "html_url": "https://github.com/jwise",
      "followers_url": "https://api.github.com/users/jwise/followers",
      "following_url": "https://api.github.com/users/jwise/following{/other_user}",
      "gists_url": "https://api.github.com/users/jwise/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jwise/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jwise/subscriptions",
      "organizations_url": "https://api.github.com/users/jwise/orgs",
      "repos_url": "https://api.github.com/users/jwise/repos",
      "events_url": "https://api.github.com/users/jwise/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jwise/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-26T10:18:03Z",
    "updated_at": "2011-11-26T10:18:03Z",
    "body": "I've renamed the pull request away from \"do not merge\"; I would say it is approaching ready.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2880843/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2952753",
    "html_url": "https://github.com/rust-lang/rust/issues/1167#issuecomment-2952753",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1167",
    "id": 2952753,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NTI3NTM=",
    "user": {
      "login": "jwise",
      "id": 87427,
      "node_id": "MDQ6VXNlcjg3NDI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/87427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jwise",
      "html_url": "https://github.com/jwise",
      "followers_url": "https://api.github.com/users/jwise/followers",
      "following_url": "https://api.github.com/users/jwise/following{/other_user}",
      "gists_url": "https://api.github.com/users/jwise/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jwise/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jwise/subscriptions",
      "organizations_url": "https://api.github.com/users/jwise/orgs",
      "repos_url": "https://api.github.com/users/jwise/repos",
      "events_url": "https://api.github.com/users/jwise/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jwise/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-11-30T00:01:50Z",
    "updated_at": "2011-11-30T00:01:50Z",
    "body": "Closed, pending rework in #1227 for `get` and `set` (and perhaps `[]` overloading).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2952753/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
