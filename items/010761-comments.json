[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29602384",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-29602384",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 29602384,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjAyMzg0",
    "user": {
      "login": "TeXitoi",
      "id": 5787066,
      "node_id": "MDQ6VXNlcjU3ODcwNjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5787066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TeXitoi",
      "html_url": "https://github.com/TeXitoi",
      "followers_url": "https://api.github.com/users/TeXitoi/followers",
      "following_url": "https://api.github.com/users/TeXitoi/following{/other_user}",
      "gists_url": "https://api.github.com/users/TeXitoi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TeXitoi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TeXitoi/subscriptions",
      "organizations_url": "https://api.github.com/users/TeXitoi/orgs",
      "repos_url": "https://api.github.com/users/TeXitoi/repos",
      "events_url": "https://api.github.com/users/TeXitoi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TeXitoi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-02T08:56:08Z",
    "updated_at": "2013-12-02T09:08:05Z",
    "body": "I suspect that `fn bench_write_ref` does not make virtual calls. Adding this\n\n``` rust\n#[inline(never)]\nfn writer_write(w: &mut Writer, b: &[u8]) {\n    w.write(b);\n}\n\n#[bench]\nfn bench_write_virt(bh: &mut BenchHarness) {\n    bh.iter(|| {\n        let mut mem = MemWriter::new();\n        let wr = &mut mem as &mut Writer;\n        for _ in range(0, 1000) {\n            writer_write(wr, \"abc\".as_bytes());\n        }\n    });\n}\n```\n\nI have, with `--opt-level 3`\n\n```\nrunning 5 tests\ntest bench_write_macro1 ... bench:    680823 ns/iter (+/- 34497)\ntest bench_write_macro2 ... bench:    950790 ns/iter (+/- 72309)\ntest bench_write_ref    ... bench:    505846 ns/iter (+/- 41965)\ntest bench_write_value  ... bench:    511815 ns/iter (+/- 36681)\ntest bench_write_virt   ... bench:    553466 ns/iter (+/- 43716)\n```\n\nSo, the virtual call have an impact, but it does not explain totally the slowness of `write!()` shown by this bench.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/29602384/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51412286",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-51412286",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 51412286,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNDEyMjg2",
    "user": {
      "login": "nham",
      "id": 546409,
      "node_id": "MDQ6VXNlcjU0NjQwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/546409?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nham",
      "html_url": "https://github.com/nham",
      "followers_url": "https://api.github.com/users/nham/followers",
      "following_url": "https://api.github.com/users/nham/following{/other_user}",
      "gists_url": "https://api.github.com/users/nham/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nham/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nham/subscriptions",
      "organizations_url": "https://api.github.com/users/nham/orgs",
      "repos_url": "https://api.github.com/users/nham/repos",
      "events_url": "https://api.github.com/users/nham/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nham/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-06T23:35:03Z",
    "updated_at": "2014-08-06T23:35:03Z",
    "body": "Visiting for bug triage. This seems to still be present. The code to run the benchmarks is now:\n\n```\nextern crate test;\n\nuse std::io::MemWriter;\nuse test::Bencher;\n\n#[bench]\nfn bench_write_value(bh: &mut Bencher) {\n    bh.iter(|| {\n        let mut mem = MemWriter::new();\n        for _ in range(0u, 1000) {\n            mem.write(\"abc\".as_bytes());\n        }\n    });\n}\n\n#[bench]\nfn bench_write_ref(bh: &mut Bencher) {\n    bh.iter(|| {\n        let mut mem = MemWriter::new();\n        let wr = &mut mem as &mut Writer;\n        for _ in range(0u, 1000) {\n            wr.write(\"abc\".as_bytes());\n        }\n    });\n}\n\n#[bench]\nfn bench_write_macro1(bh: &mut Bencher) {\n    bh.iter(|| {\n        let mut mem = MemWriter::new();\n        let wr = &mut mem as &mut Writer;\n        for _ in range(0u, 1000) {\n            write!(wr, \"abc\");\n        }\n    });\n}\n\n#[bench]\nfn bench_write_macro2(bh: &mut Bencher) {\n    bh.iter(|| {\n        let mut mem = MemWriter::new();\n        let wr = &mut mem as &mut Writer;\n        for _ in range(0u, 1000) {\n            write!(wr, \"{}\", \"abc\");\n        }\n    });\n}\n```\n\nWithout optimizations:\n\n```\nrunning 4 tests\ntest bench_write_macro1 ... bench:   1470468 ns/iter (+/- 291966)\ntest bench_write_macro2 ... bench:   1799612 ns/iter (+/- 316293)\ntest bench_write_ref    ... bench:   1336574 ns/iter (+/- 251664)\ntest bench_write_value  ... bench:   1317880 ns/iter (+/- 254668)\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 4 measured\n```\n\nWith `--opt-level=3`:\n\n```\nrunning 4 tests\ntest bench_write_macro1 ... bench:    127671 ns/iter (+/- 1452)\ntest bench_write_macro2 ... bench:    196158 ns/iter (+/- 2053)\ntest bench_write_ref    ... bench:     43881 ns/iter (+/- 453)\ntest bench_write_value  ... bench:     43859 ns/iter (+/- 336)\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 4 measured\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51412286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/152373019",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-152373019",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 152373019,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MjM3MzAxOQ==",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-30T01:15:07Z",
    "updated_at": "2015-10-30T01:15:24Z",
    "body": "Still an issue, using the following code:\n\n``` rust\n#![allow(unused_must_use)]\n#![feature(test)]\n\nextern crate test;\n\nuse std::io::Write;\nuse std::vec::Vec;\n\nuse test::Bencher;\n\n#[bench]\nfn bench_write_value(bh: &mut Bencher) {\n    bh.iter(|| {\n        let mut mem = Vec::new();\n        for _ in 0..1000 {\n            mem.write(\"abc\".as_bytes());\n        }\n    });\n}\n\n#[bench]\nfn bench_write_ref(bh: &mut Bencher) {\n    bh.iter(|| {\n        let mut mem = Vec::new();\n        let wr = &mut mem as &mut Write;\n        for _ in 0..1000 {\n            wr.write(\"abc\".as_bytes());\n        }\n    });\n}\n\n#[bench]\nfn bench_write_macro1(bh: &mut Bencher) {\n    bh.iter(|| {\n        let mut mem = Vec::new();\n        let wr = &mut mem as &mut Write;\n        for _ in 0..1000 {\n            write!(wr, \"abc\");\n        }\n    });\n}\n\n#[bench]\nfn bench_write_macro2(bh: &mut Bencher) {\n    bh.iter(|| {\n        let mut mem = Vec::new();\n        let wr = &mut mem as &mut Write;\n        for _ in 0..1000 {\n            write!(wr, \"{}\", \"abc\");\n        }\n    });\n}\n```\n\nTypically giving something like the following:\n\n```\n$ cargo bench\nrunning 4 tests\ntest bench_write_macro1 ... bench:      21,604 ns/iter (+/- 82)\ntest bench_write_macro2 ... bench:      29,273 ns/iter (+/- 85)\ntest bench_write_ref    ... bench:       1,396 ns/iter (+/- 387)\ntest bench_write_value  ... bench:       1,391 ns/iter (+/- 163)\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/152373019/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/310547501",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-310547501",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 310547501,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMDU0NzUwMQ==",
    "user": {
      "login": "ariasuni",
      "id": 2446451,
      "node_id": "MDQ6VXNlcjI0NDY0NTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2446451?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariasuni",
      "html_url": "https://github.com/ariasuni",
      "followers_url": "https://api.github.com/users/ariasuni/followers",
      "following_url": "https://api.github.com/users/ariasuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariasuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariasuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariasuni/subscriptions",
      "organizations_url": "https://api.github.com/users/ariasuni/orgs",
      "repos_url": "https://api.github.com/users/ariasuni/repos",
      "events_url": "https://api.github.com/users/ariasuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariasuni/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-23T01:42:02Z",
    "updated_at": "2017-06-23T01:42:02Z",
    "body": "I got approximately the same results with rust nightly.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/310547501/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/315395017",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-315395017",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 315395017,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNTM5NTAxNw==",
    "user": {
      "login": "ritiek",
      "id": 20314742,
      "node_id": "MDQ6VXNlcjIwMzE0NzQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/20314742?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ritiek",
      "html_url": "https://github.com/ritiek",
      "followers_url": "https://api.github.com/users/ritiek/followers",
      "following_url": "https://api.github.com/users/ritiek/following{/other_user}",
      "gists_url": "https://api.github.com/users/ritiek/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ritiek/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ritiek/subscriptions",
      "organizations_url": "https://api.github.com/users/ritiek/orgs",
      "repos_url": "https://api.github.com/users/ritiek/repos",
      "events_url": "https://api.github.com/users/ritiek/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ritiek/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-07-14T15:50:39Z",
    "updated_at": "2017-07-14T15:50:39Z",
    "body": "Just for the record, running with `v1.20.0-nightly`:\r\n\r\n```\r\n$ cargo bench\r\nrunning 4 tests\r\ntest bench_write_macro1 ... bench:      36,556 ns/iter (+/- 69)\r\ntest bench_write_macro2 ... bench:      54,377 ns/iter (+/- 958)\r\ntest bench_write_ref    ... bench:      13,730 ns/iter (+/- 24)\r\ntest bench_write_value  ... bench:      13,755 ns/iter (+/- 81)\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/315395017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/424045638",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-424045638",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 424045638,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNDA0NTYzOA==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-09-24T16:50:48Z",
    "updated_at": "2018-09-24T16:50:48Z",
    "body": "Today:\r\n\r\n```text\r\nrunning 4 tests\r\ntest bench_write_macro1 ... bench:      16,220 ns/iter (+/- 982)\r\ntest bench_write_macro2 ... bench:      25,542 ns/iter (+/- 2,220)\r\ntest bench_write_ref    ... bench:       4,889 ns/iter (+/- 314)\r\ntest bench_write_value  ... bench:       4,819 ns/iter (+/- 956)\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/424045638/reactions",
      "total_count": 6,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 5,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/681082519",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-681082519",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 681082519,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTA4MjUxOQ==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-08-26T19:36:34Z",
    "updated_at": "2020-08-26T19:36:34Z",
    "body": "Two years later:\r\n\r\n```text\r\nrunning 4 tests\r\ntest bench_write_macro1 ... bench:      17,561 ns/iter (+/- 174)\r\ntest bench_write_macro2 ... bench:      23,285 ns/iter (+/- 2,771)\r\ntest bench_write_ref    ... bench:       3,234 ns/iter (+/- 194)\r\ntest bench_write_value  ... bench:       3,238 ns/iter (+/- 123)\r\n\r\ntest result: ok. 0 passed; 0 failed; 0 ignored; 4 measured; 0 filtered out\r\n\r\n\u276f rustc +nightly --version\r\nrustc 1.47.0-nightly (30f0a0768 2020-08-18)\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/681082519/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 2,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/687677592",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-687677592",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 687677592,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NzY3NzU5Mg==",
    "user": {
      "login": "workingjubilee",
      "id": 46493976,
      "node_id": "MDQ6VXNlcjQ2NDkzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/workingjubilee",
      "html_url": "https://github.com/workingjubilee",
      "followers_url": "https://api.github.com/users/workingjubilee/followers",
      "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}",
      "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions",
      "organizations_url": "https://api.github.com/users/workingjubilee/orgs",
      "repos_url": "https://api.github.com/users/workingjubilee/repos",
      "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/workingjubilee/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-09-05T23:54:43Z",
    "updated_at": "2020-09-05T23:54:43Z",
    "body": "I was curious if the difference was in the implementation of io::Write vs. fmt::Write, or in the details of write_fmt requiring format_args!, which is relevant since write! can be asked to \"serve\" either case.\r\n\r\nTo discover more information on this, I compared Vec to String, a seemingly \"apples to apples...ish\" comparison. https://gist.github.com/workingjubilee/2d2e3a7fded1c2101aafb51dc79a7ec5\r\n```\r\nrunning 10 tests\r\ntest string_write_fmt    ... bench:      10,053 ns/iter (+/- 1,141)\r\ntest string_write_macro1 ... bench:      10,177 ns/iter (+/- 2,363)\r\ntest string_write_macro2 ... bench:      17,499 ns/iter (+/- 1,847)\r\ntest string_write_ref    ... bench:       2,270 ns/iter (+/- 265)\r\ntest string_write_value  ... bench:       2,333 ns/iter (+/- 126)\r\ntest vec_write_fmt       ... bench:      15,722 ns/iter (+/- 1,673)\r\ntest vec_write_macro1    ... bench:      15,767 ns/iter (+/- 1,638)\r\ntest vec_write_macro2    ... bench:      23,968 ns/iter (+/- 8,942)\r\ntest vec_write_ref       ... bench:       2,296 ns/iter (+/- 178)\r\ntest vec_write_value     ... bench:       2,230 ns/iter (+/- 235)\r\n\r\ntest result: ok. 0 passed; 0 failed; 0 ignored; 10 measured; 0 filtered out\r\n```",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/687677592/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/688526661",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-688526661",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 688526661,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODUyNjY2MQ==",
    "user": {
      "login": "workingjubilee",
      "id": 46493976,
      "node_id": "MDQ6VXNlcjQ2NDkzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/workingjubilee",
      "html_url": "https://github.com/workingjubilee",
      "followers_url": "https://api.github.com/users/workingjubilee/followers",
      "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}",
      "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions",
      "organizations_url": "https://api.github.com/users/workingjubilee/orgs",
      "repos_url": "https://api.github.com/users/workingjubilee/repos",
      "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/workingjubilee/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-09-07T22:19:46Z",
    "updated_at": "2020-09-08T02:23:43Z",
    "body": "I found it interesting that this example revealed that String actually had less overhead than Vec on `write!` (the benchmark had high variance but I considered it indicative enough).\r\n\r\nThen I looked and saw:\r\n```rust\r\n    fn write_fmt(&mut self, fmt: fmt::Arguments<'_>) -> Result<()> {\r\n        // Create a shim which translates an io::Write to a fmt::Write and saves\r\n        // off I/O errors. instead of discarding them\r\n        struct Adaptor<'a, T: ?Sized + 'a> {\r\n            inner: &'a mut T,\r\n            error: Result<()>,\r\n        }\r\n\r\n        /* More code related to implementing and using the resulting shim,\r\n         * seemingly involving a lot of poking a reference at runtime??? */\r\n    }\r\n```\r\nSo I am no longer surprised.\r\nI believe it is possible to fast-path some cases, but this is not actually an apples-to-apples comparison here. The orange is `write_fmt`, which has to use a variety of formatting machinery. What needs to happen is that `write!` should skip `write_fmt` in simple cases where the formatting machinery is not required, or the formatting machinery should itself be much faster in the case of the obvious fast path.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/688526661/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1192766268",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-1192766268",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 1192766268,
    "node_id": "IC_kwDOAAsO6M5HGCs8",
    "user": {
      "login": "CAD97",
      "id": 5992217,
      "node_id": "MDQ6VXNlcjU5OTIyMTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5992217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CAD97",
      "html_url": "https://github.com/CAD97",
      "followers_url": "https://api.github.com/users/CAD97/followers",
      "following_url": "https://api.github.com/users/CAD97/following{/other_user}",
      "gists_url": "https://api.github.com/users/CAD97/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CAD97/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CAD97/subscriptions",
      "organizations_url": "https://api.github.com/users/CAD97/orgs",
      "repos_url": "https://api.github.com/users/CAD97/repos",
      "events_url": "https://api.github.com/users/CAD97/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CAD97/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-07-22T16:56:01Z",
    "updated_at": "2022-07-22T16:56:01Z",
    "body": "(checking oldest issues for fun and profit)\n\nDid `fmt::Arguments::as_str` improve the situation here?",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1192766268/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1210871310",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-1210871310",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 1210871310,
    "node_id": "IC_kwDOAAsO6M5ILG4O",
    "user": {
      "login": "Kobzol",
      "id": 4539057,
      "node_id": "MDQ6VXNlcjQ1MzkwNTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kobzol",
      "html_url": "https://github.com/Kobzol",
      "followers_url": "https://api.github.com/users/Kobzol/followers",
      "following_url": "https://api.github.com/users/Kobzol/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions",
      "organizations_url": "https://api.github.com/users/Kobzol/orgs",
      "repos_url": "https://api.github.com/users/Kobzol/repos",
      "events_url": "https://api.github.com/users/Kobzol/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kobzol/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-08-10T15:27:57Z",
    "updated_at": "2022-08-10T15:27:57Z",
    "body": "Not really (`nightly 2022-07-23`):\r\n```\r\nrunning 5 tests\r\ntest string_write_fmt    ... bench:       6,953 ns/iter (+/- 161)\r\ntest string_write_macro1 ... bench:       7,034 ns/iter (+/- 227)\r\ntest string_write_macro2 ... bench:       9,308 ns/iter (+/- 760)\r\ntest string_write_ref    ... bench:         688 ns/iter (+/- 32)\r\ntest string_write_value  ... bench:         673 ns/iter (+/- 34)\r\n```",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1210871310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1211781733",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-1211781733",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 1211781733,
    "node_id": "IC_kwDOAAsO6M5IOlJl",
    "user": {
      "login": "CAD97",
      "id": 5992217,
      "node_id": "MDQ6VXNlcjU5OTIyMTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5992217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CAD97",
      "html_url": "https://github.com/CAD97",
      "followers_url": "https://api.github.com/users/CAD97/followers",
      "following_url": "https://api.github.com/users/CAD97/following{/other_user}",
      "gists_url": "https://api.github.com/users/CAD97/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CAD97/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CAD97/subscriptions",
      "organizations_url": "https://api.github.com/users/CAD97/orgs",
      "repos_url": "https://api.github.com/users/CAD97/repos",
      "events_url": "https://api.github.com/users/CAD97/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CAD97/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-08-11T10:05:15Z",
    "updated_at": "2022-08-11T10:05:15Z",
    "body": "It seems to be just because nobody bothered to yet. https://gist.github.com/CAD97/2922d3132777310c1e22564f6c6dabdf\r\n\r\n```rust\r\nrunning 8 tests\r\ntest new_string_write_macro1 ... bench:       1,875 ns/iter (+/- 228)\r\ntest new_string_write_macro2 ... bench:      13,594 ns/iter (+/- 999)\r\ntest new_vec_write_macro1    ... bench:       1,637 ns/iter (+/- 175)\r\ntest new_vec_write_macro2    ... bench:      13,808 ns/iter (+/- 1,320)\r\ntest old_string_write_macro1 ... bench:      10,080 ns/iter (+/- 1,618)\r\ntest old_string_write_macro2 ... bench:      13,880 ns/iter (+/- 1,327)\r\ntest old_vec_write_macro1    ... bench:      10,037 ns/iter (+/- 779)\r\ntest old_vec_write_macro2    ... bench:      14,783 ns/iter (+/- 1,280)\r\n```\r\n\r\n```patch\r\n--- old/src/std/io/mod.rs\r\n+++ new/src/std/io/mod.rs\r\n@@ -1650,8 +1650,12 @@\r\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\r\n     fn write_fmt(&mut self, fmt: fmt::Arguments<'_>) -> Result<()> {\r\n+        if let Some(s) = fmt.as_str() {\r\n+            return self.write_all(s.as_bytes());\r\n+        }\r\n+\r\n         // Create a shim which translates a Write to a fmt::Write and saves\r\n         // off I/O errors. instead of discarding them\r\n         struct Adapter<'a, T: ?Sized + 'a> {\r\n             inner: &'a mut T,\r\n             error: Result<()>,\r\n         }\r\n--- old/src/core/fmt/mod.rs\r\n+++ new/src/core/fmt/mod.rs\r\n@@ -186,4 +186,8 @@\r\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\r\n     fn write_fmt(mut self: &mut Self, args: Arguments<'_>) -> Result {\r\n+        if let Some(s) = args.as_str() {\r\n+            self.write_str(s)\r\n+        } else {\r\n-        write(&mut self, args)\r\n+            write(&mut self, args)\r\n+        }\r\n     }\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1211781733/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1211788395",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-1211788395",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 1211788395,
    "node_id": "IC_kwDOAAsO6M5IOmxr",
    "user": {
      "login": "Kobzol",
      "id": 4539057,
      "node_id": "MDQ6VXNlcjQ1MzkwNTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kobzol",
      "html_url": "https://github.com/Kobzol",
      "followers_url": "https://api.github.com/users/Kobzol/followers",
      "following_url": "https://api.github.com/users/Kobzol/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions",
      "organizations_url": "https://api.github.com/users/Kobzol/orgs",
      "repos_url": "https://api.github.com/users/Kobzol/repos",
      "events_url": "https://api.github.com/users/Kobzol/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kobzol/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-08-11T10:11:34Z",
    "updated_at": "2022-08-11T10:11:34Z",
    "body": "It doesn't solve all the cases, but this definitely sounds like a nice improvement, that could be done in parallel with the ongoing `fmt` rewrite attempts. Will you send a PR? :)",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1211788395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1848217670",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-1848217670",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 1848217670,
    "node_id": "IC_kwDOAAsO6M5uKZBG",
    "user": {
      "login": "kekeimiku",
      "id": 36557882,
      "node_id": "MDQ6VXNlcjM2NTU3ODgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/36557882?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kekeimiku",
      "html_url": "https://github.com/kekeimiku",
      "followers_url": "https://api.github.com/users/kekeimiku/followers",
      "following_url": "https://api.github.com/users/kekeimiku/following{/other_user}",
      "gists_url": "https://api.github.com/users/kekeimiku/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kekeimiku/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kekeimiku/subscriptions",
      "organizations_url": "https://api.github.com/users/kekeimiku/orgs",
      "repos_url": "https://api.github.com/users/kekeimiku/repos",
      "events_url": "https://api.github.com/users/kekeimiku/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kekeimiku/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-12-09T04:06:03Z",
    "updated_at": "2023-12-09T04:06:03Z",
    "body": "ten years later:\r\nrustc 1.76.0-nightly (f967532a4 2023-12-08)\r\n```\r\ntest bench_write_macro1 ... bench:       6,062 ns/iter (+/- 41)\r\ntest bench_write_macro2 ... bench:       6,070 ns/iter (+/- 233)\r\ntest bench_write_ref    ... bench:         838 ns/iter (+/- 49)\r\ntest bench_write_value  ... bench:         813 ns/iter (+/- 7)\r\n```",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1848217670/reactions",
      "total_count": 4,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 4
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1848267248",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-1848267248",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 1848267248,
    "node_id": "IC_kwDOAAsO6M5uKlHw",
    "user": {
      "login": "Kobzol",
      "id": 4539057,
      "node_id": "MDQ6VXNlcjQ1MzkwNTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kobzol",
      "html_url": "https://github.com/Kobzol",
      "followers_url": "https://api.github.com/users/Kobzol/followers",
      "following_url": "https://api.github.com/users/Kobzol/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions",
      "organizations_url": "https://api.github.com/users/Kobzol/orgs",
      "repos_url": "https://api.github.com/users/Kobzol/repos",
      "events_url": "https://api.github.com/users/Kobzol/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kobzol/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-12-09T06:49:29Z",
    "updated_at": "2023-12-09T06:49:29Z",
    "body": "The macro1 and macro2 versions should be mostly identical now, thanks to format args flattening. Sadly, it's still not as fast as the non-macro version. Mara has recently posted an awesome [blog post](https://blog.m-ou.se/format-args/), where she explains the different trade-offs of format args macros. It's not practical to perfectly expand the macros everywhere, because while it could improve runtime performance, it could also hurt compile times and binary size a lot. That being said, in this simple case, where only a string is being written and only `Display` is used, it would be great if we could optimize it better.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1848267248/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3249078165",
    "html_url": "https://github.com/rust-lang/rust/issues/10761#issuecomment-3249078165",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/10761",
    "id": 3249078165,
    "node_id": "IC_kwDOAAsO6M7BqP-V",
    "user": {
      "login": "hkBst",
      "id": 25009929,
      "node_id": "MDQ6VXNlcjI1MDA5OTI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/25009929?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hkBst",
      "html_url": "https://github.com/hkBst",
      "followers_url": "https://api.github.com/users/hkBst/followers",
      "following_url": "https://api.github.com/users/hkBst/following{/other_user}",
      "gists_url": "https://api.github.com/users/hkBst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hkBst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hkBst/subscriptions",
      "organizations_url": "https://api.github.com/users/hkBst/orgs",
      "repos_url": "https://api.github.com/users/hkBst/repos",
      "events_url": "https://api.github.com/users/hkBst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hkBst/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-09-03T12:37:34Z",
    "updated_at": "2025-09-03T12:37:34Z",
    "body": "Current results (on rustc 1.91.0-nightly (51ff89506 2025-09-02)):\n```text\nrunning 4 tests\ntest bench_write_macro1 ... bench:      16,539.22 ns/iter (+/- 418.54)\ntest bench_write_macro2 ... bench:      17,062.93 ns/iter (+/- 35.58)\ntest bench_write_ref    ... bench:       1,705.72 ns/iter (+/- 9.47)\ntest bench_write_value  ... bench:       1,621.71 ns/iter (+/- 8.97)\n```",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3249078165/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  }
]
