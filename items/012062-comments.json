[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34302012",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34302012",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34302012,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzAyMDEy",
    "user": {
      "login": "lifthrasiir",
      "id": 323836,
      "node_id": "MDQ6VXNlcjMyMzgzNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/323836?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lifthrasiir",
      "html_url": "https://github.com/lifthrasiir",
      "followers_url": "https://api.github.com/users/lifthrasiir/followers",
      "following_url": "https://api.github.com/users/lifthrasiir/following{/other_user}",
      "gists_url": "https://api.github.com/users/lifthrasiir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lifthrasiir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lifthrasiir/subscriptions",
      "organizations_url": "https://api.github.com/users/lifthrasiir/orgs",
      "repos_url": "https://api.github.com/users/lifthrasiir/repos",
      "events_url": "https://api.github.com/users/lifthrasiir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lifthrasiir/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T08:32:13Z",
    "updated_at": "2014-02-06T08:32:13Z",
    "body": "> Care is taken to try to convert invalid UTF-8 sequences into as few replacement characters as are needed.\n\nThis is different from the behavior of the [WHATWG Encoding standard](http://encoding.spec.whatwg.org/#utf-8), which converts the sequence up to the first bad byte into one replacement character and continues to process the following bytes at the initial state. While there is no particular reason to use this algorithm (the number of replacement characters is arbitrary anyway) there is also no reason to diverge from the WHATWG standard.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34302012/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34304771",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34304771",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34304771,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzA0Nzcx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T09:15:50Z",
    "updated_at": "2014-02-06T09:16:02Z",
    "body": "@lifthrasiir is it worth just pulling your encoding library into the main tree now that we have nice crates? (Assuming it handles cases like this.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34304771/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34307636",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34307636",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34307636,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzA3NjM2",
    "user": {
      "login": "lifthrasiir",
      "id": 323836,
      "node_id": "MDQ6VXNlcjMyMzgzNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/323836?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lifthrasiir",
      "html_url": "https://github.com/lifthrasiir",
      "followers_url": "https://api.github.com/users/lifthrasiir/followers",
      "following_url": "https://api.github.com/users/lifthrasiir/following{/other_user}",
      "gists_url": "https://api.github.com/users/lifthrasiir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lifthrasiir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lifthrasiir/subscriptions",
      "organizations_url": "https://api.github.com/users/lifthrasiir/orgs",
      "repos_url": "https://api.github.com/users/lifthrasiir/repos",
      "events_url": "https://api.github.com/users/lifthrasiir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lifthrasiir/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T09:57:03Z",
    "updated_at": "2014-02-06T09:57:03Z",
    "body": "@huonw Except that the library is not quite matured enough, I do not object. Maybe we can just put `#[unstable]` for now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34307636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34308929",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34308929",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34308929,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzA4OTI5",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T10:14:12Z",
    "updated_at": "2014-02-06T10:14:12Z",
    "body": "I think having a full featured lib that gets kept up to date and (hopefully) incrementally improved would be better than patching over holes with functions like this. (And it also allows the new URL module to be pulled in, since, iirc, it depends on rust-encoding?)\n\nOthers may disagree...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34308929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34351235",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34351235",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34351235,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzUxMjM1",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T18:00:17Z",
    "updated_at": "2014-02-06T18:00:17Z",
    "body": "@lifthrasiir I was trying to find that link and couldn't find it. Thanks.\n\n@huonw Having encodings in the main tree would be nice, although I am slightly worried about the size of the encoding tables (I'm not familiar with @lifthrasiir's library in particular but I assume it uses encoding tables like everything else). I do think that support UTF-8 like this can be done without having a full encoding library.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34351235/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34354089",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34354089",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34354089,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzU0MDg5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T18:28:59Z",
    "updated_at": "2014-02-06T18:28:59Z",
    "body": "@lifthrasiir After reading that algorithm, that's pretty similar to what I'm doing. The two big differences:\n1. My algorithm supports overlong encodings and re-encodes them in the canonical length.\n2. That algorithm I think is going to emit 3 U+FFFDs for a surrogate character, which seems a bit absurd to me. My algorithm only emits one. Still, this does follow the rule defined in \u00a75.22 of the [Unicode standard](http://www.unicode.org/versions/Unicode6.2.0/ch05.pdf).\n\nI can modify this implementation to conform to that algorithm. However, I did intentionally decide to support overlong encodings. Is that a decision I should reverse?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34354089/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34357631",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34357631",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34357631,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzU3NjMx",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T19:00:54Z",
    "updated_at": "2014-02-06T19:00:54Z",
    "body": "Implementing the WHATWG algorithm is pretty straightforward, but unfortunately a straightforward implementation is almost 30% slower on multibyte characters than what I already have :angry: But if we think that behaving the same as the WHATWG algorithm is desired this can surely be optimized.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34357631/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34357765",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34357765",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34357765,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzU3NzY1",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T19:02:22Z",
    "updated_at": "2014-02-06T19:04:31Z",
    "body": "[RFC 3629](https://tools.ietf.org/html/rfc3629#page-5) says:\n\n> Implementations of the decoding algorithm above MUST protect against\n>    decoding invalid sequences.  For instance, a naive implementation may\n>    decode the overlong UTF-8 sequence C0 80 into the character U+0000,\n>    or the surrogate pair ED A1 8C ED BE B4 into U+233B4.  Decoding\n>    invalid sequences may have security consequences or cause other\n>    problems.\n\nand \n\n> Another example might be a parser which\n>    prohibits the octet sequence 2F 2E 2E 2F (\"/../\"), yet permits the\n>    illegal octet sequence 2F C0 AE 2E 2F.  This last exploit has\n>    actually been used in a widespread virus attacking Web servers in\n>    2001; thus, the security threat is very real.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34357765/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34358095",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34358095",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34358095,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzU4MDk1",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T19:05:22Z",
    "updated_at": "2014-02-06T19:05:22Z",
    "body": "@Jurily Yes, but I'm not decoding into codepoints, I'm decoding back into another UTF-8 stream. I originally decided to support overlong encodings because that way someone could decide that, for whatever reason, they need to be able to use the `C0 80` encoding of U+0000, and then could handle it with this function. The idea is that any security filtering of the stream can happen on the re-encoded utf-8 stream.\n\nHowever, I suspect that this is an edge case that it's probably better not to support. So I'm comfortable saying that we definitely should not support overlong encodings at this point.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34358095/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34371259",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34371259",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34371259,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzcxMjU5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T21:12:21Z",
    "updated_at": "2014-02-06T21:12:21Z",
    "body": "Rewriting the algorithm to be WHATWG-equivalent without actually using the WHATWG algorithm ends up being up to 25% faster in the multibyte case than my original proposed algorithm (which makes it significantly better than the WHATWG version).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34371259/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34372541",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34372541",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34372541,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzcyNTQx",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T21:23:29Z",
    "updated_at": "2014-02-06T21:23:29Z",
    "body": "I've pushed the new version. It now matches the WHATWG algorithm's output, and no longer allows for overlong encodings.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34372541/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34373142",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34373142",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34373142,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzczMTQy",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-06T21:26:19Z",
    "updated_at": "2014-02-06T22:16:19Z",
    "body": "@huonw To expand on my previous comment, I think that providing a full encodings library in the core distribution is a good idea, but it should remain in its own crate. On the other hand, UTF-8 decoding is so important to Rust (because its native `str` type requires UTF-8) that a version of the decoder that supports U+FFFD should be provided in libstd.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34373142/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34392953",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34392953",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34392953,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzkyOTUz",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T00:40:19Z",
    "updated_at": "2014-02-07T00:40:19Z",
    "body": "This PR will close #9516.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34392953/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34396618",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34396618",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34396618,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0Mzk2NjE4",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T01:45:26Z",
    "updated_at": "2014-02-07T01:45:26Z",
    "body": "@huonw Example added.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34396618/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34406947",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34406947",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34406947,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDA2OTQ3",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T06:13:49Z",
    "updated_at": "2014-02-07T06:13:49Z",
    "body": "I changed `loop` to `while`, and removed the unnecessary use of `return` at the end, but otherwise left it alone. In my tests I couldn't get it to run faster even with what I thought would obviously work, such as using `~[u8]` directly instead of `~str` (since the `raw` methods I'm using just end up calling `as_owned_vec()` first). That case sped up the normal scenario of valid strings slightly, but it significantly slowed down the invalid case. I also tried pointer arithmetic, with no difference, and I tried counting the number of replacements first (to be able to allocate the new string with the correct size) and removing all the checks on the pushes, and that was (quite surprisingly) slower across the board.\n\nGiven that, I'm leaving the algorithm alone. It's good enough.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34406947/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34408564",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34408564",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34408564,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDA4NTY0",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T06:58:27Z",
    "updated_at": "2014-02-07T06:58:27Z",
    "body": "Possible extension (which I don't think should block an r+): return `enum MaybeOwned<'a> { Slice(&'a str), Owned(~str) }` that only allocates when absolutely required, i.e. basically have the `is_utf8` validation loop, and if it finds something invalid break, copy the (known good) string up until that point and fall back to the replacement character loop you've written here. If the validation loop passes, it can return `Slice(transmute(bytes))`, otherwise it allocates.\n\nAn possible (internal) optimisation generalising this: record the last known good character and only copy when necessary (i.e. when you see a invalid byte, copy up until that point, write the replacement character and record the current position).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34408564/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34408771",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34408771",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34408771,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDA4Nzcx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T07:03:45Z",
    "updated_at": "2014-02-07T07:03:45Z",
    "body": "(r=me with the few extra tests.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34408771/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34409076",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34409076",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34409076,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDA5MDc2",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T07:12:13Z",
    "updated_at": "2014-02-07T07:12:58Z",
    "body": "Thinking about it (warning: stream of thought): this really wants a rope-style data structure that stores segments of `&'a str` with counts of replacement characters between them, preferably as an iterator.\n\n(I guess we could actually have a \"long\" `\"\\uFFFD\\uFFFD...\\uFFFD\"` static string somewhere and just use slices out of this for the sequences of replacement characters, so the return value could literally be just an `Iterator<&'a str>`.)\n\nThe extra complications will probably offset the zero-allocations in terms of performance.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34409076/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34409285",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34409285",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34409285,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDA5Mjg1",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T07:18:02Z",
    "updated_at": "2014-02-07T07:18:02Z",
    "body": "@huonw `MaybeOwned` is an interesting suggestion, I've thought about something similar. The problem is it's just so unwieldy to use. Implementing `Str` on it would make things easier, though. Still, if memory usage is an issue, callers can always try `from_utf8()` first, which is pretty fast.\n\nI also considered doing what you suggested of noting the last known good character. It's probably worth testing, but given the results of my previous performance experiments, I wouldn't be surprised if this turns out to be no good as well. Still, it's probably worth a go.\n\nA rope-like data structure would be a nice approach for this, but of course that would be a separate implementation entirely as `str` is not a rope.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34409285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34410160",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34410160",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34410160,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDEwMTYw",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T07:38:50Z",
    "updated_at": "2014-02-07T07:39:32Z",
    "body": "High-level sketch:\n\n``` rust\nstruct LossyUTF8Iter<'a> { bytes: &'a [u8] }\nfn lossy_utf8(&'a [u8]) -> LossyUTF8Iter<'a> { /* obvious */ }\n\nimpl<'a> Iterator<&'a str> for LossyUTF8Iter<'a> {\n    fn next(&mut self) -> Option<&'a str> {\n        static REP: &'static str = \"\\uFFFD\\uFFFD\\uFFFD\\uFFFD\"; // some reasonable length\n\n        let good = /* validate first character */;\n\n        if good {\n            /* find first invalid byte... */\n\n            return Some(self.bytes.slice_to(index));\n        } else {\n            /* find first valid character (or \n               REP.char_len() invalid characters,\n               whichever comes first)... */\n\n            return Some(REP.slice_to(3 * replacement_count));\n        }\n    }\n}\n\n// helper, not necessary (and won't work yet)\nfn slice_if_possible<'a, It: Iterator<&'a str>>(it: It) -> MaybeOwned<'a> {\n     // if it has 1 element, return that; otherwise concatentate them all in a new alloc.\n}\n```\n\nThis is probably fast for long runs of valid or invalid bytes, but maybe not for many isolated invalid bytes. (I suppose it could also just immediately return `\"\\uFFFD\"` as soon as it finds a single invalid codepoint rather than try to batch them.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34410160/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34410241",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34410241",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34410241,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDEwMjQx",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T07:40:16Z",
    "updated_at": "2014-02-07T07:40:16Z",
    "body": "With the current algorithm:\n\n```\ntest str::bench::from_utf8_lossy_100_ascii                      ... bench:       246 ns/iter (+/- 12)\ntest str::bench::from_utf8_lossy_100_invalid                    ... bench:       299 ns/iter (+/- 10)\ntest str::bench::from_utf8_lossy_100_multibyte                  ... bench:       415 ns/iter (+/- 11)\ntest str::bench::from_utf8_lossy_invalid                        ... bench:        87 ns/iter (+/- 6)\n```\n\nIf I implement the \"last good char\" suggestion:\n\n```\ntest str::bench::from_utf8_lossy_100_ascii                      ... bench:       185 ns/iter (+/- 3)\ntest str::bench::from_utf8_lossy_100_invalid                    ... bench:       348 ns/iter (+/- 20)\ntest str::bench::from_utf8_lossy_100_multibyte                  ... bench:       235 ns/iter (+/- 32)\ntest str::bench::from_utf8_lossy_invalid                        ... bench:        98 ns/iter (+/- 1)\n```\n\nThe full invalid case is about 16% slower, but the valid cases are faster (in the case of the multibyte test, significantly faster) so I think it's a win.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34410241/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34410881",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34410881",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34410881,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDEwODgx",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T07:45:05Z",
    "updated_at": "2014-02-07T07:45:05Z",
    "body": "Just pushed the \"last good character\" version, along with a new test for 2-byte characters.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34410881/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34411415",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34411415",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34411415,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDExNDE1",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T07:48:54Z",
    "updated_at": "2014-02-07T07:48:54Z",
    "body": "@huonw I like the idea of the iterator, but it just doesn't seem terribly practical. I typically need to work with a full string, not an iterator of adjacent substrings. It's possibly worth exploring separately, but it would be a parallel implementation rather than a replacement for `from_utf8_lossy()`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34411415/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34411781",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34411781",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34411781,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDExNzgx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T07:51:34Z",
    "updated_at": "2014-02-07T07:51:55Z",
    "body": "With some sort of `-> ~str` (or equivalently, `-> MaybeOwned`) method it might not be so bad (e.g. if `FromIterator` was implemented). But yeah, it would require some finesse to be practical.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34411781/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34440612",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34440612",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34440612,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDQwNjEy",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T14:29:34Z",
    "updated_at": "2014-02-07T14:29:34Z",
    "body": "I wrote an [iterator version](https://gist.github.com/huonw/c84b1023cebed92398f1) and it's much faster when not allocating, and slightly-fast-to-a-lot-slower when allocating.\n\n|  | iter | iter_collect | str |\n| --- | --- | --- | --- |\n| from_utf8_lossy_100_ascii | 126 | 197 | 188 |\n| from_utf8_lossy_100_invalid | 300 | 371 | 384 |\n| from_utf8_lossy_100_multibyte | 162 | 232 | 227 |\n| from_utf8_lossy_invalid | 68 | 211 | 121 |\n\nAlso, I have a feeling that `Show for Display` should be doing something like\n\n``` rust\nif /* no padding */ {\n    for s in str::from_utf8_lossy(self.as_bytes()) {\n        f.buf.write_str(s)\n    }\n} else {\n    let mut collected = str::with_capacity(...);\n    // could micro-optimise the case when self is valid utf8 to \n    // (equivalent of) just f.pad(self)\n    for s in str::from_utf8_lossy(self.as_bytes()) { collected.push_str(s) }\n    f.pad(collected);\n}\n```\n\nand, if necessary, `ToStr` can delegate to `Show` via `format!(\"{}\", *self)`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34440612/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34481679",
    "html_url": "https://github.com/rust-lang/rust/pull/12062#issuecomment-34481679",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12062",
    "id": 34481679,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDgxNjc5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-07T18:03:30Z",
    "updated_at": "2014-02-07T18:03:30Z",
    "body": "@huonw The iterator version is interesting, I'm just concerned that nearly all callers are going to need to collect it, at which point it's no better than the str version. Pretty much the only time you can use the iterator version as-is is if you're immediately writing it to some sort of `Writer`, as in your sample `Show` impl.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34481679/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
