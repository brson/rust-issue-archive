[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43075726",
    "html_url": "https://github.com/rust-lang/rust/issues/14149#issuecomment-43075726",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14149",
    "id": 43075726,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDc1NzI2",
    "user": {
      "login": "SiegeLord",
      "id": 480550,
      "node_id": "MDQ6VXNlcjQ4MDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/480550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SiegeLord",
      "html_url": "https://github.com/SiegeLord",
      "followers_url": "https://api.github.com/users/SiegeLord/followers",
      "following_url": "https://api.github.com/users/SiegeLord/following{/other_user}",
      "gists_url": "https://api.github.com/users/SiegeLord/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SiegeLord/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SiegeLord/subscriptions",
      "organizations_url": "https://api.github.com/users/SiegeLord/orgs",
      "repos_url": "https://api.github.com/users/SiegeLord/repos",
      "events_url": "https://api.github.com/users/SiegeLord/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SiegeLord/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-14T12:50:07Z",
    "updated_at": "2014-05-14T12:50:07Z",
    "body": "Here's a code that compiles with an old rustc (e139b49eef62618f7894fde57a54b4d6642fbef8):\n\n``` rust\n#[crate_type=\"lib\"];\n#[crate_id=\"old\"];\n\nextern mod extra;\n\nuse extra::test::BenchHarness;\nuse std::rand::{weak_rng, Rng};\n\nuse std::cell::Cell;\n\n#[bench]\nfn vec_speed_vec2(bh: &mut BenchHarness) {\n    let mut rng = weak_rng();\n\n    let a = &Vector::new(rng.gen_vec(10).slice(0, 10));\n\n    bh.iter(|| {\n        for _ in range(0, 100)\n        {\n            let m = Multiplier::new(a, a);\n            for i in range(0u, 10)\n            {\n                unsafe\n                {\n                    a.unsafe_set(i, m.unsafe_get(i));\n                }\n            }\n        }\n\n        let mut sum = 0f32;\n        for i in range(0u, 10)\n        {\n            unsafe\n            {\n                sum += a.unsafe_get(i);\n            }\n        }\n        assert!(sum != 96.0);\n    })\n}\npub trait VectorGet\n{\n    unsafe fn unsafe_get(&self, idx: uint) -> f32;\n}\n\npub trait VectorSet\n{\n    unsafe fn unsafe_set(&self, idx: uint, val: f32);\n}\n\npub struct Vector\n{\n    data: ~[Cell<f32>]\n}\n\nimpl Vector\n{\n    pub fn new(data: &[f32]) -> Vector\n    {\n        Vector{ data: data.iter().map(|&v| Cell::new(v)).collect() }\n    }\n}\n\nimpl<'l>\nVectorGet for\n&'l Vector\n{\n    unsafe fn unsafe_get(&self, idx: uint) -> f32\n    {\n        (*self.data.as_slice().unsafe_ref(idx)).get()\n    }\n}\n\nimpl<'l>\nContainer for\n&'l Vector\n{\n    fn len(&self) -> uint\n    {\n        self.data.len()\n    }\n}\n\nimpl<'l>\nVectorSet for\nVector\n{\n    unsafe fn unsafe_set(&self, idx: uint, val: f32)\n    {\n        self.data.as_slice().unsafe_ref(idx).set(val);\n    }\n}\n\nimpl<'l>\nContainer for\nVector\n{\n    fn len(&self) -> uint\n    {\n        self.data.len()\n    }\n}\n\npub struct Multiplier<TA, TB>\n{\n    a: TA,\n    b: TB,\n}\n\nimpl<TA: Container,\n     TB: Container>\nMultiplier<TA, TB>\n{\n    pub fn new(a: TA, b: TB) -> Multiplier<TA, TB>\n    {\n        assert!(a.len() == b.len());\n        Multiplier{ a: a, b: b }\n    }\n}\n\nimpl<'l,\n     TA: VectorGet + Container,\n     TB: VectorGet + Container>\nVectorGet for\nMultiplier<TA, TB>\n{\n    unsafe fn unsafe_get(&self, idx: uint) -> f32\n    {\n        self.a.unsafe_get(idx) * self.b.unsafe_get(idx)\n    }\n}\n\nimpl<'l,\n     TA: Container,\n     TB: Container>\nContainer for Multiplier<TA, TB>\n{\n    fn len(&self) -> uint\n    {\n        self.a.len()\n    }\n}\n```\n\nThe benchmark results:\n\n```\nrunning 2 tests\ntest vec_speed_vec1 ... bench:       491 ns/iter (+/- 4)\ntest vec_speed_vec2 ... bench:       841 ns/iter (+/- 28)\n```\n\nThe `vec_speed_vec2` speed getting slower in the new rustc is my main issue (I guess the difference between vec1 and vec2 is a red-herring).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43075726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43087674",
    "html_url": "https://github.com/rust-lang/rust/issues/14149#issuecomment-43087674",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14149",
    "id": 43087674,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDg3Njc0",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-05-14T14:30:58Z",
    "updated_at": "2014-05-14T14:30:58Z",
    "body": "I'll try bisecting this later today.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/43087674/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/70774201",
    "html_url": "https://github.com/rust-lang/rust/issues/14149#issuecomment-70774201",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14149",
    "id": 70774201,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzc0MjAx",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-21T02:27:17Z",
    "updated_at": "2015-01-21T02:27:17Z",
    "body": "Never got arround to that... \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/70774201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/168988522",
    "html_url": "https://github.com/rust-lang/rust/issues/14149#issuecomment-168988522",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14149",
    "id": 168988522,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2ODk4ODUyMg==",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-01-05T12:37:17Z",
    "updated_at": "2016-01-05T12:38:26Z",
    "body": "This is more than a year old (nearly two), we've gone through many LLVM upgrades in that time, and it no longer reproduces---[an updated version](https://gist.github.com/huonw/9b5164c939b616d8c987) gives:\n\n```\ntest vec_speed_vec1 ... bench:         136 ns/iter (+/- 4)\ntest vec_speed_vec2 ... bench:         137 ns/iter (+/- 6)\n```\n\nSo, closing.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/168988522/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
