[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130418686",
    "html_url": "https://github.com/rust-lang/rust/issues/27715#issuecomment-130418686",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27715",
    "id": 130418686,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDQxODY4Ng==",
    "user": {
      "login": "nagisa",
      "id": 679122,
      "node_id": "MDQ6VXNlcjY3OTEyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nagisa",
      "html_url": "https://github.com/nagisa",
      "followers_url": "https://api.github.com/users/nagisa/followers",
      "following_url": "https://api.github.com/users/nagisa/following{/other_user}",
      "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions",
      "organizations_url": "https://api.github.com/users/nagisa/orgs",
      "repos_url": "https://api.github.com/users/nagisa/repos",
      "events_url": "https://api.github.com/users/nagisa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nagisa/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-12T19:28:27Z",
    "updated_at": "2015-08-12T19:28:36Z",
    "body": "This reminds me of a [`Reader` monad](http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html) and its `local` method a lot. Specialisation of this monad to only work in TLS context sounds really obscure to me. Could this be generalised?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130418686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130422666",
    "html_url": "https://github.com/rust-lang/rust/issues/27715#issuecomment-130422666",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27715",
    "id": 130422666,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDQyMjY2Ng==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-12T19:39:22Z",
    "updated_at": "2015-08-12T19:39:22Z",
    "body": "The stabilization of scoped TLS precludes the safe implementation of couroutines/fibers/green threads in external libraries.\n\nAdmittedly there are also problems with normal TLS, but they seem less terminal, and can probably be limited to causing unexpected behaviour or panics rather than outright memory unsafety with some changes.\n\nPossible solutions:\n- Formalize the notion of a call-stack/context within the standard library, and provide unsafe methods to \"swap\" the current context with another. External libraries can then build safe interfaces around this. Rename \"scoped thread-local storage\" to \"scoped context-local storage\" or similar.\n  Either do the same thing for normal TLS, or also provide the means for external libraries to detect whether code is currently executing within a \"LocalKey::with()\" call, so that they can panic if a context switch occurs there.\n- Keep a per-thread token which is initially left unset. Each type of threading is given a unique token, external libraries being able to acquire unique tokens from the standard library. Once a thread's token has been set, it can never be changed, and attempting to do so will cause it to panic.\n  Any use of TLS will attempt to set the thread's token to \"threaded-only\". Similarly, for any use of coroutines/fibers, the external library must attempt to set its own special token.\n- Make all libraries (including std) which use TLS be effectively generic over the threading model. Only when the code is compiled into an executable is the threading model fixed. If the final executable uses only native threads, then all TLS use gets compiled down to fast, native TLS. If the final program uses fibers, then use fiber local storage. One way this could be achieved is by leaving undefined symbols in all libraries which are only supplied when the final program is linked.\n  This would preclude the use of multiple threading models within the same program.\n- Introduce some form of static analysis and a set of attributes, such that the compiler can prove at compile-time that different threading-models don't mix.\n\nAll of the options have significant downsides, either due to complexity or runtime performance.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130422666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/176618394",
    "html_url": "https://github.com/rust-lang/rust/issues/27715#issuecomment-176618394",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27715",
    "id": 176618394,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NjYxODM5NA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-01-29T07:25:19Z",
    "updated_at": "2016-01-29T07:25:19Z",
    "body": ":bell: This issue is now entering its cycle **final comment period** to be deprecation in 1.8 :bell:\n\nScoped TLS can currently be built externally on crates.io if truly necessary, and otherwise it seems to be getting far less usage than originally anticipated.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/176618394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/182016364",
    "html_url": "https://github.com/rust-lang/rust/issues/27715#issuecomment-182016364",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27715",
    "id": 182016364,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4MjAxNjM2NA==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-02-09T19:19:45Z",
    "updated_at": "2016-02-09T19:19:45Z",
    "body": "Even though I was an initial advocate for (and proposer of) scoped TLS, I think it's good to deprecate it. One major limitation that I didn't fully appreciate at the time is that the `T` of the variable must meet `T: 'static`, which tends to rule out a lot of the uses I've had in mind. At least without some unsafety. e.g., in the compiler we do some tricks to put a `&ty::ctxt<'tcx>` in there.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/182016364/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/189028218",
    "html_url": "https://github.com/rust-lang/rust/issues/27715#issuecomment-189028218",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27715",
    "id": 189028218,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4OTAyODIxOA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-02-25T23:13:39Z",
    "updated_at": "2016-02-25T23:13:39Z",
    "body": "The libs team discussed this during triage yesterday and the conclusion was to **deprecate**\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/189028218/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
