[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68930490",
    "html_url": "https://github.com/rust-lang/rust/issues/20659#issuecomment-68930490",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20659",
    "id": 68930490,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTMwNDkw",
    "user": {
      "login": "alexchandel",
      "id": 637714,
      "node_id": "MDQ6VXNlcjYzNzcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/637714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexchandel",
      "html_url": "https://github.com/alexchandel",
      "followers_url": "https://api.github.com/users/alexchandel/followers",
      "following_url": "https://api.github.com/users/alexchandel/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexchandel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexchandel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexchandel/subscriptions",
      "organizations_url": "https://api.github.com/users/alexchandel/orgs",
      "repos_url": "https://api.github.com/users/alexchandel/repos",
      "events_url": "https://api.github.com/users/alexchandel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexchandel/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-06T20:44:57Z",
    "updated_at": "2015-01-06T20:44:57Z",
    "body": "What's bizarre, if you just comment out the call to `exit`, then `%rax` is no longer saved.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68930490/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68935402",
    "html_url": "https://github.com/rust-lang/rust/issues/20659#issuecomment-68935402",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20659",
    "id": 68935402,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTM1NDAy",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-06T21:18:04Z",
    "updated_at": "2015-01-06T21:18:04Z",
    "body": "I'm confused about the bug here. Are you saying that `%rax` is being saved unnecessarily and so we're being unnecessarily inefficient?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68935402/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68937767",
    "html_url": "https://github.com/rust-lang/rust/issues/20659#issuecomment-68937767",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20659",
    "id": 68937767,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTM3NzY3",
    "user": {
      "login": "alexchandel",
      "id": 637714,
      "node_id": "MDQ6VXNlcjYzNzcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/637714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexchandel",
      "html_url": "https://github.com/alexchandel",
      "followers_url": "https://api.github.com/users/alexchandel/followers",
      "following_url": "https://api.github.com/users/alexchandel/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexchandel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexchandel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexchandel/subscriptions",
      "organizations_url": "https://api.github.com/users/alexchandel/orgs",
      "repos_url": "https://api.github.com/users/alexchandel/repos",
      "events_url": "https://api.github.com/users/alexchandel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexchandel/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-06T21:33:31Z",
    "updated_at": "2015-01-06T21:33:31Z",
    "body": "Also that, but this breaks assumptions about codegen. Even using a compiler plugin to tag this function with the \"naked\" LLVM attribute, %rax is still pushed and popped at the beginning and end of the function.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68937767/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/168803134",
    "html_url": "https://github.com/rust-lang/rust/issues/20659#issuecomment-168803134",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20659",
    "id": 168803134,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2ODgwMzEzNA==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-01-04T20:49:11Z",
    "updated_at": "2016-01-04T20:49:11Z",
    "body": "Triage: updated code.\n\n``` rust\n#![feature(asm)]\n#![feature(core_intrinsics)]\n\nuse std::intrinsics::offset;\n\npub type char_t = i8;\npub type int_t = i32;\n\npub static mut ARGC: usize = 0;\npub static mut ARGV: *const *const char_t = 0 as *const *const char_t;\npub static mut ENVC: usize = 0;\npub static mut ENVP: *const *const char_t = 0 as *const *const char_t;\n\nextern \"C\" {\n    fn main(argc: int_t,\n            argv: *const *const char_t,\n            envp: *const *const char_t) -> int_t;\n    fn exit(status: int_t) -> !;\n}\n\n#[no_mangle]\npub unsafe fn start() {\n    asm!(\"  mov (%rsp), $0\n            lea +8(%rsp), $1\"\n            : \"=r\"(ARGC), \"=r\"(ARGV) ::: \"volatile\");\n\n    ENVP = offset(ARGV, ARGC as isize + 1);\n\n    let mut envc: *const *const char_t = ENVP;\n    while (*envc as usize != 0) {\n        envc = offset(envc, 1); // increases by one pointer size\n    }\n    ENVC = (envc as usize - ENVP as usize - 1);\n\n    let status = main(ARGC as int_t, ARGV, ENVP);\n\n    exit(status);\n}\n```\n\nThe output is slightly different here, but not in a way that matters:\n\n``` text\ntest.o:     file format elf64-x86-64\n\n\nDisassembly of section .text.start:\n\n0000000000000000 <start>:\n   0:   50                      push   %rax\n   1:   48 8b 3c 24             mov    (%rsp),%rdi\n   5:   48 8d 74 24 08          lea    0x8(%rsp),%rsi\n   a:   48 8b 05 00 00 00 00    mov    0x0(%rip),%rax        # 11 <start+0x11>\n  11:   48 89 38                mov    %rdi,(%rax)\n  14:   48 8b 05 00 00 00 00    mov    0x0(%rip),%rax        # 1b <start+0x1b>\n  1b:   48 89 30                mov    %rsi,(%rax)\n  1e:   48 8d 54 fe 08          lea    0x8(%rsi,%rdi,8),%rdx\n  23:   48 8b 05 00 00 00 00    mov    0x0(%rip),%rax        # 2a <start+0x2a>\n  2a:   48 89 10                mov    %rdx,(%rax)\n  2d:   48 8d 04 fe             lea    (%rsi,%rdi,8),%rax\n  31:   66 66 66 66 66 66 2e    data16 data16 data16 data16 data16 nopw %cs:0x0(%rax,%rax,1)\n  38:   0f 1f 84 00 00 00 00 \n  3f:   00 \n  40:   48 83 78 08 00          cmpq   $0x0,0x8(%rax)\n  45:   48 8d 40 08             lea    0x8(%rax),%rax\n  49:   75 f5                   jne    40 <start+0x40>\n  4b:   48 ff c8                dec    %rax\n  4e:   48 29 d0                sub    %rdx,%rax\n  51:   48 8b 0d 00 00 00 00    mov    0x0(%rip),%rcx        # 58 <start+0x58>\n  58:   48 89 01                mov    %rax,(%rcx)\n  5b:   e8 00 00 00 00          callq  60 <start+0x60>\n  60:   89 c7                   mov    %eax,%edi\n  62:   e8 00 00 00 00          callq  67 <start+0x67>\n\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/168803134/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/298134584",
    "html_url": "https://github.com/rust-lang/rust/issues/20659#issuecomment-298134584",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20659",
    "id": 298134584,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODEzNDU4NA==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-04-29T00:27:49Z",
    "updated_at": "2017-04-29T00:27:49Z",
    "body": "Disassembly below. I think this means this is fixed, since I don't see a `push %rax` at the top, but there is one towards the middle of the code, and the assembly on macOS and linux is basically the same. As such, I'm going to close this, but please do reopen if that's not the case.\r\n\r\n```\r\ntest.o:     file format elf64-x86-64\r\n\r\n\r\nDisassembly of section .text.start:\r\n\r\n0000000000000000 <start>:\r\n   0:\t48 8b 3c 24          \tmov    (%rsp),%rdi\r\n   4:\t48 8d 74 24 08       \tlea    0x8(%rsp),%rsi\r\n   9:\t48 8b 05 00 00 00 00 \tmov    0x0(%rip),%rax        # 10 <start+0x10>\r\n  10:\t48 89 38             \tmov    %rdi,(%rax)\r\n  13:\t48 8b 05 00 00 00 00 \tmov    0x0(%rip),%rax        # 1a <start+0x1a>\r\n  1a:\t48 89 30             \tmov    %rsi,(%rax)\r\n  1d:\t48 8d 54 fe 08       \tlea    0x8(%rsi,%rdi,8),%rdx\r\n  22:\t48 8b 05 00 00 00 00 \tmov    0x0(%rip),%rax        # 29 <start+0x29>\r\n  29:\t48 89 10             \tmov    %rdx,(%rax)\r\n  2c:\t48 8d 04 fe          \tlea    (%rsi,%rdi,8),%rax\r\n  30:\t48 83 78 08 00       \tcmpq   $0x0,0x8(%rax)\r\n  35:\t48 8d 40 08          \tlea    0x8(%rax),%rax\r\n  39:\t75 f5                \tjne    30 <start+0x30>\r\n  3b:\t50                   \tpush   %rax\r\n  3c:\t48 ff c8             \tdec    %rax\r\n  3f:\t48 29 d0             \tsub    %rdx,%rax\r\n  42:\t48 8b 0d 00 00 00 00 \tmov    0x0(%rip),%rcx        # 49 <start+0x49>\r\n  49:\t48 89 01             \tmov    %rax,(%rcx)\r\n  4c:\te8 00 00 00 00       \tcallq  51 <start+0x51>\r\n  51:\t89 c7                \tmov    %eax,%edi\r\n  53:\te8 00 00 00 00       \tcallq  58 <start+0x58>\r\n```",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/298134584/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
