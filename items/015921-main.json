{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/15921",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/15921/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/15921/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/15921/events",
  "html_url": "https://github.com/rust-lang/rust/pull/15921",
  "id": 38542384,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTg3ODM5NDg=",
  "number": 15921,
  "title": "Improve usage of lifetime intrinsics in match expressions",
  "user": {
    "login": "dotdash",
    "id": 230962,
    "node_id": "MDQ6VXNlcjIzMDk2Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dotdash",
    "html_url": "https://github.com/dotdash",
    "followers_url": "https://api.github.com/users/dotdash/followers",
    "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
    "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
    "organizations_url": "https://api.github.com/users/dotdash/orgs",
    "repos_url": "https://api.github.com/users/dotdash/repos",
    "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dotdash/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 0,
  "created_at": "2014-07-23T15:47:55Z",
  "updated_at": "2015-02-04T12:42:23Z",
  "closed_at": "2014-07-24T11:41:17Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/15921",
    "html_url": "https://github.com/rust-lang/rust/pull/15921",
    "diff_url": "https://github.com/rust-lang/rust/pull/15921.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/15921.patch",
    "merged_at": "2014-07-24T11:41:23Z"
  },
  "body": "The allocas used in match expression currently don't get good lifetime\nmarkers, in fact they only get lifetime start markers, because their\nlifetimes don't match to cleanup scopes.\n\nWhile the bindings themselves are bog standard and just need a matching\npair of start and end markers, they might need them twice, once for a\nguard clause and once for the match body.\n\nThe __llmatch alloca OTOH needs a single lifetime start marker, but\nwhen there's a guard clause, it needs two end markers, because its\nlifetime ends either when the guard doesn't match or after the match\nbody.\n\nWith these intrinsics in place, LLVM can now, for example, optimize\ncode like this:\n\n``` rust\nenum E {\n  A1(int),\n  A2(int),\n  A3(int),\n  A4(int),\n}\n\npub fn variants(x: E) {\n  match x {\n    A1(m) => bar(&m),\n    A2(m) => bar(&m),\n    A3(m) => bar(&m),\n    A4(m) => bar(&m),\n  }\n}\n```\n\nTo a single call to bar, using only a single stack slot. It still fails\nto eliminate some of checks.\n\n``` gas\n.Ltmp5:\n    .cfi_def_cfa_offset 16\n    movb    (%rdi), %al\n    testb   %al, %al\n    je  .LBB3_5\n    movzbl  %al, %eax\n    cmpl    $1, %eax\n    je  .LBB3_5\n    cmpl    $2, %eax\n.LBB3_5:\n    movq    8(%rdi), %rax\n    movq    %rax, (%rsp)\n    leaq    (%rsp), %rdi\n    callq   _ZN3bar20hcb7a0d8be8e17e37daaE@PLT\n    popq    %rax\n    retq\n```\n\nRefs #15665\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/15921/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/15921/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
