{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/19274",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/19274/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/19274/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/19274/events",
  "html_url": "https://github.com/rust-lang/rust/pull/19274",
  "id": 49933647,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MjQ5NTg0NTc=",
  "number": 19274,
  "title": "std: Rewrite the `sync` module",
  "user": {
    "login": "alexcrichton",
    "id": 64996,
    "node_id": "MDQ6VXNlcjY0OTk2",
    "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexcrichton",
    "html_url": "https://github.com/alexcrichton",
    "followers_url": "https://api.github.com/users/alexcrichton/followers",
    "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
    "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
    "repos_url": "https://api.github.com/users/alexcrichton/repos",
    "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 11,
  "created_at": "2014-11-24T19:49:54Z",
  "updated_at": "2014-12-05T23:50:45Z",
  "closed_at": "2014-12-05T22:46:48Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/19274",
    "html_url": "https://github.com/rust-lang/rust/pull/19274",
    "diff_url": "https://github.com/rust-lang/rust/pull/19274.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/19274.patch",
    "merged_at": "2014-12-05T22:46:48Z"
  },
  "body": "This commit is a reimplementation of `std::sync` to be based on the\nsystem-provided primitives wherever possible. The previous implementation was\nfundamentally built on top of channels, and as part of the runtime reform it has\nbecome clear that this is not the level of abstraction that the standard level\nshould be providing. This rewrite aims to provide as thin of a shim as possible\non top of the system primitives in order to make them safe.\n\nThe overall interface of the `std::sync` module has in general not changed, but\nthere are a few important distinctions, highlighted below:\n- The condition variable type, `Condvar`, has been separated out of a `Mutex`.\n  A condition variable is now an entirely separate type. This separation\n  benefits users who only use one mutex, and provides a clearer distinction of\n  who's responsible for managing condition variables (the application).\n- All of `Condvar`, `Mutex`, and `RWLock` are now directly built on top of\n  system primitives rather than using a custom implementation. The `Once`,\n  `Barrier`, and `Semaphore` types are still built upon these abstractions of\n  the system primitives.\n- The `Condvar`, `Mutex`, and `RWLock` types all have a new static type and\n  constant initializer corresponding to them. These are provided primarily for C\n  FFI interoperation, but are often useful to otherwise simply have a global\n  lock. The types, however, will leak memory unless `destroy()` is called on\n  them, which is clearly documented.\n- The fundamental architecture of this design is to provide two separate layers.\n  The first layer is that exposed by `sys_common` which is a cross-platform\n  bare-metal abstraction of the system synchronization primitives. No attempt is\n  made at making this layer safe, and it is quite unsafe to use! It is currently\n  not exported as part of the API of the standard library, but the stabilization\n  of the `sys` module will ensure that these will be exposed in time. The\n  purpose of this layer is to provide the core cross-platform abstractions if\n  necessary to implementors.\n  \n  The second layer is the layer provided by `std::sync` which is intended to be\n  the thinnest possible layer on top of `sys_common` which is entirely safe to\n  use. There are a few concerns which need to be addressed when making these\n  system primitives safe:\n  - Once used, the OS primitives can never be **moved**. This means that they\n    essentially need to have a stable address. The static primitives use\n    `&'static self` to enforce this, and the non-static primitives all use a\n    `Box` to provide this guarantee.\n  - Poisoning is leveraged to ensure that invalid data is not accessible from\n    other tasks after one has panicked.\n  \n  In addition to these overall blanket safety limitations, each primitive has a\n  few restrictions of its own:\n  - Mutexes and rwlocks can only be unlocked from the same thread that they\n    were locked by. This is achieved through RAII lock guards which cannot be\n    sent across threads.\n  - Mutexes and rwlocks can only be unlocked if they were previously locked.\n    This is achieved by not exposing an unlocking method.\n  - A condition variable can only be waited on with a locked mutex. This is\n    achieved by requiring a `MutexGuard` in the `wait()` method.\n  - A condition variable cannot be used concurrently with more than one mutex.\n    This is guaranteed by dynamically binding a condition variable to\n    precisely one mutex for its entire lifecycle. This restriction may be able\n    to be relaxed in the future (a mutex is unbound when no threads are\n    waiting on the condvar), but for now it is sufficient to guarantee safety.\n- Condvars support timeouts for their blocking operations. The\n  implementation for these operations is provided by the system.\n\nDue to the modification of the `Condvar` API, removal of the `std::sync::mutex`\nAPI, and reimplementation, this is a breaking change. Most code should be fairly\neasy to port using the examples in the documentation of these primitives.\n\n[breaking-change]\n\nCloses #17094\nCloses #18003\n",
  "closed_by": {
    "login": "alexcrichton",
    "id": 64996,
    "node_id": "MDQ6VXNlcjY0OTk2",
    "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexcrichton",
    "html_url": "https://github.com/alexcrichton",
    "followers_url": "https://api.github.com/users/alexcrichton/followers",
    "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
    "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
    "repos_url": "https://api.github.com/users/alexcrichton/repos",
    "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/19274/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/19274/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
