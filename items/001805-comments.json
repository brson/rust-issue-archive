[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3906607",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3906607",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3906607,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDY2MDc=",
    "user": {
      "login": "kud1ing",
      "id": 391975,
      "node_id": "MDQ6VXNlcjM5MTk3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/391975?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kud1ing",
      "html_url": "https://github.com/kud1ing",
      "followers_url": "https://api.github.com/users/kud1ing/followers",
      "following_url": "https://api.github.com/users/kud1ing/following{/other_user}",
      "gists_url": "https://api.github.com/users/kud1ing/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kud1ing/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kud1ing/subscriptions",
      "organizations_url": "https://api.github.com/users/kud1ing/orgs",
      "repos_url": "https://api.github.com/users/kud1ing/repos",
      "events_url": "https://api.github.com/users/kud1ing/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kud1ing/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-10T14:15:17Z",
    "updated_at": "2012-02-10T14:16:58Z",
    "body": "I think we will end up with wide use of those unsafe shortcuts, effectively replacing compile time checks with runtime errors.\n\nThis causes great pain in the Haskell world.\nSee http://www.reddit.com/r/haskell/comments/lf71l/deprecate_preludehead_and_partial_functions/\n\nThere was some related discussion in #1105 \n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3906607/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3907384",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3907384",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3907384,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDczODQ=",
    "user": {
      "login": "marijnh",
      "id": 144427,
      "node_id": "MDQ6VXNlcjE0NDQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marijnh",
      "html_url": "https://github.com/marijnh",
      "followers_url": "https://api.github.com/users/marijnh/followers",
      "following_url": "https://api.github.com/users/marijnh/following{/other_user}",
      "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions",
      "organizations_url": "https://api.github.com/users/marijnh/orgs",
      "repos_url": "https://api.github.com/users/marijnh/repos",
      "events_url": "https://api.github.com/users/marijnh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marijnh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-10T15:09:36Z",
    "updated_at": "2012-02-10T15:09:36Z",
    "body": "Rust is not Haskell, though. Our index `[x]` operator, for example, is also not guaranteed to succeed.\n\nI'd be very happy if we had a way to make things like this safe without imposing a lot of extra load on the programmer, but we don't at the moment, and having preconditions on stdlib functions will just make people work around those in ways that are no safer than the unsafe version of the function would be. (All of the three snippets I gave above still cause a run-time failure when the vector is empty. No safety is gained.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3907384/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3909582",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3909582",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3909582,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDk1ODI=",
    "user": {
      "login": "kud1ing",
      "id": 391975,
      "node_id": "MDQ6VXNlcjM5MTk3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/391975?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kud1ing",
      "html_url": "https://github.com/kud1ing",
      "followers_url": "https://api.github.com/users/kud1ing/followers",
      "following_url": "https://api.github.com/users/kud1ing/following{/other_user}",
      "gists_url": "https://api.github.com/users/kud1ing/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kud1ing/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kud1ing/subscriptions",
      "organizations_url": "https://api.github.com/users/kud1ing/orgs",
      "repos_url": "https://api.github.com/users/kud1ing/repos",
      "events_url": "https://api.github.com/users/kud1ing/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kud1ing/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-10T17:03:02Z",
    "updated_at": "2012-02-10T17:04:09Z",
    "body": "You are right, the operator `[x]` should be made safe using Typestate .\n\nI agree, Typestate needs to be more developer-friendly.\nMaking it easier to create runtime errors is a step backwards imho.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3909582/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3913267",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3913267",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3913267,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTMyNjc=",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-10T19:58:38Z",
    "updated_at": "2012-02-10T19:58:38Z",
    "body": "I agree with @Lenny222 that the [] operator should be made safe (though we don't have good infrastructure to do that right now).\n\nThe reason that typestate guarantees are useful is that it gives the programmer the tools to guarantee statically that certain errors won't occur at runtime. It's true that if you just insert a check before every call, it could fail, and you're just moving the error to a different place (though even in that case, I'd argue that it's useful to have to think about error conditions, which are easy to ignore when the error handling is in the callee). But that would be un-Rust-like, just like using unsafe pointers all over the place is un-Rust-like. If functions are annotated properly with their preconditions and (once implemented) postconditions, then checks should be sparse.\n\nThere are lots of improvements we could make to typestate, but I'd prefer we not just give up on it because it's not perfect right now. In my opinion, we need to be using typestate within rustc so that we can work out the bugs, not take shortcuts around it.\n\nRather than simply making it easier to be unsafe, let's talk about syntax / semantics that we could introduce to make typestate less cumbersome in the specific cases you've brought up. That's my preference, anyway. For example, no one should be calling last on a vector that could be empty, and we can use functions like may and maybe in the option module to make it easier to handle the empty case. Explicit alts should never be necessary for that. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3913267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3913292",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3913292",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3913292,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTMyOTI=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-10T20:01:06Z",
    "updated_at": "2012-02-10T20:01:06Z",
    "body": "My opinion is that we should either make a big push to make typestate useful or remove it from all core/std functions.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3913292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3913314",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3913314",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3913314,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTMzMTQ=",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-10T20:03:23Z",
    "updated_at": "2012-02-10T20:03:23Z",
    "body": "I'd be happy to work on making it useful, but I would need feedback from other people about how to do that, and since I am working on classes right now, we would want to discuss what our priorities are.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3913314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3914259",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3914259",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3914259,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTQyNTk=",
    "user": {
      "login": "killerswan",
      "id": 195060,
      "node_id": "MDQ6VXNlcjE5NTA2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/195060?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/killerswan",
      "html_url": "https://github.com/killerswan",
      "followers_url": "https://api.github.com/users/killerswan/followers",
      "following_url": "https://api.github.com/users/killerswan/following{/other_user}",
      "gists_url": "https://api.github.com/users/killerswan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/killerswan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/killerswan/subscriptions",
      "organizations_url": "https://api.github.com/users/killerswan/orgs",
      "repos_url": "https://api.github.com/users/killerswan/repos",
      "events_url": "https://api.github.com/users/killerswan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/killerswan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-10T21:04:55Z",
    "updated_at": "2012-02-10T21:04:55Z",
    "body": "Hmm, I need to play more with handling failures...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3914259/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916700",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3916700",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3916700,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTY3MDA=",
    "user": {
      "login": "vlasovskikh",
      "id": 126891,
      "node_id": "MDQ6VXNlcjEyNjg5MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vlasovskikh",
      "html_url": "https://github.com/vlasovskikh",
      "followers_url": "https://api.github.com/users/vlasovskikh/followers",
      "following_url": "https://api.github.com/users/vlasovskikh/following{/other_user}",
      "gists_url": "https://api.github.com/users/vlasovskikh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vlasovskikh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vlasovskikh/subscriptions",
      "organizations_url": "https://api.github.com/users/vlasovskikh/orgs",
      "repos_url": "https://api.github.com/users/vlasovskikh/repos",
      "events_url": "https://api.github.com/users/vlasovskikh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vlasovskikh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-10T23:48:52Z",
    "updated_at": "2012-02-10T23:48:52Z",
    "body": "If `myvec` is a return value of some `fn f(...)`, then Issue #586 might help here by moving the problem to a potential library code. `f(...)` should narrow the set of possible return values using post-conditions:\n\n```\nfn f<T>(...) -> [T]: is_not_empty(*) { ... }\n\nlet myvec = f(...);\nvec::last_total(myvec);\n```\n\nIf `myvec` is assigned a local (vector) literal expression (maybe even a reasonably simple expression that requires evaluation), then it is possible to evaluate the `pure fn` predicate statically and implicity (assuming it doesn't contain `unchecked` blocks):\n\n```\nlet myvec = [1, 2, 3];\n...\nvec::last_total(myvec);\n```\n\nIf `myvec` is a fn parameter, then there is no problem (typestate predicates for fn params).\n\nOtherwise there is a problem, and we have to use an explicit typestate or an `option` check or an unsafe `[]` operator.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916700/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916747",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3916747",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3916747,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTY3NDc=",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-10T23:54:23Z",
    "updated_at": "2012-02-10T23:54:23Z",
    "body": "@vlasovskikh The problem with \"evaluate the pure fn predicate statically and implicity\" is that it violates one of our guiding principles behind typestate, which is that the compiler doesn't take advantage of any information about the semantics of the predicates -- predicates are opaque. We could consider special-casing some knowledge about vector literals (and integer literals, and...) but this would be a new iteration on the design. The question has certainly arisen before.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916747/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916866",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3916866",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3916866,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTY4NjY=",
    "user": {
      "login": "vlasovskikh",
      "id": 126891,
      "node_id": "MDQ6VXNlcjEyNjg5MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vlasovskikh",
      "html_url": "https://github.com/vlasovskikh",
      "followers_url": "https://api.github.com/users/vlasovskikh/followers",
      "following_url": "https://api.github.com/users/vlasovskikh/following{/other_user}",
      "gists_url": "https://api.github.com/users/vlasovskikh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vlasovskikh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vlasovskikh/subscriptions",
      "organizations_url": "https://api.github.com/users/vlasovskikh/orgs",
      "repos_url": "https://api.github.com/users/vlasovskikh/repos",
      "events_url": "https://api.github.com/users/vlasovskikh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vlasovskikh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T00:06:48Z",
    "updated_at": "2012-02-11T00:06:48Z",
    "body": "@catamorphism The compiler doesn't have to have any special knowledge about predicate semantics here. It should only evaluate (some of) them as regular Rust code, but at compile-time.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916866/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916887",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3916887",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3916887,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTY4ODc=",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T00:08:44Z",
    "updated_at": "2012-02-11T00:08:44Z",
    "body": "@vlasovskikh Evaluating code is pretty much the epitome of knowing what its semantics are -- if you can evaluate it, you know its semantics completely :-)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916887/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916904",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3916904",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3916904,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTY5MDQ=",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T00:10:34Z",
    "updated_at": "2012-02-11T00:10:46Z",
    "body": "In general, it would be dodgy to evaluate any code at compile-time without some special-case hints or even tighter restrictions than we already have. `pure fn` predicates are (currently) not required to be terminating, so evaluating calls to them could always potentially make the typechecker non-terminating.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916904/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916993",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3916993",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3916993,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTY5OTM=",
    "user": {
      "login": "vlasovskikh",
      "id": 126891,
      "node_id": "MDQ6VXNlcjEyNjg5MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vlasovskikh",
      "html_url": "https://github.com/vlasovskikh",
      "followers_url": "https://api.github.com/users/vlasovskikh/followers",
      "following_url": "https://api.github.com/users/vlasovskikh/following{/other_user}",
      "gists_url": "https://api.github.com/users/vlasovskikh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vlasovskikh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vlasovskikh/subscriptions",
      "organizations_url": "https://api.github.com/users/vlasovskikh/orgs",
      "repos_url": "https://api.github.com/users/vlasovskikh/repos",
      "events_url": "https://api.github.com/users/vlasovskikh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vlasovskikh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T00:18:19Z",
    "updated_at": "2012-02-11T00:18:19Z",
    "body": "@catamorphism Yes, I meant that no special-case hints were needed. Why `pure fn`'s without `unchecked` blocks can be non-terminating?\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3916993/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3917010",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3917010",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3917010,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTcwMTA=",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T00:20:52Z",
    "updated_at": "2012-02-11T00:20:52Z",
    "body": "Why not? The point of `pure fn` is to disallow non-referentially-transparent behavior. A nonterminating function (that doesn't have observable effects) is perfectly referentially transparent.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3917010/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3917198",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3917198",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3917198,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTcxOTg=",
    "user": {
      "login": "vlasovskikh",
      "id": 126891,
      "node_id": "MDQ6VXNlcjEyNjg5MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vlasovskikh",
      "html_url": "https://github.com/vlasovskikh",
      "followers_url": "https://api.github.com/users/vlasovskikh/followers",
      "following_url": "https://api.github.com/users/vlasovskikh/following{/other_user}",
      "gists_url": "https://api.github.com/users/vlasovskikh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vlasovskikh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vlasovskikh/subscriptions",
      "organizations_url": "https://api.github.com/users/vlasovskikh/orgs",
      "repos_url": "https://api.github.com/users/vlasovskikh/repos",
      "events_url": "https://api.github.com/users/vlasovskikh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vlasovskikh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T00:44:24Z",
    "updated_at": "2012-02-11T00:44:24Z",
    "body": "I've read in the docs that self-recusive calls, higher-order params and non-pure calls are not allowed in a `pure fn`. I erroneously concluded, that it was impossible to use a general recursion (Y-combinator) inside `pure fn` and that `pure fn`s always halted. But I forgot about mutual recursion and `while` loops :)\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3917198/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3917246",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3917246",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3917246,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTcyNDY=",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T00:48:41Z",
    "updated_at": "2012-02-11T00:48:41Z",
    "body": "The documentation about that is likely to be full of lies right now (because I wrote it) -- the rules for what's allows in a `pure fn` are kind of in flux, and have been for a while. It's not our intent to disallow non-terminating pure fns, though.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3917246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3919431",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3919431",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3919431,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTk0MzE=",
    "user": {
      "login": "marijnh",
      "id": 144427,
      "node_id": "MDQ6VXNlcjE0NDQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marijnh",
      "html_url": "https://github.com/marijnh",
      "followers_url": "https://api.github.com/users/marijnh/followers",
      "following_url": "https://api.github.com/users/marijnh/following{/other_user}",
      "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions",
      "organizations_url": "https://api.github.com/users/marijnh/orgs",
      "repos_url": "https://api.github.com/users/marijnh/repos",
      "events_url": "https://api.github.com/users/marijnh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marijnh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T08:20:08Z",
    "updated_at": "2012-02-16T01:12:43Z",
    "body": "Even when typestate becomes more powerful, annotating one's programs with the right pre- and post-conditions is bound to be a lot of work. Some programs will want to do this to gain extra safety, **but** a lot of programs won't need to pay this price -- they are either prototypes, or something that is just not very critical. I think forcing every Rust programmer into the typestate straitjacket by integrating typestate heavily into the stdlib is not a good idea.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3919431/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3919553",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3919553",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3919553,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTk1NTM=",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T08:52:49Z",
    "updated_at": "2012-02-11T08:52:49Z",
    "body": "@marijnh What's your threshold for easiness? That is, how would you characterize how easy it would have to be to annotate programs with preconditions and postconditions before you would want to allow typestate in the stdlib? \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3919553/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3919597",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3919597",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3919597,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTk1OTc=",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T09:06:10Z",
    "updated_at": "2012-02-11T09:06:10Z",
    "body": "Also, independently of that question, I was under the impression that one of the things `claim` was for was to help with prototyping -- you can always get out of having to do a check by using a claim instead. It still requires the programmer to write down claim statements explicitly, but I had been under the impression that this was one of the core principles of Rust: you can play fast and loose, but you have to declare explicitly that you intend to play fast and loose. Rust is for writing reliable software, and there are many other languages for prototyping or writing \"not very crtitical\" code; in my opinion, it's useful to encourage programmers to get it right the first time.\n\nBut a lof of this is just my impression, and I'd like to hear comments from other people.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3919597/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3920248",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3920248",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3920248,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjAyNDg=",
    "user": {
      "login": "killerswan",
      "id": 195060,
      "node_id": "MDQ6VXNlcjE5NTA2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/195060?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/killerswan",
      "html_url": "https://github.com/killerswan",
      "followers_url": "https://api.github.com/users/killerswan/followers",
      "following_url": "https://api.github.com/users/killerswan/following{/other_user}",
      "gists_url": "https://api.github.com/users/killerswan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/killerswan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/killerswan/subscriptions",
      "organizations_url": "https://api.github.com/users/killerswan/orgs",
      "repos_url": "https://api.github.com/users/killerswan/repos",
      "events_url": "https://api.github.com/users/killerswan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/killerswan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-11T11:52:04Z",
    "updated_at": "2012-02-11T11:52:04Z",
    "body": "I need some more examples.  Otherwise, umm, what would Rust's recommended prototyping language be?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3920248/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3951241",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3951241",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3951241,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTEyNDE=",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-13T22:46:31Z",
    "updated_at": "2012-02-13T22:46:31Z",
    "body": "A few things:\n- I don't want rustc to get much further into the game of partial evaluation or abstract interpretation than typestate and the lurching-into-existence constant folder. That's a bottomless timesink and I'd prefer we spend our time on other matters.\n- While it was certainly _my_ original intention to be bureaucratic about \"always declaring explicitly when you intend to break rules\", I am no longer the sole audience. We are serving multiple audiences, and first impressions count.\n- I agree with marijn that typestate is unusual enough as a language feature that casual users should not have to even know it exists at all in order to use the standard library.\n- I also feel that in cases where typestate is playing a role in differentiating base cases from inductive cases in data structures, say, or establishing a datasort refinement, requiring the use of `check` statements turns out to be a pretty high notational burden. We need to find some ways to lower that burden if we're to attract users to the feature. It's already underused; chastising people into using something they don't feel is paying for itself is not likely to work.\n\nThat said, I really _want_ to encourage use of typestate, not just because \"it's a cool word / concept\" but rather because it's really `assert` in slightly more formal attire, and I love `assert` in my code. It saves me huge debugging energy, in every program I write that leans on it. To me, typestate predicates are assertions with 3 positive additional properties:\n1. They have names! Helpful for debugging and surfacing in API docs.\n2. The compiler can tell you where you're missing a `check`.\n3. The compiler can tell when a `check` is redundant, doesn't have to run.\n\nCurrently I think we're really only chafing under a very strict interpretation of the second of these properties -- compilation stops when you miss a `check` -- and only because it's _mandatory_ now rather than optional. I think it's reasonable to consider the following change:\n- When a callee `foo()` has predicate preconditions, we produce two wrapper functions `foo_dyn` and `foo_all`. The `foo_dyn` function takes 1 or more extra parameter(s) -- `uint`s -- that have a bit chosen to represent every incoming predicate. The `foo_dyn` function checks each bit, runs a `check` for any bit set to `0`, and then calls through to the `foo()` callee. The `foo_all` function has the same signature as `foo` -- no extra parameters -- but calls `foo_dyn` with `0` for each extra param in `foo_dyn`.\n- When a caller makes a call with predicates absent in the typestate, the caller calls `foo_dyn` with 1 or more `uint`s indicating the static typestate at the call site. This will wind up as 1 or more (usually 1) extra constant(s) in the instruction stream, not so bad.\n- When a caller takes a first class reference to `foo`, they take a pointer to `foo_all` (unless we support first class function types with predicates, in which case they might get a reference to `foo_dyn`, but we can leave that as a future extension).\n- We have a lint / error-checking flag / mode, available on a caller-scope by caller-scope basis, that re-enables the current behavior: that of requiring explicit checks on all paths to the call site. This amounts to insisting that the scope always calls `foo` directly, never `foo_dyn`.\n- Possibly make this mode take a _list_ of the predicates the user wants to require explicit checks for.\n\nThis would move typestate a fair bit closer still to a fancy DBC system: it'd be a DBC system that has a formal model of check redundancy and elimination (thereby: a means to safely and mindlessly reduce the execution penalty of over-checking by adding `check` statements as far out as you can). But it would also make it _much_ more likely for people to use predicates to constrain function inputs from the get-go. This is a much more compelling stales pitch: \"they're just like assertions in the callee, but the caller has a way to inhibit them, to make the callee go faster\".\n\nKeep in mind, `assert` is _already_ compelling enough to see naturally-occurring use. There are a dozen uses in production-code pathways of `core::vec` already (i.e. outside the tests). They're not even expensive enough to warrant static elimination, but they would (in a few cases) be worth surfacing in API docs. So I think if we can focus on keeping the experience \"like `assert` but better\", we'll be ok.\n\nThoughts?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3951241/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3994537",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3994537",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3994537,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTQ1Mzc=",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-16T03:44:03Z",
    "updated_at": "2012-02-16T03:44:03Z",
    "body": "My main concern is that refinement types have ended up being used in very few places, primarily because they only work on immutable data and with pure predicates. So, honestly, I'm not sure whether their existence is justified\u2026\n\nMaybe cooking dynamically-checked contracts into the language in some form is really what we want. This could be a solution to points (1) and (2) that Graydon brought up. Refinements don't seem to have solved (3) that often in practice, unfortunately.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3994537/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3994854",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3994854",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3994854,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTQ4NTQ=",
    "user": {
      "login": "dherman",
      "id": 307871,
      "node_id": "MDQ6VXNlcjMwNzg3MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/307871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dherman",
      "html_url": "https://github.com/dherman",
      "followers_url": "https://api.github.com/users/dherman/followers",
      "following_url": "https://api.github.com/users/dherman/following{/other_user}",
      "gists_url": "https://api.github.com/users/dherman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dherman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dherman/subscriptions",
      "organizations_url": "https://api.github.com/users/dherman/orgs",
      "repos_url": "https://api.github.com/users/dherman/repos",
      "events_url": "https://api.github.com/users/dherman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dherman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-16T04:19:39Z",
    "updated_at": "2012-02-16T04:19:39Z",
    "body": "I've been concerned about refinement types, too. I totally agree that having `assert` is great. But when it's tied into the type system, I think there are two main problems:\n\n(a) As Patrick said, it can only do sound static reasoning about immutable data. Earlier on in Rust's history, this was looking like a very large set of data in Rust, because all message-passing was going to be based on immutable data. Now that that's no longer the case, predicates don't seem to be able to account for as much of the data in the language.\n\n(b) The modularity problem, as Marijn points out in the bug. A library wants to state its invariants, but when those invariants are required by the type system, the programmer has to prove the invariant not only to herself but also to the type system. Since you can't really construct data that upholds a predicate _a priori_, you're forced to insert a check every time you create data that needs to be sent to a function with a refined input type.\n\nThere's this tension between wanting to express your invariants, especially when you have a system that can enforce some conservative approximation of some of them, but being limited by the expressiveness of the invariant system as well as the serious inconvenience (and/or runtime cost) it imposes on your clients.\n\nGraydon: IIUC, the variant you outline above could roughly be described as gradual typing for refinement types. This is the direction recent research in blended type systems has gone: a fully static version that imposes no runtime cost, a dynamic version with dynamic checks, and the ability for the two to interact without mandating explicit casts by inserting them automatically. I do still share Patrick's concern that it doesn't cover enough of the language (you can't put predicates on stateful types, or higher-order types like functions or objects) to warrant its status in the type system.\n\nIf we had a less high-powered refinement type system, we could still have `assert`. I think putting it in the language would continue to have many benefits: a language-blessed way to spot-check invariants, a way to generate better assertion error information (e.g., having baked-in syntax means you can report good source location information), and possibly a hook to do control-flow reasoning like we do now but for optimizations.\n\nJust my current thoughts, anyway.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3994854/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3995631",
    "html_url": "https://github.com/rust-lang/rust/issues/1805#issuecomment-3995631",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1805",
    "id": 3995631,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTU2MzE=",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-02-16T06:07:06Z",
    "updated_at": "2012-02-16T06:07:06Z",
    "body": "@dherman Yeah, what I was describing is a fair bit like gradual typing.\n\nI mean, to put this in most-blunt terms: even if we _never_ managed to find a formulation of typestate that was smooth-feeling enough to get extensive static use, I'd sorta like a DBC system to be present, if only to hoist function pre/post conditions up to API-documentation level rather than \"asserts buried in the body of the function\".\n\nAs far as whether refinement types will work out in the face of more-pervasive mutability, keep in mind that we didn't just blindly give up leaning on immutability in message passing; we shifted to leaning on unique types. I think the same is fair game here: a unique mutable type is perfectly valid for constraining, you just lose the constraint (or are obliged to re-check it) when you mutate the body.\n\nIn any case, we still don't have function postconditions working. Or constants in constraints. Or declared-constrained types. Or ... lots of parts. The fact that we're not leaning on this not-fully-mature subsystem heavily yet doesn't mean we ought to be angling for its obsolescence. Let it grow some more and see what we can do with it. We're not using resources or tasks _extensively_ yet either. And hardly any macros! A lot of parts of rust have taken a number of passes to refine to the point of tolerable usability; they were just more often things so firmly in the critical path that we were forced to dogfood through them earlier :)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3995631/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
