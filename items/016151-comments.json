[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50836757",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50836757",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50836757,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODM2NzU3",
    "user": {
      "login": "metajack",
      "id": 28357,
      "node_id": "MDQ6VXNlcjI4MzU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/28357?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/metajack",
      "html_url": "https://github.com/metajack",
      "followers_url": "https://api.github.com/users/metajack/followers",
      "following_url": "https://api.github.com/users/metajack/following{/other_user}",
      "gists_url": "https://api.github.com/users/metajack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/metajack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/metajack/subscriptions",
      "organizations_url": "https://api.github.com/users/metajack/orgs",
      "repos_url": "https://api.github.com/users/metajack/repos",
      "events_url": "https://api.github.com/users/metajack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/metajack/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T00:37:38Z",
    "updated_at": "2014-08-01T00:37:38Z",
    "body": "@zwarich reported this differs for him based on `-O`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50836757/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50836826",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50836826",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50836826,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODM2ODI2",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T00:38:42Z",
    "updated_at": "2014-08-01T00:38:42Z",
    "body": "On my machine (OS X) the presence of `-O` is irrelevant.\n\n`rustc 0.12.0-pre (7a25cf3f3 2014-07-30 17:06:18 +0000)`\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50836826/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50836853",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50836853",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50836853,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODM2ODUz",
    "user": {
      "login": "metajack",
      "id": 28357,
      "node_id": "MDQ6VXNlcjI4MzU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/28357?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/metajack",
      "html_url": "https://github.com/metajack",
      "followers_url": "https://api.github.com/users/metajack/followers",
      "following_url": "https://api.github.com/users/metajack/following{/other_user}",
      "gists_url": "https://api.github.com/users/metajack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/metajack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/metajack/subscriptions",
      "organizations_url": "https://api.github.com/users/metajack/orgs",
      "repos_url": "https://api.github.com/users/metajack/repos",
      "events_url": "https://api.github.com/users/metajack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/metajack/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T00:39:07Z",
    "updated_at": "2014-08-01T00:39:07Z",
    "body": "Discovered on rust @ 0582421.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50836853/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50838078",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50838078",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50838078,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODM4MDc4",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T00:58:41Z",
    "updated_at": "2014-08-01T00:58:41Z",
    "body": "@dotdash Could this be caused by incorrect LLVM lifetime annotations?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50838078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50838147",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50838147",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50838147,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODM4MTQ3",
    "user": {
      "login": "zwarich",
      "id": 440875,
      "node_id": "MDQ6VXNlcjQ0MDg3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/440875?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zwarich",
      "html_url": "https://github.com/zwarich",
      "followers_url": "https://api.github.com/users/zwarich/followers",
      "following_url": "https://api.github.com/users/zwarich/following{/other_user}",
      "gists_url": "https://api.github.com/users/zwarich/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zwarich/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zwarich/subscriptions",
      "organizations_url": "https://api.github.com/users/zwarich/orgs",
      "repos_url": "https://api.github.com/users/zwarich/repos",
      "events_url": "https://api.github.com/users/zwarich/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zwarich/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T00:59:52Z",
    "updated_at": "2014-08-01T00:59:52Z",
    "body": "@brson The Rust we're using for the upgrade doesn't have the LLVM lifetime intrinsic changes.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50838147/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50838221",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50838221",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50838221,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODM4MjIx",
    "user": {
      "login": "zwarich",
      "id": 440875,
      "node_id": "MDQ6VXNlcjQ0MDg3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/440875?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zwarich",
      "html_url": "https://github.com/zwarich",
      "followers_url": "https://api.github.com/users/zwarich/followers",
      "following_url": "https://api.github.com/users/zwarich/following{/other_user}",
      "gists_url": "https://api.github.com/users/zwarich/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zwarich/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zwarich/subscriptions",
      "organizations_url": "https://api.github.com/users/zwarich/orgs",
      "repos_url": "https://api.github.com/users/zwarich/repos",
      "events_url": "https://api.github.com/users/zwarich/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zwarich/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T01:00:51Z",
    "updated_at": "2014-08-01T01:00:51Z",
    "body": "@metajack The example that differs for me depending on optimization settings was my further reduction, not the original:\n\n``` rust\nstruct Fragment;\n\nimpl Drop for Fragment {\n    fn drop(&mut self) {\n        println!(\"drop\");\n    }\n}\n\nfn main() {\n    let mut fragments = Vec::new();\n    fragments.push(Fragment);\n    fragments.push(Fragment);\n\n    fragments.move_iter()\n             .skip_while(|fragment| {\n                 true\n             }).collect::<Vec<Fragment>>();\n}\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50838221/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50838316",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50838316",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50838316,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODM4MzE2",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T01:02:23Z",
    "updated_at": "2014-08-01T01:02:23Z",
    "body": "@pnkfelix or @nick29581 do either of you have the bandwith to look into this? It's blocking servo.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50838316/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50850379",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50850379",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50850379,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODUwMzc5",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T05:32:58Z",
    "updated_at": "2014-08-01T05:32:58Z",
    "body": "Adding some debug output, it looks like fragment 2 is dropped too early.\n\n``` rust\nuse std::mem;\n\nstruct Fragment {\n    dummy: int\n}\n\nimpl Fragment {\n    fn new(d: int) -> Fragment {\n        Fragment {\n            dummy: d,\n        }\n    }\n}\n\nimpl Drop for Fragment {\n    fn drop(&mut self) {\n        println!(\"drop {}\", self.dummy);\n    }\n}\n\nfn main() {\n    let mut fragments = vec!();\n    fragments.push(Fragment::new(1));\n    fragments.push(Fragment::new(2));\n\n    let new_fragments: Vec<Fragment> = mem::replace(&mut fragments, vec![])\n        .move_iter()\n        .skip_while(|fragment| {\n            println!(\"Skip {}\", fragment.dummy);\n            true\n        }).collect();\n    std::io::println(\"End\");\n}\n```\n\nGives:\n\n```\nSkip 1\ndrop 1\ndrop 2\nSkip 0\ndrop 2\nEnd\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50850379/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50855545",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50855545",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50855545,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODU1NTQ1",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T07:09:45Z",
    "updated_at": "2014-08-01T07:09:45Z",
    "body": "After reading through the LLVM IR, the issue is in `SkipWhile::next()`.\n\nHere's the source of `SkipWhile::next()`:\n\n``` rust\n    fn next(&mut self) -> Option<A> {\n        let mut next = self.iter.next();\n        if self.flag {\n            next\n        } else {\n            loop {\n                match next {\n                    Some(x) => {\n                        if (self.predicate)(&x) {\n                            next = self.iter.next();\n                            continue\n                        } else {\n                            self.flag = true;\n                            return Some(x)\n                        }\n                    }\n                    None => return None\n                }\n            }\n        }\n    }\n```\n\nIn the match case `Some(x)`, instead of moving the `Fragment` out of the `Option`, it merely takes a pointer. Then when the predicate passes, on the line `next = self.iter.next()`, it drops the `next` value before reassigning. And then it drops `x`. But since `x` was merely a pointer into the old `next`, it actually ends up dropping the fragment from the new `next` value.\n\nI'm not quite sure what the expected sequence here is. In the `else` block, both `x` and `next` get dropped, but `x` gets dropped after moving it into the return slot, and the drop flag is set, which causes the subsequent drop of `next` to do nothing. But in the `then` block, `next` gets dropped first, and `x` ends up pointing into the new value (and thus, very appropriately, doesn't have its zero flag set).\n\nI suppose a fix would be to actually move the value out of `next` and into `x` (i.e. making `x` no longer a pointer), setting the drop flag on the fragment in `next` in the process. I assume the use of a pointer is deliberate though.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50855545/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50856195",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50856195",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50856195,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODU2MTk1",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T07:19:17Z",
    "updated_at": "2014-08-01T07:19:17Z",
    "body": "I strongly suspect this was caused by #15076, which removed the extra alloca slot that was used to move the value out of the llmatch.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50856195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50856476",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50856476",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50856476,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODU2NDc2",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T07:24:02Z",
    "updated_at": "2014-08-01T07:24:02Z",
    "body": "cc @luqmana \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50856476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50888027",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50888027",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50888027,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODg4MDI3",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T14:07:54Z",
    "updated_at": "2014-08-01T14:07:54Z",
    "body": "Yeah, that makes sense, as that is the only place that does zero-after-drop, while explains the \"Skip 0\" in the debugging output.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50888027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50919046",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50919046",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50919046,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTE5MDQ2",
    "user": {
      "login": "larsbergstrom",
      "id": 475847,
      "node_id": "MDQ6VXNlcjQ3NTg0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/475847?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/larsbergstrom",
      "html_url": "https://github.com/larsbergstrom",
      "followers_url": "https://api.github.com/users/larsbergstrom/followers",
      "following_url": "https://api.github.com/users/larsbergstrom/following{/other_user}",
      "gists_url": "https://api.github.com/users/larsbergstrom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/larsbergstrom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/larsbergstrom/subscriptions",
      "organizations_url": "https://api.github.com/users/larsbergstrom/orgs",
      "repos_url": "https://api.github.com/users/larsbergstrom/repos",
      "events_url": "https://api.github.com/users/larsbergstrom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/larsbergstrom/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T18:32:36Z",
    "updated_at": "2014-08-01T18:32:36Z",
    "body": "So, should we be trying to revert #15076 locally and everything that depends on it? Or is there a potential fix?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50919046/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50919947",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50919947",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50919947,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTE5OTQ3",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T18:40:57Z",
    "updated_at": "2014-08-01T18:40:57Z",
    "body": "I suspect it can be fixed by extending the `Copy` exception (where it still produces the second alloca) to anything that implements or contains a type that implements `Drop`.\n\nThere's probably some other fix that could be made that doesn't require the extra alloca, by changing when destructors are called, but that's probably complicated and may run the risk of being incorrect.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50919947/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50923319",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50923319",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50923319,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTIzMzE5",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T19:11:23Z",
    "updated_at": "2014-08-01T19:11:23Z",
    "body": "No, that's not enough. If you use put `Box<Fragment>` into the vector, it evaluates the predicate only once, because it zeroes `next` and then sees a None.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50923319/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50924428",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50924428",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50924428,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTI0NDI4",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T19:21:45Z",
    "updated_at": "2014-08-01T19:21:45Z",
    "body": "Perhaps we should make allocas if you're matching and destructuring an lvalue which is mutated inside the match? Expr use visitor and mem cat should be able to tell you this.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50924428/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50924531",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50924531",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50924531,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTI0NTMx",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T19:22:46Z",
    "updated_at": "2014-08-01T19:22:46Z",
    "body": "Perhaps borrow check or a separate pass could build up a table to tell codegen when this occurs.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50924531/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50924631",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50924631",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50924631,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTI0NjMx",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T19:23:45Z",
    "updated_at": "2014-08-01T19:23:45Z",
    "body": "@larsbergstrom I suggest you work around it by just not using skip while.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50924631/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50925551",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50925551",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50925551,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTI1NTUx",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T19:33:03Z",
    "updated_at": "2014-08-01T19:33:03Z",
    "body": "It occurs to me that the set of types that don't implement `Copy` is very nearly the same as the set of types that implement (or contain a value that implements) `Drop`. So skipping the alloca only for types that aren't `Copy` and aren't `Drop` leaves you with very little left.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50925551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50926064",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50926064",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50926064,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTI2MDY0",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T19:38:49Z",
    "updated_at": "2014-08-01T19:38:49Z",
    "body": "Yes, which is why I think we should not fix this with a sledgehammer. This is an important optimization which I want to keep.\n\nI believe this problem is specific to mutation of the matched lvalue. Rust has precise information about that, so let's use it to guide optimizations.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50926064/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50926508",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50926508",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50926508,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTI2NTA4",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T19:43:18Z",
    "updated_at": "2014-08-01T19:43:18Z",
    "body": "@dotdash I'm not sure what you mean about `Box<Fragment>`. I just tested, and disabling the optimization for any `ty::type_needs_drop(..)` makes this work properly, both with `Fragment` and with `Box<Fragment>`.\n\nHowever, since that effectively kills the optimization for almost all types, I agree that it's not the right fix.\n\nOf course, disabling the optimization for all `Copy` types isn't great either. By tracking mutation of lvalues perhaps that restriction can be lifted as well.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50926508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50926622",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50926622",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50926622,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTI2NjIy",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T19:44:36Z",
    "updated_at": "2014-08-01T19:44:36Z",
    "body": "@kballard We're already reusing the alloca when it's a by value binding where the type would move. The problem here is reassigning to the expression you're matching on in the body of the match.\n\n@pcwalton I'm working on this and have it working for a small no_std test. Just need to get through this ice while building libstd.\n\nAlso, this is essentially a dupe of #15571.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50926622/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50926807",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50926807",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50926807,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTI2ODA3",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T19:46:27Z",
    "updated_at": "2014-08-01T19:46:27Z",
    "body": "@luqmana If you can track any mutation of the original expression, not just reassignment, then the `Copy` restriction can be lifted. At least according to the source comments, `Copy` doesn't reuse the alloca because of the worry of mutating the original value.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50926807/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50927296",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50927296",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50927296,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTI3Mjk2",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T19:51:17Z",
    "updated_at": "2014-08-01T19:51:17Z",
    "body": "@kballard Ah, damn, sorry. I forgot to fix that to say `Box<int>` (which doesn't implement Drop, but still needs drop glue). I had initially used removed the Drop impl for Fragment and used `Box<Fragment>`, that's why the text still said Fragment instead of int.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50927296/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50928379",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50928379",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50928379,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTI4Mzc5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T20:01:36Z",
    "updated_at": "2014-08-01T20:01:36Z",
    "body": "@dotdash Ah. Well, I think `ty::type_needs_drop()` tests drop glue anyway, not the `Drop` trait.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50928379/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50945504",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50945504",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50945504,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTQ1NTA0",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-01T23:27:17Z",
    "updated_at": "2014-08-01T23:27:17Z",
    "body": "@pcwalton Ok, so I added a check using ExprUseVisitor to see if we reassign to the expr we're matching on in the arm body and if so then use a new alloca slot. Here's the diff: https://gist.github.com/76a232453cec85c1c861\n\nNow this works for my no_std test case: https://gist.github.com/37257dd0036a7fa20085\n\n```\n# with master:\ndrop on: hi\ndrop on: bye\n>\n\n# with patch\ndrop on: hi\n> bye\ndrop on: bye\n```\n\nBut this ICE's while building libstd, since while looking up type_contents it encounters a ty_param whose `DefId` doesn't exist in `p.def_id.node`. Also, looking at RUST_LOG I see  `cat_def: id=90342 expr=fn(<generic #0>) -> core::result::Result<<generic #0>,sync::comm::stream::Failure<<generic #0>>> def=DefVariant(syntax::ast::DefId{krate: 2u32, node: 48433u32}, syntax::ast::DefId{krate: 2u32, node: 48434u32}, false)` but at this stage in trans shouldn't we already have all the types?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50945504/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50947767",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50947767",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50947767,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTQ3NzY3",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-02T00:13:28Z",
    "updated_at": "2014-08-02T00:13:28Z",
    "body": "It occurs to me that just tracking mutable borrows would not be sufficient (not that @luqmana is doing that, but it was a suggestion), because `UnsafeCell` means that a value could be mutated without a mutable borrow.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50947767/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50950583",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50950583",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50950583,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTUwNTgz",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-02T01:40:35Z",
    "updated_at": "2014-08-02T01:40:35Z",
    "body": "@luqmana You may have to call monomorphize_type somewhere.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50950583/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50950595",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50950595",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50950595,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTUwNTk1",
    "user": {
      "login": "pcwalton",
      "id": 157897,
      "node_id": "MDQ6VXNlcjE1Nzg5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcwalton",
      "html_url": "https://github.com/pcwalton",
      "followers_url": "https://api.github.com/users/pcwalton/followers",
      "following_url": "https://api.github.com/users/pcwalton/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions",
      "organizations_url": "https://api.github.com/users/pcwalton/orgs",
      "repos_url": "https://api.github.com/users/pcwalton/repos",
      "events_url": "https://api.github.com/users/pcwalton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcwalton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-02T01:40:59Z",
    "updated_at": "2014-08-02T01:40:59Z",
    "body": "@kballard Yeah, we might need to look at Share kind\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50950595/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50951946",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-50951946",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 50951946,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTUxOTQ2",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-02T02:45:43Z",
    "updated_at": "2014-08-02T02:45:43Z",
    "body": "@pcwalton Well, the whole point of the suggestion was to drop the `Copy` restriction. As long as `Copy` types still produce a new alloca then we don't have to do anything at all (because non-`Copy` types will move, and you can't mutate a moved value).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50951946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51031473",
    "html_url": "https://github.com/rust-lang/rust/issues/16151#issuecomment-51031473",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16151",
    "id": 51031473,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMDMxNDcz",
    "user": {
      "login": "nrc",
      "id": 762626,
      "node_id": "MDQ6VXNlcjc2MjYyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nrc",
      "html_url": "https://github.com/nrc",
      "followers_url": "https://api.github.com/users/nrc/followers",
      "following_url": "https://api.github.com/users/nrc/following{/other_user}",
      "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
      "organizations_url": "https://api.github.com/users/nrc/orgs",
      "repos_url": "https://api.github.com/users/nrc/repos",
      "events_url": "https://api.github.com/users/nrc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nrc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-04T08:45:57Z",
    "updated_at": "2014-08-04T08:45:57Z",
    "body": "@brson I have time this week, but actually it looks like @luqmana has a fix. Let me know if I can be useful somehow.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51031473/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
