[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66373114",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66373114",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66373114,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2MzczMTE0",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-09T22:47:42Z",
    "updated_at": "2014-12-09T22:47:42Z",
    "body": "CC @pczarn @cgaebel @thestinger \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66373114/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66373976",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66373976",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66373976,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2MzczOTc2",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-09T22:53:30Z",
    "updated_at": "2014-12-09T22:53:30Z",
    "body": "Hashes should have the option of single pass implementations rather than ones with state and this doesn't seem like it's enough to provide that.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66373976/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66388372",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66388372",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66388372,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2Mzg4Mzcy",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-10T01:03:50Z",
    "updated_at": "2014-12-10T01:03:50Z",
    "body": "Does single-pass mean that the hasher gets to see e.g. the whole array of bytes instead of getting a look at them one at a time?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66388372/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66401025",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66401025",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66401025,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NDAxMDI1",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-10T03:51:47Z",
    "updated_at": "2014-12-10T03:51:47Z",
    "body": "@thestinger I'm not quite sure what you mean by \"single pass\", could you elaborate? Implementations of `Hash` are still allowed to specialize on the kind of `Hasher` used to use methods beyond what `Writer` provides (see the tests for an example).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66401025/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66513725",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66513725",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66513725,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTEzNzI1",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-10T20:00:01Z",
    "updated_at": "2014-12-10T20:00:01Z",
    "body": "@tbu-: Yes, it means it doesn't have to be a state machine.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66513725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66515144",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66515144",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66515144,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTE1MTQ0",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-10T20:08:29Z",
    "updated_at": "2014-12-10T20:08:29Z",
    "body": "@alexcrichton: The fact that the default hash implementations don't have single pass implementations for contiguous blocks of memory is a major performance issue and should be addressed in the design. I don't see how it's ready to be stabilized if these issues haven't even been _considered_.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66515144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66538171",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66538171",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66538171,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTM4MTcx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-10T22:40:34Z",
    "updated_at": "2014-12-10T22:40:34Z",
    "body": "I'm trying to drill down into something more specific because what you've said so far sounds like this is already possible with the PR. I would like to make your concerns more concrete because the initial design of the `Hash` module had many performance considerations taken into account, and this proposed tweaking did not give up on any of that generality.\n\nSpecifically:\n- If you literally have one large block of memory, is `write()` not sufficient?\n- If you have a specific hashing optimization, is an implementation of `Hash<SpecificHasher>` not sufficient?\n\nIt would be helpful for you to be a little more concrete in your concerns to make sure that we can address them!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66538171/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66707642",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66707642",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66707642,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NzA3NjQy",
    "user": {
      "login": "tbu-",
      "id": 6666593,
      "node_id": "MDQ6VXNlcjY2NjY1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6666593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbu-",
      "html_url": "https://github.com/tbu-",
      "followers_url": "https://api.github.com/users/tbu-/followers",
      "following_url": "https://api.github.com/users/tbu-/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbu-/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbu-/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbu-/subscriptions",
      "organizations_url": "https://api.github.com/users/tbu-/orgs",
      "repos_url": "https://api.github.com/users/tbu-/repos",
      "events_url": "https://api.github.com/users/tbu-/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbu-/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-11T23:21:39Z",
    "updated_at": "2014-12-11T23:21:39Z",
    "body": "@alexcrichton I believe that this is not possible due to the current standard implementation for any slice that just hashes the members separately.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66707642/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66712534",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66712534",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66712534,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NzEyNTM0",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-12T00:09:17Z",
    "updated_at": "2014-12-12T00:09:17Z",
    "body": "@alexcrichton: A single-pass implementation is more efficient than a stateful one even if it's only using a single call to `write`. The infrastructure to do this for collections like slices is also missing.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66712534/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66802801",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66802801",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66802801,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2ODAyODAx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-12T17:12:03Z",
    "updated_at": "2014-12-12T17:12:03Z",
    "body": "@tbu- I agree that we can't generically hash a slice of bytes as just a call to `write`, as this would require specialization. Without giving up the `Hash` implementation for slices in general, though, I'm not sure that there's a way around this.\n\n@thestinger is this what you are referring to? I still don't understand your concerns about state because with the specialization of the hasher type parameter on the `Hash` trait you can always bypass all internal state via bytes anyway. Can you also elaborate more on what infrastructure you're talking about? Do you think that hashers should take a slice of `T` to hash in bulk?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66802801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66974577",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-66974577",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 66974577,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2OTc0NTc3",
    "user": {
      "login": "pczarn",
      "id": 3356767,
      "node_id": "MDQ6VXNlcjMzNTY3Njc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3356767?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pczarn",
      "html_url": "https://github.com/pczarn",
      "followers_url": "https://api.github.com/users/pczarn/followers",
      "following_url": "https://api.github.com/users/pczarn/following{/other_user}",
      "gists_url": "https://api.github.com/users/pczarn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pczarn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pczarn/subscriptions",
      "organizations_url": "https://api.github.com/users/pczarn/orgs",
      "repos_url": "https://api.github.com/users/pczarn/repos",
      "events_url": "https://api.github.com/users/pczarn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pczarn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-15T10:24:14Z",
    "updated_at": "2014-12-15T10:34:50Z",
    "body": "> A single-pass implementation is more efficient than a stateful one even if it's only using a single call to `write`.\n\nCalls to `write`, however many, must be followed by a call to `finish`. This overhead is constant. Is there some other fundamental difference I'm missing?\n\nI'm assuming the problem is that LLVM doesn't understand the semantics of `write` enough to optimize (inlined) invocations. Further, `hash` is called individually on each value. However, contiguous slices can be merged before they are passed to `write`:\n\n``` rust\npub trait MyHash<S: Writer = SipHasher> for Sized? {\n    fn myhash<'a>(&'a self, state: &mut S, msg: &mut Option<&'a [u8]>);\n}\n\npub fn myhash<T: MyHash<SipHasher>>(value: &T) -> u64 {\n    let mut state = SipState::new();\n    let mut msg = None;\n    value.myhash(&mut state, &mut msg);\n    if let Some(tail_msg) = msg {\n        state.write(tail_msg);\n    };\n    state.finish()\n}\n\n// for primitive integer types\n// impl<S: Writer> MyHash<S> for $ty\nfn myhash<'a>(&'a self, state: &mut S, msg: &mut Option<&'a [u8]>) {\n    if (*self as $ty).to_le() == *self as $ty { unsafe {\n        let a = slice::from_raw_buf(mem::transmute(&self), mem::size_of::<$ty>());\n        let a_ptr = a.as_ptr();\n\n        match msg {\n            &Some(ref mut m) if a_ptr == m.as_ptr().offset(m.len() as int) => {\n                *msg = slice::from_raw_buf(mem::transmute(&m.as_ptr()),\n                                           m.len() + a.len());\n            }\n            _ => {\n                if let Some(msg_part) = *msg { state.write(msg_part); }\n                *msg = Some(a);\n            }\n        }\n    } } else {\n        let a: [u8, ..::core::$ty::BYTES] = unsafe {\n            mem::transmute((*self as $ty).to_le() as $ty)\n        };\n        if let Some(msg_part) = *msg { state.write(msg_part); }\n        state.write(a.as_slice());\n        *msg = None;\n    }\n}\n```\n\nI can only imagine it working efficiently with generous inlining and optimizations. Currently, the check for `a.as_ptr() == msg_end` isn't optimized out in code that hashes a slice, but slices become contiguous nonetheless. Maybe aliasing information could help here?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66974577/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67050954",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-67050954",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 67050954,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MDUwOTU0",
    "user": {
      "login": "drewm1980",
      "id": 190617,
      "node_id": "MDQ6VXNlcjE5MDYxNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/190617?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/drewm1980",
      "html_url": "https://github.com/drewm1980",
      "followers_url": "https://api.github.com/users/drewm1980/followers",
      "following_url": "https://api.github.com/users/drewm1980/following{/other_user}",
      "gists_url": "https://api.github.com/users/drewm1980/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/drewm1980/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/drewm1980/subscriptions",
      "organizations_url": "https://api.github.com/users/drewm1980/orgs",
      "repos_url": "https://api.github.com/users/drewm1980/repos",
      "events_url": "https://api.github.com/users/drewm1980/events{/privacy}",
      "received_events_url": "https://api.github.com/users/drewm1980/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-15T19:33:19Z",
    "updated_at": "2014-12-15T19:33:19Z",
    "body": "One piece of infrastructure that might be relevant is a function for combining adjacent slices that I am working on.  It is here in the playpen for now; I intend to write a PR.\nhttp://is.gd/zDpaJd\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67050954/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67706626",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-67706626",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 67706626,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzA2NjI2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-19T22:25:39Z",
    "updated_at": "2014-12-19T22:25:39Z",
    "body": "I've looked into some other languages, and it seems that the common trend is for a definition that looks something like:\n\n``` rust\ntrait Hash {\n    fn hash(&self) -> uint;\n}\n```\n\nThe drawback of this, however, is that containers like `HashMap` cannot be parametric over the hash algorithm used. This trait can also be encoded via the definitions proposed in this PR:\n\n``` rust\nimpl Hash<uint> for MyType {\n    fn hash(&self, state: &mut uint) {\n        *state = self.my_hash();\n    }\n}\n```\n\nWhen it comes to optimizing hashing or trying to make an implementation that doesn't work incrementally (which it sounds like @pczarn, @thestinger are alluding to), one of the problems that jumps out is how to deal with aggregate structures with `#[deriving(Hash)]`. When it comes to deriving, unless we hard-code one specific algorithm, I don't think we have any option _other_ than incrementally updating a hash (e.g. just calling `.hash(state)` on all members).\n\nFrom what I can tell, one can always specialize hashing to perform optimally for any one particular type (minimizing `write` calls), but it would be very difficult to do so generically. For example the `&[u8]` type likely cannot hash well due to the lack of specialization implementations, whereas the `&str` type can likely hash _very_ well due to actually being one call to `.write()`.\n\n@pczarn I'm sorry I didn't quite follow your comment, but are you basically saying that requiring `.write() + .finish()` is imposing overhead, even in the `&str` case for example? Are you also saying that this is _not_ inherent to the `SipHasher` implementation, but rather inherent to the design of the hashing traits?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67706626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68673532",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-68673532",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 68673532,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NjczNTMy",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-05T06:43:32Z",
    "updated_at": "2015-01-05T06:43:32Z",
    "body": "Bump.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68673532/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68818023",
    "html_url": "https://github.com/rust-lang/rust/pull/19673#issuecomment-68818023",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19673",
    "id": 68818023,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODE4MDIz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-06T02:36:24Z",
    "updated_at": "2015-01-06T02:36:24Z",
    "body": "I'd like to rebase this with a rewrite with true associated types, but I'm hitting a number of errors in the compiler which are preventing the usage of associated types. @nikomatsakis has a fix though, and I'll rebase as soon as we have a snapshot with those fixes.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68818023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
