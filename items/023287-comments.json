[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78403514",
    "html_url": "https://github.com/rust-lang/rust/issues/23287#issuecomment-78403514",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23287",
    "id": 78403514,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDAzNTE0",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-12T00:39:49Z",
    "updated_at": "2015-03-12T00:39:49Z",
    "body": "I suspect the problem stems from the curious `-L \"\"`.  That's passing _two_ arguments, the second of which is blank.\n\nFrom my testing so far (on Linux), neither `rustc` nor `clang`/`gcc` treat `-L \"\"` as a synonym for `-L.`, so I'm not sure what it actually accomplishes, if anything.  `rustc` passes both arguments to `cc`.  The compiler drivers merge the two-argument form into a single-argument form for passing to `ld`.\n\nHowever, Linux's `ld` actually accepts both the single-argument and two-argument forms.  When the command-line has `-L \"\"` on it, it corrupts the subsequent argument:\n\n```\nmkdir subdir\necho \"void dummy(void){}\" > subdir/dummy.c\ngcc -shared subdir/dummy.c -o subdir/libdummy.so\necho  >main.rs '#[link(name = \"dummy\", kind = \"dylib\")]'\necho >>main.rs 'extern { fn dummy(); }'\necho >>main.rs 'fn main() { unsafe { dummy(); } }'\nrustc main.rs -L \"\" -Lsubdir\n```\n\nProduces:\n\n```\nerror: linking with `cc` failed: exit code: 1\nnote: \"cc\" \"-Wl,--as-needed\" \"-m64\" \"-L\" \"/usr/local/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-o\" \"./main\" \"./main.o\" \"-Wl,--whole-archive\" \"-lmorestack\" \"-Wl,--no-whole-archive\" \"-Wl,--gc-sections\" \"-pie\" \"-nodefaultlibs\" \"/usr/local/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-4e7c5e5c.rlib\" \"/usr/local/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcollections-4e7c5e5c.rlib\" \"/usr/local/lib/rustlib/x86_64-unknown-linux-gnu/lib/libunicode-4e7c5e5c.rlib\" \"/usr/local/lib/rustlib/x86_64-unknown-linux-gnu/lib/librand-4e7c5e5c.rlib\" \"/usr/local/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc-4e7c5e5c.rlib\" \"/usr/local/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-4e7c5e5c.rlib\" \"/usr/local/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-4e7c5e5c.rlib\" \"-L\" \"\" \"-L\" \"subdir\" \"-L\" \"/usr/local/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-L\" \"/home/rprichard/mess/dyncrate/.rust/lib/x86_64-unknown-linux-gnu\" \"-L\" \"/home/rprichard/mess/dyncrate/lib/x86_64-unknown-linux-gnu\" \"-Wl,--whole-archive\" \"-Wl,-Bstatic\" \"-Wl,--no-whole-archive\" \"-Wl,-Bdynamic\" \"-ldummy\" \"-ldl\" \"-lpthread\" \"-lrt\" \"-lgcc_s\" \"-lpthread\" \"-lc\" \"-lm\" \"-lcompiler-rt\"\nnote: /usr/bin/ld: cannot find -ldummy\ncollect2: error: ld returned 1 exit status\n```\n\nRemove the `-L \"\"`, or move it to the end of the command-line, and it works.  `ld` is seeing `-L -Lsubdir`, so it adds the non-existent `-Lsubdir` directory to the search path, and it doesn't search inside `subdir`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78403514/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78404360",
    "html_url": "https://github.com/rust-lang/rust/issues/23287#issuecomment-78404360",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23287",
    "id": 78404360,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDA0MzYw",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-12T00:48:41Z",
    "updated_at": "2015-03-12T00:48:41Z",
    "body": "@aidancully What versions of tools are you using?  e.g.:\n\n```\nuname -a\ncc --version\nld --version\nrustc --version --verbose\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78404360/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78407208",
    "html_url": "https://github.com/rust-lang/rust/issues/23287#issuecomment-78407208",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23287",
    "id": 78407208,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDA3MjA4",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-12T01:19:53Z",
    "updated_at": "2015-03-12T01:19:53Z",
    "body": "I think the `-L \"\"` is coming from here in `mk/target.mk`:\n\n``` make\n    $(Q)CFG_LLVM_LINKAGE_FILE=$$(LLVM_LINKAGE_PATH_$(3)) \\\n        $$(subst @,,$$(STAGE$(1)_T_$(2)_H_$(3))) \\\n        $$(RUST_LIB_FLAGS_ST$(1)) \\\n        -L \"$$(RT_OUTPUT_DIR_$(2))\" \\\n        -L \"$$(LLVM_LIBDIR_$(2))\" \\\n        -L \"$$(dir $$(LLVM_STDCPP_LOCATION_$(2)))\" \\\n        $$(RUSTFLAGS_$(4)) \\\n        --out-dir $$(@D) \\\n        -C extra-filename=-$$(CFG_FILENAME_EXTRA) \\\n        $$<\n```\n\nI suspect `LLVM_STDCPP_LOCATION_$(2)` is normally blank (mk/llvm.mk):\n\n``` make\nifeq ($$(CFG_ENABLE_LLVM_STATIC_STDCPP),1)\nLLVM_STDCPP_LOCATION_$(1) = $$(shell $$(CC_$(1)) $$(CFG_GCCISH_CFLAGS_$(1)) \\\n                    -print-file-name=libstdc++.a)\nelse\nLLVM_STDCPP_LOCATION_$(1) =\nendif\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78407208/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78429283",
    "html_url": "https://github.com/rust-lang/rust/issues/23287#issuecomment-78429283",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23287",
    "id": 78429283,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDI5Mjgz",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-12T06:14:35Z",
    "updated_at": "2015-03-12T06:15:00Z",
    "body": "I was able to reproduce the problem on FreeBSD 9.2.  Doing so required compiling and installing libcxxrt and libc++ from the FreeBSD source tree.\n\nThe important thing is that `cc` is `cc (GCC) 4.2.1 20070831 patched [FreeBSD]` on FreeBSD 9.2.  Rather than converting two-argument `-L` to single-argument `-L`, this driver propagates both forms to `ld` unmodified, except that the `\"\"` argument in `-L \"\"` is dropped.  We see something like `-L -L <path>` on the `ld` command-line, so of course `ld` thinks `<path>` is an input file.\n\nI'm inclined to say that gcc and clang are both buggy, but even if they're fixed, it would take too long to propagate fixes.  I'll see how hard this is to fix in the Rust makefile.  We may want to fix `rustc` to either ignore `-L \"\"` or reject it.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78429283/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78483923",
    "html_url": "https://github.com/rust-lang/rust/issues/23287#issuecomment-78483923",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23287",
    "id": 78483923,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDgzOTIz",
    "user": {
      "login": "aidancully",
      "id": 503301,
      "node_id": "MDQ6VXNlcjUwMzMwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/503301?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aidancully",
      "html_url": "https://github.com/aidancully",
      "followers_url": "https://api.github.com/users/aidancully/followers",
      "following_url": "https://api.github.com/users/aidancully/following{/other_user}",
      "gists_url": "https://api.github.com/users/aidancully/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aidancully/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aidancully/subscriptions",
      "organizations_url": "https://api.github.com/users/aidancully/orgs",
      "repos_url": "https://api.github.com/users/aidancully/repos",
      "events_url": "https://api.github.com/users/aidancully/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aidancully/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-12T13:58:15Z",
    "updated_at": "2015-03-12T13:58:15Z",
    "body": "@rprichard I think you're right about the problem being the odd `-L \"\"`. I am building on FreeBSD 9.2 with a re-installed libcxxrt and libc++ (long story). To answer your questions:\n\n```\n$ cc --version\ncc (GCC) 4.2.1 20070831 patched [FreeBSD]\nCopyright (C) 2007 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\n$ ld --version\nGNU ld 2.17.50 [FreeBSD] 2007-07-03\nCopyright 2007 Free Software Foundation, Inc.\nThis program is free software; you may redistribute it under the terms of\nthe GNU General Public License.  This program has absolutely no warranty.\n```\n\nRustc was the stage1 rustc compiled from 95d904625b4d45af80b4e40d51a3a0fde1abaa8a.\n\nThanks!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/78483923/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
