[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/159076680",
    "html_url": "https://github.com/rust-lang/rust/issues/30003#issuecomment-159076680",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30003",
    "id": 159076680,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1OTA3NjY4MA==",
    "user": {
      "login": "eefriedman",
      "id": 12769964,
      "node_id": "MDQ6VXNlcjEyNzY5OTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/12769964?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eefriedman",
      "html_url": "https://github.com/eefriedman",
      "followers_url": "https://api.github.com/users/eefriedman/followers",
      "following_url": "https://api.github.com/users/eefriedman/following{/other_user}",
      "gists_url": "https://api.github.com/users/eefriedman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eefriedman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eefriedman/subscriptions",
      "organizations_url": "https://api.github.com/users/eefriedman/orgs",
      "repos_url": "https://api.github.com/users/eefriedman/repos",
      "events_url": "https://api.github.com/users/eefriedman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eefriedman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-23T21:51:08Z",
    "updated_at": "2015-11-23T21:51:08Z",
    "body": "There are other substantial problems with asynchronous signal handlers... for example, `malloc()` isn't signal-safe.  It might be possible to deal with that... but it would be a lot of work, a lot of `if in_signal_hander { signal_handler_abort() }`, and a bunch of changes to crates outside the standard library which wrap C libraries.  Even if we did manage to pull it off, signal handlers would still be a minefield of aborts and/or deadlocks, so making them safe doesn't actually gain much.\n\nGiven all of that, it's extremely unlikely the standard library will ever provide safe async signal handlers.\n\n---\n\n`#[thread_local]` is not going to be stabilized as-is; it's possible that accessing a raw thread_local global will be considered unsafe in the final design.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/159076680/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/159081544",
    "html_url": "https://github.com/rust-lang/rust/issues/30003#issuecomment-159081544",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30003",
    "id": 159081544,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1OTA4MTU0NA==",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-23T22:06:56Z",
    "updated_at": "2015-11-23T22:06:56Z",
    "body": "> There are other substantial problems with asynchronous signal handlers... for example, malloc() isn't signal-safe.\n\nIt is certainly possible to write a signal-safe malloc and it is also possible to write programs that don't call any C functions. Furthermore, there are probably also malloc implementations out there that are not thread-safe. Yet this does not stop the language from requiring statics to be `Sync`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/159081544/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/472097570",
    "html_url": "https://github.com/rust-lang/rust/issues/30003#issuecomment-472097570",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30003",
    "id": 472097570,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MjA5NzU3MA==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2019-03-12T17:19:35Z",
    "updated_at": "2019-03-12T17:19:35Z",
    "body": "Triage: this is still marked as needs-decision for @rust-lang/lang, but i'm not sure there was ever a discussion on it.\r\n\r\nPersonal opinion: the root issue here is the unsafe, and so it's not likely to be fixed.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/472097570/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752101946",
    "html_url": "https://github.com/rust-lang/rust/issues/30003#issuecomment-1752101946",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30003",
    "id": 1752101946,
    "node_id": "IC_kwDOAAsO6M5obvQ6",
    "user": {
      "login": "mkroening",
      "id": 28776973,
      "node_id": "MDQ6VXNlcjI4Nzc2OTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/28776973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mkroening",
      "html_url": "https://github.com/mkroening",
      "followers_url": "https://api.github.com/users/mkroening/followers",
      "following_url": "https://api.github.com/users/mkroening/following{/other_user}",
      "gists_url": "https://api.github.com/users/mkroening/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mkroening/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mkroening/subscriptions",
      "organizations_url": "https://api.github.com/users/mkroening/orgs",
      "repos_url": "https://api.github.com/users/mkroening/repos",
      "events_url": "https://api.github.com/users/mkroening/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mkroening/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-10-08T16:41:42Z",
    "updated_at": "2023-10-08T16:41:42Z",
    "body": "I just published [`InterruptRefCell`](https://docs.rs/interrupt-ref-cell), which uses a compiler fence to synchronize with signal handlers and interrupt handlers to share a `RefCell` with them. In the original example at the top, the signal would be deferred until after the `RefCell` is not accessed from the main thread anymore. Of course, one could explicitly enable signals while accessing an `InterruptRefCell`, though.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752101946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752103309",
    "html_url": "https://github.com/rust-lang/rust/issues/30003#issuecomment-1752103309",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30003",
    "id": 1752103309,
    "node_id": "IC_kwDOAAsO6M5obvmN",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-10-08T16:48:46Z",
    "updated_at": "2023-10-08T16:48:46Z",
    "body": "> In the original example at the top, the signal would be deferred until after the RefCell is not accessed from the main thread anymore. \r\n\r\nWhich mechanism achieves that?",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752103309/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752108552",
    "html_url": "https://github.com/rust-lang/rust/issues/30003#issuecomment-1752108552",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30003",
    "id": 1752108552,
    "node_id": "IC_kwDOAAsO6M5obw4I",
    "user": {
      "login": "mkroening",
      "id": 28776973,
      "node_id": "MDQ6VXNlcjI4Nzc2OTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/28776973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mkroening",
      "html_url": "https://github.com/mkroening",
      "followers_url": "https://api.github.com/users/mkroening/followers",
      "following_url": "https://api.github.com/users/mkroening/following{/other_user}",
      "gists_url": "https://api.github.com/users/mkroening/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mkroening/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mkroening/subscriptions",
      "organizations_url": "https://api.github.com/users/mkroening/orgs",
      "repos_url": "https://api.github.com/users/mkroening/repos",
      "events_url": "https://api.github.com/users/mkroening/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mkroening/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-10-08T17:13:49Z",
    "updated_at": "2023-10-08T17:13:49Z",
    "body": "> Which mechanism achieves that?\r\n\r\nAh, sorry. I mask (disable) all signals when borrowing `InterruptRefCell` and restore the previous mask once the borrow is done. When masked, incoming signals are deferred.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752108552/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752109017",
    "html_url": "https://github.com/rust-lang/rust/issues/30003#issuecomment-1752109017",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30003",
    "id": 1752109017,
    "node_id": "IC_kwDOAAsO6M5obw_Z",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-10-08T17:16:14Z",
    "updated_at": "2023-10-08T17:16:14Z",
    "body": "Ah okay, so that way the `RefCell` is \"thread-safe\" for signals. Makes sense.\r\n\r\nEnabling signals while having the `InterruptRefCell` open should even be fine since other \"threads\" will see borrow flag and avoid giving a 2nd borrow, right? The concurrency due to signals/interrupts only matters during `borrow`/`borrow_mut` to avoid race conditions. (And there might have to be some fences as well to avoid reordering.)",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752109017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752110239",
    "html_url": "https://github.com/rust-lang/rust/issues/30003#issuecomment-1752110239",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30003",
    "id": 1752110239,
    "node_id": "IC_kwDOAAsO6M5obxSf",
    "user": {
      "login": "mkroening",
      "id": 28776973,
      "node_id": "MDQ6VXNlcjI4Nzc2OTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/28776973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mkroening",
      "html_url": "https://github.com/mkroening",
      "followers_url": "https://api.github.com/users/mkroening/followers",
      "following_url": "https://api.github.com/users/mkroening/following{/other_user}",
      "gists_url": "https://api.github.com/users/mkroening/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mkroening/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mkroening/subscriptions",
      "organizations_url": "https://api.github.com/users/mkroening/orgs",
      "repos_url": "https://api.github.com/users/mkroening/repos",
      "events_url": "https://api.github.com/users/mkroening/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mkroening/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-10-08T17:21:53Z",
    "updated_at": "2023-10-08T17:21:53Z",
    "body": "Yeah, enabling them should be \"fine\" but unwanted, since trying to borrow mutably in a signal handler while the main context holds another reference would not work.\r\n\r\nSo losing mutual exclusion with signal handlers on `RefCell`s is safe but bad, similar to deadlocks and mutexes, I would say.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752110239/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752110497",
    "html_url": "https://github.com/rust-lang/rust/issues/30003#issuecomment-1752110497",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30003",
    "id": 1752110497,
    "node_id": "IC_kwDOAAsO6M5obxWh",
    "user": {
      "login": "mkroening",
      "id": 28776973,
      "node_id": "MDQ6VXNlcjI4Nzc2OTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/28776973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mkroening",
      "html_url": "https://github.com/mkroening",
      "followers_url": "https://api.github.com/users/mkroening/followers",
      "following_url": "https://api.github.com/users/mkroening/following{/other_user}",
      "gists_url": "https://api.github.com/users/mkroening/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mkroening/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mkroening/subscriptions",
      "organizations_url": "https://api.github.com/users/mkroening/orgs",
      "repos_url": "https://api.github.com/users/mkroening/repos",
      "events_url": "https://api.github.com/users/mkroening/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mkroening/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-10-08T17:22:53Z",
    "updated_at": "2023-10-08T17:22:53Z",
    "body": "> And there might have to be some fences as well to avoid reordering.\r\n\r\nYeah, compiler fences are the base for this.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752110497/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752400407",
    "html_url": "https://github.com/rust-lang/rust/issues/30003#issuecomment-1752400407",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30003",
    "id": 1752400407,
    "node_id": "IC_kwDOAAsO6M5oc4IX",
    "user": {
      "login": "RalfJung",
      "id": 330628,
      "node_id": "MDQ6VXNlcjMzMDYyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RalfJung",
      "html_url": "https://github.com/RalfJung",
      "followers_url": "https://api.github.com/users/RalfJung/followers",
      "following_url": "https://api.github.com/users/RalfJung/following{/other_user}",
      "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions",
      "organizations_url": "https://api.github.com/users/RalfJung/orgs",
      "repos_url": "https://api.github.com/users/RalfJung/repos",
      "events_url": "https://api.github.com/users/RalfJung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RalfJung/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-10-09T06:16:20Z",
    "updated_at": "2023-10-09T06:18:13Z",
    "body": "Note that you absolutely need to have interrupts disabled whenever the RefCell's borrow flags are accessed. This is crucial for soundness. So doing just \"best-effort\" interrupt disabling is unsound. See https://github.com/mkroening/interrupt-ref-cell/issues/5.\r\n\r\n> So losing mutual exclusion with signal handlers on `RefCell`s is safe but bad, similar to deadlocks and mutexes, I would say.\r\n\r\nNo, it's unsound. You get a data race between the thread releasing its hold of the RefCell and the handler trying to acquire it.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1752400407/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
