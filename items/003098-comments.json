[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7488493",
    "html_url": "https://github.com/rust-lang/rust/issues/3098#issuecomment-7488493",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3098",
    "id": 7488493,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODg0OTM=",
    "user": {
      "login": "eholk",
      "id": 105766,
      "node_id": "MDQ6VXNlcjEwNTc2Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eholk",
      "html_url": "https://github.com/eholk",
      "followers_url": "https://api.github.com/users/eholk/followers",
      "following_url": "https://api.github.com/users/eholk/following{/other_user}",
      "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eholk/subscriptions",
      "organizations_url": "https://api.github.com/users/eholk/orgs",
      "repos_url": "https://api.github.com/users/eholk/repos",
      "events_url": "https://api.github.com/users/eholk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eholk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-03T17:08:29Z",
    "updated_at": "2012-08-03T17:08:29Z",
    "body": "bd195518c77805def4d3f540aab34cd4264c8045 should have removed one case where this race can happen, but apparently there are more.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7488493/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7489445",
    "html_url": "https://github.com/rust-lang/rust/issues/3098#issuecomment-7489445",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3098",
    "id": 7489445,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODk0NDU=",
    "user": {
      "login": "eholk",
      "id": 105766,
      "node_id": "MDQ6VXNlcjEwNTc2Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eholk",
      "html_url": "https://github.com/eholk",
      "followers_url": "https://api.github.com/users/eholk/followers",
      "following_url": "https://api.github.com/users/eholk/following{/other_user}",
      "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eholk/subscriptions",
      "organizations_url": "https://api.github.com/users/eholk/orgs",
      "repos_url": "https://api.github.com/users/eholk/repos",
      "events_url": "https://api.github.com/users/eholk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eholk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-03T17:47:21Z",
    "updated_at": "2012-08-03T17:47:21Z",
    "body": "Here's another instance of it: http://bot.rust-lang.org/logs/2012/07/03/2012-08-03T17:36:59Z-77010905-0957-45df-b460-9999ce0c64f1.html\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7489445/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7490771",
    "html_url": "https://github.com/rust-lang/rust/issues/3098#issuecomment-7490771",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3098",
    "id": 7490771,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0OTA3NzE=",
    "user": {
      "login": "bblum",
      "id": 1820515,
      "node_id": "MDQ6VXNlcjE4MjA1MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bblum",
      "html_url": "https://github.com/bblum",
      "followers_url": "https://api.github.com/users/bblum/followers",
      "following_url": "https://api.github.com/users/bblum/following{/other_user}",
      "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bblum/subscriptions",
      "organizations_url": "https://api.github.com/users/bblum/orgs",
      "repos_url": "https://api.github.com/users/bblum/repos",
      "events_url": "https://api.github.com/users/bblum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bblum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-03T18:44:27Z",
    "updated_at": "2012-08-03T18:46:12Z",
    "body": "one approach might be to add runtime calls to modify a task's atomic refcount - reference the task when it's stored, deref it once the other task is done with it. you can probably solve it more intelligently than that (and should at least figure out what's going on before settling on this..!)... but it might also be useful as a temporary holdover to keep the build clean.\n\nnot sure if this will be of any use, but a comparison:\n\nthe taskgroup stuff also keeps *rust_tasks around, and has other tasks access them without reference counting. the reason this is safe is that the exclusives that contain pointers to a task all act as \"barriers\" to the task exiting - the exit path involves revisiting all those exclusives to remove one's own pointer from them. so the mere presence of a task pointer in a group guarantees its aliveness.\n\nthe path for killing all tasks in a group (i.e., the 'other accessing task') looks like this:\n\n```\ndo group_arc.with |tg| {\n    for each_task(tg) |task| {\n        rustrt::rust_task_kill_other(task);\n    }\n}\n```\n\nearly on, i imagined swapping the tg out of the arc and doing the iteration after the `group_arc.with` block, to avoid holding the taskgroup lock for O(n) time, but you can imagine that would be racy.\n\nI also thought about doing that plus refcounting the pointers, but decided that was a little more complicated. it occurs to me now there's a way to do it without memory penalties - maybe for the future. something like:\n\n```\nlet mut group = none;\ndo group_arc.with |tg| { *tg <-> group; }\nfor each_task(group) |task| {\n    rustrt::rust_task_kill_other(task);\n    rustrt::rust_task_deref(task);\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7490771/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7498009",
    "html_url": "https://github.com/rust-lang/rust/issues/3098#issuecomment-7498009",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3098",
    "id": 7498009,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0OTgwMDk=",
    "user": {
      "login": "eholk",
      "id": 105766,
      "node_id": "MDQ6VXNlcjEwNTc2Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eholk",
      "html_url": "https://github.com/eholk",
      "followers_url": "https://api.github.com/users/eholk/followers",
      "following_url": "https://api.github.com/users/eholk/following{/other_user}",
      "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eholk/subscriptions",
      "organizations_url": "https://api.github.com/users/eholk/orgs",
      "repos_url": "https://api.github.com/users/eholk/repos",
      "events_url": "https://api.github.com/users/eholk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eholk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-04T00:59:59Z",
    "updated_at": "2012-08-04T00:59:59Z",
    "body": "After talking with @bblum a bit, it seems like reference counting in this case is the right way to solve the problem. Basically, you need to make sure the task stays live as long as a pointer to it is in one of the packets.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7498009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
