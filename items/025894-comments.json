[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106993623",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-106993623",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 106993623,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjk5MzYyMw==",
    "user": {
      "login": "Manishearth",
      "id": 1617736,
      "node_id": "MDQ6VXNlcjE2MTc3MzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Manishearth",
      "html_url": "https://github.com/Manishearth",
      "followers_url": "https://api.github.com/users/Manishearth/followers",
      "following_url": "https://api.github.com/users/Manishearth/following{/other_user}",
      "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions",
      "organizations_url": "https://api.github.com/users/Manishearth/orgs",
      "repos_url": "https://api.github.com/users/Manishearth/repos",
      "events_url": "https://api.github.com/users/Manishearth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Manishearth/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-30T06:07:14Z",
    "updated_at": "2015-05-30T12:29:02Z",
    "body": "cc @huonw @aturon @nikomatsakis @pythonesque\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106993623/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107035847",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107035847",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107035847,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzAzNTg0Nw==",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-30T12:32:45Z",
    "updated_at": "2015-05-30T12:33:03Z",
    "body": "cc @alexcrichton \n\nThis seems concerning: this is designed to be thread-local, so that e.g. storing a `Cell` works (which would be safe, if it were guaranteed to stay on one thread). However `static ...: T` currently requires `T: Sync` unconditionally, hence this overly-accepting impl.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107035847/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107036350",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107036350",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107036350,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzAzNjM1MA==",
    "user": {
      "login": "Manishearth",
      "id": 1617736,
      "node_id": "MDQ6VXNlcjE2MTc3MzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Manishearth",
      "html_url": "https://github.com/Manishearth",
      "followers_url": "https://api.github.com/users/Manishearth/followers",
      "following_url": "https://api.github.com/users/Manishearth/following{/other_user}",
      "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions",
      "organizations_url": "https://api.github.com/users/Manishearth/orgs",
      "repos_url": "https://api.github.com/users/Manishearth/repos",
      "events_url": "https://api.github.com/users/Manishearth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Manishearth/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-30T12:39:39Z",
    "updated_at": "2015-05-30T12:39:39Z",
    "body": "Qualifying the impl with `T: Sync` breaks scoped TLS for `Cell` (see the associated PR); because `ScopedKey` becomes `Sync` no longer and thus can't be stuffed inside a static.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107036350/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107050015",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107050015",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107050015,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzA1MDAxNQ==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-30T15:02:25Z",
    "updated_at": "2015-05-30T15:05:41Z",
    "body": "I believe the only way `#[thread_local]` statics can be safe is by _requiring the absence of **Sync**_.\nThat may sound odd, but consider the following:\n- `T: Sync => &T: Send`\n- sending thread-local references across threads is memory unsafe _even with no interior mutability_\n- a `#[thread_local]` static with no interior mutability is almost entirely useless, certainly not a common case\n- non-`Sync` containers offering interior mutabilities are _cheaper_ and _preferred_ to `Sync` ones, where they can be used\n\nThe main issue is actually within the libstd TLS implementation: `LocalKey` is a wrapper for getters so it's unaffected by it, but `ScopedKey` may live in a `#[thread_local]` static or a global one, depending on whether the platform natively supports TLS or not.\n\n`Send`-ing a `&'static ScopedKey` across threads is actually safe on the architectures which _do not_ have native TLS support.\nHowever, allowing it on some architectures and not on others is undesirable.\n\nShould `ScopedKey` use an accessor model like `LocalKey`?\nThen the actual borrow of a `#[thread_local]` static is an implementation detail and happens on the thread where the key is used, not where it was itself borrowed.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107050015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107052894",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107052894",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107052894,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzA1Mjg5NA==",
    "user": {
      "login": "pythonesque",
      "id": 923144,
      "node_id": "MDQ6VXNlcjkyMzE0NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/923144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pythonesque",
      "html_url": "https://github.com/pythonesque",
      "followers_url": "https://api.github.com/users/pythonesque/followers",
      "following_url": "https://api.github.com/users/pythonesque/following{/other_user}",
      "gists_url": "https://api.github.com/users/pythonesque/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pythonesque/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pythonesque/subscriptions",
      "organizations_url": "https://api.github.com/users/pythonesque/orgs",
      "repos_url": "https://api.github.com/users/pythonesque/repos",
      "events_url": "https://api.github.com/users/pythonesque/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pythonesque/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-30T15:23:35Z",
    "updated_at": "2015-05-30T15:24:51Z",
    "body": "\"I believe the only way #[thread_local] statics can be safe is by requiring the absence of `Sync`.\"\n\nThis is wrong, I think.  For example, one might use thread local data for intrusive linked lists of hazard pointers.  They would be thread local but might still be `Sync` (one can guarantee existence with scoped threads or in certain circumstances where threads are bound to cores).  That said you can obviously come up with other representations.  In any case, I've mostly come around to believing that we need a separate `thread_local` lifetime (not just for this, but for things like ensuring that `catch_panic` can't catch an error in a thread that changes thread local data, violating exception safety).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107052894/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107052966",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107052966",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107052966,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzA1Mjk2Ng==",
    "user": {
      "login": "Kimundi",
      "id": 2903206,
      "node_id": "MDQ6VXNlcjI5MDMyMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2903206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kimundi",
      "html_url": "https://github.com/Kimundi",
      "followers_url": "https://api.github.com/users/Kimundi/followers",
      "following_url": "https://api.github.com/users/Kimundi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kimundi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kimundi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kimundi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kimundi/orgs",
      "repos_url": "https://api.github.com/users/Kimundi/repos",
      "events_url": "https://api.github.com/users/Kimundi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kimundi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-30T15:24:44Z",
    "updated_at": "2015-05-30T15:27:27Z",
    "body": "Based on what @eddyb wrote, it seems like the TLS interface requires a `static` that only allows non-`Sync` data and is still accessible like one.\n\nOne idea I had of how to enable this in todays Rust is to make `scoped_thread_local!()` generate a **unit like struct** instead of a `static`. That struct would be `!Sync` and have a `Deref` impl:\n\n```\n// Today:\nRC.set(...); // autoref of static \"RC\" lvalue because:\n\nscoped_thread_local!(static RC: Rc<u8>);\n// = expands to =>\nstatic RC: ScopedKey<Rc<u8>> = ...;\n\n// With this change:\nRC.set(...); // autoref of local temporay \"RC\" rvalue because\n\nscoped_thread_local!(static RC: Rc<u8>);\n// = expands to =>\nstruct RC;\nimpl Deref<Target=Rc<u8>> for RC { \n    static mut ... // can have a !Sync in a static mut\n    ... \n}\nimpl !Sync for RC {}\n```\n\nAccording to @eddyb, this could also help with `LocalKey`, but I'm not familiar enough with the TLS API in general to really reason about this.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107052966/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107066703",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107066703",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107066703,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzA2NjcwMw==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-30T17:10:42Z",
    "updated_at": "2015-05-30T17:10:42Z",
    "body": "@Kimundi I was expecting the `Deref` impl to target an intermediary type, not the contents themselves.\n`ScopedKey` and `LocalKey` have their own APIs to deal with.\n\n@pythonesque You would still be about to use the TLS API provided by libstd with thread-safe data, it's just the low-level `#[thread_local]` which would have the requirement.\n\nIdeas of thread-local lifetimes predate the removal of `'static` from `Send`, and I'm not sure how relevant they are anymore.\nI'm also conflating thread-safe data access and thread lifetime... but how long does a thread live?\nWhat would `&'thread_local T` unify with?\n\nActually, there's an... easy solution for this. Somehow we were blinded by language semantics, but their details are fluid.\nIt is **trivial** to make borrows of `#[thread_local]` behave like borrows of an arbitrary rvalue, allowing the resulting reference to be passed down, but not returned.\n\nThat would ensure that the the thread is just as alive for such borrows as it is for stack ones.\n`ScopedKey` would still require a facade like `LocalKey` has, because it may not be `Sync` when native TLS is supported.\nBut both their APIs are compatible with such a change.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107066703/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107073545",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107073545",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107073545,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzA3MzU0NQ==",
    "user": {
      "login": "pythonesque",
      "id": 923144,
      "node_id": "MDQ6VXNlcjkyMzE0NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/923144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pythonesque",
      "html_url": "https://github.com/pythonesque",
      "followers_url": "https://api.github.com/users/pythonesque/followers",
      "following_url": "https://api.github.com/users/pythonesque/following{/other_user}",
      "gists_url": "https://api.github.com/users/pythonesque/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pythonesque/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pythonesque/subscriptions",
      "organizations_url": "https://api.github.com/users/pythonesque/orgs",
      "repos_url": "https://api.github.com/users/pythonesque/repos",
      "events_url": "https://api.github.com/users/pythonesque/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pythonesque/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-30T18:14:25Z",
    "updated_at": "2015-05-30T18:28:55Z",
    "body": "Wouldn't that limit the usability of thread locals in some cases, though?  e.g., wouldn't that make it difficult to have a thread local point to another thread local?  Maybe I just have to think about it.\n\n(BTW, I'm aware we're just talking about the low-level API :)).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107073545/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107076545",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107076545",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107076545,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzA3NjU0NQ==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-30T19:11:24Z",
    "updated_at": "2015-05-30T19:11:24Z",
    "body": "@pythonesque in a `static`, borrows are `&'static`, I didn't even think of that.\nFirst off, a global static shouldn't be allowed to borrow a `#[thread_local]` static.\nAnd in general, having borrows in a `#[thread_local]` is going to be difficult to support, except for non-`Sync` data, because they would be `'static` right now.\n\nWe could disallow `Sync` borrows or we could give some kind of scope to those borrows.\n\nWhich makes me think, as a compromise between a `thread_local` lifetime and `'static`, there could be a `thread_local` pseudo-(rvalue)-scope.\nCombined with the ability to leave out `'static` in globals' type (or not having a type at all), the scope should bubble up into users of those statics.\n\nThey would behave as if they were borrowed before everything else in the function where they're used, but still not `'static` (and they can't be returned from functions).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107076545/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107633188",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107633188",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107633188,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzYzMzE4OA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-01T16:47:57Z",
    "updated_at": "2015-06-01T16:47:57Z",
    "body": "There's a few intertwined issues here at play, so I just want to quickly summarize the way I see things:\n- This does not affect `LocalKey` as it [uses a `static`](https://github.com/rust-lang/rust/blob/3e561f05c00cd180ec02db4ccab2840a4aba93d2/src/libstd/thread/local.rs#L108) which has an [indirect accessor](https://github.com/rust-lang/rust/blob/3e561f05c00cd180ec02db4ccab2840a4aba93d2/src/libstd/thread/local.rs#L115), which while sound [may result in perf problems](https://github.com/rust-lang/rust/issues/25088)\n- #18001 should be fixed, allowing removal of the `unsafe impl` block for `Sync`.\n- A borrow of a `#[thread_local]` static should not yield something with the `'static` lifetime, as that is clearly not sound.\n\nI'm not sure I follow why we might require the types in a `#[thread_local]` are _not_ `Sync`, I haven't quite followed that. Due the cross-platform requirements of std, however, I believe the best solution here is to use the same strategy as `LocalKey` with an indirect accessor to ensure the semantics are the same across platforms that have `#[thread_local]` and those that don't (where a normal `static` is used).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107633188/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107643334",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107643334",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107643334,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzY0MzMzNA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-01T17:14:48Z",
    "updated_at": "2015-06-01T17:14:48Z",
    "body": "triage: P-medium\n\nThis is an unstable API so it's not super-high priority to fix, but we should defnitely fix!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107643334/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107652889",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107652889",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107652889,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzY1Mjg4OQ==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-01T17:50:22Z",
    "updated_at": "2015-06-01T17:50:22Z",
    "body": "@alexcrichton requiring that a `#[thread_local]` is **not** `Sync` is an easy way to ensure that a borrow of it, while `'static`, cannot escape the current thread.\n\nI've changed my mind and prefer an rvalue borrow semantic for `#[thread_local]`, but it still is the case that `LocalKey` and `ScopedKey` use non-`Sync` `#[thread_local]` statics (ignoring the workarounds for #18001).\n\nIf `#[thread_local]` was supported everywhere, having rvalue borrow semantics wouldn't hurt the std TLS API (aside from stability issues with `LocalKey`), as the access patterns are already through anonymous lifetimes (references passed to closures).\n\nMaybe a combined strategy, where borrows of `#[thread_local]` statics are `'static` iff the data is **not** `Sync` (and rvalue-like otherwise), might work better and would require fewer changes to the std TLS implementation.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107652889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107662832",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107662832",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107662832,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzY2MjgzMg==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-01T18:22:29Z",
    "updated_at": "2015-06-01T18:22:29Z",
    "body": "> @alexcrichton requiring that a #[thread_local] is not Sync is an easy way to ensure that a borrow of it, while 'static, cannot escape the current thread.\n\nRight, but returning a borrow with a `'static` lifetime for a `#[thread_local]` global is unsafe for other reasons (the lifetime of the thread is not `'static`).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107662832/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107669952",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107669952",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107669952,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzY2OTk1Mg==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-01T18:52:07Z",
    "updated_at": "2015-06-01T18:52:07Z",
    "body": "@alexcrichton how can it be abused without sending it to a different thread?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107669952/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107696724",
    "html_url": "https://github.com/rust-lang/rust/issues/25894#issuecomment-107696724",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25894",
    "id": 107696724,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNzY5NjcyNA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-01T20:27:05Z",
    "updated_at": "2015-06-01T20:27:05Z",
    "body": "> how can it be abused without sending it to a different thread?\n\nThe actual values themselves do not have a `'static` lifetime, so it can be a source of unsafety to advertise otherwise. For example you could stick a `&'static T` into a TLS value with a destructor, but when the destructor runs that pointer could be invalid.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/107696724/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
