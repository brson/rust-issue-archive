[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20569292",
    "html_url": "https://github.com/rust-lang/rust/issues/6315#issuecomment-20569292",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/6315",
    "id": 20569292,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwNTY5Mjky",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-07T11:17:54Z",
    "updated_at": "2013-07-07T11:17:54Z",
    "body": "Still relevant\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/20569292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22869149",
    "html_url": "https://github.com/rust-lang/rust/issues/6315#issuecomment-22869149",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/6315",
    "id": 22869149,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyODY5MTQ5",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-19T12:48:19Z",
    "updated_at": "2013-08-19T12:51:30Z",
    "body": "Triage visit: appears to still be an issue. The first few lines of output of `make -n VERBOSE=1 rt/<platform>/stage0/libuv/libuv.a` (with extra line breaks):\n\n### i686-pc-mingw32\n\n```\ngcc -I/d/stone/rust-vanilla/src/libuv/include -I/d/stone/rust-vanilla/src/libuv/include/uv-private \n    -g --std=gnu89 -D_WIN32_WINNT=0x0600 -I/d/stone/rust-vanilla/src/libuv/include \n    -I/d/stone/rust-vanilla/src/libuv/include/uv-private  -c \n    -o /d/stone/rust-vanilla/src/libuv/src/win/async.o\n    /d/stone/rust-vanilla/src/libuv/src/win/async.c\ngcc -I/d/stone/rust-vanilla/src/libuv/include -I/d/stone/rust-vanilla/src/libuv/include/uv-private \n    -g --std=gnu89 -D_WIN32_WINNT=0x0600 -I/d/stone/rust-vanilla/src/libuv/include \n    -I/d/stone/rust-vanilla/src/libuv/include/uv-private  -c\n    -o /d/stone/rust-vanilla/src/libuv/src/win/core.o\n    /d/stone/rust-vanilla/src/libuv/src/win/core.c\ngcc -I/d/stone/rust-vanilla/src/libuv/include -I/d/stone/rust-vanilla/src/libuv/include/uv-private \n    -g --std=gnu89 -D_WIN32_WINNT=0x0600 -I/d/stone/rust-vanilla/src/libuv/include \n    -I/d/stone/rust-vanilla/src/libuv/include/uv-private  -c \n    -o /d/stone/rust-vanilla/src/libuv/src/win/dl.o\n    /d/stone/rust-vanilla/src/libuv/src/win/dl.c\n```\n\n### x86_64-unknown-linux-gnu\n\n```\ngcc --std=c89 -pedantic -Wall -Wextra -Wno-unused-parameter -D_GNU_SOURCE \n    -I/home/huon/rust/src/libuv/include -I/home/huon/rust/src/libuv/include/uv-private \n    -I/home/huon/rust/src/libuv/src -D_LARGEFILE_SOURCE \n    -D_FILE_OFFSET_BITS=64 -DRUST_DEBUG -fno-omit-frame-pointer \n    -DUSE_UTF8 -O2 -m64 -fPIC  -c /home/huon/rust/src/libuv/src/unix/async.c \n    -o src/unix/async.o\ngcc --std=c89 -pedantic -Wall -Wextra -Wno-unused-parameter -D_GNU_SOURCE\n    -I/home/huon/rust/src/libuv/include -I/home/huon/rust/src/libuv/include/uv-private\n    -I/home/huon/rust/src/libuv/src -D_LARGEFILE_SOURCE \n    -D_FILE_OFFSET_BITS=64 -DRUST_DEBUG -fno-omit-frame-pointer\n    -DUSE_UTF8 -O2 -m64 -fPIC  -c /home/huon/rust/src/libuv/src/unix/core.c\n    -o src/unix/core.o\ngcc --std=c89 -pedantic -Wall -Wextra -Wno-unused-parameter -D_GNU_SOURCE\n    -I/home/huon/rust/src/libuv/include -I/home/huon/rust/src/libuv/include/uv-private\n    -I/home/huon/rust/src/libuv/src -D_LARGEFILE_SOURCE\n    -D_FILE_OFFSET_BITS=64 -DRUST_DEBUG -fno-omit-frame-pointer\n    -DUSE_UTF8 -O2 -m64 -fPIC  -c /home/huon/rust/src/libuv/src/unix/dl.c\n    -o src/unix/dl.o\n```\n\nThe flags are _extremely_ different for the former: it appears that none of our CFLAGS get passed to libuv.\n\nAlso, as @klutzy points out, there's a FIXME in `rt.mk`:\n\n```\n# FIXME: For some reason libuv's makefiles can't figure out the\n# correct definition of CC on the mingw I'm using, so we are\n# explicitly using gcc. Also, we have to list environment variables\n# first on windows... mysterious\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22869149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22878311",
    "html_url": "https://github.com/rust-lang/rust/issues/6315#issuecomment-22878311",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/6315",
    "id": 22878311,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyODc4MzEx",
    "user": {
      "login": "klutzy",
      "id": 1589355,
      "node_id": "MDQ6VXNlcjE1ODkzNTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klutzy",
      "html_url": "https://github.com/klutzy",
      "followers_url": "https://api.github.com/users/klutzy/followers",
      "following_url": "https://api.github.com/users/klutzy/following{/other_user}",
      "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions",
      "organizations_url": "https://api.github.com/users/klutzy/orgs",
      "repos_url": "https://api.github.com/users/klutzy/repos",
      "events_url": "https://api.github.com/users/klutzy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klutzy/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-19T15:02:02Z",
    "updated_at": "2013-08-19T15:04:29Z",
    "body": "The issue occurs on windows only because `CFLAGS` are passed on other platforms:\n#6176 added CFLAGS for all platforms but due to regression issues (#6253 #6279) windows stuff was removed by #6295.\n$(CC) is also not explicitly passed on windows. It's the answer for FIXME.\n\nCurrently we pass `CC` and `CFLAGS` to libuv/Makefile explicitly (from mk/rt.mk):\n\n```\n    $$(Q)$$(MAKE) -C $$(S)src/libuv/ \\\n        CFLAGS=\"$$(CFG_GCCISH_CFLAGS) $$(LIBUV_FLAGS_$$(HOST_$(1))) $$(SNAP_DEFINES)\" \\\n        LDFLAGS=\"$$(CFG_GCCISH_LINK_FLAGS) $$(LIBUV_FLAGS_$$(HOST_$(1)))\" \\\n        CC=\"$$(CC_$(1))\" \\\n        CXX=\"$$(CXX_$(1))\" \\\n        AR=\"$$(AR_$(1))\" \\\n        builddir_name=\"$$(CFG_BUILD_DIR)/rt/$(1)/stage$(2)/libuv\" \\\n        V=$$(VERBOSE)\n```\n\nHowever, this prevents any redefinition of `CFLAGS` in libuv's Makefile: any `CFLAGS=...` or `CFLAGS+=...` are [ignored if `CFLAGS=...` is passed by argument](http://www.gnu.org/software/make/manual/html_node/Overriding.html).\n\nYes, it can be problematic for any platform, but regression was only fatal on windows. It's because libuv has two sub makefiles named `config-mingw.mk` and `config-unix.mk` and they differ greatly.\n`config-mingw.mk` has\n\n```\nCFLAGS=$(CPPFLAGS) -g --std=gnu89 -D_WIN32_WINNT=0x0600\n```\n\nwhere `CPPFLAGS += -I$(SRCDIR)/include -I$(SRCDIR)/include/uv-private` (libuv/build.mk). Since the line was ignored, include paths became wrong. (Also note that CFLAGS is just defined, not appended)\n\nBy contrast, `config-unix.mk` only contains `CFLAGS += -g`. You can see @huonw's result so that there's no \"-g\" on linux.\nThere may be more lurking issues due to this.\n\nThe simplest solution is adding `override` keyword at `config-*.mk` and replacing \"=\" with \"+=\" at `config-mingw.mk` e.g.:\n\n```\noverride CFLAGS+=$(CPPFLAGS) -g --std=gnu89 -D_WIN32_WINNT=0x0600\n```\n\nI guess there exists a better solution but don't know :)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22878311/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
