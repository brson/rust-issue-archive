[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49596858",
    "html_url": "https://github.com/rust-lang/rust/issues/15854#issuecomment-49596858",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15854",
    "id": 49596858,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTk2ODU4",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T11:57:43Z",
    "updated_at": "2014-07-23T06:08:42Z",
    "body": "> I've created a discussion topic on Reddit, but for some reason it disappeared from the Rust page, so I'm filling an issue here. If there's a better place to discuss similar suggestions, please tell me.\n\n(Posts and comments with `is.gd` links get immediately killed by the reddit spam filter, I've approved your post for now, and added some hints about avoiding the spam filter to the end of the sidebar.)\n\n---\n\nThis behaviour is not similar to the C `do while` hack, and isn't at all related to the _syntactic_ form to which they expand. If you drop a semicolon on a \"statement-y thing\" (a macro invocation, an `if` or a `match`) the compiler enforces that the return type is `()`, e.g. [this is ok](http://play.rust-lang.org/?run=1&code=%23![feature%28macro_rules%29]%0A%0Afn%20returns_unit%28%29%20{%20}%0A%0Amacro_rules!%20function%28%20%28%29%20%3D%3E%20{%20returns_unit%28%29%20}%20%29%0A%0Afn%20main%28%29%20{%0A%20%20%20%20function!%28%29%0A%20%20%20%20function!%28%29%0A%20%20%20%20function!%28%29%0A}):\n\n``` rust\n#![feature(macro_rules)]\n\nfn returns_unit() { }\n\nmacro_rules! function( () => { returns_unit() } )\n\nfn main() {\n    function!()\n    function!()\n    function!()\n}\n```\n\n(But `fn returns_u8() -> u8 { 0 }` would not, without adding more semicolons.)\n\nThe only reason the `match` is being used is because:\n- `println!` should only 'evaluate' each argument once (it's a syntactic transformation which can duplicate AST nodes, causing things to be called twice),\n- a reference needs to be taken, to avoid moving variables,\n- any rvalue variables (e.g. the `foo()` in `println!(\"{}\", foo())`) needs to live long enough for all the manipulation that is being done.\n\n---\n\nMacros are proper AST items, and cannot expand to things like a half statement or a partial declaration, e.g. a macro cannot expand to just `if x`, it has to include the `{ ... }` part of the code. Furthermore, the following doesn't work\n\n``` rust\nmacro_rules! if_true { () => { if true {} } }\n\n// try to merge the `else` into the `if\nif_true!() else {}\n```\n\ni.e. the contents of a macro are truly contained (other than any actual item definitions they introduce, but theoretically hygiene means these are also implied by each invocation).\n\nI think this semicolon behaviour is more to give a form of consistency for macros that define things (One doesn't have to put `;`s after nested functions, or other nested item definitions) and for those that act as control flow (one can drop `;` after `if`, `match`, `while` etc. with the type restriction noted above), e.g. \n\n``` rust\nfn main() {\n    macro_rules! foo {\n        (...) => { ... }\n    }    \n\n    if true { foo!(1, 2) } else { foo!(3, 4); bar() }\n}\n```\n\n---\n\nIn any case. I fail to see how a self invoking function is any nicer than just expanding to a normal `{ ... }` block (or a `match` if the specific temporary variable requirement noted above is relevant, which it isn't for most macros).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49596858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49600306",
    "html_url": "https://github.com/rust-lang/rust/issues/15854#issuecomment-49600306",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15854",
    "id": 49600306,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjAwMzA2",
    "user": {
      "login": "justanotheranonymoususer",
      "id": 5781692,
      "node_id": "MDQ6VXNlcjU3ODE2OTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5781692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/justanotheranonymoususer",
      "html_url": "https://github.com/justanotheranonymoususer",
      "followers_url": "https://api.github.com/users/justanotheranonymoususer/followers",
      "following_url": "https://api.github.com/users/justanotheranonymoususer/following{/other_user}",
      "gists_url": "https://api.github.com/users/justanotheranonymoususer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/justanotheranonymoususer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/justanotheranonymoususer/subscriptions",
      "organizations_url": "https://api.github.com/users/justanotheranonymoususer/orgs",
      "repos_url": "https://api.github.com/users/justanotheranonymoususer/repos",
      "events_url": "https://api.github.com/users/justanotheranonymoususer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/justanotheranonymoususer/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T12:41:46Z",
    "updated_at": "2014-07-21T12:41:46Z",
    "body": "> In any case. I fail to see how a self invoking function is any nicer than just expanding to a normal { ... } block (or a match if the specific temporary variable requirement noted above is relevant, which it isn't for most macros).\n\nMy intention was so that `println!(\"...\")` will behave the same way as `returns_unit()`.\n\ne.g. [here](http://is.gd/CZ7Y8u) we have:\n\n```\n    fn () {\n        // implementation\n        ::std::io::stdio::println_args(&__args)\n    }()\n```\n\nThis is a function call, so it must be followed by a semicolon, the same way as `returns_unit()`. But if `println` is the last command in the scope, it's used as a return value, just like with `returns_unit()`.\n\nI'm just learning Rust, so I don't know well how macros work yet, but I hope that my intention is clear. Does it make sense?\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49600306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49601570",
    "html_url": "https://github.com/rust-lang/rust/issues/15854#issuecomment-49601570",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15854",
    "id": 49601570,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjAxNTcw",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T12:55:39Z",
    "updated_at": "2014-07-21T12:59:55Z",
    "body": "As I said above, whether a `;` is required is not related to _what_ the macro expands (i.e. the compiler doesn't care about what function invocations or loops or whatever you have inside your macro), but rather to the type of the expanded result. Or, to put it another way, if a macro is invoked without a `;`, then the type checker ensures the result of the macro is `()` (if it is an expression).\n\nSo it sounds a little like your proposal also requires changing the semicolon rules, to be based on the actual AST structures to which the macro expands.  (Rather than just imposing the type requirement of the expanded result, as is currently done.)\n\nAlso, in Rust, an anonymous functions don't really work like that:\n1. it need a closure, a `fn` is just a bare function, with no captured variables, \n2. it needs to be avoid our current `||` closures, due to not being able to move out of variables (because of compulsory capture by-reference) and non-guaranteed performance (due to dynamic dispatch); both are addressed by the nearly complete 'closure reform', but...\n3. even with the reformed closures, it would need to have some form of by-value/by-reference inference, because some variables will be consumed in the macro invocation and others will not.\n\nIn JS, all functions are closures implicitly, and neither of 2 or 3 apply: there's no language-level alternative to the dynamic dispatch (and Rust is aiming at a space where always-dynamic is not justifiable) and there's no concept of by-value/by-reference or moving of variables.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49601570/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49602387",
    "html_url": "https://github.com/rust-lang/rust/issues/15854#issuecomment-49602387",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15854",
    "id": 49602387,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjAyMzg3",
    "user": {
      "login": "justanotheranonymoususer",
      "id": 5781692,
      "node_id": "MDQ6VXNlcjU3ODE2OTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5781692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/justanotheranonymoususer",
      "html_url": "https://github.com/justanotheranonymoususer",
      "followers_url": "https://api.github.com/users/justanotheranonymoususer/followers",
      "following_url": "https://api.github.com/users/justanotheranonymoususer/following{/other_user}",
      "gists_url": "https://api.github.com/users/justanotheranonymoususer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/justanotheranonymoususer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/justanotheranonymoususer/subscriptions",
      "organizations_url": "https://api.github.com/users/justanotheranonymoususer/orgs",
      "repos_url": "https://api.github.com/users/justanotheranonymoususer/repos",
      "events_url": "https://api.github.com/users/justanotheranonymoususer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/justanotheranonymoususer/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T13:04:43Z",
    "updated_at": "2014-07-21T13:04:43Z",
    "body": "Thank you for the response. I don't think I have enough background to continue the discussion. I was just bothered by the inconsistency of functions vs macros, and tried to propose a solution without actually understanding how things work.\n\nIf you think that my suggestion is invalid, feel free to close the issue.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49602387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49603021",
    "html_url": "https://github.com/rust-lang/rust/issues/15854#issuecomment-49603021",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15854",
    "id": 49603021,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjAzMDIx",
    "user": {
      "login": "sinistersnare",
      "id": 2153833,
      "node_id": "MDQ6VXNlcjIxNTM4MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2153833?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sinistersnare",
      "html_url": "https://github.com/sinistersnare",
      "followers_url": "https://api.github.com/users/sinistersnare/followers",
      "following_url": "https://api.github.com/users/sinistersnare/following{/other_user}",
      "gists_url": "https://api.github.com/users/sinistersnare/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sinistersnare/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sinistersnare/subscriptions",
      "organizations_url": "https://api.github.com/users/sinistersnare/orgs",
      "repos_url": "https://api.github.com/users/sinistersnare/repos",
      "events_url": "https://api.github.com/users/sinistersnare/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sinistersnare/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-21T13:11:03Z",
    "updated_at": "2014-07-21T13:11:03Z",
    "body": "@justanotheranonymoususer You raise a valid concern, usability for beginners. \n\nHaving semicolons sometimes and sometimes not is strange. Even if it is technically correct, it is still ergonomically weird.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49603021/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52545526",
    "html_url": "https://github.com/rust-lang/rust/issues/15854#issuecomment-52545526",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15854",
    "id": 52545526,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNTQ1NTI2",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-18T19:54:38Z",
    "updated_at": "2014-08-18T19:54:38Z",
    "body": "Given that this kind of change would require an RFC, and it's not likely to be changed without serious work on said RFC, I think we should just close this issue.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52545526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71281770",
    "html_url": "https://github.com/rust-lang/rust/issues/15854#issuecomment-71281770",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15854",
    "id": 71281770,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjgxNzcw",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-23T23:04:12Z",
    "updated_at": "2015-01-23T23:04:12Z",
    "body": "I'm pulling a massive triage effort to get us ready for 1.0. As part of this, I'm moving stuff that's wishlist-like to the RFCs repo, as that's where major new things should get discussed/prioritized.\n\nThis issue has been moved to the RFCs repo: rust-lang/rfcs#728\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71281770/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
