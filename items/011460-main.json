{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/11460",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/11460/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/11460/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/11460/events",
  "html_url": "https://github.com/rust-lang/rust/pull/11460",
  "id": 25429661,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTE0MjA3MDM=",
  "number": 11460,
  "title": "RFC: Diagnostic registry prototype",
  "user": {
    "login": "brson",
    "id": 147214,
    "node_id": "MDQ6VXNlcjE0NzIxNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/brson",
    "html_url": "https://github.com/brson",
    "followers_url": "https://api.github.com/users/brson/followers",
    "following_url": "https://api.github.com/users/brson/following{/other_user}",
    "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
    "organizations_url": "https://api.github.com/users/brson/orgs",
    "repos_url": "https://api.github.com/users/brson/repos",
    "events_url": "https://api.github.com/users/brson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/brson/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 8,
  "created_at": "2014-01-10T23:12:16Z",
  "updated_at": "2014-06-12T15:33:12Z",
  "closed_at": "2014-02-10T02:06:03Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/11460",
    "html_url": "https://github.com/rust-lang/rust/pull/11460",
    "diff_url": "https://github.com/rust-lang/rust/pull/11460.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/11460.patch",
    "merged_at": null
  },
  "body": "This is the beginning of a solution for #2092, which calls for linking rustc errors to FAQs that better explain what the errors mean. It's just barely started, but I'm asking for feedback now because it depends on a set of private syntax extensions that are huge hacks, and they need to be snapshotted for work to continue.\n\nMy intention is to get the infrastructure in place, get all errors converted to this system, then encourage people who encounter errors to start adding docs.\n\nThe core idea is that every individual diagnostic message has a corresponding globally unique and stable code, which are registered in a central location (primarily so they are easy to track), each raised error must specify a diagnostic code. There is an additional database containing optional extended descriptions of diagnostic codes. This database can be used by the compiler itself to emit extended information or it may be used to generate standalone documentation.\n\nSome simple tricks are used to statically ensure that diagnostic codes are used correctly, and to allow string literals to be reused without duplication.\n\nThe design is intended to put minimal burden on compiler writers; the amount of code needed to raise an error is comparable to what we have today, and the primary diagnostic message is still inline at the site where it is raised.\n\nIn use the system consists of three phases which occur in _lexical_ order.\n## Diagnostic registry\n\nThe first module of each crate that uses these diagnostics is called `mod diag_index` and simply contains lines like the following:\n\n```\nreg_diag!(A0000)\nreg_diag!(A0001)\nreg_diag!(A0002)\n...\n```\n\nThis registers all the diagnostic codes used by the crate. This registry is used to validate that codes are used correctly in later phases, but also as a convenient way to keep track of which codes have been used. As codes are retired from use they will remain in this file forever, never to be reused again. The naming convention for codes is debatable but I've chosen a letter plus 4 digits. The letter is just a very simple namespace so that multiple crates can keep their own independent lists of diagnostic codes.\n## Reporting\n\nThis takes the place of our current calls to e.g. `sess.span_fatal`. Instead of calling the diagnostic functions directly now you use a macro like `raise_fatal!(sess, sp, A0001, \"Error in module {}\", modname)`. These macros do 4 things:\n\n1) Ensure that the diagnostic code is registered (statically).\n2) Prevents reuse of the same code for multiple diagnostics.\n3) Record the diagnostic message (in compile-time state) so it can be used later in the database.\n4) Defer to the session to report the diagnostic\n## Extended documentation\n\nFinally, the last module in the crate is called `diag_db` and contains a single function called `load`, which can be used to get a vector of all diagnostics that have extended documentation, along with their primary diagnostic message, and the extended documentation. This module `include!`s a list of `diag_desc!` macros that document the diagnostic codes as markdown.\n# Future direction\n\nAfter the snapshot goes through I'll convert all the diagnostics in all our tools to use this; add the full complement of diagnostic reporting macros; add some language to our error reporting indicating whether there's extended information; add a diagnostic message indicating how to contribute extended diagnostics when there are non; add a flag to retrieve extended info; add a flag to dump all extended diagnostics as mardown; and begin testing the extended documentation.\n",
  "closed_by": {
    "login": "brson",
    "id": 147214,
    "node_id": "MDQ6VXNlcjE0NzIxNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/brson",
    "html_url": "https://github.com/brson",
    "followers_url": "https://api.github.com/users/brson/followers",
    "following_url": "https://api.github.com/users/brson/following{/other_user}",
    "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
    "organizations_url": "https://api.github.com/users/brson/orgs",
    "repos_url": "https://api.github.com/users/brson/repos",
    "events_url": "https://api.github.com/users/brson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/brson/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/11460/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/11460/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
