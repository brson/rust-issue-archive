[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67762827",
    "html_url": "https://github.com/rust-lang/rust/issues/20097#issuecomment-67762827",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20097",
    "id": 67762827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzYyODI3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-21T07:34:23Z",
    "updated_at": "2014-12-21T07:34:23Z",
    "body": "cc @nick29581, @luqmana \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67762827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67775138",
    "html_url": "https://github.com/rust-lang/rust/issues/20097#issuecomment-67775138",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20097",
    "id": 67775138,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3Nzc1MTM4",
    "user": {
      "login": "shepmaster",
      "id": 174509,
      "node_id": "MDQ6VXNlcjE3NDUwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/174509?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shepmaster",
      "html_url": "https://github.com/shepmaster",
      "followers_url": "https://api.github.com/users/shepmaster/followers",
      "following_url": "https://api.github.com/users/shepmaster/following{/other_user}",
      "gists_url": "https://api.github.com/users/shepmaster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shepmaster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shepmaster/subscriptions",
      "organizations_url": "https://api.github.com/users/shepmaster/orgs",
      "repos_url": "https://api.github.com/users/shepmaster/repos",
      "events_url": "https://api.github.com/users/shepmaster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shepmaster/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-21T16:14:51Z",
    "updated_at": "2014-12-21T16:14:51Z",
    "body": "I forgot to add that by explicitly casting, the crash goes away:\n\n``` rust\nlet t: Box<Thing> = match true {\n    true => box Thing1 { name: \"hello\".to_string() } as Box<Thing>,\n    _    => box Thing2 { name: \"hello\".to_string() } as Box<Thing>,\n};\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67775138/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67797612",
    "html_url": "https://github.com/rust-lang/rust/issues/20097#issuecomment-67797612",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20097",
    "id": 67797612,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3Nzk3NjEy",
    "user": {
      "login": "jkleint",
      "id": 931505,
      "node_id": "MDQ6VXNlcjkzMTUwNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/931505?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jkleint",
      "html_url": "https://github.com/jkleint",
      "followers_url": "https://api.github.com/users/jkleint/followers",
      "following_url": "https://api.github.com/users/jkleint/following{/other_user}",
      "gists_url": "https://api.github.com/users/jkleint/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jkleint/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jkleint/subscriptions",
      "organizations_url": "https://api.github.com/users/jkleint/orgs",
      "repos_url": "https://api.github.com/users/jkleint/repos",
      "events_url": "https://api.github.com/users/jkleint/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jkleint/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-22T03:01:23Z",
    "updated_at": "2014-12-22T03:01:23Z",
    "body": "+1, just ran into this same issue with today's nightly on Linux, with almost the exact same code and workaround.\n\n(I'm a little jealous, my `--version` `\"does not take an argument\"` though... )\n\n```\n$ rustc -v --version\nrustc 0.13.0-nightly (cc19e3380 2014-12-20 20:00:36 +0000)\nbinary: rustc\ncommit-hash: cc19e3380b4b7c63b6f1f79d1dfc213ea00e16cf\ncommit-date: 2014-12-20 20:00:36 +0000\nhost: x86_64-unknown-linux-gnu\nrelease: 0.13.0-nightly\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67797612/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68616387",
    "html_url": "https://github.com/rust-lang/rust/issues/20097#issuecomment-68616387",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20097",
    "id": 68616387,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NjE2Mzg3",
    "user": {
      "login": "carllerche",
      "id": 6180,
      "node_id": "MDQ6VXNlcjYxODA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6180?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carllerche",
      "html_url": "https://github.com/carllerche",
      "followers_url": "https://api.github.com/users/carllerche/followers",
      "following_url": "https://api.github.com/users/carllerche/following{/other_user}",
      "gists_url": "https://api.github.com/users/carllerche/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carllerche/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carllerche/subscriptions",
      "organizations_url": "https://api.github.com/users/carllerche/orgs",
      "repos_url": "https://api.github.com/users/carllerche/repos",
      "events_url": "https://api.github.com/users/carllerche/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carllerche/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-04T01:05:24Z",
    "updated_at": "2015-01-04T01:05:24Z",
    "body": "I believe that I am hitting this issue as well. Here is my repro:\n\n``` rust\n#![allow(dead_code)]\n\npub trait Foo : Send {\n    fn foo<'a>(me: Managed<'a, Self>);\n}\n\npub trait BoxedFoo : Send {\n    fn foo_boxed(self: Box<Self>);\n}\n\npub trait ToFoo<F: Foo> {\n    fn to_box(self) -> Box<BoxedFoo>;\n}\n\n/*\n *\n * ===== impl Foo for String =====\n *\n */\n\nimpl Foo for String {\n    fn foo<'a>(me: Managed<'a, Self>) {\n        println!(\"foo: {}\", me.take());\n    }\n}\n\nimpl<F: Foo> BoxedFoo for F {\n    fn foo_boxed(self: Box<Self>) {\n        Foo::foo(Managed::heap(self));\n    }\n}\n\nimpl<F: Foo> ToFoo<F> for F {\n    fn to_box(self) -> Box<BoxedFoo> {\n        box self\n    }\n}\n\nimpl<'a, F: Foo> ToFoo<F> for Managed<'a, F> {\n    fn to_box(self) -> Box<BoxedFoo> {\n        match self.store {\n            Store::Heap(boxed) => boxed,\n            Store::Stack(opt) => box opt.take().unwrap(),\n        }\n    }\n}\n\n/*\n *\n * ===== Managed =====\n *\n */\n\npub struct Managed<'a, T:'a> {\n    store: Store<'a, T>,\n}\n\nimpl<'a, T> Managed<'a, T> {\n    fn heap(val: Box<T>) -> Managed<'a, T> {\n        Managed { store: Store::Heap(val) }\n    }\n\n    fn take(self) -> T {\n        match self.store {\n            Store::Heap(boxed) => *boxed,\n            Store::Stack(opt) => opt.take().expect(\"option is none\"),\n        }\n    }\n}\n\nenum Store<'a, T:'a> {\n    Heap(Box<T>), // Callback is already heap allocated\n    Stack(&'a mut Option<T>), // Callback is stack allocated\n}\n\nfn do_foo<T: ToFoo<F>, F: Foo>(f: T) {\n    f.to_box().foo_boxed();\n}\n\npub fn main() {\n    do_foo(Managed::heap(box \"foo\".to_string()));\n}\n```\n\nBacktrace:\n\n```\nProcess 14641 launched: './segv' (x86_64)\nProcess 14641 stopped\n* thread #1: tid = 0x1c03, 0x0000000100002e98 segv`Box$LT$BoxedFoo$u{20}$u{2b}$u{20}$u{27}static$GT$::glue_drop.1583::h37e40b03ca5bab2f + 72, stop reason = EXC_BAD_ACCESS (code=1, address=0x10)\n    frame #0: 0x0000000100002e98 segv`Box$LT$BoxedFoo$u{20}$u{2b}$u{20}$u{27}static$GT$::glue_drop.1583::h37e40b03ca5bab2f + 72\nsegv`Box$LT$BoxedFoo$u{20}$u{2b}$u{20}$u{27}static$GT$::glue_drop.1583::h37e40b03ca5bab2f + 72:\n-> 0x100002e98:  movq   (%rcx), %rcx\n   0x100002e9b:  movq   %rax, %rdi\n   0x100002e9e:  callq  *%rcx\n   0x100002ea0:  jmp    0x100002e8a               ; Box$LT$BoxedFoo$u{20}$u{2b}$u{20}$u{27}static$GT$::glue_drop.1583::h37e40b03ca5bab2f + 58\n```\n\nRustc:\n\n```\n$ rustc --version\nrustc 0.13.0-nightly (fc2ba1393 2015-01-03 05:35:17 +0000)\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68616387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/70427152",
    "html_url": "https://github.com/rust-lang/rust/issues/20097#issuecomment-70427152",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20097",
    "id": 70427152,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDI3MTUy",
    "user": {
      "login": "kevinmehall",
      "id": 119951,
      "node_id": "MDQ6VXNlcjExOTk1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/119951?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevinmehall",
      "html_url": "https://github.com/kevinmehall",
      "followers_url": "https://api.github.com/users/kevinmehall/followers",
      "following_url": "https://api.github.com/users/kevinmehall/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevinmehall/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevinmehall/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevinmehall/subscriptions",
      "organizations_url": "https://api.github.com/users/kevinmehall/orgs",
      "repos_url": "https://api.github.com/users/kevinmehall/repos",
      "events_url": "https://api.github.com/users/kevinmehall/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevinmehall/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-18T21:34:02Z",
    "updated_at": "2015-01-18T21:34:02Z",
    "body": "Another workaround is to put the body of the match arm in `{}`. I also noticed that this bug doesn't affect the last arm of the match.\n\n``` .rs\n#![feature(box_syntax)]\nstruct S1(u32);\ntrait T {}\nimpl T for S1 {}\n\n#[cfg(broken)]\nfn tst(foo: u8) -> Box<T + 'static> {\n    match foo {\n        0 => box S1(5),\n        _ => box S1(6),\n    }\n}\n\n#[cfg(works1)]\nfn tst(foo: u8) -> Box<T + 'static> {\n    match foo{\n        0 => { box S1(5) },\n        _ => { box S1(6) },\n    }\n}\n\n#[cfg(works2)]\nfn tst(foo: u8) -> Box<T + 'static> {\n    match foo{\n        0 => box S1(5) as Box<T + 'static>,\n        _ => box S1(6) as Box<T + 'static>,\n    }\n}\n\nfn main() {\n    tst(0);\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/70427152/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75419767",
    "html_url": "https://github.com/rust-lang/rust/issues/20097#issuecomment-75419767",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20097",
    "id": 75419767,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDE5NzY3",
    "user": {
      "login": "kevinmehall",
      "id": 119951,
      "node_id": "MDQ6VXNlcjExOTk1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/119951?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevinmehall",
      "html_url": "https://github.com/kevinmehall",
      "followers_url": "https://api.github.com/users/kevinmehall/followers",
      "following_url": "https://api.github.com/users/kevinmehall/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevinmehall/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevinmehall/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevinmehall/subscriptions",
      "organizations_url": "https://api.github.com/users/kevinmehall/orgs",
      "repos_url": "https://api.github.com/users/kevinmehall/repos",
      "events_url": "https://api.github.com/users/kevinmehall/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevinmehall/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-22T04:54:35Z",
    "updated_at": "2015-02-22T04:54:35Z",
    "body": "I think this is a duplicate of #21695, and thus @pnkfelix fixed it in #21692.\nIn any case, my example above no longer crashes on `rustc 1.0.0-nightly (522d09dfe 2015-02-19)`\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75419767/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75442967",
    "html_url": "https://github.com/rust-lang/rust/issues/20097#issuecomment-75442967",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20097",
    "id": 75442967,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDQyOTY3",
    "user": {
      "login": "shepmaster",
      "id": 174509,
      "node_id": "MDQ6VXNlcjE3NDUwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/174509?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shepmaster",
      "html_url": "https://github.com/shepmaster",
      "followers_url": "https://api.github.com/users/shepmaster/followers",
      "following_url": "https://api.github.com/users/shepmaster/following{/other_user}",
      "gists_url": "https://api.github.com/users/shepmaster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shepmaster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shepmaster/subscriptions",
      "organizations_url": "https://api.github.com/users/shepmaster/orgs",
      "repos_url": "https://api.github.com/users/shepmaster/repos",
      "events_url": "https://api.github.com/users/shepmaster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shepmaster/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-22T16:19:12Z",
    "updated_at": "2015-02-22T16:19:12Z",
    "body": "@kevinmehall I think that #21695 is a duplicate of **this** issue. :smiling_imp: \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75442967/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
