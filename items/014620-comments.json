[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44953698",
    "html_url": "https://github.com/rust-lang/rust/pull/14620#issuecomment-44953698",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14620",
    "id": 44953698,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0OTUzNjk4",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-03T11:41:21Z",
    "updated_at": "2014-06-03T11:43:24Z",
    "body": "So, just for the record, this history edited version (as of commit b846820) ends in a code base that is nearly identical to pcwalton's #14501.  It basically just has some bug fixes to let me get `make check-stage{1,2}` running locally on my mac.\n\nHere is the complete diff between the two, as of commit b846820.  (I keep adding that qualification because I will need to rebase it atop master before merging, and that will make the diff comparison between this and PR #14501 useless.)\n\nThe diff:\n\n```\n% git diff pcw-by-value-upvars\ndiff --git a/src/doc/guide-container.md b/src/doc/guide-container.md\nindex 30bfd28..9acb38a 100644\n--- a/src/doc/guide-container.md\n+++ b/src/doc/guide-container.md\n@@ -184,8 +184,9 @@ let xs = [1,2,3,4,5];\n let mut calls = 0;\n\n {\n+    let calls_ref = &mut calls;\n     let it = xs.iter().scan((), |_, x| {\n-        calls += 1;\n+        *calls_ref += 1;\n         if *x < 3 { Some(x) } else { None }});\n\n     // the iterator will only yield 1 and 2 before returning None\ndiff --git a/src/doc/tutorial.md b/src/doc/tutorial.md\nindex 011d1b2..79b05d3 100644\n--- a/src/doc/tutorial.md\n+++ b/src/doc/tutorial.md\n@@ -1838,7 +1838,8 @@ access local variables in the enclosing scope.\n\n let mut max = 0;\n-let f = |x: int| if x > max { max = x };\n+let max_ref = &mut max;\n+let f = |x: int| if x > *max_ref { *max_ref = x };\n for x in [1, 2, 3].iter() {\n     f(*x);\n }\ndiff --git a/src/librustc/util/common.rs b/src/librustc/util/common.rs\nindex 66da8f1..02de185 100644\n--- a/src/librustc/util/common.rs\n+++ b/src/librustc/util/common.rs\n@@ -31,7 +31,7 @@ impl Timer {\n         depth.replace(Some(old_depth + 1));\n\n         Timer {\n-            start: time::precise_time_s(),\n+            start: if enabled { time::precise_time_s() } else { 0f64 },\n             what: what,\n             enabled: enabled,\n             old_depth: old_depth,\n@@ -41,12 +41,14 @@ impl Timer {\n\n impl Drop for Timer {\n     fn drop(&mut self) {\n-        let end = time::precise_time_s();\n         depth.replace(Some(self.old_depth));\n-        println!(\"{}time: {:3.3f} s\\t{}\",\n-                 \"  \".repeat(self.old_depth),\n-                 end - self.start,\n-                 self.what);\n+        if self.enabled {\n+            let end = time::precise_time_s();\n+            println!(\"{}time: {:3.3f} s\\t{}\",\n+                     \"  \".repeat(self.old_depth),\n+                     end - self.start,\n+                     self.what);\n+        }\n     }\n }\n\ndiff --git a/src/llvm b/src/llvm\nindex 4b4d053..0a89464 160000\n--- a/src/llvm\n+++ b/src/llvm\n@@ -1 +1 @@\n-Subproject commit 4b4d0533b4f76cc3fbba31bd9e7ac02e0c738b1d\n+Subproject commit 0a894645cf120539876e9eb4eb0d7b572dfa9d14\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44953698/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44977691",
    "html_url": "https://github.com/rust-lang/rust/pull/14620#issuecomment-44977691",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14620",
    "id": 44977691,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0OTc3Njkx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-03T15:14:51Z",
    "updated_at": "2014-06-03T15:14:51Z",
    "body": "It's probably too late now, but I would much rather shadow outer variables rather than suffix them all with `_ptr`.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44977691/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44978258",
    "html_url": "https://github.com/rust-lang/rust/pull/14620#issuecomment-44978258",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14620",
    "id": 44978258,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0OTc4MjU4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-03T15:19:02Z",
    "updated_at": "2014-06-03T15:19:02Z",
    "body": "Just wanted to make sure there was a test for something like this as well:\n\n``` rust\nlet a = box 1;\nlet b = || { println!(\"{}\", a) };\ndrop(b);\n// no memory should leak\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44978258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44986611",
    "html_url": "https://github.com/rust-lang/rust/pull/14620#issuecomment-44986611",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14620",
    "id": 44986611,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0OTg2NjEx",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-03T16:20:00Z",
    "updated_at": "2014-06-03T16:20:35Z",
    "body": "@alexcrichton it is not too late, its easy to rebase -i and edit commits, especially since I will need to rebase it on top of master before attempting to land this anyway.  (I've put this PR on the mtg agenda for tonight, just to double-check everyone is okay with the shift in the character of the language.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44986611/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45028547",
    "html_url": "https://github.com/rust-lang/rust/pull/14620#issuecomment-45028547",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14620",
    "id": 45028547,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MDI4NTQ3",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-03T22:25:43Z",
    "updated_at": "2014-06-03T22:25:43Z",
    "body": "I noticed that many of the captures are written like\n\n``` rust\nlet mut foo: T = init();\nlet foo_ptr: &mut T = &mut foo_ptr;\n...\n```\n\nbut can be written like\n\n``` rust\nlet mut foo: &mut T = &mut init();\n...\n```\n\nFor closures where `foo_ptr` did not need to be explicitly derefed (i.e. auto-deref handled everything), this should be the only change required for this patch.\n\nThis is especially true of many of the closures in tests and benchmarks.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45028547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45101297",
    "html_url": "https://github.com/rust-lang/rust/pull/14620#issuecomment-45101297",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14620",
    "id": 45101297,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTAxMjk3",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-04T14:58:15Z",
    "updated_at": "2014-06-04T14:58:15Z",
    "body": "@huonw I don't suppose you have any ready estimate as to how many of the changes your suggestion would apply to?  (My plan, based on the discussion at [last night's meeting](../wiki/Meeting-weekly-2014-06-03#by-value-upvars-pnkfelixpcwalton-httpsgithubcommozillarustpull14620-see-also-pr-14501), was to just close this PR, but your comment has made me wonder if I should try to clean it up further, and refloat the idea of just doing by-value-upvars, or at least make that the easy default.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/45101297/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/46109957",
    "html_url": "https://github.com/rust-lang/rust/pull/14620#issuecomment-46109957",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14620",
    "id": 46109957,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTA5OTU3",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-15T08:22:16Z",
    "updated_at": "2014-06-15T08:22:16Z",
    "body": "closing; we are reconsidering forcing all closures to move to by-value upvars : see https://github.com/rust-lang/rfcs/pull/114\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/46109957/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
