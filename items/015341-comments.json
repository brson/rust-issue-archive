[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47809273",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47809273",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47809273,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODA5Mjcz",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T17:33:18Z",
    "updated_at": "2014-07-02T17:33:18Z",
    "body": "The allocation for every `println!` is very small -- it's one `Box<LocalData>`. We discussed in irc why println! was allocating for every call and this was the reason.\n\nNot sure if this is worth fixing, but it looks relatively simple.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47809273/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47809563",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47809563",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47809563,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODA5NTYz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T17:35:55Z",
    "updated_at": "2014-07-02T17:35:55Z",
    "body": "Before this change, recursive prints while printing would forcefully print to stdout, while with this change it now unconditionally fails the task (with an odd error message). (just stating a fact)\n\nHave you measured a performance difference to see whether this is worth it or not?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47809563/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47810065",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47810065",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47810065,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODEwMDY1",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T17:40:10Z",
    "updated_at": "2014-07-02T17:41:08Z",
    "body": "Ok I think I'm already wrong about recursive prints -- they can happen if you use `println!` inside a formatting trait -- is that right?\n\nJudging by the comment on `with_task_stdout`, disallowing nesting should be safer.\n\nI haven't run performance tests yet, my laptop is miserably slow, working on it.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47810065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47812174",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47812174",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47812174,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODEyMTc0",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T17:56:41Z",
    "updated_at": "2014-07-02T17:56:41Z",
    "body": "You could allow recursive prints by using `try_borrow_mut()` instead of `borrow_mut()`, and temporarily setting a new `stdout()` if the borrow fails. That would replicate the old behavior.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47812174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47815257",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47815257",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47815257,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODE1MjU3",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T18:22:24Z",
    "updated_at": "2014-07-02T18:28:31Z",
    "body": "@kballard the old solution composes nested printing much better -- here we basically have to allocat a new stdout for every nested print, but it shouldn't really happen, should it? It could also be without the line buffer.\n\nPerformance does increase, printing time reduced by 10% for both a single `println!` and for a silly test of 10,000 `println!`. From 47.7 ms/iteration to 42.7 ms/iteration, with this (redirected to file)\n\n```\nextern crate test;\n\n#[deriving(Show)]\nenum Instruction {\n    Jump(i32),\n    Match(bool),\n    Text(&'static str),\n}\n\nfn gen_instr() -> Vec<Instruction>\n{\n    range(0i32, 10000).map(|x| match x % 3 {\n        0 => Jump(x),\n        1 => Match(x % 7 == 0),\n        _ => Text(\"test-text\")\n    }).collect()\n}\n\n#[bench]\nfn print_single(b: &mut test::Bencher)\n{\n    b.iter(|| {\n        println!(\"abc\");\n    })\n}\n\n#[bench]\nfn print_all(b: &mut test::Bencher)\n{\n    let instr = gen_instr();\n    b.iter(|| {\n        for (i, x) in instr.iter().enumerate() {\n            println!(\"{} = {}\", i, x);\n        }\n    })\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47815257/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824300",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47824300",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47824300,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI0MzAw",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:29:59Z",
    "updated_at": "2014-07-02T19:30:31Z",
    "body": "Added commit to handle nested invocation again -- simply creating a `std::io::stdout()`, writing to it, flushing it. It doesn't compose like the old solution, but it's actually a simple solution.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824300/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824459",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47824459",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47824459,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI0NDU5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:31:16Z",
    "updated_at": "2014-07-02T19:31:16Z",
    "body": "@blake2-ppc The current implementation (which is what I assume you mean by the \"old solution\") already allocates a new stdout for every level of print nesting. If you do 3 prints in a row all nested within a print, both the current solution and the proposed RefCell + try_borrow would still only allocate again for the first nested print (and the stdout it allocated would remain in TLS for the 2nd and 3rd nested prints to use, and would only be dropped once the outer print finished and it restored the original stdout).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824459/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824736",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47824736",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47824736,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI0NzM2",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:33:40Z",
    "updated_at": "2014-07-02T19:33:40Z",
    "body": "@blake2-ppc Ah I see what you just did. And upon reflection, storing it into TLS until the outer print returns is a bit more complicated. You'd have to just write it into TLS, and then the outer print would have to unconditionally re-write its RefCell back into TLS after calling the closure, in case the nested print changed anything.\n\nI think it's worth trying and seeing what the performance is like. If writing into TLS is cheap, and the expensive part was the allocation of the box, then it should be a win.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824949",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47824949",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47824949,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI0OTQ5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:35:32Z",
    "updated_at": "2014-07-02T19:35:32Z",
    "body": "Ack, upon re-reading the original issue, the claim is that TLS uses allocation when calling `replace()`, which is exactly what you're trying to avoid. Well, you could read TLS again and see if the RefCell you got is the same as what you already have, and only write back if it changed.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824949/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824956",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47824956",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47824956,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI0OTU2",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:35:34Z",
    "updated_at": "2014-07-02T19:35:34Z",
    "body": "@kballard If we unconditionally write back to the TLS, we end up where we started. Writing to the TLS is cheap, but it is one allocation and that's the one I'm trying to remove.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47824956/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47825147",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47825147",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47825147,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI1MTQ3",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:37:09Z",
    "updated_at": "2014-07-02T19:37:09Z",
    "body": "@blake2-ppc Hmm, I assumed the allocation was necessary because TLS returns a `Ref` and therefore `replace()` would have to allocate a brand new box so as to not break any existing references. Except `replace()` is documented as failing if the value is currently on-loan (if there are any existing `Ref`s for it). So why does `replace()` need to allocate at all if the key is already present in TLS? Can that be fixed?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47825147/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47826230",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47826230",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47826230,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI2MjMw",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:46:42Z",
    "updated_at": "2014-07-02T19:46:49Z",
    "body": "I think the box is needed to create a homogenous type to store in the TLS map, I'm not at all familiar with the implementation.\n\nI don't think any additional complexity for the nested case is worth it, not more than the two commits in the PR so far.\n\nWhat needs mentioning is that `pub fn set_stdout` can now fail, if called during `with_task_stdout` too.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47826230/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47826311",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47826311",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47826311,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI2MzEx",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:47:27Z",
    "updated_at": "2014-07-02T19:47:27Z",
    "body": "Looking at TLS, I think this needs an overhaul. There's no actually reason why `replace()` should ever fail; we can replace `Ref` with effectively `Rc` instead, such that replacing a value that's currently borrowed will just \"untether\" the value from the TLS, but leave the value still accessible through the `Ref`. And we can rewrite this such that replacing a value that already exists in the map reuses the existing `Box` (if there are no outstanding `Ref`s) instead of allocating a new one.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47826311/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47826747",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47826747",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47826747,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI2NzQ3",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:50:57Z",
    "updated_at": "2014-07-02T19:50:57Z",
    "body": "@blake2-ppc I'm not thrilled about the idea of `set_stdout()` failing. The problem with nested prints is the nested print doesn't typically know it's nested (because there's little utility in attempting a nested print), so having a failure mode that only exists when the print is nested causes potential issues for all code that ever does `set_stdout()` even if it will never actually be used in a nested fashion. And there's plausible reasons why it should work in a nested fashion anyway.\n\nFor example, I might have some code that, for whatever reason, wants to log to a file when various methods are called, but it needs to log using other code out of its control that uses `println!()`. It can accomplish this by using `set_stdout()` to temporarily redirect stdout to its log file, call the other code, and then restore the old stdout. What's it supposed to do if `set_stdout()` fails?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47826747/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47827192",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-47827192",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 47827192,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODI3MTky",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-02T19:54:40Z",
    "updated_at": "2014-07-02T19:54:40Z",
    "body": "Thanks for the insightful comments @kballard, I think that leaves this PR explored & closed and we have to go look somewhere else -- TLS.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47827192/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48010218",
    "html_url": "https://github.com/rust-lang/rust/pull/15341#issuecomment-48010218",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15341",
    "id": 48010218,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDEwMjE4",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-04T05:29:14Z",
    "updated_at": "2014-07-04T05:29:14Z",
    "body": "@blake2-ppc I've submitted PR #15399 that rewrites `local_data` to, among other things, try and avoid allocation in the `replace(None) ... replace(Some)` pattern.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48010218/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
