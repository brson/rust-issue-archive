[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13403654",
    "html_url": "https://github.com/rust-lang/rust/issues/4870#issuecomment-13403654",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4870",
    "id": 13403654,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNDAzNjU0",
    "user": {
      "login": "Dretch",
      "id": 1428731,
      "node_id": "MDQ6VXNlcjE0Mjg3MzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1428731?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Dretch",
      "html_url": "https://github.com/Dretch",
      "followers_url": "https://api.github.com/users/Dretch/followers",
      "following_url": "https://api.github.com/users/Dretch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Dretch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Dretch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Dretch/subscriptions",
      "organizations_url": "https://api.github.com/users/Dretch/orgs",
      "repos_url": "https://api.github.com/users/Dretch/repos",
      "events_url": "https://api.github.com/users/Dretch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Dretch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-11T21:22:32Z",
    "updated_at": "2013-02-11T21:22:32Z",
    "body": "Hopefully this clarifies why I think HashMap.clear taking `&mut self` is undesirable:\n\nThis is a program that, before the change, compiled and ran:\n\n```\nextern mod std;\n\nstruct MyStruct {\n    map: std::oldmap::HashMap<int, int>\n}\n\nfn f(ms: &MyStruct) {\n    ms.map.insert(1, 2);\n    ms.map.clear();\n}\n\nfn main() {}\n```\n\nSince the change, rustc now complains due to the illegal borrow it contains calling ms.map.clear():\n\n```\nbad-hashmap-clear.rs:10:8: 10:14 error: illegal borrow: creating mutable alias to immutable field\nbad-hashmap-clear.rs:10         ms.map.clear();\n                                ^~~~~~\n```\n\nI tried to fix the issue by making map a `mut` field... but that caused rustc to complain about an illegal borrow calling ms.map.insert(...):\n\n```\nbad-hashmap-clear.rs:9:8: 9:14 error: illegal borrow unless pure: creating immutable alias to mutable field\nbad-hashmap-clear.rs:9         ms.map.insert(1, 2);\n                               ^~~~~~\nbad-hashmap-clear.rs:9:8: 9:28 note: impure due to access to impure function\nbad-hashmap-clear.rs:9         ms.map.insert(1, 2);\n                               ^~~~~~~~~~~~~~~~~~~~\n```\n\nI can't see any way to avoid both illegal borrow errors at the same time.\n\nDoes this make sense to anyone else? @thestinger ?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13403654/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13404322",
    "html_url": "https://github.com/rust-lang/rust/issues/4870#issuecomment-13404322",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4870",
    "id": 13404322,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNDA0MzIy",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-11T21:34:06Z",
    "updated_at": "2013-02-11T21:46:31Z",
    "body": "@Dretch: In order to mutate an object, the owner needs to be a mutable variable or `@mut`. You have to pass it into the function with `&mut self`, because using `&` means the object is immutable.\n\nThe use case for mutable fields is hidden internal state that _cannot be observed externally_ like locks. Using them the way `HashMap` does is misuse of the feature. Mutable fields are currently being removed from the language because in addition to being widely misunderstood, they don't play well with the improved borrow checking semantics.\n\nThe methods that don't use explicit self are unsound and should be updated, but it's a lot of work to update the calling code. As a whole `std::oldmap` is going to be removed as soon as possible so I doubt updating it is actually going to happen - it will be easier to just port code over to `core::hashmap` which is sane, sendable, faster and has a better API.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13404322/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13407115",
    "html_url": "https://github.com/rust-lang/rust/issues/4870#issuecomment-13407115",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4870",
    "id": 13407115,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNDA3MTE1",
    "user": {
      "login": "Dretch",
      "id": 1428731,
      "node_id": "MDQ6VXNlcjE0Mjg3MzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1428731?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Dretch",
      "html_url": "https://github.com/Dretch",
      "followers_url": "https://api.github.com/users/Dretch/followers",
      "following_url": "https://api.github.com/users/Dretch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Dretch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Dretch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Dretch/subscriptions",
      "organizations_url": "https://api.github.com/users/Dretch/orgs",
      "repos_url": "https://api.github.com/users/Dretch/repos",
      "events_url": "https://api.github.com/users/Dretch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Dretch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-11T22:28:18Z",
    "updated_at": "2013-02-11T22:28:18Z",
    "body": "If I understand you correctly, then in future idiomatic rust, methods will have to expose in their type signature whether or not they mutate the externally-observable-internal-state of the self value?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13407115/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13407254",
    "html_url": "https://github.com/rust-lang/rust/issues/4870#issuecomment-13407254",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4870",
    "id": 13407254,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNDA3MjU0",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-11T22:31:02Z",
    "updated_at": "2013-02-11T22:31:11Z",
    "body": "@Dretch: They will always be able to use unsafe to break the rules like that. I can't think of very many actual use cases though other than locks - which already have to use unsafe code.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13407254/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13584648",
    "html_url": "https://github.com/rust-lang/rust/issues/4870#issuecomment-13584648",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4870",
    "id": 13584648,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNTg0NjQ4",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-14T23:21:54Z",
    "updated_at": "2013-02-14T23:21:54Z",
    "body": "Closing since oldmap is going to be removed. If I misunderstood something, please let me know!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13584648/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
