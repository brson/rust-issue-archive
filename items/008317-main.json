{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/8317",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/8317/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/8317/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/8317/events",
  "html_url": "https://github.com/rust-lang/rust/pull/8317",
  "id": 17664165,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NzQwMTUxNA==",
  "number": 8317,
  "title": "Optimize spawn_unlinked.",
  "user": {
    "login": "bblum",
    "id": 1820515,
    "node_id": "MDQ6VXNlcjE4MjA1MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bblum",
    "html_url": "https://github.com/bblum",
    "followers_url": "https://api.github.com/users/bblum/followers",
    "following_url": "https://api.github.com/users/bblum/following{/other_user}",
    "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bblum/subscriptions",
    "organizations_url": "https://api.github.com/users/bblum/orgs",
    "repos_url": "https://api.github.com/users/bblum/repos",
    "events_url": "https://api.github.com/users/bblum/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bblum/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 1,
  "created_at": "2013-08-05T22:48:33Z",
  "updated_at": "2014-07-17T03:46:28Z",
  "closed_at": "2013-08-06T19:08:35Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/8317",
    "html_url": "https://github.com/rust-lang/rust/pull/8317",
    "diff_url": "https://github.com/rust-lang/rust/pull/8317.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/8317.patch",
    "merged_at": "2013-08-06T19:08:40Z"
  },
  "body": "This lazily initializes the taskgroup structs for `spawn_unlinked` tasks. If such a task never spawns another task linked to it (or a descendant of it), its taskgroup is simply never initialized at all. Also if an unlinked task spawns another unlinked task, neither of them will need to initialize their taskgroups. This works for the main task too.\n\nI benchmarked this with the following test case and observed a ~~21% speedup (average over 4 runs: 7.85 sec -> 6.20 sec, 2.5 GHz)~~ 11% speedup, see comment below.\n\n```\nuse std::task;\nuse std::cell::Cell;\nuse std::rt::comm;\n\nstatic NUM: uint = 1024*256;\n\nfn run(f: ~fn()) {\n    let mut t = task::task();\n    t.unlinked();\n    t.spawn(f);\n}\n\nfn main() {\n    do NUM.times {\n        let (p,c) = comm::oneshot();\n        let c = Cell::new(c);\n        do run { c.take().send(()); }\n        p.recv();\n    }\n}\n```\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/8317/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/8317/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
