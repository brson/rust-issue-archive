[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13130432",
    "html_url": "https://github.com/rust-lang/rust/issues/4763#issuecomment-13130432",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4763",
    "id": 13130432,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTMwNDMy",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-05T14:04:21Z",
    "updated_at": "2013-02-05T14:04:49Z",
    "body": "Strictly speaking multiple lifetime parameters are not required to use a more traditional iterator.  However, the current handling of the `self` region is problematic.  Here is a proof of concept that I got to compile, but it doesn't work with impls because they always conflate the `self` region with the lifetime parameter.  This is actually a known issue I plan to address, I will open a bug describing it.  \n\nThe key point is that the `next()` function does not use the same lifetime for the `&mut Iterator` pointer as for its contents:\n\n```\nfn next<T>(iter: &mut Iterator/&a<T>) -> bool {\n    iter.index += 1; // Relies on rollover\n    iter.index < iter.vector.len()\n}\n```\n\nNote: I changed the iterator protocol here to use a bool return on `next()` rather than returning an `Option` from `get`.  This is not necessary, it was to see which style I preferred.  Probably best, ultimately, would be to offer two methods or something like that.\n\n```\nextern mod std;\n\nuse std::treemap;\n\nstruct Iterator<T> {\n    vector: &[T],\n    index: uint\n}\n\nfn iter<T>(v: &v/[T]) -> Iterator/&v<T> {\n    Iterator {vector: v, index: uint::max_value}\n}\n\nfn next<T>(iter: &mut Iterator/&a<T>) -> bool {\n    iter.index += 1; // Relies on rollover\n    iter.index < iter.vector.len()\n}\n\nfn get<T>(iter: &v/Iterator<T>) -> &v/T {\n    &iter.vector[iter.index]\n}\n\nfn is_disjoint(t1: &[int], t2: &[int]) -> bool {\n    let mut x = iter(t1);\n    let mut y = iter(t2);\n\n    if !next(&mut x) { return true; }\n    if !next(&mut y) { return true; }\n\n    loop {\n        let advance_x = {\n            let a = get(&x);\n            let b = get(&y);\n            if *a < *b {\n                true\n            } else if *b < *a {\n                false\n            } else {\n                return false;\n            }\n        };\n\n        if advance_x {\n            if !next(&mut x) {\n                return true;\n            }\n        } else if !next(&mut y) {\n            return true;\n        }\n    }\n}\n\nfn main() {\n    assert is_disjoint([1, 3, 5], [2, 4, 6]);\n    assert !is_disjoint([1, 3, 5], [2, 4, 5]);\n    assert is_disjoint([], []);\n    assert is_disjoint([1, 2], []);\n    assert is_disjoint([], [1, 2]);\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13130432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
