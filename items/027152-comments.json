[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122936538",
    "html_url": "https://github.com/rust-lang/rust/issues/27152#issuecomment-122936538",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27152",
    "id": 122936538,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjkzNjUzOA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-20T16:19:53Z",
    "updated_at": "2015-07-20T16:19:53Z",
    "body": "This is actually working as intended, and I believe hang your seeing is just related to how much the kernel buffers the output between processes. A `Command` represents a pending execution of a `Child`, so what's happening here is that you're spawning two processes. The second process is just immediately calling `wait` without trying to read any of the piped stdout, so if the child process is blocked writing to stdout then it'll never return (as the parent isn't reading the pipe).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122936538/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122951581",
    "html_url": "https://github.com/rust-lang/rust/issues/27152#issuecomment-122951581",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27152",
    "id": 122951581,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjk1MTU4MQ==",
    "user": {
      "login": "TheJakeSchmidt",
      "id": 10720216,
      "node_id": "MDQ6VXNlcjEwNzIwMjE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/10720216?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheJakeSchmidt",
      "html_url": "https://github.com/TheJakeSchmidt",
      "followers_url": "https://api.github.com/users/TheJakeSchmidt/followers",
      "following_url": "https://api.github.com/users/TheJakeSchmidt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheJakeSchmidt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheJakeSchmidt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheJakeSchmidt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheJakeSchmidt/orgs",
      "repos_url": "https://api.github.com/users/TheJakeSchmidt/repos",
      "events_url": "https://api.github.com/users/TheJakeSchmidt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheJakeSchmidt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-20T17:00:41Z",
    "updated_at": "2015-07-20T17:00:41Z",
    "body": "Sorry, I should have given more detail - I filed this bug report a little too fast. I don't think this is working as intended, for a couple of reasons, but let me know if I'm wrong.\n\nWhen the program hangs, the subprocess is blocked on a write() call to its stdout file descriptor (according to GDB). I'm pretty sure that's not supposed to happen after output() has been called - the output() call spawns a thread that should consume all the output from the pipe before returning (https://github.com/rust-lang/rust/blob/feba393b8ed60efe79f9f5207fde904d085949f5/src/libstd/process.rs#L533). The hang is expected if status() is called before output(), but not if output() is called first.\n\nAdditionally, the equivalent Python program works (even with large numbers), so I don't think it's an inherent limitation of the kernel:\n\n```\nimport subprocess\n\ndef main():\n    proc = subprocess.Popen([\"python\",  \"-c\", \"print('a' * 10000000)\"],\n                            shell=False, stdout=subprocess.PIPE)\n    proc.communicate()\n    print \"Calling wait()\"\n    proc.wait()\n    print \"wait() returned\"\n\nif __name__ == '__main__':\n    main()\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122951581/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122956843",
    "html_url": "https://github.com/rust-lang/rust/issues/27152#issuecomment-122956843",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27152",
    "id": 122956843,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjk1Njg0Mw==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-20T17:16:20Z",
    "updated_at": "2015-07-20T17:16:20Z",
    "body": "You are invoking `status()` on a `Command`, which is spawning a fresh new process. Your previous call to `output()` was on a different process. What you probably want to do is get the `ExitStatus` from the `status` field of the `Output` you get from `output()`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122956843/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122957400",
    "html_url": "https://github.com/rust-lang/rust/issues/27152#issuecomment-122957400",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27152",
    "id": 122957400,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjk1NzQwMA==",
    "user": {
      "login": "TheJakeSchmidt",
      "id": 10720216,
      "node_id": "MDQ6VXNlcjEwNzIwMjE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/10720216?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheJakeSchmidt",
      "html_url": "https://github.com/TheJakeSchmidt",
      "followers_url": "https://api.github.com/users/TheJakeSchmidt/followers",
      "following_url": "https://api.github.com/users/TheJakeSchmidt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheJakeSchmidt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheJakeSchmidt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheJakeSchmidt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheJakeSchmidt/orgs",
      "repos_url": "https://api.github.com/users/TheJakeSchmidt/repos",
      "events_url": "https://api.github.com/users/TheJakeSchmidt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheJakeSchmidt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-20T17:18:58Z",
    "updated_at": "2015-07-20T17:18:58Z",
    "body": "Ahhhh, that makes sense. I didn't realize that status() was re-executing the child process. Thank you, and sorry for the erroneous report.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122957400/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
