[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/153930138",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-153930138",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 153930138,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MzkzMDEzOA==",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-05T02:05:22Z",
    "updated_at": "2015-11-05T02:05:22Z",
    "body": "cc @alexcrichton \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/153930138/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/154123326",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-154123326",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 154123326,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1NDEyMzMyNg==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-05T17:03:22Z",
    "updated_at": "2015-11-05T17:03:22Z",
    "body": "Currently this translates to the various linkage models of LLVM, for example the values of the attribute can be:\n\n``` rust\nmatch name {                                                         \n    \"appending\" => Some(llvm::AppendingLinkage),                     \n    \"available_externally\" => Some(llvm::AvailableExternallyLinkage),\n    \"common\" => Some(llvm::CommonLinkage),                           \n    \"extern_weak\" => Some(llvm::ExternalWeakLinkage),                \n    \"external\" => Some(llvm::ExternalLinkage),                       \n    \"internal\" => Some(llvm::InternalLinkage),                       \n    \"linkonce\" => Some(llvm::LinkOnceAnyLinkage),                    \n    \"linkonce_odr\" => Some(llvm::LinkOnceODRLinkage),                \n    \"private\" => Some(llvm::PrivateLinkage),                         \n    \"weak\" => Some(llvm::WeakAnyLinkage),                            \n    \"weak_odr\" => Some(llvm::WeakODRLinkage),                        \n    _ => None,                                                       \n}                                                                    \n```\n\nSome worries about this are:\n- These are very LLVM specific, it's unclear how applicable they are to other backends. \n- Beyond `external` or `weak`, I've never seen a reason to use the other attributes.\n- These linkage methods are platform-specific and aren't guaranteed to work everywhere.\n\nThat being said, it's the only way to do weak symbols on Linux and it's also convenient for exporting a known symbol without worrying about privacy on the Rust side of things. I would personally want to reduce the set of accepted linkage types and then state \"well of course linkage is platform-specific!\"\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/154123326/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/154142846",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-154142846",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 154142846,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1NDE0Mjg0Ng==",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-11-05T18:17:10Z",
    "updated_at": "2015-11-05T18:17:10Z",
    "body": "cc #29629\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/154142846/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/170412521",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-170412521",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 170412521,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3MDQxMjUyMQ==",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-01-11T01:17:58Z",
    "updated_at": "2016-01-11T01:17:58Z",
    "body": "This feature is fundamentally broken. Consider the following code:\n\n``` c\nstatic unsigned long B = 0;\nunsigned long *A = &B;\nvoid f(void) { }\n```\n\n``` rust\n#![feature(linkage)]\n\n#[link_name = \"c_part\"]\nextern {\n    #[linkage = \"extern_weak\"] static A: *const usize;\n    fn f();\n}\n\nfn main() {\n    unsafe {\n        f();\n        println!(\"{:x} @ {:x} @ {:p}\", *(*A as *const usize), *A, A);\n    }\n}\n```\n\nWhich prints `0 @ 5617765adaa8 @ 0x5617765ad890` meaning that the `A` seen by the rust code contains the address of `A` and not `A` itself. It's also easy to get LLVM to abort with this.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/170412521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/170552079",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-170552079",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 170552079,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3MDU1MjA3OQ==",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-01-11T13:42:45Z",
    "updated_at": "2016-01-11T13:43:01Z",
    "body": "This attribute is also used incorrectly [here](https://github.com/rust-lang/rust/blob/d228cd3964b7cbac7665ff38bde46da67586b87d/src/libstd/thread/local.rs#L321-L334).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/170552079/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305556083",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-305556083",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 305556083,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNTU1NjA4Mw==",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-01T17:00:29Z",
    "updated_at": "2017-06-01T17:00:29Z",
    "body": "https://github.com/rust-lang/rust/issues/18804 needs to be resolved before stabilization.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305556083/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/355775169",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-355775169",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 355775169,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NTc3NTE2OQ==",
    "user": {
      "login": "nagisa",
      "id": 679122,
      "node_id": "MDQ6VXNlcjY3OTEyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nagisa",
      "html_url": "https://github.com/nagisa",
      "followers_url": "https://api.github.com/users/nagisa/followers",
      "following_url": "https://api.github.com/users/nagisa/following{/other_user}",
      "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions",
      "organizations_url": "https://api.github.com/users/nagisa/orgs",
      "repos_url": "https://api.github.com/users/nagisa/repos",
      "events_url": "https://api.github.com/users/nagisa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nagisa/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-01-06T20:45:29Z",
    "updated_at": "2018-01-06T20:45:29Z",
    "body": "I think we should at least work on stabilising the `weak` and `extern_weak` linkage. Both are very useful and a fairly widespread linkage options that seem to be supported (unlike many other options currently exposed) by at least all of the tier 1 targets.\r\n\r\nTo give an example of a use-case for `weak` linkage in Rust code (<sup>I need weak linkage for libloading</sup>), one would be for global statics unique even between multiple versions of the same crate.  Consider that, currently, if a binary links `log = ^0.3` and `log = ^0.4` some way, or another, it will end up having two distinct global loggers. This could trivially be resolved with some use of the `weak` linkage option (as it ensures \u2013 at link time \u2013 only one instance of global with the same name).\r\n\r\nThat being said, `#[linkage]` should always infect whatever it applies to with unsafety. Consider for example these two crates:\r\n\r\n```rust\r\n// crate older version\r\n#[linkage=\"weak\"]\r\nstatic mut FOO: u32 = !0;\r\n```\r\n\r\n```rust\r\n// crate newer version\r\n#[linkage=\"weak\"]\r\nstatic mut FOO: char = 'a';\r\n```\r\n\r\nwhen linked together, all uses of `FOO` as seen from the newer-version crate would be UB if the linker happened to choose to link-in the value from the older version. This is functionally a transmute without size checks.\r\n\r\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/355775169/reactions",
      "total_count": 6,
      "+1": 6,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/357446821",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-357446821",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 357446821,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzQ0NjgyMQ==",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-01-13T16:15:37Z",
    "updated_at": "2018-01-13T16:23:10Z",
    "body": "extern_weak is broken in such a dubious way that even though I pointed out two years ago that it was being used incorrectly in the stdlib, the bug still hasn't been fixed.\r\n\r\n```\r\n~$ cat strong.rs \r\nextern {\r\n    static __progname: *const u8;\r\n}\r\n\r\nfn main() {\r\n    unsafe {\r\n        println!(\"  __progname:\\t\\t{:?}\", __progname);\r\n        println!(\" &__progname:\\t\\t{:?}\", &__progname as *const _);\r\n        if !__progname.is_null() {\r\n            println!(\" *__progname:\\t\\t{:?}\", *__progname as char);\r\n        }\r\n    }\r\n}\r\n~$ cat weak.rs \r\n#![feature(linkage)]\r\n\r\nextern {\r\n    #[linkage = \"extern_weak\"]\r\n    static __progname: *mut *const u8;\r\n}\r\n\r\nfn main() {\r\n    unsafe {\r\n        println!(\"  __progname:\\t\\t{:?}\", __progname);\r\n        println!(\" &__progname:\\t\\t{:?}\", &__progname as *const _);\r\n        if !__progname.is_null() {\r\n            println!(\" *__progname:\\t\\t{:?}\", *__progname);\r\n            if !(*__progname).is_null() {\r\n                println!(\"**__progname:\\t\\t{:?}\", **__progname as char);\r\n            }\r\n        }\r\n    }\r\n}\r\n~$ rustc strong.rs \r\n~$ rustc weak.rs \r\n~$ ./strong \r\n  __progname:\t\t0x7ffdfc7438ac\r\n &__progname:\t\t0x7f10560a5360\r\n *__progname:\t\t's'\r\n~$ ./weak \r\n  __progname:\t\t0x7f730b21f360\r\n &__progname:\t\t0x5574a33bb008\r\n *__progname:\t\t0x7fffe4ca38b2\r\n**__progname:\t\t'w'\r\n```\r\n\r\ngcc and clang handle this attribute correctly.\r\n\r\nPS: The address of __dso_handle isn't actually too significant in __cxa_thread_atexit_impl and &__dso_handle is only a few bytes off.\r\n\r\nPSS: Wow, looks like I already explained this above (also two years ago). Maybe the NSA is trying to keep this potential remote code execution unfixed. \ud83e\udd14",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/357446821/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/358168368",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-358168368",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 358168368,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODE2ODM2OA==",
    "user": {
      "login": "cramertj",
      "id": 5963049,
      "node_id": "MDQ6VXNlcjU5NjMwNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5963049?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cramertj",
      "html_url": "https://github.com/cramertj",
      "followers_url": "https://api.github.com/users/cramertj/followers",
      "following_url": "https://api.github.com/users/cramertj/following{/other_user}",
      "gists_url": "https://api.github.com/users/cramertj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cramertj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cramertj/subscriptions",
      "organizations_url": "https://api.github.com/users/cramertj/orgs",
      "repos_url": "https://api.github.com/users/cramertj/repos",
      "events_url": "https://api.github.com/users/cramertj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cramertj/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-01-17T01:50:09Z",
    "updated_at": "2018-01-17T01:50:09Z",
    "body": "Ping @alexcrichton @nagisa what's the status here? Is there a bug here that can be solved / mentored?",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/358168368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/358331028",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-358331028",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 358331028,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODMzMTAyOA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-01-17T15:01:19Z",
    "updated_at": "2018-01-17T15:01:19Z",
    "body": "@cramertj I personally consider this a perma-unstable issue for now. In general symbol visibility and ABIs are something that historically rustc hasn't done much to specify and has had a lot of freedom over. We relatively regularly tweak ABIs, symbol names, etc. There's a very thin layer at the end (like a C ABI) which is pretty stable but even that gets sketchy sometimes (`#[no_mangle]` deep in a module hierarchy?).\r\n\r\nI think we've benefitted quite greatly from the symbol visibility flexibility we've had historically in terms of compiler refactorings and heading off regressions. It's hard to introduce a regression when you can't rely on the feature in the first place!\r\n\r\nAlong those lines I think there's definitely some select use cases where using something like `#[linkage]` is critical, but from what I've seen they tend to be few and far between and somewhat esoteric. A blanket and general `#[linkage]` attribute I think is way too powerful to solve this use case and it'd be better to poke around at various motivational use cases to see if there's a more narrow solution.\r\n\r\n(plus that and the whole `#[linkage]` is incredibly platform/LLVM specific and I don't think we full understand all the linkage modes in LLVM and how they apply to all platforms as well)",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/358331028/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/376738977",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-376738977",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 376738977,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjczODk3Nw==",
    "user": {
      "login": "acmcarther",
      "id": 1660129,
      "node_id": "MDQ6VXNlcjE2NjAxMjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1660129?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/acmcarther",
      "html_url": "https://github.com/acmcarther",
      "followers_url": "https://api.github.com/users/acmcarther/followers",
      "following_url": "https://api.github.com/users/acmcarther/following{/other_user}",
      "gists_url": "https://api.github.com/users/acmcarther/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/acmcarther/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/acmcarther/subscriptions",
      "organizations_url": "https://api.github.com/users/acmcarther/orgs",
      "repos_url": "https://api.github.com/users/acmcarther/repos",
      "events_url": "https://api.github.com/users/acmcarther/events{/privacy}",
      "received_events_url": "https://api.github.com/users/acmcarther/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-03-28T02:25:37Z",
    "updated_at": "2018-03-28T02:25:51Z",
    "body": "Given that crate owners can't control how many instances of their crate will be included in a given binary, it seems that we really need a mechanism at least for _weak_ linkage in stable Rust.\r\n\r\nI got bit by the fallout from https://github.com/rust-lang/rust/issues/29603#issuecomment-355775169, where rust-libloading gained a cc complation step to workaround this missing feature.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/376738977/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/384420577",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-384420577",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 384420577,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDQyMDU3Nw==",
    "user": {
      "login": "mjbshaw",
      "id": 1204698,
      "node_id": "MDQ6VXNlcjEyMDQ2OTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1204698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mjbshaw",
      "html_url": "https://github.com/mjbshaw",
      "followers_url": "https://api.github.com/users/mjbshaw/followers",
      "following_url": "https://api.github.com/users/mjbshaw/following{/other_user}",
      "gists_url": "https://api.github.com/users/mjbshaw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mjbshaw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mjbshaw/subscriptions",
      "organizations_url": "https://api.github.com/users/mjbshaw/orgs",
      "repos_url": "https://api.github.com/users/mjbshaw/repos",
      "events_url": "https://api.github.com/users/mjbshaw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mjbshaw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-04-25T20:19:00Z",
    "updated_at": "2018-04-25T20:19:00Z",
    "body": "I would love some mechanism to merge statics and variables with the same value (and name, possibly).\r\n\r\nConsider the following code:\r\n\r\n```rust\r\n// In my actual code, this is a more complicated proc macro.\r\nmacro_rules! special_number {\r\n  ($value: expr) => {\r\n    {\r\n      // In my actual code, these static variables also have\r\n      // the special `export_name` of\r\n      // \"\\x01L_special_number_<unique_id>\", where\r\n      // `<unique_id>` is a unique identifier to avoid\r\n      // symbol conflicts.\r\n      #[link_section = \".data,__custom_special_section\"]\r\n      static SPECIAL_NUMBER: usize = $value;\r\n      &SPECIAL_NUMBER\r\n    }\r\n  };\r\n}\r\n\r\nextern {\r\n  fn consume_special_number(value: &usize);\r\n}\r\n\r\npub fn main() {\r\n  unsafe {\r\n    consume_special_number(special_number!(42));\r\n    consume_special_number(special_number!(42));\r\n    consume_special_number(special_number!(42));\r\n  };\r\n}\r\n```\r\n\r\nThis will generate three different static variables. I would love it if I could get Rust to merge these static variables into one single static variable. Using a `const` doesn't work (it does merge the values, but [you can't provide link attributes on a `const`](https://github.com/rust-lang/rust/issues/46968)).\r\n\r\nThere are two ways the merging could be performed:\r\n\r\n1. By value. Statics with the same value (that opt-in to merging) would be merged into a single static variable.\r\n2. By name. Statics with the same `export_name` (that opt-in to merging) would be merged into a single static variable (and wouldn't result in duplicate symbol errors).\r\n\r\nI would be prefer option 2 (merging by name).\r\n\r\nPerhaps this is what the `linkonce_odr` linkage type is for, but using the same `export_name` causes\r\n\r\nThe `linkonce_odr` and `weak_odr` linkage types are similar to this, I think, but don't work (in Rust) for merging globals/statics within a single translation unit. Rust could either extend them or introduce a new linkage type that does ODR merging within translation units.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/384420577/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/650889264",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-650889264",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 650889264,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MDg4OTI2NA==",
    "user": {
      "login": "luojia65",
      "id": 40385009,
      "node_id": "MDQ6VXNlcjQwMzg1MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/40385009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luojia65",
      "html_url": "https://github.com/luojia65",
      "followers_url": "https://api.github.com/users/luojia65/followers",
      "following_url": "https://api.github.com/users/luojia65/following{/other_user}",
      "gists_url": "https://api.github.com/users/luojia65/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luojia65/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luojia65/subscriptions",
      "organizations_url": "https://api.github.com/users/luojia65/orgs",
      "repos_url": "https://api.github.com/users/luojia65/repos",
      "events_url": "https://api.github.com/users/luojia65/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luojia65/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-06-29T03:47:11Z",
    "updated_at": "2020-06-29T16:17:16Z",
    "body": "Should we stabilize `weak` linkage first? :) It would be useful for building a runtime. We can write complex default function in Rust, export it in weak linkage; if another downstream provided their implementation, the complex default function won't be compiled. That could save code size which is importand in embedded environmant.\r\nWe could even implement another `#[weak]` lint instead if the original is too llvm-specific.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/650889264/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/685901372",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-685901372",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 685901372,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NTkwMTM3Mg==",
    "user": {
      "login": "nvzqz",
      "id": 10367662,
      "node_id": "MDQ6VXNlcjEwMzY3NjYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/10367662?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nvzqz",
      "html_url": "https://github.com/nvzqz",
      "followers_url": "https://api.github.com/users/nvzqz/followers",
      "following_url": "https://api.github.com/users/nvzqz/following{/other_user}",
      "gists_url": "https://api.github.com/users/nvzqz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nvzqz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nvzqz/subscriptions",
      "organizations_url": "https://api.github.com/users/nvzqz/orgs",
      "repos_url": "https://api.github.com/users/nvzqz/repos",
      "events_url": "https://api.github.com/users/nvzqz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nvzqz/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-09-02T17:58:28Z",
    "updated_at": "2020-09-02T17:58:28Z",
    "body": "What work is needed to stabilize `#[weak]` in `extern \"C\"` blocks?",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/685901372/reactions",
      "total_count": 7,
      "+1": 7,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/723653865",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-723653865",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 723653865,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMzY1Mzg2NQ==",
    "user": {
      "login": "jethrogb",
      "id": 1132307,
      "node_id": "MDQ6VXNlcjExMzIzMDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1132307?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jethrogb",
      "html_url": "https://github.com/jethrogb",
      "followers_url": "https://api.github.com/users/jethrogb/followers",
      "following_url": "https://api.github.com/users/jethrogb/following{/other_user}",
      "gists_url": "https://api.github.com/users/jethrogb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jethrogb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jethrogb/subscriptions",
      "organizations_url": "https://api.github.com/users/jethrogb/orgs",
      "repos_url": "https://api.github.com/users/jethrogb/repos",
      "events_url": "https://api.github.com/users/jethrogb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jethrogb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-11-08T19:22:32Z",
    "updated_at": "2020-11-08T19:22:32Z",
    "body": "@nvzqz probably at least some resolution to #31508",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/723653865/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/966900393",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-966900393",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 966900393,
    "node_id": "IC_kwDOAAsO6M45obqp",
    "user": {
      "login": "danielkeller",
      "id": 1353587,
      "node_id": "MDQ6VXNlcjEzNTM1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1353587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/danielkeller",
      "html_url": "https://github.com/danielkeller",
      "followers_url": "https://api.github.com/users/danielkeller/followers",
      "following_url": "https://api.github.com/users/danielkeller/following{/other_user}",
      "gists_url": "https://api.github.com/users/danielkeller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/danielkeller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/danielkeller/subscriptions",
      "organizations_url": "https://api.github.com/users/danielkeller/orgs",
      "repos_url": "https://api.github.com/users/danielkeller/repos",
      "events_url": "https://api.github.com/users/danielkeller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/danielkeller/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-11-12T08:01:47Z",
    "updated_at": "2021-11-12T08:01:47Z",
    "body": "I have a couple of ideas that might help stabilize weak linkage.\r\n\r\nFirst of all, the syntax. The problem with weak linkage is that its semantics are \"the address of this variable might be null\" which is not allowed in Rust, so the compiler puts the real symbol inside the first level of indirection, which is confusing. I propose, instead of an attribute, a type `std::ffi::Weak<T>`, which only allowed at the top level on items in extern blocks, like so:\r\n```rust\r\nextern \"C\" {\r\n    static foo: Weak<fn(usize) -> *const u8>;\r\n}\r\n```\r\nThis would be special-cased by the compiler in the same way it is now, where the symbol `foo` is of type `extern \"C\" fn(usize) -> *const u8`, and the variable `foo` is a handle to it, but it would make it much more clear what the actual type of the symbol is, since `Weak` is obviously not a C type. The interface of `Weak` would be something like\r\n```rust\r\nfn as_ref(&self) -> Option<&'static T>;\r\nunsafe fn as_ref_unchecked(&self) -> &'static T;\r\nunsafe fn as_mut(&mut self) -> Option<&'static mut T>;\r\nunsafe fn as_mut_unchecked(&mut self) -> &'static mut T;\r\n```\r\n\r\nSecond, the semantics. Instead of \"whatever llvm's extern_weak does,\" `Weak` should be defined as:\r\nOn platforms that support it, an external symbol of type T and the name of the static item is created. If the symbol isn't present at link time or run time, no error is generated. If the program has loaded a dynamic library that defines the symbol, `as_ref` returns a reference to the symbol, otherwise it returns `None`. If the platform doesn't support this, a compile-time error is generated.\r\n\r\nI think this is the behavior that people actually want, and is supported on Linux, OSX, and Windows. Getting it to work this way requires providing some flags to the linker ([`-U foo`](https://glandium.org/blog/?p=2764) on OSX and [`/ALTERNATENAME:foo=null_foo`](https://devblogs.microsoft.com/oldnewthing/20200731-00/?p=104024) on Windows), and it would be much easier and less error-prone for the compiler to do this than the programmer.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/966900393/reactions",
      "total_count": 8,
      "+1": 8,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/989070800",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-989070800",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 989070800,
    "node_id": "IC_kwDOAAsO6M469AXQ",
    "user": {
      "login": "joshtriplett",
      "id": 162737,
      "node_id": "MDQ6VXNlcjE2MjczNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/162737?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joshtriplett",
      "html_url": "https://github.com/joshtriplett",
      "followers_url": "https://api.github.com/users/joshtriplett/followers",
      "following_url": "https://api.github.com/users/joshtriplett/following{/other_user}",
      "gists_url": "https://api.github.com/users/joshtriplett/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joshtriplett/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joshtriplett/subscriptions",
      "organizations_url": "https://api.github.com/users/joshtriplett/orgs",
      "repos_url": "https://api.github.com/users/joshtriplett/repos",
      "events_url": "https://api.github.com/users/joshtriplett/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joshtriplett/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-12-08T18:25:25Z",
    "updated_at": "2021-12-08T18:25:25Z",
    "body": "Marking the overall `linkage` attribute as perma-unstable. We should review individual linkages (notably \"weak\") for stabilization, which may want to occur as a separate attribute or a value of a separate attribute.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/989070800/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/993552860",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-993552860",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 993552860,
    "node_id": "IC_kwDOAAsO6M47OGnc",
    "user": {
      "login": "yodaldevoid",
      "id": 1204409,
      "node_id": "MDQ6VXNlcjEyMDQ0MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1204409?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yodaldevoid",
      "html_url": "https://github.com/yodaldevoid",
      "followers_url": "https://api.github.com/users/yodaldevoid/followers",
      "following_url": "https://api.github.com/users/yodaldevoid/following{/other_user}",
      "gists_url": "https://api.github.com/users/yodaldevoid/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yodaldevoid/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yodaldevoid/subscriptions",
      "organizations_url": "https://api.github.com/users/yodaldevoid/orgs",
      "repos_url": "https://api.github.com/users/yodaldevoid/repos",
      "events_url": "https://api.github.com/users/yodaldevoid/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yodaldevoid/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2021-12-14T13:39:00Z",
    "updated_at": "2021-12-14T13:39:00Z",
    "body": "Should a separate issue be opened to specifically discuss \"weak\" linkage (or any other desired linkage attributes), or should discussion of stable linkage attributes continue to be discussed here?",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/993552860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1067621147",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-1067621147",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 1067621147,
    "node_id": "IC_kwDOAAsO6M4_opsb",
    "user": {
      "login": "comex",
      "id": 47517,
      "node_id": "MDQ6VXNlcjQ3NTE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/47517?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/comex",
      "html_url": "https://github.com/comex",
      "followers_url": "https://api.github.com/users/comex/followers",
      "following_url": "https://api.github.com/users/comex/following{/other_user}",
      "gists_url": "https://api.github.com/users/comex/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/comex/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/comex/subscriptions",
      "organizations_url": "https://api.github.com/users/comex/orgs",
      "repos_url": "https://api.github.com/users/comex/repos",
      "events_url": "https://api.github.com/users/comex/events{/privacy}",
      "received_events_url": "https://api.github.com/users/comex/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-03-15T06:40:53Z",
    "updated_at": "2022-03-15T06:45:08Z",
    "body": "A small rant about weak linkage: It's really two or maybe three separate features stuffed into one.  They have the same syntax in GNU extensions to C (`__attribute__((weak))`), and they use the same bit in ELF files (though not Mach-Os), but their semantics and use cases are different.\r\n\r\n1. A weak *reference* (LLVM's `extern_weak`) means \"this symbol is allowed to not be defined; treat it as null\".  If the symbol is defined somewhere else, that definition does not have to be weak.  On Darwin, this is sometimes used with OS APIs for backwards compatibility with old OS versions [(somewhat outdated reference)](https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPFrameworks/Concepts/WeakLinking.html).\r\n\r\n2. A weak *definition* (LLVM's `weak`) means \"there can be multiple copies of this symbol at (static) link time\".  Any given symbol name can have any number of weak definitions plus at most one strong definition.  If there's a strong definition it wins (except sometimes it doesn't because static library semantics are weird).  If there are only weak definitions, an arbitrary-ish one wins.  In C++, inline functions are generated as weak since they're guaranteed to have a unique address.  On Windows this is known as COMDAT or `selectany`.\r\n\r\n3. On Darwin only, a weak definition *also* sometimes implies \"force the dynamic linker to pick one symbol with this name across all libraries in the process\", in contrast to the default behavior where symbols with the same name in different dynamic libraries are independent of each other.  (On ELF, the behavior is determined by factors including the presence of `DF_SYMBOLIC` and `STB_GNU_UNIQUE`, but weakness doesn't affect it.)  It's not possible to turn this off using a LLVM linkage value.\r\n\r\nI find this situation quite confusing.  I'm not suggesting we should try to rewrite the terminology that platforms have established, but I think we can at least clearly differentiate between weak references and definitions.  For example, in @danielkeller's suggestion, instead of `Weak<T>`, we could use `WeakImport<T>` or maybe `WeakRef<T>`.  The `linkage` values are already different (`weak` versus `extern_weak`) but these could stand to have clearer names.  And of course, documentation can help.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1067621147/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1095336048",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-1095336048",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 1095336048,
    "node_id": "IC_kwDOAAsO6M5BSYBw",
    "user": {
      "login": "thomcc",
      "id": 860665,
      "node_id": "MDQ6VXNlcjg2MDY2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/860665?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thomcc",
      "html_url": "https://github.com/thomcc",
      "followers_url": "https://api.github.com/users/thomcc/followers",
      "following_url": "https://api.github.com/users/thomcc/following{/other_user}",
      "gists_url": "https://api.github.com/users/thomcc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thomcc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thomcc/subscriptions",
      "organizations_url": "https://api.github.com/users/thomcc/orgs",
      "repos_url": "https://api.github.com/users/thomcc/repos",
      "events_url": "https://api.github.com/users/thomcc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thomcc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-04-11T17:32:19Z",
    "updated_at": "2022-04-11T17:32:19Z",
    "body": "Yeah, I think that we should avoid conflating these if we ever decide to expose this as a feature. Weak imports behave quite well on darwin (where they're extremely widely used, usually via the macros like `__OSX_AVAILABLE`, which switch to a weak import when if your minimum target OS version isn't that recent).\r\n\r\nThat said, it's not clear what we need to do to make our implementation of them actually work -- `#[linkage = \"extern_weak\"]` on macOS does mark the symbol as `N_WEAK_REF` in the MachO, but macOS's linker still gets upset about it unless you also tell rustc to send the linker `-U _symbol_that_may_be_weak` (or `-undefined dynamic_lookup`, but we probably don't want to do that). Otherwise, while it *is* a weak symbol, it's not allowed to be undefined.\r\n\r\nOddly, everything actually works without the if the Rust code is built as a static library and linked into an XCode build. I haven't looked into it but this implies that... there's a workaround in XCode for the linker's behavior? If so, this would be pretty hairy, to be honest, so frankly I hope it is not what's happening?",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1095336048/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1097223001",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-1097223001",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 1097223001,
    "node_id": "IC_kwDOAAsO6M5BZktZ",
    "user": {
      "login": "thomcc",
      "id": 860665,
      "node_id": "MDQ6VXNlcjg2MDY2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/860665?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thomcc",
      "html_url": "https://github.com/thomcc",
      "followers_url": "https://api.github.com/users/thomcc/followers",
      "following_url": "https://api.github.com/users/thomcc/following{/other_user}",
      "gists_url": "https://api.github.com/users/thomcc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thomcc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thomcc/subscriptions",
      "organizations_url": "https://api.github.com/users/thomcc/orgs",
      "repos_url": "https://api.github.com/users/thomcc/repos",
      "events_url": "https://api.github.com/users/thomcc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thomcc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-04-12T21:12:11Z",
    "updated_at": "2022-04-12T21:12:11Z",
    "body": "Nope! That was wrong. It turns out that the way it works on apple is that the symbol must exist at link time (e.g. on the host system) or you get the undefined symbol error. This is orthogonal to it being weak reference/import, which just indicates whether it's allowed to resolve. I suppose this might be to save people who try to weakly link against `_get_entropy` rather than `_getentropy`, and that sort of thing. Tragically, I doubt these are the semantics we'd want for this, since it's too host-specific.\r\n\r\nXCode does seem to work around this, using some shenanigans with `.tbd` and `.map` files, although ",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1097223001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1227764764",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-1227764764",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 1227764764,
    "node_id": "IC_kwDOAAsO6M5JLjQc",
    "user": {
      "login": "kupiakos",
      "id": 3309728,
      "node_id": "MDQ6VXNlcjMzMDk3Mjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3309728?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kupiakos",
      "html_url": "https://github.com/kupiakos",
      "followers_url": "https://api.github.com/users/kupiakos/followers",
      "following_url": "https://api.github.com/users/kupiakos/following{/other_user}",
      "gists_url": "https://api.github.com/users/kupiakos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kupiakos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kupiakos/subscriptions",
      "organizations_url": "https://api.github.com/users/kupiakos/orgs",
      "repos_url": "https://api.github.com/users/kupiakos/repos",
      "events_url": "https://api.github.com/users/kupiakos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kupiakos/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2022-08-25T21:08:58Z",
    "updated_at": "2023-07-20T21:53:56Z",
    "body": "For now, can we open up the restrictions of `#[linkage]` to allow for `Option<fn()>` as well as `*const T`/`*mut T`? That's the natural way to describe a nullable function pointer. Right now, the only way to `extern_weak` a function is by declaring it as `*const whatever` and `transmute`: https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=8b9866283aa51360db447f982b9839dd.\r\n\r\nUpdate: the following now works:\r\n\r\n```rust\r\nextern \"C\" {\r\n    #[linkage = \"extern_weak\"]\r\n    static puts: Option<unsafe extern \"C\" fn(x: *const u8)>;\r\n}\r\n\r\nfn main() {\r\n    let str = b\"called puts\\n\\0\";\r\n    let p = unsafe { puts }.expect(\"puts isn't linked\");\r\n    unsafe { (p)(str.as_ptr()) }\r\n}\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1227764764/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1597662999",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-1597662999",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 1597662999,
    "node_id": "IC_kwDOAAsO6M5fOmcX",
    "user": {
      "login": "mojingran",
      "id": 55104525,
      "node_id": "MDQ6VXNlcjU1MTA0NTI1",
      "avatar_url": "https://avatars.githubusercontent.com/u/55104525?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mojingran",
      "html_url": "https://github.com/mojingran",
      "followers_url": "https://api.github.com/users/mojingran/followers",
      "following_url": "https://api.github.com/users/mojingran/following{/other_user}",
      "gists_url": "https://api.github.com/users/mojingran/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mojingran/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mojingran/subscriptions",
      "organizations_url": "https://api.github.com/users/mojingran/orgs",
      "repos_url": "https://api.github.com/users/mojingran/repos",
      "events_url": "https://api.github.com/users/mojingran/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mojingran/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2023-06-19T19:30:09Z",
    "updated_at": "2023-08-22T14:31:06Z",
    "body": "I propose that the linkage attributes other than \"weak\" and \"extern_weak\" should be disabled, since they have no practical usages, and furthermore, some unsupported attributes are causing ICE, such as [#109681](https://github.com/rust-lang/rust/issues/109681). \r\nI came up with this idea when I came across [#109681](https://github.com/rust-lang/rust/issues/109681) and was trying to solve it. I am wondering whether this is a good idea. If so, I can implement this change.  ",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/1597662999/reactions",
      "total_count": 4,
      "+1": 4,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2550263048",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-2550263048",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 2550263048,
    "node_id": "IC_kwDOAAsO6M6YAe0I",
    "user": {
      "login": "HaoboGu",
      "id": 8640918,
      "node_id": "MDQ6VXNlcjg2NDA5MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8640918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/HaoboGu",
      "html_url": "https://github.com/HaoboGu",
      "followers_url": "https://api.github.com/users/HaoboGu/followers",
      "following_url": "https://api.github.com/users/HaoboGu/following{/other_user}",
      "gists_url": "https://api.github.com/users/HaoboGu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/HaoboGu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/HaoboGu/subscriptions",
      "organizations_url": "https://api.github.com/users/HaoboGu/orgs",
      "repos_url": "https://api.github.com/users/HaoboGu/repos",
      "events_url": "https://api.github.com/users/HaoboGu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/HaoboGu/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-12-18T03:51:26Z",
    "updated_at": "2024-12-18T03:51:26Z",
    "body": "\"weak\" linkage is extremely useful in embedded development. Could we get it implemented first?",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2550263048/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2550812860",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-2550812860",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 2550812860,
    "node_id": "IC_kwDOAAsO6M6YClC8",
    "user": {
      "login": "zopsicle",
      "id": 50083900,
      "node_id": "MDQ6VXNlcjUwMDgzOTAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/50083900?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zopsicle",
      "html_url": "https://github.com/zopsicle",
      "followers_url": "https://api.github.com/users/zopsicle/followers",
      "following_url": "https://api.github.com/users/zopsicle/following{/other_user}",
      "gists_url": "https://api.github.com/users/zopsicle/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zopsicle/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zopsicle/subscriptions",
      "organizations_url": "https://api.github.com/users/zopsicle/orgs",
      "repos_url": "https://api.github.com/users/zopsicle/repos",
      "events_url": "https://api.github.com/users/zopsicle/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zopsicle/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-12-18T09:26:03Z",
    "updated_at": "2024-12-18T09:26:03Z",
    "body": "`const fn`s should not be allowed to be weakly linked as their effective bodies would be unknown when evaluating consts: <https://github.com/rust-lang/rust/issues/134451>",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2550812860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2742704854",
    "html_url": "https://github.com/rust-lang/rust/issues/29603#issuecomment-2742704854",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29603",
    "id": 2742704854,
    "node_id": "IC_kwDOAAsO6M6jelrW",
    "user": {
      "login": "romancardenas",
      "id": 12596603,
      "node_id": "MDQ6VXNlcjEyNTk2NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/12596603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/romancardenas",
      "html_url": "https://github.com/romancardenas",
      "followers_url": "https://api.github.com/users/romancardenas/followers",
      "following_url": "https://api.github.com/users/romancardenas/following{/other_user}",
      "gists_url": "https://api.github.com/users/romancardenas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/romancardenas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/romancardenas/subscriptions",
      "organizations_url": "https://api.github.com/users/romancardenas/orgs",
      "repos_url": "https://api.github.com/users/romancardenas/repos",
      "events_url": "https://api.github.com/users/romancardenas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/romancardenas/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2025-03-21T08:47:55Z",
    "updated_at": "2025-03-21T08:47:55Z",
    "body": "As @luojia65 and @HaoboGu said previously, weak symbols are very useful for runtimes in embedded applications. We are currently facing issues in `riscv-rt` with link-time optimizations and weak symbols in assembly code ([247](https://github.com/rust-embedded/riscv/issues/247)). Is it possible to stabilize `#[linkage = \"weak\"]` for non-const functions, at least? I have never contributed to the Rust core sources, but if I can help with anything, I'll try my best.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2742704854/reactions",
      "total_count": 10,
      "+1": 10,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
