[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120389056",
    "html_url": "https://github.com/rust-lang/rust/issues/26933#issuecomment-120389056",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26933",
    "id": 120389056,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMDM4OTA1Ng==",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-10T11:27:48Z",
    "updated_at": "2015-07-10T11:27:48Z",
    "body": "How would this work when copying a file that has no write permissions for anyone? :)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120389056/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120408028",
    "html_url": "https://github.com/rust-lang/rust/issues/26933#issuecomment-120408028",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26933",
    "id": 120408028,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMDQwODAyOA==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-10T13:14:38Z",
    "updated_at": "2015-07-10T13:14:38Z",
    "body": "It will also fail to preserve any additional metadata or alternate data streams attached to the file. The only reliable way I could find of doing this on *nix was to invoke `cp` which is rather unfortunate...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120408028/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120423562",
    "html_url": "https://github.com/rust-lang/rust/issues/26933#issuecomment-120423562",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26933",
    "id": 120423562,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMDQyMzU2Mg==",
    "user": {
      "login": "Stebalien",
      "id": 310393,
      "node_id": "MDQ6VXNlcjMxMDM5Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/310393?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Stebalien",
      "html_url": "https://github.com/Stebalien",
      "followers_url": "https://api.github.com/users/Stebalien/followers",
      "following_url": "https://api.github.com/users/Stebalien/following{/other_user}",
      "gists_url": "https://api.github.com/users/Stebalien/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Stebalien/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Stebalien/subscriptions",
      "organizations_url": "https://api.github.com/users/Stebalien/orgs",
      "repos_url": "https://api.github.com/users/Stebalien/repos",
      "events_url": "https://api.github.com/users/Stebalien/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Stebalien/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-10T14:33:09Z",
    "updated_at": "2015-07-10T15:30:48Z",
    "body": "@Diggsey `cp` also copies permissions _after_ copying the data (so does python incidentally).\n\nHowever, `cp` will try to create the target file with the source's mode if it doesn't exist (good). Unfortunately, even if you copy the permissions first, anyone who has the file open will still be able to read it (at least on linux) and, as ACLs can actually remove access to a file, creating the destination file with the source file's mode isn't actually secure. The secure way to do this is to (on linux):\n1. Create a temporary file with mode 0. (or 0600 but 0 is simpler)\n2. Copy the ACLs. Fail if this doesn't work.\n3. Copy the mode. Fail if this doesn't work.\n4. rename the temporary file over the target file.\n5. Copy the data.\n\nUnfortunately,\n1. The whole \"create a temporary file and rename\" part differs significantly from what cp does and won't work if the user doesn't have write permissions on the target directory (while overwriting the target file might).\n2. Copying a file from a filesystem that supports ACLs to a file system that doesn't may fail unexpectedly.\n\ncp specification if anyone is interested: http://pubs.opengroup.org/onlinepubs/9699919799/utilities/cp.html\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120423562/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120550157",
    "html_url": "https://github.com/rust-lang/rust/issues/26933#issuecomment-120550157",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26933",
    "id": 120550157,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMDU1MDE1Nw==",
    "user": {
      "login": "nagisa",
      "id": 679122,
      "node_id": "MDQ6VXNlcjY3OTEyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nagisa",
      "html_url": "https://github.com/nagisa",
      "followers_url": "https://api.github.com/users/nagisa/followers",
      "following_url": "https://api.github.com/users/nagisa/following{/other_user}",
      "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions",
      "organizations_url": "https://api.github.com/users/nagisa/orgs",
      "repos_url": "https://api.github.com/users/nagisa/repos",
      "events_url": "https://api.github.com/users/nagisa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nagisa/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-10T23:29:40Z",
    "updated_at": "2015-07-10T23:29:40Z",
    "body": "> How would this work when copying a file that has no write permissions for anyone? :)\n\nOpen a file for writing and change permissions before writing anything. While there\u2019s still a window for a malicious party to open the file, it is much smaller.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120550157/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120561900",
    "html_url": "https://github.com/rust-lang/rust/issues/26933#issuecomment-120561900",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26933",
    "id": 120561900,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMDU2MTkwMA==",
    "user": {
      "login": "Stebalien",
      "id": 310393,
      "node_id": "MDQ6VXNlcjMxMDM5Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/310393?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Stebalien",
      "html_url": "https://github.com/Stebalien",
      "followers_url": "https://api.github.com/users/Stebalien/followers",
      "following_url": "https://api.github.com/users/Stebalien/following{/other_user}",
      "gists_url": "https://api.github.com/users/Stebalien/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Stebalien/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Stebalien/subscriptions",
      "organizations_url": "https://api.github.com/users/Stebalien/orgs",
      "repos_url": "https://api.github.com/users/Stebalien/repos",
      "events_url": "https://api.github.com/users/Stebalien/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Stebalien/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-11T01:41:02Z",
    "updated_at": "2015-07-11T01:41:02Z",
    "body": "> Open a file for writing and change permissions before writing anything.\n1. If the file already exists you should just fail and return an error instead of trying to overwrite a read-only file.\n2. (On linux, I don't know about windows) If the file doesn't exist, it doesn't matter what mode you create the file with, you will always be able to write to it (as long as you open it for writing):\n\n``` rust\nuse std::fs::File;\nuse std::fs::OpenOptions;\nuse std::os::unix::fs::OpenOptionsExt;\nuse std::io::Write;\n\nfn main() {\n    let mut f = OpenOptions::new().write(true).create(true).truncate(true).mode(0).open(\"/tmp/my_f\").unwrap();\n    f.write(b\"test str\");\n    f.flush();\n}\n```\n\n> While there\u2019s still a window for a malicious party to open the file, it is much smaller.\n\n&lt;ta mode>\nForget this entire concept; this is not how computer security works. A small window just means that the attacker might have to try a couple of times or, even better, spin up a hundred threads trying to open the file in while loops. You don't minimize races, you eliminate them. I can't express how important this is not only in computer system security but computer systems in general. If something can go wrong, it probably will; if it can go wrong often enough, it definitely will.\n&lt;/ta mode>\n\nRegardless, in this case this discussion is moot assuming you only make the file writable to the current user because the attacker would have to run as the current user to exploit this (at which point they could do just about anything...).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120561900/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120627771",
    "html_url": "https://github.com/rust-lang/rust/issues/26933#issuecomment-120627771",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26933",
    "id": 120627771,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMDYyNzc3MQ==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-11T15:03:57Z",
    "updated_at": "2015-07-11T15:03:57Z",
    "body": "This isn't an issue on windows because it provides `CopyFile`, `CopyFileEx` which do the job properly, including preserving metadata and alternate data streams.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120627771/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120661879",
    "html_url": "https://github.com/rust-lang/rust/issues/26933#issuecomment-120661879",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26933",
    "id": 120661879,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMDY2MTg3OQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-11T21:12:15Z",
    "updated_at": "2016-12-26T14:26:21Z",
    "body": "@Diggsey We actually do use `CopyFileEx` on Windows as of https://github.com/rust-lang/rust/pull/26751, so this is purely a non-Windows issue now.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/120661879/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122048491",
    "html_url": "https://github.com/rust-lang/rust/issues/26933#issuecomment-122048491",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26933",
    "id": 122048491,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMjA0ODQ5MQ==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-16T18:51:00Z",
    "updated_at": "2015-07-16T18:51:00Z",
    "body": "/cc @rust-lang/libs \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/122048491/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/345176978",
    "html_url": "https://github.com/rust-lang/rust/issues/26933#issuecomment-345176978",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26933",
    "id": 345176978,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTE3Njk3OA==",
    "user": {
      "login": "dtolnay",
      "id": 1940490,
      "node_id": "MDQ6VXNlcjE5NDA0OTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dtolnay",
      "html_url": "https://github.com/dtolnay",
      "followers_url": "https://api.github.com/users/dtolnay/followers",
      "following_url": "https://api.github.com/users/dtolnay/following{/other_user}",
      "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions",
      "organizations_url": "https://api.github.com/users/dtolnay/orgs",
      "repos_url": "https://api.github.com/users/dtolnay/repos",
      "events_url": "https://api.github.com/users/dtolnay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dtolnay/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-11-17T08:25:37Z",
    "updated_at": "2017-11-17T08:25:37Z",
    "body": "I agree that the current handling of permissions in `std::fs::copy` on non-WIndows seems incorrect. I would be prepared to consider a PR that fixes this.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/345176978/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
