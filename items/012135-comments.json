[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34594638",
    "html_url": "https://github.com/rust-lang/rust/issues/12135#issuecomment-34594638",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12135",
    "id": 34594638,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTk0NjM4",
    "user": {
      "login": "lifthrasiir",
      "id": 323836,
      "node_id": "MDQ6VXNlcjMyMzgzNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/323836?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lifthrasiir",
      "html_url": "https://github.com/lifthrasiir",
      "followers_url": "https://api.github.com/users/lifthrasiir/followers",
      "following_url": "https://api.github.com/users/lifthrasiir/following{/other_user}",
      "gists_url": "https://api.github.com/users/lifthrasiir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lifthrasiir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lifthrasiir/subscriptions",
      "organizations_url": "https://api.github.com/users/lifthrasiir/orgs",
      "repos_url": "https://api.github.com/users/lifthrasiir/repos",
      "events_url": "https://api.github.com/users/lifthrasiir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lifthrasiir/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-10T01:28:26Z",
    "updated_at": "2014-02-11T03:54:36Z",
    "body": "Some thought on the HashMap design: How about making HashMap accept an optional comparator for arguments? Every method in HashMap starts with finding the slot by some key, so that's what really has to be refactored. So the HashMap signature may read `HashMap<K, V, ArgKey = K, ArgComp = Eq<K>>`, and there would be an adapter from the `Eq`-based HashMap to the `Equiv`-based HashMap:\n\n``` rust\nimpl<K:Hash+Eq,V> HashMap<K,V,K,Eq<K>> {\n    pub fn into_equiv<ArgKey>(self) -> HashMap<K,V,ArgKey,Equiv<ArgKey>> { ... }\n}\n```\n\nThis won't change the casual use of `Eq`-based HashMaps (always constructed using `new` method), and `Map` and `MutableMap` traits won't change. Moreover, since it is just a matter of changing searches by key such adaptor methods do not incur much cost (no rehashing, for example). As long as `ArgKey` is easy to infer, this design is far better than the current one in my opinion.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34594638/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34746386",
    "html_url": "https://github.com/rust-lang/rust/issues/12135#issuecomment-34746386",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12135",
    "id": 34746386,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzQ2Mzg2",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-11T11:35:50Z",
    "updated_at": "2014-02-11T11:35:50Z",
    "body": "@pcwalton has an interesting use case for Equiv-based lookups: in servo they have a hashtable that is constructed using a case-insensitive hash, but then they do case-sensitive lookups using a different equality comparator. This use case cannot be accommodated by having a comparator per map.\n\nIf we had completed DST (#6308), then I was thinking that we could have a hashtable intended for DST keys. The main difference would be that this table's `insert()` method would take `~K` and not `K`, and `find()` and friends would take `&K` as today. In this case, `K` would be `str` or `[u8]` (or possibly user-defined structs with a last field that is DS). It would be a shame to require a distinct hashtable, but I imagine we could abstract out most of the implementation. I don't yet see how we can have a single hash that takes both non-pointer keys (`Foo`) and DST keys (`str`).\n\nThere was a previous proposal (now closed, I think) to just only have the `_equiv` family of functions. Perhaps we were in undue haste to close that.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34746386/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34762578",
    "html_url": "https://github.com/rust-lang/rust/issues/12135#issuecomment-34762578",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12135",
    "id": 34762578,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzYyNTc4",
    "user": {
      "login": "zkamsler",
      "id": 944662,
      "node_id": "MDQ6VXNlcjk0NDY2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/944662?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zkamsler",
      "html_url": "https://github.com/zkamsler",
      "followers_url": "https://api.github.com/users/zkamsler/followers",
      "following_url": "https://api.github.com/users/zkamsler/following{/other_user}",
      "gists_url": "https://api.github.com/users/zkamsler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zkamsler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zkamsler/subscriptions",
      "organizations_url": "https://api.github.com/users/zkamsler/orgs",
      "repos_url": "https://api.github.com/users/zkamsler/repos",
      "events_url": "https://api.github.com/users/zkamsler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zkamsler/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-11T15:06:28Z",
    "updated_at": "2014-02-11T15:09:54Z",
    "body": "If types that implemented `Eq` were `Equiv` to itself, then the `_equiv` versions would be a strict superset of the standard ones. The only things that require the actual key type are the methods that may insert a new value (which is admittedly quite a few). C++14 does a similar thing by templatizing many of the methods of the stl containers (e.g. http://en.cppreference.com/w/cpp/container/map/find).\n\nBut with a more complex signature, it may less easy to understand, with somewhat less specific error messages if there are compiler errors. It also depends on the assumption that the key-equivalent hashes to the same value as the key itself, which is likely but not certain.\n\n```\nimpl<T:Eq> Equiv<T> for T {\n    fn equiv(&self, other: &T) -> bool { self.eq(other) }\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34762578/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47719102",
    "html_url": "https://github.com/rust-lang/rust/issues/12135#issuecomment-47719102",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12135",
    "id": 47719102,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzE5MTAy",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-01T22:59:15Z",
    "updated_at": "2014-07-01T22:59:15Z",
    "body": "cc me\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47719102/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49321346",
    "html_url": "https://github.com/rust-lang/rust/issues/12135#issuecomment-49321346",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12135",
    "id": 49321346,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzIxMzQ2",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-17T15:20:14Z",
    "updated_at": "2014-07-17T16:05:38Z",
    "body": "A further note on the option of providing only `equiv`-style methods:\n\nIn some sense, methods like find_equiv are generalizations of find, but the current trait system makes it so that you cannot usefully do `impl<T> Equiv<T> for T`. (Once you do that you can't provide further `impl`s of `Equiv`.)\n\nIf @nikomatsakis's [`where` clause proposal](https://github.com/rust-lang/rfcs/pull/135) lands, I wonder if we could provide such an `impl` using a multi-parameter version of `Equiv`. That way, we could give only methods that use the `Equiv` approach, but they would work even when you're using the key type itself, eliminating the API redundancy.\n\nThe signature would look something like:\n\n``` rust\nfn find<'a, Q>(&'a self, k: &Q) -> Option<&'a V>\n    where Q: Hash<S>, () : Equiv<K, Q>\n```\n\nusing the trick of encoding multiparameter typeclasses via impls on the unit type.\n\nWe'd also have `impl<T> Equiv<T, T> for ()`, so that this `find` is usable in the same way the current find is -- thus merging the `find` and `find_equiv` functionality.\n\nBut as @zkamsler says (and @pcwalton pointed out [elsewhere](https://github.com/rust-lang/rust/pull/15721#issuecomment-49257590)), this makes the signature for basic `HashMap` operations harder to understand. So we trade complexity in API size for complexity in signatures.\n\n---\n\nAnother possibility might be to provide an additional type parameter to the `HashMap` itself -- basically, a type for borrowed keys. If we could make this default to `&K`, it would be hidden most of the time. But this would let you specify that you want a `HashMap` with `String` keys but using `&str` for lookups. With sufficient hiding/defaulting of this extra parameter, we could make the default case look just like the current interface. (This is somewhat similar to @lifthrasiir's suggestion above, I think.) This would allow us to drop the `_equiv` methods in favor of the normal ones.\n\nIf that's too complex, yet another option would be to use something like the above generic implementation internally, but expose multiple instances of it. Something like: `GenericHashMap` which takes `OwnedKey` and `BorrowedKey` type parameters, and `HashMap` which takes `K` and sets `OwnedKey = K` and `BorrowedKey = &K`. We could then provide e.g. `DSTHashMap`.\n\n---\n\nOne other thing: methods like `find_or_insert` currently take an owned key, which is discarded if the key is already in the map. An alternative that covers most use-cases would be to require `K` to be `Clone`, take `&K`, and then `clone()` only when needed. Since the motivation for `_equiv` methods is mainly to avoid having to allocate (i.e. `.find(&key.to_string())`), we should strive for a solution that works for `find_or_insert` as well.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/49321346/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62042471",
    "html_url": "https://github.com/rust-lang/rust/issues/12135#issuecomment-62042471",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12135",
    "id": 62042471,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMDQyNDcx",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T20:06:48Z",
    "updated_at": "2014-11-06T20:06:48Z",
    "body": "@alexcrichton Should we close this in favor of the collections reform metabug #18424 ?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62042471/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63529931",
    "html_url": "https://github.com/rust-lang/rust/issues/12135#issuecomment-63529931",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12135",
    "id": 63529931,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNTI5OTMx",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-18T19:30:39Z",
    "updated_at": "2014-11-18T19:30:39Z",
    "body": "Closing now that https://github.com/rust-lang/rust/pull/18910 has landed.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63529931/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
