{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/13316",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/13316/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/13316/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/13316/events",
  "html_url": "https://github.com/rust-lang/rust/pull/13316",
  "id": 30876315,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTQzOTIxOTI=",
  "number": 13316,
  "title": "Replace @T in the AST with a smart pointer.",
  "user": {
    "login": "eddyb",
    "id": 77424,
    "node_id": "MDQ6VXNlcjc3NDI0",
    "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/eddyb",
    "html_url": "https://github.com/eddyb",
    "followers_url": "https://api.github.com/users/eddyb/followers",
    "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
    "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
    "organizations_url": "https://api.github.com/users/eddyb/orgs",
    "repos_url": "https://api.github.com/users/eddyb/repos",
    "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/eddyb/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 27,
  "created_at": "2014-04-04T16:47:46Z",
  "updated_at": "2014-09-15T11:19:53Z",
  "closed_at": "2014-09-14T05:41:06Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/13316",
    "html_url": "https://github.com/rust-lang/rust/pull/13316",
    "diff_url": "https://github.com/rust-lang/rust/pull/13316.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/13316.patch",
    "merged_at": "2014-09-14T05:41:06Z"
  },
  "body": "Replaces Gc<T> in the AST with a custom owned smart pointer, P<T>. Fixes #7929.\n## Benefits\n- **Identity** (affinity?): sharing AST nodes is bad for the various analysis passes (e.g. one could bypass borrowck with a shared `ExprAddrOf` node taking a mutable borrow), the only reason we haven't hit any serious issues with it is because of inefficient folding passes which will always deduplicate any such shared nodes. Even if we were to switch to an arena, this would still hold, i.e. we wouldn't just use `&'a T` in the AST, but rather an wrapper (`P<'a, T>`?).\n- **Immutability**: `P<T>` disallows mutating its inner `T` (unless that contains an `Unsafe` interior, which won't happen in the AST), unlike `~T`.\n- **Efficiency**: folding can reuse allocation space for `P<T>` and `Vec<T>`, the latter even when the input and output types differ (as it would be the case with arenas or an AST with type parameters to toggle macro support). Also, various algorithms have been changed from copying `Gc<T>` to using `&T` and iterators.\n- **Maintainability**: there is another reason I didn't just replace `Gc<T>` with `~T`: `P<T>` provides a fixed interface (`Deref`, `and_then` and `map`) which can remain fully functional even if the implementation changes (using a special thread-local heap, for example). Moreover, switching to, e.g. `P<'a, T>` (for a contextual arena) is easy and mostly automated.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/13316/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/13316/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
