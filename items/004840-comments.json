[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13276251",
    "html_url": "https://github.com/rust-lang/rust/pull/4840#issuecomment-13276251",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4840",
    "id": 13276251,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMjc2MjUx",
    "user": {
      "login": "jbclements",
      "id": 226617,
      "node_id": "MDQ6VXNlcjIyNjYxNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/226617?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jbclements",
      "html_url": "https://github.com/jbclements",
      "followers_url": "https://api.github.com/users/jbclements/followers",
      "following_url": "https://api.github.com/users/jbclements/following{/other_user}",
      "gists_url": "https://api.github.com/users/jbclements/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jbclements/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jbclements/subscriptions",
      "organizations_url": "https://api.github.com/users/jbclements/orgs",
      "repos_url": "https://api.github.com/users/jbclements/repos",
      "events_url": "https://api.github.com/users/jbclements/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jbclements/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-08T04:12:48Z",
    "updated_at": "2013-02-08T04:12:48Z",
    "body": "Sure, it should emit, e.g., [\"None\"] for None. I can add a test case for this, if you like.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13276251/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13277746",
    "html_url": "https://github.com/rust-lang/rust/pull/4840#issuecomment-13277746",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4840",
    "id": 13277746,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMjc3NzQ2",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-08T05:37:24Z",
    "updated_at": "2013-02-08T05:37:24Z",
    "body": "Right, but I mean, the code I left the comment on looks like it'll emit `[\"None\",]` -- note trailing comma. Is that legit JSON?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13277746/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13277926",
    "html_url": "https://github.com/rust-lang/rust/pull/4840#issuecomment-13277926",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4840",
    "id": 13277926,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMjc3OTI2",
    "user": {
      "login": "jbclements",
      "id": 226617,
      "node_id": "MDQ6VXNlcjIyNjYxNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/226617?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jbclements",
      "html_url": "https://github.com/jbclements",
      "followers_url": "https://api.github.com/users/jbclements/followers",
      "following_url": "https://api.github.com/users/jbclements/following{/other_user}",
      "gists_url": "https://api.github.com/users/jbclements/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jbclements/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jbclements/subscriptions",
      "organizations_url": "https://api.github.com/users/jbclements/orgs",
      "repos_url": "https://api.github.com/users/jbclements/repos",
      "events_url": "https://api.github.com/users/jbclements/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jbclements/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-08T05:46:56Z",
    "updated_at": "2013-02-08T05:46:56Z",
    "body": "Ah! you left the comment on a line that does indeed contain a bug, but a later commit in this pull request (978d33b3decf0620b50) fixes that bug. Perhaps in the future I should flatten my commits before putting them into a pull request?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13277926/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13278229",
    "html_url": "https://github.com/rust-lang/rust/pull/4840#issuecomment-13278229",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4840",
    "id": 13278229,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMjc4MjI5",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-08T06:02:50Z",
    "updated_at": "2013-02-08T06:02:50Z",
    "body": "I would be cautious landing this. I serialized the Option type like this on purpose so that we can use the serialization tools with APIs that take optional values. Unfortunately I couldn't come up with a clever way to support nullable values and enums at the same time. It may be possible to do something special for just Option types, and fall through to this string based techniques for other types, but I wasn't really happy with that as it could lead to unexpected behavior. @nikomatsakis, any chance you've given any thought to this problem?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13278229/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13278988",
    "html_url": "https://github.com/rust-lang/rust/pull/4840#issuecomment-13278988",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4840",
    "id": 13278988,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMjc4OTg4",
    "user": {
      "login": "jbclements",
      "id": 226617,
      "node_id": "MDQ6VXNlcjIyNjYxNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/226617?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jbclements",
      "html_url": "https://github.com/jbclements",
      "followers_url": "https://api.github.com/users/jbclements/followers",
      "following_url": "https://api.github.com/users/jbclements/following{/other_user}",
      "gists_url": "https://api.github.com/users/jbclements/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jbclements/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jbclements/subscriptions",
      "organizations_url": "https://api.github.com/users/jbclements/orgs",
      "repos_url": "https://api.github.com/users/jbclements/repos",
      "events_url": "https://api.github.com/users/jbclements/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jbclements/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-08T06:47:43Z",
    "updated_at": "2013-02-08T06:47:43Z",
    "body": "@erickt, I think I see two different use cases for JSON serialization--and I can see how they'd lead to different solutions. \n\nUse Case 1: Twitter API. In a situation like this, the goal is to make it easy for a programmer to define a set of rust values that auto-encode into a given JSON format, where \"null\" has an existing and externally-defined meaning. \n\nUse Case 2: Rust object serialization. In a situation like this, the goal is to serialize Rust objects in an information-preserving way, say for instance to allow the comparison of ASTs while developing a regression test suite for parsing tools (just for instance :) .) In this use case, the goal isn't to match an existing external API, but instead to preserve the information necessary to compare Rust values.\n\nI see the existing implementation (only Option enums are supported) as supporting use case 1. I see my proposed implementation as supporting use case 2.  \n\nFinally, I should add that neither decision is entirely incompatible with the other; it's possible to avoid using #[auto_encode], and instead define your own implementation that does whatever you want on the particular type that you have in mind... at the potential cost of quite a bit of code.  For instance, serializing the enums defined in ast.rs without the help of #[auto_encode] would be pretty dreadful. \n\nHow does this all sound to you?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13278988/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13300544",
    "html_url": "https://github.com/rust-lang/rust/pull/4840#issuecomment-13300544",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4840",
    "id": 13300544,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMzAwNTQ0",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-08T17:13:44Z",
    "updated_at": "2013-02-08T17:13:44Z",
    "body": "There are several heavier-engineering ways to handle this but ... thinking about it, I _think_ we always drive serialization and de-serialization from rust types, so ... tentatively, I don't _think_ it's problematic to handle `Option<T>` in a way that serializes and de-serializes as `null` or `T` depending on variant. I would of course like to serialize _other_ enums as something as well, not just error-out on them. But special-casing `Option` doesn't seem like a unique problem.\n\nKeep in mind, there's are going to be quite a few mismatches between rust types and the values representable in various serialization schemes; most won't differentiate (say) `~[]` from `@[]`, between `i8` or `u16`, or in many cases even between `int` and `float`! So a serialization simply has to be precise enough to inform a rust-type-directed serializer to \"fill in the missing data\", not uniquely determine a rust type.\n\n(It won't, for example, understand rust scope rules or versioning either, so matching string-names of variants against \"variants a given type-directed deserializer is looking for\" is the best we can ever manage; it won't precisely identify a type)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13300544/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13339306",
    "html_url": "https://github.com/rust-lang/rust/pull/4840#issuecomment-13339306",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4840",
    "id": 13339306,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMzM5MzA2",
    "user": {
      "login": "jbclements",
      "id": 226617,
      "node_id": "MDQ6VXNlcjIyNjYxNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/226617?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jbclements",
      "html_url": "https://github.com/jbclements",
      "followers_url": "https://api.github.com/users/jbclements/followers",
      "following_url": "https://api.github.com/users/jbclements/following{/other_user}",
      "gists_url": "https://api.github.com/users/jbclements/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jbclements/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jbclements/subscriptions",
      "organizations_url": "https://api.github.com/users/jbclements/orgs",
      "repos_url": "https://api.github.com/users/jbclements/repos",
      "events_url": "https://api.github.com/users/jbclements/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jbclements/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-09T21:43:51Z",
    "updated_at": "2013-02-09T21:43:51Z",
    "body": "@graydon, @erickt: Okey dokey, I think I can make everyone happy here. I've restored the special-case on Option, though I had to change the formatting of the other enums slightly because the lack of information transfer between writing the option header and writing the option values made the existing proposal incompatible with the Option special-case. There are test cases for Some, None, and other enums.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13339306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13463219",
    "html_url": "https://github.com/rust-lang/rust/pull/4840#issuecomment-13463219",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4840",
    "id": 13463219,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNDYzMjE5",
    "user": {
      "login": "jbclements",
      "id": 226617,
      "node_id": "MDQ6VXNlcjIyNjYxNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/226617?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jbclements",
      "html_url": "https://github.com/jbclements",
      "followers_url": "https://api.github.com/users/jbclements/followers",
      "following_url": "https://api.github.com/users/jbclements/following{/other_user}",
      "gists_url": "https://api.github.com/users/jbclements/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jbclements/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jbclements/subscriptions",
      "organizations_url": "https://api.github.com/users/jbclements/orgs",
      "repos_url": "https://api.github.com/users/jbclements/repos",
      "events_url": "https://api.github.com/users/jbclements/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jbclements/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-12T22:30:12Z",
    "updated_at": "2013-02-12T22:30:12Z",
    "body": "@bors: retry\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/13463219/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
