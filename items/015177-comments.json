[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47099920",
    "html_url": "https://github.com/rust-lang/rust/issues/15177#issuecomment-47099920",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15177",
    "id": 47099920,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MDk5OTIw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-25T13:25:49Z",
    "updated_at": "2014-06-25T13:25:49Z",
    "body": "Can you be sure that the 0.10 version isn't being optimized away by returning the result of `reader.read_to_end()`?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47099920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47100816",
    "html_url": "https://github.com/rust-lang/rust/issues/15177#issuecomment-47100816",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15177",
    "id": 47100816,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTAwODE2",
    "user": {
      "login": "arjantop",
      "id": 52403,
      "node_id": "MDQ6VXNlcjUyNDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/52403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arjantop",
      "html_url": "https://github.com/arjantop",
      "followers_url": "https://api.github.com/users/arjantop/followers",
      "following_url": "https://api.github.com/users/arjantop/following{/other_user}",
      "gists_url": "https://api.github.com/users/arjantop/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arjantop/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arjantop/subscriptions",
      "organizations_url": "https://api.github.com/users/arjantop/orgs",
      "repos_url": "https://api.github.com/users/arjantop/repos",
      "events_url": "https://api.github.com/users/arjantop/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arjantop/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-25T13:33:00Z",
    "updated_at": "2014-06-25T13:35:39Z",
    "body": "Yes, it was a part of a larger example when I noticed this. Adding black_box around does not change the results.\nI have updated the examples to include `black_box`.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47100816/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47101552",
    "html_url": "https://github.com/rust-lang/rust/issues/15177#issuecomment-47101552",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15177",
    "id": 47101552,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTAxNTUy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-25T13:39:12Z",
    "updated_at": "2014-06-25T13:39:12Z",
    "body": "I'm only able to run `perf` over the most current version, but it appears that essentially the entire time is spent in jemalloc, so this is perhaps just a benchmark that jemalloc does not perform well on?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47101552/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47102220",
    "html_url": "https://github.com/rust-lang/rust/issues/15177#issuecomment-47102220",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15177",
    "id": 47102220,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTAyMjIw",
    "user": {
      "login": "arjantop",
      "id": 52403,
      "node_id": "MDQ6VXNlcjUyNDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/52403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arjantop",
      "html_url": "https://github.com/arjantop",
      "followers_url": "https://api.github.com/users/arjantop/followers",
      "following_url": "https://api.github.com/users/arjantop/following{/other_user}",
      "gists_url": "https://api.github.com/users/arjantop/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arjantop/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arjantop/subscriptions",
      "organizations_url": "https://api.github.com/users/arjantop/orgs",
      "repos_url": "https://api.github.com/users/arjantop/repos",
      "events_url": "https://api.github.com/users/arjantop/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arjantop/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-25T13:44:58Z",
    "updated_at": "2014-06-25T13:44:58Z",
    "body": "I have code doing `read_byte` one by one, doing comparisons, and putting it in `Vec` that is 5x faster than plain `read_to_end`\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47102220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55690551",
    "html_url": "https://github.com/rust-lang/rust/issues/15177#issuecomment-55690551",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15177",
    "id": 55690551,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NjkwNTUx",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-16T03:27:41Z",
    "updated_at": "2014-09-16T03:28:08Z",
    "body": "Exporting `JE_MALLOC_CONF=lg_dirty_mult:-1` results in a drastic performance increase by making it not care about reducing RES usage. In practice, glibc was never reducing the peak RES because it uses `sbrk` for everything that's not an enormous memory allocation. It's a memory vs. performance trade-off and I don't think we can do much about it other than bikeshedding the default `lg_dirty_mult` setting.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55690551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55789954",
    "html_url": "https://github.com/rust-lang/rust/issues/15177#issuecomment-55789954",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15177",
    "id": 55789954,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1Nzg5OTU0",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-16T18:26:43Z",
    "updated_at": "2014-09-16T18:26:43Z",
    "body": "@thestinger I'm not satisfied with that answer. A 30x performance regression in a common utility function as not something to sweep under the rug.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55789954/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55796533",
    "html_url": "https://github.com/rust-lang/rust/issues/15177#issuecomment-55796533",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15177",
    "id": 55796533,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1Nzk2NTMz",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-16T19:06:29Z",
    "updated_at": "2014-09-16T19:10:15Z",
    "body": "@brson: It's not a 30x performance regression in a common utility function. It's a micro-benchmark of the utility function where dirty page purging performs poorly.\n\n```\n % ./foo --bench\n\nrunning 1 test\ntest read_to_end ... bench:      4463 ns/iter (+/- 94)\n```\n\n```\n% JE_MALLOC_CONF=lg_dirty_mult:-1 ./foo --bench       \n\nrunning 1 test\ntest read_to_end ... bench:       307 ns/iter (+/- 6)\n```\n\n```\n% JE_MALLOC_CONF=lg_dirty_mult:2 ./foo --bench\n\nrunning 1 test\ntest read_to_end ... bench:       267 ns/iter (+/- 23)\n```\n\n```\n% JE_MALLOC_CONF=lg_dirty_mult:3 ./foo --bench      \n\nrunning 1 test\ntest read_to_end ... bench:      4451 ns/iter (+/- 109)\n```\n\nIt's a clear cut memory vs. performance trade-off. Either it consumes more memory or it wastes time purging the dirty pages. Disabling it by default would fix the regression on some microbenchmarks, but memory usage would regress back to where it was before jemalloc was used.\n\nAllocators need to make many performance compromises, and this happens to be one with a user-facing knob. It could be exposed from the heap module with `je_mallctl`. I don't really see the point of fretting over the performance trade-off when it's configurable at runtime. It's not really an actionable bug unless micro-benchmarks are going to be prioritized over memory usage.\n\njemalloc used to have a special case _specifically_ to make microbenchmarks perform better with dirty page purging enabled, but the special case [was removed](https://github.com/jemalloc/jemalloc/commit/e3d13060c8a04f08764b16b003169eb205fa09eb) because it was quite arbitrary. I think it's better for a microbenchmark to be an honest reflection of the performance on real workloads.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55796533/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55796931",
    "html_url": "https://github.com/rust-lang/rust/issues/15177#issuecomment-55796931",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15177",
    "id": 55796931,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1Nzk2OTMx",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-16T19:09:12Z",
    "updated_at": "2014-09-16T19:09:12Z",
    "body": "Perhaps it does make sense to disable purging by default to improve performance in trivial applications and have large applications like the Rust compiler and Servo to explicitly turn on purging. It's not the choice jemalloc makes upstream though.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55796931/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55972779",
    "html_url": "https://github.com/rust-lang/rust/issues/15177#issuecomment-55972779",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15177",
    "id": 55972779,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1OTcyNzc5",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-17T22:47:50Z",
    "updated_at": "2014-09-17T22:47:50Z",
    "body": "A demonstration of how the dirty page purging ratio plays into this:\n\n``` rust\nextern crate test;\n\nuse test::{Bencher, black_box};\nuse std::io::BufReader;\n\n#[bench]\nfn read_to_end(b: &mut Bencher) {\n    let bytes = Vec::from_elem(100, 10u8);\n    b.iter(|| {\n        let mut reader = BufReader::new(bytes.as_slice());\n        black_box(reader.read_to_end())\n    })\n}\n```\n\n```\ntest read_to_end ... bench:      4458 ns/iter (+/- 918)\n```\n\n``` rust\nextern crate test;\n\nuse test::{Bencher, black_box};\nuse std::io::BufReader;\n\n#[bench]\nfn read_to_end(b: &mut Bencher) {\n    let _huge= Vec::<u64>::with_capacity(100000);\n    let bytes = Vec::from_elem(100, 10u8);\n    b.iter(|| {\n        let mut reader = BufReader::new(bytes.as_slice());\n        black_box(reader.read_to_end())\n    })\n}\n```\n\n```\ntest read_to_end ... bench:       280 ns/iter (+/- 3)\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/55972779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60133015",
    "html_url": "https://github.com/rust-lang/rust/issues/15177#issuecomment-60133015",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15177",
    "id": 60133015,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTMzMDE1",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-22T18:36:03Z",
    "updated_at": "2014-10-22T18:36:03Z",
    "body": "Closing in favour of #18236 which is an actionable issue. There is no performance bug here, but there is a tunable performance vs. memory trade-off and we should consider a different default.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60133015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
