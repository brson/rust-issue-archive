[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96893493",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-96893493",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 96893493,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk2ODkzNDkz",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T03:02:04Z",
    "updated_at": "2015-04-28T03:02:04Z",
    "body": "I think you're right.\n\nI'm tempted to say this could be fixed by switching from a strong/weak pair to a num_ptrs/num_weak pair, where every pointer (whether strong or weak) is counted in num_ptrs and then weak pointers are also counted in num_weak. This does lower the number of total pointers (strong + weak) that we can have outstanding, but it's not as restrictive as actually dividing a `usize` into two halves.\n\nAnother alternative might be to use the high bit of the strong pointer as a \"there are weak references\" marker. I'm not sure how well that would actually work.\n\nAnd of course we could always just use a spinlock instead.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96893493/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96895196",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-96895196",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 96895196,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk2ODk1MTk2",
    "user": {
      "login": "sfackler",
      "id": 1455697,
      "node_id": "MDQ6VXNlcjE0NTU2OTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sfackler",
      "html_url": "https://github.com/sfackler",
      "followers_url": "https://api.github.com/users/sfackler/followers",
      "following_url": "https://api.github.com/users/sfackler/following{/other_user}",
      "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions",
      "organizations_url": "https://api.github.com/users/sfackler/orgs",
      "repos_url": "https://api.github.com/users/sfackler/repos",
      "events_url": "https://api.github.com/users/sfackler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sfackler/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T03:19:51Z",
    "updated_at": "2015-04-28T03:19:51Z",
    "body": "Using num_ptrs + num_weak shouldn't actually lower the total number of pointers since each `Arc` or `Weak` is larger than 1 byte so you'd exhaust the address space before overflowing num_ptrs.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96895196/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96895844",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-96895844",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 96895844,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk2ODk1ODQ0",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T03:27:15Z",
    "updated_at": "2015-04-28T03:27:15Z",
    "body": "Upon reflection I suspect that num_ptrs + num_weak fails for the same reason that get_mut fails, because the destructor of `Arc` needs to know how many strong references there are, and the only way to get num_strong is with two loads.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96895844/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96895940",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-96895940",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 96895940,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk2ODk1OTQw",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T03:28:28Z",
    "updated_at": "2015-04-28T03:28:28Z",
    "body": "Although it's possible that using num_ptrs + num_strong instead might possibly work.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96895940/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96897657",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-96897657",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 96897657,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk2ODk3NjU3",
    "user": {
      "login": "talchas",
      "id": 3578697,
      "node_id": "MDQ6VXNlcjM1Nzg2OTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3578697?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/talchas",
      "html_url": "https://github.com/talchas",
      "followers_url": "https://api.github.com/users/talchas/followers",
      "following_url": "https://api.github.com/users/talchas/following{/other_user}",
      "gists_url": "https://api.github.com/users/talchas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/talchas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/talchas/subscriptions",
      "organizations_url": "https://api.github.com/users/talchas/orgs",
      "repos_url": "https://api.github.com/users/talchas/repos",
      "events_url": "https://api.github.com/users/talchas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/talchas/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T03:34:08Z",
    "updated_at": "2015-04-28T03:34:08Z",
    "body": "If that works (which sounds plausible) it has the disadvantage of requiring two atomics on clone() (though they're probably the same cacheline, so it's not as horrible as it might be).\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96897657/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96926734",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-96926734",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 96926734,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk2OTI2NzM0",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T06:05:06Z",
    "updated_at": "2015-04-28T06:05:06Z",
    "body": "I still haven't thought it entirely all the way through, but I think that num_ptrs + num_strong will work (as long as num_strong is always modified before num_ptrs). As you say, this will require two atomics on clone().\n\nThe other alternative that I think would work is using the low bit of the `strong` counter as a \"has weak\" flag that, when set, is never un-set. Once it's set, a spinlock is then used around all relevant accesses to the `strong` and `weak` counters. This is more complicated than num_ptrs + num_strong, but has the benefit of meaning that `Arc`s that don't use `Weak` won't have to pay any cost (and in fact they'll be slightly cheaper than today, because no atomic load of `weak` is necessary if the flag is `0`).\n\nIncidentally, it appears we do not have a spinlock construct in our stdlib. That's rather unfortunate, as ad-hoc simple spinlocks are not generally ideal. Preferably we'd have a construct that spins some number of times (it looks like pthread on OS X defines that number as `1000`) on multi-processor machines before yielding the thread, and yields immediately on single-processor machines.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/96926734/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97001452",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97001452",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97001452,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MDAxNDUy",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T10:11:19Z",
    "updated_at": "2015-04-28T10:19:41Z",
    "body": "Split the Arc struct in two: Give Arc another marker type parameter that decides statically if the type should support weak pointers or not. Use default type parameters to make  `Arc<T>` equivalent `Arc<T, NoWeak>`\n\nOnly the NoWeak Arc will permit `get_mut` and `make_unique`. Since the Arc source references boost a lot, I tried to find any indication of how this is solved in the boost sphere, and I can't find any solution when weak pointers are involved.\n\nDefault type parameters make this seamless for users that don't need weak pointers.\n\nNote: boost shared_ptr has a member function `bool unique()` but it only considers stong references.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97001452/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97128483",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97128483",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97128483,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MTI4NDgz",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T16:34:01Z",
    "updated_at": "2015-04-28T16:34:01Z",
    "body": "@bluss That seems like a very heavy-handed approach. The creator of the `Arc` instance may not know ahead of time whether any code is going to want to create a `Weak` instance. And at such time as that decision is made, all code that touches the `Arc` would have to be updated even though that code doesn't really care whether there's a `Weak` reference.\n\nAs for Boost, I glanced at it yesterday and it didn't appear to me that it supported weak pointers.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97128483/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97164718",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97164718",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97164718,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MTY0NzE4",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T18:35:21Z",
    "updated_at": "2015-04-28T18:35:47Z",
    "body": "It is heavy-handed, but it is also flexible, and allows users to only pay for what they use. Didn't we already want to make Weak pointers optional? (What other reason are they unstable for?)\n\nSee boost [Smart Pointers doc, it has weak_ptr](http://www.boost.org/doc/libs/1_58_0/libs/smart_ptr/smart_ptr.htm)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97164718/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97171933",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97171933",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97171933,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MTcxOTMz",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T19:05:40Z",
    "updated_at": "2015-04-28T19:05:40Z",
    "body": "@bluss I'm not really sure why they're unstable, the message just says \"Weak pointers may not belong in this module\".\n\nAnd you're right, Boost does have `weak_ptr`, the link I followed before (from the comments of `Arc`) didn't show it. Looking through Boost's `weak_ptr` and `shared_ptr` it appears that `shared_ptr::unique()` ignores weak pointers entirely and returns `true` even if there are existing weak pointers (it appears that `shared_ptr` works the same way our `Arc` does, with a `shared` counter (i.e. our `strong`) and a `weak` counter (that includes an extra `+1` count as long as `shared` is non-zero).\n\nSo the difference here is our `Arc`'s unique-testing needs to care about weak pointers (in order to meet the memory safety guarantees of Rust) but Boost doesn't enforce that.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97171933/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97190018",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97190018",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97190018,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MTkwMDE4",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T20:02:55Z",
    "updated_at": "2015-04-28T20:02:55Z",
    "body": "I think what we should do today is remove `Arc::make_unique` and `alloc::arc::get_mut`. They're both marked as `#[unstable]` so this is acceptable. Without those two functions, our existing reference-counting implementation works fine. Then we can explore ways to re-add that functionality in the future. It appears that there are zero clients of `Arc::make_unique` in rust-lang/rust, although checking for `get_mut` is not so trivial as that name is not unique.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97190018/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97191504",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97191504",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97191504,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MTkxNTA0",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T20:05:11Z",
    "updated_at": "2015-04-28T20:05:11Z",
    "body": "@alexcrichton You added `Arc::make_unique` in the first place, and @aturon you updated it to check weak refs. Any thoughts?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97191504/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97200760",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97200760",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97200760,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MjAwNzYw",
    "user": {
      "login": "kvark",
      "id": 107301,
      "node_id": "MDQ6VXNlcjEwNzMwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/107301?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kvark",
      "html_url": "https://github.com/kvark",
      "followers_url": "https://api.github.com/users/kvark/followers",
      "following_url": "https://api.github.com/users/kvark/following{/other_user}",
      "gists_url": "https://api.github.com/users/kvark/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kvark/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kvark/subscriptions",
      "organizations_url": "https://api.github.com/users/kvark/orgs",
      "repos_url": "https://api.github.com/users/kvark/repos",
      "events_url": "https://api.github.com/users/kvark/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kvark/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T20:39:20Z",
    "updated_at": "2015-04-28T20:39:20Z",
    "body": "@kballard I added `arc::get_mut()` in order to use it for parallel ECS [proof of concept](http://www.reddit.com/r/rust_gamedev/comments/31xh9o/proof_of_concept_parallel_ecs_processing_based_on/). I don't know if any real projects use it at the moment, so it should be safe to kill, but I'm going to miss it anyways.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97200760/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97209638",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97209638",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97209638,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MjA5NjM4",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T21:16:42Z",
    "updated_at": "2015-04-28T21:16:42Z",
    "body": "@kvark I would really like to have `Arc::get_mut()`, I think it's potentially useful, but as long as there's no clients in rust-lang/rust that depend on it right now, I think we should just kill it for 1.0 and investigate ways to _safely_ re-add it in the future.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97209638/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97215850",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97215850",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97215850,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MjE1ODUw",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T21:30:27Z",
    "updated_at": "2015-04-28T21:31:40Z",
    "body": "Since weak_count and strong_count are public, `get_mut` can be implemented as it is today, outside of the crate too. At least I think you can, you would be effectively converting `&T` to `&mut T`, but isn't that legal if you go through raw pointers? Of course you'll only use this unsafe-marked get_mut if you know no Weak pointers are used in your application.\n\nRemoving unsound unstable API sounds fine.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97215850/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97236379",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97236379",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97236379,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MjM2Mzc5",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T21:51:54Z",
    "updated_at": "2015-04-28T21:51:54Z",
    "body": "@bluss True, you could reimplement the current logic of `get_mut`, but since that logic is _broken_ I don't think it's something we should be telling people to do.\n\n> At least I think you can, you would be effectively converting `&T` to `&mut T`, but isn't that legal if you go through raw pointers?.\n\nWell no, that doesn't make it legal. If you construct a `&mut T`, you need to guarantee it's not aliased by anything else. This means you need to guarantee that there are no `&T` references to the same value (and that you can't construct one). That said, I'm not 100% positive about the actual hard requirements here; I _think_ it's just the aliasing requirement, which means if you can guarantee that there are no (accessible) `&T` references extant, then your constructed `&mut T` is valid.\n\nBased on that, I _believe_ that it would be legal to construct this third-party `fn arc_get_mut<T>(ptr: &mut Arc<T>) -> Option<&mut T>` even though the implementation would have to `transmute` a `&T` into a `&mut T`. The implementation of the function can ensure that it doesn't construct any other `&T` reference after creating the `&mut T` (or more generally, that it doesn't touch the `ptr` again), and the API of the function means that the resulting `&mut T` borrows the `Arc`.\n\n---\n\nAll that said, given that the current scheme of separate atomic `strong` and `weak` counts does not allow you to do this unique-test safely, none of this really matters. `get_mut()` can't be implemented safely without changing the implementation details of `Arc`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97236379/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97239374",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97239374",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97239374,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3MjM5Mzc0",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-28T22:03:05Z",
    "updated_at": "2015-04-28T22:03:05Z",
    "body": "cc https://github.com/rust-lang/rust/issues/24564\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97239374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97401576",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-97401576",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 97401576,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3NDAxNTc2",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-29T12:02:29Z",
    "updated_at": "2015-04-29T12:02:29Z",
    "body": "> since that logic is broken I don't think it's something we should be telling people to do.\n\nIt's a systems language, we don't tell them what to do. We tell them what's possible and where the boundaries lie. We give them unsafe blocks for when they feel they can take over the reins themselves.\n\n> Well no, that doesn't make it legal. If you construct a &mut T, you need to guarantee it's not aliased by anything else. \n\nObviously. I didn't say it was a sufficient criterium. Anyway, let's not do this kind of thing where we out-nitpick each other.. All I suggested was if wouldn't it be possible to implement outside of crate.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/97401576/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/100692023",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-100692023",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 100692023,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMDY5MjAyMw==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-10T20:13:07Z",
    "updated_at": "2015-05-10T20:13:15Z",
    "body": "The racy functions still exist. We should document that or remove them.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/100692023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/115906915",
    "html_url": "https://github.com/rust-lang/rust/issues/24880#issuecomment-115906915",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/24880",
    "id": 115906915,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNTkwNjkxNQ==",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-26T22:15:10Z",
    "updated_at": "2015-06-26T22:15:10Z",
    "body": "For reference, these functions, together with weak pointers, are used heavily in Servo. I've made a PR to fix this problem more directly: https://github.com/rust-lang/rust/pull/26610\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/115906915/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
