[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/146775371",
    "html_url": "https://github.com/rust-lang/rust/issues/28925#issuecomment-146775371",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28925",
    "id": 146775371,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0Njc3NTM3MQ==",
    "user": {
      "login": "mzabaluev",
      "id": 1198919,
      "node_id": "MDQ6VXNlcjExOTg5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1198919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mzabaluev",
      "html_url": "https://github.com/mzabaluev",
      "followers_url": "https://api.github.com/users/mzabaluev/followers",
      "following_url": "https://api.github.com/users/mzabaluev/following{/other_user}",
      "gists_url": "https://api.github.com/users/mzabaluev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mzabaluev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mzabaluev/subscriptions",
      "organizations_url": "https://api.github.com/users/mzabaluev/orgs",
      "repos_url": "https://api.github.com/users/mzabaluev/repos",
      "events_url": "https://api.github.com/users/mzabaluev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mzabaluev/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-09T07:17:05Z",
    "updated_at": "2015-10-09T07:17:05Z",
    "body": "Credit goes out to @retep998 for discovering this.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/146775371/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/150100635",
    "html_url": "https://github.com/rust-lang/rust/issues/28925#issuecomment-150100635",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28925",
    "id": 150100635,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MDEwMDYzNQ==",
    "user": {
      "login": "briansmith",
      "id": 16816,
      "node_id": "MDQ6VXNlcjE2ODE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/16816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/briansmith",
      "html_url": "https://github.com/briansmith",
      "followers_url": "https://api.github.com/users/briansmith/followers",
      "following_url": "https://api.github.com/users/briansmith/following{/other_user}",
      "gists_url": "https://api.github.com/users/briansmith/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/briansmith/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/briansmith/subscriptions",
      "organizations_url": "https://api.github.com/users/briansmith/orgs",
      "repos_url": "https://api.github.com/users/briansmith/repos",
      "events_url": "https://api.github.com/users/briansmith/events{/privacy}",
      "received_events_url": "https://api.github.com/users/briansmith/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-22T04:08:38Z",
    "updated_at": "2015-10-22T04:08:38Z",
    "body": "See also [`-fshort-enums`](http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0774b/chr1411640303038.html). Some ARM ABIs require `-fshort-enums` and oithers require `-fno-short-enums`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/150100635/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/150337362",
    "html_url": "https://github.com/rust-lang/rust/issues/28925#issuecomment-150337362",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28925",
    "id": 150337362,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MDMzNzM2Mg==",
    "user": {
      "login": "mzabaluev",
      "id": 1198919,
      "node_id": "MDQ6VXNlcjExOTg5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1198919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mzabaluev",
      "html_url": "https://github.com/mzabaluev",
      "followers_url": "https://api.github.com/users/mzabaluev/followers",
      "following_url": "https://api.github.com/users/mzabaluev/following{/other_user}",
      "gists_url": "https://api.github.com/users/mzabaluev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mzabaluev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mzabaluev/subscriptions",
      "organizations_url": "https://api.github.com/users/mzabaluev/orgs",
      "repos_url": "https://api.github.com/users/mzabaluev/repos",
      "events_url": "https://api.github.com/users/mzabaluev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mzabaluev/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-22T19:52:21Z",
    "updated_at": "2015-10-22T19:52:21Z",
    "body": "@briansmith: I think `-fshort-enums` needs to be represented by `#[repr(u16)]` and the like. The concern here is about not doing what the C compiler does by default.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/150337362/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/222276394",
    "html_url": "https://github.com/rust-lang/rust/issues/28925#issuecomment-222276394",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28925",
    "id": 222276394,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyMjI3NjM5NA==",
    "user": {
      "login": "briansmith",
      "id": 16816,
      "node_id": "MDQ6VXNlcjE2ODE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/16816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/briansmith",
      "html_url": "https://github.com/briansmith",
      "followers_url": "https://api.github.com/users/briansmith/followers",
      "following_url": "https://api.github.com/users/briansmith/following{/other_user}",
      "gists_url": "https://api.github.com/users/briansmith/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/briansmith/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/briansmith/subscriptions",
      "organizations_url": "https://api.github.com/users/briansmith/orgs",
      "repos_url": "https://api.github.com/users/briansmith/repos",
      "events_url": "https://api.github.com/users/briansmith/events{/privacy}",
      "received_events_url": "https://api.github.com/users/briansmith/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-05-27T23:51:53Z",
    "updated_at": "2016-05-27T23:51:53Z",
    "body": "> @briansmith: I think -fshort-enums needs to be represented by #[repr(u16)] and the like. The concern here is about not doing what the C compiler does by default.\n\nI think what the C compiler does by default is sometimes determined by the ABI. For example, I believe sometimes GCC's default for that flag differs depending on how GCC was configured when it was built. \n\nIMO, instead of matching the default of \"the\" C compiler (in fact, there is often more than one C compiler, each of which may have a different default), Rust should default to matching the ABI.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/222276394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/270993794",
    "html_url": "https://github.com/rust-lang/rust/issues/28925#issuecomment-270993794",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28925",
    "id": 270993794,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDk5Mzc5NA==",
    "user": {
      "login": "zackw",
      "id": 325899,
      "node_id": "MDQ6VXNlcjMyNTg5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/325899?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zackw",
      "html_url": "https://github.com/zackw",
      "followers_url": "https://api.github.com/users/zackw/followers",
      "following_url": "https://api.github.com/users/zackw/following{/other_user}",
      "gists_url": "https://api.github.com/users/zackw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zackw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zackw/subscriptions",
      "organizations_url": "https://api.github.com/users/zackw/orgs",
      "repos_url": "https://api.github.com/users/zackw/repos",
      "events_url": "https://api.github.com/users/zackw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zackw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-01-06T20:08:57Z",
    "updated_at": "2017-01-06T20:08:57Z",
    "body": "I tripped over this while trying to add `waitid` to libc.  This function is specified by POSIX to take one argument of type `idtype_t`, and `idtype_t` is specified to be a C enum.  (As far as I know, this is the only such case within POSIX.)  At present, because of this (and arguably also #34641) there is _no way_ to be sure that a Rust shim for a C function that takes or returns a C enum type is ABI-correct.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/270993794/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/346544600",
    "html_url": "https://github.com/rust-lang/rust/issues/28925#issuecomment-346544600",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28925",
    "id": 346544600,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjU0NDYwMA==",
    "user": {
      "login": "jld",
      "id": 254973,
      "node_id": "MDQ6VXNlcjI1NDk3Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/254973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jld",
      "html_url": "https://github.com/jld",
      "followers_url": "https://api.github.com/users/jld/followers",
      "following_url": "https://api.github.com/users/jld/following{/other_user}",
      "gists_url": "https://api.github.com/users/jld/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jld/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jld/subscriptions",
      "organizations_url": "https://api.github.com/users/jld/orgs",
      "repos_url": "https://api.github.com/users/jld/repos",
      "events_url": "https://api.github.com/users/jld/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jld/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-11-23T07:14:25Z",
    "updated_at": "2017-11-23T07:14:25Z",
    "body": "> Rust first coerces all discriminants to `isize`\r\n\r\nThis by itself is arguably a bug, even on boring platforms like x86 Linux.  Simple constructive proof:\r\n```C\r\n#include <stdio.h>\r\n\r\nenum E {\r\n  L = 0,\r\n  H = 0x100000000\r\n};\r\n\r\nint main() {\r\n\tprintf(\"%zu > %zu\\n\", sizeof(enum E), sizeof(void*));\r\n\treturn 0;\r\n}\r\n```\r\n\r\n```\r\n$ cc -m32 -Wall -W -O1 big-enum.c && ./a.out\r\n8 > 4\r\n```\r\n\r\nThat isn't portable ISO C, but GCC and Clang accept it without warnings unless `-pedantic` is used, and the second example in #34641 is basically the same thing but with fewer bits.\r\n\r\nThe original discriminant sizing (and `#[repr(C)]`) would coerce values to both `u64` and `i64` to try out the various int types, because constant evaluation was\u2026 different back then, and \u201cwhat type do `#[repr(C)]` initializers have?\u201d wasn't really a well-formed question.  But it is now.\r\n\r\n---\r\n\r\nSo, trying to summarize the problems here:\r\n1. `#[repr(C)]` on Windows considers 64-bit types [and should not](https://internals.rust-lang.org/t/c-style-enums-in-ffi-and-a-proposal-to-lump-in-with-unions/2744/2); this looks relatively easy to fix.\r\n2. C numerics don't match Rust (`-0x80000000` vs. `-2147483648`); this is hard.  I don't know if there's any solution besides requiring users to constant-fold according to C rules before using the values in Rust, or maybe writing a (procedural?) macro to do that.  Is there some way to at least lint for this?\r\n3. `isize` may be too small for some C enums; this can be worked around by manually applying a fixed-size `repr`, assuming there aren't any cases that are larger than some target's `isize` but small enough for ABI differences to differ.\r\n4. Somewhere along the line the target architecture changed from an `enum` to a string, so the `i32` lower bound became the default, and it's probably no longer correct for all targets (MSP430?), and then there's `-fshort-enums`.  Fixing this is probably tedious but not conceptually difficult.\r\n\r\nAs for `idtype_t`, it's probably not using huge values, so the main problem there would be #\u202f4.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/346544600/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
