[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241063543",
    "html_url": "https://github.com/rust-lang/rust/issues/16935#issuecomment-241063543",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16935",
    "id": 241063543,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTA2MzU0Mw==",
    "user": {
      "login": "mrhota",
      "id": 403641,
      "node_id": "MDQ6VXNlcjQwMzY0MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/403641?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrhota",
      "html_url": "https://github.com/mrhota",
      "followers_url": "https://api.github.com/users/mrhota/followers",
      "following_url": "https://api.github.com/users/mrhota/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrhota/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrhota/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrhota/subscriptions",
      "organizations_url": "https://api.github.com/users/mrhota/orgs",
      "repos_url": "https://api.github.com/users/mrhota/repos",
      "events_url": "https://api.github.com/users/mrhota/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrhota/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-08-19T16:18:49Z",
    "updated_at": "2016-08-19T16:18:49Z",
    "body": "@huonw This is an old issue, and I updated the test case a bit, but it still seems to happen:\n\n``` rust\n// synext.rs\n#![feature(plugin_registrar, quote, rustc_private)]\n#![crate_name = \"synext\"]\n#![crate_type = \"dylib\"]\n\nextern crate syntax;\nextern crate rustc_plugin;\nuse rustc_plugin::Registry;\n\nuse syntax::ext::base::{MacResult, MacEager};\nuse syntax::tokenstream;\nuse syntax::codemap::Span;\nuse syntax::ext::base::ExtCtxt;\n\n#[plugin_registrar]\npub fn registrar(reg: &mut Registry) {\n    reg.register_macro(\"test\", expand);\n}\n\nfn expand(cx: &mut ExtCtxt, _sp: Span,\n          _tts: &[tokenstream::TokenTree]) -> Box<MacResult + 'static> {\n    MacEager::expr(quote_expr!(cx,\n                               std::io::stdout().write(\"one\");\n                               std::io::stdout().write(\"two\");\n    ))\n}\n```\n\n``` rust\n// test-synext.rs\n#![feature(plugin)]\n#![plugin(synext)]\n\nfn main() {\n    test!()\n}\n```\n\nCompiling with `rustup run nightly rustc synext.rs && rustup run nightly rustc -L . test-synext.rs -Z unstable-options --pretty expanded` gives:\n\n``` rust\n#![feature(prelude_import)]\n#![no_std]\n#![feature(plugin)]\n#![plugin(synext)]\n#[prelude_import]\nuse std::prelude::v1::*;\n#[macro_use]\nextern crate std as std;\n\nfn main() { std::io::stdout().write(\"one\") }\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241063543/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241064194",
    "html_url": "https://github.com/rust-lang/rust/issues/16935#issuecomment-241064194",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16935",
    "id": 241064194,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTA2NDE5NA==",
    "user": {
      "login": "mrhota",
      "id": 403641,
      "node_id": "MDQ6VXNlcjQwMzY0MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/403641?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrhota",
      "html_url": "https://github.com/mrhota",
      "followers_url": "https://api.github.com/users/mrhota/followers",
      "following_url": "https://api.github.com/users/mrhota/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrhota/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrhota/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrhota/subscriptions",
      "organizations_url": "https://api.github.com/users/mrhota/orgs",
      "repos_url": "https://api.github.com/users/mrhota/repos",
      "events_url": "https://api.github.com/users/mrhota/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrhota/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-08-19T16:21:25Z",
    "updated_at": "2016-08-19T16:21:25Z",
    "body": "Also, I get an ICE if I pass `b\"one\"` and/or `b\"two\"` to the `write(...)` calls in `synext.rs`\n\n```\nerror: internal compiler error: unexpected panic\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\n\nnote: run with `RUST_BACKTRACE=1` for a backtrace\n\nthread 'rustc' panicked at 'unhandled token in quote!', ../src/libsyntax/ext/quote.rs:707\nstack backtrace:\n   1:        0x111037e79 - std::sys::backtrace::tracing::imp::write::h482d45d91246faa2\n   2:        0x111046b70 - std::panicking::default_hook::_{{closure}}::h89158f66286b674e\n   3:        0x111044e9f - std::panicking::default_hook::h9e30d428ee3b0c43\n   4:        0x1110455a6 - std::panicking::rust_panic_with_hook::h2224f33fb7bf2f4c\n   5:        0x1107fd4d4 - std::panicking::begin_panic::h6da27a7ee15843ce\n   6:        0x1109e95f3 - syntax::ext::quote::expr_mk_token::h7c3422b80bef3bd5\n   7:        0x1109ebdb0 - syntax::ext::quote::statements_mk_tt::he0f33941b94e20bb\n   8:        0x1108203af - _<core..iter..FlatMap<I, U, F> as core..iter..iterator..Iterator>::next::hb7943eed4d804bfc\n   9:        0x11081918f - _<core..iter..Chain<A, B> as core..iter..iterator..Iterator>::next::hf66dec9ac7ebfd3e\n  10:        0x11081e49a - _<collections..vec..Vec<T> as core..iter..traits..FromIterator<T>>::from_iter::hb6ba9a4116122593\n  11:        0x1109ea625 - syntax::ext::quote::statements_mk_tt::he0f33941b94e20bb\n  12:        0x1109ed8e2 - syntax::ext::quote::statements_mk_tts::hc942124e7cb85dbc\n  13:        0x1109eda54 - syntax::ext::quote::expand_tts::h25510a66e2e03c00\n  14:        0x1109eefa4 - syntax::ext::quote::expand_parse_call::h362dceaee0d8b0c6\n  15:        0x1109e4c6a - syntax::ext::quote::expand_quote_expr::h7f4c2771cabcf421\n  16:        0x1109b07d5 - _<F as syntax..ext..base..TTMacroExpander>::expand::h2cbfb95c85d07886\n  17:        0x1109cb75b - syntax::ext::expand::expand_mac_invoc::mac_result::ha3a8dfd05d9eecb6\n  18:        0x11096d850 - _<syntax..ptr..P<T>>::and_then::h53ce1d732b16c30f\n  19:        0x11088da64 - syntax::fold::Folder::fold_exprs::haec82b8e9fe75416\n  20:        0x1108f0234 - syntax::fold::noop_fold_expr::hab84161d928c2074\n  21:        0x1109c6d85 - syntax::ext::expand::expand_expr::hd4de34daa0a5a90a\n  22:        0x11096d963 - _<syntax..ptr..P<T>>::and_then::h53ce1d732b16c30f\n  23:        0x1109cd0de - syntax::ext::expand::expand_stmt::hf1246bdbc447b35b\n  24:        0x11083d0c2 - _<collections..vec..Vec<T> as syntax..util..move_map..MoveMap<T>>::move_flat_map::h95ab7180e0970e65\n  25:        0x1109dc77f - _<syntax..ext..expand..MacroExpander<'a, 'b> as syntax..fold..Folder>::fold_block::h84ca09e1246a6f7f\n  26:        0x1108b2c3f - syntax::fold::noop_fold_item_kind::he96b2686f10d5f9d\n  27:        0x1108bee78 - syntax::fold::noop_fold_item_simple::hb58741bcf641e653\n  28:        0x1109d0d40 - syntax::ext::expand::expand_annotatable::hd731ac0c7a5098e1\n  29:        0x1109cc7cf - syntax::ext::expand::expand_item::h34a68666bcb77b42\n  30:        0x1109dc20a - _<syntax..ext..expand..MacroExpander<'a, 'b> as syntax..fold..Folder>::fold_item::h11dc20d6fdb44d60\n  31:        0x1108bd942 - syntax::fold::noop_fold_mod::h7ccd83e899e81c3c\n  32:        0x1108b26b2 - syntax::fold::noop_fold_item_kind::he96b2686f10d5f9d\n  33:        0x1108bee78 - syntax::fold::noop_fold_item_simple::hb58741bcf641e653\n  34:        0x1109d102b - syntax::ext::expand::expand_annotatable::hd731ac0c7a5098e1\n  35:        0x1109cc7cf - syntax::ext::expand::expand_item::h34a68666bcb77b42\n  36:        0x1109dc342 - _<syntax..ext..expand..MacroExpander<'a, 'b> as syntax..fold..Folder>::fold_item::h11dc20d6fdb44d60\n  37:        0x1109db30e - _<syntax..ext..expand..MacroExpander<'a, 'b> as syntax..fold..Folder>::fold_crate::hb0a12b0d8df69afd\n  38:        0x1109dda1e - syntax::ext::expand::expand_crate_with_expander::h77575f1d1b34ae40\n  39:        0x1109dd4ba - syntax::ext::expand::expand_crate::h72ec18c6565094c4\n  40:        0x10c3d668b - rustc_driver::driver::phase_2_configure_and_expand::_{{closure}}::hae7f286174f41285\n  41:        0x10c389133 - rustc_driver::driver::phase_2_configure_and_expand::h7a450d24678fc450\n  42:        0x10c38089c - rustc_driver::driver::compile_input::hd9ecc57abd3cba85\n  43:        0x10c3b2579 - rustc_driver::run_compiler::h184264500271cc39\n  44:        0x10c2fdc94 - std::panicking::try::do_call::h17a7a17ad7240c5c\n  45:        0x11104d8aa - __rust_maybe_catch_panic\n  46:        0x10c317d57 - _<F as alloc..boxed..FnBox<A>>::call_box::h93f9128277b2964a\n  47:        0x111043c65 - std::sys::thread::Thread::new::thread_start::he0bf102845911132\n  48:     0x7fff89ecf99c - _pthread_body\n  49:     0x7fff89ecf919 - _pthread_start\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241064194/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/317135467",
    "html_url": "https://github.com/rust-lang/rust/issues/16935#issuecomment-317135467",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16935",
    "id": 317135467,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNzEzNTQ2Nw==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-07-21T23:36:58Z",
    "updated_at": "2017-07-21T23:36:58Z",
    "body": "Closing in favor of https://github.com/rust-lang/rust/issues/12266.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/317135467/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
