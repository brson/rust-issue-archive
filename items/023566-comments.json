[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/84159279",
    "html_url": "https://github.com/rust-lang/rust/issues/23566#issuecomment-84159279",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23566",
    "id": 84159279,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTU5Mjc5",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-20T21:42:22Z",
    "updated_at": "2015-03-20T21:42:22Z",
    "body": "I reduced the test case to:\n\n``` rust\n#![crate_type = \"staticlib\"]\npub fn set1(x: &mut u32) { *x = 123 }\npub fn set2(x: &mut u32) { *x = 123 }\n```\n\nThe compiler options are the same (`-C lto -g -O`). The interesting thing is that the bodies of `set1` and `set2` must be identical.  Perhaps there's an LLVM optimization that's merging the two, and that's breaking debug information?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/84159279/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/84170576",
    "html_url": "https://github.com/rust-lang/rust/issues/23566#issuecomment-84170576",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23566",
    "id": 84170576,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTcwNTc2",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-20T22:34:13Z",
    "updated_at": "2015-03-20T22:34:13Z",
    "body": "@rprichard Thanks for the reduced test case!\n\n> The interesting thing is that the bodies of set1 and set2 must be identical.\n\nYeah, I was under the impression that this may be the cause.\n\n> Perhaps there's an LLVM optimization that's merging the two, and that's breaking debug information?\n\nCould be, I'm not familiar with LLVM to confirm this. @dotdash ^^^ do you know if LLVM has an optimization pass that does that?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/84170576/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/86419521",
    "html_url": "https://github.com/rust-lang/rust/issues/23566#issuecomment-86419521",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23566",
    "id": 86419521,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDE5NTIx",
    "user": {
      "login": "michaelwoerister",
      "id": 1825894,
      "node_id": "MDQ6VXNlcjE4MjU4OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelwoerister",
      "html_url": "https://github.com/michaelwoerister",
      "followers_url": "https://api.github.com/users/michaelwoerister/followers",
      "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelwoerister/orgs",
      "repos_url": "https://api.github.com/users/michaelwoerister/repos",
      "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelwoerister/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-26T09:29:13Z",
    "updated_at": "2015-03-26T09:29:13Z",
    "body": "Thanks for the report. This looks sufficiently different from #17677 to warrant it's own issue. I haven't look into it closely but I think the root cause for this error is not the same as for #17677 (where I don't think it is related to two functions having the same body).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/86419521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/90019675",
    "html_url": "https://github.com/rust-lang/rust/issues/23566#issuecomment-90019675",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23566",
    "id": 90019675,
    "node_id": "MDEyOklzc3VlQ29tbWVudDkwMDE5Njc1",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-06T11:19:35Z",
    "updated_at": "2015-04-06T11:19:35Z",
    "body": "> > Perhaps there's an LLVM optimization that's merging the two, and that's breaking debug information?\n> \n> Could be, I'm not familiar with LLVM to confirm this. @dotdash ^^^ do you know if LLVM has an optimization pass that does that?\n\nYes, the mergefunc pass does that. The problem here seems to be that mergefunc turns `set2` into a jump to `set1`, but then LTO inlines `set1` into `set2` again, producing bad debug metadata.\n\nAfter optimizations:\n\n``` llvm\ndefine void @_ZN4set120h703cb75c1e01d663eaaE(i32* noalias nocapture dereferenceable(4)) unnamed_addr #0 {\nentry-block:\n  tail call void @llvm.dbg.value(metadata i32* %0, i64 0, metadata !14, metadata !20), !dbg !21\n  store i32 123, i32* %0, align 4, !dbg !22\n  ret void, !dbg !21\n}\n\ndefine void @_ZN4set220h34cbfe792e780cc1paaE(i32* noalias nocapture dereferenceable(4)) unnamed_addr #0 {\n  tail call void @_ZN4set120h703cb75c1e01d663eaaE(i32* %0)\n  ret void\n}\n```\n\nAfter LTO:\n\n``` llvm\ndefine void @_ZN4set120h703cb75c1e01d663eaaE(i32* noalias nocapture dereferenceable(4)) unnamed_addr #0 {\nentry-block:\n  tail call void @llvm.dbg.value(metadata i32* %0, i64 0, metadata !14, metadata !20), !dbg !21\n  store i32 123, i32* %0, align 4, !dbg !22\n  ret void, !dbg !21\n}\n\ndefine void @_ZN4set220h34cbfe792e780cc1paaE(i32* noalias nocapture dereferenceable(4)) unnamed_addr #0 {\n  tail call void @llvm.dbg.value(metadata i32* %0, i64 0, metadata !14, metadata !20), !dbg !21\n  store i32 123, i32* %0, align 4, !dbg !22, !alias.scope !24\n  ret void\n}\n```\n\nRelevant metadata:\n\n``` llvm\n!4 = !{!\"0x2e\\00set1\\00set1\\00_ZN10issue235664set1E\\002\\000\\001\\000\\000\\00256\\001\\002\", !5, !6, !7, null, void (i32*)* @_ZN4set120h703cb75c1e01d663eaaE, !2, null, !13} ; [ DW_TAG_subprogram ] [line 2] [def] [set1]\n!21 = !MDLocation(line: 2, scope: !4)\n```\n\nSo both functions claim to have the scope of `set1`, and that triggers the assertion.\n\nChanging `set2` to:\n\n``` rust\npub fn2(x: &mut u32) { set1(x) }\n```\n\nTriggers the inlining even without mergefunc, and we get:\n\n``` llvm\ndefine void @_Z4set2Pi(i32* nocapture %x) #0 {\n  tail call void @llvm.dbg.value(metadata i32* %x, i64 0, metadata !14, metadata !18), !dbg !26\n  tail call void @llvm.dbg.value(metadata i32* %x, i64 0, metadata !27, metadata !18), !dbg !29\n  store i32 123, i32* %x, align 4, !dbg !30, !tbaa !21\n  ret void, !dbg !31\n}\n```\n\nI suppose the re-declaration of `%x` is just ignored and thus the error doesn't happen.\n\nFor now, I suppose that it would be sensible to disable mergefunc when compiling with debug information.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/90019675/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/118922230",
    "html_url": "https://github.com/rust-lang/rust/issues/23566#issuecomment-118922230",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23566",
    "id": 118922230,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExODkyMjIzMA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-06T16:47:26Z",
    "updated_at": "2015-07-06T16:47:26Z",
    "body": "This no longer causes an assert on nightly, so closing as fixed. Yay!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/118922230/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
