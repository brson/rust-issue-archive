[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/118405027",
    "html_url": "https://github.com/rust-lang/rust/issues/26046#issuecomment-118405027",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26046",
    "id": 118405027,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExODQwNTAyNw==",
    "user": {
      "login": "abonander",
      "id": 3198595,
      "node_id": "MDQ6VXNlcjMxOTg1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3198595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/abonander",
      "html_url": "https://github.com/abonander",
      "followers_url": "https://api.github.com/users/abonander/followers",
      "following_url": "https://api.github.com/users/abonander/following{/other_user}",
      "gists_url": "https://api.github.com/users/abonander/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/abonander/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/abonander/subscriptions",
      "organizations_url": "https://api.github.com/users/abonander/orgs",
      "repos_url": "https://api.github.com/users/abonander/repos",
      "events_url": "https://api.github.com/users/abonander/events{/privacy}",
      "received_events_url": "https://api.github.com/users/abonander/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-03T18:23:20Z",
    "updated_at": "2015-07-03T18:23:20Z",
    "body": "[Here's a user on Reddit who was confused by these error messages](https://www.reddit.com/r/rust/comments/3bz74g/cryptic_error_passing_closure_to_ironnew/).\n\nThis is a real problem.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/118405027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/270228449",
    "html_url": "https://github.com/rust-lang/rust/issues/26046#issuecomment-270228449",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26046",
    "id": 270228449,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDIyODQ0OQ==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-01-03T21:22:40Z",
    "updated_at": "2017-01-03T21:22:40Z",
    "body": "This error message has gotten better:\r\n\r\n```text\r\nerror[E0525]: expected a closure that implements the `Fn` trait, but this closure only implements `FnOnce`\r\n --> <anon>:4:19\r\n  |\r\n4 |     let closure = move || {\r\n  |                   ^\r\n  |\r\nnote: the requirement to implement `Fn` derives from here\r\n --> <anon>:8:5\r\n  |\r\n8 |     Box::new(closure)\r\n  |     ^^^^^^^^^^^^^^^^^\r\n```\r\n\r\nIs it good enough? I'm not sure.",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/270228449/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/270259826",
    "html_url": "https://github.com/rust-lang/rust/issues/26046#issuecomment-270259826",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26046",
    "id": 270259826,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDI1OTgyNg==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-01-03T23:57:12Z",
    "updated_at": "2017-01-03T23:57:12Z",
    "body": "I think it would be nice if the \"derives from here\" message pointed at the type or printed the type of the expression. This is certainly not necessary, though.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/270259826/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305347915",
    "html_url": "https://github.com/rust-lang/rust/issues/26046#issuecomment-305347915",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26046",
    "id": 305347915,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNTM0NzkxNQ==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-31T23:36:14Z",
    "updated_at": "2017-05-31T23:36:14Z",
    "body": "I believe this will be fixed by https://github.com/rust-lang/rust/pull/42196.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305347915/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305352256",
    "html_url": "https://github.com/rust-lang/rust/issues/26046#issuecomment-305352256",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26046",
    "id": 305352256,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNTM1MjI1Ng==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-01T00:07:09Z",
    "updated_at": "2017-06-01T00:07:09Z",
    "body": "Hm, looks like it wasn't -- @nikomatsakis you provided mentoring instructions for https://github.com/rust-lang/rust/issues/42065; I expected that in the case of the code in the description of this issue it'd point at the `vec` in the closure body and state that it is the reason the closure is `FnOnce`. Could you clarify why that isn't the case, and perhaps provide some instructions for how to make it so? The current error is below:\r\n\r\n```\r\nerror[E0525]: expected a closure that implements the `Fn` trait, but this closure only implements `FnOnce`\r\n  --> test.rs:17:19\r\n   |\r\n17 |       let closure = move || {\r\n   |  ___________________^\r\n18 | |         vec\r\n19 | |     };\r\n   | |_____^\r\n   |\r\nnote: the requirement to implement `Fn` derives from here\r\n  --> test.rs:21:5\r\n   |\r\n21 |     Box::new(closure)\r\n   |     ^^^^^^^^^^^^^^^^^\r\n\r\nerror: aborting due to previous error(s)\r\n```",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305352256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305868200",
    "html_url": "https://github.com/rust-lang/rust/issues/26046#issuecomment-305868200",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26046",
    "id": 305868200,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNTg2ODIwMA==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-02T18:05:36Z",
    "updated_at": "2017-06-02T18:05:36Z",
    "body": "Yeah. Perhaps @tommyip would like to extend their previous work to cover this case! The short version is that, in https://github.com/rust-lang/rust/pull/42196, we added the infrastructure to **track** why which variable we need to print, but we only print that information in one particular case (the case where the closure is being called twice). There are more errors where it'd be useful context (like this one).\r\n\r\nThe [relevant code for printing the error is here](https://github.com/rust-lang/rust/blob/c2f7e945526bff3b7d812137d81b235263060ee8/src/librustc_borrowck/borrowck/mod.rs#L596-L607). We would need to add similar calls [to the error-reporting code here](https://github.com/rust-lang/rust/blob/c2f7e945526bff3b7d812137d81b235263060ee8/src/librustc/traits/error_reporting.rs#L640-L655). \r\n\r\nThe tricky bit is that we have to find the right \"tables\" to get the data from. When this code runs, the `self` is an inference context, which will typically have a tables associated with it. I'd probably code this in a *defensive* way. That is, I would `match` on `self.tables` to see if there is a valid tables associated with this inference context, but if not, just don't emit the extra data into the error (the matching code might look [rather like this function](https://github.com/rust-lang/rust/blob/c2f7e945526bff3b7d812137d81b235263060ee8/src/librustc/infer/mod.rs#L104-L112), but without the `panic!`). If there is a tables present, then check to see if the data for this closure is found in there (it may not be, maybe ti's the wrong one). If all of those conditions are met, we can emit the extra info (I expect they always will be in practice).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305868200/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305871191",
    "html_url": "https://github.com/rust-lang/rust/issues/26046#issuecomment-305871191",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26046",
    "id": 305871191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNTg3MTE5MQ==",
    "user": {
      "login": "tommyip",
      "id": 18504232,
      "node_id": "MDQ6VXNlcjE4NTA0MjMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/18504232?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tommyip",
      "html_url": "https://github.com/tommyip",
      "followers_url": "https://api.github.com/users/tommyip/followers",
      "following_url": "https://api.github.com/users/tommyip/following{/other_user}",
      "gists_url": "https://api.github.com/users/tommyip/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tommyip/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tommyip/subscriptions",
      "organizations_url": "https://api.github.com/users/tommyip/orgs",
      "repos_url": "https://api.github.com/users/tommyip/repos",
      "events_url": "https://api.github.com/users/tommyip/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tommyip/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-02T18:17:11Z",
    "updated_at": "2017-06-02T18:17:11Z",
    "body": "I will have a look at this, are there any other places that would benefit from the tracked data? ",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305871191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305968373",
    "html_url": "https://github.com/rust-lang/rust/issues/26046#issuecomment-305968373",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26046",
    "id": 305968373,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNTk2ODM3Mw==",
    "user": {
      "login": "tommyip",
      "id": 18504232,
      "node_id": "MDQ6VXNlcjE4NTA0MjMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/18504232?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tommyip",
      "html_url": "https://github.com/tommyip",
      "followers_url": "https://api.github.com/users/tommyip/followers",
      "following_url": "https://api.github.com/users/tommyip/following{/other_user}",
      "gists_url": "https://api.github.com/users/tommyip/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tommyip/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tommyip/subscriptions",
      "organizations_url": "https://api.github.com/users/tommyip/orgs",
      "repos_url": "https://api.github.com/users/tommyip/repos",
      "events_url": "https://api.github.com/users/tommyip/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tommyip/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-03T11:11:08Z",
    "updated_at": "2017-06-03T16:25:10Z",
    "body": "@nikomatsakis \r\nOk I got this working, how should the error message look? Maybe something like:\r\n```\r\nerror[E0525]: expected a closure that implements the `Fn` trait, but this closure only implements `FnOnce`\r\n --> ../rust-prog/issue_26046.rs:4:19\r\n  |\r\n4 |       let closure = move || {\r\n  |  ___________________^\r\n5 | |         vec\r\n6 | |     };\r\n  | |_____^\r\n  |\r\nnote: closure is `FnOnce` because it moves the variable `vec` out of its environment\r\n --> ../rust-prog/issue_26046.rs:5:9\r\n  |\r\n5 |         vec\r\n  |         ^^^\r\n\r\nerror: aborting due to previous error(s)\r\n```\r\nIf there is no valid table associated with the inference context it would just fallback to the existing message, ie:\r\n```\r\nnote: the requirement to implement `Fn` derives from here\r\n  --> test.rs:21:5\r\n   |\r\n21 |     Box::new(closure)\r\n   |     ^^^^^^^^^^^^^^^^^\r\n```",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305968373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/306060266",
    "html_url": "https://github.com/rust-lang/rust/issues/26046#issuecomment-306060266",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/26046",
    "id": 306060266,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjA2MDI2Ng==",
    "user": {
      "login": "rozbb",
      "id": 752802,
      "node_id": "MDQ6VXNlcjc1MjgwMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/752802?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rozbb",
      "html_url": "https://github.com/rozbb",
      "followers_url": "https://api.github.com/users/rozbb/followers",
      "following_url": "https://api.github.com/users/rozbb/following{/other_user}",
      "gists_url": "https://api.github.com/users/rozbb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rozbb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rozbb/subscriptions",
      "organizations_url": "https://api.github.com/users/rozbb/orgs",
      "repos_url": "https://api.github.com/users/rozbb/repos",
      "events_url": "https://api.github.com/users/rozbb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rozbb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-06-04T19:07:34Z",
    "updated_at": "2017-06-04T19:07:34Z",
    "body": "Speaking for myself, I think that error message is great",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/306060266/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
