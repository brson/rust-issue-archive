[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50109755",
    "html_url": "https://github.com/rust-lang/rust/pull/15964#issuecomment-50109755",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15964",
    "id": 50109755,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMTA5NzU1",
    "user": {
      "login": "sfackler",
      "id": 1455697,
      "node_id": "MDQ6VXNlcjE0NTU2OTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sfackler",
      "html_url": "https://github.com/sfackler",
      "followers_url": "https://api.github.com/users/sfackler/followers",
      "following_url": "https://api.github.com/users/sfackler/following{/other_user}",
      "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions",
      "organizations_url": "https://api.github.com/users/sfackler/orgs",
      "repos_url": "https://api.github.com/users/sfackler/repos",
      "events_url": "https://api.github.com/users/sfackler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sfackler/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-25T05:37:21Z",
    "updated_at": "2014-07-25T05:37:21Z",
    "body": "Ah, that's what the problem was! (Also this doesn't compile: https://travis-ci.org/rust-lang/rust/jobs/30801909)\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50109755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50112016",
    "html_url": "https://github.com/rust-lang/rust/pull/15964#issuecomment-50112016",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15964",
    "id": 50112016,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMTEyMDE2",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-25T06:22:08Z",
    "updated_at": "2014-07-25T06:22:08Z",
    "body": "Err, yes, I always compile the patch I actually commit. _always_\n\n(Will fix tonight.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/50112016/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51462941",
    "html_url": "https://github.com/rust-lang/rust/pull/15964#issuecomment-51462941",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15964",
    "id": 51462941,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNDYyOTQx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-07T12:08:51Z",
    "updated_at": "2014-08-07T12:08:51Z",
    "body": "@alexcrichton this is failing due to two test using the `__test` module directly:\n\n```\n---- [run-pass] run-pass/core-run-destroy.rs stdout ----\n\n    error: compilation failed!\n    status: exit code: 101\n    command: x86_64-apple-darwin/stage2/bin/rustc /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/test/run-pass/core-run-destroy.rs -L x86_64-apple-darwin/test/run-pass --target=x86_64-apple-darwin -L x86_64-apple-darwin/test/run-pass/core-run-destroy.stage2-x86_64-apple-darwin.libaux -C prefer-dynamic -o x86_64-apple-darwin/test/run-pass/core-run-destroy.stage2-x86_64-apple-darwin --cfg rtopt --cfg debug -O -L x86_64-apple-darwin/rt --test\n    stdout:\n    ------------------------------------------\n\n    ------------------------------------------\n    stderr:\n    ------------------------------------------\n    /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/test/run-pass/core-run-destroy.rs:58:50: 58:62 error: failed to resolve. Use of undeclared module `__test`\n    /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/test/run-pass/core-run-destroy.rs:58     green::start(argc, argv, rustuv::event_loop, __test::main)\n                                                                                                                                                             ^~~~~~~~~~~~\n    /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/test/run-pass/core-run-destroy.rs:58:50: 58:62 error: unresolved name `__test::main`.\n    /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/test/run-pass/core-run-destroy.rs:58     green::start(argc, argv, rustuv::event_loop, __test::main)\n                                                                                                                                                             ^~~~~~~~~~~~\n    error: aborting due to 2 previous errors\n\n    ------------------------------------------\n\n    task '[run-pass] run-pass/core-run-destroy.rs' failed at 'explicit failure', /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/compiletest/runtest.rs:1321\n\n\n---- [run-pass] run-pass/tcp-connect-timeouts.rs stdout ----\n\n    error: compilation failed!\n    status: exit code: 101\n    command: x86_64-apple-darwin/stage2/bin/rustc /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/test/run-pass/tcp-connect-timeouts.rs -L x86_64-apple-darwin/test/run-pass --target=x86_64-apple-darwin -L x86_64-apple-darwin/test/run-pass/tcp-connect-timeouts.stage2-x86_64-apple-darwin.libaux -C prefer-dynamic -o x86_64-apple-darwin/test/run-pass/tcp-connect-timeouts.stage2-x86_64-apple-darwin --cfg rtopt --cfg debug -O -L x86_64-apple-darwin/rt --test\n    stdout:\n    ------------------------------------------\n\n    ------------------------------------------\n    stderr:\n    ------------------------------------------\n    /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/test/run-pass/tcp-connect-timeouts.rs:28:50: 28:62 error: failed to resolve. Use of undeclared module `__test`\n    /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/test/run-pass/tcp-connect-timeouts.rs:28     green::start(argc, argv, rustuv::event_loop, __test::main)\n                                                                                                                                                                 ^~~~~~~~~~~~\n    /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/test/run-pass/tcp-connect-timeouts.rs:28:50: 28:62 error: unresolved name `__test::main`.\n    /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/test/run-pass/tcp-connect-timeouts.rs:28     green::start(argc, argv, rustuv::event_loop, __test::main)\n                                                                                                                                                                 ^~~~~~~~~~~~\n    error: aborting due to 2 previous errors\n\n    ------------------------------------------\n\n    task '[run-pass] run-pass/tcp-connect-timeouts.rs' failed at 'explicit failure', /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt/build/src/compiletest/runtest.rs:1321\n```\n\nThoughts? (I take it these tests are explicitly designed to be run under the green scheduler?)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51462941/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51491457",
    "html_url": "https://github.com/rust-lang/rust/pull/15964#issuecomment-51491457",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15964",
    "id": 51491457,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNDkxNDU3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-07T15:53:38Z",
    "updated_at": "2014-08-07T15:53:38Z",
    "body": "Hm, that's interesting! The `stdtest` binary is also intended to run under the green scheduler by default (and rustuv I think).\n\nThat being said, the way all these binaries run the test harness under libgreen is a gross hack (as you're discovering).\n\nOther possibilities might include:\n- `#![please_test_my_crate_with_librustuv]`\n  - This could tweak injecting `extern crate native` vs `extern crate green`.\n  - This could pass a boolean flag to the main function of the test runner whether it should be native or green. The test runner would then spin up its own green pool.\n- `PLEASE_TEST_MY_CRATE_WITH_LIBRUSTUV=1 ./my-test-binary`\n  - This would work by the test runner spinning up its own green pool.\n- `./my-test-binary --please-test-my-crate-with-librustuv`\n- `#[call_top_level_function_with_relevant_test_arguments(my_main)]`\n  - Basically instead of calling `test::test_main_static`, the function `__test::main` would call `my_main` with the os arguments and `TESTS` static.\n- `#![disable_test_hygiene]`\n  - The hacks today would continue to work as-is.\n- `#![no_inner_test_mod]`\n  - This would inject the `TESTS` variable at the top level of a crate instead of in a hidden module. That way custom setup could be done before it's passed off to the test runner.\n\nI'm not a fan of an environment variable or a command line flag because stdtest cannot succeed unless it's run with librustuv as the backend. This is kinda just a smattering of ideas, none of them make me feel comfortable really. I suppose the \"sanest\" one is `#![disable_test_hygiene]`, but that is quite unfortunate!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51491457/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51606160",
    "html_url": "https://github.com/rust-lang/rust/pull/15964#issuecomment-51606160",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/15964",
    "id": 51606160,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNjA2MTYw",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-08T14:04:06Z",
    "updated_at": "2014-08-08T14:04:06Z",
    "body": "I implemented a variation on `#[disable_test_hygiene]`: `#![reexport_test_harness_main = \"test_main\"]` will create a `use test_main = __test::main` (with the right gensyms) at the top of the crate, so one has access to the entrypoint via `test_main` (or whatever other symbol one choice).\n\nr?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/51606160/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
