[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/40090053",
    "html_url": "https://github.com/rust-lang/rust/issues/13429#issuecomment-40090053",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13429",
    "id": 40090053,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDkwMDUz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-10T14:44:03Z",
    "updated_at": "2014-04-10T14:44:03Z",
    "body": "Hm, something odd is going on here.\n\nIf I break on the `println` statement in gdb, `a` has value 3.14, while `b` has value `1.26e11` (what's printed). Additionally, when compiled with optimizations this works as expected.\n\nLooking at the binary, this sequence of instructions happens for `let a` and `let b`\n\n```\nmov $0x40091eb8, 0x5c(%esp)\nmov $0x51eb851f, 0x58(%esp)\nmov $0x40091eb8, 0x58(%esp)\nmov $0x51eb851f, 0x54(%esp)\n```\n\nNote the overlapping stores here (both storing into `0x58(%esp)`). Additionally, if the address of `&b` is interpreted as a double, the value is 3.14.\n\nI suspect an LLVM bug here...\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/40090053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53800082",
    "html_url": "https://github.com/rust-lang/rust/issues/13429#issuecomment-53800082",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13429",
    "id": 53800082,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODAwMDgy",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-28T21:13:41Z",
    "updated_at": "2014-08-28T21:13:41Z",
    "body": "It'd be interesting to see what clang on windows does.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53800082/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53800148",
    "html_url": "https://github.com/rust-lang/rust/issues/13429#issuecomment-53800148",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13429",
    "id": 53800148,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODAwMTQ4",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-28T21:14:12Z",
    "updated_at": "2014-08-28T21:14:12Z",
    "body": "Probably just-a-bug.  Probably worth investigating.  Probably not worth blocking the release, though.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53800148/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53800198",
    "html_url": "https://github.com/rust-lang/rust/issues/13429#issuecomment-53800198",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13429",
    "id": 53800198,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODAwMTk4",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-28T21:14:38Z",
    "updated_at": "2014-08-28T21:14:38Z",
    "body": "P-high, not 1.0 milestone.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53800198/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53810605",
    "html_url": "https://github.com/rust-lang/rust/issues/13429#issuecomment-53810605",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13429",
    "id": 53810605,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODEwNjA1",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-28T22:13:37Z",
    "updated_at": "2014-08-28T22:13:37Z",
    "body": "So I was able to reduce it to this IR:\n\n``` LLVM\n; ModuleID = 'bad-float-cast.rs'\ntarget datalayout = \"e-p:32:32-i64:64-f80:32-n8:16:32\"\ntarget triple = \"i686-pc-windows-gnu\"\n\n%str_slice = type { i8*, i32 }\n\n@str147 = internal constant [4 x i8] c\"%f\\0A\\00\"\n\ndeclare i32 @printf(i8*, double %f) unnamed_addr\n\n; Function Attrs: uwtable\ndefine internal void @print_double(double %f) unnamed_addr {\nentry-block:\n  %0 = getelementptr inbounds [4 x i8]* @str147, i32 0, i32 0\n  call i32 @printf(i8* %0, double %f)\n  ret void\n}\n\ndefine i32 @main(i32, i8**) unnamed_addr {\nentry-block:\n  %a = alloca double\n  %b = alloca float\n  store double 3.140000e+00, double* %a\n  %2 = load double* %a\n  %3 = fptrunc double %2 to float\n  store float %3, float* %b\n  %4 = load float* %b\n  %5 = fpext float %4 to double\n  call void @print_double(double %5)\n  ret i32 0\n}\n```\n\nRunning this through `llc` (from rust's llvm build) first I get the wrong behaviour:\n\n```\n> % llc.exe bad-float-cast.ll && clang bad-float-cast.s -o a.exe && ./a.exe\n126443839488.000000\n```\n\nBut notice if I feed the IR to clang directly instead:\n\n```\n> % clang bad-float-cast.ll -o a.exe && ./a.exe\nwarning: overriding the module target triple with i686-w64-windows-gnu\n1 warning generated.\n3.140000\n```\n\nSo, I'm pretty sure this is an LLVM bug and it's not present in whatever version my clang was built with:\n\n```\n> %  clang -v\nclang version 3.5.0 (C:/repo/mingw-w64-clang-svn/clang e6ff2fc8ac80ce4441d1a7f1ddd9f0964ed2ba1e) (C:/repo/mingw-w64-clang-svn/llvm c09746dc9ced3d21b0bfd9ac308ef8c06832808e)\nTarget: i686-w64-windows-gnu\nThread model: posix\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53810605/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53813299",
    "html_url": "https://github.com/rust-lang/rust/issues/13429#issuecomment-53813299",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13429",
    "id": 53813299,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODEzMjk5",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-28T22:35:36Z",
    "updated_at": "2014-08-28T22:35:36Z",
    "body": "This is also not windows specific, I was able to reproduce on both linux and mac.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53813299/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53828171",
    "html_url": "https://github.com/rust-lang/rust/issues/13429#issuecomment-53828171",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13429",
    "id": 53828171,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODI4MTcx",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-29T01:38:23Z",
    "updated_at": "2014-08-29T08:22:33Z",
    "body": "I bisected LLVM to find the offending commit: https://github.com/llvm-mirror/llvm/commit/6bb00df864ea4e2f74f47c088b65baaff962cca5 but I don't think this caused it so much as just exposed a bug. After that commit, it'd no longer try to autodetect the cpu features supported. If you manually enable sse2 with `-C target-feature=\"+sse2\"` it works:\n\n```\n-> % rustc bad-float-cast.rs --target=i686-apple-darwin -C target-feature=\"+sse2\"\n-> % ./bad-float-cast\n3.14\n\n-> % rustc bad-float-cast.rs --target=i686-apple-darwin\n-> % ./bad-float-cast\n126443840048\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53828171/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53828418",
    "html_url": "https://github.com/rust-lang/rust/issues/13429#issuecomment-53828418",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13429",
    "id": 53828418,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODI4NDE4",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-29T01:42:45Z",
    "updated_at": "2014-08-29T08:22:53Z",
    "body": "As for why LLVM is generating bad code in the non-sse case, I've no idea. A small test case to show the bad asm:\n\n``` LLVM\n; ModuleID = 'bad-float-cast.rs'\ntarget triple = \"i686-unknown-linux-gnu\"\n\ndefine void @bar() unnamed_addr {\nentry-block:\n  %a = alloca double\n  %b = alloca float\n\n  store double 3.140000e+00, double* %a\n  %0 = load double* %a\n\n  %1 = fptrunc double %0 to float\n\n  store float %1, float* %b\n\n  ret void\n}\n```\n\nwithout SSE:\n\n``` gas\n    .text\n    .file   \"test.ll\"\n    .globl  bar\n    .align  16, 0x90\n    .type   bar,@function\nbar:                                    # @bar\n    .cfi_startproc\n# BB#0:                                 # %entry-block\n    subl    $20, %esp\n.Ltmp0:\n    .cfi_def_cfa_offset 24\n    movl    $1074339512, 12(%esp)   # imm = 0x40091EB8\n    movl    $1374389535, 8(%esp)    # imm = 0x51EB851F  0x40091EB851EB851F (double) 3.14\n    movl    $1074339512, 8(%esp)    # imm = 0x40091EB8\n    movl    $1374389535, 4(%esp)    # imm = 0x51EB851F\n    addl    $20, %esp\n    retl\n.Ltmp1:\n    .size   bar, .Ltmp1-bar\n    .cfi_endproc\n\n\n    .section    \".note.GNU-stack\",\"\",@progbits\n```\n\nWith sse2:\n\n``` gas\n    .text\n    .file   \"test.ll\"\n    .globl  bar\n    .align  16, 0x90\n    .type   bar,@function\nbar:                                    # @bar\n    .cfi_startproc\n# BB#0:                                 # %entry-block\n    subl    $20, %esp\n.Ltmp0:\n    .cfi_def_cfa_offset 24\n    movl    $1074339512, 12(%esp)   # imm = 0x40091EB8\n    movl    $1374389535, 8(%esp)    # imm = 0x51EB851F 0x40091EB851EB851F (double) 3.14\n    movl    $1078523331, 4(%esp)    # imm = 0x4048F5C3  0x4048F5C3 (float) 3.14\n    addl    $20, %esp\n    retl\n.Ltmp1:\n    .size   bar, .Ltmp1-bar\n    .cfi_endproc\n\n\n    .section    \".note.GNU-stack\",\"\",@progbits\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53828418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53844068",
    "html_url": "https://github.com/rust-lang/rust/issues/13429#issuecomment-53844068",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13429",
    "id": 53844068,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODQ0MDY4",
    "user": {
      "login": "luqmana",
      "id": 287063,
      "node_id": "MDQ6VXNlcjI4NzA2Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luqmana",
      "html_url": "https://github.com/luqmana",
      "followers_url": "https://api.github.com/users/luqmana/followers",
      "following_url": "https://api.github.com/users/luqmana/following{/other_user}",
      "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions",
      "organizations_url": "https://api.github.com/users/luqmana/orgs",
      "repos_url": "https://api.github.com/users/luqmana/repos",
      "events_url": "https://api.github.com/users/luqmana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luqmana/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-29T07:08:41Z",
    "updated_at": "2014-09-07T03:46:56Z",
    "body": "Fix submitted upstream: http://reviews.llvm.org/D5125\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/53844068/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
