[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21835433",
    "html_url": "https://github.com/rust-lang/rust/issues/8140#issuecomment-21835433",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8140",
    "id": 21835433,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxODM1NDMz",
    "user": {
      "login": "bblum",
      "id": 1820515,
      "node_id": "MDQ6VXNlcjE4MjA1MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bblum",
      "html_url": "https://github.com/bblum",
      "followers_url": "https://api.github.com/users/bblum/followers",
      "following_url": "https://api.github.com/users/bblum/following{/other_user}",
      "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bblum/subscriptions",
      "organizations_url": "https://api.github.com/users/bblum/orgs",
      "repos_url": "https://api.github.com/users/bblum/repos",
      "events_url": "https://api.github.com/users/bblum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bblum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-31T01:45:19Z",
    "updated_at": "2013-07-31T01:45:32Z",
    "body": "(at least they don't have the error where the lock function takes one of the locks but the unlock drops the other. that would be really embarrassing. (but they could!))\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21835433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21837333",
    "html_url": "https://github.com/rust-lang/rust/issues/8140#issuecomment-21837333",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8140",
    "id": 21837333,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxODM3MzMz",
    "user": {
      "login": "basic-calculus",
      "id": 4070335,
      "node_id": "MDQ6VXNlcjQwNzAzMzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4070335?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/basic-calculus",
      "html_url": "https://github.com/basic-calculus",
      "followers_url": "https://api.github.com/users/basic-calculus/followers",
      "following_url": "https://api.github.com/users/basic-calculus/following{/other_user}",
      "gists_url": "https://api.github.com/users/basic-calculus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/basic-calculus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/basic-calculus/subscriptions",
      "organizations_url": "https://api.github.com/users/basic-calculus/orgs",
      "repos_url": "https://api.github.com/users/basic-calculus/repos",
      "events_url": "https://api.github.com/users/basic-calculus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/basic-calculus/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-31T02:57:39Z",
    "updated_at": "2013-07-31T02:57:39Z",
    "body": "@bblum Yeah, I'm sorry. I should probable fix that. Here's why I used `atomically` in the dynamic library support. I believe the error state in Win32, and most (I don't believe it's actually required) POSIX implementations are thread-local to each operating system thread. I didn't know if the error state was also thread-local to each Rust task (Rust tasks are layered on top of OS threads) so I thought that multiple Rust tasks could end up using the same dynamic library error state, and step on each other's toes. That's why I stopped the Rust task from context switching using `atomically`. I think I may have been mistaken, and confused about thread local storage, and that the use of `atomically` might not be needed.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21837333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21838884",
    "html_url": "https://github.com/rust-lang/rust/issues/8140#issuecomment-21838884",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8140",
    "id": 21838884,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxODM4ODg0",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-31T04:05:37Z",
    "updated_at": "2013-07-31T04:05:37Z",
    "body": "This will require creating platform-specific bindings to mutexes so that we can declare them statically.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21838884/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21840846",
    "html_url": "https://github.com/rust-lang/rust/issues/8140#issuecomment-21840846",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8140",
    "id": 21840846,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxODQwODQ2",
    "user": {
      "login": "bblum",
      "id": 1820515,
      "node_id": "MDQ6VXNlcjE4MjA1MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bblum",
      "html_url": "https://github.com/bblum",
      "followers_url": "https://api.github.com/users/bblum/followers",
      "following_url": "https://api.github.com/users/bblum/following{/other_user}",
      "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bblum/subscriptions",
      "organizations_url": "https://api.github.com/users/bblum/orgs",
      "repos_url": "https://api.github.com/users/bblum/repos",
      "events_url": "https://api.github.com/users/bblum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bblum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-07-31T05:20:14Z",
    "updated_at": "2013-07-31T05:26:31Z",
    "body": "@brson: My idea for it was something like this, sort of like the trick that #7748 would use.\n\n```\nfn lock(...) {\n    if self.l.is_null() { // need barrier here?\n        let attempted_thing = rust_create_little_lock();\n        compare_and_swap(&mut self.l, attempted_thing, ptr::null()) // which barrier?\n    }\n    // actual lock routine follows\n}\n```\n\nDoesn't need any more platform-specific stuff than the existing `rust_create_little_lock` builtin. (But I didn't feel up to figuring out the barriers today.) (Actually, I think no barriers are needed; you just need to be careful to read the result of the compare and swap and use that as the new pointer if you lose the race.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/21840846/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30242919",
    "html_url": "https://github.com/rust-lang/rust/issues/8140#issuecomment-30242919",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8140",
    "id": 30242919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwMjQyOTE5",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-10T16:31:05Z",
    "updated_at": "2013-12-10T16:31:05Z",
    "body": "Closing now that this has been fixed. We now have a lazily initialized static mutex type which serves to be a small short-lived (and properly scoped) lock for sections like this. Right now this does not leverage the `atomically` function, but this function is going to have to be removed anyway once green scheduling is removed from libstd.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30242919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
