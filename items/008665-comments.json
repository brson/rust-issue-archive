[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23032115",
    "html_url": "https://github.com/rust-lang/rust/issues/8665#issuecomment-23032115",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8665",
    "id": 23032115,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzMDMyMTE1",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-21T16:53:40Z",
    "updated_at": "2013-08-21T16:53:40Z",
    "body": "LLVM may have updated their optimization passes, and we may just need to update what order we're optimizing things in. @thestinger, you mentioned loop vectorization as being a big thing at lower optimization levels, do you know of perhaps any analysis passes that we're missing by default?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23032115/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23047440",
    "html_url": "https://github.com/rust-lang/rust/issues/8665#issuecomment-23047440",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8665",
    "id": 23047440,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzMDQ3NDQw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-21T20:27:11Z",
    "updated_at": "2013-08-21T20:27:11Z",
    "body": "After talking with @thestinger on IRC, we've reached the conclusion that one major change we can make is reworking how the LLVM passes are run. I'm not certain that this is the source of the regression you're seeing, but it's the best one that I can think of related to updating LLVM.\n\nAfter looking into this, we do a large number of things differently than clang\n1. We only have one pass manager (a module one), clang has 3. Clang runs a function, a module, and then a codegen pass manager. From what I can tell, this doesn't necessarily mean that we're not running optimizations, but rather we may finish optimizations more quickly by running in this order.\n2. We're not populating our pass manager with any target-specific analysis passes. Clang will populate all of its pass managers with target-specific analyses, but we don't do anything related to that.\n3. Our list of O1/2/3 optimizations fall out of date with llvm updates, so we shouldn't have them hard-coded. The hardcoded list is just a duplicate of what's already in LLVM itself anyway.\n4. There's no way for us to debug what passes are run. We need an option to debug this and see what's happening.\n5. Right now we're running two pass managers, but they're possibly overlapping with one another and it's not clear which one is responsible for which work.\n\nLong story short, investigation into how we're running LLVM passes shows that it probably needs to be reworked and simplified to use more existing LLVM infrastructure and to match clang more closely. I'm still not certain that this is the cause of this regression, but I'll attempt to determine if it is by making these changes.\n\ncc @Aatch, you were the one who recently added all the PassManager stuff to `passes.rs`, just wanted to make sure that none of this is alarming to you.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23047440/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23055700",
    "html_url": "https://github.com/rust-lang/rust/issues/8665#issuecomment-23055700",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8665",
    "id": 23055700,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzMDU1NzAw",
    "user": {
      "login": "sebcrozet",
      "id": 1734958,
      "node_id": "MDQ6VXNlcjE3MzQ5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1734958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebcrozet",
      "html_url": "https://github.com/sebcrozet",
      "followers_url": "https://api.github.com/users/sebcrozet/followers",
      "following_url": "https://api.github.com/users/sebcrozet/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebcrozet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebcrozet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebcrozet/subscriptions",
      "organizations_url": "https://api.github.com/users/sebcrozet/orgs",
      "repos_url": "https://api.github.com/users/sebcrozet/repos",
      "events_url": "https://api.github.com/users/sebcrozet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebcrozet/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-21T22:32:06Z",
    "updated_at": "2013-08-21T22:32:06Z",
    "body": "Thanks for all those investigations!\n\nI merged together a few files from my project to give you a better stand-alone example of regression.\nThe example is big (298 lines), and mostly unreadable; but it exhibits a slowdown greater than 85% after LLVM update. I thought it might be useful for you to have an example of big slowdown for debugging.\n\nHere is the example: https://gist.github.com/sebcrozet/6300848\n\nAgain, compiled with `--opt-level=3`.\nWith the compiler after LLVM update (revision a8c3fe45c6138cd1f4d143fdb0e843ee2d4759b2) I get:\n\n```\ntest test::bench_johnson_simplex ... bench: 191270 ns/iter (+/- 4553) \n```\n\nWith the compiler before LLVM update (revision 67c954e365970e4c2cd06f0c50724656d7010f45) I get:\n\n```\ntest test::bench_johnson_simplex ... bench: 23890 ns/iter (+/- 94) \n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23055700/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23143039",
    "html_url": "https://github.com/rust-lang/rust/issues/8665#issuecomment-23143039",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8665",
    "id": 23143039,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzMTQzMDM5",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-23T04:38:21Z",
    "updated_at": "2013-08-23T04:38:21Z",
    "body": "Sadly my suspicions were not correct. You're example is fantastic though, and I'm very perplexed as to what's going on with them. I did profile your code though, and I get the same 10x slowness with thew new LLVM upgrade. What's very suspicious to me are the top functions in the profile of that code. Sorry, but I haven't figured out yet how to get profiles on OSX not in instruments...\n\nBefore the llvm upgrades (stage0 today):\n![screen shot 2013-08-22 at 9 30 44 pm](https://f.cloud.github.com/assets/64996/1014224/e65c5e4e-0bac-11e3-80b6-6730cd341d50.png)\n\nAfter #8700 (with llvm upgrades and refactored pass handling)\n![screen shot 2013-08-22 at 9 30 55 pm](https://f.cloud.github.com/assets/64996/1014223/e649cb3a-0bac-11e3-9811-94cabd51e9c5.png)\n\nThe exact test I ran was the one above, but with the iterations turned up to 1000 to take a bit longer. I'm very confused why the timing information is showing up so massively in the profiles of one, so I decided to run with different code.\n\nWith [this code](https://gist.github.com/alexcrichton/6315588), I get the following profiles\n\nBefore:\n![screen shot 2013-08-22 at 9 35 12 pm](https://f.cloud.github.com/assets/64996/1014244/7a8c1816-0bad-11e3-9e06-dcf217b936c0.png)\nAfter:\n![screen shot 2013-08-22 at 9 35 19 pm](https://f.cloud.github.com/assets/64996/1014245/7a9f788e-0bad-11e3-81c4-3c043a2d777d.png)\n\nI'm disturbed by the fact that there are `transmute`s in the profile, but there shouldn't be any timing information weirdness going on here. I'll continue investigating later, but I wanted to post my findings here before I forgot them.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23143039/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23144954",
    "html_url": "https://github.com/rust-lang/rust/issues/8665#issuecomment-23144954",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8665",
    "id": 23144954,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzMTQ0OTU0",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-23T05:58:42Z",
    "updated_at": "2013-08-23T05:58:42Z",
    "body": "Transmute showing up means a change in inlining.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23144954/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23194684",
    "html_url": "https://github.com/rust-lang/rust/issues/8665#issuecomment-23194684",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8665",
    "id": 23194684,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzMTk0Njg0",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-23T22:16:22Z",
    "updated_at": "2013-08-23T22:16:22Z",
    "body": "I identified the root cause of this issue, so I'm closing this in favour of #8720.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23194684/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
