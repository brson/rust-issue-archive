[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8573454",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8573454",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8573454,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NzM0NTQ=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-14T19:46:15Z",
    "updated_at": "2012-09-14T19:46:15Z",
    "body": "Thank you! This will take a little time to review.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8573454/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8630858",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8630858",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8630858,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzA4NTg=",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-17T21:02:28Z",
    "updated_at": "2012-09-17T21:02:28Z",
    "body": "Neat! Do I understand correctly that this allocates one thread per task until it hits the maximum, then assigns the new tasks to existing threads by round robin? This sounds reasonably fair, I can't think of many downsides off hand. Does it address a particular performance issue, or did you just not like seeing 7 idle threads when running on an 8-way machine? :)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8630858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8631716",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8631716",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8631716,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzE3MTY=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-17T21:27:06Z",
    "updated_at": "2012-09-17T21:28:31Z",
    "body": "@graydon yes that is what it does.\n\nBased on the conversation we had when we were discussing using a queue for scheduling tasks, I now think that round robin is probably the wrong way to assign tasks to threads, because it creates a consistent but somewhat arbitrary pattern, that some code could conceivably rely on. In the same way, picking unused threads to schedule on could have implications that I haven't considered.\n\nThe main motivation is that recently I was considering how many stacks we allocate just to start the runtime, and it's a lot.\n\nFWIW, in a future where we have work stealing and task zygotes (tasks that begin running in their parent's 'context' in the hopes that they will be short lived) I expect all tasks to be spawned onto their parent's thread by default.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8631716/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8632119",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8632119",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8632119,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzIxMTk=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-17T21:40:13Z",
    "updated_at": "2012-09-18T01:06:51Z",
    "body": "@Blei my big concern with this patch is the locking around `threads.size()`. Now that the set of live threads can change dynamically we shouldn't be calling `size()` without a lock. In some cases it is already protected by the scheduler lock, but in others it is being called without the lock. The locking in the scheduler can be a little tricky, especially around kill_all_tasks. I'll put further comments inline.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8632119/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8632275",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8632275",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8632275,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzIyNzU=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-17T21:45:20Z",
    "updated_at": "2012-09-17T21:45:20Z",
    "body": "In rust_sched_loop.h we should probably add a comment saying that modifying `threads` must be protected by `lock`. I believe other fields mention their locking requirements already.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8632275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8632312",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8632312",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8632312,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzIzMTI=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-17T21:46:26Z",
    "updated_at": "2012-09-17T21:46:26Z",
    "body": "Also, `live_threads` must be protected by the lock now, should be mentioned in the header\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8632312/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8633214",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8633214",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8633214,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzMyMTQ=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-17T22:20:12Z",
    "updated_at": "2012-09-17T22:20:12Z",
    "body": "@bblum you may be interested in taking a look at this\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8633214/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8649255",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8649255",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8649255,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDkyNTU=",
    "user": {
      "login": "Blei",
      "id": 52674,
      "node_id": "MDQ6VXNlcjUyNjc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/52674?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Blei",
      "html_url": "https://github.com/Blei",
      "followers_url": "https://api.github.com/users/Blei/followers",
      "following_url": "https://api.github.com/users/Blei/following{/other_user}",
      "gists_url": "https://api.github.com/users/Blei/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Blei/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Blei/subscriptions",
      "organizations_url": "https://api.github.com/users/Blei/orgs",
      "repos_url": "https://api.github.com/users/Blei/repos",
      "events_url": "https://api.github.com/users/Blei/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Blei/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-18T10:39:13Z",
    "updated_at": "2012-09-18T10:39:13Z",
    "body": "Thanks for the review!\n\nI renamed `rust_max_sched_threads` to `rust_sched_threads` and `rust_sched_threads` in turn to `rust_sched_current_nonlazy_threads`.\n\nThe slightly weird if condition in the thread allocation is needed to catch the case that we allocate 1 thread in the constructor which doesn't have a task yet (this was covered by checking for \"empty\" threads in the previous patch). If we remove the allocation of a thread in the constructor, there is some code that fails with an assertion when it wants to get the driver out of a `rust_manual_sched_launcher_factory` right after creating the scheduler.\n\nI don't know what the proper way to deal with \"v2\" patches is in github pull requests. Amending/squashing together with `push -f` destroys previous inline comments. Should I open a new push request with the squashed changes when all issues have been worked out?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8649255/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8667260",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8667260",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8667260,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NjcyNjA=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-18T19:33:38Z",
    "updated_at": "2012-09-18T19:33:38Z",
    "body": "A second pull request would be nice if you plan to squash, but this two-commit history looks fine to me as-is. Besides the squashing are you happy with these commits? They look good to me now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8667260/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8667661",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8667661",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8667661,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2Njc2NjE=",
    "user": {
      "login": "Blei",
      "id": 52674,
      "node_id": "MDQ6VXNlcjUyNjc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/52674?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Blei",
      "html_url": "https://github.com/Blei",
      "followers_url": "https://api.github.com/users/Blei/followers",
      "following_url": "https://api.github.com/users/Blei/following{/other_user}",
      "gists_url": "https://api.github.com/users/Blei/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Blei/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Blei/subscriptions",
      "organizations_url": "https://api.github.com/users/Blei/orgs",
      "repos_url": "https://api.github.com/users/Blei/repos",
      "events_url": "https://api.github.com/users/Blei/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Blei/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-18T19:44:50Z",
    "updated_at": "2012-09-18T19:44:50Z",
    "body": "I was worried of knowingly introducing incorrect revisions into the repo. But I guess that shouldn't really be a big problem here. If you don't see any further problems, this branch is ready to pull :)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8667661/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8706915",
    "html_url": "https://github.com/rust-lang/rust/pull/3498#issuecomment-8706915",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3498",
    "id": 8706915,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MDY5MTU=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-19T21:05:20Z",
    "updated_at": "2012-09-19T21:05:20Z",
    "body": "Merged!\n\nFWIW, if there were commits that didn't build or that were likely to cause significant test failures then I would not want to leave them in the history, but the locking in v2 mostly protects against some underrepresented corner-cases.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8706915/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
