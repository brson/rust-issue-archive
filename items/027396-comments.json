[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/126240397",
    "html_url": "https://github.com/rust-lang/rust/issues/27396#issuecomment-126240397",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27396",
    "id": 126240397,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNjI0MDM5Nw==",
    "user": {
      "login": "barosl",
      "id": 573768,
      "node_id": "MDQ6VXNlcjU3Mzc2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/573768?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/barosl",
      "html_url": "https://github.com/barosl",
      "followers_url": "https://api.github.com/users/barosl/followers",
      "following_url": "https://api.github.com/users/barosl/following{/other_user}",
      "gists_url": "https://api.github.com/users/barosl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/barosl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/barosl/subscriptions",
      "organizations_url": "https://api.github.com/users/barosl/orgs",
      "repos_url": "https://api.github.com/users/barosl/repos",
      "events_url": "https://api.github.com/users/barosl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/barosl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-30T09:29:46Z",
    "updated_at": "2015-07-30T09:29:46Z",
    "body": "`std::io::Read::read` does not guarantee the buffer to be fully filled. You must check the return value of `read` to see how many bytes are actually read. In my system, `file.read()` and `file_buf.read()` return the different numbers before the assertion failure:\n\n```\nfile: 255 0 0 255\n buf: 255 0 0 255\nOk(4) / Ok(4)\nfile: 255 0 0 255\n buf: 255 0 0 255\nOk(4) / Ok(4)\nfile: 255 0 0 255\n buf: 255 0 0 0\nOk(4) / Ok(2)\nthread '<main>' panicked at 'assertion failed: bytes[3] == bytes_buf[3]', 1.rs:41\n```\n\nThis behavior [is documented](http://doc.rust-lang.org/nightly/std/io/trait.Read.html#tymethod.read), so is not a bug.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/126240397/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/126255402",
    "html_url": "https://github.com/rust-lang/rust/issues/27396#issuecomment-126255402",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27396",
    "id": 126255402,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNjI1NTQwMg==",
    "user": {
      "login": "barosl",
      "id": 573768,
      "node_id": "MDQ6VXNlcjU3Mzc2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/573768?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/barosl",
      "html_url": "https://github.com/barosl",
      "followers_url": "https://api.github.com/users/barosl/followers",
      "following_url": "https://api.github.com/users/barosl/following{/other_user}",
      "gists_url": "https://api.github.com/users/barosl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/barosl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/barosl/subscriptions",
      "organizations_url": "https://api.github.com/users/barosl/orgs",
      "repos_url": "https://api.github.com/users/barosl/repos",
      "events_url": "https://api.github.com/users/barosl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/barosl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-30T09:56:27Z",
    "updated_at": "2015-07-30T09:58:02Z",
    "body": "To fulfil your original intention, you should create another adaptor using [`Read::take`](http://doc.rust-lang.org/nightly/std/io/trait.Read.html#method.take) and consume it with [`Read::read_to_end`](http://doc.rust-lang.org/nightly/std/io/trait.Read.html#method.read_to_end). You can replace your file reading logic with something like this:\n\n``` rust\n(&mut file).take(4).read_to_end(&mut bytes).unwrap();\n(&mut file_buf).take(4).read_to_end(&mut bytes_buf).unwrap();\n```\n\nAlso, as a side note, you'd better append `.unwrap()` whenever you deal with I/O, such as the code above. Of course, a proper error handling is more appropriate, but a simple `.unwrap()` is still much better than not handling at all. Actually, the compiler may have already warned you about this (\"unused result which must be used\").\n\nSee also [this Stack Overflow question](http://stackoverflow.com/questions/30412521/how-to-read-specific-number-of-bytes-from-a-stream).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/126255402/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/126375401",
    "html_url": "https://github.com/rust-lang/rust/issues/27396#issuecomment-126375401",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27396",
    "id": 126375401,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNjM3NTQwMQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-07-30T15:48:01Z",
    "updated_at": "2015-07-30T15:48:01Z",
    "body": "I agree with @barosl's analysis, so closing as working as intended.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/126375401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
