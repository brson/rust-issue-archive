[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7460058",
    "html_url": "https://github.com/rust-lang/rust/issues/3083#issuecomment-7460058",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3083",
    "id": 7460058,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NjAwNTg=",
    "user": {
      "login": "bblum",
      "id": 1820515,
      "node_id": "MDQ6VXNlcjE4MjA1MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bblum",
      "html_url": "https://github.com/bblum",
      "followers_url": "https://api.github.com/users/bblum/followers",
      "following_url": "https://api.github.com/users/bblum/following{/other_user}",
      "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bblum/subscriptions",
      "organizations_url": "https://api.github.com/users/bblum/orgs",
      "repos_url": "https://api.github.com/users/bblum/repos",
      "events_url": "https://api.github.com/users/bblum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bblum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-02T16:13:41Z",
    "updated_at": "2012-08-02T16:13:41Z",
    "body": "+1. i'm all for compiler warnings that make folks tighten down their code.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7460058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7551141",
    "html_url": "https://github.com/rust-lang/rust/issues/3083#issuecomment-7551141",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3083",
    "id": 7551141,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTExNDE=",
    "user": {
      "login": "bstrie",
      "id": 865233,
      "node_id": "MDQ6VXNlcjg2NTIzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bstrie",
      "html_url": "https://github.com/bstrie",
      "followers_url": "https://api.github.com/users/bstrie/followers",
      "following_url": "https://api.github.com/users/bstrie/following{/other_user}",
      "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions",
      "organizations_url": "https://api.github.com/users/bstrie/orgs",
      "repos_url": "https://api.github.com/users/bstrie/repos",
      "events_url": "https://api.github.com/users/bstrie/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bstrie/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-07T12:10:06Z",
    "updated_at": "2012-08-07T12:10:06Z",
    "body": "Would it work similarly to the unused variable detection, where it warns unless you stick an underscore on the front of the identifier?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7551141/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7574439",
    "html_url": "https://github.com/rust-lang/rust/issues/3083#issuecomment-7574439",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3083",
    "id": 7574439,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NzQ0Mzk=",
    "user": {
      "login": "zmanji",
      "id": 13552,
      "node_id": "MDQ6VXNlcjEzNTUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/13552?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zmanji",
      "html_url": "https://github.com/zmanji",
      "followers_url": "https://api.github.com/users/zmanji/followers",
      "following_url": "https://api.github.com/users/zmanji/following{/other_user}",
      "gists_url": "https://api.github.com/users/zmanji/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zmanji/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zmanji/subscriptions",
      "organizations_url": "https://api.github.com/users/zmanji/orgs",
      "repos_url": "https://api.github.com/users/zmanji/repos",
      "events_url": "https://api.github.com/users/zmanji/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zmanji/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-08T04:01:35Z",
    "updated_at": "2012-08-08T04:01:35Z",
    "body": "I would like to work on this issue but I don't know where to start. Can anyone provide me with some tips?\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7574439/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7574585",
    "html_url": "https://github.com/rust-lang/rust/issues/3083#issuecomment-7574585",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3083",
    "id": 7574585,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NzQ1ODU=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-08T04:12:23Z",
    "updated_at": "2012-08-08T04:12:23Z",
    "body": "The `liveness` pass already pretty much computes the information you need.  It can be found in `src/rustc/middle/liveness.rs`, but you probably want to come on IRC and ask me (nmatsakis) questions about it.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7574585/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7582606",
    "html_url": "https://github.com/rust-lang/rust/issues/3083#issuecomment-7582606",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3083",
    "id": 7582606,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1ODI2MDY=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-08T12:49:33Z",
    "updated_at": "2012-08-08T12:49:33Z",
    "body": "I'm not sure how familiar you are with a traditional liveness analysis, but the basic idea is that it tracks when variables may be used again (in which case they are live).  Ours is a bit different in that it _also_ tracks when variables may be reassigned in the future.  Therefore, it should be possible to check, at the point where a variable is declared, whether it will ever be reassigned. \n\nThe easiest thing would be to issue a warning for mutable variables which have initializers but are never reassigned (such as the example given in this bug).  Such a warning would be issued in check_local().  There is currently a check that says \"if there is an initializer and the variable is immutable, ensure it is never assigned again\".  You could repurpose this to something like \"if there is an initializer, and the variable is never reassigned again, warn if it is not immutable\" (but of course it should still report the error it does today)\n\nYou might conceivably also try to issue warnings for variables that are assigned only once in the flow of execution:\n\n```\nlet mut foo;\nif cond { foo = 1; } else { foo = 2; }\n...\n```\n\nas such variables also do not require a mut label.  But this is trickier, I'm not sure if we have enough information available to distinguish that case from one like;\n\n```\nlet mut foo;\nfoo = 3;\n...\nif cond { foo = 1; } else { foo = 2; }\n...\n```\n\nThat is, each assignment can determine whether there are ever any later assignments and whether the variable is ever used later.  But here it seems like we would also need to know whether there have been any prior assignments. So I'd say just warn if there is an initializer and ignore this second case.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7582606/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7582646",
    "html_url": "https://github.com/rust-lang/rust/issues/3083#issuecomment-7582646",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3083",
    "id": 7582646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1ODI2NDY=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-08-08T12:51:39Z",
    "updated_at": "2012-08-08T12:51:39Z",
    "body": "Note: Be sure to add a \"compile-fail\" test case as described here: https://github.com/mozilla/rust/wiki/Note-testsuite\n\nThis one is a bit tricky as you'll be detecting a warning, and the test suite likes for such tests to fail, so you'll probably have to add a secondary error.  You can check out the test `src/test/liveness-unused.rs` as an example.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/7582646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/11418257",
    "html_url": "https://github.com/rust-lang/rust/issues/3083#issuecomment-11418257",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3083",
    "id": 11418257,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNDE4MjU3",
    "user": {
      "login": "ttaubert",
      "id": 300895,
      "node_id": "MDQ6VXNlcjMwMDg5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/300895?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ttaubert",
      "html_url": "https://github.com/ttaubert",
      "followers_url": "https://api.github.com/users/ttaubert/followers",
      "following_url": "https://api.github.com/users/ttaubert/following{/other_user}",
      "gists_url": "https://api.github.com/users/ttaubert/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ttaubert/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ttaubert/subscriptions",
      "organizations_url": "https://api.github.com/users/ttaubert/orgs",
      "repos_url": "https://api.github.com/users/ttaubert/repos",
      "events_url": "https://api.github.com/users/ttaubert/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ttaubert/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-12-16T14:35:31Z",
    "updated_at": "2012-12-16T14:35:31Z",
    "body": "It's unfortunately not as easy as just adding another check to check_local(). Variables might need to be mutable not only for re-assignment:\n\n```\nlet tmps = ~[];\nfor vec::each(args) |arg| {\n    tmps.push(copy *arg);\n}\n```\n\n```\nlet s = ~\"foobar\";\nlet head = str::shift_char(&mut s);\n```\n\nThese both result in `error: illegal borrow: creating mutable alias to immutable local variable`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/11418257/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/11420297",
    "html_url": "https://github.com/rust-lang/rust/issues/3083#issuecomment-11420297",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3083",
    "id": 11420297,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNDIwMjk3",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-12-16T17:40:59Z",
    "updated_at": "2012-12-16T17:40:59Z",
    "body": "I have little idea of the infrastructure (I had a look at middle/liveness.rs, which didn't help me much), but how difficult would it be to add an `used_mutably_count` to the analysis that counts the maximum number of times a variable could possibly be assigned or used in a context that requires `mut` (accounting for loops)?\n\ne.g.\n\n``` rust\nlet mut a;\na = 1;\n// used_mutably_count(a) == Known(1)\n\nlet mut b = 2;\nb = 1;\n// used_mutably_count(b) == Known(2)\n\nlet mut c = ~[];\nfor vec::each(args) |arg| {\n    c.push(copy *args); \n}\n// used_mutably_count(c) == Unknown\n```\n\nThen if `used_mutably_count(var) == Known(1)`, rustc can warn that `var` should be immutable (or not, if `var` is already immutable).\n\nIt could be computed with rules like\n\n``` rust\numc(var, if cond { blk1 } else { blk2 }) = max(umc(var, blk1), umc(var, blk2))\numc(var, { stmt1; stmt2; ... }) = umc(var, stmt1) + umc(var, stmt2) + ...\numc(var, while expr { body }) = if umc(var, body) > Known(0) || umc(var, expr) > Known(0) { Unknown } else { Known(0) }\numc(var, let var = ...;) = Known(1)\numc(var, let var;) = Known(0)\n```\n\nwhere `umc(var, ast)` counts the maximum possibly assignments & mutable-uses of `var` in `ast`, the operations are such that the result is `Unknown` if any of the inputs are `Unknown` and `Unknown > Known(k)` for all `k`.\n\n(I guess the count could even be compressed to `UsedNever`, `UsedOnce` and `UsedMany`.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/11420297/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/15200906",
    "html_url": "https://github.com/rust-lang/rust/issues/3083#issuecomment-15200906",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3083",
    "id": 15200906,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MjAwOTA2",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-03-20T20:20:43Z",
    "updated_at": "2013-03-20T20:20:43Z",
    "body": "non-critical for 0.6, de-milestoning\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/15200906/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
