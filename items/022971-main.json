{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/22971",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/22971/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/22971/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/22971/events",
  "html_url": "https://github.com/rust-lang/rust/pull/22971",
  "id": 59517920,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MzAzMDUzNzE=",
  "number": 22971,
  "title": "The Grand Metadata Reform",
  "user": {
    "login": "lifthrasiir",
    "id": 323836,
    "node_id": "MDQ6VXNlcjMyMzgzNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/323836?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lifthrasiir",
    "html_url": "https://github.com/lifthrasiir",
    "followers_url": "https://api.github.com/users/lifthrasiir/followers",
    "following_url": "https://api.github.com/users/lifthrasiir/following{/other_user}",
    "gists_url": "https://api.github.com/users/lifthrasiir/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lifthrasiir/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lifthrasiir/subscriptions",
    "organizations_url": "https://api.github.com/users/lifthrasiir/orgs",
    "repos_url": "https://api.github.com/users/lifthrasiir/repos",
    "events_url": "https://api.github.com/users/lifthrasiir/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lifthrasiir/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "huonw",
    "id": 1203825,
    "node_id": "MDQ6VXNlcjEyMDM4MjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/huonw",
    "html_url": "https://github.com/huonw",
    "followers_url": "https://api.github.com/users/huonw/followers",
    "following_url": "https://api.github.com/users/huonw/following{/other_user}",
    "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
    "organizations_url": "https://api.github.com/users/huonw/orgs",
    "repos_url": "https://api.github.com/users/huonw/repos",
    "events_url": "https://api.github.com/users/huonw/events{/privacy}",
    "received_events_url": "https://api.github.com/users/huonw/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2015-03-02T18:02:19Z",
  "updated_at": "2015-03-03T10:43:58Z",
  "closed_at": "2015-03-03T10:43:58Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/22971",
    "html_url": "https://github.com/rust-lang/rust/pull/22971",
    "diff_url": "https://github.com/rust-lang/rust/pull/22971.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/22971.patch",
    "merged_at": "2015-03-03T10:43:58Z"
  },
  "body": "This is a series of individual but correlated changes to the metadata format. The changes are significant enough that it (finally) bumps the metadata encoding version. In brief, they altogether reduce the total size of stage1 binaries by 27% (!!!!). Almost every low-hanging fruit has been considered and fixed; see the individual commits for details.\n\nDetailed library (not just metadata) size changes for x86_64-unknown-linux-gnu stage1 binaries (baseline being 3a96d6a9818fe2affc98a187fb1065120458cee9):\n\n```\n   before     after  delta path\n--------- --------- ------ --------------------------------\n  1706146   1050412  38.4% liballoc-4e7c5e5c.rlib\n   398576    152454  61.8% libarena-4e7c5e5c.rlib\n    71441     56892  20.4% libarena-4e7c5e5c.so\n 14424754   5084102  64.8% libcollections-4e7c5e5c.rlib\n 39143186  14743118  62.3% libcore-4e7c5e5c.rlib\n   195574    188150   3.8% libflate-4e7c5e5c.rlib\n   153123    152603   0.3% libflate-4e7c5e5c.so\n   477152    215262  54.9% libfmt_macros-4e7c5e5c.rlib\n    77728     66601  14.3% libfmt_macros-4e7c5e5c.so\n  1216936    684104  43.8% libgetopts-4e7c5e5c.rlib\n   207846    181116  12.9% libgetopts-4e7c5e5c.so\n   349722    147530  57.8% libgraphviz-4e7c5e5c.rlib\n    60196     49197  18.3% libgraphviz-4e7c5e5c.so\n   729842    259906  64.4% liblibc-4e7c5e5c.rlib\n   349358    247014  29.3% liblog-4e7c5e5c.rlib\n    88878     83163   6.4% liblog-4e7c5e5c.so\n  1968508    732840  62.8% librand-4e7c5e5c.rlib\n  1968204    696326  64.6% librbml-4e7c5e5c.rlib\n   283207    206589  27.1% librbml-4e7c5e5c.so\n 72369394  46401230  35.9% librustc-4e7c5e5c.rlib\n 11941372  10498483  12.1% librustc-4e7c5e5c.so\n  2717894   1983272  27.0% librustc_back-4e7c5e5c.rlib\n   501900    464176   7.5% librustc_back-4e7c5e5c.so\n    15058     12588  16.4% librustc_bitflags-4e7c5e5c.rlib\n  4008268   2961912  26.1% librustc_borrowck-4e7c5e5c.rlib\n   837550    785633   6.2% librustc_borrowck-4e7c5e5c.so\n  6473348   6095470   5.8% librustc_driver-4e7c5e5c.rlib\n  1448785   1433945   1.0% librustc_driver-4e7c5e5c.so\n 95483688  94779704   0.7% librustc_llvm-4e7c5e5c.rlib\n 43516815  43487809   0.1% librustc_llvm-4e7c5e5c.so\n   938140    817236  12.9% librustc_privacy-4e7c5e5c.rlib\n   182653    176563   3.3% librustc_privacy-4e7c5e5c.so\n  4390288   3543284  19.3% librustc_resolve-4e7c5e5c.rlib\n   872981    831824   4.7% librustc_resolve-4e7c5e5c.so\n 18176426  14795426  18.6% librustc_trans-4e7c5e5c.rlib\n  3657354   3480026   4.8% librustc_trans-4e7c5e5c.so\n 16815076  13868862  17.5% librustc_typeck-4e7c5e5c.rlib\n  3274439   3123898   4.6% librustc_typeck-4e7c5e5c.so\n 21372308  14890582  30.3% librustdoc-4e7c5e5c.rlib\n  4501971   4172202   7.3% librustdoc-4e7c5e5c.so\n  8055028   2951044  63.4% libserialize-4e7c5e5c.rlib\n   958101    710016  25.9% libserialize-4e7c5e5c.so\n 30810208  15160648  50.8% libstd-4e7c5e5c.rlib\n  6819003   5967485  12.5% libstd-4e7c5e5c.so\n 58850950  31949594  45.7% libsyntax-4e7c5e5c.rlib\n  9060154   7882423  13.0% libsyntax-4e7c5e5c.so\n  1474310   1062102  28.0% libterm-4e7c5e5c.rlib\n   345577    323952   6.3% libterm-4e7c5e5c.so\n  2827854   1643056  41.9% libtest-4e7c5e5c.rlib\n   517811    452519  12.6% libtest-4e7c5e5c.so\n  2274106   1761240  22.6% libunicode-4e7c5e5c.rlib\n--------- --------- ------ --------------------------------\n499359187 363465583  27.2% total\n```\n\nSome notes:\n- Uncompressed metadata compacts very well. It is less visible for compressed metadata but still it achieves about 5~10% reduction.\n- _Every_ commit is designed to reduce the metadata in one way. There is absolutely no negative impact associated to changes (that's why the table above doesn't contain a minus delta).\n- I've confirmed that this compiles through `make all`, making it almost correct. Other platforms have to be tested though.\n- Oh, I'll rebase this as soon as I have spare time, but I guess this needs an extensive review anyway.\n- I haven't rigorously checked the encoder and decoder performance. I tried to minimize the impact (some encodings are actually simpler than the original), but I'm not sure.\n\nFixes #2743, #9303 (partially) and #21482.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/22971/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/22971/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
