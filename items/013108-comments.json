[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38402755",
    "html_url": "https://github.com/rust-lang/rust/pull/13108#issuecomment-38402755",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13108",
    "id": 38402755,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDAyNzU1",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-03-24T00:09:04Z",
    "updated_at": "2014-03-24T00:09:44Z",
    "body": "Awesome work! (I'll review.)\n\n(Don't worry about the travis failure, it seems unrelated.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38402755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38419155",
    "html_url": "https://github.com/rust-lang/rust/pull/13108#issuecomment-38419155",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13108",
    "id": 38419155,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDE5MTU1",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-03-24T08:00:54Z",
    "updated_at": "2014-03-24T08:00:54Z",
    "body": "Looks pretty good; although I have some comments, and this needs some tests, [example](https://github.com/mozilla/rust/blob/2c7f3b850ce11c70d5bef2b2d5155a1f0fdaa421/src/test/compile-fail/lint-non-camel-case-types.rs); it should be a test that includes the for casts: structs, tuple structs, enums and struct enum variants, i.e.\n\n``` rust\n#[feature(struct_variants)];\n#[allow(dead_code)];\n#[deny(raw_pointer_deriving)];\n\n#[deriving(Clone)]\nstruct Foo {\n     x: *int //~ ERROR #[deriving] with raw pointer\n}\n\n#[deriving(Clone)]\nstruct Bar(*mut int); //~ ERROR #[deriving] with raw pointer\n\nenum Baz {\n     A(*int),  //~ ERROR #[deriving] with raw pointer\n     B { x: *mut int }  //~ ERROR #[deriving] with raw pointer\n}\nfn main() {}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38419155/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38433284",
    "html_url": "https://github.com/rust-lang/rust/pull/13108#issuecomment-38433284",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13108",
    "id": 38433284,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDMzMjg0",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-03-24T11:22:26Z",
    "updated_at": "2014-03-24T11:22:26Z",
    "body": "Oh something I just thought about: I guess this really needs to walk the types, not just look at their outer layers, e.g. the following should probably be warned about\n\n``` rust\nstruct Foo {\n    x: (*int, *uint)\n}\n```\n\nThis could be done by creating a new `Visitor` (\"visits\" the AST by walking the tree) just for this, like\n\n``` rust\nstruct RawPtrDerivingVisitor<'a> {\n     cx: &'a mut Context\n}\nimpl<'a> Visitor<()> for RawPtrDerivingVisitor<'a> {\n     fn visit_ty(&mut self, ty: &ast::Ty, _: ()) {\n           /* check `ty` is a TyPtr, if so, span_lint on this type */\n\n           // recurse, to walk the interiors of other types\n           visit::walk_ty(self, ty, ());\n     }\n     // explicit override to a no-op these to reduce code bloat\n     fn visit_expr(&mut self, e: &ast::Expr, _: ()) {}\n     fn visit_block(&mut self, e: &ast::Block, _: ()) {}\n}\n\nfn check_raw_ptr_deriving(cx: &mut Context, item: &Item) {\n     // ... do the attribute check ...\n     match item {\n          ItemStruct(..) | ItemEnum(..) => {\n               let mut visitor = RawPtrDerivingVisitor { cx: cx };\n               visit::walk_item(&mut visitor, item, ());\n          }\n     }\n}\n```\n\nThis has a few advantages:\n- firstly, it walks the types, so that the tuple example above will warn. \n- Secondly, If you look at the definition of the `Visitor` trait in `libsyntax/visit.rs` you can see that it's using default methods to call various `walk_...` functions. This means that the ones that we _don't_ override explicitly in the `impl` will have the definition from the trait, and hence will automatically manage iterating over fields and variants etc.\n\n(Sorry for changing to a completely different tack to the one I talked to you about on IRC. :( )\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38433284/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38531233",
    "html_url": "https://github.com/rust-lang/rust/pull/13108#issuecomment-38531233",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13108",
    "id": 38531233,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NTMxMjMz",
    "user": {
      "login": "pongad",
      "id": 1617025,
      "node_id": "MDQ6VXNlcjE2MTcwMjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1617025?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pongad",
      "html_url": "https://github.com/pongad",
      "followers_url": "https://api.github.com/users/pongad/followers",
      "following_url": "https://api.github.com/users/pongad/following{/other_user}",
      "gists_url": "https://api.github.com/users/pongad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pongad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pongad/subscriptions",
      "organizations_url": "https://api.github.com/users/pongad/orgs",
      "repos_url": "https://api.github.com/users/pongad/repos",
      "events_url": "https://api.github.com/users/pongad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pongad/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-03-25T05:03:31Z",
    "updated_at": "2014-03-25T05:03:31Z",
    "body": "@huonw I'll work on these the next time I have free time :D. By the way, if I have structs A and B, both of which contain struct X. Will X be visited once or three times (X itself, through A, then through B)? If ti's three times, we might get exponential run time... I don't know enough about Visitor to tell.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38531233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38533899",
    "html_url": "https://github.com/rust-lang/rust/pull/13108#issuecomment-38533899",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13108",
    "id": 38533899,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NTMzODk5",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-03-25T06:13:08Z",
    "updated_at": "2014-03-25T06:13:08Z",
    "body": "> By the way, if I have structs A and B, both of which contain struct X\n\nOh, sorry, I wasn't clear: it's just visiting the AST itself, not resolving the definitions and then visiting those too, so for something like\n\n``` rust\nstruct X { r: int }\n\nstruct A { s: X, t: *int }\nstruct B { u: Option<*uint>, v: X, w: A }\n```\n\nA visitor would, in order (sorry for the hard-to-read formatting, I've tried to write it to look like the tree of calls that the visitor would perform):\n- visit `X`\n  - visit the field `r` \n    - visit the type `int`, seeing a `TyPath` where the `Path` is `int`\n- visit `A`\n  - visit `s`\n    - visit `X`, seeing a `TyPath` where the `Path` is `X` \n  - visit `t`\n    - visit `*int`, seeing a `TyPtr(..)`\n- visit `B`\n  - visit `u`\n    - visit `Option<*uint>`, seeing a `TyPath` with a type parameter where the `Path` is `Option` \n      - visit `*uint`, seeing a `TyPtr(..)`\n  - visit `v`\n    - visit `X`, seeing a `TyPath` where the `Path` is `X` \n  - visit `w`\n    - visit `A`, seeing a `TyPath` where the `Path` is `A` \n\n(`enum`s are similar, except with an extra layer to visit each variant too.)\n\nThat is, the visitor only visits things written directly inline in the `struct` and `enum` definitions, _not_ \"following\" type signatures to see what they refer to. If one does want a visitor that follows definitions, one has to work out what the `Path`s are referring to manually. But...\n\nThe \"shallow-visiting\" is exactly what we want here: we assume that raw pointers that are \"hidden\" inside some other struct/enum definitions are managed by a correct `Clone`, `Eq`, ... implementation (and `#[deriving]` is just deferring to those implementations). It's only those `*` pointers exposed directly to `#[deriving]` that matter.\n\n(This new scheme does create a some rare false positives, for example:\n\n``` rust\n#[deriving(Clone)]\nstruct Foo {\n    x: Rc<*int>\n}\n```\n\nThe `clone` implementation for `Rc` _doesn't_ clone its interior, it just increases the reference count. I.e. one isn't actually touching the `*int` when calling `clone`. However, I think these will be sufficiently rare that people can just tell the compiler \"I know what I'm doing\" with an `#[allow(raw_pointer_deriving)]` attribute where necessary.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38533899/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38770286",
    "html_url": "https://github.com/rust-lang/rust/pull/13108#issuecomment-38770286",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13108",
    "id": 38770286,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NzcwMjg2",
    "user": {
      "login": "pongad",
      "id": 1617025,
      "node_id": "MDQ6VXNlcjE2MTcwMjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1617025?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pongad",
      "html_url": "https://github.com/pongad",
      "followers_url": "https://api.github.com/users/pongad/followers",
      "following_url": "https://api.github.com/users/pongad/following{/other_user}",
      "gists_url": "https://api.github.com/users/pongad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pongad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pongad/subscriptions",
      "organizations_url": "https://api.github.com/users/pongad/orgs",
      "repos_url": "https://api.github.com/users/pongad/repos",
      "events_url": "https://api.github.com/users/pongad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pongad/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-03-27T05:26:12Z",
    "updated_at": "2014-03-27T05:26:12Z",
    "body": "Fixed!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/38770286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
