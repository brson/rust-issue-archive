[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130207374",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-130207374",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 130207374,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDIwNzM3NA==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-12T07:53:06Z",
    "updated_at": "2015-08-12T07:53:06Z",
    "body": "So basically, with MSVC toolchain you are supposed to know whether you are going to be linking with a static lib or a dll version of the upstream library when compiling your crate.\n\nHere's some ideas that come to my mind:\n- Add attributes for marking up linking modes of extern crates (e.g. `#[link_dll] extern crate foo`).  \n  Cons: since this wart is unique to MSVC toolchain, it is unlikely that crate authors, who are not on Windows, will pay any attention to it.  Besides, sometimes you simply can't tell in advance whether you'll need to link with a dll.\n- Don't mark anything as `dllimport`\n  - Code refs: let the linker fix them  (extra jmp overhead in the case of dll library),\n  - Data refs: avoid imported data altogether.   Many Windows libraries take this approach using getter/setter functions where having exported data cannot be avoided.    Cons: same as above.\n- Mark all imported symbols as `dllimport`:\n  - Code refs: let the linker fix them (indirect call overhead for static libraries).\n  - Data refs: emit extra `_imp__foo = &foo` symbols into static libraries (linking succeeds, but adds the overhead of indirect access).\n- Since rustc knows which flavor of the library it it going to link, it could take bitcode saved in Rust crates for LTO, add `dllimport` attribute to the symbols that need it, then re-emit the object file.  \n  Cons: increases compilation time, won't work for staticlibs (since those are not necessarily linked via rustc)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130207374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130412549",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-130412549",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 130412549,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDQxMjU0OQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-12T19:00:39Z",
    "updated_at": "2015-08-12T19:00:39Z",
    "body": "I agree that strategies like `#[link_dll]` probably won't work out so hot, whatever we do probably needs to be baked into the compiler as much as possible instead of requiring annotations. \n\nI'm personally a bit up in the air about how to tackle this. I only know of one absolute failure mode today (#26591) and otherwise the drawbacks today are lots of linker warnings and some extra indirection (not so bad). In that sense it doesn't seem _incredibly_ urgent to tackle this, but it's certainly a wart!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130412549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130635772",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-130635772",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 130635772,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDYzNTc3Mg==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-13T11:47:00Z",
    "updated_at": "2015-08-13T11:47:00Z",
    "body": "Here's some links with useful information:\nUsing dllexport from static libs: https://support.microsoft.com/en-us/kb/141459\ndllimport/dllexport details: https://msdn.microsoft.com/en-us/library/aa271769%28v=vs.60%29.aspx\n#26591 is not specific to rust: http://blogs.msdn.com/b/oldnewthing/archive/2014/03/21/10509670.aspx\n\nLooks like you can use a module definition file to get the current strategy to at least work in all cases, although it wouldn't remove the unnecessary indirection.\n\nIn general it seems impossible to get best performance in all situations, unless you either have two sets of binaries for dynamic vs static linking (as microsoft does with the standard library), or always build from source, and use compiler flags to fine-tune its behaviour. Only cargo really exists at a high enough level to be able to do that automatically.\n\nIs there any danger of actual runtime unsafety here, eg. the msdn article implies that getting this wrong can result in code which uses the address of the constant getting the address of the import table instead?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130635772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130749285",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-130749285",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 130749285,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDc0OTI4NQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-13T16:21:27Z",
    "updated_at": "2015-08-13T16:21:27Z",
    "body": "@Diggsey that MSDN blog post is actually different than #26591 I believe, handling dllexport to the best of my knowledge is done 100% correctly now that #27416 has landed. The bug you referenced, #26591, has to do with applying `dllimport` to all imported statics, and if they're not actually imported via a DLL then the linker won't include the object file. It's kinda the same problem, but not precisely.\n\n> Is there any danger of actual runtime unsafety here, eg. the msdn article implies that getting this wrong can result in code which uses the address of the constant getting the address of the import table instead?\n\nI'm unaware of any impending danger, but which MSDN article were you referencing here? I'm under the impression that the linker fixes up references to functions automatically, and it apparently also fixes up dllimported statics to not use dllimport if not necessary.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130749285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130757389",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-130757389",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 130757389,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDc1NzM4OQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-13T16:50:21Z",
    "updated_at": "2015-08-13T16:50:21Z",
    "body": "@alexcrichton When attempting to link to some statics in the CRT directly from Rust, the code would link fine but the generated code was wrong. It would would follow the pointer to the static, but instead of accessing the static it then treated the static as another pointer and would segfault since the static wasn't supposed to be a pointer. I'm not sure whether this was the fault of `dllimport` or shoddy LLVM code generation or even rustc itself. We'll probably need some make tests covering all the possibilities.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/130757389/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131618713",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-131618713",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 131618713,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTYxODcxMw==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-16T20:38:59Z",
    "updated_at": "2015-08-16T20:40:20Z",
    "body": "The MS link's [behavior](https://github.com/rust-lang/rust/issues/26591#issuecomment-123513631) to require an object file to be chosen for linking before starting to auto-insert `__imp__` stubs for `dllimport'`ed symbols is pretty strange.  I could not find any mention of this on MSDN (which, hopefully, would explain the rationale), but I can confirm that it indeed works this way.\nManually inserting `__imp__foo = &foo` symbol into the static library, as I [proposed](https://github.com/rust-lang/rust/issues/27438#issuecomment-130207374) in option 3 above, fixed the case of data-only static lib, and seems to have no ill effects for dlls, so maybe that's the way to go?  \nHere's my test case:\n\n---\n\nStatic library:\n\n``` C\n__declspec(dllexport) int foo = 1;\nint* _imp__foo = &foo;\n\n__declspec(dllexport) int bar() { return 2; }\nvoid* _imp__bar = &bar;\n```\n\nMain executable:\n\n``` C\n__declspec(dllimport) int foo;\n__declspec(dllimport) int bar();\n\nint main()\n{\n    int f = foo;\n    int b = bar();\n    printf(\"%d %d\\n\", f, b);\n    return 0;\n}\n```\n\nIf you comment out both `_imp__foo` and `_imp__bar`, you'll end up with an \"unresolved external symbol\" link error.  Commenting out only one of them makes linking succeed with a warning.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131618713/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131629465",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-131629465",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 131629465,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTYyOTQ2NQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-16T21:36:39Z",
    "updated_at": "2015-08-16T21:36:39Z",
    "body": "@vadimcn That doesn't quite solve the issue if I need to link to statics from a library that I don't control, like a system library.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131629465/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131633919",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-131633919",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 131633919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTYzMzkxOQ==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-16T22:22:37Z",
    "updated_at": "2015-08-16T22:22:37Z",
    "body": "@retep998, Yeah, this only solves the problem for Rust crate writers.\nFor FFI we still might need some sort of `#[dllimport]`/`#[no_dllimport` attribute (depending on which is the default).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131633919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131637581",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-131637581",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 131637581,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTYzNzU4MQ==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-16T22:53:10Z",
    "updated_at": "2015-08-16T22:53:10Z",
    "body": "Actually, I wonder if we could we use the `#[link(kind=\"...\")]` attribute as a cue.  At first sight, it tells the compiler exactly what it needs to know - whether the library is static or a dll.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131637581/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131676502",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-131676502",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 131676502,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTY3NjUwMg==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-17T04:37:39Z",
    "updated_at": "2015-08-17T04:37:39Z",
    "body": "@vadimcn, @retep998 to solve that issue (needed to bootstrap with LLVM) the compiler now has a `#[linked_from]` attribute for extern blocks like so:\n\n``` rust\n#[linked_from = \"foo\"]\nextern {\n    // ...\n}\n```\n\nThis instructs the compiler that all the items in the block specified come from the native library `foo`, so dllexport and dllimport can be applied accordingly. The way that `foo` is linked in is determined by either `-l` flags or `#[link]` annotations elsewhere. \n\nNote that `#[linked_from]` is unstable right now as we'll probably want to think about the design a little more, but it should in theory provide the ability for the compiler to apply `dllimport` to all native library imports appropriately\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131676502/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131701450",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-131701450",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 131701450,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTcwMTQ1MA==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-17T07:03:39Z",
    "updated_at": "2015-08-17T07:03:39Z",
    "body": "@alexcrichton: I am confused about the purpose of `#[linked_from=...]`.  How is it different from `#[link(name=...)]`?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131701450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131866710",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-131866710",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 131866710,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTg2NjcxMA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-17T15:40:18Z",
    "updated_at": "2015-08-17T15:40:18Z",
    "body": "There's no connection between `#[link]`, `-l`, and a set of symbols. As a result we don't actually know where symbols in an `extern` block came from (e.g. what native library they were linked from). The `#[linked_from]` attribute serves to provide that connection\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131866710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131981558",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-131981558",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 131981558,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTk4MTU1OA==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-17T22:24:15Z",
    "updated_at": "2015-08-17T22:24:15Z",
    "body": "> There's no connection between #[link], -l, and a set of symbols...\n\nThis seems a bit bizarre.  `#[link]`'s can be placed only at `extern {}` blocks, so it would seem that they are associated with each other.  Why did we need a new attribute?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131981558/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131982673",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-131982673",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 131982673,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMTk4MjY3Mw==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-17T22:30:21Z",
    "updated_at": "2015-08-17T22:30:21Z",
    "body": "True, but they're [frequently](https://github.com/rust-lang/rust/blob/master/src/libstd/rtdeps.rs#L16-L18) [not](https://github.com/rust-lang/rust/blob/master/src/liblibc/lib.rs#L144-L147) [attached](https://github.com/rust-lang/rust/blob/master/src/libstd/rt/libunwind.rs#L102-L105) [to](https://github.com/rust-lang/rust/blob/master/src/libstd/sys/unix/backtrace.rs#L275-L277) [the](https://github.com/rust-lang/rust/blob/master/src/librustc_llvm/lib.rs#L601) [functions](https://github.com/rust-lang/rust/blob/master/src/liballoc_system/lib.rs#L75-L84) in question. It's pretty common to have a `#[link]` on an empty `extern` block which is actually affecting something somewhere else.\n\nMany of these could probably be fixed with the advent of `#[cfg_attr]`, but it doesn't solve the Cargo problem where most native libraries come from a `-l` flag to the compiler, where we _definitely_ don't have a connection from an arbitrary `-l` flag to an extern block and a set of symbols.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/131982673/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133317451",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-133317451",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 133317451,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMzMxNzQ1MQ==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-21T07:47:02Z",
    "updated_at": "2015-08-21T07:47:02Z",
    "body": "Here's my attempt at fixing the problem with data dllimports: vadimcn/rust@d5d7ac52dad980c041ab20b32c68871de0728402\nTODO: do this for windows targets only\nShould I also check that the symbol is in `reachable`?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133317451/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133519054",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-133519054",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 133519054,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMzUxOTA1NA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-21T18:15:00Z",
    "updated_at": "2015-08-21T18:15:00Z",
    "body": "@vadimcn isn't that basically just applying `dllexport` to all items? How would ensuring that `__imp_foo` exists help with dllimport?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133519054/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133523554",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-133523554",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 133523554,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMzUyMzU1NA==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-21T18:25:52Z",
    "updated_at": "2015-08-21T18:25:52Z",
    "body": "@alexcrichton I think the idea is that if you `dllimport` a static but the static is statically linked, and not coming from a DLL, the linker will look for `__imp_foo` and find it so that it works. Since making `__imp_foo` exist would only help when dynamically linking rust libraries, shouldn't we already have all the metadata when we link a rust library to determine whether `dllimport` is needed thus making that `__imp_foo` thing unnecessary? Really the big issue is telling Rust whether a symbol from a native library needs `dllimport` or not. When you link a native library on Windows it could have static statics or it could have dynamic statics, and there's no way for Rust to know which it is except through user added annotations.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133523554/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133531838",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-133531838",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 133531838,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMzUzMTgzOA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-21T19:02:29Z",
    "updated_at": "2015-08-21T19:02:29Z",
    "body": "Hm yeah I can see how that would solve our linkage problems (#26591), but I wouldn't consider it as closing this issue. There'd still be an extra level of indirection in many cases which we otherwise shouldn't have.\n\nWe also unfortunately don't have the information to determine whether to apply `dllimport` currently. That attribute can only be applied at code-generation time, and when we're generating an object file we don't actually know how it's going to end up getting linked. For example an rlib may be later used to link against an upstream dylib or an upstream rlib. This basically means that at code generation time we don't know the right set of attributes to emit.\n\nFor native libraries it'll certainly require user annotations, but that's what I was hoping to possibly stabilize the `#[linked_from]` attribute with at some point. \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133531838/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133550169",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-133550169",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 133550169,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMzU1MDE2OQ==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-21T20:22:28Z",
    "updated_at": "2015-08-21T20:33:49Z",
    "body": "@alexcrichton: I think `dllexport` only works when creating an actual dll.  The `__imp__` stubs go into the import library, which does not exist in the case of a Rust static library (.rlib).\n\nAs you mention above, the determination of whether to apply `dllimport` must be made at code generation time.   So if we want Rust crate linking to Just Work, we are going to have to accept some overhead (unless we use LTO bitcode to do some just-before-linking code generation, as I proposed in option 4.  But you didn't seem to like it too much).\n\nFor data, there isn't much choice, since marking `dllimport` is the only case that works for both static and dynamic linking.   Fortunately, public data is not common in Rust crates. \n\nFor code, we can choose between:\n- not marking with `dlimport`, and having an extra `jmp` when linking to a dll, or,\n- always marking with `dlimport`, and suffering from indirect calls when linking statically (actually, the linker is supposed to be smart enough to re-write these as direct calls + some `nop` padding, but I haven't seen MS linker actually do that).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133550169/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133552596",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-133552596",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 133552596,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMzU1MjU5Ng==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-21T20:36:30Z",
    "updated_at": "2015-08-21T20:36:44Z",
    "body": "For native libs, I think we should be able to use information from `#[link(kind=\"...\")]`?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133552596/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133562268",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-133562268",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 133562268,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMzU2MjI2OA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-08-21T20:58:16Z",
    "updated_at": "2015-08-21T20:58:16Z",
    "body": "Ah interesting! So the `foo.dll` doesn't actually have `__imp_foo` symbols, just the code in `foo.lib`? That... would make sense!\n\nI've toyed around with a few ideas to handle our `dllimport` problem, and we could in theory just start imposing more restrictions on consumers of rust libraries to solve this. Whenever an object file is generated the compiler would need to make a decision about whether it's linking statically or dynamically to upstream dependencies. The compiler knows what formats are available, and the only ambiguous case is when both are available. Once a decision is made, the decision is encoded into the metadata to ensure that future linkage against the upstream library always remains the same.\n\nThinking this through though in the past I've convinced myself that we'll run into snags. I can't quite recall them at this time, however. In theory though this would enable us to actually properly apply `dllimport` in all cases.\n\nAlso yeah, for native libraries we always precisely know how they're being linked (statically, dynamically, framework, etc), so this isn't a problem in their case. We just need to know what symbols come from what library and that's what `#[linked_from]` is serving as.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/133562268/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141204363",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141204363",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141204363,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTIwNDM2Mw==",
    "user": {
      "login": "tomaka",
      "id": 1412254,
      "node_id": "MDQ6VXNlcjE0MTIyNTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1412254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tomaka",
      "html_url": "https://github.com/tomaka",
      "followers_url": "https://api.github.com/users/tomaka/followers",
      "following_url": "https://api.github.com/users/tomaka/following{/other_user}",
      "gists_url": "https://api.github.com/users/tomaka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tomaka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tomaka/subscriptions",
      "organizations_url": "https://api.github.com/users/tomaka/orgs",
      "repos_url": "https://api.github.com/users/tomaka/repos",
      "events_url": "https://api.github.com/users/tomaka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tomaka/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-17T19:41:35Z",
    "updated_at": "2015-09-17T19:41:35Z",
    "body": "> Work on MSVC toolchain integration is ongoing, with full support (on 64-bit) shipping in the 1.4 beta today.\n\nIf the MSVC version is going to be stable/official in 1.4, this issue should probably be nominated!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141204363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141228320",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141228320",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141228320,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTIyODMyMA==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-17T21:05:58Z",
    "updated_at": "2015-09-17T21:06:37Z",
    "body": "Why can't we just work around the static problem?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141228320/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141520590",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141520590",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141520590,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTUyMDU5MA==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-18T17:59:58Z",
    "updated_at": "2015-09-18T17:59:58Z",
    "body": "We can, as I've shown above.  It's just gonna cost us some performance in the case of static linking.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141520590/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141528224",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141528224",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141528224,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTUyODIyNA==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-18T18:30:38Z",
    "updated_at": "2015-09-18T18:30:38Z",
    "body": "For me the issue is with system libraries where there simply is no work around at the moment except to not use that library at all.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141528224/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141753017",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141753017",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141753017,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTc1MzAxNw==",
    "user": {
      "login": "briansmith",
      "id": 16816,
      "node_id": "MDQ6VXNlcjE2ODE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/16816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/briansmith",
      "html_url": "https://github.com/briansmith",
      "followers_url": "https://api.github.com/users/briansmith/followers",
      "following_url": "https://api.github.com/users/briansmith/following{/other_user}",
      "gists_url": "https://api.github.com/users/briansmith/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/briansmith/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/briansmith/subscriptions",
      "organizations_url": "https://api.github.com/users/briansmith/orgs",
      "repos_url": "https://api.github.com/users/briansmith/repos",
      "events_url": "https://api.github.com/users/briansmith/events{/privacy}",
      "received_events_url": "https://api.github.com/users/briansmith/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-20T06:39:48Z",
    "updated_at": "2015-09-20T06:39:48Z",
    "body": "> We can, as I've shown above. It's just gonna cost us some performance in the case of static linking.\n\nA performance trade-off that hurts perf in the case of static linking in favor of improving things for dynamic linking seems like a terrible trade-off to me.\n\nWhy not \"just\" defer all code generation for these cases to link time, so that you know whether the thing is in a DLL or a static library when you generate the code? i.e. make opt builds LTO-only. For non-opt builds, you could do whatever performance-hurting thing is convenient.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141753017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141758155",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141758155",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141758155,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTc1ODE1NQ==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-20T08:27:30Z",
    "updated_at": "2015-09-20T08:27:35Z",
    "body": "@retep998 \n\nWon't a `extern \"C-dllimport\"` handle the native function case? Anyway, you can `extern` the `__imp` of a native dllimport function as a static function pointer.\n\n``` Rust\nextern {\n    #[link_name=\"__imp__foo\"]\n    static foo: extern \"C\" fn() -> u32;\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141758155/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141758319",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141758319",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141758319,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTc1ODMxOQ==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-20T08:32:37Z",
    "updated_at": "2015-09-20T08:32:37Z",
    "body": "@vadimcn \n\nThe default on Linux is the equivalent of never using `dllimport`. If we can take the overhead there, we can take it on Windows. A `#[dllimport]` tag would be nice for when it is measured to be important, however.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141758319/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141762709",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141762709",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141762709,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTc2MjcwOQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-20T09:29:07Z",
    "updated_at": "2015-09-20T09:29:07Z",
    "body": "@arielb1 For functions it doesn't really matter. Whether we specify `dllimport` or not, functions will always work, albeit with a slight penalty if we get it wrong.\n\nIt is statics which are the real problem. Because if you forget to specify `dllimport` it just doesn't work, and if you unnecessarily specify `dllimport` then if the library only contains statics it also won't work. For statics there are two uses cases at the moment:\n1. Statics across Rust library boundaries. I statically link to some Rust library, I use a few functions and types, all of which get monomorphized or inlined such that at link time no functions end up being referenced from the original library. One of those functions happened to use a string literal. Suddenly I have a dependency on a static, but since Rust applies `dllimport` indiscriminately, it breaks. Yes, I ran into this situation several times myself, it is entirely possible to run into even if your library never exposes any statics as part of its API.\n2. I have a system library, perhaps `uuid.lib`. It is full of statics, and no functions. If I try to link to any of them, Rust applies `dllimport` indiscriminately and it breaks.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141762709/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141781699",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141781699",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141781699,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTc4MTY5OQ==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-20T12:04:02Z",
    "updated_at": "2015-09-20T15:30:21Z",
    "body": "Please don't leave it as it is and apply `dllimport` everywhere (or apply it nowhere), and then leaving it to the linker to fix things up (and forcing it to do so by e.g. exporting a stub function from each dependency and importing it).\n\nWould it be possible to \n1. not apply `dllimport` by default, make it an attribute; and\n2. have `cargo` figure out what dependencies will ultimately be linked dynamically and then tell `rustc` this e.g.\n\n<pre>--<b>dynamic</b>extern dependencyname=C:\\path\\to\\dep</pre>\n\nwhich would mean that\n1. Win32-specific code gets to import Win32 libraries fine; and\n2. non-Win32 crate writers don't have to care since `cargo` should figure it out for them?\n\nIt should be OK to add in a check [where `dllimport` is currently applied](https://github.com/rust-lang/rust/blob/master/src/librustc_trans/trans/base.rs#L220). \n\nThis is different from the commit a0efd3a3d99a98e3399a4f07abe6a67cf0660335 that was reverted in that this depends on `cargo`, or the thing invoking `rustc`, to tell it what each `extern` will finally be linked as (or to be specific, tell `rustc` if any crates are going to be dynamically linked) &mdash; instead of depending on [some heuristics](https://github.com/rust-lang/rust/blob/master/src/librustc/middle/dependency_format.rs) to guess.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141781699/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141816628",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141816628",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141816628,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTgxNjYyOA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-20T18:10:32Z",
    "updated_at": "2015-09-20T18:10:32Z",
    "body": "Sorry for the long response in advance, but this is a tricky topic! The tl;dr; is that I have some ideas of how to solve this, but they haven't been fully fleshed out yet. I don't think the fix for this will be easy.\n\n---\n\n@retep998\n\n> For me the issue is with system libraries where there simply is no work\n> around at the moment\n\nFrom what @vadimcn has done, shouldn't it be possible to reference the `__imp`\nsymbols to be referenced manually? You'd have to manually encode the extra layer\nof indirection, but it should be _possible_, right?\n\nAlso, out of curiosity, does the `#[linked_from]` attribute work for you? We\ncould look into stabilizing it this cycle if it looks like it's worth it\n\n---\n\n@briansmith\n\n> Why not \"just\" defer all code generation for these cases to link time\n\nUnfortunately this doesn't fit too well into the model the compiler has today,\nand while possible I'd prefer to not bend too far backwards just to fix small\ncorner cases like this.\n\n---\n\n@arielb1\n\n> Won't a `extern \"C-dllimport\"` handle the native function case?\n\nUnfortunately this suffers a similar problem [as mentioned\nabove](https://github.com/rust-lang/rust/issues/27438#issuecomment-131866710),\nas the author of a library you don't always know where the symbols are coming\nfrom. This decision is often made by whomever is building the library, in which\ncase encoding this kind of ABI information into the source can be cumbersome and\nrequire duplicate definitions (one for with dllimport one for without).\n\nAdditionally, [also as mentioned\nabove](https://github.com/rust-lang/rust/issues/27438#issuecomment-131676502),\nfor external libraries the unstable `#[linked_from]` attribute should suffice,\n  the only remaining problem is dealing with Rust crates.\n\n> The default on Linux is the equivalent of never using `dllimport`.\n\nThis is actually because `dllimport` only has meaning on Windows. The linker and\ndynamic linker work differently on Unix where the compiler never has to make a\ndecision about where a symbol is coming from, those two just magically make\neverything work \"as fast as possible\" in all cases.\n\nIn that sense, we're not actually taking a hit on Unix today, and I agree with\n@briansmith that we shouldn't cater to the dynamic linking case of Rust crates\nbecause that basically never happens.\n\n---\n\n@angelsl\n\n> Please don't leave it as it is\n\nI agree! That's what this issue is about :)\n\n> 1. not apply dllimport by default, make it an attribute; and\n\nMaking dllimport an attribute suffers from a number of ergonomic concerns\n(discussed elsewhere on this issue), so I'd prefer to avoid a manual opt-in for\ndllimport.\n\n> 1. have cargo figure out what dependencies will ultimately be linked\n>    dynamically and then tell rustc this e.g.\n\nThe compiler doesn't really need much more information than what it has today\nactually, so there's probably not much that needs to be done on the Cargo side\nof things.\n\n---\n\nHere's my thinking on solving this issue:\n- Deciding whether to place `dllimport` on symbols imported from native\n  libraries is handled via `#[linked_from]`\n- Deciding whether to place `dllimport` on symbols imported from Rust libraries\n  is the sticky point.\n\nOne aspect of the compiler today is that it produces one object file which can\nthen be \"linked\" into multiple output formats. This consequently means that the\nsame object file is used to produce both an rlib and a dylib if that is\nrequested. The compiler _also_ understands that upstream Rust libraries can be\navailable in one of two forms (dylib or rlib). For each output type of the\ncompiler it must calculate what format of upstream library is being used to\nproduce the output.\n\nSo, given this background, the compiler must now answer the question that for\nany particular symbol it references from an upstream crate, does it apply\n`dllimport` or not? Calling the upstream crate A, here's my thinking of how to\nanswer this question:\n1. For all output types, if A is forced to be linked dynamically, then apply\n   `dllimport`.\n2. For all output types, if A is forced to be linked statically, don't apply\n   `dllimport`.\n3. If A is forced to be dynamic in one output type and static in another an\n   error is emitted saying that the compiler should be called twice instead of\n   once.\n\nAt this point there's only one possible situation for the compiler, we're\nemitting an rlib and only an rlib. Generating a binary, dylib, or staticlib will\nforce linkage one way or another, so we would have made our decision via one of\nthe metrics above first.\n\nI think it's a safe to say that the compiler can assume that the set of output\nartifacts will not change over time for the current compilation, so now we're\nfaced with a refinement of our original question: for a compilation that is\ngenerating only an rlib, should symbols referencing A be tagged with dllimport\nor not?\n1. If A is only available upstream as a dylib, `dllimport` is applied.\n2. If A is only available in an rlib format, `dllimport` is not applied. In\n   theory some subset of upstream dependencies (including A) could be later\n   assembled into a dylib and then that goes into the final link step (hence\n   we'd need `dllimport` but we forgot it), but I think it's safe to say this\n   doesn't happen.\n3. A is available in both formats, so it's up to the compiler to choose. I would\n   propose reading `-C prefer-dynamic`, emitting `dllimport` if it's passed or\n   not if it's not.\n\nAlright, so once we've gotten this far we've answered the question of whether to\napply `dllimport` or not. This information also is then encoded into the\nmetadata to prevent link errors from later happening, specifically if an rlib is\ngenerated to link statically against an upstream rlib, it must _always_ be\nlinked statically against that rlib instead of having some intermediate dylib\nassembled at some point. Note that this could generate some weird errors in some\nsituations, but this should generally be solved by compiling everything as rlibs\nor everything as dylibs.\n\n---\n\nThe problem with the thinking above is that it unfortunately doesn't work! The\ncrucial part where it falls down is at the very end where the compiler has an\nupstream library available in two formats and no other constraints (e.g.\ngenerating an rlib) so it arbitrarily selects one output type. Consider a\nsituation like this:\n- Executable A depends on B and plugin C\n- Crate C also depends on B.\n\nGiven this setup, when you run `cargo build` inside project A it will only build\nB once, making some decisions about linkage. The executable A, however, should\nbe statically linked so B can't have `dllimport` pointing at the standard\nlibrary. The plugin C, however, must link the standard library dynamically so\nB must have `dllimport` pointing at the standard library.\n\nBasically, when building B, the compiler made a choice which was then later\nincorrect, but unfortunately the compiler can't make a choice here as whichever\nit chooses is incorrect.\n\nI _think_ that this may be one of the only failure scenarios, I at least haven't\nbeen able to come up with any others just yet. There are various options for\nsolving this (e.g. just generate two object files and postprocess later), but in\nthe interest of keeping the MSVC-specific logic to a minimum I'd prefer to not\ntake routes like that. Unfortunately it may be inevitable, however.\n\nRegardless, though, this is my thinking on this issue today! I've so far thought\nthat this issue is relatively rare in practice (e.g. a lib with only statics\ndoesn't seem that common) but I have a feeling it may start cropping up more\noften.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141816628/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141833629",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141833629",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141833629,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTgzMzYyOQ==",
    "user": {
      "login": "briansmith",
      "id": 16816,
      "node_id": "MDQ6VXNlcjE2ODE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/16816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/briansmith",
      "html_url": "https://github.com/briansmith",
      "followers_url": "https://api.github.com/users/briansmith/followers",
      "following_url": "https://api.github.com/users/briansmith/following{/other_user}",
      "gists_url": "https://api.github.com/users/briansmith/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/briansmith/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/briansmith/subscriptions",
      "organizations_url": "https://api.github.com/users/briansmith/orgs",
      "repos_url": "https://api.github.com/users/briansmith/repos",
      "events_url": "https://api.github.com/users/briansmith/events{/privacy}",
      "received_events_url": "https://api.github.com/users/briansmith/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-20T20:57:18Z",
    "updated_at": "2015-09-20T20:57:18Z",
    "body": "You know more about this than me, so I won't argue with you about the need to support non-LTO release mode. My point is really that if it only worked in debug mode and LTO mode, that would be OK with me, and probably a lot of other people who also don't use the non-LTO release mode.\n\nThe important thing to me is that in the case of static linking in LTO builds, there should be no overhead; i.e. Rust's zero-cost abstraction principle should apply here too. Obviously, for debug builds, extra overhead is not such a big deal, since that's the point of the debug builds.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141833629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141843379",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141843379",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141843379,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTg0MzM3OQ==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-20T22:58:19Z",
    "updated_at": "2015-09-20T22:58:19Z",
    "body": "The moment you want to mix static and dynamic linking you're in for a whole lot of trouble &mdash; not just on Windows/MSVC. ... You might get two different copies of singletons, for example. I also remember someone running into trouble with jemalloc because of this &mdash; the solution was to link std dynamically for both the plugin consumer and the plugin so we don't have multiple copies of std.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141843379/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141843519",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141843519",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141843519,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTg0MzUxOQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-20T23:01:11Z",
    "updated_at": "2015-09-20T23:01:11Z",
    "body": "@briansmith I want to be able to use release mode without LTO due to LTO being annoyingly slow in Rust at the moment. Maybe if Rust got something like the incremental LTCG in recent versions of msvc, then it would be a possibility, but not at the moment.\n\n@alexcrichton If `#[linked_from]` can do what I need in stable Rust, then that's good enough for me. Just don't make it stable until I can confirm it actually works.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141843519/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141869986",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141869986",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141869986,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTg2OTk4Ng==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-21T03:46:36Z",
    "updated_at": "2015-09-21T03:54:39Z",
    "body": "@alexcrichton \n\n> The problem with the thinking above is that it unfortunately doesn't work! The\n> crucial part where it falls down is at the very end where the compiler has an\n> upstream library available in two formats and no other constraints (e.g.\n> generating an rlib) so it arbitrarily selects one output type. Consider a\n> situation like this:\n> - Executable A depends on B and plugin C\n> - Crate C also depends on B.\n> \n> Given this setup, when you run `cargo build` inside project A it will only build\n> B once, making some decisions about linkage. The executable A, however, should\n> be statically linked so B can't have `dllimport` pointing at the standard\n> library. The plugin C, however, must link the standard library dynamically so\n> B must have `dllimport` pointing at the standard library.\n> \n> Basically, when building B, the compiler made a choice which was then later\n> incorrect, but unfortunately the compiler can't make a choice here as whichever\n> it chooses is incorrect.\n\nAbout plugins.\n\nThe ideal scenario would be to have A, B and C all link dynamically &mdash; the moment you have dynamic plugins, trying to mix statically linked libraries in will just give you hell, again, with multiple copies of libraries (including static fields, and especially singletons).\n\nI remember someone running into a segfault when they had a dylib that had `std` statically linked that is loaded by a main executable that also has `std` statically linked. One of them passed a string over to the other and then it was dropped, and since the two have their own allocators of course the `free` segfaulted.\n\nThere are a few choices if dynamically linking `std` for everything isn't an option.\n- We can link `std` statically to the main executable and make all plugins link to that. But then we'd have to stuff the whole `std` into the main executable because we don't know what from `std` plugins might be using. And all the plugins' dependencies would have to be made to link this way too. Bad.\n- We can link `std` statically to the main executable and have plugins link `std` dynamically (this is what you were describing). But then we have two copies of `std` again. Bad. You don't run into `free` issues on Windows/MSVC though because MSVC uses the system allocator.\n\nSo really the only way to safely have dynamically loaded plugins is to link everything, well, dynamically.\n\n---\n\nBut OK, to answer the problem, if we really have the scenario you describe, based on what you said above: \n\n> - Executable A depends on B (statically linked to `std`) and plugin C\n> - Crate C also depends on B (dynamically linked to `std`).\n\nCargo should treat the static and dynamic Bs as separate and compile them twice. I don't think there is really any other option.\n\n(Ideally, the compiler should also barf when it is told to link A to a dynamic B and vice versa, but of course it won't know that the compiled B rlib is dynamically linked to `std`.)\n\nBut again I really don't like the idea of linking `std` to A statically and then to C dynamically, or even having two copies of B linked to both A and C. Bad bad bad bad bad.\n\n---\n\n> > - not apply dllimport by default, make it an attribute; and\n> \n> Making dllimport an attribute suffers from a number of ergonomic concerns\n> (discussed elsewhere on this issue), so I'd prefer to avoid a manual opt-in for\n> dllimport.\n\nA `dllimport` attribute is essentially the same as the `linked_from` thing we have now, just more explicit.\n\n> > - have cargo figure out what dependencies will ultimately be linked dynamically and then tell rustc this e.g.\n\nCombining `dllimport` with this will make ergonomics a non-issue, because crates that need to be `dllimport`ed will be. Things like Win32 will have to be annotated anyway.\n\nBut my solution has the same problem anyway, that if different dependencies depend on a common dependency in different ways (one dynamic, one static) then they need to be compiled twice anyway.\n\nAlthough to be honest, I don't see why we should have, in the same crate, some things linked dynamically and some statically.\n\nIf the dynamically-linked things were real plugins, they should be in a separate crate. If they are not real plugins (as in you cannot drop in a different version, etc) then why dynamically link them?\n\n> The compiler doesn't really need much more information than what it has today\n> actually, so there's probably not much that needs to be done on the Cargo side\n> of things.\n\nFair enough.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141869986/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141889053",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141889053",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141889053,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTg4OTA1Mw==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-21T06:29:46Z",
    "updated_at": "2015-09-21T06:30:54Z",
    "body": "@alexcrichton (and others): _are you sure_  this is something worth optimizing?  \nIf indirect call/variable access is in a tight loop, the compiler will hoist address load out of the loop.  And if it isn't in a loop...\n\nI suggest we implement the option that always works (i.e. inject `_imp__<symbol>` stubs into static libraries) and call it a day.  Ok, maybe we can also open an `I-wishlist` issue to implement 100% correct `dllimport` placement logic during LTO builds.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141889053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141890945",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141890945",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141890945,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTg5MDk0NQ==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-21T06:33:10Z",
    "updated_at": "2015-09-21T06:33:10Z",
    "body": "Oh, forgot about linking to extern libs.  Yes, that's something we should fix.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141890945/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141892292",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141892292",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141892292,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTg5MjI5Mg==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-21T06:48:09Z",
    "updated_at": "2015-09-21T06:48:09Z",
    "body": "@vadimcn \n\nIf we're going to support MSVC, might as well do it right.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141892292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141924107",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141924107",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141924107,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTkyNDEwNw==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-21T09:31:27Z",
    "updated_at": "2015-09-21T09:31:27Z",
    "body": "@alexcrichton \n\n> This is actually because dllimport only has meaning on Windows. The linker and\n> dynamic linker work differently on Unix where the compiler never has to make a\n> decision about where a symbol is coming from, those two just magically make\n> everything work \"as fast as possible\" in all cases.\n\nThat's not entirely accurate. dllimport is a _compiler_ attribute. Accesses to non-dllimport constants are direct accesses, while calls to dllimport constants are indirect accesses, via the equivalent of a GOT. Calls to non-dllimport functions are direct calls, which are resolved either to the real function (if it is in the same DLL) or the equivalent of a PLT stub, and calls to dllimport functions are indirect calls.\n\nCross-library constants are required to be dllimport, because you can't have a PLT stub for a constant. In Linux, all constants are \"dllimport\" (accessed via GOT) because of `LD_PRELOAD`.\n\nAnyway, I think inserting a dummy function reference to make the linker create the \"GOT\", or even creating it ourselves, would be the right fix. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141924107/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141931925",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-141931925",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 141931925,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MTkzMTkyNQ==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-21T10:08:34Z",
    "updated_at": "2015-09-21T12:36:21Z",
    "body": "@arielb1 \n\n> Anyway, I think inserting a dummy function reference to make the linker create the \"GOT\", or even creating it ourselves, would be the right fix.\n\nThis solution tries to ignore how MSVC works and relies on `LINK` to fix up our incorrect imports (which it doesn't at all have to do!).\n\nPlease don't work around the problem like this, we really should just decorate the correct imports correctly.\n\nWindows itself works similarly to Linux; they both have some sort of import table in the executable header which is linked at runtime by some dynamic linker (the kernel in Windows, and some library defined in the ELF header in Linux).\n\nIt's just MSVC that insists on linking through an import library and `__imp_` and all .. :sob:\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/141931925/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142064942",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142064942",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142064942,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjA2NDk0Mg==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-21T18:14:05Z",
    "updated_at": "2015-09-21T18:14:05Z",
    "body": "@angelsl \n\nIn Linux, all statics are linked \"by dllimport\". Linux linkers (that's binutils' `ld`, not libc's `ld-linux`) always automatically generate the local equivalent of `__imp_` - there are no import libraries at all!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142064942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142069157",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142069157",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142069157,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjA2OTE1Nw==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-21T18:31:47Z",
    "updated_at": "2015-09-21T18:59:56Z",
    "body": "Here's a summary of the current problems with linking `uuid.lib` in `uuid-sys`. It is a library full of static statics, aka there is no associated DLL. If `dllimport` is specified for those statics then `link.exe` fails to resolve the symbols and it breaks.\n\nOne proposed solution is to use `#[linked_from = \"uuid\"]` and specify `static=uuid` when linking it, but lo and behold, apparently specifying the kind to static causes rustc to attempt to shove the `.lib` into the `.rlib` which is 1. completely wrong and not what I want and 2. fails because I apparently didn't tell `rustc` where `uuid.lib` is even though it is `rustc`'s job to find where `uuid.lib` is when it invokes the linker due to that library being provided by the Windows SDK. Basically `static=foo` and `dylib=foo` are being used to control whether to bundle `foo.lib` or just pass the name along to the linker at link time, and is thus entirely orthogonal and unrelated to this discussion.\n\nThe only thing `rustc` needs to know about a symbol is whether to apply `dllimport` to that symbol or not, and a list of `.lib` files which it should pass on to the linker (`link.exe`). The linker in turn figures out which symbol goes to which `.lib` file, Rust does _not_ need to know about that.\n\nSo what I need is an attribute to specify whether a symbol is `dllimport` or not. That's it. That will solve the native library problem entirely. There is no way Rust can figure it out automatically. I _know_ whether to emit `dllimport` so let me pass that information on to Rust so Rust can pass it on to the linker!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142069157/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142087038",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142087038",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142087038,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjA4NzAzOA==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-21T19:36:16Z",
    "updated_at": "2015-09-21T19:36:16Z",
    "body": "Okay, did some digging and investigating and found this.\n\nWe don't apply dllimport to extern statics. What we actually do is apply `dllimport` to statics when we define them in one Rust library and use them from another Rust library. So by virtue of other crates referencing statics defined in `uuid-sys`, so going across a boundary from one Rust library to another, Rust emits `dllimport`. If I define and use an extern static all within the same crate, then no Rust library boundary is crossed, and no `dllimport` is applied. This is very weird behavior and is probably a bug.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142087038/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142132094",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142132094",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142132094,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjEzMjA5NA==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-21T22:58:23Z",
    "updated_at": "2015-09-22T01:49:28Z",
    "body": "@arielb1 \n\nI don't believe Linux goes through the GOT if you statically link things together. That would be quite terrible. (And worse if it's Rust specifically that does that!)\n\nMy issue with emitting a dummy function call so the linker fixes it all up for us is that \n1. That's not how it's supposed to be done!\n2. Now we get a double penalty on imported functions too, since (AFAIK) the linker now generates a shim which _then_ jumps to the function pointer in the IAT.\n3. And the worst is that with the current default _static linking is the one impacted_, because we `dllimport` everything even when we are linking everything dynamically. But from what you've been saying it seems like Rust does the equivalent of that on Linux (I hope not. I'll take a look myself.)..\n\nBut even if Linux does it, doesn't mean we should do it on Windows because again, _that's not how it's supposed to be done_. If Rust wants to support MSVC, it should _support MSVC_ and not try to work around how it works\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142132094/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142147500",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142147500",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142147500,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjE0NzUwMA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T00:39:00Z",
    "updated_at": "2015-09-22T00:39:00Z",
    "body": "@angelsl \n\nAh I think I wasn't clear enough in my scenario, the compiler certainly has quite a bit of logic (and I completely agree) that the same library should never appear twice in a process (e.g. statically in two separate modules). The \"plugin\" I mentioned was a compiler plugin, not a plugin to the executable being built. For example C and B needed to dynamically link to std because they're going to be dynamically opened up by the compiler, but A needs to statically link to std because that's how executables are linked by default. This means that B needs to be both statically and dynamically linked to std with the same object file, which is obviously problematic.\n\nI'm not sure if the best solution is to compile B twice. It's certainly _a_ solution but it would involve pretty invasive changes to Cargo and has a high risk of not being backwards compatible in one way or another. If we could find a solution that penalized dynamic linking perhaps but not static linking, I'd be perfectly fine with that because plugins aren't super-duper-stable today anyway.\n\n---\n\n@vadimcn \n\n> are you sure this is something worth optimizing?\n\nAn excellent question! One to which I do not have a concrete answer :). On one side of things I agree with @briansmith and @angelsl that we should really be doing the \"right thing\" here rather than working around issues. On the other hand, however, if this is a real pain point then it's certainly the fastest thing to accept your patch for now. On both hands, however, I do think it'd be certainly nice to get data on what kind of numbers we're talking about here.\n\nI think the way to fix the extern libs issue is to basically start leveraging `#[linked_from]` and then stop blanket applying `dllimport` everywhere as a result (only do it on a targeted basis for `#[linked_from]`).\n\n---\n\n@retep998 \n\n> So what I need is an attribute to specify whether a symbol is dllimport or not. That's it. That will solve the native library problem entirely. There is no way Rust can figure it out automatically.\n\nUnfortunately while this may work for your particular situation it doesn't solve the problem in general. Libraries mostly do not know where their native symbols are coming from (e.g. from a dylib or statically) because build scripts can be overridden and swapped out. For example Cargo depends on libssh2 but if it were packaged in a Windows package manager it'd want to link dynamically to libssh2 instead of statically, meaning there's no way for libssh2 itself to encode whether dllimport is applied or not.\n\nIn general I agree that it's nice to have an escape hatch, but the goal here is to add as few attributes as possible while solving as many use cases as we can find. Your use case with `uuid.lib` will be fixed once the compiler starts not blanket-applying `dllimport` to all statics. The only reason the compiler should ever apply `dllimport` is:\n- An upstream symbol from a dylib in a Rust crate is referenced.\n- A symbol from a native library is referenced with a corresponding `#[linked_from]` connecting it to a dylib.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142147500/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142159128",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142159128",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142159128,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjE1OTEyOA==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T02:02:52Z",
    "updated_at": "2015-09-22T02:02:52Z",
    "body": "@alexcrichton \n\nWouldn't that still end up having two copies of std? Any static fields in std are going to have two copies, one in the executable and one in the dynamically loaded copy..\n\nI'll go and compile some DLLs with and without `dllimport` using MSVC C, MinGW C and GCC C on Linux and compare it to MSVC, MinGW Rust and Rust on Linux, and see what the overhead really is (I guess it's just one extra jump?)\n\nIt would be great if we could have a solution that handled it all properly, but if the solution we pick penalises dynamic linking _only_ for the case where we have some crate as a dependency of both a statically-linked crate and dynamically-linked crate, then it shouldn't be too bad.\n\nBut honestly it would suck if we do that and it lives on forever. Whatever fix we apply now will affect people who use it in the future, and it would be really bad if this ends up being one of those quirks that people are confused about when they encounter it, then they go and ask on like Stack Overflow, and the answer refers to this very issue on GitHub and tells the asker to \"don't do this\".\n\nThat's why I think barring having to totally rewrite parts of Cargo/rustc, it would be worth it to fix it properly. Because if we use a hackfix now, it's going to stay.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142159128/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142177864",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142177864",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142177864,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjE3Nzg2NA==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T04:15:29Z",
    "updated_at": "2015-09-22T04:16:03Z",
    "body": "Something interesting. Not sure if you all already knew this, but I'll just put it here anyway.\n\nMSVC does _not_ complain if I compile a C file that links to something from a DLL without `dllimport`. `LINK` only complains if I compile a C file that imports something from itself.\n\n#### dll.c\n\nCompile with `cl /Ox /c dll.c`. Link with `link /dll dll.obj`.\n\n```\n__declspec(dllexport) char* externstring() {\n    return \"Hello!\";\n}\n```\n\n#### exe.c\n\nCompile with `cl /Ox /c exe.c`. Link with `link dll.lib exe.obj`.\n\n```\n#include <stdio.h>\n\n/* __declspec(dllimport) */ char* externstring();\n\nint main() {\n    puts(externstring());\n    return 0;\n}\n```\n\n#### Results\n\n```\nC:\\Users\\angelsl\\Root\\Development\\rust\\test>cl /Ox /c exe.c\nMicrosoft (R) C/C++ Optimizing Compiler Version 19.00.23026 for x64\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\nexe.c\n\nC:\\Users\\angelsl\\Root\\Development\\rust\\test>cl /Ox /c dll.c\nMicrosoft (R) C/C++ Optimizing Compiler Version 19.00.23026 for x64\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\ndll.c\n\nC:\\Users\\angelsl\\Root\\Development\\rust\\test>link /dll dll.obj\nMicrosoft (R) Incremental Linker Version 14.00.23026.0\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\n   Creating library dll.lib and object dll.exp\n```\n\n`dll.lib` has both `externstring` and `__imp_externstring`.\n\n```\nC:\\Users\\angelsl\\Root\\Development\\rust\\test>dumpbin /all dll.lib\nMicrosoft (R) COFF/PE Dumper Version 14.00.23026.0\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\n\nDump of file dll.lib\n\nFile Type: LIBRARY\n\nArchive member name at 8: /\n5600D352 time/date Tue Sep 22 12:04:34 2015\n         uid\n         gid\n       0 mode\n      7E size\ncorrect header end\n\n    5 public symbols\n\n      186 __IMPORT_DESCRIPTOR_dll\n      3A0 __NULL_IMPORT_DESCRIPTOR\n      4D2 \u007fdll_NULL_THUNK_DATA\n      624 __imp_externstring\n      624 externstring\n<snip>\n```\n\nLinking works fine even though `dllimport` was not specified.\n\n```\nC:\\Users\\angelsl\\Root\\Development\\rust\\test>link exe.obj dll.lib\nMicrosoft (R) Incremental Linker Version 14.00.23026.0\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\n\nC:\\Users\\angelsl\\Root\\Development\\rust\\test>exe\nHello!\n```\n\n`exe.obj` references _only_ `externstring`.\n\n```\nC:\\Users\\angelsl\\Root\\Development\\rust\\test>dumpbin /all exe.obj\nMicrosoft (R) COFF/PE Dumper Version 14.00.23026.0\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\nDump of file exe.obj\n<snip>\nRELOCATIONS #3\n                                                Symbol    Symbol\n Offset    Type              Applied To         Index     Name\n --------  ----------------  -----------------  --------  ------\n 00000005  REL32                      00000000         9  externstring\n 0000000D  REL32                      00000000         8  puts\n<snip>\n```\n\nIf I declare the import as `dllimport`, then `exe.obj` will reference `__imp_externstring`. (Uncomment the commented block in `exe.c`).\n\n```\nC:\\Users\\angelsl\\Root\\Development\\rust\\test>cl /Ox /c exe.c\nMicrosoft (R) C/C++ Optimizing Compiler Version 19.00.23026 for x64\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\nexe.c\n\nC:\\Users\\angelsl\\Root\\Development\\rust\\test>dumpbin /all exe.obj\nMicrosoft (R) COFF/PE Dumper Version 14.00.23026.0\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\nDump of file exe.obj\n\nFile Type: COFF OBJECT\n<snip>\nRELOCATIONS #3\n                                                Symbol    Symbol\n Offset    Type              Applied To         Index     Name\n --------  ----------------  -----------------  --------  ------\n 00000006  REL32                      00000000         9  __imp_externstring\n 0000000E  REL32                      00000000         8  puts\n<snip>\n```\n\nLinking works the same as above &mdash; linking to `dll.lib`. No new output.\n\nNow instead of linking to `dll.lib` for a dynamic link, I link to `dll.obj`, which would be a static link. We get the familiar warning.\n\n```\nC:\\Users\\angelsl\\Root\\Development\\rust\\test>link exe.obj dll.obj\nMicrosoft (R) Incremental Linker Version 14.00.23026.0\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\n   Creating library exe.lib and object exe.exp\nexe.obj : warning LNK4217: locally defined symbol externstring imported in function main\n```\n\nI'll do a disassembly of the executables produced in a bit, to see what kind of indirection is produced by not having `dllimport` and by `dllimport`ing a local symbol.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142177864/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142179271",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142179271",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142179271,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjE3OTI3MQ==",
    "user": {
      "login": "briansmith",
      "id": 16816,
      "node_id": "MDQ6VXNlcjE2ODE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/16816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/briansmith",
      "html_url": "https://github.com/briansmith",
      "followers_url": "https://api.github.com/users/briansmith/followers",
      "following_url": "https://api.github.com/users/briansmith/following{/other_user}",
      "gists_url": "https://api.github.com/users/briansmith/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/briansmith/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/briansmith/subscriptions",
      "organizations_url": "https://api.github.com/users/briansmith/orgs",
      "repos_url": "https://api.github.com/users/briansmith/repos",
      "events_url": "https://api.github.com/users/briansmith/events{/privacy}",
      "received_events_url": "https://api.github.com/users/briansmith/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T04:26:57Z",
    "updated_at": "2015-09-22T04:26:57Z",
    "body": "> On one side of things I agree with @briansmith and @angelsl that we should really be doing the \"right thing\" here rather than working around issues.\n\nThat's not really what I meant. What are the negative side effects of the proposed patch? I think it is good to make incremental progress. My code depend a lot on inter-crate references to statics, and I've not been affected by the issues motivating a change here. I doubt my usage is atypical. So, it seems unreasnable to pay a perf or size penalty for a workaround. But, if there's no perf/size penalty then I think a temporary workaround is OK.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142179271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142188971",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142188971",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142188971,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjE4ODk3MQ==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T06:14:49Z",
    "updated_at": "2015-09-22T06:14:49Z",
    "body": "@alexcrichton: I am not sure what is the right thing to measure here.  But I did a bit of micro-benchmarking, and found that in a tight loop:\n- an indirect memory read is ~1.8x more expensive than a direct one,\n- an indirect call is ~1.3x more expensive than a direct one, and\n- a call followed by an indirect jump is ~1.3x more expensive than an indirect call.\n\n(If address load is hoisted out of the loop, the difference between direct and indirect loads/calls vanishes.)\nMind you, these are comparisons of _just those specific instruction sequences_ with loop overhead subtracted.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142188971/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142237011",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142237011",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142237011,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjIzNzAxMQ==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T10:13:19Z",
    "updated_at": "2015-09-22T12:51:43Z",
    "body": "I did some experiments and disassemblies. [Here.](https://gist.github.com/angelsl/c497edfaf821528092ed)\n\nTL;DR:\n- Whenever we get `dllimport` wrong, whether is it extraneous or missing, we get one extra layer of indirection.\n- The MSVC linker will always fix up imports between `.obj` files.\n- The MSVC linker seems like it does not look for wrongly-imported symbols in `.lib` files unless the `.lib` file has been referenced due to something else, in which case `.obj` files from it will be loaded and the imports fixed up.\n- We don't have this problem with MinGW-W64 because MinGW will happily link directly with a DLL, so we don't even decorate anything with `dllimport`. But MinGW-W64 _does not_ fix up anything if we get it wrong i.e. we try to import `__imp_X` when only `X` exists, whereas MSVC does so.\n\n(There was some stuff here, but I moved it to a gist instead.\n\nSorry for spamming your emails.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142237011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142356038",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142356038",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142356038,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjM1NjAzOA==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T17:27:23Z",
    "updated_at": "2015-09-22T17:27:23Z",
    "body": "I will kill myself for suggesting this, but a possible workaround is to\n1. Extract the `.rlib`s that we need to `.obj`s and pass them to `LINK`\n2. Omit `dllimport` from everything, since `LINK` will now fix it all up for us\n\nThe problem with this is that our resulting binary will export everything those `.obj`s export. Not good.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142356038/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142368399",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142368399",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142368399,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjM2ODM5OQ==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T18:10:27Z",
    "updated_at": "2015-09-22T18:10:27Z",
    "body": "@angelsl I think everyone's in agreement that this should be done \"properly\", the problem is in discerning what \"properly\" means in this context.\n\nPer-item dllexport/dllimport attributes _would_ solve this properly, simply because that mirrors how C++ does it exactly. The problem @alexcrichton described can be overcome the same way it is in C++: by controlling their use via cfg options (macros in C++'s case).\n\nThe way this would work is when compiling, you would pass in cfg options which determine how each set of external items used by the library are imported (either dllimport or not). Then either cargo can automatically figure out what cfg options to pass, or you can pass them manually. These cfg options are controlled by the program crate, and will be the same for all linked crates.\n\nThis would mirror how dllimport works in VC++ exactly. The problem is that you end up with an explosion of cfg variables (one for each library, the same as the number of macros in C++). However, it's possible to use this as a model: if a proposed solution can map onto this model without restricting useful cases, then we can be sure it's \"proper\".\n\nI'm not sure enough about exactly what @alexcrichton's latest proposal is to be able to usefully compare it to the model, but it does seem to be more restrictive simply because it's much more automatic.\n\n@alexcrichton Maybe you could explain precisely what scenarios can be expressed in this model but not in your proposal, and why you think they won't occur or are not useful? (bear in mind, when convert ing existing header files to rust as @retep998 is doing, the header file _does_ have this level of flexibility about how how dllimport is applied)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142368399/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142436637",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142436637",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142436637,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjQzNjYzNw==",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T22:11:10Z",
    "updated_at": "2015-09-22T22:11:10Z",
    "body": "Nominating this to escalate. This seems to be something of a showstopper for MSVC support and may require language changes.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142436637/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142436679",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142436679",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142436679,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjQzNjY3OQ==",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T22:11:31Z",
    "updated_at": "2015-09-22T22:11:31Z",
    "body": "cc @rust-lang/lang @rust-lang/compiler \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142436679/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142445762",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142445762",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142445762,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjQ0NTc2Mg==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-22T23:04:16Z",
    "updated_at": "2015-09-22T23:04:34Z",
    "body": "I helped @retep998 investigate the issue and it looked like a trans bug: `extern { static FOO: T; }` referenced from a different crate is treated like a Rust `static FOO: T = ...;` which is _wrong_, but only differs right now in `dllimport` AFAICT, so nobody found it.\n\nYou can tell that the entry point in `trans::foreign` for `ForeignFn` is designed to work cross-crate, but the one for `ForeignStatic` isn't (the latter takes a HIR node, which doesn't exist in the cross-crate case).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142445762/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142458711",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142458711",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142458711,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjQ1ODcxMQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T00:10:28Z",
    "updated_at": "2015-09-23T00:10:28Z",
    "body": "@angelsl \n\n> Wouldn't that still end up having two copies of std?\n\nIn this example the DLL (C + B) is being dynamically loaded into the compiler, whereas the executable (A + B) has no interaction with C whatesover. So in that case I don't believe there will be two copies in one process at any one point in time.\n\nThanks for doing all the investigation as well, it's quite useful!\n\n---\n\n@briansmith \n\n> That's not really what I meant. What are the negative side effects of the proposed patch?\n\nOh sorry, didn't mean to put words in your mouth! To expand on what @vadimcn's patch, it will iterate over the list of all globals (e.g. statics) which are defined and exported in the current compilation unit, creating a sibling static `__imp_<name> = &<name>`. The reason this fixes the linkage problem in this issue is that when we mass apply `dllimport` the linker will probe for symbols called `__imp_<name>` instead of `<name>`, and this guarantees that the linker will find it if we import it from a DLL or if we import it from a Rust static library. This does not solve importing statics from external DLLs, however, which is where `#[linked_from]` comes into the picture.\n\nIn talking about overhead, it's basically exactly what we do today. Accesses to all statics from other crates will go through an extra layer of indirection (one more pointer jump) than they need to if the crate is linked statically. Some space will also be required to store these addresses, but that's likely negligible. I believe it will not be an improvement over today, however, except that linking will probably work in more cases than before, performance will neither improve nor regress.\n\n---\n\n@vadimcn \n\nThanks for also collecting those numbers! At this point I'm inclined to merge your patch as it seems like the best way forward in the immediate future.\n\n---\n\n@Diggsey \n\n> Maybe you could explain precisely what scenarios can be expressed in this model but not in your proposal, and why you think they won't occur or are not useful?\n\nMost of what I was talking about had to deal with Rust crates actually, not with external libraries. In that case everything's actually really easy because the compiler already knows if libraries are linked via DLLs, so it just needs `#[linked_from]` to connect the symbols to the library. This basically means that if you have a header file + a DLL, all symbols marked dllimport in the header are in a block with `#[linked_from]` and all the other symbols are in their own `extern` block.\n\nThe Rust compiler has in general been pretty successful in hiding linkage details of Rust crates, and most of my prior comment was detailing how to continue doing this without having to do something like `#[dllimport] extern crate foo`.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142458711/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142461340",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142461340",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142461340,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjQ2MTM0MA==",
    "user": {
      "login": "briansmith",
      "id": 16816,
      "node_id": "MDQ6VXNlcjE2ODE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/16816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/briansmith",
      "html_url": "https://github.com/briansmith",
      "followers_url": "https://api.github.com/users/briansmith/followers",
      "following_url": "https://api.github.com/users/briansmith/following{/other_user}",
      "gists_url": "https://api.github.com/users/briansmith/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/briansmith/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/briansmith/subscriptions",
      "organizations_url": "https://api.github.com/users/briansmith/orgs",
      "repos_url": "https://api.github.com/users/briansmith/repos",
      "events_url": "https://api.github.com/users/briansmith/events{/privacy}",
      "received_events_url": "https://api.github.com/users/briansmith/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T00:24:38Z",
    "updated_at": "2015-09-23T00:24:38Z",
    "body": "> . Accesses to all statics from other crates will go through an extra layer of indirection (one more pointer jump) than they need to if the crate is linked statically.\n\nCould we please file an issue to track into improving this in the future. In _ring_ [1] and other projects I am working on, I expose a lot of statics that are to be referenced across modules that represent algorithms and other cryptographic parameters. And, in particular, users of these libraries will often define their own statics that contain references to those statics, cross-module. It sounds like the current model will force the use of static initializers in the case of static data referencing static data in another crate. Obviously, nobody wants static initializers (see all the work that went into Gecko to avoid static initializers).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142461340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142461791",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142461791",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142461791,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjQ2MTc5MQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T00:28:58Z",
    "updated_at": "2015-09-23T00:28:58Z",
    "body": "This issue is basically the one you want, it represents correctly applying `dllimport`. @vadimcn's patch does not do that and would not close this issue, it would simply make more situations link whereas today there's a link failure.\n\nUnless there's link errors related to statics referencing other statics I don't think that there's anything new which could generate an error beyond what's already happening today (also no extra layers of indirection beyond the perhaps-unnecessary one we're already applying)\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142461791/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142470769",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142470769",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142470769,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjQ3MDc2OQ==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T01:53:23Z",
    "updated_at": "2015-09-23T01:53:23Z",
    "body": "@Diggsey Properly means decorating the correct imports with dllimport and leaving it off the imports that don't need it. How that is done I'm not partial to anything, as long as it is done correctly.\n\nI am OK with dllimport/dllexport attributes. The thing is most of the rest here seem to prefer something that requires intervention from non-Win32 crate writers, and rightly so because why would they care about something that doesn't affect them? So we need rustc to figure this out automatically on its own, and preferably have some control in case it gets it wrong.\n\nWhat you said about having Cargo pass in new arguments (which would mean also that non-Win32 authors don't need to care since Cargo figures it out) is something I suggested earlier. @alexcrichton did not really like the idea though. Fair enough.\n\n@alexcrichton Ah ok. Thanks for the explanation!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142470769/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142478326",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142478326",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142478326,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjQ3ODMyNg==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T03:07:15Z",
    "updated_at": "2015-09-23T03:07:36Z",
    "body": "@alexcrichton \n\n> Most of what I was talking about had to deal with Rust crates actually, not with external libraries.\n\nYes, but you said you wanted a single solution that would cover both cases.\n\n> This basically means that if you have a header file + a DLL, all symbols marked dllimport in the header are in a block with #[linked_from] and all the other symbols are in their own extern block.\n\nOK, so \"linked_from\" is essentially equivalent a macro that evaluates to either dllimport or nothing depending on the configuration.\n\n@angelsl\n\n> I am OK with dllimport/dllexport attributes. The thing is most of the rest here seem to prefer something that requires intervention from non-Win32 crate writers.\n\nAIUI even non-win32 crate writers who link to native dylibs will have to make sure to apply the `linked_from` attribute, even though their code would run just fine on non-windows without it. (Just as how those native libraries would have to add dllimport/dllexport annotations when ported to msvc or mingw, although the situation is _of course_ slightly more complicated for mingw).\n\nFurthermore, it doesn't seem like it will be possible for rust to check that you've done this correctly at compile time?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142478326/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142510725",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142510725",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142510725,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjUxMDcyNQ==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T06:46:22Z",
    "updated_at": "2015-09-23T06:47:30Z",
    "body": "> AIUI even non-win32 crate writers who link to native dylibs will have to make sure to apply the linked_from attribute, even though their code would run just fine on non-windows without it.\n\n@alexcrichton: I also think this is the weak point of `#[linked_from]`.  IMO, if we started associating symbols with the `#[link]` attribute on the surrounding `extern` block, the right thing would be much more likely to happen. \n\nRegarding libs, which are provided via the command line by cargo: if name of the lib isn't known ahead of time, `linked_from` cannot be used either, because, well, you don't know the lib name...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142510725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142513826",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142513826",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142513826,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjUxMzgyNg==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T06:56:45Z",
    "updated_at": "2015-09-23T06:56:45Z",
    "body": "Also, I would agree with @retep998 regarding the necessity of some kind of explicit control over `dllimport`'s.  We can try to make things as automatic as possible, but there will always be corner-cases.  If nothing else, the use of such attribute in `*-sys` libraries should be uncontroversial, since those are platform-specific.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142513826/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142556296",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142556296",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142556296,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjU1NjI5Ng==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T10:16:30Z",
    "updated_at": "2015-09-23T10:16:42Z",
    "body": "@Diggsey \n\n> AIUI even non-win32 crate writers who link to native dylibs will have to make sure to apply the `linked_from` attribute, even though their code would run just fine on non-windows without it.\n\nTrue. But code that links to native dylibs that aren't compiled through `cargo`/`rustc` would need to have thought about building the native dylibs on Windows, so they can go the extra step and annotate it too. And code that links to native (I assume you mean non-Rust) things compiled through `cargo`/`rustc` e.g. the `gcc` crate, the build system would have the information, we just need to pass it to `trans`.\n\n> (Just as how those native libraries would have to add dllimport/dllexport annotations when ported to msvc or mingw, although the situation is of course slightly more complicated for mingw).\n\nHow is it more complicated for MinGW? MinGW's `ld` is happy to link directly to a DLL, unlike MSVC's `link`, although if you link to a DLL without `dllimport` in MinGW I believe you end up with an indirection.\n\n> Furthermore, it doesn't seem like it will be possible for rust to check that you've done this correctly at compile time?\n\nTrue. It can only know at link time. And even then the only way it would know for sure is to open up the libraries and check (hacky), or wait for `link` to barf (even hackier! But if `link` barfs then compilation fails anyway).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142556296/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142586828",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142586828",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142586828,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjU4NjgyOA==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T12:44:31Z",
    "updated_at": "2015-09-23T12:44:31Z",
    "body": "@alexcrichton If we use `#[linked_from]` to determine whether to apply dllimport rather than some sort of `#[dllimport]` attribute then we _still_ run into the same case of linking to some native library, say `foo`, and not knowing whether the library the user has provides static or dynamic symbols. We certainly can't rely on `kind=static` vs `kind=dylib` because that is used to distinguish between whether to bundle the library into the `.rlib` or defer it to link time, which is entirely orthogonal to whether a library provides static or dynamic symbols. So that leaves only one other option and that is to pass a cfg thing through Cargo such that the `#[linked_from]` is conditionally emitted, but that can _also_ be done with a cfg conditionally emitting a `#[dllimport]`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142586828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142615933",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142615933",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142615933,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjYxNTkzMw==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T14:18:39Z",
    "updated_at": "2015-09-23T14:18:39Z",
    "body": "> How is it more complicated for MinGW? MinGW's ld is happy to link directly to a DLL, unlike MSVC's link, although if you link to a DLL without dllimport in MinGW I believe you end up with an indirection.\n\nThe documentation seems to indicate otherwise: unless you compile with some additional flags then MinGW also requires that dllimport/dllexport be applied correctly: http://www.mingw.org/wiki/sampledll\n\nFailure to do so for functions will just result in indirection, but failing to do it for data would cause crashes as we see here. In this case `ld` behaves no differently from `link`. The extra complication comes from the existence of the additional compiler flags, which seem to do some kind of unix emulation (however, these are not enabled by default).\n\n> True. It can only know at link time. And even then the only way it would know for sure is to open up the libraries and check (hacky), or wait for link to barf (even hackier! But if link barfs then compilation fails anyway).\n\nThis doesn't help on non-windows platforms: if the advantage of `[linked_from]` is that it is not windows-specific, then ideally, using it incorrectly should cause compilation to fail across all platforms (so that you can compile on linux, and as long as you don't use any platform specific features, be reasonably confident that the code will also compile on windows, or vice versa)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142615933/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142619437",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142619437",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142619437,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjYxOTQzNw==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T14:31:06Z",
    "updated_at": "2015-09-23T14:34:48Z",
    "body": "@Diggsey \n\n> The documentation seems to indicate otherwise: unless you compile with some additional flags then MinGW also requires that dllimport/dllexport be applied correctly: http://www.mingw.org/wiki/sampledll\n> \n> Failure to do so for functions will just result in indirection, but failing to do it for data would cause crashes as we see here. In this case ld behaves no differently from link. The extra complication comes from the existence of the additional compiler flags, which seem to do some kind of unix emulation (however, these are not enabled by default).\n\n``` c\n// exe.c\n#include <stdio.h>\n\nchar *ext();\n\nint main() {\n    puts(ext());\n    return 0;\n}\n```\n\n``` c\n// dll.c\nchar *ext() {\n    return \"Hello!\";\n}\n```\n\n```\n> gcc -c -O3 dll.c\n> gcc -c -O3 exe.c\n> gcc -shared -o dll.dll dll.o\n> del dll.o\n> dir\n Volume in drive C has no label.\n Volume Serial Number is C2CB-8813\n\n Directory of C:\\Users\\angelsl\\Root\\Development\\rust\\test\n\n20150923  22:26    <DIR>          .\n20150923  22:26    <DIR>          ..\n20150923  22:23                38 dll.c\n20150923  22:26            45,786 dll.dll\n20150923  22:23                86 exe.c\n20150923  22:26             1,023 exe.o\n               4 File(s)         46,933 bytes\n               2 Dir(s)  868,320,825,344 bytes free\n> gcc -o exe.exe exe.o -L. -ldll\n> exe\nHello!\n```\n\n``` c\n// exe.c\n#include <stdio.h>\n\nextern char* ext2;\n\nint main() {\n    puts(ext2);\n    return 0;\n}\n```\n\n``` c\n// dll.c\nchar *ext2 = \"Hello from data!\";\n```\n\n```\n> gcc -c -O3 dll.c\n> gcc -c -O3 exe.c\n> gcc -shared -o dll.dll dll.o\n> del dll.o\n> gcc -o exe.exe exe.o -L. -ldll\n> exe\nHello from data!\n```\n\nQED.\n\n> This doesn't help on non-windows platforms: if the advantage of [linked_from] is that it is not windows-specific, then ideally, using it incorrectly should cause compilation to fail across all platforms (so that you can compile on linux, and as long as you don't use any platform specific features, be reasonably confident that the code will also compile on windows, or vice versa)\n\nFair enough.\n\nBut I would rather have a solution that works correctly on Windows (again, correctly means applying `dllimport` where needed and only where needed) than a worse solution (or none at all!) that consistently reports errors on other platforms even though it doesn't affect those other platforms.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142619437/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142662081",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142662081",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142662081,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjY2MjA4MQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T16:57:55Z",
    "updated_at": "2015-09-23T16:57:55Z",
    "body": "@angelsl, @Diggsey \n\n> AIUI even non-win32 crate writers who link to native dylibs will have to make sure to apply the linked_from attribute\n\nThis and the other conclusions you reach are correct, but I think it's just a fact of the way things are. For example any manual attribute (such as `#[dllimport]`) suffers the same problems. The only way we could _not_ have a situation like this is if we auto-inferred everything, which is currently impossible for the compiler to do in all cases.\n\n---\n\n@vadimcn \n\n> I also think this is the weak point of #[linked_from]\n\nI feel, however, that it impossible for this to **not** be a weak point of any solution. I'd be fine saying that `#[link]` implied `#[linked_from]` on a block of functions, but that doesn't obsolete the need for `#[linked_from]`. Linkage provided via the command line is not always just because the name of the library is not known, it is frequently because the builder of the code determines whether the linkage is static or dynamic, not the author of the code.\n\n> regarding the necessity of some kind of explicit control over dllimport's\n\nI agree in principle, but I would prefer to not take that route at this time to avoid stabilizing more than we need to. If we can cover all existing use cases with `#[linked_from]` then it brings with it the benefits of:\n- More ergonomic, don't need to attach it to all native declarations.\n- More ergonomic in that no `#[cfg]` is needed\n- Robust in the face of swapping out the linkage at build time\n- Easy to add retroactively to crates to compile on Windows.\n\n---\n\n@retep998 \n\n> So that leaves only one other option and that is to pass a cfg thing through Cargo such that the #[linked_from] is conditionally emitted, but that can also be done with a cfg conditionally emitting a #[dllimport].\n\nIs there a problem with this? Having one stable attribute which is ergonomic to use 99% of the time and in the weird corner cases is slightly less ergonomic seems much better than the alternative of tagging all functions and statics with an attribute which is _also_ wrapping a `#[cfg]`.\n\nI don't understand where you're going with these comments, do you not want `#[linked_from]`? Do you only want `#[dllimport]`?\n\n---\n\n@Diggsey \n\n> if the advantage of [linked_from] is that it is not windows-specific,\n\nWhile not necessarily Windows specific, I don't personally have any plans to make compilation fail if it is not or if it's incorrectly applied on Unix platforms. (not sure what this would mean?)\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142662081/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142667925",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142667925",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142667925,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjY2NzkyNQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T17:14:08Z",
    "updated_at": "2015-09-23T17:17:10Z",
    "body": "@alexcrichton \nI find it weird that by simply telling Rust which library a group of functions/statics comes from, it emits `dllimport`. Also the fact that you even have to tell Rust at all which library those functions/statics came from, which is useless information since the linker will resolve the symbols to whichever library it feels like. It all just feels very unrelated to the point of whether to apply `dllimport` or not. Making the distinction based on `kind=static` vs `kind=dylib` is entirely orthogonal, since a bundled library could still have dynamic symbols that need `dllimport` and a non-bundled library can have static symbols that don't need `dllimport`. If there is some way to tell `#[linked_from]` whether to apply `dllimport` or not, that does **not** involve deciding whether to bundle the library, then that would be enough. But as it is, I don't see how it makes sense.\n\ntl;dr Give me a way to specify whether to apply `dllimport` without forcing my hand with regards to bundling.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142667925/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142674478",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142674478",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142674478,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjY3NDQ3OA==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T17:36:38Z",
    "updated_at": "2015-09-23T17:36:38Z",
    "body": "> Linkage provided via the command line is not always just because the name of the library is not known, it is frequently because the builder of the code determines whether the linkage is static or dynamic, not the author of the code.\n\nWe could have the command line option override \"kinds\" set via `#[link]`.\n\n> I agree in principle, but I would prefer to not take that route at this time to avoid stabilizing more than we need to. If we can cover all existing use cases with #[linked_from]...\n\nI am afraid it will take a lot of effort to cover all corner cases.  dllimport would solve the problem at hand more directly.   We already have the `#[linkage]` attribute for low-level control.   IMO, `dllimport` falls into the same category.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142674478/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142712241",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142712241",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142712241,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjcxMjI0MQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T20:01:06Z",
    "updated_at": "2015-09-23T20:01:06Z",
    "body": "@retep998 \n\n> tl;dr Give me a way to specify whether to apply dllimport without forcing my hand with regards to bundling.\n\n`#[linked_from]` does this. If you want dllimport, then you _must_ have some dylib somewhere, so you just connect the two. Your concerns about bundling are only related to the fact that we emit dllimport for all external statics today by default and there's no way around that.\n\n---\n\n@vadimcn \n\n> I am afraid it will take a lot of effort to cover all corner cases.\n\nCould you elaborate on these corner cases? I can't actually think of any that `#[linked_from]` doesn't cover. While we do have `#[linkage]` it's unstable (and for good reason) and may be difficult to stabilize.\n\n---\n\nOver lunch I also remembered one of the critical aspects of `#[linked_from]` which is why it exists today in the first place. We haven't been talking about dllexport a lot, but it's a thing, and currently the compiler leverages `#[linked_from]` to ensure that what Rust DLLs export is actually correct.\n\nWhen having a Rust dylib as an intermediate dependency, it's possible to link a C library statically to the dylib which then must also be exported from the DLL to have future Rust dependencies linking against it to work. For example `rustc_llvm` statically links LLVM, but LLVM is called from `rustc_trans` so the symbols in LLVM need to be exported. Currently the compiler detects this situation by understanding that symbols in a `#[linked_from]` block which are statically included and reachable need to be exported from a DLL as well.\n\nThis, paired with the ergonomic benefits, makes me think that it obsoletes any form of manual dllimport/dllexport. It continues Rust's trend of in general hiding platform-specific linkage details in favor of higher level intentions which end up covering basically all use cases anyway.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142712241/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142715333",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142715333",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142715333,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjcxNTMzMw==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T20:12:01Z",
    "updated_at": "2015-09-23T20:12:51Z",
    "body": "So basically if I want `dllimport` I have to specify `#[linked_from]` and if I don't want `dllimport` then I don't specify `#[linked_from]`? So if some crate wants to link to some native library, and that native library might be a static library or it might be a DLL, does that mean the crate has to do `#[cfg_attr(is_dll, linked_from = \"...\")]`?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142715333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142716602",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142716602",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142716602,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjcxNjYwMg==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T20:17:55Z",
    "updated_at": "2015-09-23T20:17:55Z",
    "body": "Kinda, for any library in question I would expect the set of symbols exported via a DLL of that library to be relatively constant. This is typically the entire API surface but it looks like from your examples that's not always true. For the set of symbols that are exported via the DLL you would wrap them in a `#[linked_from]` unconditionally. \n\nIf you expect the native library to them _also_ be sometimes linked statically, only then would you have to use `cfg_attr` to annotate the set of symbols which are linked statically even when linked via a DLL.\n\nThis means that `#[cfg_attr]` is not common nor needed most of the time (as these obscure DLLs probably always show up as a DLL as opposed to sometimes being linked statically).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142716602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142721104",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142721104",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142721104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjcyMTEwNA==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T20:36:28Z",
    "updated_at": "2015-09-23T20:36:28Z",
    "body": "@angelsl \n\n> I don't believe Linux goes through the GOT if you statically link things together. That would be quite terrible. (And worse if it's Rust specifically that does that!)\n\nLinux goes through the GOT when you have a non-C-static global variable on a library. Executables (`-fPIE`) instead steal the global to their own section.\n\nAlso, the \"dummy function\" is just to convince LINK.EXE to create the `__imp_` symbols, it shouldn't actually get called.\n\n@alexcrichton \n\nOn Windows, linking is always done statically - i.e. against a `.lib`. The `.lib` can contain both static symbols that exist only in the `.lib`, and dynamic symbols that refer to some `.dll`. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142721104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142731302",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142731302",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142731302,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjczMTMwMg==",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T21:18:07Z",
    "updated_at": "2015-09-23T21:18:07Z",
    "body": "I'm going to express some vague opinions, but this topic is pretty vast and I don't understand it near as well as others here.\n\nI see there are two separate problems here - one with rust crates and one with native libs.\n\nFor the former, I'm in favor of any intermediate workaround solution that does not surface any new language features while we figure out more performant solutions.\n\nFor the latter, my inclination is that `#[link = \"...\"]` _would have been the right solution_ but the existing semantics are already baked in and the `link` attribute has no real correlation to the `extern` block its attached to. Whether `link_from` as stands is the right sol'n idk.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142731302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142741098",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142741098",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142741098,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0Mjc0MTA5OA==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-23T21:52:55Z",
    "updated_at": "2015-09-23T21:52:55Z",
    "body": "[I don't have particularly strong feelings about `linked_from`, it just seems like an extra level of cruft, which makes me slightly sad.]\n\nCan't we extend the existing semantics?  I believe this would be backwards-compatible: currently none of the platforms except `-windows-msvc` care about the symbol<->library associations, so they will continue to work even if markup is wrong (but in many cases it is actually correct, because people usually don't create empty `extern` blocks just for the heck of it)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142741098/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142814098",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142814098",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142814098,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjgxNDA5OA==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-24T05:18:16Z",
    "updated_at": "2015-09-24T05:18:16Z",
    "body": "@arielb1\n\n> Also, the \"dummy function\" is just to convince LINK.EXE to create the `__imp_` symbols, it shouldn't actually get called.\n\nThat would be a workaround to coerce LINK to fix up our broken linkages.\n\nAgain if we're going to support MSVC, we might as well do it properly.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142814098/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142996530",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-142996530",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 142996530,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0Mjk5NjUzMA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-24T17:28:06Z",
    "updated_at": "2015-09-24T17:28:06Z",
    "body": "@vadimcn \n\nCould you elaborate on how you see extending the existing semantics? I'm totally on board with `#[link]` implying `#[linked_from]`, but having an `extern` block without `#[link]` isn't something that can be ignored, it happens very commonly.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/142996530/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143000880",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-143000880",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 143000880,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MzAwMDg4MA==",
    "user": {
      "login": "vadimcn",
      "id": 3203809,
      "node_id": "MDQ6VXNlcjMyMDM4MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vadimcn",
      "html_url": "https://github.com/vadimcn",
      "followers_url": "https://api.github.com/users/vadimcn/followers",
      "following_url": "https://api.github.com/users/vadimcn/following{/other_user}",
      "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions",
      "organizations_url": "https://api.github.com/users/vadimcn/orgs",
      "repos_url": "https://api.github.com/users/vadimcn/repos",
      "events_url": "https://api.github.com/users/vadimcn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vadimcn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-24T17:44:37Z",
    "updated_at": "2015-09-24T17:44:37Z",
    "body": "@alexcrichton: \n- If name of the library is known, just add a `#[link]` attribute.  The kind can be later overridden from the command line. \n- If name is not known, `#[linked_from]` would not have helped anyway, as it needs the name of the library.  One way of dealing with this might be to invent an 'alias' kind, e.g. `#[link(name=\"foo\" kind=\"alias\"]`, as well as command line syntax to specify the actual library name it maps to, for example, `-l alias=foo=libbar`\n\nIt would still be fine to have unadorned `extern` block, those symbols just wont be associated with a library.  Existing code will continue to work since only `-windows-msvc` needs these associations.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143000880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143002602",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-143002602",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 143002602,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MzAwMjYwMg==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-24T17:50:44Z",
    "updated_at": "2015-09-24T17:50:44Z",
    "body": "That sounds pretty plausible to me! I'll look to draft up an RFC soon.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143002602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143251350",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-143251350",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 143251350,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MzI1MTM1MA==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-25T15:24:10Z",
    "updated_at": "2015-09-25T15:24:10Z",
    "body": "Here's a nicer table showing the dllimport failure cases.\n\n| Library type | Static | Function | Result |\n| --- | --- | --- | --- |\n| Dynamic | No | No | Success |\n| Dynamic | Plain | No | Error |\n| Dynamic | Dllimport | No | Success |\n| Dynamic | No | Plain | Success |\n| Dynamic | Plain | Plain | Error |\n| Dynamic | Dllimport | Plain | Success |\n| Dynamic | No | Dllimport | Success |\n| Dynamic | Plain | Dllimport | Error |\n| Dynamic | Dllimport | Dllimport | Success |\n| Static | No | No | Success |\n| Static | Plain | No | Success |\n| Static | Dllimport | No | Error |\n| Static | No | Plain | Success |\n| Static | Plain | Plain | Success |\n| Static | Dllimport | Plain | Warning |\n| Static | No | Dllimport | Error |\n| Static | Plain | Dllimport | Warning |\n| Static | Dllimport | Dllimport | Error |\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143251350/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143285405",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-143285405",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 143285405,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MzI4NTQwNQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-25T17:04:16Z",
    "updated_at": "2015-09-25T17:04:16Z",
    "body": "I've [opened an RFC](https://github.com/rust-lang/rfcs/pull/1296) for how to deal with native libraries, which in concert with @vadimcn's [patch](https://github.com/rust-lang/rust/pull/28646) should eliminate all link errors related to the application of dllimport/dllexport.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143285405/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143289595",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-143289595",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 143289595,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MzI4OTU5NQ==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-25T17:09:17Z",
    "updated_at": "2015-09-25T17:09:17Z",
    "body": "If we merge that patch, are we ever going to properly decorate imports between Rust crates?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143289595/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143299759",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-143299759",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 143299759,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MzI5OTc1OQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-09-25T17:43:38Z",
    "updated_at": "2015-09-25T17:43:38Z",
    "body": "Certainly! This issue will not be closed by that PR.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/143299759/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/144835351",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-144835351",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 144835351,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NDgzNTM1MQ==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-01T20:16:18Z",
    "updated_at": "2015-10-01T20:16:18Z",
    "body": "Compiler subteam: not assigned a priority yet as full implications are not understood. @alexcrichton maybe you and I can chat and you can catch me up here, there's a lot of backscroll. :)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/144835351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/148204665",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-148204665",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 148204665,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0ODIwNDY2NQ==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-14T21:19:11Z",
    "updated_at": "2015-10-14T21:19:11Z",
    "body": "triage: P-low\n\nAfter discussion with @alexcrichton, my conclusion was that the remaining problems are low priority, with the exception of the issues discussed (and hopefully addressed) in RFC https://github.com/rust-lang/rfcs/pull/1296. \n\nMy understanding of the situation is roughly as follows (feel free to correct me if you feel I am mistaken):\n1. Windows generally requires that imports/exports from DLLs be specially declared.\n2. But Rust crates do not, typically, know whether they are being compiled for use in a DLL or not\n   - rlibs can be used in either way\n   - but static linking is the default\n3. Currently, we use some set of declarations that are incorrect but the Windows linker nonetheless patches them up. The semantics are correct in all cases but the \"fixup\" results in suboptimal performance under the following scenarios:\n   - when using dynamic linking in Windows, function calls suffer from an extra level of indirection\n   - when using static linking in Windows, accessing static variables requires an extra load \n4. The performance impact of the above measures in real-world applications has not been measured. @alexcrichton expects it is low, particularly as static linking is the default for Rust (where fn calls are fast), and static variables are unusual.\n5. If we wanted to improve the situation, language changes are unnecessary, though of course they might be one route. At worst, we could fix this problem by having rlibs not contain the full `.o` on Windows, but rather LLVM IR (or something similar). We could then patch up the declarations at the last minute, when we know how a crate is to be used. Another option might be having cargo propagate the information about whether a crate will be used for dynamic or static linking more aggressively.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/148204665/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/148244169",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-148244169",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 148244169,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0ODI0NDE2OQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-15T00:58:42Z",
    "updated_at": "2015-10-15T00:58:42Z",
    "body": "@nikomatsakis While I can accept linking between Rust crates to be low priority since it does work, albeit poorly, getting dllimport correct when linking to native libraries is very much a concern still. `uuid-sys` does not work on msvc at all and it's a fairly important library since it provides a ton of `GUID`s that are necessary for things like working with COM.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/148244169/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/148255005",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-148255005",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 148255005,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0ODI1NTAwNQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-15T02:00:14Z",
    "updated_at": "2015-10-15T02:00:14Z",
    "body": "@retep998 note that @nikomatsakis indicated that the issues are low priority with the exception of rust-lang/rfcs#1296 which is where the native library case should be handled.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/148255005/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149293837",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149293837",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149293837,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTI5MzgzNw==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-19T17:43:32Z",
    "updated_at": "2015-10-19T18:09:48Z",
    "body": "So currently we already have some cases involving mixing and matching of static/dynamic linking between Rust crates that results in errors. For example this results in an error due to duplicate std and friends:\n`rustc --crate-type=dylib a.rs`\n`rustc b.rs --extern a=a.dll`\n\nBecause of this precedent that you already have to be really careful about whether you're linking to things statically or dynamically, plus the fact that the common use case with Cargo is simply linking everything statically, I believe it should be entirely feasible to be more strict about making sure you link to the same dependency as you built against. So if `b.rlib` is compiled against `a.rlib` then you cannot later change your mind and link to `a.dll` instead.\n\nIf a PR can be made which imposes this restriction and takes advantage of it to apply `dllimport` correctly, would it be accepted, or would you insist on some alternative which either doesn't exist or is a poor idea (like delaying all codegen to link time, which would severely impair edit-compile times)? If this should go through an RFC, tell me so I can write an RFC.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149293837/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149360153",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149360153",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149360153,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTM2MDE1Mw==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-19T21:59:37Z",
    "updated_at": "2015-10-19T21:59:37Z",
    "body": "@retep998 have you read my [response above](https://github.com/rust-lang/rust/issues/27438#issuecomment-141816628)? I outlined how I thought we could apply `dllimport` and why it won't work, do you have an idea of how to fix the problems associated with that strategy?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149360153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149387215",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149387215",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149387215,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTM4NzIxNQ==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T00:45:57Z",
    "updated_at": "2015-10-20T00:50:39Z",
    "body": "@alexcrichton \n\nHis solution is the same as your solution, except it also prevents linking an rlib dynamically when it was built to be used statically or vice versa i.e. fixing your failure condition.\n\nHonestly, I'm waiting on you Rust people to approve a solution before I even bother writing it, because it seems like anything we suggest is going to be shot down, and any PRs rejected, even when there is nothing wrong with the solution.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149387215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149415531",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149415531",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149415531,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTQxNTUzMQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T03:15:06Z",
    "updated_at": "2015-10-20T03:15:06Z",
    "body": "Ah so my response was indeed a little long winded, so let me reiterate the last portion to emphasize the problem that needs fixing.\n\nIn the case today where a dependency is shared by a plugin and an executable, Cargo will only compile the dependency once. If we were to \"correctly apply dllimport\", however, this is not correct because the dependency needs to be compiled twice (once to statically link into the executable and once to dynamically link into the plugin). A solution where an rlib ties its upstream dependencies to a particular format will break this model, unfortunately. In other words, I don't think I've seen anything which solves this problem.\n\nI _think_, however, that this is the only case where we'd run into problems today. There are perhaps a number of ways to handle it, but I haven't found one quite palatable yet.\n\nCan you elaborate on why you think that suggestions are being shot down or PRs are being rejected? I'd also love to fix this, but we have to be careful to not break existing situations today as well, so the various use-cases just need to be thought through. I don't think anyone's intentionally trying to hinder efforts here!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149415531/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149451452",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149451452",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149451452,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTQ1MTQ1Mg==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T06:44:29Z",
    "updated_at": "2015-10-20T06:44:29Z",
    "body": "In the case of cross-compiling wouldn't crates that are used in plugins already be compiled twice? Once for the native triple to be used in a plugin and once for the target triple to be used in the final product? Shouldn't doing something similar in the non-cross case also be okay in order to correctly apply dllimport?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149451452/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149451593",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149451593",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149451593,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTQ1MTU5Mw==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T06:45:43Z",
    "updated_at": "2015-10-20T10:06:53Z",
    "body": "> In the case today where a dependency is shared by a plugin and an executable, Cargo will only compile the dependency once. If we were to \"correctly apply dllimport\", however, this is not correct because the dependency needs to be compiled twice (once to statically link into the executable and once to dynamically link into the plugin). A solution where an rlib ties its upstream dependencies to a particular format will break this model, unfortunately. In other words, I don't think I've seen anything which solves this problem.\n\nThere aren't very many solutions to this. You could _just compile the dependency twice_. <del>or you disallow such a situation and say that in this case, _the executable and plugin should really be crates that are compiled with separate invocations of Cargo_ instead of the plugin being a dependency of the executable. (Of course, I think the ideal way to solve it is _if you're going to have dynamically-linked plugins, then <strong>link everything dynamically</strong>_, but that isn't always feasible, so at the very least have the common dependency/ies built as a dynamic library.)</del>\n\nEdit: Actually, making Cargo compile the dependency twice in the same run seems like the only proper solution here.\n\n[I suggested the first solution here](https://github.com/rust-lang/rust/issues/27438#issuecomment-141869986), but [you rejected it on the grounds that it required too invasive changes to Cargo and that it may cause some problems in future](https://github.com/rust-lang/rust/issues/27438#issuecomment-142147500).\n\n<span><del>The second solution is what @retep998 is suggesting. Make such a combination illegal (IMO, we should not have more than one copy of each dependency _anyway_).</del></span>\n\nMaybe there is a solution that 1. doesn't have the problem you mentioned and 2. penalises neither dynamic nor static linking, but I highly doubt it. If Rust wants to support MSVC, it should be willing to _actually support MSVC_, instead of leaving a half-fix that works, but doesn't work as well as it could.\n\nI feel very discouraged working on this problem, because I really want to use Rust, but I cannot do so comfortably (at least on MSVC) when I know that Rust is relying on the linker to fix its poorly-done decorations (and then chomping the linker output so we don't see any of the warnings!). And what makes it worse is that you don't seem to want to make the necessary changes, no matter how large they may be, to properly support MSVC. I'm ready to go ahead and delve into `rustc` even though I haven't actually written any Rust before so that I can get this fixed, but there doesn't seem to be any point if ideas are rejected before they're even tried out.\n\nIf Windows/MSVC is a platform Rust wants to claim to support, then it should do so properly, and be willing to make the changes needed.\n\nSorry for the rant, but.. yeah.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149451593/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149478799",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149478799",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149478799,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTQ3ODc5OQ==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T08:41:37Z",
    "updated_at": "2015-10-20T08:41:37Z",
    "body": "@angelsl You are getting confused again by why @alexcrichton means by \"plugin\". I _think_ he's referring to compiler plugins rather than application plugins. (Might be clearer to refer to them as compiler plugins rather than just plugins, especially on a thread about dynamic linking!)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149478799/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149489291",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149489291",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149489291,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTQ4OTI5MQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T09:19:49Z",
    "updated_at": "2015-10-20T09:59:59Z",
    "body": "~~The API that a compiler plugin exposes to downstream dependencies is very different than the API that a compiler plugin exposes to the compiler. Because of this I see very little reason to be building a compiler plugin such that it can be used for both things. Good thing compiler plugins are unstable so that can be improved.~~\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149489291/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149505358",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149505358",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149505358,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTUwNTM1OA==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T10:03:36Z",
    "updated_at": "2015-10-20T10:08:13Z",
    "body": "> @angelsl You are getting confused again by why @alexcrichton means by \"plugin\". I _think_ he's referring to compiler plugins rather than application plugins. (Might be clearer to refer to them as compiler plugins rather than just plugins, especially on a thread about dynamic linking!)\n\nOkay, my bad. Sorry.\n\nSo we can't make it illegal to have a dependency be linked in different ways in a single Cargo invocation. The only way left is really to build such dependencies twice.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149505358/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149506919",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149506919",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149506919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTUwNjkxOQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T10:05:48Z",
    "updated_at": "2015-10-20T10:05:48Z",
    "body": "Let's go back to this situation\n\n> - Executable A depends on B and plugin C\n> - Crate C also depends on B.\n\nWhat happens if I am cross-compiling? Does C get built for the host architecture and B gets built twice, once for host and once for target? If so, can't that logic be extended to also be used when targetting -msvc such that B is built twice, once with a static std to be used in A, and again with a dynamic std to be used in C?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149506919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149546599",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149546599",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149546599,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTU0NjU5OQ==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T12:15:12Z",
    "updated_at": "2015-10-20T12:15:12Z",
    "body": "@retep998 \n\nSo we have `x86-pc-msvc-static` and `x86-pc-msvc-dynamic` targets?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149546599/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149551874",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149551874",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149551874,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTU1MTg3NA==",
    "user": {
      "login": "Diggsey",
      "id": 451321,
      "node_id": "MDQ6VXNlcjQ1MTMyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Diggsey",
      "html_url": "https://github.com/Diggsey",
      "followers_url": "https://api.github.com/users/Diggsey/followers",
      "following_url": "https://api.github.com/users/Diggsey/following{/other_user}",
      "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions",
      "organizations_url": "https://api.github.com/users/Diggsey/orgs",
      "repos_url": "https://api.github.com/users/Diggsey/repos",
      "events_url": "https://api.github.com/users/Diggsey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Diggsey/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T12:37:19Z",
    "updated_at": "2015-10-20T12:37:19Z",
    "body": "The msvc solution is generally to treat it as part of the configuration (like debug vs release) rather than the target. That's why MSVC projects often have Release/ReleaseDLL or similar configurations.\n\nI vote for not messing with the target triples any more...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149551874/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149568895",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149568895",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149568895,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTU2ODg5NQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T13:30:56Z",
    "updated_at": "2015-10-20T13:31:13Z",
    "body": "To really do this right would require that Cargo has knowledge in advance of whether a dependency will be a plugin or not so that it can decide how to build it and its dependencies.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149568895/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149665485",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149665485",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149665485,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTY2NTQ4NQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-20T18:50:26Z",
    "updated_at": "2015-10-20T18:50:26Z",
    "body": "@Diggsey, @angelsl \n\n> I think he's referring to compiler plugins rather than application plugins. \n\nI am indeed! (as I [mentioned above as well](https://github.com/rust-lang/rust/issues/27438#issuecomment-142147500))\n\n---\n\n@retep998 \n\n> In the case of cross-compiling wouldn't crates that are used in plugins already be compiled twice?\n\nUnfortunately I think the problem still comes up with build scripts. Both plugins and build scripts are always compiled for the host architecture, and build scripts are linked statically while plugins are dynamic, so if a build script and a plugin share a dependency it's the same problem.\n\nFor normal dependencies, however, yes Cargo will compile it twice.\n\n> Shouldn't doing something similar in the non-cross case also be okay in order to correctly apply dllimport?\n\nIn theory, yeah, but this is something that'd probably need to be designed from both a Cargo and compiler perspective.\n\n---\n\n@angelsl \n\n> Actually, making Cargo compile the dependency twice in the same run seems like the only proper solution here.\n\nI agree in that this is the only solution I know of here. This is just a fundamental problem with the way Cargo compiles dependencies and how they're linked together. I'm _wary_ of starting to do crazy windows-specific things without reconsidering how it affects other platforms (e.g. making tons of windows-specific or unix-specific bugs), but I don't mean to _reject_ anything.\n\n---\n\n@arielb1, @Diggsey \n\n> So we have x86-pc-msvc-static and x86-pc-msvc-dynamic targets?\n\nI agree that this is more of a compilation-option rather than a target-triple option, I would also prefer to not mess with triples.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149665485/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149768655",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149768655",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149768655,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTc2ODY1NQ==",
    "user": {
      "login": "angelsl",
      "id": 235432,
      "node_id": "MDQ6VXNlcjIzNTQzMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/235432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/angelsl",
      "html_url": "https://github.com/angelsl",
      "followers_url": "https://api.github.com/users/angelsl/followers",
      "following_url": "https://api.github.com/users/angelsl/following{/other_user}",
      "gists_url": "https://api.github.com/users/angelsl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/angelsl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/angelsl/subscriptions",
      "organizations_url": "https://api.github.com/users/angelsl/orgs",
      "repos_url": "https://api.github.com/users/angelsl/repos",
      "events_url": "https://api.github.com/users/angelsl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/angelsl/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-21T03:05:34Z",
    "updated_at": "2015-10-21T03:05:34Z",
    "body": "@alexcrichton \n\nAlright, fair enough.\n\nI believe @retep998 meant something similar to treating them as two targets, just not actually messing with the triples.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149768655/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149934081",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-149934081",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 149934081,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTkzNDA4MQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-21T15:34:12Z",
    "updated_at": "2015-10-21T15:34:29Z",
    "body": "Thinking about the current situation, it is already incredibly hairy as soon as you start mixing in dylibs using Cargo because now every single dylib and binary has to make sure they use `-Cprefer-dynamic` otherwise you'll get duplicate std errors. Not only that but any dependencies which are in common between two dylibs or a dylib and a binary also have to be built as dylibs or they'll be duplicates as well.\n\nAre there any actual real world situations where Cargo is successfully being used with some dependencies being linked in as dylibs? Would it be okay if Cargo made mixing of static and dynamic linking illegal or is there a valid use case that we'd want to preserve?\n\nAlso I think it is really silly that plugins are treated as normal dependencies, so Cargo has to assume that all dependencies will be linked in even if they actually get used as plugins instead. This really hamper's Cargo's ability to be smart about how to handle such dependencies. Also unfortunate that we can't easily add special support for plugins to `Cargo.toml` since it would be insta-stable because Cargo has no notion of stability, which isn't optimal considering plugins are unstable.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/149934081/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/150263875",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-150263875",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 150263875,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MDI2Mzg3NQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-22T15:32:41Z",
    "updated_at": "2015-10-22T15:32:41Z",
    "body": "@retep998 \n\nI'm ok saying mixing dynamic and static linking is fine to forbid (so long as we have a good reason) because I highly doubt it happens in the wild today. It's quite rare to specifically request a dylib as an intermediate artifact, and otherwise you either get it because you're a plugin. \n\nAlso, are you familiar with Cargo's support for plugins? Your claims that Cargo assumes plugins are linked and how Cargo can't be smart isn't quite correct. Cargo knows exactly which crates are plugins to know which chains of dependencies should be compiled for the host architecture instead of the target.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/150263875/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/150270982",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-150270982",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 150270982,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MDI3MDk4Mg==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-22T15:59:04Z",
    "updated_at": "2015-10-22T16:05:40Z",
    "body": "@alexcrichton\n\nOh, there is a `plugin` field in the `[lib]` section of `Cargo.toml`. Never noticed that before. Well, I guess that means Cargo does know everything it needs to know. In which case all we'd have to do is forbid mixing of rlib/dylib, make sure the plugin and all its dependencies are built and linked as dylibs, and make sure the dependencies of the binaries are built and linked as rlibs (unless someone decides to do everything as dylib instead because they want to have their own application plugins). Then `rustc` would know whether upstream dependencies will be linked dylibs or rlibs when doing code gen and dllimport can be applied precisely and correctly.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/150270982/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/151463471",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-151463471",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 151463471,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MTQ2MzQ3MQ==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-27T11:36:06Z",
    "updated_at": "2015-10-27T11:36:06Z",
    "body": "Cargo does not currently build dependencies of plugins as dylibs. So Cargo would first have to be modified to build all dependencies of plugins as dylibs. This would result in a shared dependency being built twice, once as an rlib for the binary, and again as a dylib for the plugin. Ideally rustc would be able to do it as a single compilation, only internally duplicating the code generation steps when there's a split between whether to use dllimport or not, but that could potentially be complicated so two separate rustc invocations is the easier way for now. Also `-Cprefer-dynamic` would be passed when compiling each dylib.\n\nOnce Cargo has been modified then rustc can be taught to always use dllimport when referring to an upstream dylib and never use dllimport when referring to an upstream rlib. It would also be nice to store metadata on this so that rustc doesn't later try to link against the wrong thing as a sanity check.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/151463471/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/232086480",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-232086480",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 232086480,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzMjA4NjQ4MA==",
    "user": {
      "login": "KindDragon",
      "id": 224272,
      "node_id": "MDQ6VXNlcjIyNDI3Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/224272?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/KindDragon",
      "html_url": "https://github.com/KindDragon",
      "followers_url": "https://api.github.com/users/KindDragon/followers",
      "following_url": "https://api.github.com/users/KindDragon/following{/other_user}",
      "gists_url": "https://api.github.com/users/KindDragon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/KindDragon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/KindDragon/subscriptions",
      "organizations_url": "https://api.github.com/users/KindDragon/orgs",
      "repos_url": "https://api.github.com/users/KindDragon/repos",
      "events_url": "https://api.github.com/users/KindDragon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/KindDragon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-07-12T15:33:55Z",
    "updated_at": "2016-07-12T15:36:37Z",
    "body": "JFI GCC suggest always use special C++ visibility attributes https://gcc.gnu.org/wiki/Visibility\n\n``` cpp\n#if defined _WIN32 || defined __CYGWIN__\n  #ifdef BUILDING_DLL\n    #ifdef __GNUC__\n      #define DLL_PUBLIC __attribute__ ((dllexport))\n    #else\n      #define DLL_PUBLIC __declspec(dllexport) // Note: actually gcc seems to also supports this syntax.\n    #endif\n  #else\n    #ifdef __GNUC__\n      #define DLL_PUBLIC __attribute__ ((dllimport))\n    #else\n      #define DLL_PUBLIC __declspec(dllimport) // Note: actually gcc seems to also supports this syntax.\n    #endif\n  #endif\n  #define DLL_LOCAL\n#else\n  #if __GNUC__ >= 4\n    #define DLL_PUBLIC __attribute__ ((visibility (\"default\")))\n    #define DLL_LOCAL  __attribute__ ((visibility (\"hidden\")))\n  #else\n    #define DLL_PUBLIC\n    #define DLL_LOCAL\n  #endif\n#endif\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/232086480/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/240924167",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-240924167",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 240924167,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MDkyNDE2Nw==",
    "user": {
      "login": "upsuper",
      "id": 333750,
      "node_id": "MDQ6VXNlcjMzMzc1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/333750?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/upsuper",
      "html_url": "https://github.com/upsuper",
      "followers_url": "https://api.github.com/users/upsuper/followers",
      "following_url": "https://api.github.com/users/upsuper/following{/other_user}",
      "gists_url": "https://api.github.com/users/upsuper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/upsuper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/upsuper/subscriptions",
      "organizations_url": "https://api.github.com/users/upsuper/orgs",
      "repos_url": "https://api.github.com/users/upsuper/repos",
      "events_url": "https://api.github.com/users/upsuper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/upsuper/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-08-19T04:19:55Z",
    "updated_at": "2016-08-19T04:19:55Z",
    "body": "@nikomatsakis \n\n> static variables are unusual\n\nFWIW, this is probably not true. Stylo extensively uses static variables to reference string atoms from Gecko side (see [this script](https://github.com/servo/servo/blob/12fcb7a2e7acd802a4868caf6a1fb5fbf94e3ccf/ports/geckolib/binding_tools/regen.py)), so it could potentially be affected. Also, I see tons of warnings like\n\n```\ngeckoservo.lib(style.0.o) : warning LNK4217: locally defined symbol ?rubyTextContainer@nsCSSAnonBoxes@@2PEAVnsICSSAnonBoxPseudo@@EA (public: static class nsICSSAnonBoxPseudo * nsCSSAnonBoxes::rubyTextContainer) imported in function _ZN5style19gecko_selector_impl13PseudoElement9from_atom17h219208fbc1c0455dE\n```\n\nwhen linking Gecko with Servo on Windows.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/240924167/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/240925100",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-240925100",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 240925100,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MDkyNTEwMA==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-08-19T04:28:50Z",
    "updated_at": "2016-08-19T04:28:50Z",
    "body": "@upsuper Those warnings mean that static is being referenced with `dllimport` despite the static being statically linked in and not actually imported from a DLL. Ideally Rust would know whether to apply `dllimport` and you wouldn't see those warnings.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/240925100/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241917377",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-241917377",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 241917377,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTkxNzM3Nw==",
    "user": {
      "login": "Ericson2314",
      "id": 1055245,
      "node_id": "MDQ6VXNlcjEwNTUyNDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1055245?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ericson2314",
      "html_url": "https://github.com/Ericson2314",
      "followers_url": "https://api.github.com/users/Ericson2314/followers",
      "following_url": "https://api.github.com/users/Ericson2314/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ericson2314/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ericson2314/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ericson2314/subscriptions",
      "organizations_url": "https://api.github.com/users/Ericson2314/orgs",
      "repos_url": "https://api.github.com/users/Ericson2314/repos",
      "events_url": "https://api.github.com/users/Ericson2314/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ericson2314/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-08-23T23:48:45Z",
    "updated_at": "2016-08-23T23:52:28Z",
    "body": "https://github.com/rust-lang/rfcs/pull/1717 should fix this? (I didn't see it fixed)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241917377/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241917844",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-241917844",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 241917844,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTkxNzg0NA==",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-08-23T23:51:16Z",
    "updated_at": "2016-08-23T23:51:16Z",
    "body": "@Ericson2314 did you mean #31717? Since the issue you mentioned is about changing the precedence of `as`...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241917844/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241917953",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-241917953",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 241917953,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTkxNzk1Mw==",
    "user": {
      "login": "Ericson2314",
      "id": 1055245,
      "node_id": "MDQ6VXNlcjEwNTUyNDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1055245?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ericson2314",
      "html_url": "https://github.com/Ericson2314",
      "followers_url": "https://api.github.com/users/Ericson2314/followers",
      "following_url": "https://api.github.com/users/Ericson2314/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ericson2314/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ericson2314/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ericson2314/subscriptions",
      "organizations_url": "https://api.github.com/users/Ericson2314/orgs",
      "repos_url": "https://api.github.com/users/Ericson2314/repos",
      "events_url": "https://api.github.com/users/Ericson2314/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ericson2314/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-08-23T23:51:53Z",
    "updated_at": "2016-08-23T23:52:35Z",
    "body": "Sorry, meant to link an RFC. Fixed now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241917953/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241920070",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-241920070",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 241920070,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTkyMDA3MA==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-08-24T00:04:46Z",
    "updated_at": "2016-08-24T00:04:46Z",
    "body": "@Ericson2314 It will fix the situation for FFI. However it doesn't apply to inter-crate linking as Rust still doesn't know whether a dependency will be linked as an rlib or a dylib until link time, when it needs to know it at code generation time.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/241920070/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/337476153",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-337476153",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 337476153,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNzQ3NjE1Mw==",
    "user": {
      "login": "retep998",
      "id": 666308,
      "node_id": "MDQ6VXNlcjY2NjMwOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/retep998",
      "html_url": "https://github.com/retep998",
      "followers_url": "https://api.github.com/users/retep998/followers",
      "following_url": "https://api.github.com/users/retep998/following{/other_user}",
      "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/retep998/subscriptions",
      "organizations_url": "https://api.github.com/users/retep998/orgs",
      "repos_url": "https://api.github.com/users/retep998/repos",
      "events_url": "https://api.github.com/users/retep998/events{/privacy}",
      "received_events_url": "https://api.github.com/users/retep998/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-10-18T06:46:19Z",
    "updated_at": "2017-10-18T06:46:19Z",
    "body": "As an extreme solution to the problem of `dllimport`/`dllexport` between crates, we can ditch the `dylib` crate type completely. Thus rust crates will always be statically linked together so we can simply never apply `dllimport` or `dllexport`.\r\n\r\nFFI currently has this working *mostly* thanks to `kind=dylib` applying `dllimport` and `kind=static-nobundle` not applying `dllimport`. We just need `kind=static-nobundle` to be stabilized (or to replace `kind=static` wholesale).",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/337476153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/665727358",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-665727358",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 665727358,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTcyNzM1OA==",
    "user": {
      "login": "mati865",
      "id": 1174646,
      "node_id": "MDQ6VXNlcjExNzQ2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1174646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mati865",
      "html_url": "https://github.com/mati865",
      "followers_url": "https://api.github.com/users/mati865/followers",
      "following_url": "https://api.github.com/users/mati865/following{/other_user}",
      "gists_url": "https://api.github.com/users/mati865/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mati865/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mati865/subscriptions",
      "organizations_url": "https://api.github.com/users/mati865/orgs",
      "repos_url": "https://api.github.com/users/mati865/repos",
      "events_url": "https://api.github.com/users/mati865/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mati865/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-07-29T15:17:38Z",
    "updated_at": "2020-07-29T15:55:00Z",
    "body": "Windows-gnu targets now also use dllimport/dllexport for various reasons: https://github.com/rust-lang/rust/pull/72049\r\nCan we update this issue?",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/665727358/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/665731670",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-665731670",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 665731670,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTczMTY3MA==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-07-29T15:25:07Z",
    "updated_at": "2020-07-29T15:54:54Z",
    "body": "@mati865 do you mean to update the top comment? if you want to supply some replacement text, I can insert it (presumin you don't have the required perms)",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/665731670/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/665739234",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-665739234",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 665739234,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTczOTIzNA==",
    "user": {
      "login": "mati865",
      "id": 1174646,
      "node_id": "MDQ6VXNlcjExNzQ2NDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1174646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mati865",
      "html_url": "https://github.com/mati865",
      "followers_url": "https://api.github.com/users/mati865/followers",
      "following_url": "https://api.github.com/users/mati865/following{/other_user}",
      "gists_url": "https://api.github.com/users/mati865/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mati865/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mati865/subscriptions",
      "organizations_url": "https://api.github.com/users/mati865/orgs",
      "repos_url": "https://api.github.com/users/mati865/repos",
      "events_url": "https://api.github.com/users/mati865/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mati865/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2020-07-29T15:38:20Z",
    "updated_at": "2020-07-29T15:54:48Z",
    "body": "@nikomatsakis yeah, my proposed changes:\r\n- remove `/MSVC` from the title\r\n- `For importing constants from other DLLs, however, the linker requires that dllimport is annotated correctly.` -> `For importing constants from other DLLs, however, MSVC linker requires that dllimport is annotated correctly. MinGW linkers can sometimes workaround it (see [this commit](https://github.com/llvm/llvm-project/commit/eac1b05f1db91097eb37d975e07789ce039cf7f7) description.`\r\n- `If we're targeting MSVC` -> `If we're targeting Windows`\r\n\r\nThanks in advance.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/665739234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360332201",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-2360332201",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 2360332201,
    "node_id": "IC_kwDOAAsO6M6Mr8-p",
    "user": {
      "login": "eerii",
      "id": 22449369,
      "node_id": "MDQ6VXNlcjIyNDQ5MzY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/22449369?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eerii",
      "html_url": "https://github.com/eerii",
      "followers_url": "https://api.github.com/users/eerii/followers",
      "following_url": "https://api.github.com/users/eerii/following{/other_user}",
      "gists_url": "https://api.github.com/users/eerii/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eerii/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eerii/subscriptions",
      "organizations_url": "https://api.github.com/users/eerii/orgs",
      "repos_url": "https://api.github.com/users/eerii/repos",
      "events_url": "https://api.github.com/users/eerii/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eerii/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-09-19T08:25:59Z",
    "updated_at": "2024-09-19T08:25:59Z",
    "body": "I have been [struggling](https://github.com/gtk-rs/gtk-rs-core/pull/1508) with dllimport for the past week, and the current limitations, this is just meant as an overview so that other people that face this issue may understand the current status. Please correct me if I understood anything wrong.\n\n- Dllimport is only called on `extern` blocks when they are annotated with the [`#[link]`](https://doc.rust-lang.org/reference/items/external-blocks.html#the-link-attribute) attribute. The relevant code is [here](https://github.com/rust-lang/rust/blob/170d6cb845c8c3f0dcec5cdd4210df9ecf990244/compiler/rustc_metadata/src/native_libs.rs#L417).\n- When linking libraries using [`rusct-link-lib`](https://doc.rust-lang.org/cargo/reference/build-scripts.html#rustc-link-lib) dllimport is **not** called on the symbols. This seems to be a limitation of the current code, since it relies on getting the symbols during the attribute codegen.\n- When [renaming libraries](https://doc.rust-lang.org/rustc/command-line-arguments.html#option-l-link-lib) with `rusct-link-lib`, after they have been annotated with `#[link]`, dllimport is still called.\n- `#[link]` is currently the only way to call dllimport on Rust.\n- Dllimport and hence `#[link]` is not needed for functions, since MSVC exports both symbols, with and without the `__imp_`. However, MSVC only exports the `__imp_` prefixed symbol for variables, so `#[link]` is a must (or some tricks to link to the symbol directly using [`link_name`](https://doc.rust-lang.org/reference/items/external-blocks.html#the-link_name-attribute) and conditionals, but that seems hacky and fragile).\n\nUsing the `#[link]` attribute is fine in most cases. However, when using something like [`system-deps`](https://github.com/gdesmott/system-deps) to get and link the system libraries on the build script using `pkg-config` files, in the best case it is redundant, but in the worse it gets in the way. This is because if the library has a different name on the system, or if you want to link to a different library (in our case, we want to use `gstreamer-full` to replace all of the individual `glib`, `gobject`, `gstreamer-*` and so on), the link attribute still links the one with the previous name as well.\n\nIt is possible to rename the libraries from the build script, but it is hard to do so from dependent crates, as described in rust-lang/cargo#6519. The most viable way is using [`links`](https://doc.rust-lang.org/cargo/reference/build-scripts.html#the-links-manifest-key) and [overriding build scripts](https://doc.rust-lang.org/cargo/reference/build-scripts.html#overriding-build-scripts). However, its support is very restricted at the moment, forcing to use specific targets and not allowing `cfg` options (rust-lang/cargo#11042).\n\nWhile it may not be feasible to automatically detect the symbols in which to apply dllimport when not using a `#[link]` attribute, there are some suggestions that might make it easier to work with:\n\n- Allow to remove the library that a `#[link]` attribute is linking to, while keeping the dllimport calls. This has been proposed [in this issue](https://github.com/rust-lang/cargo/issues/6519#issuecomment-452795856) and in the [rcf for dllimport](https://rust-lang.github.io/rfcs/1717-dllimport.html#unresolved-questions), using a syntax like `rustc-link-lib:LIBNAME:`.\n- Allow to use the `#[link]` attribute without a name. This seems difficult since it would be hard to determine which type of linking it needs to have and without a name it is harder to overwrite it later.\n- Improve the support for `links` overrides by allowing `cfg` flags to configure it, following the issue rust-lang/cargo#11042. This doesn't need to include features or solve rust-lang/cargo#8170, but allowing to configure the `rustc-link-lib` calls for dependencies would be very useful and avoids workarounds.\n\nTo summarize, the main issue right now is that linking to global variables doesn't work on Windows without using `#[link]`, and this can cause trouble when linking against alternate libraries.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360332201/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360478418",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-2360478418",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 2360478418,
    "node_id": "IC_kwDOAAsO6M6MsgrS",
    "user": {
      "login": "bjorn3",
      "id": 17426603,
      "node_id": "MDQ6VXNlcjE3NDI2NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bjorn3",
      "html_url": "https://github.com/bjorn3",
      "followers_url": "https://api.github.com/users/bjorn3/followers",
      "following_url": "https://api.github.com/users/bjorn3/following{/other_user}",
      "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions",
      "organizations_url": "https://api.github.com/users/bjorn3/orgs",
      "repos_url": "https://api.github.com/users/bjorn3/repos",
      "events_url": "https://api.github.com/users/bjorn3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bjorn3/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-09-19T09:25:37Z",
    "updated_at": "2024-09-19T09:25:37Z",
    "body": "Would it be possible for the build script to set an env var with the name of the library and then use `#[link(name = env!(\"LIBNAME\"))]`? You need `#[link]` outside of Windows too of you are building a dylib which links against a C staticlib for rustc to correctly export all imported symbols of the staticlib from the dylib of they may be used outside of the dylib.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360478418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360542672",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-2360542672",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 2360542672,
    "node_id": "IC_kwDOAAsO6M6MswXQ",
    "user": {
      "login": "eerii",
      "id": 22449369,
      "node_id": "MDQ6VXNlcjIyNDQ5MzY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/22449369?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eerii",
      "html_url": "https://github.com/eerii",
      "followers_url": "https://api.github.com/users/eerii/followers",
      "following_url": "https://api.github.com/users/eerii/following{/other_user}",
      "gists_url": "https://api.github.com/users/eerii/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eerii/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eerii/subscriptions",
      "organizations_url": "https://api.github.com/users/eerii/orgs",
      "repos_url": "https://api.github.com/users/eerii/repos",
      "events_url": "https://api.github.com/users/eerii/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eerii/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-09-19T09:56:23Z",
    "updated_at": "2024-09-19T09:56:23Z",
    "body": "> Would it be possible for the build script to set an env var with the name of the library and then use `#[link(name = env!(\"LIBNAME\"))]`?\n\nIs it possible to use `env!` on an attribute? I thought it was not supported yet (rust-lang/rust#52393). Having support for that would be another possible workaround for this.\n\n> You need `#[link]` outside of Windows too of you are building a dylib which links against a C staticlib for rustc to correctly export all imported symbols of the staticlib from the dylib of they may be used outside of the dylib.\n\nNo, in our case `#[link]` is only needed in Windows for correctly calling dllimport on the symbols when the conditions are right. The rest of the linking happens withing the build script, using `system-deps` which ultimately calls `rustc-link-lib`.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360542672/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360553557",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-2360553557",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 2360553557,
    "node_id": "IC_kwDOAAsO6M6MszBV",
    "user": {
      "login": "ChrisDenton",
      "id": 4459874,
      "node_id": "MDQ6VXNlcjQ0NTk4NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChrisDenton",
      "html_url": "https://github.com/ChrisDenton",
      "followers_url": "https://api.github.com/users/ChrisDenton/followers",
      "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions",
      "organizations_url": "https://api.github.com/users/ChrisDenton/orgs",
      "repos_url": "https://api.github.com/users/ChrisDenton/repos",
      "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChrisDenton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-09-19T10:01:31Z",
    "updated_at": "2024-09-19T10:01:31Z",
    "body": "I believe the specific issue of setting the import library name separately could be adequately solved by allowing a link `kind` without a name (your second option):\n\n```rust\n// Without a `name`, only `kind` is allowed here\n// This would be the equivalent of using `__declspec(dllimport)` in Windows C/C++\n#[link(kind = \"dylib\")]\nextern \"C\" {\n    ...\n}\n\n// kind=static is redundant here but allowed for consistency\n// other kinds are not allowed\n#[link(kind = \"static\")]\nextern \"C\" {\n    ...\n}\n```\n\nFrom what I can see, putting a name on an import block does not in any way connect that name to the functions or statics used in the `extern` block (unless using `raw-dylib`). That means a (not great) workaround to implement the above in stable Rust is:\n\n```rust\n// `empty` is just a lib file with no contents that we add to the search path.\n// Even more hackily, we could use a well known lib name like \"kernel32\" which almost certainly exists.\n// Either way this allows the real lib name to be supplied separately.\n#[link(name = \"empty\", kind = \"dylib\")] // The kind here is redundant \nextern \"C\" {\n    ...\n}\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360553557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360672007",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-2360672007",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 2360672007,
    "node_id": "IC_kwDOAAsO6M6MtP8H",
    "user": {
      "login": "eerii",
      "id": 22449369,
      "node_id": "MDQ6VXNlcjIyNDQ5MzY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/22449369?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eerii",
      "html_url": "https://github.com/eerii",
      "followers_url": "https://api.github.com/users/eerii/followers",
      "following_url": "https://api.github.com/users/eerii/following{/other_user}",
      "gists_url": "https://api.github.com/users/eerii/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eerii/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eerii/subscriptions",
      "organizations_url": "https://api.github.com/users/eerii/orgs",
      "repos_url": "https://api.github.com/users/eerii/repos",
      "events_url": "https://api.github.com/users/eerii/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eerii/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-09-19T10:59:36Z",
    "updated_at": "2024-09-19T10:59:36Z",
    "body": "> I believe the specific issue of setting the import library name separately could be adequately solved by allowing a link `kind` without a name\n\nThe issue that I can see with this would be how to override the linking type on the build script. If you have a name you can rename the library and change the type later with `rustc-link-lib`, but in this case, how would you change the linking type later?\n\n> From what I can see, putting a name on an import block does not in any way connect that name to the functions or statics used in the `extern` block (unless using `raw-dylib`). That means a (not great) workaround to implement the above in stable Rust is:\n\nThat's not the worst workaround, but it relies on having certain libraries installed which may not be the case for all users.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360672007/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360715065",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-2360715065",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 2360715065,
    "node_id": "IC_kwDOAAsO6M6Mtac5",
    "user": {
      "login": "ChrisDenton",
      "id": 4459874,
      "node_id": "MDQ6VXNlcjQ0NTk4NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChrisDenton",
      "html_url": "https://github.com/ChrisDenton",
      "followers_url": "https://api.github.com/users/ChrisDenton/followers",
      "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions",
      "organizations_url": "https://api.github.com/users/ChrisDenton/orgs",
      "repos_url": "https://api.github.com/users/ChrisDenton/repos",
      "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChrisDenton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-09-19T11:22:25Z",
    "updated_at": "2024-09-19T11:23:14Z",
    "body": "> That's not the worst workaround, but it relies on having certain libraries installed which may not be the case for all users.\n\nYou can supply an `empty.lib` file (or `libempty.a` for mingw) just using a build script without the user needing to have anything installed. Edit: though admittedly, it is a hack.\n\n> The issue that I can see with this would be how to override the linking type on the build script. If you have a name you can rename the library and change the type later with `rustc-link-lib`, but in this case, how would you change the linking type later?\n\nTrue, if you need to switch between dylib and static you'd need to use `#[cfg_attr]` to set the `#[link]` line with a custom cfg (rather than a Cargo feature).",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360715065/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360776637",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-2360776637",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 2360776637,
    "node_id": "IC_kwDOAAsO6M6Mtpe9",
    "user": {
      "login": "ChrisDenton",
      "id": 4459874,
      "node_id": "MDQ6VXNlcjQ0NTk4NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChrisDenton",
      "html_url": "https://github.com/ChrisDenton",
      "followers_url": "https://api.github.com/users/ChrisDenton/followers",
      "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions",
      "organizations_url": "https://api.github.com/users/ChrisDenton/orgs",
      "repos_url": "https://api.github.com/users/ChrisDenton/repos",
      "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChrisDenton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-09-19T11:52:03Z",
    "updated_at": "2024-09-19T11:52:03Z",
    "body": "Oh actually, if you always override the name then it doesn't have to actually exist. I tried `name = \"<DOESNOTEXIST>\"` and it worked with an override.",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2360776637/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2361179723",
    "html_url": "https://github.com/rust-lang/rust/issues/27438#issuecomment-2361179723",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/27438",
    "id": 2361179723,
    "node_id": "IC_kwDOAAsO6M6MvL5L",
    "user": {
      "login": "eerii",
      "id": 22449369,
      "node_id": "MDQ6VXNlcjIyNDQ5MzY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/22449369?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eerii",
      "html_url": "https://github.com/eerii",
      "followers_url": "https://api.github.com/users/eerii/followers",
      "following_url": "https://api.github.com/users/eerii/following{/other_user}",
      "gists_url": "https://api.github.com/users/eerii/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eerii/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eerii/subscriptions",
      "organizations_url": "https://api.github.com/users/eerii/orgs",
      "repos_url": "https://api.github.com/users/eerii/repos",
      "events_url": "https://api.github.com/users/eerii/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eerii/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2024-09-19T14:35:37Z",
    "updated_at": "2024-09-19T14:37:41Z",
    "body": "That's not a bad workaround actually, it beats linking directly to the `__imp_*` symbol and manually dereferencing it conditionally. However, the issue with renaming the library is the same as before, it is harder to do from upstream crates, since the instruction has to come from the build script of the crate. You can't pass env variables conditionally, and links overrides are also not very configurable. But using an empty library generated in build.rs like you first suggested may be a reasonable workaround in the meantime. In our project, we ended up being able to remove the one problematic variable and replace it with a function call, but this is not ideal and the problem still persists in other instances.",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/2361179723/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
