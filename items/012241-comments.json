[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34975231",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-34975231",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 34975231,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTc1MjMx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-13T12:57:01Z",
    "updated_at": "2014-02-13T12:57:01Z",
    "body": "I don't have a good explanation why `100_invalid` would be slower, especially since `first_non_utf8_index` is called only once in it, at the very start.\n\ncc @kballard \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34975231/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34978057",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-34978057",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 34978057,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTc4MDU3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-13T13:37:11Z",
    "updated_at": "2014-02-13T13:37:11Z",
    "body": "I'm a little sad about all the new `unsafe` code as part of this commit, is there no way to limit the scope of the unsafe code or remove it entirely?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34978057/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34978245",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-34978245",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 34978245,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTc4MjQ1",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-13T13:39:33Z",
    "updated_at": "2014-02-13T13:39:33Z",
    "body": "Well, it's having to manipulate pointers directly, so I find it unlikely that it can be anywhere near as efficient any other way. (e.g. manually stepping an iterator puts bounds checks on every access, like the old code.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34978245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34978606",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-34978606",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 34978606,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTc4NjA2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-13T13:44:01Z",
    "updated_at": "2014-02-13T13:44:01Z",
    "body": "I find it somewhat difficult to believe that it is _impossible_ for safe code to reach this same level of performance. \n\nI'm not saying that this should have it all removed, but we're getting into the habit of reaching for `unsafe` far too frequently that it's diminishing the usefulness of it. I feel like a good rule of thumb is that every `unsafe` block should be documented why it needs to be `unsafe` and why it can't be done with `unsafe` code (unless it's already apparent). Could you add some comments explaining why `unsafe` is used and why it's used in such a large scope?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34978606/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35016827",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35016827",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35016827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDE2ODI3",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-13T19:38:27Z",
    "updated_at": "2014-02-13T19:38:27Z",
    "body": "@huonw `from_utf8_lossy_100_invalid` is likely doing a bunch of reallocations. Each invalid byte is replaced by 3 bytes in the output. It's also writing 3 bytes a time instead of writing the entire contiguous good chunk, as happens with valid utf8.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35016827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35017106",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35017106",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35017106,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDE3MTA2",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-13T19:41:03Z",
    "updated_at": "2014-02-13T19:41:03Z",
    "body": "I'm willing to r=me this, but I will defer to @alexcrichton's caution.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35017106/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35022360",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35022360",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35022360,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDIyMzYw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-13T20:31:14Z",
    "updated_at": "2014-02-13T20:31:14Z",
    "body": "Can this be implemented with a byte iterator? That would eliminate all bounds checks and you'd only have the `unwrap`-related checks when dealing with wider characters. In theory we could extend the byte iterator to have a `take2` method if we want to go even further reducing checks, but if bounds checks were the major issue it seems that a byte iterator should fix that?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35022360/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35024740",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35024740",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35024740,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDI0NzQw",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-13T20:55:01Z",
    "updated_at": "2014-02-13T20:55:01Z",
    "body": "@kballard both the new and old version are doing the same reallocations, so that doesn't explain why the timing is different between them.\n\n@alexcrichton the byte iterator is doing a bound check on every access (to see if it's at the end or not), and it's not being used in a tight loop, so I find it unlikely that LLVM will be able to streamline it well; I'll have a go though.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35024740/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35026725",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35026725",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35026725,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDI2NzI1",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-13T21:15:02Z",
    "updated_at": "2014-02-13T21:15:02Z",
    "body": "@huonw Oh I see what you're saying. Perhaps `first_non_utf8_index` has more overhead in the case where it fails at index 0 than the old implementation did? I'm curious what the benchmark change is for a test where the first byte is invalid but the rest of the string is valid.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35026725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35031873",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35031873",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35031873,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDMxODcz",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-13T22:04:56Z",
    "updated_at": "2014-02-13T22:04:56Z",
    "body": "@alexcrichton: Generally, iterator bounds checks are not optimized away at any level including LTO. It seems to me like LLVM does not have enough information.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35031873/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35148321",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35148321",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35148321,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTQ4MzIx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-15T05:51:57Z",
    "updated_at": "2014-02-15T05:52:41Z",
    "body": "I investigated using iterators, results:\n\n```\ntest is_utf8_iter::is_utf8_100_ascii            ... bench:       144 ns/iter (+/- 10)\ntest is_utf8_iter::is_utf8_100_multibyte        ... bench:       120 ns/iter (+/- 12)\ntest is_utf8_iter::random                       ... bench:       494 ns/iter (+/- 33)\ntest is_utf8_iter::random_invalid               ... bench:       276 ns/iter (+/- 443)\n\ntest is_utf8_iter_inline::is_utf8_100_ascii     ... bench:       116 ns/iter (+/- 1)\ntest is_utf8_iter_inline::is_utf8_100_multibyte ... bench:       110 ns/iter (+/- 3)\ntest is_utf8_iter_inline::random                ... bench:       493 ns/iter (+/- 34)\ntest is_utf8_iter_inline::random_invalid        ... bench:       249 ns/iter (+/- 400)\n\ntest is_utf8_ptr::is_utf8_100_ascii             ... bench:        88 ns/iter (+/- 5)\ntest is_utf8_ptr::is_utf8_100_multibyte         ... bench:        97 ns/iter (+/- 4)\ntest is_utf8_ptr::random                        ... bench:       369 ns/iter (+/- 24)\ntest is_utf8_ptr::random_invalid                ... bench:       239 ns/iter (+/- 342)\n\ntest is_utf8_std::is_utf8_100_ascii             ... bench:       122 ns/iter (+/- 4)\ntest is_utf8_std::is_utf8_100_multibyte         ... bench:       134 ns/iter (+/- 9)\ntest is_utf8_std::random                        ... bench:       512 ns/iter (+/- 43)\ntest is_utf8_std::random_invalid                ... bench:       264 ns/iter (+/- 430)\n```\n\n`std` is the current implementation, `ptr` is this PR, `iter` and `iter_inline` are two iterator variants; [source](https://gist.github.com/huonw/4965dcf520b956cad81a).\n\nSo the iterator versions is slightly faster than the current implementation (and with no `unsafe`, unlike the either the one in std or this PR's pointer one), but still significantly slower than the pointer version here. I think the the pure-ASCII case is hampered by #11751.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35148321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35148373",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35148373",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35148373,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTQ4Mzcz",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-15T05:55:23Z",
    "updated_at": "2014-02-15T05:55:23Z",
    "body": "Given how core a functionality `is_utf8` is I'm in favor of going with the unsafe (but fastest) ptr approach.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35148373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35148431",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35148431",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35148431,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTQ4NDMx",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-15T06:00:01Z",
    "updated_at": "2014-02-15T06:00:01Z",
    "body": "If we do decide to go with this pointer approach, I'll write a proof of safety as comments in the source, as a substitute for compiler verification.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35148431/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35170519",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35170519",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35170519,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTcwNTE5",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-15T22:48:32Z",
    "updated_at": "2014-02-15T22:48:32Z",
    "body": "Thank you for the thorough investigation, it's quite useful!\n\nI'm not quite ready to give up this battle though, I was curious why the pure-ascii case with iterators was so much slower than with pointers, so I did some investigation of my own. With [this code](https://gist.github.com/anonymous/9026267) I got these timings:\n\n```\n$ rustc --opt-level=3 gistfile1.rs --test -Zlto && ./gistfile1 --bench is_utf8_100_ascii \n\nrunning 2 tests\ntest is_utf8_iter_inline::is_utf8_100_ascii ... bench:        95 ns/iter (+/- 2)\ntest is_utf8_ptr::is_utf8_100_ascii         ... bench:        63 ns/iter (+/- 1)\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 2 measured\n```\n\nThese results lead me to believe that the vector iterator isn't quite as good as it could be, and it's leading us to unsafe code in this implementation. With this in mind, I continue to be hesitant to merging this. I believe that the speedup from using unsafe code is at least partly a result of this vector iterator performance issue.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35170519/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35170733",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35170733",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35170733,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTcwNzMz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-15T22:58:37Z",
    "updated_at": "2014-02-15T22:58:37Z",
    "body": "@huonw pointed me at #11751 on IRC, which is in turn caused by #9546, which is the cause of the slowdown that I was seeing.\n\nI am tempted to postpone the unsafe change until #9546 is fixed, I would be more than happy to accept the iterator changes, however.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35170733/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35180323",
    "html_url": "https://github.com/rust-lang/rust/pull/12241#issuecomment-35180323",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12241",
    "id": 35180323,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTgwMzIz",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-16T08:53:30Z",
    "updated_at": "2014-02-16T08:53:30Z",
    "body": "Iterators in #12314.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35180323/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
