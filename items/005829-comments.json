[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/16211894",
    "html_url": "https://github.com/rust-lang/rust/issues/5829#issuecomment-16211894",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/5829",
    "id": 16211894,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MjExODk0",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-04-11T01:10:03Z",
    "updated_at": "2013-04-11T01:10:03Z",
    "body": "I've run into a lot of similar errors, and the common case which I've seen is that the compiler really doesn't like borrowed pointers in structs with mutable methods. Even something as simple as below fails to compile:\n\n``` rust\nstruct Foo<'self> {\n  a: &'self int\n}\n\nimpl<'self> Foo<'self> {\n  fn foo(&mut self) {}\n}\n\nfn main() {\n  let n = 1;\n  let mut foo = Foo { a: &n };\n  foo.foo();\n  foo.foo();\n}\n```\n\nI'm not sure if this is an actual error or some bug in the compiler, but I do agree that the error message could probably be more helpful.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/16211894/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/16340393",
    "html_url": "https://github.com/rust-lang/rust/issues/5829#issuecomment-16340393",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/5829",
    "id": 16340393,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MzQwMzkz",
    "user": {
      "login": "stevenblenkinsop",
      "id": 3118803,
      "node_id": "MDQ6VXNlcjMxMTg4MDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3118803?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevenblenkinsop",
      "html_url": "https://github.com/stevenblenkinsop",
      "followers_url": "https://api.github.com/users/stevenblenkinsop/followers",
      "following_url": "https://api.github.com/users/stevenblenkinsop/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevenblenkinsop/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevenblenkinsop/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevenblenkinsop/subscriptions",
      "organizations_url": "https://api.github.com/users/stevenblenkinsop/orgs",
      "repos_url": "https://api.github.com/users/stevenblenkinsop/repos",
      "events_url": "https://api.github.com/users/stevenblenkinsop/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevenblenkinsop/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-04-13T20:37:13Z",
    "updated_at": "2013-04-14T06:04:34Z",
    "body": "This is correct. The problem is that the lifetime of the borrow is the same as a lifetime that escapes the function call, in this case via a mutable field, and therefore it persists for the lifetime of the mutable field. Consider this code:\n\n``` rust\nstruct T<'self> {\n    x: &'self mut int,\n    y: int,\n}\n\nfn F1<'a>(t: &'a mut T<'a>) {\n    *&mut t.x = &mut t.y;\n}\n\nfn F2<'a, 'b>(_t: &'a mut T<'b>) {\n}\n\nfn main() {\n    let mut x = 5;\n    let mut t = T{x: &mut x, y: 6};\n    F2(&mut t);\n    F2(&mut t);\n}\n```\n\nIn `F1`, I'm able to move my mutable borrow of `t` into `t.x` so that it persists for the lifetime of `t.x`, which is the entire body of `main`. Therefore, no other borrows of `t` can coexist with an `F1(&mut t);` call. However, in `F2`, because `t` and `t.x` have different lifetimes, my mutable borrow of `t` can't escape, so multiple `F2(&mut t);` calls are okay.\n\nUnfortunately, this trick doesn't quite work yet in rust-0.6 when it comes to methods because of how the lifetime of the `self` parameter is handled. This is issue #5656.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/16340393/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/16341978",
    "html_url": "https://github.com/rust-lang/rust/issues/5829#issuecomment-16341978",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/5829",
    "id": 16341978,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MzQxOTc4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-04-13T22:17:43Z",
    "updated_at": "2013-04-13T22:17:43Z",
    "body": "This is fixed thanks to all the work @nikomatsakis did on making the `self` parameter use an explicit region.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/16341978/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
