[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26661432",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-26661432",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 26661432,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2NjYxNDMy",
    "user": {
      "login": "Kimundi",
      "id": 2903206,
      "node_id": "MDQ6VXNlcjI5MDMyMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2903206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kimundi",
      "html_url": "https://github.com/Kimundi",
      "followers_url": "https://api.github.com/users/Kimundi/followers",
      "following_url": "https://api.github.com/users/Kimundi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kimundi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kimundi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kimundi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kimundi/orgs",
      "repos_url": "https://api.github.com/users/Kimundi/repos",
      "events_url": "https://api.github.com/users/Kimundi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kimundi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-19T23:40:06Z",
    "updated_at": "2013-10-19T23:40:06Z",
    "body": "cc @brson and @catamorphism \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26661432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26746945",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-26746945",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 26746945,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2NzQ2OTQ1",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-21T19:13:56Z",
    "updated_at": "2013-10-21T19:13:56Z",
    "body": "We should probably discuss `~Any` in the weekly meeting before merging this.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26746945/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26861302",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-26861302",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 26861302,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2ODYxMzAy",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-22T22:49:13Z",
    "updated_at": "2013-10-22T22:49:13Z",
    "body": "Looks good! I think that I too would like tasks to just always fail with an `~Any`. Yes, it means that all failure requires an allocation, and that might be especially tricky for OOM failures, but exceptions are exceptional, so this doesn't strike me as something that needs to be optimal, and the simplicity of just catching `~Any` is attractive.\n\nIn the future we will want to consider whether this should actually be a special dynamic `~Error` type with some standard error-related methods.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26861302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26868804",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-26868804",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 26868804,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2ODY4ODA0",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-23T00:17:25Z",
    "updated_at": "2013-10-23T00:17:25Z",
    "body": "(Needs a rebase.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26868804/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26889276",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-26889276",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 26889276,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2ODg5Mjc2",
    "user": {
      "login": "Kimundi",
      "id": 2903206,
      "node_id": "MDQ6VXNlcjI5MDMyMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2903206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kimundi",
      "html_url": "https://github.com/Kimundi",
      "followers_url": "https://api.github.com/users/Kimundi/followers",
      "following_url": "https://api.github.com/users/Kimundi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kimundi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kimundi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kimundi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kimundi/orgs",
      "repos_url": "https://api.github.com/users/Kimundi/repos",
      "events_url": "https://api.github.com/users/Kimundi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kimundi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-23T08:51:27Z",
    "updated_at": "2013-10-23T09:00:32Z",
    "body": "So, how should I proceed? \n\nIn case of changing this PR to only use `~Any`, which is motivated to make the `try` interface simpler, I see a few possibilities on how to do that:\n\n### On the `future_result()` and `try` side:\n1. Only change `future_result` (and `try`) to expose a `~Any` instead of a `FailCause` in case of an error, keeping the three possible failure types `LinkedFailure`, `SendStr` and `~Any` for internal failure propagation.\n   - This would mean only `future_result()` needs to allocate the `~Any` box in case of one of the string types or `struct LinkedFailure;`\n   - The user would also be able to propagate or manually allocate an `~Any` for failure.\n   - User handling of task failure would only deal with `~Any`\n   - The OOM case could possibly be solved by this, as the allocation for `LinkedFailure` and `SendStr` could happen in the task that received the failure, rather than the one that initiated it.\n2. Remove the `FailCause` enum completely\n   - This would mean that the runtime needs to allocate a lot of `struct LinkedFailure; ~LinkedFailure as ~Any` during unwinding.\n   - Same for the `FailCauseStr` enum variant, it would need to allocate during the `fail!()` call.\n   - The user would still just need to deal with an `~Any`, but the runtime would allocate more during unwinding.\n\n### On the `fail!()` side:\n1. Keep the number of possible failure types restricted to `&'static str`, `~str`, `SendStr` and `~Any`.\n   - This would allow for `fail!(\"foo\")`, `fail!(~\"foo\")`, but needs `fail!(~Foo as ~Any)` for the `~Any` case (Possibly only `fail!(~Foo)` in the future, if trait object coercion gets implemented). \n   - This would mean user code needs to be explicit if it wants to fail with `~Any`, unless trait object coercion gets implemented.\n2. Allow failing with any type passed to `fail!()` directly. `fail!(\"foo\")`, `fail!(~\"foo\")` and `fail!(Foo)` would all work, but all allocate a new `~` box and cast it to a `~Any`\n   - This would mean that failure always involves a hidden allocation at the initiation of the failure, rather than at the evaluation of the result, which would be more problematic and opaque.\n   - This would also mean users could not fail with or propagate a provided `~Any`, as every fail!() would wrap it in a new layer of `~Any`\n   - This would also also pose problems for some kinds of generic code I'm working on which tries to expose an interface that allows the failure message to either be provided eagerly, or computed lazy, which involves an implementation of a trait on both a specific `T`, and a `fn() -> T`. Fail allowing any type would mean this would conflict with each other. (The Api is intended for `Option::expect` to allow both `opt.expect(\"message\")` and `opt.expect(|| expensive_computed_message())` that should be called only in case of an actual `None` value.)\n\n---\n\nPersonally, I think if the user only needing to worry about `~Any` is desirably, then I would choose the first variant on both sides: \n\n`future_result()` and `try` only exposes a `~Any`, but internally there are still fast paths for the (currently) usual case of failing with a string and because of linked failure. \n\nUser code that wants to fail also needs to explicitly allocate the `~` box if it wants to fail with an `~Any`, which would be good for being explicit with the allocation, and which allows easy propagation of failure values (just `fail!` again with the received value).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26889276/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26892123",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-26892123",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 26892123,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2ODkyMTIz",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-23T09:43:33Z",
    "updated_at": "2013-10-23T09:43:33Z",
    "body": "cc me\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26892123/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26950836",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-26950836",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 26950836,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2OTUwODM2",
    "user": {
      "login": "Kimundi",
      "id": 2903206,
      "node_id": "MDQ6VXNlcjI5MDMyMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2903206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kimundi",
      "html_url": "https://github.com/Kimundi",
      "followers_url": "https://api.github.com/users/Kimundi/followers",
      "following_url": "https://api.github.com/users/Kimundi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kimundi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kimundi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kimundi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kimundi/orgs",
      "repos_url": "https://api.github.com/users/Kimundi/repos",
      "events_url": "https://api.github.com/users/Kimundi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kimundi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-23T22:14:15Z",
    "updated_at": "2013-10-23T22:14:15Z",
    "body": "After looking at it more deeply, for the case where the `~Any` gets allocated on the `future_result`/`try` side there are still two options:\n1. Only allocate the `~Any` in `try`\n   - pro: Allocation happens in the parent task\n   - con: `future_result` still exposes the `FailCause` enum\n   - However, that might be fine as `future_result` would simply become more low level, it already exposes a different enum than `try` today. \n   - And there can still be a `to_any(self) -> Result<(), ~Any>` method on `TaskResult` to do that allocating conversion anyway.\n2. Allocate the `~Any` in the `on_exit` handler of `spawn_raw`\n   - pro: both `future_result` and `try` would give a `~Any` in the case of an error\n   - con: Context in which the allocation happens seems unclear, but I think it's in the context of the failing task or the scheduler, which would both be bad in case of OOM\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26950836/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26960015",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-26960015",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 26960015,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2OTYwMDE1",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-24T01:19:23Z",
    "updated_at": "2013-10-24T01:19:23Z",
    "body": "`fail!` needs to continue to be convenient to use - having to cast to `~Any` would not be good - so whatever it takes there is fine.\n\nI'd prefer not to expose `FailureResult` to the public interface, so I guess my preference is to allocate it in `spawn_raw`.\n\nThe issue of what happens on OOM is academic at this point since what actually happens is the runtime aborts. Implementation details can be finessed when the time comes.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26960015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27025408",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-27025408",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 27025408,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDI1NDA4",
    "user": {
      "login": "Kimundi",
      "id": 2903206,
      "node_id": "MDQ6VXNlcjI5MDMyMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2903206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kimundi",
      "html_url": "https://github.com/Kimundi",
      "followers_url": "https://api.github.com/users/Kimundi/followers",
      "following_url": "https://api.github.com/users/Kimundi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kimundi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kimundi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kimundi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kimundi/orgs",
      "repos_url": "https://api.github.com/users/Kimundi/repos",
      "events_url": "https://api.github.com/users/Kimundi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kimundi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-24T20:07:31Z",
    "updated_at": "2013-10-24T20:07:31Z",
    "body": "I found an easier solution for returning the `~Any` in `future_result` and `try`:\n\nInstead of allocating the `~` box early, and during unwinding, it now only gets allocated in `future_results` `recv` method, thus still allows for a non-allocating unwinding in the future, as well as for possible optimizations.\n\nFor this, I implemented a `TaskResultPort` that implements the `comm::GenericPort` trait and wraps the internal non-allocating fail message propagation type as a `Result<(), ~Any>`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27025408/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27094126",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-27094126",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 27094126,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDk0MTI2",
    "user": {
      "login": "Kimundi",
      "id": 2903206,
      "node_id": "MDQ6VXNlcjI5MDMyMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2903206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kimundi",
      "html_url": "https://github.com/Kimundi",
      "followers_url": "https://api.github.com/users/Kimundi/followers",
      "following_url": "https://api.github.com/users/Kimundi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kimundi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kimundi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kimundi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kimundi/orgs",
      "repos_url": "https://api.github.com/users/Kimundi/repos",
      "events_url": "https://api.github.com/users/Kimundi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kimundi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-25T13:52:26Z",
    "updated_at": "2013-10-25T19:57:28Z",
    "body": "I updated this PR to return a `~Any` in case of task failure. Following is an updated description of the content of this PR:\n\n# Summary\n\nThis PR allows the cause of a failure to be received in a task's future result and as the `Err` case of `task::try`, and also implements dynamic typing in form of an `Any` trait.\n\n# Task failure\n- `fail!` and related macros now accept 5 kinds of types: `~str`, `&'static str`, `std::send_str::SendStr`, `~std::any::Any` and `~T` where `T: Send + 'static`\n- `std::task::TaskResult` got transformed into an internal enum `std::rt::task::UnwindResult`,  and it's `Failure` variant now contains a value of enum type `UnwindReason`:\n  - `UnwindReasonStr(SendStr)` maps to failing with a value of type `~str`, `&'static str` or `SendStr`.\n  - `UnwindReasonAny(~Any)` maps to failing with an `~Any` or `~T` with `T: Send + 'static`.\n  - `UnwindReasonLinked` maps to failing because the task got killed by linked failure.\n- Instead, `std::task::TaskResult` is now a typedef for `Result<(), ~Any>`, and both `TaskBuilder`'s `future_result()` and `task::try` now work with a value of this type.\n- `future_result()` no longer returns a `Port<TaskResult>`, instead it returns a wrapper `TaskResultPort` that implements `GenericPort` and `Peekable`, and which lazily allocates a `~` box and casts to `~Any` in case of failure with a `SendStr` or linked failure (for the latter case a unit struct `LinkedFailure` got added.)\n- Because `fail!` collapses both `~str` and `&'static str` into a `SendStr`, checking if a task error value is a string will just require a `.is::<SendStr>()` check, with `~str` and `&'static str` only being possible in case of an explicit `fail!(~~\"...\")` or `fail!(~ (&\"...\") as ~Any)`:\n\n# Any\n- In order to allow failing with arbitrary data, the `Any` trait got implemented.\n- It is being used in form of a trait object, usually `~Any` or `&Any`.\n- `&Any`, `~Any` and `&mut Any` have a few extension methods implemented on them:\n  - `is<T>(self) -> bool` returns true if the `Any` object contains type `T`\n  - `as_ref<T>(self) -> Option<&T>` returns a reference to the contained type, if it is `T`\n  - `as_mut<T>(self) -> Option<&mut T>` returns a mutable reference to the contained type, if it is `T`\n  - `move<T>(self) -> Option<~T>` allows to get the `~T` out of an `~Any` again.\n- `Any` currently uses type descriptors as a type id for comparisons, which is \n  - not reliable, as it is not guaranteed that every type has only one type descriptor.\n  - But safe, as no two types share the same type descriptor.\n- The implementation also a few `transmute`s, mostly to cast a `*Void` of the wrapped type into it's actual type `&T`, `&mut T` or `~T`.\n\n# Other changes\n- `std::unstable::UnsafeArc::try_unwrap` no longer uses `Either`, bringing us one step closer to removing that type.\n- A few of the touched modules got their import lines sorted.\n- A few stylistic cleanups here and there.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27094126/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27122121",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-27122121",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 27122121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MTIyMTIx",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-25T20:13:16Z",
    "updated_at": "2013-10-25T20:13:16Z",
    "body": "I would rather `future_result` just return a `Port` and not it's own type, but otherwise I'm happy with this so r+.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27122121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27122589",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-27122589",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 27122589,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MTIyNTg5",
    "user": {
      "login": "Kimundi",
      "id": 2903206,
      "node_id": "MDQ6VXNlcjI5MDMyMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2903206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kimundi",
      "html_url": "https://github.com/Kimundi",
      "followers_url": "https://api.github.com/users/Kimundi/followers",
      "following_url": "https://api.github.com/users/Kimundi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kimundi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kimundi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kimundi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kimundi/orgs",
      "repos_url": "https://api.github.com/users/Kimundi/repos",
      "events_url": "https://api.github.com/users/Kimundi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kimundi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-25T20:19:49Z",
    "updated_at": "2013-10-25T20:19:49Z",
    "body": "@brson: Hm, good catch about the `~T` one. \n`Any` is implemented for all `T`, so that's probably why the compiler didn't complain?\n\nAbout `TaskResultPort`: It seems to me that this situation is exactly what the `GenericPort` trait is for, no? I'm drawing parallels to `Iterator` here: Port and Chan adapters analogue to Iterator adapters might even be useful in the general case.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27122589/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27124765",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-27124765",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 27124765,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MTI0NzY1",
    "user": {
      "login": "Kimundi",
      "id": 2903206,
      "node_id": "MDQ6VXNlcjI5MDMyMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2903206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kimundi",
      "html_url": "https://github.com/Kimundi",
      "followers_url": "https://api.github.com/users/Kimundi/followers",
      "following_url": "https://api.github.com/users/Kimundi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kimundi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kimundi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kimundi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kimundi/orgs",
      "repos_url": "https://api.github.com/users/Kimundi/repos",
      "events_url": "https://api.github.com/users/Kimundi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kimundi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-25T20:52:45Z",
    "updated_at": "2013-10-25T20:52:45Z",
    "body": "After the last rebase, `make check` now errors for me with\n\n```\nrun codegen [x86_64-unknown-linux-gnu]: x86_64-unknown-linux-gnu/stage2/bin/compiletest\n\nrunning 9 tests\ntest [codegen] codegen/iterate-over-array.rs                ... metric: clang-codegen-ratio: 0.620253 (+/- 0.001)\ntest [codegen] codegen/scalar-function-call.rs              ... metric: clang-codegen-ratio: 0.8125 (+/- 0.001)\ntest [codegen] codegen/single-return-value.rs               ... metric: clang-codegen-ratio: 1.3 (+/- 0.001)\ntest [codegen] codegen/small-dense-int-switch.rs            ... metric: clang-codegen-ratio: 0.711111 (+/- 0.001)\ntest [codegen] codegen/stack-alloc-string-slice.rs          ... metric: clang-codegen-ratio: 0.619048 (+/- 0.001)\ntest [codegen] codegen/static-method-call-multi.rs          ... metric: clang-codegen-ratio: 0.805556 (+/- 0.001)\ntest [codegen] codegen/static-method-call.rs                ... metric: clang-codegen-ratio: 0.8 (+/- 0.001)\ntest [codegen] codegen/virtual-method-call-struct-return.rs ... metric: clang-codegen-ratio: 0.83871 (+/- 0.001)\ntest [codegen] codegen/virtual-method-call.rs               ... metric: clang-codegen-ratio: 1.1 (+/- 0.001)\n\nusing metrics ratcher: tmp/check-stage2-T-x86_64-unknown-linux-gnu-H-x86_64-unknown-linux-gnu-codegen-metrics.json\n[codegen] codegen/iterate-over-array.rs.clang-codegen-ratio: regressed by 4.26%\nresult of ratchet: 0 matrics added, 0 removed, 0 improved, 1 regressed, 8 noise\nleft ratchet file untouched\n\ntest result: FAILED. 0 passed; 0 failed; 0 ignored; 9 measured\n\n```\n\nI'm not sure how to deal with that/what caused it.\nI guess it might be caused by me changing `task::begin_unwind`?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27124765/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27206154",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-27206154",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 27206154,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjA2MTU0",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-28T12:10:02Z",
    "updated_at": "2013-10-28T12:10:02Z",
    "body": "I'm sorry if this has already been brought up, but could `Any` be removed from the prelude? Having it there gives every rust value three new methods by default, and it feels kind of \"dirty\", letting it be opt-in would be an improvement I think.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27206154/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27208136",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-27208136",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 27208136,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjA4MTM2",
    "user": {
      "login": "Kimundi",
      "id": 2903206,
      "node_id": "MDQ6VXNlcjI5MDMyMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2903206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kimundi",
      "html_url": "https://github.com/Kimundi",
      "followers_url": "https://api.github.com/users/Kimundi/followers",
      "following_url": "https://api.github.com/users/Kimundi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kimundi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kimundi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kimundi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kimundi/orgs",
      "repos_url": "https://api.github.com/users/Kimundi/repos",
      "events_url": "https://api.github.com/users/Kimundi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kimundi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-28T12:50:51Z",
    "updated_at": "2013-10-28T12:50:51Z",
    "body": "@blake2-ppc Hm, good point.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/27208136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28163979",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-28163979",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 28163979,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTYzOTc5",
    "user": {
      "login": "bblum",
      "id": 1820515,
      "node_id": "MDQ6VXNlcjE4MjA1MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bblum",
      "html_url": "https://github.com/bblum",
      "followers_url": "https://api.github.com/users/bblum/followers",
      "following_url": "https://api.github.com/users/bblum/following{/other_user}",
      "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bblum/subscriptions",
      "organizations_url": "https://api.github.com/users/bblum/orgs",
      "repos_url": "https://api.github.com/users/bblum/repos",
      "events_url": "https://api.github.com/users/bblum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bblum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-10T23:17:31Z",
    "updated_at": "2013-11-10T23:17:38Z",
    "body": "why are we trying to remove the Either type? the point of it is to allow users to avoid open-coding short sum types when they don't care about naming the arms - are we trying to discourage this practice? removing it incurs a bunch of boilerplate, as exhibited here.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28163979/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28166836",
    "html_url": "https://github.com/rust-lang/rust/pull/9967#issuecomment-28166836",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9967",
    "id": 28166836,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTY2ODM2",
    "user": {
      "login": "catamorphism",
      "id": 427212,
      "node_id": "MDQ6VXNlcjQyNzIxMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/catamorphism",
      "html_url": "https://github.com/catamorphism",
      "followers_url": "https://api.github.com/users/catamorphism/followers",
      "following_url": "https://api.github.com/users/catamorphism/following{/other_user}",
      "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions",
      "organizations_url": "https://api.github.com/users/catamorphism/orgs",
      "repos_url": "https://api.github.com/users/catamorphism/repos",
      "events_url": "https://api.github.com/users/catamorphism/events{/privacy}",
      "received_events_url": "https://api.github.com/users/catamorphism/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-11-11T01:25:41Z",
    "updated_at": "2013-11-11T01:25:41Z",
    "body": "@bblum We've discussed the Either type in a team meeting before. The feeling among the core team is, as far as I can tell, that (like boolean return values) Either is a bad code smell. Some folks even suggested removing the type from the standard library. I'm not sure I'd go that far, but I agree that it's confusing to use Either when it would be almost as easy to write a one-off data type that provides better documentation.\n\nI don't expect this decision to be revisited.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/28166836/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
