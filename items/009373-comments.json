[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24853348",
    "html_url": "https://github.com/rust-lang/rust/issues/9373#issuecomment-24853348",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9373",
    "id": 24853348,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0ODUzMzQ4",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-21T01:12:23Z",
    "updated_at": "2013-09-21T01:12:23Z",
    "body": "It's intentional. By default the runtime doesn't put any tasks on the main thread. Using the unstable runtime API it would not be hard to construct a runtime that ran tasks only on the main thread, though you will still run into situations where, e.g. the I/O subsystem starts other threads on its own.\n\nThe code for initializing the runtime is https://github.com/mozilla/rust/blob/master/src/libstd/rt/mod.rs#L234\n\nWith some tweaking this could be adjusted to only put tasks on the main thread: the `start_on_main_thread` function already does put _a_ task on the main thread, but it also spins up other threads.\n\nThe way to invoke the runtime API directly is by using the `#[start]` attribute to create a runtimeless application entry point. See this test case for an example: https://github.com/mozilla/rust/blob/master/src/test/run-pass/rt-start-main-thread.rs\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24853348/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24864957",
    "html_url": "https://github.com/rust-lang/rust/issues/9373#issuecomment-24864957",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9373",
    "id": 24864957,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0ODY0OTU3",
    "user": {
      "login": "glycerine",
      "id": 445247,
      "node_id": "MDQ6VXNlcjQ0NTI0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/445247?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glycerine",
      "html_url": "https://github.com/glycerine",
      "followers_url": "https://api.github.com/users/glycerine/followers",
      "following_url": "https://api.github.com/users/glycerine/following{/other_user}",
      "gists_url": "https://api.github.com/users/glycerine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glycerine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glycerine/subscriptions",
      "organizations_url": "https://api.github.com/users/glycerine/orgs",
      "repos_url": "https://api.github.com/users/glycerine/repos",
      "events_url": "https://api.github.com/users/glycerine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glycerine/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-21T15:55:35Z",
    "updated_at": "2013-09-21T15:55:35Z",
    "body": "I didn't understand this was intentional when I wrote up this ticket. (From #rust irc I got the impression that RUST_THREADS=1 was supposed to keep threads down to 1.)\n\nNonetheless, for my use case where I can't really tolerate more than one thread (using fork(2) calls to get inexpensive + comprehensive transaction semantics for rusti), it would be really great to have a global policy flag somewhere in Rust that is easily settable, that can be easily checked by all programmers, and that can be expected to be honored everywhere. What is desired is some easy way to tell the runtime (and any implementors implementing new, additional features), \"Yeah, really, don't spawn any threads, thank you very much; if a background thread is holding a mutex for malloc, this will really hose us if we happen to fork at that moment.\"  Under this one-thread regime, multiple coroutines are okay, but they should be cooperatively scheduled on the single main thread of the application.\n\nDoes this seem viable? \n\nIt also seems desirable if you are writing embedded systems that do not offer OS level threads.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24864957/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24865079",
    "html_url": "https://github.com/rust-lang/rust/issues/9373#issuecomment-24865079",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9373",
    "id": 24865079,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0ODY1MDc5",
    "user": {
      "login": "glycerine",
      "id": 445247,
      "node_id": "MDQ6VXNlcjQ0NTI0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/445247?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glycerine",
      "html_url": "https://github.com/glycerine",
      "followers_url": "https://api.github.com/users/glycerine/followers",
      "following_url": "https://api.github.com/users/glycerine/following{/other_user}",
      "gists_url": "https://api.github.com/users/glycerine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glycerine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glycerine/subscriptions",
      "organizations_url": "https://api.github.com/users/glycerine/orgs",
      "repos_url": "https://api.github.com/users/glycerine/repos",
      "events_url": "https://api.github.com/users/glycerine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glycerine/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-09-21T16:01:38Z",
    "updated_at": "2013-09-21T16:01:38Z",
    "body": "I tried using start_on_main_thread, and Rust still spawns an additional thread. (RUST_THREADS=1 is set).\nExample:\n\n```\n// we want a single thread... so we can fork.\n\nuse std::libc::size_t;\nuse std::libc::sleep;\n\n#[link_args = \"-lsnappy\"]\nextern {\n    fn snappy_max_compressed_length(source_length: size_t) -> size_t;\n}\n\n#[fixed_stack_segment]\nfn single_threaded_main() {\n    // some computation here...                                                                                                         \n    unsafe {\n        std::libc::sleep(5);\n        snappy_max_compressed_length(100);\n        std::libc::sleep(5);\n    };\n}\n\n#[start]\n#[fixed_stack_segment]\nfn start(argc: int, argv: **u8, crate_map: *u8) -> int {\n    std::rt::start_on_main_thread(argc, argv, crate_map, single_threaded_main)\n}\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/24865079/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26475878",
    "html_url": "https://github.com/rust-lang/rust/issues/9373#issuecomment-26475878",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/9373",
    "id": 26475878,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2NDc1ODc4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-10-17T02:53:40Z",
    "updated_at": "2013-10-17T02:53:40Z",
    "body": "This isn't fixable, because threads are needed to make large writes non-blocking. See #9568 for a feasible but unlikely solution.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/26475878/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
