[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/76689778",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-76689778",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 76689778,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2Njg5Nzc4",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-02T10:35:58Z",
    "updated_at": "2015-03-02T10:35:58Z",
    "body": ":heart_eyes:\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/76689778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88205001",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88205001",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88205001,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4MjA1MDAx",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-31T18:45:51Z",
    "updated_at": "2015-03-31T18:45:51Z",
    "body": "@alexcrichton Does this need to be finished before 1.0?\n\nSome other observations:\n- `Formatter::align` returns a value of `rt::v1::Alignment` type.  The method is still unstable with the reason `\"method was just created\"`.  Does it actually make sense to stabilize a method whose return type is unstable?  (The method is documented, but the return type is not, so there's a 404 error in the API docs.)\n- `Formatter::flags` is stable and returns `u32`, but the flag values themselves aren't documented, AFAICT, so there's no stable way to use the flags.  The `core::fmt::FlagV1` enum is private.\n- I'm experimenting with some changes to the `core::fmt` representation that I think will improve performance, but it completely changes the representation of `Arguments` and `Formatter` and removes the undocumented but stable methods from `Arguments`.  In addition to destabilizing the contents of `core::fmt::rt::v1`, can we also make `Arguments::new_v1[_formatted]` and `ArgumentV1` et al unstable?\n- Stabilizing the `v1` representation seems to have performance consequences.  Supposing we introduced a new `rt::v2::Argument`, AFAICT, `Arguments` would need to use an enum to represent both `rt::v1::Argument` and `rt::v2::Argument`.  Perhaps we'd then like to make `Arguments::new_v1_formatted` convert the v1 representation to the v2 representation, but I don't think it could due to lifetime issues.  Do we really need to support old and new representations in the same version of `libcore`?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88205001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88572318",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88572318",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88572318,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4NTcyMzE4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-01T17:48:00Z",
    "updated_at": "2015-04-01T17:48:00Z",
    "body": "@rprichard yeah it would be nice to get this done, but it's not necessarily the end of the world if it slips through the cracks for now. The `align` method will not be stabilized as-is (returning that type), and `flags` may just be stable by mistake as you can't actually interpret the return value.\n\nDue to the `#[allow_internal_unstable]` attribute/feature I believe we can destabilize as much of this as possible. \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88572318/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88634074",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88634074",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88634074,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4NjM0MDc0",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-01T21:17:01Z",
    "updated_at": "2015-04-01T21:17:01Z",
    "body": "@alexcrichton Thanks for looking at this.\n\nIt looks like `#[allow_internal_unstable]` is already specified on the `format_args!` macro, but when I tried marking the `v1` things unstable, I still got stability errors.  I think I can fix those by using a different Span on the `v1` paths that `format_args!` generates.  (Specifically, use the `Span` passed to `expand_format_args` rather than that of the format expression or arguments.  An argument can refer to something unstable, and that must still fail.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88634074/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88670227",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88670227",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88670227,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4NjcwMjI3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-02T00:01:38Z",
    "updated_at": "2015-04-02T00:01:38Z",
    "body": "Ah yeah I'm not too familiar with how the `#[allow_internal_unstable]` machinery works, but @huonw may be able to help out with problems.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88670227/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88671973",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88671973",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88671973,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4NjcxOTcz",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-02T00:09:35Z",
    "updated_at": "2015-04-02T00:09:35Z",
    "body": "@rprichard ah, yeah, I guess you do need the span of the macro (i.e the one passed into the function) rather than the expression/arguments.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88671973/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88674536",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88674536",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88674536,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4Njc0NTM2",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-02T00:32:56Z",
    "updated_at": "2015-04-02T00:32:56Z",
    "body": "@huonw Currently, I've modified `format_args!` to use a combination of the macro span, the format literal span, and the argument spans.  It more-or-less works, but I still get stability errors if `format_args!` is expanded from another macro (e.g. `write!`).  (Even if I mark the containing macro as `#[allow_internal_unstable]`, I still get the stability errors.)\n\nI then tried writing a simple syntax plugin (easier to experiment with, faster iteration times), and I've noticed that with a simple macro that evaluates to its last argument, I don't get stability errors, even if that argument is unstable!  Here's [the code](https://gist.github.com/rprichard/8422038097b89b84977e) for the plugin I'm working with.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88674536/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88701313",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88701313",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88701313,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4NzAxMzEz",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-02T02:24:20Z",
    "updated_at": "2015-04-02T02:24:20Z",
    "body": "Ah! I think plugins are handled differently to the built-in ones in a fairly subtle (and apparently buggy) way. Specifically [the registry overrides the definition span](https://github.com/rust-lang/rust/blob/2e3b0c051dca9880bf66b5366dccd2e0bb424b99/src/librustc/plugin/registry.rs#L85), which is [used](https://github.com/rust-lang/rust/blob/2e3b0c051dca9880bf66b5366dccd2e0bb424b99/src/libsyntax/codemap.rs#L850) to check for `#[allow_internal_unstable]`, and, it seems that `self.krate_span` used in the registry covers the whole of the main file (it should just be the `#[plugin(...)]` attribute) and hence every expression is included inside that span. \n\nIf I make the following change the stability error occurs as expected:\n\n``` diff\n--- a/foo_macros.rs\n+++ b/foo_macros.rs\n@@ -99,6 +99,6 @@ fn expand_foo(cx: &mut ExtCtxt, sp: Span, args: &[ast::TokenTree])\n #[plugin_registrar]\n pub fn plugin_registrar(reg: &mut Registry) {\n     let expander: MacroExpanderFn = expand_foo;\n-    reg.register_syntax_extension(token::intern(\"foo\"),\n-                                  NormalTT(Box::new(expander), None, true));\n+    reg.syntax_exts.push((token::intern(\"foo\"),\n+                          NormalTT(Box::new(expander), None, true)));\n }\n```\n\n(Abusing the fact that the registry has public fields to stop it changing the `None` to a `Some`.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88701313/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88702156",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88702156",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88702156,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4NzAyMTU2",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-02T02:26:11Z",
    "updated_at": "2015-04-02T02:26:11Z",
    "body": "(FWIW, your plugin + my bug-workaround seems to behave correctly wrt being inside a macro_rules marked with `#[allow_internal_unstable]` vs. not.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88702156/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88704796",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88704796",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88704796,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4NzA0Nzk2",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-02T02:35:24Z",
    "updated_at": "2015-04-02T02:35:24Z",
    "body": "(Filed https://github.com/rust-lang/rust/issues/23964.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88704796/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88725154",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88725154",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88725154,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4NzI1MTU0",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-02T04:27:03Z",
    "updated_at": "2015-04-02T04:27:03Z",
    "body": "@huonw With your change to `plugin_registrar`, I'm now able to reproduce the problem I'm having with `format_args!` where `#[allow_internal_unstable]` works, but not when the macro is used inside another macro.\n\nI made a reduced plugin [demonstrating](https://gist.github.com/rprichard/b4b781bde66a9a407f9e) the problem.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88725154/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88752128",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-88752128",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 88752128,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4NzUyMTI4",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-02T05:57:28Z",
    "updated_at": "2015-04-02T05:57:35Z",
    "body": "This appears to be because the span passed into the syntax extension appears to be the span of the outer macro invocation, rather than the span of the internal plugin invocation, which is what the stability checking assumes. Hm.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/88752128/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89087246",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-89087246",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 89087246,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5MDg3MjQ2",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T00:07:00Z",
    "updated_at": "2015-04-03T00:07:00Z",
    "body": "Yes, when we expand an expression macro, we use `cx.original_span()`, which returns the outer-most call site, rather than the immediate call site.  This behavior originated from the #5794 fix.\n\nIt looks like using `cx.call_site()` instead of the macro span fixes my test case.  It's interesting that `cx.call_site()` has a backtrace, though, whereas the macro span doesn't.  (Does it ever have a backtrace?)  IIUC, backtraces are assigned after macro expansion via `noop_fold_expr` / `new_span`.\n\nI also thought it was interesting that when we expand an expression macro, we replace the fully expanded `Expr`'s span with that of the original invocation.  IIUC, this loses the backtrace, but if we stopped doing the replacement, some backtraces would be wrong.  (i.e. The top of the stack could be the outer-most call site, followed by the inner-most expansion, then the second-most-inner expansion, all the way to the outer-most call site again.)\n\nOTOH, maybe this change makes sense:\n\n``` diff\ndiff --git a/src/libsyntax/ext/expand.rs b/src/libsyntax/ext/expand.rs\nindex ee2cf90..fdb5716 100644\n--- a/src/libsyntax/ext/expand.rs\n+++ b/src/libsyntax/ext/expand.rs\n@@ -80,7 +80,7 @@ pub fn expand_expr(e: P<ast::Expr>, fld: &mut MacroExpander) -> P<ast::Expr> {\n             fully_expanded.map(|e| ast::Expr {\n                 id: ast::DUMMY_NODE_ID,\n                 node: e.node,\n-                span: span,\n+                span: fld.new_span(span),\n             })\n         }\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89087246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89092262",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-89092262",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 89092262,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5MDkyMjYy",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-03T00:28:35Z",
    "updated_at": "2015-04-03T00:28:35Z",
    "body": "> I also thought it was interesting that when we expand an expression macro, we replace the fully expanded `Expr`'s span with that of the original invocation. IIUC, this loses the backtrace...\n\nTo elaborate more, even if the expanded macro is `#[allow_internal_unstable]`, `span_allows_unstable` will still reject the fully expanded `Expr`'s span, because that span's backtrace is empty.  I think...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89092262/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89545705",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-89545705",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 89545705,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5NTQ1NzA1",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-04T10:12:43Z",
    "updated_at": "2015-04-04T10:12:43Z",
    "body": "Using `cx.call_site()` fixes the stability errors in normal compilation, but then the `[pretty]` tests fail (because the expanded source refers to unstable things, and there are no `#[allow_internal_unstable]` attributes left).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89545705/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89932593",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-89932593",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 89932593,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg5OTMyNTkz",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-06T05:42:56Z",
    "updated_at": "2015-04-06T05:43:12Z",
    "body": "> Does it ever have a backtrace?\n\nI guess it might if the macro is defined/imported inside the expansion of another macro. (e.g. `macro_rules! foo ( () => { #[macro_use] extern crate bar; } )`.)\n\n(I'm not sure I'm interpreting the question right.)\n\n> OTOH, maybe this change makes sense:\n\nHm, I'm struggling to visualise what effect that will have, do you happen to have a before/after diagnostics listing? (Also, including `cx.call_site()` one.)\n\n> Using cx.call_site() fixes the stability errors in normal compilation, but then the [pretty] tests fail (because the expanded source refers to unstable things, and there are no #[allow_internal_unstable] attributes left).\n\nI think those tests will just have to be marked as expected-fails (with `// xfail-pretty`) as the macro-expansion-based stability is fundamentally \"broken\" post-expansion. It is mainly designed as a hack to allow 1.0 to be usable without having to stabilise the very insides of certain macros.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/89932593/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/90436111",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-90436111",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 90436111,
    "node_id": "MDEyOklzc3VlQ29tbWVudDkwNDM2MTEx",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-07T07:55:24Z",
    "updated_at": "2015-04-07T07:55:24Z",
    "body": "> > Does it ever have a backtrace?\n> \n> I guess it might if the macro is defined/imported inside the expansion of another macro. (e.g. macro_rules! foo ( () => { #[macro_use] extern crate bar; } ).)\n> \n> (I'm not sure I'm interpreting the question right.)\n\nI think my question was confused -- by \"macro span,\" I was thinking of the span passed to a syntax extension.  That span is sometimes `cx.original_span()`, which never has a backtrace.  `expand_item_mac` OTOH passes `it.span` to the syntax extension, which I suspect doesn't typically have a backtrace.  \n\nI'm wondering whether, say, the expression passed to `expand_expr` ever has a span with a backtrace.  If I understand correctly, the span backtraces are assigned in post-order, via `MacroFolder::new_span`.  If `format_args!` emit expressions using `cx.call_site()`, it would break the supposed invariant, because `cx.call_site()` has a backtrace, and the expanded formatting expression is passed to `expand_expr!` again (e.g. because the arguments could invoke macros).  If it mattered, `expand_format_args` could strip off the backtrace from `cx.call_site()`.\n\nMy current guess is that a macro definition span has no backtrace, but I can't find a test case where it would matter.\n\n> > OTOH, maybe this change makes sense:\n> \n> Hm, I'm struggling to visualise what effect that will have, do you happen to have a before/after diagnostics listing?\n\nAdding the `fld.new_span` call in `expand_expr` affects the backtrace for code like this (copied from my new `compile-fail/macro-backtrace-nested.rs` test):\n\n``` rust\nmacro_rules! nested_expr {\n    () => (fake)\n}\n\nmacro_rules! call_nested_expr_sum { //~ NOTE in expansion of\n    () => { 1 + nested_expr!(); } //~ ERROR unresolved name\n}\n\nfn main() {\n    call_nested_expr_sum!(); //~ NOTE expansion site\n}\n```\n\nWithout the `fld.new_span` call, the error is:\n\n```\nrprichard@ryan:~/mess$ rustc test.rs\ntest.rs:6:17: 6:32 error: unresolved name `fake`\ntest.rs:6     () => { 1 + nested_expr!(); } //~ ERROR unresolved name\n                          ^~~~~~~~~~~~~~~\nerror: aborting due to previous error\n```\n\nWith the `fld.new_span` call, there is a macro backtrace:\n\n```\nrprichard@ryan:~/mess$ ~/work/rust-staging2/build/install/bin/rustc test.rs\ntest.rs:6:17: 6:32 error: unresolved name `fake`\ntest.rs:6     () => { 1 + nested_expr!(); } //~ ERROR unresolved name\n                          ^~~~~~~~~~~~~~~\ntest.rs:5:1: 7:2 note: in expansion of call_nested_expr_sum!\ntest.rs:10:5: 10:29 note: expansion site\nerror: aborting due to previous error\n```\n\n> (Also, including cx.call_site() one.)\n\nI'm actually not sure what the total impact is of using `cx.call_site()` instead of the format string.  With my current implementation, it affects this test case:\n\n``` rust\nfn main() {\n    let x = format_args!(\"abc\");\n}\n```\n\nfrom:\n\n```\nrprichard@ryan:~/mess$ rustc test.rs\ntest.rs:2:26: 2:31 error: borrowed value does not live long enough\ntest.rs:2     let x = format_args!(\"abc\");\n                                   ^~~~~\nnote: in expansion of format_args!\ntest.rs:2:13: 2:33 note: expansion site\ntest.rs:2:32: 3:2 note: reference must be valid for the block suffix following statement 0 at 2:31...\ntest.rs:2     let x = format_args!(\"abc\");\ntest.rs:3 }\ntest.rs:2:5: 2:32 note: ...but borrowed value is only valid for the statement at 2:4\ntest.rs:2     let x = format_args!(\"abc\");\n              ^~~~~~~~~~~~~~~~~~~~~~~~~~~\ntest.rs:2:5: 2:32 help: consider using a `let` binding to increase its lifetime\ntest.rs:2     let x = format_args!(\"abc\");\n              ^~~~~~~~~~~~~~~~~~~~~~~~~~~\nerror: aborting due to previous error\n```\n\nto:\n\n```\nrprichard@ryan:~/mess$ ~/work/rust-staging1/build/install/bin/rustc test.rs\ntest.rs:2:13: 2:33 error: borrowed value does not live long enough\ntest.rs:2     let x = format_args!(\"abc\");\n                      ^~~~~~~~~~~~~~~~~~~~\nnote: in expansion of format_args!\ntest.rs:2:13: 2:33 note: expansion site\ntest.rs:2:32: 3:2 note: reference must be valid for the block suffix following statement 0 at 2:31...\ntest.rs:2     let x = format_args!(\"abc\");\ntest.rs:3 }\ntest.rs:2:5: 2:32 note: ...but borrowed value is only valid for the statement at 2:4\ntest.rs:2     let x = format_args!(\"abc\");\n              ^~~~~~~~~~~~~~~~~~~~~~~~~~~\ntest.rs:2:5: 2:32 help: consider using a `let` binding to increase its lifetime\ntest.rs:2     let x = format_args!(\"abc\");\n              ^~~~~~~~~~~~~~~~~~~~~~~~~~~\nerror: aborting due to previous error\n```\n\nThe difference is the first span that the borrow checker highlights.\n\nI was a little concerned that the `format_args!` call site is less useful as an error span than the format expression, but I haven't thought of any problem cases yet.  In the case above, the change is an improvement.\n\n> I think those tests will just have to be marked as expected-fails (with // xfail-pretty) as the macro-expansion-based stability is fundamentally \"broken\" post-expansion.\n\nIt affects a lot of tests -- in my testing, 550 of 2032 pretty tests failed.  I'm currently destabilizing all the v1 things, so `assert_eq!` is enough to break a test.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/90436111/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/91055366",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-91055366",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 91055366,
    "node_id": "MDEyOklzc3VlQ29tbWVudDkxMDU1MzY2",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-08T22:31:35Z",
    "updated_at": "2015-04-08T22:31:35Z",
    "body": "This issue is blocked on #23616.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/91055366/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/91434037",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-91434037",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 91434037,
    "node_id": "MDEyOklzc3VlQ29tbWVudDkxNDM0MDM3",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-10T05:20:36Z",
    "updated_at": "2015-04-10T05:20:36Z",
    "body": "> My current guess is that a macro definition span has no backtrace, but I can't find a test case where it would matter.\n\nI can't think of somewhere it would matter either... if there are problems later we can fix them as they come.\n\n> Adding the fld.new_span call in expand_expr affects the backtrace for code like this (copied from my new compile-fail/macro-backtrace-nested.rs test):\n\nThanks, looks good.\n\n> It affects a lot of tests -- in my testing, 550 of 2032 pretty tests failed. I'm currently destabilizing all the v1 things, so assert_eq! is enough to break a test.\n\nArgh. That's not so great. I'm inclined to agree with Niko: https://github.com/rust-lang/rust/issues/23616#issuecomment-90841087. Unfortunately, I guess that still requires adding feature flags to 550 tests, and that is some druggery I wouldn't wish on anyone; although it seems to me that large parts might automatable (e.g. insert `#![feature(...)]` after line 8 (just after the license block) for the feature gates that are added).\n\n(If we do decide to follow Niko's suggestion, it's totally cool if you're not up to doing this boring part.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/91434037/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/91435402",
    "html_url": "https://github.com/rust-lang/rust/issues/22953#issuecomment-91435402",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22953",
    "id": 91435402,
    "node_id": "MDEyOklzc3VlQ29tbWVudDkxNDM1NDAy",
    "user": {
      "login": "rprichard",
      "id": 1572855,
      "node_id": "MDQ6VXNlcjE1NzI4NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rprichard",
      "html_url": "https://github.com/rprichard",
      "followers_url": "https://api.github.com/users/rprichard/followers",
      "following_url": "https://api.github.com/users/rprichard/following{/other_user}",
      "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions",
      "organizations_url": "https://api.github.com/users/rprichard/orgs",
      "repos_url": "https://api.github.com/users/rprichard/repos",
      "events_url": "https://api.github.com/users/rprichard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rprichard/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-04-10T05:34:07Z",
    "updated_at": "2015-04-10T05:34:07Z",
    "body": "@alexcrichton recently destabilized the internals of `panic!`, which also required dealing with a bunch of pretty-printing tests ([commit](https://github.com/rust-lang/rust/commit/ec7c800d2fc0dc5918d325ae68d88c9708d20259)).  It looks like we already have to opt-in to allow a test to be pretty-printed, so that commit just removed the opt-in for a bunch of tests.\n\nI speculate that that commit fixed most of the tests that were failing for this issue.  i.e. The majority of tests that use `format_args!` probably do so because they panic via `assert_eq!`.\n\nI'll work on this issue again soon, probably after rebasing my other macro-related PR.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/91435402/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
