[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162417335",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-162417335",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 162417335,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MjQxNzMzNQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-07T05:46:46Z",
    "updated_at": "2015-12-07T05:46:46Z",
    "body": "triage: I-nominated\n\nSeems bad! Haven't had too much of a chance to digest yet, but doesn't seem earth-shatteringly bad on the surface at least.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162417335/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162905804",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-162905804",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 162905804,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MjkwNTgwNA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-08T14:53:54Z",
    "updated_at": "2015-12-08T14:53:54Z",
    "body": "I... actually don't think this is related to thread locals. The line you've highlighted I believe is indeed the \"one at fault\", but this seems like it may be a codegen problem? \n\nCurrently, for code like this:\n\n``` rust\npub fn foo(a: &mut Box<i32>, b: Box<i32>) {\n    *a = b;\n}\n```\n\nThis is codegen'd as:\n1. Drop the contents of `a`\n2. Copy the contents of `b` into `a`\n\nNote that this is precisely what's happening on that line of `*ptr = Some(value)`. The destructor is running first, and _then_ the value is being moved into place. This means that the destructor for the TLS value is running _without_ setting the \"I'm running a destructor flag\", which is not intended! This means that destructors can access the value while it's being destroyed, causing the unsafety here.\n\nThis seems like an interesting phenomenon, however, because if the destructor in the function above panicked, that means that we've possibly got a hole in memory! As a proof of concept, let's take a look at this:\n\n``` rust\nstruct A(Box<i32>);\nstruct B<'a>(&'a mut A);\n\nimpl Drop for A {\n    fn drop(&mut self) {\n        if *self.0 == 0 {\n            panic!(\"oh no\");\n        } else {\n            // ...\n        }\n    }\n}\n\nimpl<'a> Drop for B<'a> {\n    fn drop(&mut self) {\n        let a = &self.0;\n        println!(\"{}\", a.0);\n    }\n}\n\nfn foo(b: &mut B) {\n    *b.0 = A(Box::new(1));\n}\n\nfn main() {\n    let mut bomb = A(Box::new(0));\n    let mut b = B(&mut bomb);\n    foo(&mut b);\n}\n```\n\nHere we create a bomb that's \"ready to go off\" via `A(Box::new(0))`, and then it's packaged up into another value with a destructor that can later witness its value (e.g. `B(&mut bomb)`). We then pass it off to a function where `b`'s value is overwritten with a non-bomb (e.g. `A(Box::new(1))`). Due to the way this is codegen'd, however, the destructor for `A` is run before the pointer is overwritten, which means that the pointer is never _actually_ overwritten, which in turn means that the destructor for `B` can later witness this, causing a use-after-free.\n\nWhen [running this program](https://play.rust-lang.org/?gist=dfc61190e211af591f22&version=stable&run=1), I get:\n\n```\nthread '<main>' panicked at 'oh no', <anon>:7\n-337192192\n```\n\n(of course results may vary).\n\n**tl;dr;** I think this is a codegen bug, not a TLS bug. Recategorizing as T-compiler, but we should probably still fix `thread::local` in the meantime to protect against this.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162905804/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162906004",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-162906004",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 162906004,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MjkwNjAwNA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-08T14:54:40Z",
    "updated_at": "2015-12-08T14:54:40Z",
    "body": "Ah, cc @rust-lang/compiler, tagging this with `I-unsound` due to my code example above.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162906004/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162910121",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-162910121",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 162910121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MjkxMDEyMQ==",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-08T15:10:22Z",
    "updated_at": "2015-12-08T15:10:58Z",
    "body": "That sounds like there are two problems here:\n- TLS not guarding certain kinds of assignment drops (initialization)\n- panicking not guarding assignment drops\n\nI agree that the more general problem is that assignment drops need special handling, but doing it, via swaps for example, in every case seems like overkill and can potentially ruin performance.\n\nIt might be worth splitting this into two issues (or 3, one of them tracking the various instances of the general case).\n\nAs for the panic case, it might be worth implementing `*a = b;` as:\n\n``` rust\ntry {\n    drop_in_place(a);\n} finally {\n    ptr::write(a, b);\n}\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162910121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162921884",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-162921884",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 162921884,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MjkyMTg4NA==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-08T15:42:35Z",
    "updated_at": "2015-12-08T15:42:35Z",
    "body": "The panicking destructor problem is present in MIR.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162921884/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162922736",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-162922736",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 162922736,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MjkyMjczNg==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-08T15:45:43Z",
    "updated_at": "2015-12-08T15:45:43Z",
    "body": "``` Rust\n#[rustc_mir(graphviz=\"file.gv\")]\npub fn foo<T>(a: &mut T, b: T) {\n    *a = b;\n}\n```\n\ngenerates the MIR at https://gist.github.com/arielb1/952593c64e4fffdbf9ed#file-mir-svg\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162922736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162924629",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-162924629",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 162924629,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MjkyNDYyOQ==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-08T15:52:03Z",
    "updated_at": "2015-12-08T15:52:03Z",
    "body": "Interesting =)\n\nIt seems like the way we should codegen `*ptr = ...` is `let mut new_value = ...; swap(ptr, &mut new_value); drop(new_value);`, eh?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162924629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162928990",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-162928990",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 162928990,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MjkyODk5MA==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-08T16:04:25Z",
    "updated_at": "2015-12-08T16:04:25Z",
    "body": "@nikomatsakis \n\nWe can have the landing pad write the rvalue into the destination. That would however require a `drop` terminator. This feels like it would be better than introducing a copy to every write.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162928990/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162930979",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-162930979",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 162930979,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MjkzMDk3OQ==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-08T16:09:23Z",
    "updated_at": "2015-12-08T16:10:17Z",
    "body": "That would basically be the MIR\n\n```\n  %0 = $b\n  %1 = $a\n  drop $a uwto uw0\n  *%1 = %0\n  %ret = ()\n  return\nuw0:\n  *%1 = %0\n  unwind\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/162930979/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/163002145",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-163002145",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 163002145,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MzAwMjE0NQ==",
    "user": {
      "login": "nagisa",
      "id": 679122,
      "node_id": "MDQ6VXNlcjY3OTEyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nagisa",
      "html_url": "https://github.com/nagisa",
      "followers_url": "https://api.github.com/users/nagisa/followers",
      "following_url": "https://api.github.com/users/nagisa/following{/other_user}",
      "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions",
      "organizations_url": "https://api.github.com/users/nagisa/orgs",
      "repos_url": "https://api.github.com/users/nagisa/repos",
      "events_url": "https://api.github.com/users/nagisa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nagisa/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-08T20:11:53Z",
    "updated_at": "2015-12-08T20:11:53Z",
    "body": "> It seems like the way we should codegen *ptr = ... is let mut new_value = ...; swap(ptr, &mut new_value); drop(new_value);, eh?\n\nNot sure how relevant it is, but this is similar to what Swift does (according to [this presentation](https://www.youtube.com/watch?v=Ntj8ab-5cvE) ~38 minute onward)\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/163002145/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/163680941",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-163680941",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 163680941,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MzY4MDk0MQ==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-10T16:37:46Z",
    "updated_at": "2015-12-10T16:37:46Z",
    "body": "On Tue, Dec 08, 2015 at 08:05:03AM -0800, arielb1 wrote:\n\n> @nikomatsakis \n> \n> We can have the landing pad write the rvalue into the destination. That would however require a `drop` terminator. This feels like it would be better than introducing a copy to every write.\n\nClever. Worth measuring. Obviously this is somewhat observable (But\nyou have to have wacky `*mut` and `UnsafeCell` usage.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/163680941/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/163738897",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-163738897",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 163738897,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2MzczODg5Nw==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-10T20:21:06Z",
    "updated_at": "2015-12-10T20:21:06Z",
    "body": "@nikomatsakis \n\nThat kind of wacky `UnsafeCall` abuse is UB.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/163738897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/164556466",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-164556466",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 164556466,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2NDU1NjQ2Ng==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-14T20:54:42Z",
    "updated_at": "2015-12-14T20:54:42Z",
    "body": "@arielb1 \n\n> That kind of wacky UnsafeCall abuse is UB.\n\nHmm, perhaps it is. I'm trying to come up with an example of something reasonable but haven't been able to yet. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/164556466/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/164582774",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-164582774",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 164582774,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2NDU4Mjc3NA==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-14T22:39:59Z",
    "updated_at": "2015-12-14T22:39:59Z",
    "body": "@nikomatsakis \n\nThe point here is that the destructor is run \"in the middle of the assignment\", and can try to observe the value in-mid-assignment. If the assignment was to a dereference of a `&mut` reference (as happened in this case explicitly) that is impossible/UB because that would mean the `&mut` reference is doubly-borrowed. \n\nHowever, you can also assign to a dereference of a `*mut` pointer (within an unsafe block). That case would be just underdefined, but these assignments are uncommon enough I suppose we should just give them the same semantics as if the pointer was reborrowed to a `&mut` for the duration of the assignment (remembering that \"the assignment\" here is just the call to the destructor and the memcpy, and does not include the evaluation of the RHS). \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/164582774/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/164583004",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-164583004",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 164583004,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2NDU4MzAwNA==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-14T22:41:00Z",
    "updated_at": "2015-12-14T22:41:00Z",
    "body": "I think I will just close this issue and reopen it under the appropriate title because the issues are separate enough.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/164583004/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/164681997",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-164681997",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 164681997,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2NDY4MTk5Nw==",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-15T08:24:07Z",
    "updated_at": "2015-12-15T08:24:07Z",
    "body": "Hmm I think that if we fix #30380 we will still want an independent regression test for this issue.\n\nReopening (with expectation that it will be flagged as needstest after other other bug in depends sues fixed)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/164681997/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/164829605",
    "html_url": "https://github.com/rust-lang/rust/issues/30228#issuecomment-164829605",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/30228",
    "id": 164829605,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE2NDgyOTYwNQ==",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-12-15T17:08:56Z",
    "updated_at": "2015-12-15T17:08:56Z",
    "body": "@pnkfelix \n\n@alexcrichton's PR definitely _did_ come with a test. The TLS problem was aliasing violation (UB) triggered by accessing a value in the middle of its destructor.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/164829605/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
