[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44860511",
    "html_url": "https://github.com/rust-lang/rust/pull/14425#issuecomment-44860511",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14425",
    "id": 44860511,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0ODYwNTEx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-02T16:36:57Z",
    "updated_at": "2014-06-02T16:36:57Z",
    "body": "How is this different than `foo.iter().filter(...).scan(...)`?\n\nThe extra value added can't be expressed today, but why was it added for just one iterator and no others?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44860511/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44884712",
    "html_url": "https://github.com/rust-lang/rust/pull/14425#issuecomment-44884712",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14425",
    "id": 44884712,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0ODg0NzEy",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-02T20:10:08Z",
    "updated_at": "2014-06-02T20:10:08Z",
    "body": "@alexcrichton `foo.iter().filter().scan()` cannot do what `filter_scan()` does, because it cannot adjust its filtering based on the current state, and conversely, it can't adjust its state based on things it filtered.\n\nI added `filter_scan()` because I thought this is how `scan()` was supposed to behave and was quite surprised when it doesn't do this. Note that I had to fix the doc comment for `scan()` in my commit. I checked and the current behavior of `Scan` is being explicitly relied-upon, so we can't change it.\n\n`filter_scan()` allows building custom once-off iterators easily without requiring brand new types. See the example that uses it to build a simple tokenizer to extract words from a string (this example was directly inspired by someone on IRC who needed this, and that's how I discovered the current behavior of `scan()`).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44884712/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44885324",
    "html_url": "https://github.com/rust-lang/rust/pull/14425#issuecomment-44885324",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14425",
    "id": 44885324,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0ODg1MzI0",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-02T20:15:51Z",
    "updated_at": "2014-06-02T20:15:51Z",
    "body": "As for `chain_state()`, I added that because I could, and because it turns out the tokenizer example needs it. It could probably be added to `scan()` as well but I didn't want to deal with that in this commit, because it's not immediately obvious how to behave there. Would it run the `chain_state()` closure the first time it returns `None` from the function? Or would it run it once the underlying iterator returns `None`? The latter seems like the obvious choice, but doing it that way means your `scan()` iterator can return `None` without ever chaining the state (if the contained closure returns a `None`). Because of this issue, I felt it was better to add separately if desired.\n\nAnother option is to build a separate iterator adaptor that chains a single result by executing a closure on a `&mut` reference to the contained iterator, once the contained iterator returns `None`. This would let you do the same thing as `chain_state()`, but I don't know if it would really be useful for any other iterators. Also if it did this I'd perhaps want to be able to chain multiple times, or to be able to return an `Iterator` from the closure and have it continue running that iterator. It's worth thinking about, but again it's not entirely straightforward as to what the correct solution is.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44885324/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44919424",
    "html_url": "https://github.com/rust-lang/rust/pull/14425#issuecomment-44919424",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14425",
    "id": 44919424,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0OTE5NDI0",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-03T04:41:32Z",
    "updated_at": "2014-06-03T04:41:32Z",
    "body": "There's a lot of similarity with this approach and my `.batch()` iterator from #14271. For fun I ported over your example to it, and it results in pretty much the same code: https://gist.github.com/erickt/ae99de71309c3a194830. I would lean towards batch for this instance, as I feel it's a bit more general purpose. It's also a teensy bit faster, but that's probably due to the https://github.com/mozilla/rust/issues/11084 bug.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/44919424/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47485971",
    "html_url": "https://github.com/rust-lang/rust/pull/14425#issuecomment-47485971",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14425",
    "id": 47485971,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDg1OTcx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-30T00:23:51Z",
    "updated_at": "2014-06-30T00:23:51Z",
    "body": "Closing due to inactivity, but feel free to reopen again.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47485971/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47496166",
    "html_url": "https://github.com/rust-lang/rust/pull/14425#issuecomment-47496166",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14425",
    "id": 47496166,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDk2MTY2",
    "user": {
      "login": "lilyball",
      "id": 714,
      "node_id": "MDQ6VXNlcjcxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lilyball",
      "html_url": "https://github.com/lilyball",
      "followers_url": "https://api.github.com/users/lilyball/followers",
      "following_url": "https://api.github.com/users/lilyball/following{/other_user}",
      "gists_url": "https://api.github.com/users/lilyball/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lilyball/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lilyball/subscriptions",
      "organizations_url": "https://api.github.com/users/lilyball/orgs",
      "repos_url": "https://api.github.com/users/lilyball/repos",
      "events_url": "https://api.github.com/users/lilyball/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lilyball/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-30T05:34:26Z",
    "updated_at": "2014-06-30T05:34:36Z",
    "body": "@alexcrichton I still think this is useful. All it's waiting on is a review and/or a comparison with @erickt's `.batch()`. I agree that `.batch()` can fill the same role, but I do not know which approach is better.\n\nFWIW, `.batch()` appears to be completely standalone, despite being part of a PR that includes other functionality. I think either `filter_scan()` or `batch()` should be accepted.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/47496166/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48445343",
    "html_url": "https://github.com/rust-lang/rust/pull/14425#issuecomment-48445343",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14425",
    "id": 48445343,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NDQ1MzQz",
    "user": {
      "login": "nielsle",
      "id": 292118,
      "node_id": "MDQ6VXNlcjI5MjExOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/292118?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nielsle",
      "html_url": "https://github.com/nielsle",
      "followers_url": "https://api.github.com/users/nielsle/followers",
      "following_url": "https://api.github.com/users/nielsle/following{/other_user}",
      "gists_url": "https://api.github.com/users/nielsle/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nielsle/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nielsle/subscriptions",
      "organizations_url": "https://api.github.com/users/nielsle/orgs",
      "repos_url": "https://api.github.com/users/nielsle/repos",
      "events_url": "https://api.github.com/users/nielsle/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nielsle/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-09T08:56:35Z",
    "updated_at": "2014-07-09T11:39:44Z",
    "body": "AFAICS you can almost solve your code example using scan and filtermap, but I didn't manage to get the last word, and I don't know how well this will be optimized.\n\n``` rust\nfn main() {\n    let s = \"this is a sentence\";\n    let mut it = s.char_indices().scan(0u, |i1, (i2, c)| {\n        if c.is_whitespace() {\n            let word = s.slice(*i1, i2);\n            *i1 = i2+1;\n            Some(Some(word))\n        } else {\n            Some(None)\n        }\n    }).filter_map(|x| x);\n    assert_eq!(it.next(), Some(\"this\"));\n    assert_eq!(it.next(), Some(\"is\"));\n    assert_eq!(it.next(), Some(\"a\"));\n    // assert_eq!(it.next(), Some(\"sentence\")); # NOT WORKING\n    assert_eq!(it.next(), None);\n}\n```\n\nPerhaps chain_state could be renamed to finally and added as a method to the normal ScanIterator. Then the code example could be changed into something like the following\n\n``` rust\nlet mut it = s.char_indices()\n              .scan(0u, |i1, (i2, c)| {\n                         ....  // Same code as above\n              })\n              // last word\n              .finally(|i1, (i2, _)|  Some(Some( s.slice(*i1, i2+1))))\n              .filter_map(|x| x);\n```\n\nAlternatively you can add a whitespace at the end of the string, but that feels like a hack.\n\nEDIT: Ideally a Peekable iterator should allow you to peek ahead inside a for-loop. That would would solve the problem of getting the last word. Perhaps i2 could have a method named peek(), but also coerce to uint.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48445343/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48971348",
    "html_url": "https://github.com/rust-lang/rust/pull/14425#issuecomment-48971348",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14425",
    "id": 48971348,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTcxMzQ4",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-07-14T23:02:37Z",
    "updated_at": "2014-07-14T23:02:37Z",
    "body": "Closing. Between this PR and https://github.com/rust-lang/rust/pull/14271, this subject has been closed several times with little agreement. Please agree on a design and convince others that it is needed.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/48971348/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
