[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3321236",
    "html_url": "https://github.com/rust-lang/rust/issues/1402#issuecomment-3321236",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1402",
    "id": 3321236,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjEyMzY=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-12-31T14:11:11Z",
    "updated_at": "2011-12-31T14:11:11Z",
    "body": "The c type unsigned is not the same as the Rust type uint.  Try `ctypes::unsigned` instead.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3321236/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3322089",
    "html_url": "https://github.com/rust-lang/rust/issues/1402#issuecomment-3322089",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1402",
    "id": 3322089,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjIwODk=",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-12-31T17:35:58Z",
    "updated_at": "2011-12-31T17:35:58Z",
    "body": "Thanks Niko. I updated my [test](https://gist.github.com/1543358), but I'm still running into the same issue.\n\nOn a side note, I thought commit 7fd62bb unified uint with c unsigned integer. Am I misreading the commit?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3322089/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3322111",
    "html_url": "https://github.com/rust-lang/rust/issues/1402#issuecomment-3322111",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1402",
    "id": 3322111,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjIxMTE=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-12-31T17:40:02Z",
    "updated_at": "2011-12-31T17:40:02Z",
    "body": "I believe you are misreading the commit.  I think what that commit says is that \"if you are targeting a 64-bit CPU, then `uint` and `u64` are considered the same by the type checker\".  But `unsigned` in C is always `u32` in Rust terms, at least on the architectures we target.  \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3322111/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3322292",
    "html_url": "https://github.com/rust-lang/rust/issues/1402#issuecomment-3322292",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1402",
    "id": 3322292,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjIyOTI=",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-12-31T18:23:01Z",
    "updated_at": "2011-12-31T18:23:01Z",
    "body": "I found the problem. It looks like rust is passing the record by reference instead of by value. I updated my test to use `fn print_foo(+f: foo)` but that doesn't seem to have any effect. `print_foo` is still getting declared as `declare i1 @print_foo({ i8*, i32 }*)` in the bitcode.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3322292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3322698",
    "html_url": "https://github.com/rust-lang/rust/issues/1402#issuecomment-3322698",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1402",
    "id": 3322698,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjI2OTg=",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-12-31T20:03:14Z",
    "updated_at": "2011-12-31T20:03:14Z",
    "body": "- is \"by copy\".  Try ++.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3322698/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3322722",
    "html_url": "https://github.com/rust-lang/rust/issues/1402#issuecomment-3322722",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1402",
    "id": 3322722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjI3MjI=",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2011-12-31T20:13:17Z",
    "updated_at": "2011-12-31T20:13:17Z",
    "body": "Great, that worked! The [tutorial](http://www.rust-lang.org/doc/tutorial/args.html) said `+` was by value. I'll submit a pull request to add `++` to the doc.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3322722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3342761",
    "html_url": "https://github.com/rust-lang/rust/issues/1402#issuecomment-3342761",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1402",
    "id": 3342761,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDI3NjE=",
    "user": {
      "login": "erickt",
      "id": 84711,
      "node_id": "MDQ6VXNlcjg0NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erickt",
      "html_url": "https://github.com/erickt",
      "followers_url": "https://api.github.com/users/erickt/followers",
      "following_url": "https://api.github.com/users/erickt/following{/other_user}",
      "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erickt/subscriptions",
      "organizations_url": "https://api.github.com/users/erickt/orgs",
      "repos_url": "https://api.github.com/users/erickt/repos",
      "events_url": "https://api.github.com/users/erickt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erickt/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-01-03T17:07:57Z",
    "updated_at": "2012-01-03T17:07:57Z",
    "body": "I'm reopening this because while passing by-value worked for one pointer value, it's breaking for two. I've updated my [gist](https://gist.github.com/1543358) for a demonstration of the issue.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3342761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3380114",
    "html_url": "https://github.com/rust-lang/rust/issues/1402#issuecomment-3380114",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/1402",
    "id": 3380114,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzODAxMTQ=",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-01-06T02:42:11Z",
    "updated_at": "2012-01-06T02:42:11Z",
    "body": "This is a whole lot more broken than it looks at first. The reason is subtle.\n\nIn any calling convention, there's a division of labour between frontend and backend. For clang+LLVM, for example, some decisions are made by the code making LLVM-API calls (which things to pass by pointer or by value) and some decisions are made by the code inside LLVM.\n\nIt turns out that the place we draw the line is not the same place clang+LLVM draw the line. Which means that when we break clang off and put rustc in its place, we're assuming LLVM is going to be doing a bunch of things magically that it will not. It was expecting clang to make some of those decisions itself. We're not emulating what clang does, so we are operating LLVM in a not-expected way. The result is we're asking LLVM to generate non-system-ABI-conformant calls.\n\nThe abi is here: http://www.x86-64.org/documentation/abi.pdf and if you scan through to section 3.2.3 on page 15, you'll see there are quite a number of very subtle rules. These combine nontrivially. In particular, in the section on aggregate handling, section 5 (c) is causing your structure (when it's larger than 2 \"eightbytes\") to spill to memory; clang generates code like this to receive one by return-value, and pass it on by value:\n\n```\n%agg.tmp = alloca %struct.foo, align 8\ncall void @make_foo(%struct.foo* sret %agg.tmp)\ncall void @take_foo(%struct.foo* byval align 8 %agg.tmp)\n```\n\neven though it could easily go in registers. It's not of class SSE. This is not something LLVM does for us. The logic for it is in clang, over here: http://llvm.org/svn/llvm-project/cfe/trunk/lib/CodeGen/TargetInfo.cpp if you search for `class X86_64ABIInfo`\n\nThat code in turn appears to be driven by abstract parameter-attributes that are constructed over here http://llvm.org/svn/llvm-project/cfe/trunk/lib/CodeGen/CGCall.cpp, if you search for `ConstructAttributeList`. I believe we are, more or less, going to have to emulate all this logic ourselves if we want to operate LLVM in such a way that it's ABI compatible.\n\nThis sucks and will be a whole lot of work. It's not going to be fixed in time for this release.\n\nThanks to echristo for helping diagnose this.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/3380114/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
