[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71901900",
    "html_url": "https://github.com/rust-lang/rust/issues/21726#issuecomment-71901900",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21726",
    "id": 71901900,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxOTAxOTAw",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-28T19:45:32Z",
    "updated_at": "2015-01-28T19:45:32Z",
    "body": "I tagged this as associated items as my best guess is that the constraint that would `P::T` to affect `'a` is somehow getting lost.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71901900/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71949910",
    "html_url": "https://github.com/rust-lang/rust/issues/21726#issuecomment-71949910",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21726",
    "id": 71949910,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxOTQ5OTEw",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-29T01:03:34Z",
    "updated_at": "2015-01-29T01:03:34Z",
    "body": "I think the problem is actually variance, as @kimundi guessed initially, or perhaps a question of what the subtyping rules for associated types ought to be. Let's consider a simple trait `Foo`:\n\n``` rust\ntrait Foo {\n    type Output;\n\n    fn method(&self);\n}\n```\n\nThe normal variance inference will conclude that `Foo` is contravariant w/r/t `Self`, because `Self` only appears in a contravariant position in the method signature for `method()`.\n\nNow imagine I have `<U as Foo>::Output` and `<U' as Foo>::Output`, where `U <: U'`. What can we say about the relationship between `U::Output` and `U'::Output`, if any?\n\nMy first thought was that since `<U' as Foo> <: <U as Foo>` (since `Foo` is contravariant), we could say that `U'::Output <: U::Output`. But that doesn't seem to make any sense -- after all, this contravariance result is based purely on method signatures, and has no relation to the associated type definitions. And anyway we can easily concoct some examples where that relationship doesn't hold:\n\n``` rust\nstruct Bar<T>(T); // covariant in T\nimpl<T> Foo for Bar<T> {\n    type Output = fn() -> T;\n}\n```\n\nNow if `U=Bar<T>` and `U'=Bar<T'>`, where `T <: T'`, then `U <: U'`. So we'd expect that if my initial rules were correct, then `U'::Output <: U::Output` -- and hence `fn() -> T' <: fn() -> T`. But in fact `fn() -> T <: fn() -> T'`, since fn types are covariant in their return type and `T <: T'`. So in this case `U::Output <: U'::Output`.\n\nBut clearly we also can't conclude that `U::Output <: U'::Output` in general either. After all, we can easily build another example where the relationship is the opposite:\n\n``` rust\nstruct Baz<T>(T);\nimpl<T> Foo for Baz<T> {\n    type Output = fn(T);\n}\n```\n\nSo it seems like the only thing we can conclude is that `TraitRef::ItemName <: TraitRef'::ItemName` iff `TraitRef == TraitRef'`. In other words, a projection type is invariant with respect to its trait reference. This seems awfully strong but it's not clear to me how to make a weaker rule, at least not without some kind of declaration in the trait somehow relating the variance of `Output` to the trait inputs.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71949910/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71980369",
    "html_url": "https://github.com/rust-lang/rust/issues/21726#issuecomment-71980369",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21726",
    "id": 71980369,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxOTgwMzY5",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-29T07:11:19Z",
    "updated_at": "2015-01-29T07:11:19Z",
    "body": "Yes, I think your examples have hit it on the head: In general one cannot draw any conclusion about the relationship between `U::Output` and `U'::Output` without adding constraints (in the trait definition itself) on (1.) what the implementing type chooses for the `Output` associated item and/or (2.) the variance of that associated type with respect to the trait inputs and/or the `Self` type.  And we do not currently have anyway to express such constraints in the language, AFAICT.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71980369/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/72004245",
    "html_url": "https://github.com/rust-lang/rust/issues/21726#issuecomment-72004245",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21726",
    "id": 72004245,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMDA0MjQ1",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-29T10:40:56Z",
    "updated_at": "2015-01-29T10:40:56Z",
    "body": "@kimundi I'll try to get a fix up for this today, but in the meantime you CAN workaround it by adding a method like this to the trait:\n\n```\nfn dummy(&self, x: &'a ()) -> &'a () { x }\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/72004245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/72004315",
    "html_url": "https://github.com/rust-lang/rust/issues/21726#issuecomment-72004315",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21726",
    "id": 72004315,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMDA0MzE1",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-29T10:41:34Z",
    "updated_at": "2015-01-29T10:41:34Z",
    "body": "I already implemented the fix but I'm a bit stymied on how to write nice unit tests without support for `where for<'a> &'a T : Trait` style where clauses. I may just go off on a yak shave and implement those, which I've been meaning to do for other reasons.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/72004315/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/72037594",
    "html_url": "https://github.com/rust-lang/rust/issues/21726#issuecomment-72037594",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21726",
    "id": 72037594,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMDM3NTk0",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-29T14:55:30Z",
    "updated_at": "2015-01-29T14:55:30Z",
    "body": "Fix enqueued (#21747).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/72037594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/72068664",
    "html_url": "https://github.com/rust-lang/rust/issues/21726#issuecomment-72068664",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21726",
    "id": 72068664,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMDY4NjY0",
    "user": {
      "login": "Kimundi",
      "id": 2903206,
      "node_id": "MDQ6VXNlcjI5MDMyMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2903206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kimundi",
      "html_url": "https://github.com/Kimundi",
      "followers_url": "https://api.github.com/users/Kimundi/followers",
      "following_url": "https://api.github.com/users/Kimundi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kimundi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kimundi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kimundi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kimundi/orgs",
      "repos_url": "https://api.github.com/users/Kimundi/repos",
      "events_url": "https://api.github.com/users/Kimundi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kimundi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-29T17:37:47Z",
    "updated_at": "2015-01-29T17:37:47Z",
    "body": "Thanks! I'll use the workaround for now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/72068664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
