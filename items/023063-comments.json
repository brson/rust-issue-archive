[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/77357283",
    "html_url": "https://github.com/rust-lang/rust/issues/23063#issuecomment-77357283",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23063",
    "id": 77357283,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3MzU3Mjgz",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-05T12:41:53Z",
    "updated_at": "2015-03-05T12:41:53Z",
    "body": "> then why does the following fail?\n\nIn the second case `bf` has type `Box<[closure]>` and is not the trait object `Box<Fn>`.\n\nIt's clearer if you consider how the desugared version look like:\n\n``` rust\n#![feature(box_syntax)]\n#![feature(core)]\n#![feature(unboxed_closures)]\n\nuse std::any::Any;\nuse std::ops::Fn;\n\n// desugared version of `|x| 3 * x`\nstruct Closure;\n\nimpl Fn<(i32,)> for Closure {\n    type Output = i32;\n\n    extern \"rust-call\" fn call(&self, (x,): (i32,)) -> i32 {\n        3 * x\n    }\n}\n\nfn main()\n{\n    // If the following works...\n    {\n        let bf: Box<Fn(_)->_> = box Closure;\n        let bbf: &Any = &bf;\n        let bf = bbf.downcast_ref::<Box<Fn(i32)->i32>>().unwrap();\n        println!(\"Function evaluation gives {:?}\",bf(6));\n    }\n\n    // then why does the following fail?\n    {\n        let bf: Box<Closure> = box Closure;\n        let bbf:&Any = &bf;\n        let bf = bbf.downcast_ref::<Box<Fn(i32)->i32>>().unwrap();\n        println!(\"Function evaluation gives {:?}\",bf(6));\n    }\n}\n```\n\nIn general `box || {}` won't give you a trait object, you need to explicitly coerce it to a trait object (like you did in the first case). Also `box |x| 3*x` can be coerced up to three different trait objects: `Box<Fn>`, `Box<FnMut>` or `Box<FnOnce>`, so even if the compiler could automatically do the coercion for you, it would be ambiguous in this case (three possible outcomes), and explicitly annotating the coercion would still be required.\n\nThat being said, this is not a type inference bug.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/77357283/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/77455955",
    "html_url": "https://github.com/rust-lang/rust/issues/23063#issuecomment-77455955",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/23063",
    "id": 77455955,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDU1OTU1",
    "user": {
      "login": "yann-ledu",
      "id": 11094035,
      "node_id": "MDQ6VXNlcjExMDk0MDM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/11094035?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yann-ledu",
      "html_url": "https://github.com/yann-ledu",
      "followers_url": "https://api.github.com/users/yann-ledu/followers",
      "following_url": "https://api.github.com/users/yann-ledu/following{/other_user}",
      "gists_url": "https://api.github.com/users/yann-ledu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yann-ledu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yann-ledu/subscriptions",
      "organizations_url": "https://api.github.com/users/yann-ledu/orgs",
      "repos_url": "https://api.github.com/users/yann-ledu/repos",
      "events_url": "https://api.github.com/users/yann-ledu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yann-ledu/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-03-05T21:29:13Z",
    "updated_at": "2015-03-05T21:29:13Z",
    "body": "Very helpful! So downcasting was meant to fail in the second case : if I box<Any> a box<Closure>, then even though Closure implements the Fn trait, I cannot downcast to it ? I would have had to box<Any> a box<Fn> ? Ok, so I guess I can close this.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/77455955/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
