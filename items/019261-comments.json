[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64152841",
    "html_url": "https://github.com/rust-lang/rust/issues/19261#issuecomment-64152841",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19261",
    "id": 64152841,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0MTUyODQx",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-24T05:09:08Z",
    "updated_at": "2014-11-24T05:09:08Z",
    "body": "Nominating.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64152841/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64975458",
    "html_url": "https://github.com/rust-lang/rust/issues/19261#issuecomment-64975458",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19261",
    "id": 64975458,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0OTc1NDU4",
    "user": {
      "login": "DanielKeep",
      "id": 77238,
      "node_id": "MDQ6VXNlcjc3MjM4",
      "avatar_url": "https://avatars.githubusercontent.com/u/77238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DanielKeep",
      "html_url": "https://github.com/DanielKeep",
      "followers_url": "https://api.github.com/users/DanielKeep/followers",
      "following_url": "https://api.github.com/users/DanielKeep/following{/other_user}",
      "gists_url": "https://api.github.com/users/DanielKeep/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DanielKeep/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DanielKeep/subscriptions",
      "organizations_url": "https://api.github.com/users/DanielKeep/orgs",
      "repos_url": "https://api.github.com/users/DanielKeep/repos",
      "events_url": "https://api.github.com/users/DanielKeep/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DanielKeep/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-30T04:36:01Z",
    "updated_at": "2014-11-30T04:36:42Z",
    "body": "I believe this to be a problem specifically with `clone` for `&'a T`.  Take the following:\n\n```\nextern crate serialize;\nextern crate test;\n\n#[deriving(Encodable)]\npub struct JsonSerialized  {\n    really_long_field_name: uint,\n}\n\npub struct MyServer;\n\npub const ALT_BEHAVIOUR: bool = false;\n\nimpl MyServer {\n    fn get_json_str(&self) -> &str {\n        if ! ALT_BEHAVIOUR {\n            serialize::json::encode(&JsonSerialized {\n                really_long_field_name: 0,}).as_slice().clone()\n        } else {\n            let s0 = serialize::json::encode(&JsonSerialized { really_long_field_name: 0, });\n            println!(\"s0: `{}`\", s0);\n            let s1 = s0.as_slice();\n            println!(\"s1: `{}`\", s1);\n            let s2 = s1.clone();\n            println!(\"s2: `{}`\", s2);\n            s2\n        }\n    }\n}\n\nfn mess_the_heap() {\n    let s = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\".into_string();\n    test::black_box(s);\n}\n\nfn main() {\n    let srv = MyServer;\n    let s = srv.get_json_str();\n    mess_the_heap();\n    println!(\"s: `{}`\", s);\n}\n```\n\nRunning on Win x86, with `rustc 0.13.0-nightly (fac5a0767 2014-11-26 22:37:06 +0000)`, with `ALT_BEHAVIOUR = false`, produces the following output:\n\n```\ntask '<main>' panicked at 'failed printing to stdout: text was not valid unicode', C:\\bot\\slave\\nightly-win-32\\build\\src\\libstd\\io\\stdio.rs:229\n```\n\nRunning with `ALT_BEHAVIOUR = true` produces the following output:\n\n```\ns0: `{\"really_long_field_name\":0}`\ns1: `{\"really_long_field_name\":0}`\ns2: `{\"really_long_field_name\":0}`\ns: `ABCDEFGHIJKLMNOPQRSTUVWXYZ0}`\n```\n\nThis suggests that the allocation behind the temporary string is being freed and then re-used, despite still holding a borrowed reference.\n\n**Note**: this code **does not pass borrow checking** on `rustc 0.13.0-dev (8ed288edb 2014-11-06 16:52:09 +0000)` _i.e._ the version used by the playpen.  There, the following error occurs:\n\n```\n<anon>:16:17: 17:49 error: borrowed value does not live long enough\n<anon>:16                 serialize::json::encode(&JsonSerialized {\n<anon>:17                     really_long_field_name: 0,}).as_slice().clone()\n<anon>:14:40: 27:10 note: reference must be valid for the anonymous lifetime #1 defined on the block at 14:39...\n<anon>:14         fn get_json_str(&self) -> &str {\n<anon>:15             if ! ALT_BEHAVIOUR {\n<anon>:16                 serialize::json::encode(&JsonSerialized {\n<anon>:17                     really_long_field_name: 0,}).as_slice().clone()\n<anon>:18             } else {\n<anon>:19                 let s0 = serialize::json::encode(&JsonSerialized { really_long_field_name: 0, });\n          ...\n<anon>:15:32: 18:14 note: ...but borrowed value is only valid for the block at 15:31\n<anon>:15             if ! ALT_BEHAVIOUR {\n<anon>:16                 serialize::json::encode(&JsonSerialized {\n<anon>:17                     really_long_field_name: 0,}).as_slice().clone()\n<anon>:18             } else {\n<anon>:21:26: 21:28 error: `s0` does not live long enough\n<anon>:21                 let s1 = s0.as_slice();\n                                   ^~\n<anon>:14:40: 27:10 note: reference must be valid for the anonymous lifetime #1 defined on the block at 14:39...\n<anon>:14         fn get_json_str(&self) -> &str {\n<anon>:15             if ! ALT_BEHAVIOUR {\n<anon>:16                 serialize::json::encode(&JsonSerialized {\n<anon>:17                     really_long_field_name: 0,}).as_slice().clone()\n<anon>:18             } else {\n<anon>:19                 let s0 = serialize::json::encode(&JsonSerialized { really_long_field_name: 0, });\n          ...\n<anon>:18:20: 26:14 note: ...but borrowed value is only valid for the block at 18:19\n<anon>:18             } else {\n<anon>:19                 let s0 = serialize::json::encode(&JsonSerialized { really_long_field_name: 0, });\n<anon>:20                 println!(\"s0: `{}`\", s0);\n<anon>:21                 let s1 = s0.as_slice();\n<anon>:22                 println!(\"s1: `{}`\", s1);\n<anon>:23                 let s2 = s1.clone();\n          ...\nerror: aborting due to 2 previous errors\nplaypen: application terminated with error code 101\n```\n\nWhich suggests a recent regression.\n\nThis particular case was found by `rictic` on IRC.\n\nI should also note that I was _incredibly_ lucky with this: making the `\"ABCDEF...\"` string constant longer or shorter causes the problem to disappear!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64975458/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65007507",
    "html_url": "https://github.com/rust-lang/rust/issues/19261#issuecomment-65007507",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19261",
    "id": 65007507,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MDA3NTA3",
    "user": {
      "login": "ftxqxd",
      "id": 2055302,
      "node_id": "MDQ6VXNlcjIwNTUzMDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2055302?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ftxqxd",
      "html_url": "https://github.com/ftxqxd",
      "followers_url": "https://api.github.com/users/ftxqxd/followers",
      "following_url": "https://api.github.com/users/ftxqxd/following{/other_user}",
      "gists_url": "https://api.github.com/users/ftxqxd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ftxqxd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ftxqxd/subscriptions",
      "organizations_url": "https://api.github.com/users/ftxqxd/orgs",
      "repos_url": "https://api.github.com/users/ftxqxd/repos",
      "events_url": "https://api.github.com/users/ftxqxd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ftxqxd/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-01T00:22:17Z",
    "updated_at": "2014-12-01T00:22:17Z",
    "body": "A smaller form of the same bug:\n\n``` rust\nfn staticify<T>(x: &T) -> &'static T {\n    x.clone()\n}\n```\n\nThis is obviously not safe, and allows one to leak references into `proc(): Send`s. Strangely, I can\u2019t seem to replicate this issue using the UFCS `Clone::clone(x)` form, no matter what `*`s or `&`s I attach to `x`\u2014the issue seems to only be present for normal method-style calls.\n\n(This was discovered by tamird and bluss on IRC.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65007507/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65007843",
    "html_url": "https://github.com/rust-lang/rust/issues/19261#issuecomment-65007843",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19261",
    "id": 65007843,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MDA3ODQz",
    "user": {
      "login": "tamird",
      "id": 1535036,
      "node_id": "MDQ6VXNlcjE1MzUwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1535036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tamird",
      "html_url": "https://github.com/tamird",
      "followers_url": "https://api.github.com/users/tamird/followers",
      "following_url": "https://api.github.com/users/tamird/following{/other_user}",
      "gists_url": "https://api.github.com/users/tamird/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tamird/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tamird/subscriptions",
      "organizations_url": "https://api.github.com/users/tamird/orgs",
      "repos_url": "https://api.github.com/users/tamird/repos",
      "events_url": "https://api.github.com/users/tamird/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tamird/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-01T00:31:48Z",
    "updated_at": "2014-12-01T00:31:48Z",
    "body": "cc @glennpratt\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65007843/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65008235",
    "html_url": "https://github.com/rust-lang/rust/issues/19261#issuecomment-65008235",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19261",
    "id": 65008235,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MDA4MjM1",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-01T00:42:09Z",
    "updated_at": "2014-12-01T00:42:09Z",
    "body": "This is probably not specific to static lifetimes, as this passes:\n\n``` rust\nfn leak<'a, T>(x: T) -> &'a T {\n    (&x).clone()\n}\n```\n\nI'm returning a reference to what is essentially a local variable! Not good, not good at all.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65008235/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65013306",
    "html_url": "https://github.com/rust-lang/rust/issues/19261#issuecomment-65013306",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19261",
    "id": 65013306,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MDEzMzA2",
    "user": {
      "login": "kmcallister",
      "id": 444997,
      "node_id": "MDQ6VXNlcjQ0NDk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kmcallister",
      "html_url": "https://github.com/kmcallister",
      "followers_url": "https://api.github.com/users/kmcallister/followers",
      "following_url": "https://api.github.com/users/kmcallister/following{/other_user}",
      "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions",
      "organizations_url": "https://api.github.com/users/kmcallister/orgs",
      "repos_url": "https://api.github.com/users/kmcallister/repos",
      "events_url": "https://api.github.com/users/kmcallister/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kmcallister/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-01T02:22:29Z",
    "updated_at": "2014-12-01T02:22:49Z",
    "body": "`git bisect` pins this on 336349c93207d792587eb0b5258b29da6ec0db8a which was #18694.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65013306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65013400",
    "html_url": "https://github.com/rust-lang/rust/issues/19261#issuecomment-65013400",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19261",
    "id": 65013400,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MDEzNDAw",
    "user": {
      "login": "kmcallister",
      "id": 444997,
      "node_id": "MDQ6VXNlcjQ0NDk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kmcallister",
      "html_url": "https://github.com/kmcallister",
      "followers_url": "https://api.github.com/users/kmcallister/followers",
      "following_url": "https://api.github.com/users/kmcallister/following{/other_user}",
      "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions",
      "organizations_url": "https://api.github.com/users/kmcallister/orgs",
      "repos_url": "https://api.github.com/users/kmcallister/repos",
      "events_url": "https://api.github.com/users/kmcallister/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kmcallister/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-01T02:24:25Z",
    "updated_at": "2014-12-01T02:24:25Z",
    "body": "cc @nikomatsakis\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65013400/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66499445",
    "html_url": "https://github.com/rust-lang/rust/issues/19261#issuecomment-66499445",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19261",
    "id": 66499445,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NDk5NDQ1",
    "user": {
      "login": "Manishearth",
      "id": 1617736,
      "node_id": "MDQ6VXNlcjE2MTc3MzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Manishearth",
      "html_url": "https://github.com/Manishearth",
      "followers_url": "https://api.github.com/users/Manishearth/followers",
      "following_url": "https://api.github.com/users/Manishearth/following{/other_user}",
      "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions",
      "organizations_url": "https://api.github.com/users/Manishearth/orgs",
      "repos_url": "https://api.github.com/users/Manishearth/repos",
      "events_url": "https://api.github.com/users/Manishearth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Manishearth/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-10T18:33:18Z",
    "updated_at": "2014-12-10T18:33:18Z",
    "body": "Rather simple example\n\n```\nfn main() {\n let y = {\n  // \"hello world\" allocated\n  \"hello world\".to_string().as_slice().clone()\n  // \"hello world\" deallocated\n };\n // new string allocated in same spot\n let z = \"something\".to_string();\n println!(\"{}\", y)\n // prints \"somethingld\"\n}\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66499445/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66690818",
    "html_url": "https://github.com/rust-lang/rust/issues/19261#issuecomment-66690818",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19261",
    "id": 66690818,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NjkwODE4",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-11T21:20:14Z",
    "updated_at": "2014-12-11T21:20:14Z",
    "body": "1.0, P-backcompat-lang. fix enqueued.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/66690818/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
