{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/4931",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/4931/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/4931/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/4931/events",
  "html_url": "https://github.com/rust-lang/rust/pull/4931",
  "id": 11011279,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NDE1MTcyMA==",
  "number": 4931,
  "title": "stop applying noinline to glue code",
  "user": {
    "login": "thestinger",
    "id": 1505226,
    "node_id": "MDQ6VXNlcjE1MDUyMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thestinger",
    "html_url": "https://github.com/thestinger",
    "followers_url": "https://api.github.com/users/thestinger/followers",
    "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
    "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
    "organizations_url": "https://api.github.com/users/thestinger/orgs",
    "repos_url": "https://api.github.com/users/thestinger/repos",
    "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thestinger/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 0,
  "created_at": "2013-02-14T20:02:10Z",
  "updated_at": "2014-07-24T18:27:42Z",
  "closed_at": "2013-02-14T20:59:37Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/4931",
    "html_url": "https://github.com/rust-lang/rust/pull/4931",
    "diff_url": "https://github.com/rust-lang/rust/pull/4931.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/4931.patch",
    "merged_at": null
  },
  "body": "Using `noinline` causes a 3-10% hit in performance for most compiled Rust code. For the TreeMap it's ~15% and that's where I first noticed it.\n\nRemoving the noinline attribute doesn't slow down unoptimized builds, but it does significantly increase the time spent in LLVM passes for optimized builds. The improved speed of the compiler actually improves compile-times when optimization is off.\n\nHowever, the reason for the increase is because more optimization is being done - I'm sure it would speed up compiles to mark _everything_ with noinline, but it wouldn't be a good idea.\n\nLLVM is clever enough with the inlining heuristics that this doesn't cause a notable increase in code size - some code becomes a bit bigger, some becomes a bit smaller. There are some cases where it's able to strip out a ton of code thanks to inlining.\n\nI tried out `optsize` for glue code instead but it caused the same hit for LLVM passes in the compile time and the compiled code was a _tiny_ bit slower than just trusting LLVM to make the decisions.\n- [TIME_PASSES=1 benchmarks](http://ompldr.org/vaGdxaA) (showing the performance increase in `rustc` and also the extra time spent in LLVM passes for more optimization)\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/4931/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/4931/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
