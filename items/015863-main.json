{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/15863",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/15863/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/15863/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/15863/events",
  "html_url": "https://github.com/rust-lang/rust/pull/15863",
  "id": 38323802,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTg2NjY3Mzg=",
  "number": 15863,
  "title": "Emit LLVM lifetime intrinsics to improve stack usage and codegen in general",
  "user": {
    "login": "dotdash",
    "id": 230962,
    "node_id": "MDQ6VXNlcjIzMDk2Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dotdash",
    "html_url": "https://github.com/dotdash",
    "followers_url": "https://api.github.com/users/dotdash/followers",
    "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
    "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
    "organizations_url": "https://api.github.com/users/dotdash/orgs",
    "repos_url": "https://api.github.com/users/dotdash/repos",
    "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dotdash/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 8,
  "created_at": "2014-07-21T17:14:41Z",
  "updated_at": "2015-02-04T12:41:57Z",
  "closed_at": "2014-07-22T19:36:16Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/15863",
    "html_url": "https://github.com/rust-lang/rust/pull/15863",
    "diff_url": "https://github.com/rust-lang/rust/pull/15863.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/15863.patch",
    "merged_at": "2014-07-22T19:36:22Z"
  },
  "body": "Lifetime intrinsics help to reduce stack usage, because LLVM can apply\nstack coloring to reuse the stack slots of dead allocas for new ones.\n\nFor example these functions now both use the same amount of stack, while\nprevious `bar()` used five times as much as `foo()`:\n\n``` rust\nfn foo() {\n  println(\"{}\", 5);\n}\n\nfn bar() {\n  println(\"{}\", 5);\n  println(\"{}\", 5);\n  println(\"{}\", 5);\n  println(\"{}\", 5);\n  println(\"{}\", 5);\n}\n```\n\nOn top of that, LLVM can also optimize out certain operations when it\nknows that memory is dead after a certain point. For example, it can\nsometimes remove the zeroing used to cancel the drop glue. This is\npossible when the glue drop itself was already removed because the\nzeroing dominated the drop glue call. For example in:\n\n``` rust\npub fn bar(x: (Box<int>, int)) -> (Box<int>, int) {\n    x\n}\n```\n\nWith optimizations, this currently results in:\n\n``` llvm\ndefine void @_ZN3bar20h330fa42547df8179niaE({ i64*, i64 }* noalias nocapture nonnull sret, { i64*, i64 }* noalias nocapture nonnull) unnamed_addr #0 {\n\"_ZN29_$LP$Box$LT$int$GT$$C$int$RP$39glue_drop.$x22glue_drop$x22$LP$1347$RP$17h88cf42702e5a322aE.exit\":\n  %2 = bitcast { i64*, i64 }* %1 to i8*\n  %3 = bitcast { i64*, i64 }* %0 to i8*\n  tail call void @llvm.memcpy.p0i8.p0i8.i64(i8* %3, i8* %2, i64 16, i32 8, i1 false)\n  tail call void @llvm.memset.p0i8.i64(i8* %2, i8 0, i64 16, i32 8, i1 false)\n  ret void\n}\n```\n\nBut with lifetime intrinsics we get:\n\n``` llvm\ndefine void @_ZN3bar20h330fa42547df8179niaE({ i64*, i64 }* noalias nocapture nonnull sret, { i64*, i64 }* noalias nocapture nonnull) unnamed_addr #0 {\n\"_ZN29_$LP$Box$LT$int$GT$$C$int$RP$39glue_drop.$x22glue_drop$x22$LP$1347$RP$17h88cf42702e5a322aE.exit\":\n  %2 = bitcast { i64*, i64 }* %1 to i8*\n  %3 = bitcast { i64*, i64 }* %0 to i8*\n  tail call void @llvm.memcpy.p0i8.p0i8.i64(i8* %3, i8* %2, i64 16, i32 8, i1 false)\n  tail call void @llvm.lifetime.end(i64 16, i8* %2)\n  ret void\n}\n```\n\nFixes #15665\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/15863/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/15863/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
