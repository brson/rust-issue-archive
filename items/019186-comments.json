[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63990576",
    "html_url": "https://github.com/rust-lang/rust/issues/19186#issuecomment-63990576",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19186",
    "id": 63990576,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzOTkwNTc2",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-21T15:58:20Z",
    "updated_at": "2014-11-21T15:58:20Z",
    "body": "@japaric Thanks so much for putting this together!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63990576/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64037966",
    "html_url": "https://github.com/rust-lang/rust/issues/19186#issuecomment-64037966",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19186",
    "id": 64037966,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0MDM3OTY2",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-21T21:08:49Z",
    "updated_at": "2014-11-21T21:08:49Z",
    "body": "Added #18048 (ICE when cross-crate importing a trait that has associated output types) to the list, which blocks any work on associated types.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64037966/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64097784",
    "html_url": "https://github.com/rust-lang/rust/issues/19186#issuecomment-64097784",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19186",
    "id": 64097784,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0MDk3Nzg0",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-22T22:20:50Z",
    "updated_at": "2014-11-22T22:20:50Z",
    "body": "cc @nikomatsakis @nick29581 \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64097784/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64425312",
    "html_url": "https://github.com/rust-lang/rust/issues/19186#issuecomment-64425312",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19186",
    "id": 64425312,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NDI1MzEy",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-25T16:16:06Z",
    "updated_at": "2014-11-25T16:16:06Z",
    "body": "I was exploring using unboxed closures in structs like `core::iter::Map`, and I hit the `bytes()`/`Bytes` issue that [I've mentioned before](https://github.com/rust-lang/rust/issues/18101#issuecomment-61416554). I explored the alternatives suggested in that thread, but turns out I can't really use any of them. Let me elaborate:\n- We want to make `Map` use unboxed closures like this:\n\n``` rust\nstruct Map<A, B, I, F> where I: Iterator<A>, F: FnMut(A) -> B {\n    iter: I,\n    f: F,\n}\n```\n- Currently, the `StrPrelude::bytes()` method returns `Bytes` which is a type alias to `Map`. This is how the method looks like:\n\n``` rust\n// Self = str\nfn bytes<'a>(&'a self) -> Bytes<'a> {\n    self.as_bytes().iter().map(|&b| b)\n}\n```\n- The issue: The `bytes` method _can't_ be written like that with the \"unboxed\" version of `Map`. The reason is that `Bytes` would have to be an alias to `Map<&'a u8, u8, slice::Items<'a, u8>, ???>`, where `???` is the type of the unboxed closure. But since unboxed closures have anonymous types, that return type can't be \"written down\".\n\n---\n\nThese are the suggestions (proposed in the other thread) to work around the issue:\n- Use a boxed closure `Box<FnMut(..) -> _>` instead of `???`: This is not possible in this case, because we're dealing with _libcore_, so there is no `Box` here.\n- Use `&'static FnMut(..) -> _` instead of `???`: AFAIK, it's not currently possible to create a value with that type. (Do we plan to support that in the future?)\n- Use some `Struct` instead of `???` where `Struct: FnMut(..) -> _`: Because of #18835/#19032, is not currently possible to do `impl FnMut(..) -> _ for Struct`.\n- Make `Bytes` a struct where `Bytes: Iterator<u8>`, and make `StrPrelude::bytes` return that struct. This literally means that we won't use closures at all.\n\n---\n\n`StrPrelude::bytes()`/`Bytes` is not the only occurrence. There is also `StrPrelude::lines_any()`/`AnyLines` in the same module, and there are probably other cases with other iterator adaptors and in other crates.\n\nMy question here is: On what issue should we block \"Using unboxed closures in structs field\"?\n- On the availability of `&'static Fn(..) -> _` values?\n- Should we wait on #19032, and use \"callable\" structs instead of sugared unboxed closures?\n- Should we leave it unblocked, and just use one-use `Iterator` structs where possible?\n\nI'll explore this last option, because I want to see if any other bug/ICE pops up in the process.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64425312/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64444252",
    "html_url": "https://github.com/rust-lang/rust/issues/19186#issuecomment-64444252",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19186",
    "id": 64444252,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NDQ0MjUy",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-25T18:08:05Z",
    "updated_at": "2014-11-25T18:08:05Z",
    "body": "> I'll explore this last option, because I want to see if any other bug/ICE pops up in the process.\n\nJust found out that there are a lot of type aliases to `Map` in libcollections, that will need to be updated to work with unboxed closures. Namely, all the `Keys`/`Values`/`MoveItems` aliases in each module of libcollections, i.e. `btree::Keys`, `hash_map::Values`, etc.\n\nSince libcollections has access to liballoc, I tried to use the `Box<FnMut(..) -> _>` approach, but the `Box` needs a lifetime specifier (like `Box<FnMut(..) -> _ + 'static`), and that doesn't currently parses because of #18772. Thankfully, @nikomatsakis already sent PR #19298 fixing the issue!\n\nI'll update the top comment to mention that issue, because we want it to get snapshot-ed.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64444252/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64449185",
    "html_url": "https://github.com/rust-lang/rust/issues/19186#issuecomment-64449185",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19186",
    "id": 64449185,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NDQ5MTg1",
    "user": {
      "login": "sfackler",
      "id": 1455697,
      "node_id": "MDQ6VXNlcjE0NTU2OTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sfackler",
      "html_url": "https://github.com/sfackler",
      "followers_url": "https://api.github.com/users/sfackler/followers",
      "following_url": "https://api.github.com/users/sfackler/following{/other_user}",
      "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions",
      "organizations_url": "https://api.github.com/users/sfackler/orgs",
      "repos_url": "https://api.github.com/users/sfackler/repos",
      "events_url": "https://api.github.com/users/sfackler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sfackler/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-25T18:41:14Z",
    "updated_at": "2014-11-25T18:41:14Z",
    "body": "Don't functions implement the `Fn` traits? We might be able to work around some of these issues by using them instead of the closure sugar.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64449185/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64456143",
    "html_url": "https://github.com/rust-lang/rust/issues/19186#issuecomment-64456143",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19186",
    "id": 64456143,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NDU2MTQz",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-25T19:26:53Z",
    "updated_at": "2014-11-25T19:26:53Z",
    "body": "> Don't functions implement the Fn traits?\n\nYes! And it _almost_ works:\n\n``` rust\n#![feature(unboxed_closures)]\n\nuse std::{iter, slice};\n\nstruct Map<A, B, I, F> where I: Iterator<A>, F: FnMut(A) -> B {\n    iter: I,\n    f: F,\n}\n\nfn bytes<'a>(s: &'a str) -> Map<&'a u8, u8, slice::Items<'a, u8>, fn(&u8) -> u8> {\n    //~^ error: the trait `core::ops::Fn<(&'a u8,), u8>` is not implemented for the type `fn(&u8) -> u8`\n    fn deref(&b: &u8) -> u8 { b }\n\n    Map {\n        iter: s.as_bytes().iter(),\n        f: deref,\n    }\n}\n\nfn this_works() -> Map<u8, uint, iter::Range<u8>, fn(u8) -> uint> {\n    fn cast(i: u8) -> uint { i as uint }\n\n    Map {\n        iter: range(0, 5),\n        f: cast,\n    }\n}\n\nfn main() {}\n```\n\nExcept that due to #19126, bare functions that have lifetimes in their arguments/return value currently don't implement the Fn traits. Still, it's a great idea, I'll add it the top comment. Thanks @sfackler!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/64456143/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68518726",
    "html_url": "https://github.com/rust-lang/rust/issues/19186#issuecomment-68518726",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19186",
    "id": 68518726,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NTE4NzI2",
    "user": {
      "login": "AndyShiue",
      "id": 7116637,
      "node_id": "MDQ6VXNlcjcxMTY2Mzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7116637?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AndyShiue",
      "html_url": "https://github.com/AndyShiue",
      "followers_url": "https://api.github.com/users/AndyShiue/followers",
      "following_url": "https://api.github.com/users/AndyShiue/following{/other_user}",
      "gists_url": "https://api.github.com/users/AndyShiue/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AndyShiue/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AndyShiue/subscriptions",
      "organizations_url": "https://api.github.com/users/AndyShiue/orgs",
      "repos_url": "https://api.github.com/users/AndyShiue/repos",
      "events_url": "https://api.github.com/users/AndyShiue/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AndyShiue/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-02T10:40:47Z",
    "updated_at": "2015-01-02T10:40:47Z",
    "body": "Can this be closed?\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68518726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68525355",
    "html_url": "https://github.com/rust-lang/rust/issues/19186#issuecomment-68525355",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19186",
    "id": 68525355,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NTI1MzU1",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-02T13:07:07Z",
    "updated_at": "2015-01-02T13:07:07Z",
    "body": "> Can this be closed?\n\nYes. There are still blockers (mainly for assoc types) but I'm working with @nikomatsakis in a tight feedback loop (on IRC) so this issue is not relevant anymore.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68525355/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
