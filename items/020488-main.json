{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/20488",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20488/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20488/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20488/events",
  "html_url": "https://github.com/rust-lang/rust/pull/20488",
  "id": 53316536,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MjY3ODc0MTY=",
  "number": 20488,
  "title": "Make temporary directory names non-deterministic.",
  "user": {
    "login": "ltratt",
    "id": 20318,
    "node_id": "MDQ6VXNlcjIwMzE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/20318?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ltratt",
    "html_url": "https://github.com/ltratt",
    "followers_url": "https://api.github.com/users/ltratt/followers",
    "following_url": "https://api.github.com/users/ltratt/following{/other_user}",
    "gists_url": "https://api.github.com/users/ltratt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ltratt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ltratt/subscriptions",
    "organizations_url": "https://api.github.com/users/ltratt/orgs",
    "repos_url": "https://api.github.com/users/ltratt/repos",
    "events_url": "https://api.github.com/users/ltratt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ltratt/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "alexcrichton",
    "id": 64996,
    "node_id": "MDQ6VXNlcjY0OTk2",
    "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexcrichton",
    "html_url": "https://github.com/alexcrichton",
    "followers_url": "https://api.github.com/users/alexcrichton/followers",
    "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
    "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
    "repos_url": "https://api.github.com/users/alexcrichton/repos",
    "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2015-01-03T21:52:02Z",
  "updated_at": "2015-10-28T13:59:49Z",
  "closed_at": "2015-01-06T11:31:36Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/20488",
    "html_url": "https://github.com/rust-lang/rust/pull/20488",
    "diff_url": "https://github.com/rust-lang/rust/pull/20488.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/20488.patch",
    "merged_at": "2015-01-06T11:31:36Z"
  },
  "body": "The previous scheme made it possible for another user/attacker to cause the\ntemporary directory creation scheme to panic. All you needed to know was the pid\nof the process you wanted to target ('other_pid') and the suffix it was using\n(let's pretend it's 'sfx') and then code such as this would, in essence, DOS it:\n\n```\nfor i in range(0u, 1001) {\n    let tp = &Path::new(format!(\"/tmp/rs-{}-{}-sfx\", other_pid, i));\n    match fs::mkdir(tp, io::USER_RWX) { _ => () }\n}\n```\n\nSince the scheme only 1000 times to create a temporary directory before dying,\nthe next time the attacked process called TempDir::new(\"sfx\") after that would\ntypically cause a panic. Of course, you don't necessarily need an attacker to\ncause such a DOS: creating 1000 temporary directories without closing any of the\nprevious would be enough to DOS yourself.\n\nThis patch broadly follows the OpenBSD implementation of mkstemp. It uses the\noperating system's random number generator to produce random directory names\nthat are impractical to guess (and, just in case someone manages to do that, it\nretries creating the directory for a long time before giving up; OpenBSD\nretries INT_MAX times, although 1<<31 seems enough to thwart even the most\npatient attacker).\n\nAs a small additional change while the file name is changing, this patch also\nmakes the argument that TempDir::new takes a prefix rather than a suffix.\nThis is because 1) it more closely matches what mkstemp and friends do 2)\nif you're going to have a deterministic part of a filename, you really want it at\nthe beginning so that shell completion is useful.\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/20488/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20488/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
