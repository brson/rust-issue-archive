[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/98604049",
    "html_url": "https://github.com/rust-lang/rust/issues/25089#issuecomment-98604049",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25089",
    "id": 98604049,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk4NjA0MDQ5",
    "user": {
      "login": "veddan",
      "id": 307180,
      "node_id": "MDQ6VXNlcjMwNzE4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/307180?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/veddan",
      "html_url": "https://github.com/veddan",
      "followers_url": "https://api.github.com/users/veddan/followers",
      "following_url": "https://api.github.com/users/veddan/following{/other_user}",
      "gists_url": "https://api.github.com/users/veddan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/veddan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/veddan/subscriptions",
      "organizations_url": "https://api.github.com/users/veddan/orgs",
      "repos_url": "https://api.github.com/users/veddan/repos",
      "events_url": "https://api.github.com/users/veddan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/veddan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-04T07:05:54Z",
    "updated_at": "2015-05-04T07:05:54Z",
    "body": "Try using lldb to get a stacktrace:\n\n```\n$ lldb -- target/debug/play-bc5fff1cb75e27c9 --test\n$ run\n...\n$ bt\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/98604049/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/98609433",
    "html_url": "https://github.com/rust-lang/rust/issues/25089#issuecomment-98609433",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25089",
    "id": 98609433,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk4NjA5NDMz",
    "user": {
      "login": "zummenix",
      "id": 3009258,
      "node_id": "MDQ6VXNlcjMwMDkyNTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3009258?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zummenix",
      "html_url": "https://github.com/zummenix",
      "followers_url": "https://api.github.com/users/zummenix/followers",
      "following_url": "https://api.github.com/users/zummenix/following{/other_user}",
      "gists_url": "https://api.github.com/users/zummenix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zummenix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zummenix/subscriptions",
      "organizations_url": "https://api.github.com/users/zummenix/orgs",
      "repos_url": "https://api.github.com/users/zummenix/repos",
      "events_url": "https://api.github.com/users/zummenix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zummenix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-04T07:30:01Z",
    "updated_at": "2015-05-04T07:30:01Z",
    "body": "```\n(lldb) run\nProcess 30437 launched: '/Users/zummenix/projects/play/target/debug/play-bc5fff1cb75e27c9' (x86_64)\n\nrunning 1 test\nProcess 30437 stopped\n* thread #2: tid = 0x20a9f5, 0x0000000100063bf6 play-bc5fff1cb75e27c9`je_arena_dalloc_bin_locked [inlined] je_bitmap_unset(bit=0) + 71 at bitmap.h:215, name = 'panic', stop reason = EXC_BAD_ACCESS (code=EXC_I386_GPFLT)\n    frame #0: 0x0000000100063bf6 play-bc5fff1cb75e27c9`je_arena_dalloc_bin_locked [inlined] je_bitmap_unset(bit=0) + 71 at bitmap.h:215\n(lldb) bt\n* thread #2: tid = 0x20a9f5, 0x0000000100063bf6 play-bc5fff1cb75e27c9`je_arena_dalloc_bin_locked [inlined] je_bitmap_unset(bit=0) + 71 at bitmap.h:215, name = 'panic', stop reason = EXC_BAD_ACCESS (code=EXC_I386_GPFLT)\n  * frame #0: 0x0000000100063bf6 play-bc5fff1cb75e27c9`je_arena_dalloc_bin_locked [inlined] je_bitmap_unset(bit=0) + 71 at bitmap.h:215\n    frame #1: 0x0000000100063baf play-bc5fff1cb75e27c9`je_arena_dalloc_bin_locked [inlined] arena_run_reg_dalloc(ptr=<unavailable>, run=0x0000000101c021a8) + 95 at arena.c:217\n    frame #2: 0x0000000100063b50 play-bc5fff1cb75e27c9`je_arena_dalloc_bin_locked(arena=0x0000000101042980, chunk=0x0000000101c00000, ptr=<unavailable>, bitselm=0x0000000000000000) + 208 at arena.c:1780\n    frame #3: 0x0000000100074381 play-bc5fff1cb75e27c9`je_tcache_bin_flush_small(tbin=0x0000000101c1c028, binind=0, rem=0, tcache=0x0000000101c1c000) + 241 at tcache.c:120\n    frame #4: 0x0000000100074f50 play-bc5fff1cb75e27c9`je_tcache_cleanup [inlined] tcache_destroy + 42 at tcache.c:328\n    frame #5: 0x0000000100074f26 play-bc5fff1cb75e27c9`je_tcache_cleanup(tsd=0x0000000101433108) + 38 at tcache.c:385\n    frame #6: 0x00000001000769ff play-bc5fff1cb75e27c9`je_tsd_cleanup(arg=0x0000000101433108) + 159 at tsd.c:81\n    frame #7: 0x0000000100076e2a play-bc5fff1cb75e27c9`je_tsd_cleanup_wrapper(arg=0x0000000101433100) + 26 at tsd.h:486\n    frame #8: 0x00007fff968bb72a libsystem_pthread.dylib`_pthread_tsd_cleanup + 86\n    frame #9: 0x00007fff968bb451 libsystem_pthread.dylib`_pthread_exit + 117\n    frame #10: 0x00007fff968ba273 libsystem_pthread.dylib`_pthread_body + 142\n    frame #11: 0x00007fff968ba1e5 libsystem_pthread.dylib`_pthread_start + 176\n    frame #12: 0x00007fff968b841d libsystem_pthread.dylib`thread_start + 13\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/98609433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/98843860",
    "html_url": "https://github.com/rust-lang/rust/issues/25089#issuecomment-98843860",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25089",
    "id": 98843860,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk4ODQzODYw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-04T20:37:10Z",
    "updated_at": "2015-05-04T20:37:10Z",
    "body": "It looks like this is a bug in trans, the cleanup for the `String` argument in the example is given twice. For example this code has this IR:\n\n``` rust\n#[test]\n#[should_panic]\nfn panic() {\n    should_panic(Box::new(1), empty());\n}\n\nstruct Empty;\n\nfn empty() -> Empty { Empty }\n\n#[inline(never)]\nfn should_panic(_: Box<u32>, _: Empty) {\n    panic!(\"test panic\");\n}\n```\n\nOptimized IR:\n\n``` ll\ndefine internal void @_ZN5panic20hbd7799a4d53a7c18eaaE() unnamed_addr #0 {\nentry-block:\n  %0 = tail call i8* @je_mallocx(i64 4, i32 0)\n  %1 = icmp eq i8* %0, null\n  br i1 %1, label %then-block-132-.i.i, label %normal-return\n\nthen-block-132-.i.i:                              ; preds = %entry-block\n  tail call void @_ZN3oom20h5ea7b8934ca1bc543ZaE()\n  unreachable\n\nnormal-return:                                    ; preds = %entry-block\n  %2 = bitcast i8* %0 to i32*\n  store i32 1, i32* %2, align 4\n  invoke fastcc void @_ZN12should_panic20hfe6f725236e48244xaaE(i32* noalias dereferenceable(4) %2)\n          to label %normal-return1 unwind label %unwind_custom_\n\nunwind_custom_:                                   ; preds = %normal-return\n  %3 = landingpad { i8*, i32 } personality i32 (i32, i32, i64, %\"1.std::rt::libunwind::_Unwind_Exception\"*, %\"1.std::rt::libunwind::_Unwind_Context\"*)* @rust_eh_personality\n          cleanup\n  %4 = icmp eq i8* %0, inttoptr (i64 2097865012304223517 to i8*)\n  br i1 %4, label %\"_ZN14Box$LT$u32$GT$9drop.118117h48c45852b94c565eE.exit\", label %cond.i\n\ncond.i:                                           ; preds = %unwind_custom_\n  tail call void @je_sdallocx(i8* %0, i64 4, i32 0)\n  br label %\"_ZN14Box$LT$u32$GT$9drop.118117h48c45852b94c565eE.exit\"\n\n\"_ZN14Box$LT$u32$GT$9drop.118117h48c45852b94c565eE.exit\": ; preds = %unwind_custom_, %cond.i\n  resume { i8*, i32 } %3\n\nnormal-return1:                                   ; preds = %normal-return\n  ret void\n}\n\n; Function Attrs: noinline noreturn uwtable\ndefine internal fastcc void @_ZN12should_panic20hfe6f725236e48244xaaE(i32* noalias dereferenceable(4)) unnamed_addr #1 {\nentry-block:\n  %const = alloca %str_slice, align 8\n  %1 = bitcast %str_slice* %const to i8*\n  call void @llvm.memcpy.p0i8.p0i8.i64(i8* %1, i8* bitcast (%str_slice* @const1222 to i8*), i64 16, i32 8, i1 false)\n  invoke fastcc void @_ZN2rt6unwind12begin_unwind20h8221535833087833418E(%str_slice* noalias nocapture dereferenceable(16) %const)\n          to label %normal-return unwind label %unwind_custom_\n\nnormal-return:                                    ; preds = %entry-block\n  call void @llvm.lifetime.end(i64 16, i8* %1)\n  unreachable\n\nunwind_custom_:                                   ; preds = %entry-block\n  %2 = landingpad { i8*, i32 } personality i32 (i32, i32, i64, %\"1.std::rt::libunwind::_Unwind_Exception\"*, %\"1.std::rt::libunwind::_Unwind_Context\"*)* @rust_eh_personality\n          cleanup\n  %3 = icmp eq i32* %0, inttoptr (i64 2097865012304223517 to i32*)\n  br i1 %3, label %\"_ZN14Box$LT$u32$GT$9drop.118117h48c45852b94c565eE.exit\", label %cond.i\n\ncond.i:                                           ; preds = %unwind_custom_\n  %4 = bitcast i32* %0 to i8*\n  tail call void @je_sdallocx(i8* %4, i64 4, i32 0)\n  br label %\"_ZN14Box$LT$u32$GT$9drop.118117h48c45852b94c565eE.exit\"\n\n\"_ZN14Box$LT$u32$GT$9drop.118117h48c45852b94c565eE.exit\": ; preds = %unwind_custom_, %cond.i\n  resume { i8*, i32 } %2\n}\n```\n\nNote that both landing pads have calls to `je_sdallocx` so we're double-freeing.\n\ncc @pnkfelix, @nrc \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/98843860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/108154859",
    "html_url": "https://github.com/rust-lang/rust/issues/25089#issuecomment-108154859",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25089",
    "id": 108154859,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwODE1NDg1OQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-03T01:39:29Z",
    "updated_at": "2015-06-03T01:39:29Z",
    "body": "triage: I-nominated \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/108154859/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/108157370",
    "html_url": "https://github.com/rust-lang/rust/issues/25089#issuecomment-108157370",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25089",
    "id": 108157370,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwODE1NzM3MA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-03T01:46:53Z",
    "updated_at": "2015-06-03T01:46:53Z",
    "body": "Test case (for a unit test):\n\n``` rust\nstruct Foo(i32);\n\nimpl Drop for Foo {\n    fn drop(&mut self) {\n        static mut DROPPED: bool = false;\n        unsafe {\n            assert!(!DROPPED);\n            DROPPED = true;\n        }\n    }\n}\n\nstruct Empty;\n\nfn empty() -> Empty { Empty }\n\nfn should_panic(_: Foo, _: Empty) {\n    panic!(\"test panic\");\n}\n\nfn main() {\n    should_panic(Foo(1), empty());\n}\n```\n\n```\n$ rustc foo.rs && ./foo\nthread '<main>' panicked at 'test panic', foo.rs:18\nthread '<main>' panicked at 'assertion failed: !DROPPED', foo.rs:7\nstack backtrace:\n   1:        0x10798ee45 - sys::backtrace::write::h6ede916059f8deceM9r\n   2:        0x1079920c7 - panicking::on_panic::ha49f13d0ffb0f10e2uw\n   3:        0x10798d448 - rt::unwind::begin_unwind_inner::hf0bdcaef6fa2453akdw\n   4:        0x10798bade - rt::unwind::begin_unwind::h13318957588857980774\n   5:        0x10798ba3e - Foo.Drop::drop::h2c1b207a3b565791kaa\n   6:        0x10798bf32 - Foo::drop.886::haa7535a0227f2840\n   7:        0x10798c02c - main::hdaf364a19f487aa9Dba\n   8:        0x107992f58 - rust_try_inner\n   9:        0x107992f45 - rust_try\n  10:        0x107992750 - rt::lang_start::h5cc5e69c1f0d126e6pw\n  11:        0x10798c08e - main\nthread panicked while panicking. aborting.\nzsh: illegal hardware instruction  ./foo\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/108157370/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/112855367",
    "html_url": "https://github.com/rust-lang/rust/issues/25089#issuecomment-112855367",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25089",
    "id": 112855367,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMjg1NTM2Nw==",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-06-17T15:43:41Z",
    "updated_at": "2015-06-17T15:43:41Z",
    "body": "triage: P-medium\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/112855367/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
