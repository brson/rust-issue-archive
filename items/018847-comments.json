[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62445749",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62445749",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62445749,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ1NzQ5",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T20:05:32Z",
    "updated_at": "2014-11-10T20:05:32Z",
    "body": "Note: I've only seen this behaviour on Mac, never on Linux.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62445749/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62448700",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62448700",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62448700,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ4NzAw",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-10T20:24:45Z",
    "updated_at": "2014-11-10T20:25:46Z",
    "body": "Here's an even better testcase that doesn't involve rust-http at all:\n\n``` rust\nuse std::io::{IoResult};\nuse std::io::net::get_host_addresses;\nuse std::io::net::ip::{SocketAddr, Ipv4Addr};\nuse std::io::net::tcp::TcpStream;\nuse std::task;\n\nstatic TARGET: &'static str = \"localhost\";\n\nfn url_to_socket_addr(host: &str) -> IoResult<SocketAddr> {\n    // Just grab the first IPv4 address\n    let addrs = try!(get_host_addresses(host));\n    let addr = addrs.into_iter().find(|&a| {\n        match a {\n            Ipv4Addr(..) => true,\n            _ => false\n        }\n    });\n\n    // TODO: Error handling\n    let addr = addr.unwrap();\n\n    let port = 8000;\n\n    Ok(SocketAddr {\n        ip: addr,\n        port: port\n    })\n}\n\nfn main() {\n    for _ in range(0u32, 10u32) {\n        task::spawn(proc() {\n            let addr = url_to_socket_addr(TARGET).unwrap();\n            let mut stream = TcpStream::connect(addr).unwrap();\n            (write!(stream, \"GET / HTTP/1.0\\r\\n\")).unwrap();\n            (write!(stream, \"\\r\\n\")).unwrap();\n            stream.flush().unwrap();\n\n            match stream.read_byte() {\n                Ok(_) => {\n                    stream.read_to_end().unwrap();\n                    println!(\"success!\");\n                }\n                Err(e) => println!(\"{}\", e.desc),\n            }\n        });\n    }\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62448700/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62494462",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62494462",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62494462,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDk0NDYy",
    "user": {
      "login": "zonyitoo",
      "id": 1067951,
      "node_id": "MDQ6VXNlcjEwNjc5NTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1067951?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zonyitoo",
      "html_url": "https://github.com/zonyitoo",
      "followers_url": "https://api.github.com/users/zonyitoo/followers",
      "following_url": "https://api.github.com/users/zonyitoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/zonyitoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zonyitoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zonyitoo/subscriptions",
      "organizations_url": "https://api.github.com/users/zonyitoo/orgs",
      "repos_url": "https://api.github.com/users/zonyitoo/repos",
      "events_url": "https://api.github.com/users/zonyitoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zonyitoo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T02:53:05Z",
    "updated_at": "2014-11-11T02:55:28Z",
    "body": "I have the same problem when I perform 300 TcpStream connections simultaneously to Memcached (Address is 127.0.0.1:11211).\n\nIt could be reproduced every time when I run my benchmark program.\n\nThis is my [test program](https://github.com/zonyitoo/memcached-rs/blob/master/benchmarks.rs)\n\nI tested it on my Laptop (Mac OS X 10.10.1, MacBook Pro with Retina Display Late 2013).\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62494462/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62495344",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62495344",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62495344,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDk1MzQ0",
    "user": {
      "login": "reem",
      "id": 4745181,
      "node_id": "MDQ6VXNlcjQ3NDUxODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4745181?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/reem",
      "html_url": "https://github.com/reem",
      "followers_url": "https://api.github.com/users/reem/followers",
      "following_url": "https://api.github.com/users/reem/following{/other_user}",
      "gists_url": "https://api.github.com/users/reem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/reem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/reem/subscriptions",
      "organizations_url": "https://api.github.com/users/reem/orgs",
      "repos_url": "https://api.github.com/users/reem/repos",
      "events_url": "https://api.github.com/users/reem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/reem/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T03:05:13Z",
    "updated_at": "2014-11-11T03:05:13Z",
    "body": "I have also encountered this error when working with tcp, also OS X 10.10.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62495344/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62501643",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62501643",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62501643,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTAxNjQz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T04:46:51Z",
    "updated_at": "2014-11-11T04:46:51Z",
    "body": "@jdm I cannot reproduce the error with this server program, do you have a standalone server error I can play around with? Also, was this a recent regression, or has this been happening for some time now?\n\n``` rust\nuse std::io::{TcpListener, Listener, Acceptor};\n\nfn main() {\n    let mut l = TcpListener::bind(\"127.0.0.1:8000\").unwrap().listen().unwrap();\n    for mut s in l.incoming() {\n        let _ = s.read_exact(18);\n        let _ = s.write([1]);\n    }\n}\n\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62501643/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62553122",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62553122",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62553122,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTUzMTIy",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T14:24:16Z",
    "updated_at": "2014-11-11T14:24:16Z",
    "body": "I've only tested this against the servers I specified in my original comment. I don't know if this is a recent regression; we only started getting enough information out of our test harness to diagnose this recently. FWIW, we see it using a 9/23 nightly.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62553122/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62629710",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62629710",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62629710,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjI5NzEw",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T21:59:41Z",
    "updated_at": "2014-11-11T21:59:41Z",
    "body": "I used `python -m SimpleHTTPServer` and `node node_modules/http-server/bin/http-server`. Nothing special.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62629710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62630494",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62630494",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62630494,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjMwNDk0",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-11T22:05:24Z",
    "updated_at": "2014-11-11T22:05:24Z",
    "body": "Thanks @jdm! I've reproduced locally and I hope to have time to investigate tonight.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62630494/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62656232",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62656232",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62656232,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjU2MjMy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T01:39:10Z",
    "updated_at": "2014-11-12T01:39:10Z",
    "body": "I think I would like to see a reproduction of this with some known server running that can be debugged easily. This current setup reproduces the problem seen here, and it should mirror basically what we're doing in Rust:\n\n``` c\n#include <sys/types.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <netdb.h>\n#include <stdio.h>\n#include <errno.h>\n#include <pthread.h>\n#include <assert.h>\n\n#define N 10\n\n#define CHECK(e) if (!(e)) {              \\\n    printf(\"%s failed: %d\\n\", #e, errno); \\\n    perror(\"failure\");                    \\\n    assert(0);                            \\\n  }\n\nvoid *child(void *foo) {\n  int s = socket(AF_INET, SOCK_STREAM, 0);\n  CHECK(s != -1);\n\n  struct sockaddr_in ip4addr;\n  ip4addr.sin_family = AF_INET;\n  ip4addr.sin_port = htons(8000);\n  inet_pton(AF_INET, \"127.0.0.1\", &ip4addr.sin_addr);\n  CHECK(connect(s, (struct sockaddr*) &ip4addr, sizeof(ip4addr)) == 0);\n\n  CHECK(write(s, \"GET / HTTP/1.0\\r\\n\", 16) == 16);\n  CHECK(write(s, \"\\r\\n\", 2) == 2);\n  char buf[1];\n  CHECK(read(s, buf, 1) == 1);\n  close(s);\n\n  return foo;\n}\n\nint main() {\n  pthread_t children[N];\n\n  int i;\n  for (i = 0; i < N; i++) {\n    CHECK(pthread_create(&children[i], NULL, child, NULL) == 0);\n  }\n  for (i = 0; i < N; i++) {\n    CHECK(pthread_join(children[i], NULL) == 0);\n  }\n}\n```\n\n```\n$ python -m SimpleHTTPServer\n// move to another shell\n$ gcc foo.c && ./a.out\nread(s, buf, 1) == 1 failed: 54\nfailure: Connection reset by peer\nAssertion failed: (0), function child, file foo.c, line 34.\nzsh: abort      ./a.out\n```\n\nFor all I know this could be just as much of a bug on python's side as it is on our side. Without being able to look closely at what's going on in python though, I can't tell. \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62656232/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62662168",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62662168",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62662168,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjYyMTY4",
    "user": {
      "login": "Manishearth",
      "id": 1617736,
      "node_id": "MDQ6VXNlcjE2MTc3MzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Manishearth",
      "html_url": "https://github.com/Manishearth",
      "followers_url": "https://api.github.com/users/Manishearth/followers",
      "following_url": "https://api.github.com/users/Manishearth/following{/other_user}",
      "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions",
      "organizations_url": "https://api.github.com/users/Manishearth/orgs",
      "repos_url": "https://api.github.com/users/Manishearth/repos",
      "events_url": "https://api.github.com/users/Manishearth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Manishearth/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T02:59:04Z",
    "updated_at": "2014-11-12T02:59:04Z",
    "body": "It's an error when serving via node as well, so it seems more likely that we're messing up somewhere.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62662168/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62663596",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62663596",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62663596,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjYzNTk2",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T03:17:36Z",
    "updated_at": "2014-11-12T03:17:36Z",
    "body": "As an additional data point, the same server and tests are being run in Firefox without this issue making an appearance.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62663596/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62667822",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62667822",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62667822,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjY3ODIy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T04:13:02Z",
    "updated_at": "2014-11-12T04:13:02Z",
    "body": "@jdm @Manishearth I'm sorry but I don't have time to dig very far into the internals of python's or node's server implementations. \n\nThe C program I pasted above is super small and should be pretty easy to debug, and it's basically a pretty close translation of what we're doing in the standard library (with lots of error handling removed). The fact that I could write a small Rust server which doesn't reproduce the error makes me very suspicious about what we can do on our end to remedy this. I'd of course love to find a fix that we could apply though!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62667822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62668594",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62668594",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62668594,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjY4NTk0",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T04:26:45Z",
    "updated_at": "2014-11-12T04:28:46Z",
    "body": "@alexcrichton: Interestingly enough, when I run the Rust server you pasted previously and bump N up to 150 in your C program, I also see the same output you get against the Python server.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62668594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62669015",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62669015",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62669015,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjY5MDE1",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T04:34:32Z",
    "updated_at": "2014-11-12T04:34:32Z",
    "body": "I also see connection reset errors when running my Rust test against your server with range(0, 300).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62669015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62670180",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62670180",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62670180,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjcwMTgw",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T04:55:00Z",
    "updated_at": "2014-11-12T04:55:00Z",
    "body": "Ok, thanks for that info @jdm! I've managed to create a greatly reduced server:\n\n``` c\n#include <sys/types.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <netdb.h>\n#include <stdio.h>\n#include <errno.h>\n#include <pthread.h>\n#include <assert.h>\n\n#define N 200\n\n#define CHECK(e) if (!(e)) {              \\\n    printf(\"%s failed: %d\\n\", #e, errno); \\\n    perror(\"failure\");                    \\\n    assert(0);                            \\\n  }\n\nint main() {\n  int s = socket(AF_INET, SOCK_STREAM, 0);\n  CHECK(s != -1);\n  int opt = 1;\n  CHECK(setsockopt(s, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt)) == 0);\n\n  struct sockaddr_in ip4addr;\n  ip4addr.sin_family = AF_INET;\n  ip4addr.sin_port = htons(8000);\n  inet_pton(AF_INET, \"127.0.0.1\", &ip4addr.sin_addr);\n  CHECK(bind(s, (struct sockaddr*) &ip4addr, sizeof(ip4addr)) == 0);\n  CHECK(listen(s, 1) == 0);\n\n  while (1) {\n    int c = accept(s, NULL, NULL);\n    CHECK(c != -1);\n    char buf[1];\n    switch (read(c, buf, 1)) {\n      case 0: printf(\"eof\\n\"); break;\n      case 1: break;\n      default: printf(\"read error\\n\"); break;\n    }\n    CHECK(write(c, \"a\", 1) == 1);\n    close(c);\n  }\n}\n```\n\nThe key part of this server is the parameter to `listen`, which in this case is 1. I can get the ECONNREFUSED error with a value of N=2 for the client C program I listed above. Checking the manpage of `listen` we see:\n\n```\nSYNOPSIS\n     #include <sys/socket.h>\n\n     int\n     listen(int socket, int backlog);\n\nDESCRIPTION\n     Creation of socket-based connections requires several operations.\n     First, a socket is created with socket(2).  Next, a willingness to\n     accept incoming connections and a queue limit for incoming connections\n     are specified with listen().  Finally, the connections are accepted\n     with accept(2).  The listen() call applies only to sockets of type\n     SOCK_STREAM or SOCK_SEQPACKET.\n\n     The backlog parameter defines the maximum length for the queue of pend-\n     ing connections.  If a connection request arrives with the queue full,\n     the client may receive an error with an indication of ECONNREFUSED.\n     Alternatively, if the underlying protocol supports retransmission, the\n     request may be ignored so that retries may succeed.\n```\n\nI think this is basically a \"welp, that's TCP\" time of day. It sounds like you need to bump the server's backlog parameter or lower the number of concurrent connections you're making.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62670180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62672581",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62672581",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62672581,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjcyNTgx",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T05:32:48Z",
    "updated_at": "2014-11-12T05:32:48Z",
    "body": "The backlog helps cope with spikes in latency but you need to be handling the connections as quickly as they're coming or the same situation will occur. If the connections are very short then the dispatcher thread should really be handing them off via a bounded queue without making any system calls. The rest is just about server performance... it could just be that the servers are too slow to keep up.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62672581/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62672724",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62672724",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62672724,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjcyNzI0",
    "user": {
      "login": "jdm",
      "id": 27658,
      "node_id": "MDQ6VXNlcjI3NjU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdm",
      "html_url": "https://github.com/jdm",
      "followers_url": "https://api.github.com/users/jdm/followers",
      "following_url": "https://api.github.com/users/jdm/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdm/subscriptions",
      "organizations_url": "https://api.github.com/users/jdm/orgs",
      "repos_url": "https://api.github.com/users/jdm/repos",
      "events_url": "https://api.github.com/users/jdm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdm/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T05:34:58Z",
    "updated_at": "2014-11-12T05:34:58Z",
    "body": "Setting the python server's request_queue_size parameter did fix the problem we're seeing in our tests. Thanks!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62672724/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62672905",
    "html_url": "https://github.com/rust-lang/rust/issues/18847#issuecomment-62672905",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18847",
    "id": 62672905,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjcyOTA1",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-12T05:38:08Z",
    "updated_at": "2014-11-12T05:38:08Z",
    "body": "Glad to hear! I'm going to close this as working-as-intended in that case.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62672905/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
