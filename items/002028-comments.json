[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4831854",
    "html_url": "https://github.com/rust-lang/rust/issues/2028#issuecomment-4831854",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2028",
    "id": 4831854,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MzE4NTQ=",
    "user": {
      "login": "jamorton",
      "id": 18852,
      "node_id": "MDQ6VXNlcjE4ODUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/18852?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamorton",
      "html_url": "https://github.com/jamorton",
      "followers_url": "https://api.github.com/users/jamorton/followers",
      "following_url": "https://api.github.com/users/jamorton/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamorton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamorton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamorton/subscriptions",
      "organizations_url": "https://api.github.com/users/jamorton/orgs",
      "repos_url": "https://api.github.com/users/jamorton/repos",
      "events_url": "https://api.github.com/users/jamorton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamorton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-03-29T21:40:19Z",
    "updated_at": "2012-03-29T21:40:19Z",
    "body": "If such a queue was implemented would it be acceptable to not use random indices to schedule tasks?\n\nMore generally, I'm wondering why tasks are put in random threads and tasks are selected randomly. What's wrong with a simple round robin?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4831854/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4832834",
    "html_url": "https://github.com/rust-lang/rust/issues/2028#issuecomment-4832834",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2028",
    "id": 4832834,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MzI4MzQ=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-03-29T22:36:09Z",
    "updated_at": "2012-03-29T22:36:09Z",
    "body": "Yes, part of the goal of switching to the queue is to get rid of the random number generator. I want to switch to round robin thread selection and the queue for task selection (which is effectively round robin).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4832834/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4832856",
    "html_url": "https://github.com/rust-lang/rust/issues/2028#issuecomment-4832856",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2028",
    "id": 4832856,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MzI4NTY=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-03-29T22:37:12Z",
    "updated_at": "2012-03-29T22:37:12Z",
    "body": "Switching to round robin for thread selection is a trivial change that would be easy to do right now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4832856/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4890141",
    "html_url": "https://github.com/rust-lang/rust/issues/2028#issuecomment-4890141",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2028",
    "id": 4890141,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTAxNDE=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-04-02T22:14:35Z",
    "updated_at": "2012-04-02T22:14:35Z",
    "body": "@graydon suggested on IRC that using a queue could result in some deadlock situations when contending for external resources like file handles and that enforcing some nondeterminism is necessary.\n\nIf we had timeslice accounting and enough preemption points then we would presumably use a priority queue based on which tasks deserve more time, and that would also avoid the problem solved by the rng.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4890141/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4891321",
    "html_url": "https://github.com/rust-lang/rust/issues/2028#issuecomment-4891321",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2028",
    "id": 4891321,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTEzMjE=",
    "user": {
      "login": "jamorton",
      "id": 18852,
      "node_id": "MDQ6VXNlcjE4ODUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/18852?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamorton",
      "html_url": "https://github.com/jamorton",
      "followers_url": "https://api.github.com/users/jamorton/followers",
      "following_url": "https://api.github.com/users/jamorton/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamorton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamorton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamorton/subscriptions",
      "organizations_url": "https://api.github.com/users/jamorton/orgs",
      "repos_url": "https://api.github.com/users/jamorton/repos",
      "events_url": "https://api.github.com/users/jamorton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamorton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-04-02T23:37:49Z",
    "updated_at": "2012-04-02T23:37:49Z",
    "body": "I'm just going to start working on a time slice pqueue branch and see how it turns out\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4891321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4891410",
    "html_url": "https://github.com/rust-lang/rust/issues/2028#issuecomment-4891410",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2028",
    "id": 4891410,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTE0MTA=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-04-02T23:44:53Z",
    "updated_at": "2012-04-02T23:44:53Z",
    "body": "Just so you know, the compiler doesn't generate any preemption points yet, so the only time that tasks yield is when they explicitly call `yield`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4891410/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4891476",
    "html_url": "https://github.com/rust-lang/rust/issues/2028#issuecomment-4891476",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2028",
    "id": 4891476,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTE0NzY=",
    "user": {
      "login": "jamorton",
      "id": 18852,
      "node_id": "MDQ6VXNlcjE4ODUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/18852?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamorton",
      "html_url": "https://github.com/jamorton",
      "followers_url": "https://api.github.com/users/jamorton/followers",
      "following_url": "https://api.github.com/users/jamorton/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamorton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamorton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamorton/subscriptions",
      "organizations_url": "https://api.github.com/users/jamorton/orgs",
      "repos_url": "https://api.github.com/users/jamorton/repos",
      "events_url": "https://api.github.com/users/jamorton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamorton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-04-02T23:48:14Z",
    "updated_at": "2012-04-02T23:48:14Z",
    "body": "oh, well then, maybe not yet.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4891476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4892067",
    "html_url": "https://github.com/rust-lang/rust/issues/2028#issuecomment-4892067",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2028",
    "id": 4892067,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTIwNjc=",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-04-03T00:34:14Z",
    "updated_at": "2012-04-03T00:34:14Z",
    "body": "I talked about this more with some colleagues here and did a bit more background reading, and I'm still most comfortable with the existing PRNG-vector scheme. Reasons are as follows:\n- Basic efficiency: swap-to-end-and-decrement is just fast, but vector is memory-dense, no extra pointers.\n- I think lockless version will work ok if we go there; CAS on a randomly-chosen cell with \"try again\" when the cell is null. Take a lock only if the vector needs resizing or is at a lifecycle event (scheduler shutdown say).\n- Randomizing schedule means preserving -- in fact, _promoting_ -- the illusion of uniform pseudo-parallelism that's the default assumption when writing concurrent software. That is, a user's only safe bet about the schedule they get from an OS thread scheduler is \"random\" (as threads might run truly-concurrently, or be time-sliced under unpredictable policy), so if we pick a particular deterministic schedule, we're undermining that assumption, which can have at least two unwanted effects:\n  - We might hide races in user code. So code that \"breaks\" on threads might \"work\" on tasks (by appearing race-free when it's not).\n  - We might change analytic assumptions in user code such as average-vs-worst-case complexity or eventual-success on intentionally racey code. These assumptions might not be \"right\" in the sense that a fixed schedule is _legal_ behavior from a thread scheduler, but it's very improbable; such assumptions are safe to make about threads. So code that \"works\" on threads might \"break\" on tasks (by degrading to worst-case or livelocking or such).\n\nBasically I want our scheduler to behave -- to outside observers with no reason to believe otherwise -- as much like \"running in 1:1 mode\" as possible. I want users to face no concurrency \"surprises\" when changing between 1:1 and M:N modes. Our scheduler is only there to compensate for the fact that running 100,000 threads is too expensive on OSX or windows. If a user really wants a more interesting schedule, they should have to request it: make a separate scheduler, inject some set of threads into it, and ask the OS to run those threads in a particular scheduling model. The OS can provide much finer-grained, faster and more-robust scheduling than we can.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/4892067/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/5771325",
    "html_url": "https://github.com/rust-lang/rust/issues/2028#issuecomment-5771325",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/2028",
    "id": 5771325,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NzEzMjU=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-05-17T18:55:49Z",
    "updated_at": "2012-05-17T18:55:49Z",
    "body": "We're not doing this. Closing.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/5771325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
