{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/25860",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/25860/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/25860/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/25860/events",
  "html_url": "https://github.com/rust-lang/rust/issues/25860",
  "id": 82044592,
  "node_id": "MDU6SXNzdWU4MjA0NDU5Mg==",
  "number": 25860,
  "title": "Implied bounds on nested references + variance = soundness hole",
  "user": {
    "login": "aturon",
    "id": 709807,
    "node_id": "MDQ6VXNlcjcwOTgwNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aturon",
    "html_url": "https://github.com/aturon",
    "followers_url": "https://api.github.com/users/aturon/followers",
    "following_url": "https://api.github.com/users/aturon/following{/other_user}",
    "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
    "organizations_url": "https://api.github.com/users/aturon/orgs",
    "repos_url": "https://api.github.com/users/aturon/repos",
    "events_url": "https://api.github.com/users/aturon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aturon/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 37544,
      "node_id": "MDU6TGFiZWwzNzU0NA==",
      "url": "https://api.github.com/repos/rust-lang/rust/labels/A-type-system",
      "name": "A-type-system",
      "color": "f7e101",
      "default": false,
      "description": "Area: Type system"
    },
    {
      "id": 60344715,
      "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==",
      "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium",
      "name": "P-medium",
      "color": "eb6420",
      "default": false,
      "description": "Medium priority"
    },
    {
      "id": 267612997,
      "node_id": "MDU6TGFiZWwyNjc2MTI5OTc=",
      "url": "https://api.github.com/repos/rust-lang/rust/labels/I-unsound",
      "name": "I-unsound",
      "color": "e11d21",
      "default": false,
      "description": "Issue: A soundness hole (worst kind of bug), see: https://en.wikipedia.org/wiki/Soundness"
    },
    {
      "id": 650731663,
      "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=",
      "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug",
      "name": "C-bug",
      "color": "f5f1fd",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 3675472455,
      "node_id": "LA_kwDOAAsO6M7bE0JH",
      "url": "https://api.github.com/repos/rust-lang/rust/labels/A-variance",
      "name": "A-variance",
      "color": "f7e101",
      "default": false,
      "description": "Area: Variance (https://doc.rust-lang.org/nomicon/subtyping.html)"
    },
    {
      "id": 3921861239,
      "node_id": "LA_kwDOAAsO6M7pwtp3",
      "url": "https://api.github.com/repos/rust-lang/rust/labels/S-bug-has-test",
      "name": "S-bug-has-test",
      "color": "862eff",
      "default": false,
      "description": "Status: This bug is tracked inside the repo by a `known-bug` test."
    },
    {
      "id": 4172483496,
      "node_id": "LA_kwDOAAsO6M74swuo",
      "url": "https://api.github.com/repos/rust-lang/rust/labels/T-types",
      "name": "T-types",
      "color": "bfd4f2",
      "default": false,
      "description": "Relevant to the types team, which will review and decide on the PR/issue."
    }
  ],
  "state": "open",
  "locked": true,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 56,
  "created_at": "2015-05-28T17:37:18Z",
  "updated_at": "2025-09-22T05:41:46Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "The combination of variance and implied bounds for nested references opens a hole in the current type system:\n\n``` rust\nstatic UNIT: &'static &'static () = &&();\n\nfn foo<'a, 'b, T>(_: &'a &'b (), v: &'b T) -> &'a T { v }\n\nfn bad<'a, T>(x: &'a T) -> &'static T {\n    let f: fn(&'static &'a (), &'a T) -> &'static T = foo;\n    f(UNIT, x)\n}\n```\n\nThis hole has been fixed in #129021 for non-higher-ranked function pointers. The underlying issue still persists.\n```rust\nstatic UNIT: &'static &'static () = &&();\n\nfn foo<'a, 'b, T>(_: &'a &'b (), v: &'b T, _: &()) -> &'a T { v }\n\nfn bad<'a, T>(x: &'a T) -> &'static T {\n    let f: fn(_, &'a T, &()) -> &'static T = foo;\n    f(UNIT, x, &())\n}\n\nfn main() {}\n```\n\n---\n\nUpdate from @pnkfelix : \n\nWhile the test as written above is rejected by Rust today (with the error message for line 6 saying \"in type `&'static &'a ()`, reference has a longer lifetime than the data it references\"), that is just an artifact of the original source code (with its explicit type signature) running up against _one_ new WF-check.\n\nThe fundamental issue persists, since one can today write instead:\n\n``` rust\nstatic UNIT: &'static &'static () = &&();\n\nfn foo<'a, 'b, T>(_: &'a &'b (), v: &'b T) -> &'a T { v }\n\nfn bad<'a, T>(x: &'a T) -> &'static T {\n    let f: fn(_, &'a T) -> &'static T = foo;\n    f(UNIT, x)\n}\n```\n\n(and this way, still get the bad behaving `fn bad`, by just side-stepping one of the explicit type declarations.)\n\n---\n\nUpdate from @lcnr :\n\nWhile the test as written above is rejected by Rust today, that is just an artifact of the original source code (with its lack of higher ranked regions) running up against _one_ new WF-check \u2728 \n\nThe fundamental issue persists, since one can today write instead:\n\n```rust\nstatic UNIT: &'static &'static () = &&();\n\nfn foo<'a, 'b, T>(_: &'a &'b (), v: &'b T, _: &()) -> &'a T { v }\n\nfn bad<'a, T>(x: &'a T) -> &'static T {\n    let f: fn(_, &'a T, &()) -> &'static T = foo;\n    //                  ^ note the additional higher-ranked region here\n    f(UNIT, x, &())\n}\n```\n\nAll the non-higher ranked variants of this issue have been fixed by #129021. ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/25860/reactions",
    "total_count": 156,
    "+1": 59,
    "-1": 0,
    "laugh": 7,
    "hooray": 0,
    "confused": 56,
    "heart": 0,
    "rocket": 0,
    "eyes": 34
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/25860/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "issue"
  }
}
