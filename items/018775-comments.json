[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62284760",
    "html_url": "https://github.com/rust-lang/rust/issues/18775#issuecomment-62284760",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18775",
    "id": 62284760,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjg0NzYw",
    "user": {
      "login": "yuriks",
      "id": 341401,
      "node_id": "MDQ6VXNlcjM0MTQwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/341401?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yuriks",
      "html_url": "https://github.com/yuriks",
      "followers_url": "https://api.github.com/users/yuriks/followers",
      "following_url": "https://api.github.com/users/yuriks/following{/other_user}",
      "gists_url": "https://api.github.com/users/yuriks/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yuriks/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yuriks/subscriptions",
      "organizations_url": "https://api.github.com/users/yuriks/orgs",
      "repos_url": "https://api.github.com/users/yuriks/repos",
      "events_url": "https://api.github.com/users/yuriks/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yuriks/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-09T00:21:24Z",
    "updated_at": "2014-11-09T00:22:04Z",
    "body": "I also hit what I believe to be the same issue. The following code: (http://is.gd/Z0B3a3)\n\n``` rust\n#![feature(macro_rules)]\n\nstruct Foo { x: u32, y: u32 }\n\nmacro_rules! make_copy(\n    ($Self:ident { $($field:ident),+ }) => (\n        fn copy(&self) -> $Self {\n            //let me = self;\n            $Self {\n                $($field: self.$field),+\n            }\n        }\n    )\n)\n\nimpl Foo {\n    make_copy!(Foo {x, y})\n}\n\nfn main() {\n    let x = Foo { x: 0, y: 2 };\n    let _y = x.copy();\n}\n```\n\nGives this error:\n\n```\ntest.rs:10:27: 10:31 error: expected identifier, found keyword `self`\ntest.rs:10                 $($field: self.$field),+\n```\n\nEnabling the commented out line and changing `self` to `me` in the expansion makes it build correctly. This also broke after upgrading to the current nightly from one from about two days ago.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62284760/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63075127",
    "html_url": "https://github.com/rust-lang/rust/issues/18775#issuecomment-63075127",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18775",
    "id": 63075127,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMDc1MTI3",
    "user": {
      "login": "hannobraun",
      "id": 85732,
      "node_id": "MDQ6VXNlcjg1NzMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85732?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hannobraun",
      "html_url": "https://github.com/hannobraun",
      "followers_url": "https://api.github.com/users/hannobraun/followers",
      "following_url": "https://api.github.com/users/hannobraun/following{/other_user}",
      "gists_url": "https://api.github.com/users/hannobraun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hannobraun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hannobraun/subscriptions",
      "organizations_url": "https://api.github.com/users/hannobraun/orgs",
      "repos_url": "https://api.github.com/users/hannobraun/repos",
      "events_url": "https://api.github.com/users/hannobraun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hannobraun/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-14T14:56:11Z",
    "updated_at": "2014-11-14T14:56:11Z",
    "body": "Please reopen this issue. The original error still occurs on current master.\n\nError:\n\n```\n/home/hanno/Projects/rustecs/rustecs_macros/src/generate/intermediate.rs:73:15: 73:19 error: expected identifier, found keyword `self`\n/home/hanno/Projects/rustecs/rustecs_macros/src/generate/intermediate.rs:73             $var_name: self.$collection.pop(id),\n                                                                                                   ^~~~\nerror: aborting due to previous error\n```\n\nRust version:\n\n```\ns$ rustc --version=verbose\nrustc 0.13.0-dev (6f7081fad 2014-11-14 05:37:17 +0000)\nbinary: rustc\ncommit-hash: 6f7081fad5889c7b41460103fc8abc98f3285c60\ncommit-date: 2014-11-14 05:37:17 +0000\nhost: x86_64-unknown-linux-gnu\nrelease: 0.13.0-dev\n```\n\n@yuriks Is your code working now?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63075127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63135793",
    "html_url": "https://github.com/rust-lang/rust/issues/18775#issuecomment-63135793",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18775",
    "id": 63135793,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMTM1Nzkz",
    "user": {
      "login": "yuriks",
      "id": 341401,
      "node_id": "MDQ6VXNlcjM0MTQwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/341401?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yuriks",
      "html_url": "https://github.com/yuriks",
      "followers_url": "https://api.github.com/users/yuriks/followers",
      "following_url": "https://api.github.com/users/yuriks/following{/other_user}",
      "gists_url": "https://api.github.com/users/yuriks/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yuriks/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yuriks/subscriptions",
      "organizations_url": "https://api.github.com/users/yuriks/orgs",
      "repos_url": "https://api.github.com/users/yuriks/repos",
      "events_url": "https://api.github.com/users/yuriks/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yuriks/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-14T21:59:29Z",
    "updated_at": "2014-11-14T21:59:29Z",
    "body": "@hannobraun The test case I gave now works, but my original program, when changed back to not use the workaround, still doesn't. I'm going to have to create a new testcase. `rustc 0.13.0-nightly (5745e4195 2014-11-12 22:57:16 +0000)`\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63135793/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63598774",
    "html_url": "https://github.com/rust-lang/rust/issues/18775#issuecomment-63598774",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18775",
    "id": 63598774,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNTk4Nzc0",
    "user": {
      "login": "jakerr",
      "id": 322861,
      "node_id": "MDQ6VXNlcjMyMjg2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/322861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakerr",
      "html_url": "https://github.com/jakerr",
      "followers_url": "https://api.github.com/users/jakerr/followers",
      "following_url": "https://api.github.com/users/jakerr/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakerr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakerr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakerr/subscriptions",
      "organizations_url": "https://api.github.com/users/jakerr/orgs",
      "repos_url": "https://api.github.com/users/jakerr/repos",
      "events_url": "https://api.github.com/users/jakerr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakerr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-19T06:39:17Z",
    "updated_at": "2014-11-19T06:39:17Z",
    "body": "A complete working reproduction of this regression is below:\n\n``` rust\n#![feature(quote)]\n\nextern crate syntax;\n\nuse syntax::print::pprust;\nuse syntax::codemap::DUMMY_SP;\nuse syntax::ast;\nuse syntax::ext::base::ExtCtxt;\nuse syntax::parse::token;\n\n#[allow(unused_imports)]\nfn main() {\n    let var_name = ast::Ident::new(\n            token::intern(\"my_var\")\n    );\n    let collection = ast::Ident::new(\n            token::intern(\"my_collection\")\n    );\n    with_fake_extctxt(|cx| {\n        let field_set = quote_tokens!(cx,\n            $var_name: self.$collection.pop(id),\n        );\n        println!(\"{}\", pprust::tts_to_string(field_set.deref()));\n    });\n}\n\nfn with_fake_extctxt<T>(f: |&syntax::ext::base::ExtCtxt| -> T) -> T {\n    let ps = syntax::parse::new_parse_sess();\n\n    let mut cx = syntax::ext::base::ExtCtxt::new(&ps, Vec::new(), syntax::ext::expand::ExpansionConfig {\n        deriving_hash_type_parameter: false,\n        crate_name: from_str(\"test\").unwrap(),\n        enable_quotes: true,\n        recursion_limit: 100\n    });\n\n    cx.bt_push(syntax::codemap::ExpnInfo{\n        call_site: DUMMY_SP,\n        callee: syntax::codemap::NameAndSpan {\n            name: \"test\".to_string(),\n            format: syntax::codemap::MacroBang,\n            span: None,\n        }\n    });\n\n    f(&cx)\n}\n```\n\nThis currently works on http://play.rust-lang.org/ probably because the rustc version there is behind. It reproduces this bug in `rustc 0.13.0-nightly (336349c93 2014-11-17 20:37:19 +0000)`\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63598774/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63638487",
    "html_url": "https://github.com/rust-lang/rust/issues/18775#issuecomment-63638487",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18775",
    "id": 63638487,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNjM4NDg3",
    "user": {
      "login": "hannobraun",
      "id": 85732,
      "node_id": "MDQ6VXNlcjg1NzMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85732?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hannobraun",
      "html_url": "https://github.com/hannobraun",
      "followers_url": "https://api.github.com/users/hannobraun/followers",
      "following_url": "https://api.github.com/users/hannobraun/following{/other_user}",
      "gists_url": "https://api.github.com/users/hannobraun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hannobraun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hannobraun/subscriptions",
      "organizations_url": "https://api.github.com/users/hannobraun/orgs",
      "repos_url": "https://api.github.com/users/hannobraun/repos",
      "events_url": "https://api.github.com/users/hannobraun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hannobraun/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-19T13:23:06Z",
    "updated_at": "2014-11-19T13:23:06Z",
    "body": "Thanks, @jakerr, for taking care of this. I meant to re-check and update my reduced example but didn't get to it so far. Things have been a bit crazy those last few weeks \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63638487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63693438",
    "html_url": "https://github.com/rust-lang/rust/issues/18775#issuecomment-63693438",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18775",
    "id": 63693438,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNjkzNDM4",
    "user": {
      "login": "jakerr",
      "id": 322861,
      "node_id": "MDQ6VXNlcjMyMjg2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/322861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakerr",
      "html_url": "https://github.com/jakerr",
      "followers_url": "https://api.github.com/users/jakerr/followers",
      "following_url": "https://api.github.com/users/jakerr/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakerr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakerr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakerr/subscriptions",
      "organizations_url": "https://api.github.com/users/jakerr/orgs",
      "repos_url": "https://api.github.com/users/jakerr/repos",
      "events_url": "https://api.github.com/users/jakerr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakerr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-19T18:59:39Z",
    "updated_at": "2014-11-19T18:59:39Z",
    "body": "@hannobraun no worries!\n\nI got as far as finding what is wrong, but not as far as figuring out how to fix it.\n\nIn [parser.rs L2664-L2677](https://github.com/rust-lang/rust/blob/e09d98603e608c9e47d4c89f7b4dca87a4b56da3/src/libsyntax/parse/parser.rs#L2664-L2677)\n\n``` rust\n...\n                } else {\n                    // A nonterminal that matches or not\n                    let namep = match p.token { token::Ident(_, p) => p, _ => token::Plain };\n                    let name = p.parse_ident();\n                    if p.token == token::Colon && p.look_ahead(1, |t| t.is_ident()) {\n                        p.bump();\n                        let kindp = match p.token { token::Ident(_, p) => p, _ => token::Plain };\n                        let nt_kind = p.parse_ident();\n                        let m = TtToken(sp, MatchNt(name, nt_kind, namep, kindp));\n                        m\n                    } else {\n                        TtToken(sp, SubstNt(name, namep))\n                    }\n                }\n```\n\nThere's code that looks for `$` `:` `ident` and then decides that it is a `MatchNt` while this is ambiguous because it may be a `SubstNt` `:` `ident`. I thought maybe the parser should notice that it is currently parsing an invocation of `macro_rules` and only look for `MatchNt` in that case but not sure if that's the cleanest solution.\n\nI think I'll leave it to the experts. @pczarn do you mind taking a look?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63693438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63695744",
    "html_url": "https://github.com/rust-lang/rust/issues/18775#issuecomment-63695744",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18775",
    "id": 63695744,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNjk1NzQ0",
    "user": {
      "login": "pczarn",
      "id": 3356767,
      "node_id": "MDQ6VXNlcjMzNTY3Njc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3356767?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pczarn",
      "html_url": "https://github.com/pczarn",
      "followers_url": "https://api.github.com/users/pczarn/followers",
      "following_url": "https://api.github.com/users/pczarn/following{/other_user}",
      "gists_url": "https://api.github.com/users/pczarn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pczarn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pczarn/subscriptions",
      "organizations_url": "https://api.github.com/users/pczarn/orgs",
      "repos_url": "https://api.github.com/users/pczarn/repos",
      "events_url": "https://api.github.com/users/pczarn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pczarn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-19T19:14:33Z",
    "updated_at": "2014-11-19T19:16:06Z",
    "body": "The error appears when this code is looking ahead after a colon and finds an ident, but that ident is also a keyword. A solution could use `check_strict_keywords` and `check_reserved_keywords`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63695744/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63746820",
    "html_url": "https://github.com/rust-lang/rust/issues/18775#issuecomment-63746820",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18775",
    "id": 63746820,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNzQ2ODIw",
    "user": {
      "login": "jakerr",
      "id": 322861,
      "node_id": "MDQ6VXNlcjMyMjg2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/322861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakerr",
      "html_url": "https://github.com/jakerr",
      "followers_url": "https://api.github.com/users/jakerr/followers",
      "following_url": "https://api.github.com/users/jakerr/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakerr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakerr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakerr/subscriptions",
      "organizations_url": "https://api.github.com/users/jakerr/orgs",
      "repos_url": "https://api.github.com/users/jakerr/repos",
      "events_url": "https://api.github.com/users/jakerr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakerr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-20T01:27:55Z",
    "updated_at": "2014-11-20T01:27:55Z",
    "body": "True, but if you only eliminate the error for keywords you will get errors when trying to treat the ident after the colon as a matcher kind later right?\n\nFor example\n\n``` rust\nquote_tokens!($foo: bar.baz)\n```\n\nWould tokenize to MatchNt with name foo and kind bar which would eventually lead to a parse error in macro_parser.rs \n\n```\np.fatal(format!(\"unsupported builtin nonterminal parser: {}\",  name).as_slice())\n```\n\nIsn't it?\n\nSorry for lack of good links, I'm mobile.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63746820/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63855882",
    "html_url": "https://github.com/rust-lang/rust/issues/18775#issuecomment-63855882",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18775",
    "id": 63855882,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzODU1ODgy",
    "user": {
      "login": "pczarn",
      "id": 3356767,
      "node_id": "MDQ6VXNlcjMzNTY3Njc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3356767?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pczarn",
      "html_url": "https://github.com/pczarn",
      "followers_url": "https://api.github.com/users/pczarn/followers",
      "following_url": "https://api.github.com/users/pczarn/following{/other_user}",
      "gists_url": "https://api.github.com/users/pczarn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pczarn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pczarn/subscriptions",
      "organizations_url": "https://api.github.com/users/pczarn/orgs",
      "repos_url": "https://api.github.com/users/pczarn/repos",
      "events_url": "https://api.github.com/users/pczarn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pczarn/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-20T18:31:55Z",
    "updated_at": "2014-11-20T18:38:29Z",
    "body": "That'd be good intuition, but the code in `macro_parser.rs` only applies to the macro_rules extension, not syntax extensions such as `quote_tokens!` from `quote.rs`. Sorry, I've completely missed the point of this issue last time. True, it will tokenize to MatchNt, and it would have had surprising behavior in `quote_tokens!` which I've fixed.\n\nIt seems I'll have to add `quote_matcher!` without interpolation in quoted MatchNt.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63855882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
