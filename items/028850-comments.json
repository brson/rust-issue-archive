[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145663520",
    "html_url": "https://github.com/rust-lang/rust/issues/28850#issuecomment-145663520",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28850",
    "id": 145663520,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NTY2MzUyMA==",
    "user": {
      "login": "eefriedman",
      "id": 12769964,
      "node_id": "MDQ6VXNlcjEyNzY5OTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/12769964?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eefriedman",
      "html_url": "https://github.com/eefriedman",
      "followers_url": "https://api.github.com/users/eefriedman/followers",
      "following_url": "https://api.github.com/users/eefriedman/following{/other_user}",
      "gists_url": "https://api.github.com/users/eefriedman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eefriedman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eefriedman/subscriptions",
      "organizations_url": "https://api.github.com/users/eefriedman/orgs",
      "repos_url": "https://api.github.com/users/eefriedman/repos",
      "events_url": "https://api.github.com/users/eefriedman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eefriedman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-05T20:46:28Z",
    "updated_at": "2015-10-05T20:46:28Z",
    "body": "You're building a dylib and an exe, and statically linking libstd into both?  rustc should definitely print an error message if you try to build an executable in that configuration.  It's not just a matter of the allocator; libstd has other internal state that would be duplicated.\n\nWhy are you trying to do this?  If you're distributing dynamic libraries anyway, why not just include libstd.dylib in your distribution?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145663520/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145665548",
    "html_url": "https://github.com/rust-lang/rust/issues/28850#issuecomment-145665548",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28850",
    "id": 145665548,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NTY2NTU0OA==",
    "user": {
      "login": "tsurai",
      "id": 1909506,
      "node_id": "MDQ6VXNlcjE5MDk1MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1909506?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tsurai",
      "html_url": "https://github.com/tsurai",
      "followers_url": "https://api.github.com/users/tsurai/followers",
      "following_url": "https://api.github.com/users/tsurai/following{/other_user}",
      "gists_url": "https://api.github.com/users/tsurai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tsurai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tsurai/subscriptions",
      "organizations_url": "https://api.github.com/users/tsurai/orgs",
      "repos_url": "https://api.github.com/users/tsurai/repos",
      "events_url": "https://api.github.com/users/tsurai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tsurai/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-05T20:54:05Z",
    "updated_at": "2015-10-05T20:54:05Z",
    "body": "I uploaded a [minimal test case](https://gist.github.com/tsurai/2fb960f599cdfe45217e) to illustrate my problem. The program will seg fault when trying to drop the string in the dylib function.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145665548/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145908471",
    "html_url": "https://github.com/rust-lang/rust/issues/28850#issuecomment-145908471",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28850",
    "id": 145908471,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NTkwODQ3MQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-06T15:55:25Z",
    "updated_at": "2015-10-06T15:55:25Z",
    "body": "As @eefriedman mentioned, this is unfortunately just the classical \"don't statically link a library twice\" problem going on here. Statically linking the standard library to two artifacts and then loading them at runtime tends to always cause weird problems like this. In general this is where having resource ownership cross DLL boundaries is a \"definite no-no\". The compiler can't help you much here because of the dynamic/runtime aspect of loading (you'd get warnings and such if you linked the two together).\n\nOtherwise, though, it's expected that binaries use jemalloc (e.g. where Rust controls the world) and dylibs use the system allocator (where Rust is just a guest in someone else's world). As a result I'm going to close this as working as intended, but I think I may also try to write up some docs on custom allocators!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145908471/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145956280",
    "html_url": "https://github.com/rust-lang/rust/issues/28850#issuecomment-145956280",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28850",
    "id": 145956280,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NTk1NjI4MA==",
    "user": {
      "login": "eefriedman",
      "id": 12769964,
      "node_id": "MDQ6VXNlcjEyNzY5OTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/12769964?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eefriedman",
      "html_url": "https://github.com/eefriedman",
      "followers_url": "https://api.github.com/users/eefriedman/followers",
      "following_url": "https://api.github.com/users/eefriedman/following{/other_user}",
      "gists_url": "https://api.github.com/users/eefriedman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eefriedman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eefriedman/subscriptions",
      "organizations_url": "https://api.github.com/users/eefriedman/orgs",
      "repos_url": "https://api.github.com/users/eefriedman/repos",
      "events_url": "https://api.github.com/users/eefriedman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eefriedman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-06T18:28:43Z",
    "updated_at": "2015-10-06T18:28:43Z",
    "body": "@alexcrichton Does it sound feasible to print an error message in this scenario?  That would be a lot more friendly than crashing at runtime.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145956280/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145989890",
    "html_url": "https://github.com/rust-lang/rust/issues/28850#issuecomment-145989890",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28850",
    "id": 145989890,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NTk4OTg5MA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-06T20:26:36Z",
    "updated_at": "2015-10-06T20:26:36Z",
    "body": "Unfortunately not in an uninvasive manner that I know of. We could install a dlopen hook that looks for some other registered piece of Rust code and make sure the allocator is the same, but it may be overkill to do so.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145989890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145998738",
    "html_url": "https://github.com/rust-lang/rust/issues/28850#issuecomment-145998738",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28850",
    "id": 145998738,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NTk5ODczOA==",
    "user": {
      "login": "eefriedman",
      "id": 12769964,
      "node_id": "MDQ6VXNlcjEyNzY5OTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/12769964?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eefriedman",
      "html_url": "https://github.com/eefriedman",
      "followers_url": "https://api.github.com/users/eefriedman/followers",
      "following_url": "https://api.github.com/users/eefriedman/following{/other_user}",
      "gists_url": "https://api.github.com/users/eefriedman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eefriedman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eefriedman/subscriptions",
      "organizations_url": "https://api.github.com/users/eefriedman/orgs",
      "repos_url": "https://api.github.com/users/eefriedman/repos",
      "events_url": "https://api.github.com/users/eefriedman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eefriedman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-06T20:58:07Z",
    "updated_at": "2015-10-06T20:58:07Z",
    "body": "@alexcrichton Oh, right, I wasn't looking carefully enough; we can't really do anything if someone is using unsafe code to load a library at runtime.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/145998738/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/146005791",
    "html_url": "https://github.com/rust-lang/rust/issues/28850#issuecomment-146005791",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28850",
    "id": 146005791,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NjAwNTc5MQ==",
    "user": {
      "login": "tsurai",
      "id": 1909506,
      "node_id": "MDQ6VXNlcjE5MDk1MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1909506?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tsurai",
      "html_url": "https://github.com/tsurai",
      "followers_url": "https://api.github.com/users/tsurai/followers",
      "following_url": "https://api.github.com/users/tsurai/following{/other_user}",
      "gists_url": "https://api.github.com/users/tsurai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tsurai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tsurai/subscriptions",
      "organizations_url": "https://api.github.com/users/tsurai/orgs",
      "repos_url": "https://api.github.com/users/tsurai/repos",
      "events_url": "https://api.github.com/users/tsurai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tsurai/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-06T21:21:47Z",
    "updated_at": "2015-10-06T21:21:47Z",
    "body": "It is a fairly common use case though and would be nice for this behaviour to be properly documented somewhere. Took me a lot time to find the out what caused my memory problems and that only with the help of the rust irc channel.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/146005791/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/146013459",
    "html_url": "https://github.com/rust-lang/rust/issues/28850#issuecomment-146013459",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/28850",
    "id": 146013459,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NjAxMzQ1OQ==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-06T21:56:43Z",
    "updated_at": "2015-10-06T21:56:43Z",
    "body": "Certainly! I started writing some documentation over at https://github.com/rust-lang/rust/pull/28869, and more eyes are always welcome!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/146013459/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
