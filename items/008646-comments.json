[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23173116",
    "html_url": "https://github.com/rust-lang/rust/pull/8646#issuecomment-23173116",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8646",
    "id": 23173116,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzMTczMTE2",
    "user": {
      "login": "graydon",
      "id": 14097,
      "node_id": "MDQ6VXNlcjE0MDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/graydon",
      "html_url": "https://github.com/graydon",
      "followers_url": "https://api.github.com/users/graydon/followers",
      "following_url": "https://api.github.com/users/graydon/following{/other_user}",
      "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/graydon/subscriptions",
      "organizations_url": "https://api.github.com/users/graydon/orgs",
      "repos_url": "https://api.github.com/users/graydon/repos",
      "events_url": "https://api.github.com/users/graydon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/graydon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-23T15:59:57Z",
    "updated_at": "2013-08-23T16:10:31Z",
    "body": "I keep writing up then losing the comments I wanted to make here.\n\nI think I'd prefer the following changes:\n- `MetricGroup` contains only a static string -- the prefix -- and can thus be declared statically with a macro that expands to include `module_path!()`\n- `MetricGroup` manages a hashtable in TLS privately.\n- The enum is, if not private to the module, at least something hidden from most casual users of it. IOW, that the different types of metric are exposed to clients through a set of named convenience-methods on `MetricGroup` such as `MetricGroup::get_counter(name: &str, f: &fn(&Counter)->T)->T`. The method populates the TLS hashtable with a counter named by prepending the group prefix to the provided name, if it does not yet exist, and raises a condition (or fails) if someone tries to use the same name for different metrics types. I think there is a small enough number of metrics types that `get_counter`, `get_timer`, `get_gauge`, `get_histogram`, `get_meter`, etc. will not be too much clutter. If there are sub-options or special details to provide when getting a metric, they can either be wired into the convenience API (eg. `get_expdecay_histogram`), passed as enum flags, or can use a more-general \"raw\" method such as you've provided in the basic version here.\n- An _even shorter_ set of convenience APIs on `MetricGroup` that provide shortcuts to the default recording-action of contributing a sample to a metric, such as `inc_counter(&str)` or `time_event(&str,fn()->T)->T` or such.\n\nMostly I just want this interface to be as simple as possible so that people use it casually. Best usage I can picture is like:\n\n```\nmod foo {\n    metric_group!(foometrics);\n\n    fn bar() {\n        foometrics.inc_counter(\"bar\");\n        do foometrics.time_event(\"bar.first_part\") {\n            // ...\n        }\n    }\n}\n```\n\nMost of this can be done as followon commits (which I'm happy to help with), but I think `MetricsGroup` itself needs to be organized a little differently to get started.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23173116/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23409369",
    "html_url": "https://github.com/rust-lang/rust/pull/8646#issuecomment-23409369",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8646",
    "id": 23409369,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNDA5MzY5",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-28T12:12:22Z",
    "updated_at": "2013-08-28T12:12:22Z",
    "body": "@graydon I'm going to close this to clear up the queue as I don't foresee getting a chance to work on it in the next week, but if you don't get to it (I understand you're on vacation) I'll pick it up as soon as I can.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/23409369/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
