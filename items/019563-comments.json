[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65763022",
    "html_url": "https://github.com/rust-lang/rust/pull/19563#issuecomment-65763022",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19563",
    "id": 65763022,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NzYzMDIy",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-05T08:59:54Z",
    "updated_at": "2014-12-05T09:00:01Z",
    "body": "r=me after you either replace the four `v.insert(0, ...)` calls with something less expensive (or provide an argument for why the cost is reasonable here -- I'm working under the assumption that the vector can be quite large).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65763022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65763786",
    "html_url": "https://github.com/rust-lang/rust/pull/19563#issuecomment-65763786",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19563",
    "id": 65763786,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NzYzNzg2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-05T09:08:07Z",
    "updated_at": "2014-12-05T09:08:07Z",
    "body": "I'm not actually quite sure if we have a better way of doing so sadly. I don't know of a way to push many items onto a vector from the front, and we can't reserve space ahead-of-time as it may corrupt the rbml data. I do suspect that metadata would be quite large, but when compared to the runtime of the rest of the compiler I suspect it will not be so bad. \n\nDo you have an idea for how to do so here? We could allocate two vectors, but that does represent a significant portion of memory (maybe not so bad), and resorting to unsafe code seems like overkill for this.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65763786/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65772490",
    "html_url": "https://github.com/rust-lang/rust/pull/19563#issuecomment-65772490",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19563",
    "id": 65772490,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NzcyNDkw",
    "user": {
      "login": "lifthrasiir",
      "id": 323836,
      "node_id": "MDQ6VXNlcjMyMzgzNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/323836?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lifthrasiir",
      "html_url": "https://github.com/lifthrasiir",
      "followers_url": "https://api.github.com/users/lifthrasiir/followers",
      "following_url": "https://api.github.com/users/lifthrasiir/following{/other_user}",
      "gists_url": "https://api.github.com/users/lifthrasiir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lifthrasiir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lifthrasiir/subscriptions",
      "organizations_url": "https://api.github.com/users/lifthrasiir/orgs",
      "repos_url": "https://api.github.com/users/lifthrasiir/repos",
      "events_url": "https://api.github.com/users/lifthrasiir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lifthrasiir/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-05T10:34:05Z",
    "updated_at": "2014-12-05T10:34:05Z",
    "body": "@alexcrichton How about simply reserving four bytes before writing the actual metadata? Something in the line of this:\n\n``` rust\npub fn encode_metadata(parms: EncodeParams, krate: &ast::Crate) -> Vec<u8> {\n    let mut wr = SeekableMemWriter::new();\n\n    // Reserve 4 bytes for the length.\n    wr.write_be_u32(0).unwrap();\n\n    encode_metadata_inner(&mut wr, parms, krate);\n\n    // Now go back to the beginning and fill the length.\n    let len = (wr.tell().unwrap() - 4).to_u32().unwrap();\n    wr.seek(0, SeekStyle::SeekSet).unwrap();\n    wr.write_be_u32(len).unwrap();\n\n    wr.unwrap()\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65772490/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65820704",
    "html_url": "https://github.com/rust-lang/rust/pull/19563#issuecomment-65820704",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19563",
    "id": 65820704,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODIwNzA0",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-05T17:09:58Z",
    "updated_at": "2014-12-05T17:09:58Z",
    "body": "That was what I initially thought, but sadly if we reserve it up front then all of the offsets in the RBML tags will be off-by-four and probably corrupted :(\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65820704/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65821097",
    "html_url": "https://github.com/rust-lang/rust/pull/19563#issuecomment-65821097",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19563",
    "id": 65821097,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODIxMDk3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-05T17:12:09Z",
    "updated_at": "2014-12-05T17:12:21Z",
    "body": "Relatively speaking, shifting 4 bytes onto a 100MB array takes ~47ms on my machine:\n\n``` rust\nextern crate test;                                                \n\n#[bench]                                                          \nfn foo(b: &mut test::Bencher) {                                   \n    b.iter(|| {                                                   \n        let mut v = Vec::from_fn(100 * 1024 * 1024, |_| 0u8);     \n        v.insert(0, 1);                                           \n        v.insert(0, 1);                                           \n        v.insert(0, 1);                                           \n        v.insert(0, 1);                                           \n        v                                                         \n    });                                                           \n}                                                                 \n```\n\n```\nrunning 1 test\ntest foo ... bench:  47444184 ns/iter (+/- 343621)\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 1 measured\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65821097/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65879288",
    "html_url": "https://github.com/rust-lang/rust/pull/19563#issuecomment-65879288",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19563",
    "id": 65879288,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODc5Mjg4",
    "user": {
      "login": "lifthrasiir",
      "id": 323836,
      "node_id": "MDQ6VXNlcjMyMzgzNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/323836?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lifthrasiir",
      "html_url": "https://github.com/lifthrasiir",
      "followers_url": "https://api.github.com/users/lifthrasiir/followers",
      "following_url": "https://api.github.com/users/lifthrasiir/following{/other_user}",
      "gists_url": "https://api.github.com/users/lifthrasiir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lifthrasiir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lifthrasiir/subscriptions",
      "organizations_url": "https://api.github.com/users/lifthrasiir/orgs",
      "repos_url": "https://api.github.com/users/lifthrasiir/repos",
      "events_url": "https://api.github.com/users/lifthrasiir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lifthrasiir/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-06T01:22:11Z",
    "updated_at": "2014-12-06T01:22:11Z",
    "body": "@alexcrichton Ah, I forgot the existence of the index tables. :S Still, it might be possible to have a pseudo-RBML tag to do that, i.e. `tag_total_size` followed by `84` (the length, 4 bytes) followed by exactly four bytes of the total size of the metadata. `tag_total_size` is still a part of the metadata, so it wouldn't disrupt the indices.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65879288/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65889423",
    "html_url": "https://github.com/rust-lang/rust/pull/19563#issuecomment-65889423",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/19563",
    "id": 65889423,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODg5NDIz",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-06T08:03:01Z",
    "updated_at": "2014-12-06T08:03:01Z",
    "body": "@alexcrichton ah yes; I can think of new methods to add to Vec to support this case, but we need not block this PR on that high level design work \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/65889423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
