[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54208225",
    "html_url": "https://github.com/rust-lang/rust/issues/16946#issuecomment-54208225",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16946",
    "id": 54208225,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjA4MjI1",
    "user": {
      "login": "thehydroimpulse",
      "id": 565790,
      "node_id": "MDQ6VXNlcjU2NTc5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/565790?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thehydroimpulse",
      "html_url": "https://github.com/thehydroimpulse",
      "followers_url": "https://api.github.com/users/thehydroimpulse/followers",
      "following_url": "https://api.github.com/users/thehydroimpulse/following{/other_user}",
      "gists_url": "https://api.github.com/users/thehydroimpulse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thehydroimpulse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thehydroimpulse/subscriptions",
      "organizations_url": "https://api.github.com/users/thehydroimpulse/orgs",
      "repos_url": "https://api.github.com/users/thehydroimpulse/repos",
      "events_url": "https://api.github.com/users/thehydroimpulse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thehydroimpulse/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-02T19:56:38Z",
    "updated_at": "2014-09-02T19:56:38Z",
    "body": "It would probably be better to return a result instead of failing.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54208225/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54208565",
    "html_url": "https://github.com/rust-lang/rust/issues/16946#issuecomment-54208565",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16946",
    "id": 54208565,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjA4NTY1",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-02T19:59:07Z",
    "updated_at": "2014-09-02T19:59:18Z",
    "body": "Naturally an IoResult would be best. For now I've fixed this locally:\n\n``` rust\nstatic BUF_BYTES: uint = 4096;\n\n#[cfg(unix)]\npub fn getcwd() -> Option<Path> {\n    use std::c_str::CString;\n    use libc::{c_char, size_t};\n\n    let mut buf = [0 as c_char, ..BUF_BYTES];\n    unsafe {\n        if libc::getcwd(buf.as_mut_ptr(), buf.len() as size_t).is_null() {\n            None\n        } else {\n            Some(Path::new(CString::new(buf.as_ptr(), false)))\n        }\n    }\n}\n\n#[cfg(windows)]\npub fn getcwd() -> Option<Path> {\n    use libc::DWORD;\n    use libc::GetCurrentDirectoryW;\n\n    let mut buf = [0 as u16, ..BUF_BYTES];\n    unsafe {\n        if libc::GetCurrentDirectoryW(buf.len() as DWORD, buf.as_mut_ptr()) == 0 {\n            return None;\n        }\n    }\n    match String::from_utf16(std::str::truncate_utf16_at_nul(buf)) {\n        Some(s) => Some(Path::new(s)),\n        _ => None,\n    }\n}\n```\n\nAnd while we're at it: BUF_BYTES is 2048 in the stdlib which is way too small.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54208565/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54211529",
    "html_url": "https://github.com/rust-lang/rust/issues/16946#issuecomment-54211529",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16946",
    "id": 54211529,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjExNTI5",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-02T20:21:16Z",
    "updated_at": "2014-09-02T20:21:16Z",
    "body": "Apparently there is no path length limit on linux. glibc has the following extension that could be used to handle this:\n\n```\n       As  an  extension  to the POSIX.1-2001 standard, glibc's getcwd() allocates\n       the buffer dynamically using malloc(3) if buf is NULL.  In this  case,  the\n       allocated buffer has the length size unless size is zero, when buf is allo\u2010\n       cated as big as necessary.  The caller should free(3) the returned buffer.\n```\n\nNot sure about jemalloc <-> malloc here. FreeBSD has the same extension.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54211529/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54230123",
    "html_url": "https://github.com/rust-lang/rust/issues/16946#issuecomment-54230123",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16946",
    "id": 54230123,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjMwMTIz",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-02T22:54:24Z",
    "updated_at": "2014-09-02T22:54:24Z",
    "body": "@huonw Not sure why you changed the title. You cannot use getcwd in its current form in a safe way if you don't want your program to crash. Even if the user just deleted the directory your program was started from, your program will crash. If your program was started with a very long cwd path? Crash. getcwd is literally useless in its current form. No need to sugarcoat the issue.\n\nFurthermore your title is misleading since this is not the only issue. getcwd also fails if the buffer is too small. That means that the documentation is incorrect.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54230123/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54232079",
    "html_url": "https://github.com/rust-lang/rust/issues/16946#issuecomment-54232079",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16946",
    "id": 54232079,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjMyMDc5",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-02T23:18:09Z",
    "updated_at": "2014-09-02T23:18:09Z",
    "body": "The original title was unnecessarily inflammatory and nonspecific; I changed it to accurately reflect the problem: it `fail!`s instead of handling errors properly.\n\n> Furthermore your title is misleading since this is not the only issue. getcwd also fails if the buffer is too small.\n\nThat is included in \"failing too eagerly\": it doesn't handle this 'error' properly.\n\n> That means that the documentation is incorrect.\n\nYour title didn't address this either.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54232079/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54574812",
    "html_url": "https://github.com/rust-lang/rust/issues/16946#issuecomment-54574812",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16946",
    "id": 54574812,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NTc0ODEy",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-09-05T02:28:40Z",
    "updated_at": "2014-09-05T02:28:40Z",
    "body": "cc @aturon\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/54574812/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
