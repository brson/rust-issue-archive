[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41586053",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41586053",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41586053,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNTg2MDUz",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-28T17:16:21Z",
    "updated_at": "2014-04-28T17:16:21Z",
    "body": "(it is of course possible that both types of builds would exhibit the bug, and that the `--disable-optimize` is just increasing the probability of the failure by some large amount.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41586053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41586074",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41586074",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41586074,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNTg2MDc0",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-28T17:16:30Z",
    "updated_at": "2014-04-28T17:16:30Z",
    "body": "cc @alexcrichton \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41586074/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41586224",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41586224",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41586224,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNTg2MjI0",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-28T17:17:54Z",
    "updated_at": "2014-04-28T17:17:54Z",
    "body": "This seems quite normal to me. You get a broken pipe when someone closes stdin (as `head` did after it finished reading), and I expect that `--disable-optimize` slowed everything down which caused everything to show up more. It could be the case that with the `--enable-optimize` build that it's fast enough to write everything before `head` closes stdin.\n\nWhat is the behavior you expect to see here?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41586224/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41616575",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41616575",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41616575,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNjE2NTc1",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-28T21:34:15Z",
    "updated_at": "2014-04-28T21:34:15Z",
    "body": "@alexcrichton you are right, I should have said up front that I was not sure if this was a bug or not.\n\nI suppose the real question then is: How should someone who wants to write code that will interact with Unix tools like `head` handle this case properly?\n- Should they not use `println!`?  (i.e. Should we make a variant of `println!` that returns `Result`?)  \n- Should they put their code into a separate task and then fire that off from a monitoring task to catch the failure?\n\nOr should we change/extend our IO library to ease this use case?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41616575/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41617422",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41617422",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41617422,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNjE3NDIy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-28T21:42:33Z",
    "updated_at": "2014-04-28T21:42:33Z",
    "body": "I would expect any user wanting to handle errors printing to stdout to use `io::stdout()` rather than `println!`. I don't think we really need to add another variant of `println!` because I imagine this will be fairly rare, and the separate task shouldn't be needed once you're using a real I/O object.\n\nMy guess is that we don't need to change the current state of affairs, except perhaps to ignore errors instead of failing on them.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41617422/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41645113",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41645113",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41645113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNjQ1MTEz",
    "user": {
      "login": "Morgawr",
      "id": 184056,
      "node_id": "MDQ6VXNlcjE4NDA1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/184056?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Morgawr",
      "html_url": "https://github.com/Morgawr",
      "followers_url": "https://api.github.com/users/Morgawr/followers",
      "following_url": "https://api.github.com/users/Morgawr/following{/other_user}",
      "gists_url": "https://api.github.com/users/Morgawr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Morgawr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Morgawr/subscriptions",
      "organizations_url": "https://api.github.com/users/Morgawr/orgs",
      "repos_url": "https://api.github.com/users/Morgawr/repos",
      "events_url": "https://api.github.com/users/Morgawr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Morgawr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-29T06:24:52Z",
    "updated_at": "2014-04-29T06:24:52Z",
    "body": "Hey, I'm the guy who reported this \"bug\" on the irc. \nI don't really know why this is happening (I can guess, it's not too hard), but I'd like to say that piping a process' output to other programs (that might or might not break those pipes as soon as they finish reading) is something very common on Unix systems (as you probably already know) and this behavior is a bit confusing and unexpected. \nRegardless of whether or not this is considered a bug, I'd say the behavior should be changed in such a way that it doesn't cause problems or misunderstandings with Unix pipes.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41645113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41699554",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41699554",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41699554,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNjk5NTU0",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-29T16:34:28Z",
    "updated_at": "2014-04-29T16:34:28Z",
    "body": "Do you have an idea of the behavior that you're expecting. What's happening is that you issued a `println!` when stdout was closed, returning a broken pipe. Do you think that the error should be ignored?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41699554/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41704390",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41704390",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41704390,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzA0Mzkw",
    "user": {
      "login": "Morgawr",
      "id": 184056,
      "node_id": "MDQ6VXNlcjE4NDA1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/184056?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Morgawr",
      "html_url": "https://github.com/Morgawr",
      "followers_url": "https://api.github.com/users/Morgawr/followers",
      "following_url": "https://api.github.com/users/Morgawr/following{/other_user}",
      "gists_url": "https://api.github.com/users/Morgawr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Morgawr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Morgawr/subscriptions",
      "organizations_url": "https://api.github.com/users/Morgawr/orgs",
      "repos_url": "https://api.github.com/users/Morgawr/repos",
      "events_url": "https://api.github.com/users/Morgawr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Morgawr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-29T17:13:52Z",
    "updated_at": "2014-04-29T17:13:52Z",
    "body": "Unless Rust standard behavior is that I need to take some sort of lock around an stdout operation before issuing a print, I'd expect that the first process (the rust process) that pipes to head should not crash and error if some other process is trying to read from such shared pipe and then closes it.\n\nI mean, maybe this is what happens on Unix pipes under the hood and I was never aware of it, but if I write the equivalent C program to print 100 numbers to stdout and pipe it to head, I'm expecting it not to crash halfway through.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41704390/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41716942",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41716942",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41716942,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzE2OTQy",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-29T18:51:13Z",
    "updated_at": "2014-04-29T18:51:13Z",
    "body": "Rust is not crashing, it is triggering a task failure. When you write the equivalent C program the same thing is happening, but you are ignoring all of the errors (almost no one checks the return value of `printf`).\n\nThere's no need for any locking here, I'm curious if you think that rust should be ignoring the error on the write?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41716942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41719240",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41719240",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41719240,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzE5MjQw",
    "user": {
      "login": "Morgawr",
      "id": 184056,
      "node_id": "MDQ6VXNlcjE4NDA1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/184056?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Morgawr",
      "html_url": "https://github.com/Morgawr",
      "followers_url": "https://api.github.com/users/Morgawr/followers",
      "following_url": "https://api.github.com/users/Morgawr/following{/other_user}",
      "gists_url": "https://api.github.com/users/Morgawr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Morgawr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Morgawr/subscriptions",
      "organizations_url": "https://api.github.com/users/Morgawr/orgs",
      "repos_url": "https://api.github.com/users/Morgawr/repos",
      "events_url": "https://api.github.com/users/Morgawr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Morgawr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-29T19:10:48Z",
    "updated_at": "2014-04-29T19:10:48Z",
    "body": "The standard behavior of printf is to return the number of written characters to stdout or a negative value in case of error. In case of piping an equivalent C program to head, none of the printf ever fail or return truncated values. \n\nActually, I just checked the differences in behavior for a Rust and a C equivalent program, by printing to both stdout (captured by head) and stderr. The substantial difference is that the C program _always_ terminates, I get to see all 100 numbers printed to stderr and capture only the first 10 to stdout with head. In Rust, instead, the numbers are printed one by one and captured by head, until head decides to cut off the pipe and then the Rust program stops (crashes? exits? throws an exception? Irrelevant). \n\nExpected behavior when running a piped program: the program runs to completion as if it were running without any pipe at all.\nCurrent rust behavior: the program behaves differently with or without a pipe, and sometimes this broken pipe makes the program close prematurely.\n\nThis difference has the potential of breaking the expected behavior in automated scripts for a lot of system administration's tools and setups. Imagine if my program is supposed to perform some important action and I want to pipe it to another program that only gets so much data and then closes the pipe, the first program would potentially crash and work incorrectly.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41719240/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41732161",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41732161",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41732161,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzMyMTYx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-29T21:06:49Z",
    "updated_at": "2014-04-29T21:06:49Z",
    "body": "> In case of piping an equivalent C program to head, none of the printf ever fail or return truncated values.\n\nThis is not true. When printing to a pipe, printf is by default buffered by something around 4k. This means that your program is likely only issuing one write syscall, which will always succeed (head is reading at least something).\n\nIf you turn off buffering, the program dies with a SIGPIPE:\n\n```\n$ strace ./foo | head -n 3\nexecve(\"./foo\", [\"./foo\"], [/* 26 vars */]) = 0\nbrk(0)                                  = 0x228a000\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = -1 ENOENT (No such file or directory)\nmmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f6572c6b000\naccess(\"/etc/ld.so.preload\", R_OK)      = -1 ENOENT (No such file or directory)\nopen(\"/etc/ld.so.cache\", O_RDONLY|O_CLOEXEC) = 3\nfstat(3, {st_mode=S_IFREG|0644, st_size=92196, ...}) = 0\nmmap(NULL, 92196, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f6572c54000\nclose(3)                                = 0\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = -1 ENOENT (No such file or directory)\nopen(\"/lib/x86_64-linux-gnu/libc.so.6\", O_RDONLY|O_CLOEXEC) = 3\nread(3, \"\\177ELF\\2\\1\\1\\0\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0>\\0\\1\\0\\0\\0\\360\\36\\2\\0\\0\\0\\0\\0\"..., 832) = 832\nfstat(3, {st_mode=S_IFREG|0755, st_size=1853400, ...}) = 0\nmmap(NULL, 3961912, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f6572683000\nmprotect(0x7f6572840000, 2097152, PROT_NONE) = 0\nmmap(0x7f6572a40000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1bd000) = 0x7f6572a40000\nmmap(0x7f6572a46000, 17464, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f6572a46000\nclose(3)                                = 0\nmmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f6572c53000\nmmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f6572c51000\narch_prctl(ARCH_SET_FS, 0x7f6572c51740) = 0\nmprotect(0x7f6572a40000, 16384, PROT_READ) = 0\nmprotect(0x600000, 4096, PROT_READ)     = 0\nmprotect(0x7f6572c6d000, 4096, PROT_READ) = 0\nmunmap(0x7f6572c54000, 92196)           = 0\nfstat(1, {st_mode=S_IFIFO|0600, st_size=0, ...}) = 0\nmmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f6572c6a000\nwrite(1, \"test\\n\", 5)                   = 5\nwrite(1, \"test\\n\", 5test\ntest\n)                   = 5\nwrite(1, \"test\\n\", 5test\n)                   = 5\nwrite(1, \"test\\n\", 5)                   = -1 EPIPE (Broken pipe)\n--- SIGPIPE {si_signo=SIGPIPE, si_code=SI_USER, si_pid=24113, si_uid=1000} ---\n+++ killed by SIGPIPE +++\n```\n\nThis means to emulate the same behavior, the rust program should abort() on SIGPIPE. This is unsafe, so it is contained as part of a task failure (explaining the current semantics).\n\nI don't quite understand how the runtime would sanely change to support this use case. This seems to be acting precisely as what C does, except in a more controlled manner. If you are expecting a particular amount of buffering, then it is expected that you manually provide such buffering (via `stdio::set_stdout`).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41732161/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41734048",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41734048",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41734048,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzM0MDQ4",
    "user": {
      "login": "Morgawr",
      "id": 184056,
      "node_id": "MDQ6VXNlcjE4NDA1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/184056?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Morgawr",
      "html_url": "https://github.com/Morgawr",
      "followers_url": "https://api.github.com/users/Morgawr/followers",
      "following_url": "https://api.github.com/users/Morgawr/following{/other_user}",
      "gists_url": "https://api.github.com/users/Morgawr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Morgawr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Morgawr/subscriptions",
      "organizations_url": "https://api.github.com/users/Morgawr/orgs",
      "repos_url": "https://api.github.com/users/Morgawr/repos",
      "events_url": "https://api.github.com/users/Morgawr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Morgawr/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-29T21:23:34Z",
    "updated_at": "2014-04-29T21:23:34Z",
    "body": "I see, however this is not the same behavior I am getting on printf(). Maybe glibc or the environment overrides normal settings but even when I run:\nsetvbuf(stdout, NULL, _IONBF, 0);\nsetvbuf(stderr, NULL, _IONBF, 0);\nin a C program, it still runs until completion when piped to head. When I run it with strace, however, it doesn't.\n\nThis is an interesting problem in my opinion, I have no idea what's the expected behavior anymore, really. Maybe somebody who knows more than me about this issue could comment on standard behaviors...\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41734048/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41734908",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-41734908",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 41734908,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzM0OTA4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-04-29T21:31:10Z",
    "updated_at": "2014-04-29T21:31:10Z",
    "body": "The behavior you're seeing on unix is likely one of two situations:\n1. All data is written before the pipe is terminated. This is always a possibility (head and your program could be running in parallel). This could also be a result of buffered writes at some layer of the stack (perhaps the kernel could be buffering, or even head itself?)\n2. A write is returning error, but the error is EPIPE. The C runtime by default sends SIGPIPE to a program that would otherwise receive EPIPE. Your program likely doesn't have a SIGPIPE handler, so it is terminated.\n\nIf the rust program falls into bucket 1, then there's no difference. The difference between rust and C in bucket 2 is that rust is a safe language, so it doesn't ever abort() by default. Rust ignores SIGPIPE by default, and will trigger a task failure rather than an abort().\n\nIn order to change semantics, rust would have to behave differently when it receives EPIPE, but I'm not fully convinced that it should change to something like abort(), and a task failure seems like the genuinely correct thing to do in this case.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/41734908/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71144710",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-71144710",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 71144710,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMTQ0NzEw",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-23T04:03:33Z",
    "updated_at": "2015-01-23T04:03:33Z",
    "body": "So, is this not really a bug, then?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71144710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71237954",
    "html_url": "https://github.com/rust-lang/rust/issues/13824#issuecomment-71237954",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/13824",
    "id": 71237954,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjM3OTU0",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-23T18:18:05Z",
    "updated_at": "2015-01-23T18:18:05Z",
    "body": "@steveklabnik I guess the one thing I'd like to see is what the \"closest\" port of the C version of this program is (where by \"closest\", I mean closest in the end observable semantics, excepting that I would like to eschew undefined behavior if possible).\n\n@alexcrichton said above in an answer to one of my questions that he \"would expect any user wanting to handle errors printing to stdout to use io::stdout() rather than println!\" It might be nice if we actually showed what that looks like.\n\nBut having said that, I also am not sure that writing such an example need block this ticket.  So you can feel free to close.  (Or maybe if I am inspired, I'll try to write the aforementioned example.)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71237954/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
