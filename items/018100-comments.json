[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59433394",
    "html_url": "https://github.com/rust-lang/rust/issues/18100#issuecomment-59433394",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18100",
    "id": 59433394,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NDMzMzk0",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-16T21:26:40Z",
    "updated_at": "2014-10-16T21:26:40Z",
    "body": "The trait does not guarantee such a thing and read_at_least won't do what you want either because it will return an error if your buffer is larger than the file. Fortunately there is a PR that introduces a function which does what you want: #18059\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59433394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59450644",
    "html_url": "https://github.com/rust-lang/rust/issues/18100#issuecomment-59450644",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18100",
    "id": 59450644,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NDUwNjQ0",
    "user": {
      "login": "gavinb",
      "id": 158326,
      "node_id": "MDQ6VXNlcjE1ODMyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/158326?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinb",
      "html_url": "https://github.com/gavinb",
      "followers_url": "https://api.github.com/users/gavinb/followers",
      "following_url": "https://api.github.com/users/gavinb/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinb/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinb/orgs",
      "repos_url": "https://api.github.com/users/gavinb/repos",
      "events_url": "https://api.github.com/users/gavinb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-17T00:21:33Z",
    "updated_at": "2014-10-17T00:21:33Z",
    "body": "Ok, the trait technically doesn't _guarantee_ that it will read the whole buffer worth of bytes, but it does say it will read \"up to the length of `buf`\", just without specifying when it will do short reads. It is not unreasonable to expect that if the data is all there and the buffer is large enough, it should go ahead and fill the whole buffer.\n\nSurely the whole point of using a `BufferedReader` is that it will do all the messy 64kB chunked reads for you? It seems crazy that the onus would be pushed back to every single user of this class to keep doing partial reads into offsets into the buffer (error-prone and a waste of duplicated effort), especially when the only way to tell the API how much you want to read is to preallocate the buffer with the desired size.\n\nThis also seems to violate the Principle of Least Surprise; if the user has to iteratively read chunks into their own buffer, the encapsulation of the internal buffer is broken, and the reasonable expectation that the Buffered class is going to do the hard work for you is gone.  I would expect that when using a plain `Reader`, the client code would need to handle the buffering details themselves, but if the `BufferedReader` doesn't do this for you, what is the point?\n\nGlad to see I'm not the only one running into this problem. The `try_fill` proposal seems to implement the semantics I would expect.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59450644/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59451182",
    "html_url": "https://github.com/rust-lang/rust/issues/18100#issuecomment-59451182",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18100",
    "id": 59451182,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NDUxMTgy",
    "user": {
      "login": "mahkoh",
      "id": 1882250,
      "node_id": "MDQ6VXNlcjE4ODIyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1882250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mahkoh",
      "html_url": "https://github.com/mahkoh",
      "followers_url": "https://api.github.com/users/mahkoh/followers",
      "following_url": "https://api.github.com/users/mahkoh/following{/other_user}",
      "gists_url": "https://api.github.com/users/mahkoh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mahkoh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mahkoh/subscriptions",
      "organizations_url": "https://api.github.com/users/mahkoh/orgs",
      "repos_url": "https://api.github.com/users/mahkoh/repos",
      "events_url": "https://api.github.com/users/mahkoh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mahkoh/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-17T00:29:07Z",
    "updated_at": "2014-10-17T00:29:07Z",
    "body": "I've opened #18106 to clarify the behavior of `read`.\n\nConsider using a plain Reader if you want to read large chunks of data into your own buffer. BufferedReader is quite inefficient here because it first copies the data into its buffer and then into yours. It is more suitable if the user wants to read very small chunks, e.g., if he wants to read up to a certain character.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59451182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59461114",
    "html_url": "https://github.com/rust-lang/rust/issues/18100#issuecomment-59461114",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18100",
    "id": 59461114,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NDYxMTE0",
    "user": {
      "login": "sfackler",
      "id": 1455697,
      "node_id": "MDQ6VXNlcjE0NTU2OTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sfackler",
      "html_url": "https://github.com/sfackler",
      "followers_url": "https://api.github.com/users/sfackler/followers",
      "following_url": "https://api.github.com/users/sfackler/following{/other_user}",
      "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions",
      "organizations_url": "https://api.github.com/users/sfackler/orgs",
      "repos_url": "https://api.github.com/users/sfackler/repos",
      "events_url": "https://api.github.com/users/sfackler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sfackler/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-17T03:12:05Z",
    "updated_at": "2014-10-17T03:12:05Z",
    "body": "I agree with @mahkoh here. `BufferedReader` exists to amortize the costs of many small reads. If you're making large reads, then adding a `BufferedReader` just adds overhead.\n\nRepeatedly `read`ing into the underlying `Reader` until the buffer is filled on calls to `read` is _wrong_ in many cases. There might not be enough data coming in to fill the buffer so you're just going to block indefinitely!\n\nIf you are expecting a certain amount of data to come in, then `read_at_least` will wait until it can give it all to you. Otherwise, the safe thing to do is to take what the kernel has to give you as it comes in.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59461114/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59669540",
    "html_url": "https://github.com/rust-lang/rust/issues/18100#issuecomment-59669540",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18100",
    "id": 59669540,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NjY5NTQw",
    "user": {
      "login": "gavinb",
      "id": 158326,
      "node_id": "MDQ6VXNlcjE1ODMyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/158326?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinb",
      "html_url": "https://github.com/gavinb",
      "followers_url": "https://api.github.com/users/gavinb/followers",
      "following_url": "https://api.github.com/users/gavinb/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinb/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinb/orgs",
      "repos_url": "https://api.github.com/users/gavinb/repos",
      "events_url": "https://api.github.com/users/gavinb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-19T23:00:29Z",
    "updated_at": "2014-10-19T23:00:29Z",
    "body": "> `BufferedReader` exists to amortize the costs of many small reads\n\nOk, I guess that makes sense. I still think the docs could be more explicit though; I would expect that a wrapper would provide higher level features/abstractions and handle more work for you. This ends up pushing the work of handling chunked reads back on the caller, even if it _could_ have processed multiple reads (or larger chunks) itself.\n\n> If you are expecting a certain amount of data to come in, then `read_at_least` will wait until it can give it all to you.\n\nOk but the point I was making in the sample code above is that it needn't wait; the data is available and the buffer is big enough.  It seems like `read_at_least` makes _explicit_ the buffer size that is _implicit_ in the `read` method when the buffer is preallocated to a certain size. So despite the claim in the docs, `but` size is basically ignored in this case.\n\n> Otherwise, the safe thing to do is to take what the kernel has to give you as it comes in.\n\nBut the `BufferedReader` explicitly limits the reads to the maximum of its buffer size, despite the kernel potentially having more data available, as in this example.\n\nThe sample code for the `io` module all show using `BufferedReader`, presumably because it is calling `read_line`. Perhaps an example of using a large fixed size buffer would help avoid this confusion?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59669540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68188913",
    "html_url": "https://github.com/rust-lang/rust/issues/18100#issuecomment-68188913",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18100",
    "id": 68188913,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTg4OTEz",
    "user": {
      "login": "oleid",
      "id": 3369899,
      "node_id": "MDQ6VXNlcjMzNjk4OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3369899?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/oleid",
      "html_url": "https://github.com/oleid",
      "followers_url": "https://api.github.com/users/oleid/followers",
      "following_url": "https://api.github.com/users/oleid/following{/other_user}",
      "gists_url": "https://api.github.com/users/oleid/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/oleid/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/oleid/subscriptions",
      "organizations_url": "https://api.github.com/users/oleid/orgs",
      "repos_url": "https://api.github.com/users/oleid/repos",
      "events_url": "https://api.github.com/users/oleid/events{/privacy}",
      "received_events_url": "https://api.github.com/users/oleid/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-27T20:13:23Z",
    "updated_at": "2014-12-27T21:26:43Z",
    "body": "I just stumbled across the same behaviour, in case I read to a small buffer and to a big buffer afterwards. If I comment the reading to a small buffer (the marked lines), the reading works as expected.\n\n``` rust\nuse std::io;\n\n\nfn stream_file(input_file   : &Path, \n                output_file  : &Path) -> io::IoResult<()> {\n\n    let  fin  = io::File::open(input_file);\n    let  fout = io::File::create(output_file);\n\n    let mut r = io::BufferedReader::new(fin);\n    let mut w = io::BufferedWriter::new(fout);\n\n    let mut buf               = Vec::from_elem(128*1024, 0u8);\n    let mut stream_ended      = false;\n\n    // comment from here\n    let n_read      = try!( r.read(buf.slice_to_mut(128) ));\n    println!(\"Read {} byte.\", n_read);\n\n    try!(w.write(buf.slice_to(128)));\n    // to here\n\n    while !stream_ended {\n        let n_read   = try!( r.read(buf.as_mut_slice())); \n        println!(\"Read {} byte, buffer is {} byte.\", n_read, buf.len());\n\n        if n_read < buf.len() {\n            // probably stream end\n            buf.truncate(n_read); // file ends with header\n            println!(\"Short read of {0} byte, stream has probably ended. Buffer len = {1} \", n_read, buf.len());\n            stream_ended = true;\n        } \n\n        try!(w.write(buf.as_slice() ));\n    }\n    Ok( () )\n}\n\n\n\nfn main() {\n    stream_file(&Path::new(\"/boot/vmlinuz-linux\"), &Path::new(\"Test\") )\n        .ok().expect(\"Failed to read!\");\n}\n```\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68188913/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71965450",
    "html_url": "https://github.com/rust-lang/rust/issues/18100#issuecomment-71965450",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18100",
    "id": 71965450,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxOTY1NDUw",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-29T03:59:36Z",
    "updated_at": "2015-01-29T03:59:36Z",
    "body": "What action could be taken to consider this issue closed?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71965450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71966210",
    "html_url": "https://github.com/rust-lang/rust/issues/18100#issuecomment-71966210",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18100",
    "id": 71966210,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxOTY2MjEw",
    "user": {
      "login": "sfackler",
      "id": 1455697,
      "node_id": "MDQ6VXNlcjE0NTU2OTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sfackler",
      "html_url": "https://github.com/sfackler",
      "followers_url": "https://api.github.com/users/sfackler/followers",
      "following_url": "https://api.github.com/users/sfackler/following{/other_user}",
      "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions",
      "organizations_url": "https://api.github.com/users/sfackler/orgs",
      "repos_url": "https://api.github.com/users/sfackler/repos",
      "events_url": "https://api.github.com/users/sfackler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sfackler/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-29T04:10:03Z",
    "updated_at": "2015-01-29T04:10:03Z",
    "body": "I think this can be closed now. We bypass the `BufferedReader`'s buffer if it's empty and the array passed to `read` is larger than it: https://github.com/rust-lang/rust/blob/master/src/libstd/old_io/buffered.rs#L114-L116. I think that's the right place to end up, and it corresponds with how the equivalent types in other languages behave.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71966210/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
