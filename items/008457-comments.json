[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22466275",
    "html_url": "https://github.com/rust-lang/rust/issues/8457#issuecomment-22466275",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8457",
    "id": 22466275,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyNDY2Mjc1",
    "user": {
      "login": "orenbenkiki",
      "id": 68190,
      "node_id": "MDQ6VXNlcjY4MTkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/68190?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/orenbenkiki",
      "html_url": "https://github.com/orenbenkiki",
      "followers_url": "https://api.github.com/users/orenbenkiki/followers",
      "following_url": "https://api.github.com/users/orenbenkiki/following{/other_user}",
      "gists_url": "https://api.github.com/users/orenbenkiki/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/orenbenkiki/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/orenbenkiki/subscriptions",
      "organizations_url": "https://api.github.com/users/orenbenkiki/orgs",
      "repos_url": "https://api.github.com/users/orenbenkiki/repos",
      "events_url": "https://api.github.com/users/orenbenkiki/events{/privacy}",
      "received_events_url": "https://api.github.com/users/orenbenkiki/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-11T21:55:53Z",
    "updated_at": "2013-08-11T21:55:53Z",
    "body": "Also see https://gist.github.com/orenbenkiki/6206863 which shows the different versions of the function I tried.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22466275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22581881",
    "html_url": "https://github.com/rust-lang/rust/issues/8457#issuecomment-22581881",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8457",
    "id": 22581881,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyNTgxODgx",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-13T17:22:11Z",
    "updated_at": "2013-08-13T17:22:11Z",
    "body": "First, upgrading a read-write lock from read to write is a logical impossibility (presumably it should be done atomically -- that is, without permitting writers in the middle -- so what happens if two readers both try it?). So this is why it doesn't work. I am not sure why it doesn't yield a type error, I forget how the scheme of \"r/w arc\" was setup.\n\nAs for the inference failure and ICE, I'm not sure what's going on _there_,Ii'll have to look into it.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22581881/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22582567",
    "html_url": "https://github.com/rust-lang/rust/issues/8457#issuecomment-22582567",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8457",
    "id": 22582567,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyNTgyNTY3",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-13T17:31:15Z",
    "updated_at": "2013-08-13T17:31:15Z",
    "body": "OK, the ICE is unfortunate, but there is a real error here that the compiler is trying to complain about (and crashing in the process). You can't return those borrowed pointers out of the lock closure because they are only valid so long as the map is immutable, and of course once the lock is released the map is mutable again (that's the high-level explanation, of course the type system is ignorant of this high-level reason but it's encoded through the region rules).\n\nThe correct way to write this code, then, is to dereference the borrowed pointers while still holding the lock. The easiest way is just to use the `find_copy` method on the hashmap, so that it doesn't return a pointer to the item but rather the item itself. The more explicit alternative is to convert:\n\n```\n let maybe_intern: &'self Option<&Intern> = do arc_interner.write |interner| {\n                        interner.str_to_intern.find(&burrowed.to_str())\n                    };\n```\n\nto\n\n```\n let maybe_intern: &'self Option<&Intern> = do arc_interner.write |interner| {\n                        match interner.str_to_intern.find(&burrowed.to_str()) { Some(v) => Some(*v), None => None }\n                    };\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22582567/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22582883",
    "html_url": "https://github.com/rust-lang/rust/issues/8457#issuecomment-22582883",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8457",
    "id": 22582883,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyNTgyODgz",
    "user": {
      "login": "orenbenkiki",
      "id": 68190,
      "node_id": "MDQ6VXNlcjY4MTkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/68190?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/orenbenkiki",
      "html_url": "https://github.com/orenbenkiki",
      "followers_url": "https://api.github.com/users/orenbenkiki/followers",
      "following_url": "https://api.github.com/users/orenbenkiki/following{/other_user}",
      "gists_url": "https://api.github.com/users/orenbenkiki/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/orenbenkiki/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/orenbenkiki/subscriptions",
      "organizations_url": "https://api.github.com/users/orenbenkiki/orgs",
      "repos_url": "https://api.github.com/users/orenbenkiki/repos",
      "events_url": "https://api.github.com/users/orenbenkiki/events{/privacy}",
      "received_events_url": "https://api.github.com/users/orenbenkiki/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-08-13T17:35:52Z",
    "updated_at": "2013-08-13T17:35:52Z",
    "body": "I just switched to find_copy as you suggested. I see your point about upgrading locks - it would require STM functionality, not something you'd want here.\n\nThe compiler crashing is still a bug though, of course, but I have a working solution now.\n\nThanks!\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/22582883/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30892395",
    "html_url": "https://github.com/rust-lang/rust/issues/8457#issuecomment-30892395",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/8457",
    "id": 30892395,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODkyMzk1",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-12-18T23:36:14Z",
    "updated_at": "2013-12-18T23:36:14Z",
    "body": "This is working today because the root of the problem is an undeclared lifetime which is now a legitimate error. I've seen relevant tests in the testsuite, co closing.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/30892395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
