[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/147560950",
    "html_url": "https://github.com/rust-lang/rust/issues/29010#issuecomment-147560950",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29010",
    "id": 147560950,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NzU2MDk1MA==",
    "user": {
      "login": "petrochenkov",
      "id": 5751617,
      "node_id": "MDQ6VXNlcjU3NTE2MTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petrochenkov",
      "html_url": "https://github.com/petrochenkov",
      "followers_url": "https://api.github.com/users/petrochenkov/followers",
      "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}",
      "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions",
      "organizations_url": "https://api.github.com/users/petrochenkov/orgs",
      "repos_url": "https://api.github.com/users/petrochenkov/repos",
      "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petrochenkov/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-13T00:55:15Z",
    "updated_at": "2015-10-13T00:57:21Z",
    "body": "There's a [PR](https://github.com/rust-lang/rust/pull/28921) implementing conversion traits `Into/From` for primitive integer types.\nWhen it lands, I think it will be reasonable to implement `Index<T>/IndexMut<T> where T: Into<usize>` for vectors, arrays, etc., covering the first part of your proposal, it will need some wider consensus though, many people don't like implicit conversions like these.\n\nThere's also an [RFC](https://github.com/rust-lang/rfcs/pull/1218) proposing checked integer conversions, panicking on truncation. With these conversions indexing with signed types will look like `v[index.cast()]` making the possible panic more visible (I'd personally prefer it to be visible). This covers the second and the third parts of your proposal.\n\nSome older discussion on this topic:\nhttps://internals.rust-lang.org/t/implicit-widening-polymorphic-indexing-and-similar-ideas\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/147560950/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/147567356",
    "html_url": "https://github.com/rust-lang/rust/issues/29010#issuecomment-147567356",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29010",
    "id": 147567356,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NzU2NzM1Ng==",
    "user": {
      "login": "peter-bertok",
      "id": 14988123,
      "node_id": "MDQ6VXNlcjE0OTg4MTIz",
      "avatar_url": "https://avatars.githubusercontent.com/u/14988123?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/peter-bertok",
      "html_url": "https://github.com/peter-bertok",
      "followers_url": "https://api.github.com/users/peter-bertok/followers",
      "following_url": "https://api.github.com/users/peter-bertok/following{/other_user}",
      "gists_url": "https://api.github.com/users/peter-bertok/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/peter-bertok/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/peter-bertok/subscriptions",
      "organizations_url": "https://api.github.com/users/peter-bertok/orgs",
      "repos_url": "https://api.github.com/users/peter-bertok/repos",
      "events_url": "https://api.github.com/users/peter-bertok/events{/privacy}",
      "received_events_url": "https://api.github.com/users/peter-bertok/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-13T01:24:36Z",
    "updated_at": "2015-10-13T01:24:36Z",
    "body": "Making the panic for the signed integer case \"visible\" would be inconsistent with the current behaviour for out-of-bounds large positive numbers...\n\nThat is, both of these cases should \"work\" in the sense that both should panic, for the same reason and in the same way:\n\n``` rust\nlet i: isize = -5;\nlet j: usize =  5;\nlet x = [0; 2];\nlet a = x[i]; // panic (out-of-bounds low)\nlet a = x[j]; // panic (out-of-bounds high)\n```\n\nNow that I think about it, the `i64` and  `u64` cases aren't \"special\" either, as long as the bounds checking is relied upon! The PR you mentioned however could result in inconsistent behaviour (depending on implementation details) which goes against the principle of least surprise.\n\nFor example, consider the case of indexing into an array using 'large' `u64` numbers. The exact type of panic would be inconsistent between 32-bit and 64-bit.\n\nE.g.:\n\n``` rust\nlet i: u64 = {larger than array bounds, representable within 32 bits};\nlet j: u64 = {too large to represent within 32 bits};\nlet x = [0; ...];\nlet a = x[i]; // slice out-of-bounds panic on any platform\nlet b = x[j]; // slice out-of-bounds panic on 64-bit, integer truncation on 32-bit\n```\n\nThis could cause issues for programmers relying on [`catch_panic`](https://doc.rust-lang.org/std/thread/fn.catch_panic.html).\n\nIdeally, any integer type should be usable for indexing, and the behaviour should always be consistent: allow the lookup if within bounds, panic with an out-of-bounds error otherwise (not an integer truncation error).\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/147567356/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/147573487",
    "html_url": "https://github.com/rust-lang/rust/issues/29010#issuecomment-147573487",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29010",
    "id": 147573487,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NzU3MzQ4Nw==",
    "user": {
      "login": "petrochenkov",
      "id": 5751617,
      "node_id": "MDQ6VXNlcjU3NTE2MTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petrochenkov",
      "html_url": "https://github.com/petrochenkov",
      "followers_url": "https://api.github.com/users/petrochenkov/followers",
      "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}",
      "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions",
      "organizations_url": "https://api.github.com/users/petrochenkov/orgs",
      "repos_url": "https://api.github.com/users/petrochenkov/repos",
      "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petrochenkov/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-13T02:02:03Z",
    "updated_at": "2015-10-13T02:12:07Z",
    "body": "@peter-bertok \nI'm not especially eager to argue here, because I'd prefer indexing with everything except for `usize`, and especially with signed types, to be a compile time error, like now.\nNonetheless, discerning between the kinds of produced panic or relying on them seems very strange. Internally `Index` will have to cast the argument to `usize` anyway, so the panic won't necessary be an \"out of bounds panic\" in all cases. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/147573487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/147580143",
    "html_url": "https://github.com/rust-lang/rust/issues/29010#issuecomment-147580143",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29010",
    "id": 147580143,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NzU4MDE0Mw==",
    "user": {
      "login": "peter-bertok",
      "id": 14988123,
      "node_id": "MDQ6VXNlcjE0OTg4MTIz",
      "avatar_url": "https://avatars.githubusercontent.com/u/14988123?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/peter-bertok",
      "html_url": "https://github.com/peter-bertok",
      "followers_url": "https://api.github.com/users/peter-bertok/followers",
      "following_url": "https://api.github.com/users/peter-bertok/following{/other_user}",
      "gists_url": "https://api.github.com/users/peter-bertok/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/peter-bertok/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/peter-bertok/subscriptions",
      "organizations_url": "https://api.github.com/users/peter-bertok/orgs",
      "repos_url": "https://api.github.com/users/peter-bertok/repos",
      "events_url": "https://api.github.com/users/peter-bertok/events{/privacy}",
      "received_events_url": "https://api.github.com/users/peter-bertok/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-13T02:49:37Z",
    "updated_at": "2015-10-13T02:52:56Z",
    "body": "@petrochenkov\nIt's strange _now_, but the reality is that the try-catch (panic-catch in Rust terms) paradigm is virtually unavoidable in the long term. How else do you propose developers handle out-of-bounds errors without doubling up on bounds checking? The compiler does it anyway, so why not catch the panic and handle the error, instead of just blowing up the thread and/or program?\n\nThis is a common pattern in other safe languages, such as C# or Java:\n\n``` C#\ntry {\n   ... complex array code for, say, decoding a packet...\n} catch( IndexOutOfRangeException )\n{\n    return ... \"invalid data format\"...;\n}\n```\n\nThis is _almost_ possible with (nightly) Rust, with the only minor issue that panic isn't strongly typed:\n\n``` rust\n#![feature(catch_panic)]\nfn test( i: usize ) -> i32 {\n    let data = [0i32;10];\n    data[i]\n}\n\nfn main() {\n    match std::thread::catch_panic( || test( 50 ) ) {\n        Ok(n) => println!( \"{:?}\", n ),\n        Err(e) => println!(  \"{:?}\", e )\n    }\n}\n```\n\nUnless I'm missing something, the current design for error handling in Rust has a number of gaps:\n- To handle panics without crashing the whole program, dedicated threads are required (stable Rust).\n- Even with the nightly builds, there is no way to differentiate between different types of panic!(), as it returns untyped values (`std::any::Any`).\n- The only option available to developers is to double-up on certain checks, such as indexing bounds checks, which is inefficient at best, and makes code much less readable.\n- Panics often return a \"string\", using panic_fmt!(). This means that error messages generated by the compiler will not be internationalisable. Compare with Java/C# Exception-s. It's trivial to do a \"switch\" on the exception type, or have catch(...) blocks return distinct i18n formatted message for each possible exception type. Not everything should be represented by an English string, _particulary_ in a general purpose systems programming language!\n\nI'm of the opinion that this boils down to language design philosophy. Java, C#, C++, and Go all made the mistake of pretending that templates are an optional feature, then tacked them on too late (or not at all), resulting in poorly designed standard libraries, often with two versions of the same interface -- templated and legacy. Those language designs contained a huge mistake that can _never_ be corrected in a backwards-compatible fashion. \n\nThankfully, Rust implemented templates right from the beginning, resulting in a much more elegant standard library. Good!\n\nUnfortunately, the Rust designers made the mistake of pretending that exceptions are optional. They are not. Exception handling is vital to safe, readable, and performant code. Right now, developers have to sacrifice at least some of those features if they want to program in Rust because neither \"Error\" nor \"panic!()\" handle the \"Exception\" case well enough.\n\nError handling with complex return types and try!() has an overhead and results in messy code, while  panic just kills the program, which is a potential denial of service.\n\nHow is Servo expected to decode complex binary protocols _safely_, such as compression formats, without killing the browser when receiving specially crafted malicious input? The compiler-generated panics will kill the thread! So should any code that can potentially cause array-out-of-bounds be run in dedicated threads!? Or should the Servo developers just use `catch_panic`? Then what? What error can they report apart from a meaningless \"it failed\" OR a meaningful but english only message?\n\nIdeally, I'd love to see Rust embrace [Scoped Continuations](http://blog.paralleluniverse.co/2015/08/07/scoped-continuations/), which is a language design that is a superset of Monads and Try-Catch exception handling. It would make it possible to write type-safe error handling that is much more powerful than the current Monadic-style that is better suited to pure functional languages.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/147580143/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/147648212",
    "html_url": "https://github.com/rust-lang/rust/issues/29010#issuecomment-147648212",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29010",
    "id": 147648212,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NzY0ODIxMg==",
    "user": {
      "login": "oli-obk",
      "id": 332036,
      "node_id": "MDQ6VXNlcjMzMjAzNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/oli-obk",
      "html_url": "https://github.com/oli-obk",
      "followers_url": "https://api.github.com/users/oli-obk/followers",
      "following_url": "https://api.github.com/users/oli-obk/following{/other_user}",
      "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions",
      "organizations_url": "https://api.github.com/users/oli-obk/orgs",
      "repos_url": "https://api.github.com/users/oli-obk/repos",
      "events_url": "https://api.github.com/users/oli-obk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/oli-obk/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-13T08:37:58Z",
    "updated_at": "2015-10-13T08:37:58Z",
    "body": "I think you are steering off course of this issue. This issue is about the arguments the Index types take. If you want to discuss exception handling I suggest you join the discussion: https://github.com/rust-lang/rfcs/pull/243\n\n> Error handling with complex return types and try!() has an overhead\n\nPlease provide measurable evidence ;)\n\n> and results in messy code,\n\nHave you seen Java Code handling exceptions?\n\n> while panic just kills the program, which is a potential denial of service.\n\nThe point of panic is that it should never occur. Any time you index into an array you are \"guaranteeing\" that the index is in the range. If it's not, it's a bug in your code. If you want to check and change behavior depending on whether an index is in range, add a check or use a method like `get`.\n\n>  The compiler does it anyway,\n\nYes it does, and if you also do it, one of the two checks gets optimized out. Often times both get optimized out if llvm figures out that neither check is necessary.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/147648212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/151381505",
    "html_url": "https://github.com/rust-lang/rust/issues/29010#issuecomment-151381505",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/29010",
    "id": 151381505,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MTM4MTUwNQ==",
    "user": {
      "login": "Aatch",
      "id": 342416,
      "node_id": "MDQ6VXNlcjM0MjQxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aatch",
      "html_url": "https://github.com/Aatch",
      "followers_url": "https://api.github.com/users/Aatch/followers",
      "following_url": "https://api.github.com/users/Aatch/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions",
      "organizations_url": "https://api.github.com/users/Aatch/orgs",
      "repos_url": "https://api.github.com/users/Aatch/repos",
      "events_url": "https://api.github.com/users/Aatch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aatch/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-10-27T05:41:11Z",
    "updated_at": "2015-10-27T05:41:11Z",
    "body": "Regardless of opinions, this change would require an RFC. Feel free to open an issue (or better yet, an actual RFC) over on https://github.com/rust-lang/rfcs if you want to continue this discussion.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/151381505/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
