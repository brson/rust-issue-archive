[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101460791",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101460791",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101460791,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTQ2MDc5MQ==",
    "user": {
      "login": "rillian",
      "id": 225102,
      "node_id": "MDQ6VXNlcjIyNTEwMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/225102?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rillian",
      "html_url": "https://github.com/rillian",
      "followers_url": "https://api.github.com/users/rillian/followers",
      "following_url": "https://api.github.com/users/rillian/following{/other_user}",
      "gists_url": "https://api.github.com/users/rillian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rillian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rillian/subscriptions",
      "organizations_url": "https://api.github.com/users/rillian/orgs",
      "repos_url": "https://api.github.com/users/rillian/repos",
      "events_url": "https://api.github.com/users/rillian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rillian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-12T23:41:20Z",
    "updated_at": "2015-05-12T23:41:20Z",
    "body": "Note that this blocks shipping rust code in Firefox.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101460791/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101675562",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101675562",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101675562,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTY3NTU2Mg==",
    "user": {
      "login": "larsbergstrom",
      "id": 475847,
      "node_id": "MDQ6VXNlcjQ3NTg0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/475847?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/larsbergstrom",
      "html_url": "https://github.com/larsbergstrom",
      "followers_url": "https://api.github.com/users/larsbergstrom/followers",
      "following_url": "https://api.github.com/users/larsbergstrom/following{/other_user}",
      "gists_url": "https://api.github.com/users/larsbergstrom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/larsbergstrom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/larsbergstrom/subscriptions",
      "organizations_url": "https://api.github.com/users/larsbergstrom/orgs",
      "repos_url": "https://api.github.com/users/larsbergstrom/repos",
      "events_url": "https://api.github.com/users/larsbergstrom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/larsbergstrom/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-13T14:08:38Z",
    "updated_at": "2015-05-13T14:08:38Z",
    "body": "cc @alexcrichton @brson @nikomatsakis \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101675562/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101796473",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101796473",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101796473,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTc5NjQ3Mw==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-13T19:59:09Z",
    "updated_at": "2015-05-13T19:59:09Z",
    "body": "I've discussed this with @brson a bit and the conclusion was that the best way forward is likely to:\n- Don't change the standard library by default, continue saying that Rust requires OSX 10.7+\n- Add a `./configure` option to building Rust itself to enable 10.6 support\n- When building the standard library with this `./configure` option the TLS support of the standard library will use pthread-based TLS, fixing this incompatibility.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101796473/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101798357",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101798357",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101798357,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTc5ODM1Nw==",
    "user": {
      "login": "richo",
      "id": 476418,
      "node_id": "MDQ6VXNlcjQ3NjQxOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/476418?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/richo",
      "html_url": "https://github.com/richo",
      "followers_url": "https://api.github.com/users/richo/followers",
      "following_url": "https://api.github.com/users/richo/following{/other_user}",
      "gists_url": "https://api.github.com/users/richo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/richo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/richo/subscriptions",
      "organizations_url": "https://api.github.com/users/richo/orgs",
      "repos_url": "https://api.github.com/users/richo/repos",
      "events_url": "https://api.github.com/users/richo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/richo/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-13T20:05:01Z",
    "updated_at": "2015-05-13T20:05:01Z",
    "body": "Is that going to create a testing nightmare? Does firefox have a slated EOL\ndate for 10.6 support?\n\n(Sorry to lurk in)\n\nOn Wed, May 13, 2015 at 12:59 PM, Alex Crichton notifications@github.com\nwrote:\n\n> I've discussed this with @brson https://github.com/brson a bit and the\n> conclusion was that the best way forward is likely to:\n> - Don't change the standard library by default, continue saying that\n>   Rust requires OSX 10.7+\n> - Add a ./configure option to building Rust itself to enable 10.6\n>   support\n> - When building the standard library with this ./configure option the\n>   TLS support of the standard library will use pthread-based TLS, fixing this\n>   incompatibility.\n> \n> \u2014\n> Reply to this email directly or view it on GitHub\n> https://github.com/rust-lang/rust/issues/25342#issuecomment-101796473.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101798357/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101801453",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101801453",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101801453,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTgwMTQ1Mw==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-13T20:13:05Z",
    "updated_at": "2015-05-13T20:13:05Z",
    "body": "@richo Rust will continue to not officially support OSX 10.6, so we will not be running automated tests. We will, however, accept patches for compatibility.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101801453/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101802486",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101802486",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101802486,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTgwMjQ4Ng==",
    "user": {
      "login": "larsbergstrom",
      "id": 475847,
      "node_id": "MDQ6VXNlcjQ3NTg0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/475847?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/larsbergstrom",
      "html_url": "https://github.com/larsbergstrom",
      "followers_url": "https://api.github.com/users/larsbergstrom/followers",
      "following_url": "https://api.github.com/users/larsbergstrom/following{/other_user}",
      "gists_url": "https://api.github.com/users/larsbergstrom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/larsbergstrom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/larsbergstrom/subscriptions",
      "organizations_url": "https://api.github.com/users/larsbergstrom/orgs",
      "repos_url": "https://api.github.com/users/larsbergstrom/repos",
      "events_url": "https://api.github.com/users/larsbergstrom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/larsbergstrom/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-13T20:15:05Z",
    "updated_at": "2015-05-13T20:15:05Z",
    "body": "@alexcrichton Are you sure you want that? I was sort of hoping that, at least for as long as we can, we would try to use the actual Rust stable released binaries in Gecko, until we start pulling in libraries from Servo that require unstable features or want to cross-compile.\n\nI'm certainly not against having Gecko, say, use the same Rust compiler snapshots that we use in Servo, but didn't want to go down that road unless we had to, to discourage people from writing code that uses nightly/unstable features.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101802486/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101805690",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101805690",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101805690,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTgwNTY5MA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-13T20:27:23Z",
    "updated_at": "2015-05-13T20:27:23Z",
    "body": "@larsbergstrom it's definitely a bit nuanced, but there are a number of reasons I believe Gecko wants its own build of Rust right now (at least for building releases):\n- Gecko wants to disable jemalloc in Rust (it's enabled on all distributions by default right now)\n- Gecko probably wants to disable segmented stacks in the standard library (it's not using them at all)\n- Gecko probably wants to disable unwinding in the standard library (e.g. trigger an abort)\n\nAll of these are planned future extensions to the Rust distribution itself, but not all of these are implemented today.\n\nSpecifically on the topic of TLS, however, this isn't a feature that we can do runtime detection and have a \"fast path\" and a \"slow path\" both built in. Using the \"fast path\" of TLS is a compile-time decision, so when you compile the _standard library_ you have to declare whether you want it to target 10.6 or 10.7+. We currently do not have a great way of managing this sort of versioned compilation (hence the hard requirement for 10.7+).\n\nI think it can also work in Gecko to only require a custom build of Rust for the distribution bots instead of all developers. For example I doubt anyone's still developing Gecko seriously on OSX 10.6, so the stable releases should work just fine for that purpose. In that sense all developers of Gecko can just use a normal stable release (e.g. installed on the system), and the release process would just have to be tweaked a bit.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101805690/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101806136",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101806136",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101806136,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTgwNjEzNg==",
    "user": {
      "login": "larsbergstrom",
      "id": 475847,
      "node_id": "MDQ6VXNlcjQ3NTg0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/475847?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/larsbergstrom",
      "html_url": "https://github.com/larsbergstrom",
      "followers_url": "https://api.github.com/users/larsbergstrom/followers",
      "following_url": "https://api.github.com/users/larsbergstrom/following{/other_user}",
      "gists_url": "https://api.github.com/users/larsbergstrom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/larsbergstrom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/larsbergstrom/subscriptions",
      "organizations_url": "https://api.github.com/users/larsbergstrom/orgs",
      "repos_url": "https://api.github.com/users/larsbergstrom/repos",
      "events_url": "https://api.github.com/users/larsbergstrom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/larsbergstrom/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-13T20:29:37Z",
    "updated_at": "2015-05-13T20:29:37Z",
    "body": "@alexcrichton Sounds reasonable to me. I just didn't want to go down the private-Rust-builds path without making sure the team was cool with that. \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101806136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101807513",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101807513",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101807513,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTgwNzUxMw==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-13T20:37:17Z",
    "updated_at": "2015-05-13T20:37:17Z",
    "body": "@larsbergstrom yeah makes sense, I can definitely see where it's a huge pain to have to deal with. In terms of a quick solution having a `./configure` option for \"let's target OSX 10.6\" is probably the best, and longer-term solutions may, well, take longer, and also be more complicated. I would prefer a proper solution, for example, to the other problems (below), but they'll take time:\n- Remove segmented stacks in favor of stack probes, much less overhead and also no runtime support needed\n- Remove libstd's hardwired dependency on jemalloc, instead have the compiler inject it as late as possible and otherwise just bind the malloc/free functions in the standard library. This means that you won't have to recompile Rust to get it to target something other than jemalloc.\n- Teach Gecko to LTO for releases which will allow Gecko to strip all unwinding in a release build, removing the code bloat.\n\nAt this time I unfortunately don't know of a way to compile the standard library for 10.7+ and retroactively go back and rewrite the TLS accesses to use a 10.6 compatible scheme, but that's not to say one won't come to mind!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101807513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101849963",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101849963",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101849963,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTg0OTk2Mw==",
    "user": {
      "login": "rillian",
      "id": 225102,
      "node_id": "MDQ6VXNlcjIyNTEwMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/225102?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rillian",
      "html_url": "https://github.com/rillian",
      "followers_url": "https://api.github.com/users/rillian/followers",
      "following_url": "https://api.github.com/users/rillian/following{/other_user}",
      "gists_url": "https://api.github.com/users/rillian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rillian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rillian/subscriptions",
      "organizations_url": "https://api.github.com/users/rillian/orgs",
      "repos_url": "https://api.github.com/users/rillian/repos",
      "events_url": "https://api.github.com/users/rillian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rillian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-13T23:40:14Z",
    "updated_at": "2015-05-13T23:40:14Z",
    "body": "@alexcrichton, isn't this just pushing the pain back onto gecko? Making every MacOS X developer add --enable-macos-target=10.7 to their gecko build is better than having to install a custom rust build, but still pretty painful. And then you're further from the configuration the integration servers use, which is currently pretty close on Mac.\n\nHaving an explicit configure switch for rustc would at least make it more obvious what's going on.\n\n> At this time I unfortunately don't know of a way to compile the standard library for 10.7+ and retroactively go back and rewrite the TLS accesses to use a 10.6 compatible scheme, but that's not to say one won't come to mind!\n\nIs there an llvm optimizer we could run to strip out the thread local functions if they're not used by the input code? Or is the unwind stuff you mentioned what's keeping it alive in the first place?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101849963/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101863070",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101863070",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101863070,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTg2MzA3MA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-14T00:22:24Z",
    "updated_at": "2015-05-14T00:22:24Z",
    "body": "@rillian \n\n> isn't this just pushing the pain back onto gecko?\n\nUnfortunately yeah this would be pushing some logic down onto Gecko's build system. I figured it wouldn't be too hard to pass the 10.7 argument on most OSX builds (except the integration servers), but I can see where having the two be configured closely is nice!\n\n> Having an explicit configure switch for rustc would at least make it more obvious what's going on.\n\nUnfortunately this would entail shipping an entirely separate copy of the standard library by default, which is a pretty big step to take for this minor issue.\n\n> Is there an llvm optimizer we could run to strip out the thread local functions if they're not used by the input code? \n\nWe could in theory write a pass such as this perhaps (this does not exist in any form that I know of), but it would require that _all_ builds on OSX for rust be compiled with LTO (to be able to retroactively modify code) which can be quite slow, especially for development.\n\n> Or is the unwind stuff you mentioned what's keeping it alive in the first place?\n\nNah the unwind stuff is orthogonal to the TLS stuff, there's a pretty hard dependency on OS-based TLS which we can't sever.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101863070/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101916736",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-101916736",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 101916736,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTkxNjczNg==",
    "user": {
      "login": "rillian",
      "id": 225102,
      "node_id": "MDQ6VXNlcjIyNTEwMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/225102?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rillian",
      "html_url": "https://github.com/rillian",
      "followers_url": "https://api.github.com/users/rillian/followers",
      "following_url": "https://api.github.com/users/rillian/following{/other_user}",
      "gists_url": "https://api.github.com/users/rillian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rillian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rillian/subscriptions",
      "organizations_url": "https://api.github.com/users/rillian/orgs",
      "repos_url": "https://api.github.com/users/rillian/repos",
      "events_url": "https://api.github.com/users/rillian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rillian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-14T05:26:32Z",
    "updated_at": "2015-05-14T05:26:32Z",
    "body": "Another angle is to improve rustc's support for external runtime linkage. If we could use --emit obj and have gecko's build system link to a separate build of libstd without tls, that would be lighter weight than needing a special toolchain.\n\nIs that more promising? I tried that approach first, but couldn't find a well-defined reference the runtime, and link always died looking for llvm's __morestack, so I switched to using the staticlib output.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/101916736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102102103",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-102102103",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 102102103,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjEwMjEwMw==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-14T16:56:45Z",
    "updated_at": "2015-05-14T16:56:45Z",
    "body": "@rillian my [comment here](https://bugzilla.mozilla.org/show_bug.cgi?id=1163224#c3) may explain why using `--emit obj` is somewhat difficult, but there's also the problem of ABI instability. The compiler currently cannot link to a standard library that was produced by another compiler revision due to the ABI changing over time, so you'd have to mandate that all Rust compilers are the same revision as the one which built libstd without TLS.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102102103/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102112354",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-102112354",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 102112354,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjExMjM1NA==",
    "user": {
      "login": "rillian",
      "id": 225102,
      "node_id": "MDQ6VXNlcjIyNTEwMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/225102?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rillian",
      "html_url": "https://github.com/rillian",
      "followers_url": "https://api.github.com/users/rillian/followers",
      "following_url": "https://api.github.com/users/rillian/following{/other_user}",
      "gists_url": "https://api.github.com/users/rillian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rillian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rillian/subscriptions",
      "organizations_url": "https://api.github.com/users/rillian/orgs",
      "repos_url": "https://api.github.com/users/rillian/repos",
      "events_url": "https://api.github.com/users/rillian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rillian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-14T17:36:14Z",
    "updated_at": "2015-05-14T17:36:14Z",
    "body": "Thanks @alexcrichton, I hadn't seen your reply to the gecko --emit=obj bug.\n\nMatching ABI doesn't introduce a different requirement from needing a pthread-tls toolchain, but I guess the failure mode is different. Is there something to always reject linking mis-matched ABI objects, or is it like C++ ABI skew where one only finds some problems at runtime?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102112354/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/104078847",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-104078847",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 104078847,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNDA3ODg0Nw==",
    "user": {
      "login": "rillian",
      "id": 225102,
      "node_id": "MDQ6VXNlcjIyNTEwMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/225102?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rillian",
      "html_url": "https://github.com/rillian",
      "followers_url": "https://api.github.com/users/rillian/followers",
      "following_url": "https://api.github.com/users/rillian/following{/other_user}",
      "gists_url": "https://api.github.com/users/rillian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rillian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rillian/subscriptions",
      "organizations_url": "https://api.github.com/users/rillian/orgs",
      "repos_url": "https://api.github.com/users/rillian/repos",
      "events_url": "https://api.github.com/users/rillian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rillian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-21T00:26:02Z",
    "updated_at": "2015-05-21T00:26:02Z",
    "body": "I've moved gecko tracking of this issue to https://bugzilla.mozilla.org/show_bug.cgi?id=1166996\n\nIn the interest of making progress here, can we request a configuration switch for rustc to enable support for 10.6 from the rust team? I know how to add configure switches but not how to stub out or replace the std::thread functions. I can then build and upload a custom toolchain to use on mac, which would let us ship.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/104078847/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/104092429",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-104092429",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 104092429,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNDA5MjQyOQ==",
    "user": {
      "login": "glandium",
      "id": 1038527,
      "node_id": "MDQ6VXNlcjEwMzg1Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1038527?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glandium",
      "html_url": "https://github.com/glandium",
      "followers_url": "https://api.github.com/users/glandium/followers",
      "following_url": "https://api.github.com/users/glandium/following{/other_user}",
      "gists_url": "https://api.github.com/users/glandium/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glandium/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glandium/subscriptions",
      "organizations_url": "https://api.github.com/users/glandium/orgs",
      "repos_url": "https://api.github.com/users/glandium/repos",
      "events_url": "https://api.github.com/users/glandium/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glandium/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-21T01:53:34Z",
    "updated_at": "2015-05-21T01:53:34Z",
    "body": "Xcode toolchains (gcc in the past, and now clang) allow developers to change what minimum version of OSX the build binary is going to support by setting the MACOSX_DEPLOYMENT_TARGET. It would make sense for the rust compiler to do the same, and switch TLS implementations depending on its value or lack thereof. There also is a -mmacosx-version-min build flag for gcc/clang with the same meaning as the MACOSX_DEPLOYMENT_TARGET environment variable.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/104092429/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106505368",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-106505368",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 106505368,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjUwNTM2OA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-28T17:24:14Z",
    "updated_at": "2015-05-28T17:24:14Z",
    "body": "@glandium oh sorry for not responding sooner, but thanks for the info! Perhaps the compiler could detect MACOSX_DEPLOYMENT_TARGET and set some form of `#[cfg]` based on this, but it would unfortunately still mean that the standard library itself needs to be either always compiled for 10.6 (e.g. using slower TLS) or it must be recompiled to target 10.6. I think for now so long as Gecko is OK using a custom build of Rust that we'll stick to \"officially supporting\" 10.7+, but if it becomes too much of a pain we can possibly reconsider!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106505368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106527470",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-106527470",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 106527470,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjUyNzQ3MA==",
    "user": {
      "login": "rillian",
      "id": 225102,
      "node_id": "MDQ6VXNlcjIyNTEwMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/225102?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rillian",
      "html_url": "https://github.com/rillian",
      "followers_url": "https://api.github.com/users/rillian/followers",
      "following_url": "https://api.github.com/users/rillian/following{/other_user}",
      "gists_url": "https://api.github.com/users/rillian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rillian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rillian/subscriptions",
      "organizations_url": "https://api.github.com/users/rillian/orgs",
      "repos_url": "https://api.github.com/users/rillian/repos",
      "events_url": "https://api.github.com/users/rillian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rillian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-28T17:53:29Z",
    "updated_at": "2015-05-28T17:53:29Z",
    "body": "For parity with clang and gcc, the rustc build would need to make a version of libstd with both values of the #[cfg] and choose between them at runtime. That's the best suggestion I've heard so far, but the custom toolchain build option will at least unblock gecko.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106527470/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106531644",
    "html_url": "https://github.com/rust-lang/rust/issues/25342#issuecomment-106531644",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25342",
    "id": 106531644,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjUzMTY0NA==",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-28T17:58:12Z",
    "updated_at": "2015-05-28T17:58:12Z",
    "body": "Yeah if we wanted to officially support 10.6 then I think we'd do something like:\n- Always compile the standard library targeting 10.6 for OSX\n- Detect `MACOSX_DEPLOYMENT_TARGET` and provide an appropriate `#[cfg]` from the compiler\n- Use this `#[cfg]` when defining a thread local variable to select between fast TLS and pthread TLS at compile-time. \n\nRight now I think we don't want to do the first bullet point, but times may change!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/106531644/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
