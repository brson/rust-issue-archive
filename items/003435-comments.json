[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8404029",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8404029",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8404029,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDQwMjk=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-09T14:20:24Z",
    "updated_at": "2012-09-09T14:20:24Z",
    "body": "Here is the test case. Note that the unit test function actually runs the real test ten times (the real test fails about half the time).\n\n```\n// rustc --test sleep.rs && ./sleep\nuse std;\n\nenum StateMesg\n{\n    AddListener(~str, comm::Chan<int>),    // str is used to identify the listener\n    RemoveListener(~str),\n    Shutdown,\n}\n\ntype StateChan = comm::Chan<StateMesg>;\n\n// Task used to maintain an uptime (in seconds) variable.\nfn manage_state() -> StateChan\n{\n    do task::spawn_listener\n    |state_port: comm::Port<StateMesg>|\n    {\n        let mut time = 0;\n        let listeners = std::map::box_str_hash();\n        loop\n        {\n            time += 1;\n            info!(\"time = %?\", time);\n            libc::funcs::posix88::unistd::sleep(1);\n            for listeners.each_value |ch| {comm::send(ch, copy(time))};\n\n            if state_port.peek()\n            {\n                match state_port.recv()\n                {\n                    AddListener(key, ch) =>\n                    {\n                        let added = listeners.insert(@(copy key), ch);\n                        assert added;\n                    }\n                    RemoveListener(key) =>\n                    {\n                        listeners.remove(@(copy key));\n                    }\n                    Shutdown =>\n                    {\n                        break;\n                    }\n                }\n            }\n        }\n    }\n}\n\nenum ControlEvent\n{\n    CloseEvent,\n}\n\ntype ControlPort = comm::Port<ControlEvent>;\ntype ControlChan = comm::Chan<ControlEvent>;\n\ntype PushChan = comm::Chan<int>;\n\n// Registers with the manage task and gets notified when uptime changes.\n// This is where things go south: we try to start three of these tasks, but\n// only two start up (although after running multiple times it seems that\n// there are some failues where all of these tasks start).\nfn uptime_sse(registrar: StateChan, push: PushChan) -> ControlChan\n{\n    do task::spawn_listener\n    |control_port: ControlPort|\n    {\n        io::println(fmt!(\"starting uptime sse stream\"));\n        let notify_port = comm::Port();\n        let notify_chan = comm::Chan(notify_port);\n\n        let key = fmt!(\"uptime %?\", ptr::addr_of(notify_port));\n        comm::send(registrar, AddListener(copy key, notify_chan));\n\n        loop\n        {\n            match comm::select2(notify_port, control_port)\n            {\n                either::Left(new_time) =>\n                {\n                    info!(\"   new_time = %?\", new_time);\n                    comm::send(push, new_time);\n                }\n                either::Right(CloseEvent) =>\n                {\n                    info!(\"shutting down uptime sse stream\");\n                    comm::send(registrar, RemoveListener(key));\n                    break;\n                }\n            }\n        }\n    }\n}\n\n// These are tasks that just sit around doing nothing. (I was not able to get a\n// failure without these).\nfn blocked_task() -> StateChan\n{\n    do task::spawn_listener\n    |state_port: comm::Port<StateMesg>|\n    {\n        info!(\"starting blocked\");\n        loop\n        {\n            match state_port.recv()\n            {\n                Shutdown =>\n                {\n                    break;\n                }\n                _ =>\n                {\n                }\n            }\n        }\n    }\n}\n\n// Number of  listener and blocked tasks to start up. May be able to reduce these values\n// and still get a failure.\nconst num_listeners: uint = 3;\nconst num_blocked: uint = 12;\n\nfn run_test() -> bool\n{\n    // Startup the task to manage the uptime variable.\n    let registrar = manage_state();\n\n    // Startup some tasks that block on recv until the very end of the test.\n    // This corresponds to worker tasks in my app.\n    info!(\"starting %? blocked tasks\", num_blocked);\n    let mut blocked = ~[];\n    for num_blocked.times\n    {\n        let control = blocked_task();\n        vec::push(blocked, control);\n    }\n\n    // Tasks that listen for changes in uptime. In my real (test) app it failed with\n    //  one of these and it uses a server sent event to push the new uptime to a web\n    // page.\n    io::println(fmt!(\"starting %? uptime tasks\", num_listeners));\n    let mut listeners = ~[];\n    for num_listeners.times\n    {\n        let push_port = comm::Port();\n        let push_chan = comm::Chan(push_port);\n\n        let control = uptime_sse(registrar, push_chan);\n        vec::push(listeners, (push_port, control));\n    }\n\n    // Give the listeners plenty of time to get at least one update.\n    // Note that this fails in the same way even if we sleep a lot longer.\n    libc::funcs::posix88::unistd::sleep((5*num_listeners + 3) as libc::types::os::arch::c95::c_uint);\n\n    // Print the uptimes received by each listener task.\n    let mut times = ~[];\n    for listeners.eachi\n    |i, comms|\n    {\n        let (push_port, _control_chan) = comms;\n\n        let mut last_time = 0;\n        while (push_port.peek())\n        {\n            let time = push_port.recv();\n            info!(\"   %? received = %?\", i, time);\n            if time > last_time\n            {\n                last_time = time;\n            }\n        }\n        vec::push(times, last_time);\n    }\n\n    // Close down the tasks.\n    for blocked.each\n    |state_chan|\n    {\n        comm::send(state_chan, Shutdown)\n    }\n\n    for listeners.eachi\n    |i, comms|\n    {\n        let (_push_port, control_chan) = comms;\n        io::println(fmt!(\"%? time = %?\", i, times[i]));\n        comm::send(control_chan, CloseEvent)\n    }\n\n    comm::send(registrar, Shutdown);\n\n    // Each listener should have received at least one update.\n    do times.all |t| {t > 0}\n}\n\n// Only use a single unit test function to avoid interactions with running multiple unit tests\n// in parallel (which could be an issue if this is dropped into the rust test suite).\n#[test]\nfn tester()\n{\n    // Ran this three times with the following results:\n    // 5 out of 10 failed\n    // 4 out of 10 failed\n    // 7 out of 10 failed\n    let num_tests = 10;\n    let mut num_failures = 0;\n\n    for num_tests.timesi\n    |i|\n    {\n        io::println(fmt!(\"\\nrunning %? of %?\", i+1, num_tests));\n        if !run_test()\n        {\n            num_failures += 1;\n        }\n    }\n\n    if num_failures > 0\n    {\n        io::println(fmt!(\"%? tests out of %? failed\", num_failures, num_tests));\n        assert false;\n    }\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8404029/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8404105",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8404105",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8404105,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDQxMDU=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-09T14:29:13Z",
    "updated_at": "2012-09-09T14:29:13Z",
    "body": "Fwiw I was able to run the test case from #2841 five times with no failures.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8404105/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8405623",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8405623",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8405623,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDU2MjM=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-09T17:22:16Z",
    "updated_at": "2012-09-09T17:22:16Z",
    "body": "Got the above to work by changing uptime_sse to use `do spawn_threaded_listener(2)` where spawn_threaded_listener is defined as:\n\n```\n// Like spawn_listener except the new task (and whatever tasks it spawns) are distributed\n// among a fixed number of OS threads.\nfn spawn_threaded_listener<A:send>(num_threads: uint, +block: fn~ (comm::Port<A>)) -> comm::Chan<A>\n{\n    let channel_port: comm::Port<comm::Chan<A>> = comm::Port();\n    let channel_channel = comm::Chan(channel_port);\n\n    do task::spawn_sched(task::ManualThreads(num_threads))\n    {\n        let task_port: comm::Port<A> = comm::Port();\n        let task_channel = comm::Chan(task_port);\n        comm::send(channel_channel, task_channel);\n\n        block(task_port);\n    };\n\n    comm::recv(channel_port)\n}\n```\n\nWhich is the same sort of work around I had to use with #2841.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8405623/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8409530",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8409530",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8409530,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDk1MzA=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-09T21:26:52Z",
    "updated_at": "2012-09-09T21:26:52Z",
    "body": "Thanks for the good report. I haven't been able to reproduce the deadlock yet but note that\n\n```\n    // Give the listeners plenty of time to get at least one update.\n    // Note that this fails in the same way even if we sleep a lot longer.\n    libc::funcs::posix88::unistd::sleep((5*num_listeners + 3) as libc::types::os::arch::c95::c_uint);\n```\n\nProbably doesn't behave like you want. This won't necessarily give the listeners an 'opportunity to get at least one update'. `sleep` will block a scheduler thread, preventing any other tasks scheduled on that thread from running, so if the tasks necessary to create and receive that update are on the blocked thread then they won't make the expected progress. (This is a partly a side-effect of not having a work-stealing implementation yet, but even on e.g. a 4-core machine having 4 tasks calling libc sleep in parallel will stop all progress).\n\nIs the sleeping critical to the functioning of the test?\n\nYou might want to experiment with this non-blocking sleep:\n\n```\nfn sleep(s: uint) {\n    let iotask = std::uv::global_loop::get();\n    std::timer::sleep(iotask, s * 1000);\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8409530/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8409548",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8409548",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8409548,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDk1NDg=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-09T21:28:09Z",
    "updated_at": "2012-09-09T21:28:55Z",
    "body": "I suggest always using the above sleep. Calling libc sleep, even if it works, is going to be bad for throughput.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8409548/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8409677",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8409677",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8409677,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDk2Nzc=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-09T21:40:05Z",
    "updated_at": "2012-09-09T21:40:05Z",
    "body": "Only two tasks call sleep: the manage_state task and the unit test task that calls the tester function. The [test app](https://github.com/jesse99/rwebserve/blob/master/server/src/main.rs) uses the first sleep, the second sleep is an artifact of trying to repro the failure in a unit test.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8409677/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8409745",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8409745",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8409745,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDk3NDU=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-09T21:46:16Z",
    "updated_at": "2012-09-09T21:46:16Z",
    "body": "On my machine the test did pass when I used brson's sleep function. The number of updates each task received was also way more consistent with the uv sleep.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8409745/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8409813",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8409813",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8409813,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDk4MTM=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-09T21:52:48Z",
    "updated_at": "2012-09-09T21:52:48Z",
    "body": "But my [test app](https://github.com/jesse99/rwebserve/blob/master/server/src/main.rs) still hangs when I try to use uv sleep (nearly certain that the app and all the user libraries it uses just have the one sleep call).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8409813/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8424011",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8424011",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8424011,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MjQwMTE=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-10T13:50:18Z",
    "updated_at": "2012-09-10T13:50:18Z",
    "body": "Thought about this some more and I better understand your point about the badness of libc::sleep. For example, one failure mode would be if both the unit test task and the manage_state task wound up on the thread. Then the unit_test task could do the big sleep potentially blocking the manage_state task. When the unit_test finally stops sleeping the manage_state task would not have nearly enough time to finish its work.\n\nThis is likely the same problem with my test app: it's a web server with two tasks listening for incoming connections (on different interfaces) and one or more tasks handling requests for a connection. This is using the old rust-socket library which doesn't do anything fancy with scheduling and two of those tasks are pretty much always blocked which could easily hose other tasks.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8424011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8434202",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8434202",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8434202,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MzQyMDI=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-10T19:00:39Z",
    "updated_at": "2012-09-10T19:00:39Z",
    "body": "That's right. Any task using rust-socket should probably have it's own single-threaded scheduler.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8434202/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8445015",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8445015",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8445015,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDUwMTU=",
    "user": {
      "login": "bblum",
      "id": 1820515,
      "node_id": "MDQ6VXNlcjE4MjA1MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bblum",
      "html_url": "https://github.com/bblum",
      "followers_url": "https://api.github.com/users/bblum/followers",
      "following_url": "https://api.github.com/users/bblum/following{/other_user}",
      "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bblum/subscriptions",
      "organizations_url": "https://api.github.com/users/bblum/orgs",
      "repos_url": "https://api.github.com/users/bblum/repos",
      "events_url": "https://api.github.com/users/bblum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bblum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-11T02:18:41Z",
    "updated_at": "2012-09-11T02:18:41Z",
    "body": "Is the hang nondeterministic? Can you add print statements to see where they are hanging? Are you convinced that the test code _shouldn't_ hang?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8445015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8445137",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8445137",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8445137,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDUxMzc=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-11T02:27:53Z",
    "updated_at": "2012-09-11T02:27:53Z",
    "body": "I think the test should hang...on some systems anyway. I'd like to see some improvements so that other people can avoid the same problems I ran into but those are ticketed separately so I think this issue should be closed.\n\nFor what it's worth I just finished changing over my socket code and the one place I used libc::sleep to use SingleThreaded and then ManualThreads(2) or (4) to spawn subtasks. Still not sure what the default is (ThreadsPerCore is the logical choice but it and ThreadPerTask are not implemented), but my apps are working great now.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8445137/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8445746",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8445746",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8445746,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDU3NDY=",
    "user": {
      "login": "bblum",
      "id": 1820515,
      "node_id": "MDQ6VXNlcjE4MjA1MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bblum",
      "html_url": "https://github.com/bblum",
      "followers_url": "https://api.github.com/users/bblum/followers",
      "following_url": "https://api.github.com/users/bblum/following{/other_user}",
      "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bblum/subscriptions",
      "organizations_url": "https://api.github.com/users/bblum/orgs",
      "repos_url": "https://api.github.com/users/bblum/repos",
      "events_url": "https://api.github.com/users/bblum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bblum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-11T03:08:12Z",
    "updated_at": "2012-09-11T03:08:12Z",
    "body": "huh, the documentation doesn't say what the default is. it's `ThreadsPerCore`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8445746/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8478448",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8478448",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8478448,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0Nzg0NDg=",
    "user": {
      "login": "jesse99",
      "id": 425055,
      "node_id": "MDQ6VXNlcjQyNTA1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/425055?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jesse99",
      "html_url": "https://github.com/jesse99",
      "followers_url": "https://api.github.com/users/jesse99/followers",
      "following_url": "https://api.github.com/users/jesse99/following{/other_user}",
      "gists_url": "https://api.github.com/users/jesse99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jesse99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jesse99/subscriptions",
      "organizations_url": "https://api.github.com/users/jesse99/orgs",
      "repos_url": "https://api.github.com/users/jesse99/repos",
      "events_url": "https://api.github.com/users/jesse99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jesse99/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-12T01:29:51Z",
    "updated_at": "2012-09-12T01:29:51Z",
    "body": "Hmm, when I try to use ThreadPerCore with spawn_sched I get `task failed at 'thread_per_core scheduling mode unimplemented'`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8478448/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8478561",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8478561",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8478561,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0Nzg1NjE=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-12T01:37:58Z",
    "updated_at": "2012-09-12T01:37:58Z",
    "body": "ThreadPerCore is not implemented in the task API, but it is the default mode for the default scheduler. Implementing it though is just a matter of wiring in some existing runtime code.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8478561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8478591",
    "html_url": "https://github.com/rust-lang/rust/issues/3435#issuecomment-8478591",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/3435",
    "id": 8478591,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0Nzg1OTE=",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2012-09-12T01:39:53Z",
    "updated_at": "2012-09-12T01:39:53Z",
    "body": "I opened #3464\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/8478591/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
