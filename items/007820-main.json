{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/7820",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7820/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7820/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7820/events",
  "html_url": "https://github.com/rust-lang/rust/pull/7820",
  "id": 16805485,
  "node_id": "MDExOlB1bGxSZXF1ZXN0Njk1MTQ0MQ==",
  "number": 7820,
  "title": "Add dependence arc from running rustc to its libraries.",
  "user": {
    "login": "pnkfelix",
    "id": 173127,
    "node_id": "MDQ6VXNlcjE3MzEyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pnkfelix",
    "html_url": "https://github.com/pnkfelix",
    "followers_url": "https://api.github.com/users/pnkfelix/followers",
    "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
    "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
    "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
    "repos_url": "https://api.github.com/users/pnkfelix/repos",
    "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 4,
  "created_at": "2013-07-16T11:47:44Z",
  "updated_at": "2014-06-14T00:50:41Z",
  "closed_at": "2013-07-26T22:55:48Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/7820",
    "html_url": "https://github.com/rust-lang/rust/pull/7820",
    "diff_url": "https://github.com/rust-lang/rust/pull/7820.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/7820.patch",
    "merged_at": null
  },
  "body": "r? anyone\n\nFix #8057\n\nThis commit fixes some oversights in the Makefile where rustc could be\ninvoked without some of its dependencies yet in place.  (I encountered\nthe problem in practice; its not just theoretical.)\n\nAs written in Makefile.in, $(STAGE$(1)_T_$(2)_H_$(3)) is the way one\nwrites an invocation of rustc where $(1) is the stage number $(2) is\nthe target triple $(3) is the host triple.  (Other uses of the macro\nmay plug in actual values or different parameters in for those three\nformal parameters.)\n\nWhen you have invocations of $(STAGE...), you need to make sure that\nits dependences are satisfied; otherwise, if someone is using `make\n-jN` for certain (large-ish) `N`, one can encounter situations where\nGNU make attempts to invoke `rustc` before it has actually copied some\nof its libraries into place, such as libmorestack.a, which causes a\nlink failure when the rustc invocation attempts to link in those\nlibraries.\n\nIn this case, the main prerequisite to add is TSREQ$(1)_T_$(2)_H_$(3),\nwhich is described in Makefile.in as \"Prerequisites for using the\nstageN compiler to build target artifacts\"\n\n---\n\nIn addition to adding the extra dependences on TSREQ..., I also\nreplaced occurrences of the pattern:\n\n```\nTSREQ$(1)_T_$(2)_H_$(3)\n$$(TLIB$(1)_T_$(2)_H_$(3))/$(CFG_STDLIB_$(2))\n$$(TLIB$(1)_T_$(2)_H_$(3))/$(CFG_EXTRALIB_$(2))\n```\n\nwith:\n\n```\nSREQ$(1)_T_$(2)_H_$(3)\n```\n\nwhich is equivalent to the above, as defined in Makefile.in\n\n---\n\nFinally, for the cases where TSREQ was missing in tests.mk, I went\nahead and put in a dependence on SREQ rather than just TSREQ, since it\nwas not clear to me how one could expect to compile those cases\nwithout stdlib and extralib.\n\n(It could well be that I should have gone ahead and done the same in\n other cases where I saw TSREQ was missing, and put SREQ in those\n cases as well.  But this seemed like a good measure for now, without\n needing to tax my understanding of the overall makefile\n infrastructure much further.)\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/7820/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7820/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
