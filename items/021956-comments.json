[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73003293",
    "html_url": "https://github.com/rust-lang/rust/issues/21956#issuecomment-73003293",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21956",
    "id": 73003293,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDAzMjkz",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-05T07:03:13Z",
    "updated_at": "2015-02-05T07:03:13Z",
    "body": "This is caused by this line:\n\n``` rust\nimpl <'a> Session <'a> {\n  fn subscription(&'a mut self) -> SubscriptionBuilder <'a> {\n```\n\nUsing the `'a` like that means that the mutable borrow of self lasts for as long as the reference contained in `Session`, while the code is really wanting to just create a new borrow. This is one time where having multiple lifetimes in a type is useful, to forcibly separate a mutable borrow from data it contains.\n\nThis code compiles:\n\n``` rust\nuse std::collections::hash_map::HashMap;\n\npub struct Frame;\n\npub struct Subscription<'a>{\n  subscription_name: &'a str\n}\n\npub struct Session <'a> {\n  subscriptions: HashMap<String, Subscription <'a>>\n}\n\npub struct SubscriptionBuilder <'a, 'sess: 'a> {\n  pub session: &'a mut Session<'sess>,\n  pub frame: Frame,\n  pub subscription: Subscription<'a>\n}\n\nimpl <'sess> Session <'sess> {\n  fn subscription<'b>(&'b mut self) -> SubscriptionBuilder <'b, 'sess> {\n    SubscriptionBuilder{\n      session: self,\n      frame: Frame,\n      subscription: Subscription{subscription_name : \"test\"}\n    }\n  }\n\n  fn do_nothing(&self){\n    // Do nothing.\n  }\n}\n\nimpl <'a, 'sess> SubscriptionBuilder <'a, 'sess> {\n  pub fn create(self) -> String {\n    \"subscription_id\".to_string()\n  }\n}\n\nfn main() {\n    let mut session = Session{subscriptions : HashMap::new()};\n    let sub_id = session.subscription().create();\n    session.do_nothing();\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73003293/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73003348",
    "html_url": "https://github.com/rust-lang/rust/issues/21956#issuecomment-73003348",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21956",
    "id": 73003348,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDAzMzQ4",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-05T07:03:54Z",
    "updated_at": "2015-02-05T07:03:54Z",
    "body": "It's definitely confusing, I wonder if there's some diagnostics we could implement to improve cases like this.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73003348/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73003859",
    "html_url": "https://github.com/rust-lang/rust/issues/21956#issuecomment-73003859",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21956",
    "id": 73003859,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDAzODU5",
    "user": {
      "login": "shadowmint",
      "id": 355760,
      "node_id": "MDQ6VXNlcjM1NTc2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/355760?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shadowmint",
      "html_url": "https://github.com/shadowmint",
      "followers_url": "https://api.github.com/users/shadowmint/followers",
      "following_url": "https://api.github.com/users/shadowmint/following{/other_user}",
      "gists_url": "https://api.github.com/users/shadowmint/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shadowmint/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shadowmint/subscriptions",
      "organizations_url": "https://api.github.com/users/shadowmint/orgs",
      "repos_url": "https://api.github.com/users/shadowmint/repos",
      "events_url": "https://api.github.com/users/shadowmint/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shadowmint/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-05T07:10:15Z",
    "updated_at": "2015-02-05T07:12:42Z",
    "body": "Generally speaking moves can lead to strange borrow results like this (for example, drop(foo); does not release borrows caused by foo), but I was surprised to see that this code in the original still didn't work:\n\n``` rust\nfn main() {\n    let mut session = Session{subscriptions : HashMap::new()};\n    {\n        let sub_id = session.subscription().create();\n    }\n    session.do_nothing();\n}\n```\n\nie. When once the SubscriptionBuilder goes entirely out of the block in which it is created and session is borrowed, the borrow still remains. \n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73003859/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73044921",
    "html_url": "https://github.com/rust-lang/rust/issues/21956#issuecomment-73044921",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21956",
    "id": 73044921,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDQ0OTIx",
    "user": {
      "login": "zslayton",
      "id": 611616,
      "node_id": "MDQ6VXNlcjYxMTYxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/611616?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zslayton",
      "html_url": "https://github.com/zslayton",
      "followers_url": "https://api.github.com/users/zslayton/followers",
      "following_url": "https://api.github.com/users/zslayton/following{/other_user}",
      "gists_url": "https://api.github.com/users/zslayton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zslayton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zslayton/subscriptions",
      "organizations_url": "https://api.github.com/users/zslayton/orgs",
      "repos_url": "https://api.github.com/users/zslayton/repos",
      "events_url": "https://api.github.com/users/zslayton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zslayton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-05T13:22:46Z",
    "updated_at": "2015-02-05T13:22:46Z",
    "body": "That makes complete sense. Thanks, @huonw! I'll leave this issue open for the moment as a discussion space for the diagnostics question.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/73044921/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/192356871",
    "html_url": "https://github.com/rust-lang/rust/issues/21956#issuecomment-192356871",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21956",
    "id": 192356871,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5MjM1Njg3MQ==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-03-04T16:57:02Z",
    "updated_at": "2016-03-04T16:57:02Z",
    "body": "Triage: not aware of any diagnostics changes here. Unsure what we can do, though it's not my area of speciality.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/192356871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/244619629",
    "html_url": "https://github.com/rust-lang/rust/issues/21956#issuecomment-244619629",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21956",
    "id": 244619629,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NDYxOTYyOQ==",
    "user": {
      "login": "vitiral",
      "id": 5587659,
      "node_id": "MDQ6VXNlcjU1ODc2NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5587659?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vitiral",
      "html_url": "https://github.com/vitiral",
      "followers_url": "https://api.github.com/users/vitiral/followers",
      "following_url": "https://api.github.com/users/vitiral/following{/other_user}",
      "gists_url": "https://api.github.com/users/vitiral/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vitiral/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vitiral/subscriptions",
      "organizations_url": "https://api.github.com/users/vitiral/orgs",
      "repos_url": "https://api.github.com/users/vitiral/repos",
      "events_url": "https://api.github.com/users/vitiral/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vitiral/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2016-09-04T18:09:58Z",
    "updated_at": "2016-09-04T18:10:36Z",
    "body": "I just hit this as well. I had a similar structure to @zslayton except initially I had `session: &'a Session<'a>,` and I changed it to `session: &'a mut Session<'a>,`. Changing it to `mut` caused the compiler (for some reason) not be able to elide the lifetimes and I had to be more explicit.\n\nI think the MOST confusing thing here is this block:\n\n```\nimpl <'sess> Session <'sess> {\n  fn subscription<'b>(&'b mut self) -> SubscriptionBuilder <'b, 'sess> {\n    SubscriptionBuilder{\n      session: self,\n      frame: Frame,\n      subscription: Subscription{subscription_name : \"test\"}\n    }\n  }\n```\n\nYou are specifying that `struct Session` has lifetime `'sess`, which makes complete sense. However, when you specify the lifetime of `self` it does **not** have the lifetime of `'sess` -- instead it has lifetime `'b`!!!\n\nHow could `self` have a lifetime other than `'sess`?? It doesn't make any sense to me -- `'self` IS a reference to `Session`, therefore it can't have any lifetime other than `'sess` (in my head). This makes no sense to me (still doesn't actually, haha).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/244619629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305313955",
    "html_url": "https://github.com/rust-lang/rust/issues/21956#issuecomment-305313955",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21956",
    "id": 305313955,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNTMxMzk1NQ==",
    "user": {
      "login": "Mark-Simulacrum",
      "id": 5047365,
      "node_id": "MDQ6VXNlcjUwNDczNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mark-Simulacrum",
      "html_url": "https://github.com/Mark-Simulacrum",
      "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers",
      "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions",
      "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs",
      "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos",
      "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-05-31T20:52:52Z",
    "updated_at": "2017-05-31T20:52:52Z",
    "body": "I don't think we can do much to improve diagnostics in this scenario; I've added the simplest case below. If anyone has suggestions as to what hint we could give to improve the situation, they'd be much appreciated.\r\n\r\n```rust\r\nstruct A<'a> {\r\n    s: &'a str,\r\n}\r\n\r\nimpl<'a> A<'a> {\r\n    fn perform_mut(&'a mut self) -> &'a str {\r\n        self.s\r\n    }\r\n}\r\n\r\nfn main() {\r\n    let mut x = A { s: \"A\" };\r\n    x.perform_mut();\r\n    x.perform_mut();\r\n}\r\n```\r\n\r\n```\r\nerror[E0499]: cannot borrow `x` as mutable more than once at a time\r\n  --> test.rs:14:5\r\n   |\r\n13 |     x.perform_mut();\r\n   |     - first mutable borrow occurs here\r\n14 |     x.perform_mut();\r\n   |     ^ second mutable borrow occurs here\r\n15 | }\r\n   | - first borrow ends here\r\n\r\nerror: aborting due to previous error(s)\r\n```",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/305313955/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/424069512",
    "html_url": "https://github.com/rust-lang/rust/issues/21956#issuecomment-424069512",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21956",
    "id": 424069512,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNDA2OTUxMg==",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2018-09-24T18:05:00Z",
    "updated_at": "2018-09-24T18:05:00Z",
    "body": "With no suggestions in the last year, I'm guessing that this is not likely to be fixed. If anyone has ideas, please let me know, and we can re-open!",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/424069512/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
