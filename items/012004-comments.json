[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33915589",
    "html_url": "https://github.com/rust-lang/rust/pull/12004#issuecomment-33915589",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12004",
    "id": 33915589,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTE1NTg5",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-02T22:38:09Z",
    "updated_at": "2014-02-02T22:38:09Z",
    "body": "This is more of an RFC at this time. I'm not exactly happy with the concrete implementation, because it introduces lots of extra cleanups and LLVM IR, increasing the memory usage when compiling librustc by about 15% and the compile time by maybe 3% as well. Both of whic seem excessive.\n\nI guess we could drop the lifetime calls when we're in the toplevel scope of a function, but I couldn't figure out how to do that in a clean way.\n\nThat said, given this code (which is extremly favorable to this change):\n\n``` rust\npub fn foo (x: bool) {\n    match x {\n        true => println!(\"Foo{}\", 5),\n        false => println!(\"Foo{}\", 6),\n    };\n}\n```\n\nThis is how the resulting assembly differs:\n\n``` diff\n--- before.s    2014-02-02 23:33:09.706317828 +0100\n+++ after.s 2014-02-02 23:33:14.650273534 +0100\n@@ -1,51 +1,40 @@\n-   .globl  _ZN3foo19h81a28b9b9b1b3681ad4v0.0E\n+   .globl  _ZN3foo19h81ff6a854ff46f5cad4v0.0E\n    .align  16, 0x90\n-   .type   _ZN3foo19h81a28b9b9b1b3681ad4v0.0E,@function\n-_ZN3foo19h81a28b9b9b1b3681ad4v0.0E:\n+   .type   _ZN3foo19h81ff6a854ff46f5cad4v0.0E,@function\n+_ZN3foo19h81ff6a854ff46f5cad4v0.0E:\n    .cfi_startproc\n    cmpq    %fs:112, %rsp\n    ja  .LBB0_2\n-   movabsq $120, %r10\n+   movabsq $56, %r10\n    movabsq $0, %r11\n    callq   __morestack\n    retq\n .LBB0_2:\n-   subq    $120, %rsp\n+   subq    $56, %rsp\n .Ltmp1:\n-   .cfi_def_cfa_offset 128\n+   .cfi_def_cfa_offset 64\n    movzbl  %dil, %eax\n    cmpl    $1, %eax\n    jne .LBB0_4\n-   movq    $5, 112(%rsp)\n-   leaq    _ZN3fmt11secret_show19h1cfae34b462b5821a24v0.0E(%rip), %rax\n-   movq    %rax, 96(%rsp)\n-   leaq    112(%rsp), %rax\n-   movq    %rax, 104(%rsp)\n-   leaq    _ZN3foo15__STATIC_FMTSTR19h1e2ce5d40ae038c7ah4v0.0E(%rip), %rax\n-   movq    %rax, 64(%rsp)\n-   movq    $2, 72(%rsp)\n-   leaq    96(%rsp), %rax\n-   movq    %rax, 80(%rsp)\n-   movq    $1, 88(%rsp)\n-   leaq    64(%rsp), %rdi\n+   movq    $5, 48(%rsp)\n    jmp .LBB0_5\n .LBB0_4:\n-   movq    $6, 56(%rsp)\n-   leaq    _ZN3fmt11secret_show19h1cfae34b462b5821a24v0.0E(%rip), %rax\n-   movq    %rax, 40(%rsp)\n-   leaq    56(%rsp), %rax\n-   movq    %rax, 48(%rsp)\n-   leaq    _ZN3foo15__STATIC_FMTSTR19h1e2ce5d40ae038c7ah4v0.0E(%rip), %rax\n-   movq    %rax, 8(%rsp)\n-   movq    $2, 16(%rsp)\n-   leaq    40(%rsp), %rax\n-   movq    %rax, 24(%rsp)\n-   movq    $1, 32(%rsp)\n-   leaq    8(%rsp), %rdi\n+   movq    $6, 48(%rsp)\n .LBB0_5:\n+   leaq    _ZN3fmt11secret_show19h49d00ba23b26f207a24v0.0E(%rip), %rax\n+   movq    %rax, 32(%rsp)\n+   leaq    48(%rsp), %rax\n+   movq    %rax, 40(%rsp)\n+   leaq    _ZN3foo15__STATIC_FMTSTR19h96bb7cc571f17624ah4v0.0E(%rip), %rax\n+   movq    %rax, (%rsp)\n+   movq    $2, 8(%rsp)\n+   leaq    32(%rsp), %rax\n+   movq    %rax, 16(%rsp)\n+   movq    $1, 24(%rsp)\n+   leaq    (%rsp), %rdi\n    callq   _ZN2io5stdio12println_args19h7932d545acb66ab6ak9v0.10.preE@PLT\n-   addq    $120, %rsp\n+   addq    $56, %rsp\n    retq\n .Ltmp2:\n-   .size   _ZN3foo19h81a28b9b9b1b3681ad4v0.0E, .Ltmp2-_ZN3foo19h81a28b9b9b1b3681ad4v0.0E\n+   .size   _ZN3foo19h81ff6a854ff46f5cad4v0.0E, .Ltmp2-_ZN3foo19h81ff6a854ff46f5cad4v0.0E\n    .cfi_endproc\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33915589/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33918121",
    "html_url": "https://github.com/rust-lang/rust/pull/12004#issuecomment-33918121",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12004",
    "id": 33918121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTE4MTIx",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-03T00:25:47Z",
    "updated_at": "2014-02-03T00:25:47Z",
    "body": "Neat results!\n\nSince this has a non-trivial expense I wonder if we might put it behind an experimental optimizations flag.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33918121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33927757",
    "html_url": "https://github.com/rust-lang/rust/pull/12004#issuecomment-33927757",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12004",
    "id": 33927757,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTI3NzU3",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-03T06:37:23Z",
    "updated_at": "2014-02-03T06:37:23Z",
    "body": "I really like the result, though I find the side effects on compiler performance unfortunate.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33927757/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33927765",
    "html_url": "https://github.com/rust-lang/rust/pull/12004#issuecomment-33927765",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12004",
    "id": 33927765,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTI3NzY1",
    "user": {
      "login": "emberian",
      "id": 704250,
      "node_id": "MDQ6VXNlcjcwNDI1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emberian",
      "html_url": "https://github.com/emberian",
      "followers_url": "https://api.github.com/users/emberian/followers",
      "following_url": "https://api.github.com/users/emberian/following{/other_user}",
      "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emberian/subscriptions",
      "organizations_url": "https://api.github.com/users/emberian/orgs",
      "repos_url": "https://api.github.com/users/emberian/repos",
      "events_url": "https://api.github.com/users/emberian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emberian/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-03T06:37:41Z",
    "updated_at": "2014-02-03T06:37:41Z",
    "body": "Maybe we can do it at --opt-level=3?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/33927765/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34005968",
    "html_url": "https://github.com/rust-lang/rust/pull/12004#issuecomment-34005968",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12004",
    "id": 34005968,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MDA1OTY4",
    "user": {
      "login": "dotdash",
      "id": 230962,
      "node_id": "MDQ6VXNlcjIzMDk2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dotdash",
      "html_url": "https://github.com/dotdash",
      "followers_url": "https://api.github.com/users/dotdash/followers",
      "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
      "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
      "organizations_url": "https://api.github.com/users/dotdash/orgs",
      "repos_url": "https://api.github.com/users/dotdash/repos",
      "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dotdash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-03T22:05:32Z",
    "updated_at": "2014-02-03T22:05:32Z",
    "body": "This needs a lot more work. Array allocas are currently wrong (size only accounts for a single argument), and (for example) allocas for function arguments (which probably account for a lot of stack usage) don't get a proper marker for the end of their lifetime, yet. I don't expect to get enough time during the week due to $DAYJOB, but I'll revisit this during the weekend.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/34005968/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35058263",
    "html_url": "https://github.com/rust-lang/rust/pull/12004#issuecomment-35058263",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/12004",
    "id": 35058263,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDU4MjYz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-02-14T05:47:14Z",
    "updated_at": "2014-02-14T05:47:14Z",
    "body": "Closing due to inactivity, but I'd love to see this as an optimization pass!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/35058263/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
