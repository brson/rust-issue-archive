[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/46321391",
    "html_url": "https://github.com/rust-lang/rust/pull/14966#issuecomment-46321391",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14966",
    "id": 46321391,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MzIxMzkx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-17T15:18:28Z",
    "updated_at": "2014-06-17T15:18:28Z",
    "body": "Does this fix #14963, or does this just need to cc #14936? (just wanted to clarify)\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/46321391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/46321744",
    "html_url": "https://github.com/rust-lang/rust/pull/14966#issuecomment-46321744",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14966",
    "id": 46321744,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MzIxNzQ0",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-17T15:20:58Z",
    "updated_at": "2014-06-17T15:20:58Z",
    "body": "Ah it seems you may have intended #14962. r=me with the links updated.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/46321744/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/46373474",
    "html_url": "https://github.com/rust-lang/rust/pull/14966#issuecomment-46373474",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/14966",
    "id": 46373474,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MzczNDc0",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-06-17T22:21:39Z",
    "updated_at": "2014-06-17T22:21:39Z",
    "body": "Okay the PR that I posted here is not quite right.\n\nSee this example (adapted from `compile-fail/asm-misplaced-option.rs`, but made to actually run):\n\n```\n#![feature(asm)]\n#![allow(dead_code)]\n#[cfg(target_arch = \"x86\")]\n#[cfg(target_arch = \"x86_64\")]\npub fn main() {\n    // assignment not dead\n    let mut x: int = 17;\n    unsafe {\n        asm!(\"mov $1, $0\"\n             : \"=r\"(x)\n             : \"r\"(5u),\n               \"0\"({println!(\"eval input-2, x: {}\", x); x}) : \"cc\");\n    }\n    assert_eq!(x, 5);\n}\n```\n\nwhich prints this on my machine:\n\n```\n% ./x86_64-apple-darwin/stage1/bin/rustc  /tmp/asm-play.rs && ./asm-play \n/tmp/asm-play.rs:21:9: 21:14 warning: value assigned to `x` is never read, #[warn(dead_assignment)] on by default\n/tmp/asm-play.rs:21     let mut x: int = 17;\n                            ^~~~~\neval input-2, x: 17\n%\n```\n\ni.e.: the changes in this PR are making rustc think that the output expressions are evaluated first, to the point where they actually overwrite their defined contents.  But that is not what they do: the _side-effects_ of the output expressions take place first, but the actual overwrite specified by the capture of a variable's address only happens within the `asm!` block itself, which will run after all of the input expressions have been evaluated.\n\nI am going to need to do a more careful modification of the code involved here; it is unfortunately not as simple as just reordering the traversals to visit inputs before outputs, unfortunately.\n\n(Part of me wonders if it would be simpler to just change trans to generate the output expressions after the inputs.  But then we will lose the left-to-right evaluation ordering of the arguments to `asm!`.)\n\nClosing this PR for now; I will revive it later after I come up with a better fix.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/46373474/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
