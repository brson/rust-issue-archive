[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62308063",
    "html_url": "https://github.com/rust-lang/rust/issues/18806#issuecomment-62308063",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18806",
    "id": 62308063,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzA4MDYz",
    "user": {
      "login": "arielb1",
      "id": 1830974,
      "node_id": "MDQ6VXNlcjE4MzA5NzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arielb1",
      "html_url": "https://github.com/arielb1",
      "followers_url": "https://api.github.com/users/arielb1/followers",
      "following_url": "https://api.github.com/users/arielb1/following{/other_user}",
      "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions",
      "organizations_url": "https://api.github.com/users/arielb1/orgs",
      "repos_url": "https://api.github.com/users/arielb1/repos",
      "events_url": "https://api.github.com/users/arielb1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arielb1/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-09T16:00:23Z",
    "updated_at": "2014-11-09T16:01:49Z",
    "body": "`Foo { bytes: *bytes }` attempts to construct a `Foo` on the stack and return it, which can't work (as the `Foo` is variably-sized), so you have to construct a `Foo` manually, then transmute it from a `TraitObject` or `Slice<T>`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62308063/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62311503",
    "html_url": "https://github.com/rust-lang/rust/issues/18806#issuecomment-62311503",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18806",
    "id": 62311503,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzExNTAz",
    "user": {
      "login": "SimonSapin",
      "id": 291359,
      "node_id": "MDQ6VXNlcjI5MTM1OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SimonSapin",
      "html_url": "https://github.com/SimonSapin",
      "followers_url": "https://api.github.com/users/SimonSapin/followers",
      "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}",
      "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions",
      "organizations_url": "https://api.github.com/users/SimonSapin/orgs",
      "repos_url": "https://api.github.com/users/SimonSapin/repos",
      "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SimonSapin/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-09T17:32:55Z",
    "updated_at": "2014-11-09T17:32:55Z",
    "body": "Hum, ok. Returning `&T` for a \"newly created\" `T` doesn\u2019t makes sense, so this case kinda has to be a transmute. Maybe the error message can be improved? And if `T` has more than one field, the values have to be already laid out correctly somewhere.\n\nSo let\u2019s look at returning `Box<T>` with `T` unsized, as a fat pointer to newly allocated space. The following fails with the same error message as above, and I don\u2019t know how to work around it without making error-prone guesses at the struct memory layout.\n\n``` rust\npub struct Foo {\n    header: u16,\n    bytes: [u8]\n}\n\nimpl Foo {\n    fn new(bytes: Box<[u8]>) -> Box<Foo> {\n        box Foo { header: 4, bytes: *bytes }\n    }\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62311503/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62311728",
    "html_url": "https://github.com/rust-lang/rust/issues/18806#issuecomment-62311728",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18806",
    "id": 62311728,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzExNzI4",
    "user": {
      "login": "bkoropoff",
      "id": 2101303,
      "node_id": "MDQ6VXNlcjIxMDEzMDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2101303?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bkoropoff",
      "html_url": "https://github.com/bkoropoff",
      "followers_url": "https://api.github.com/users/bkoropoff/followers",
      "following_url": "https://api.github.com/users/bkoropoff/following{/other_user}",
      "gists_url": "https://api.github.com/users/bkoropoff/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bkoropoff/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bkoropoff/subscriptions",
      "organizations_url": "https://api.github.com/users/bkoropoff/orgs",
      "repos_url": "https://api.github.com/users/bkoropoff/repos",
      "events_url": "https://api.github.com/users/bkoropoff/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bkoropoff/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-09T17:39:05Z",
    "updated_at": "2014-11-09T17:39:05Z",
    "body": "You need to use generics and coercions (using `as` is broken at the moment):\n\n``` rust\nstruct Foo<Sized? T> {\n    foo: T\n}\n\nfn main() {\n    let foo_sized: Foo<[uint, .. 4]> = Foo { foo: [1u,2,3,4] };\n    let foo_unsized: &Foo<[uint]> = &foo_sized;\n    for &i in foo_unsized.foo.iter() {\n        println!(\"{}\", i);\n    }\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62311728/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62312965",
    "html_url": "https://github.com/rust-lang/rust/issues/18806#issuecomment-62312965",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18806",
    "id": 62312965,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzEyOTY1",
    "user": {
      "login": "japaric",
      "id": 5018213,
      "node_id": "MDQ6VXNlcjUwMTgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/japaric",
      "html_url": "https://github.com/japaric",
      "followers_url": "https://api.github.com/users/japaric/followers",
      "following_url": "https://api.github.com/users/japaric/following{/other_user}",
      "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/japaric/subscriptions",
      "organizations_url": "https://api.github.com/users/japaric/orgs",
      "repos_url": "https://api.github.com/users/japaric/repos",
      "events_url": "https://api.github.com/users/japaric/events{/privacy}",
      "received_events_url": "https://api.github.com/users/japaric/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-09T18:12:10Z",
    "updated_at": "2014-11-09T18:12:10Z",
    "body": "@SimonSapin According to my understanding:\n\n`Box<Foo>` is two words long (`data` + `len`), but you probably want to store `header` inline, i.e. `Box<Foo>` would have to be 3 words long (`header` + `padding` + `data` + `len`). AFAIK that's not possible with the current DST system.\n\nSince `Box<Foo>` has layout `data` + `len`, `data` would have to be a pointer to (`header` + `padding` + `slice_memory_chunk`) allocated in the heap. I don't think this is easy to express, nor performant, you'll have to reallocate `bytes` to accommodate the `header` in the front.\n\nBut I could be wrong. You should ask @nick29581 \n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62312965/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63247138",
    "html_url": "https://github.com/rust-lang/rust/issues/18806#issuecomment-63247138",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18806",
    "id": 63247138,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMjQ3MTM4",
    "user": {
      "login": "nrc",
      "id": 762626,
      "node_id": "MDQ6VXNlcjc2MjYyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nrc",
      "html_url": "https://github.com/nrc",
      "followers_url": "https://api.github.com/users/nrc/followers",
      "following_url": "https://api.github.com/users/nrc/following{/other_user}",
      "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
      "organizations_url": "https://api.github.com/users/nrc/orgs",
      "repos_url": "https://api.github.com/users/nrc/repos",
      "events_url": "https://api.github.com/users/nrc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nrc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-17T00:20:48Z",
    "updated_at": "2014-11-17T00:20:48Z",
    "body": "@bkoropoff's suggestion is correct, the preferred way to create an unsized struct is via coercion. You won't be able to do `*bytes` either, since that would require creating a temporary on the stack of unknown size. We used to forbid structs like `Foo` completely, i.e., you had to have a type parameter so that the struct could be coerced from sized to unsized, but there was some use case for such structs (which I can't recall).\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63247138/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63247277",
    "html_url": "https://github.com/rust-lang/rust/issues/18806#issuecomment-63247277",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18806",
    "id": 63247277,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMjQ3Mjc3",
    "user": {
      "login": "nrc",
      "id": 762626,
      "node_id": "MDQ6VXNlcjc2MjYyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nrc",
      "html_url": "https://github.com/nrc",
      "followers_url": "https://api.github.com/users/nrc/followers",
      "following_url": "https://api.github.com/users/nrc/following{/other_user}",
      "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nrc/subscriptions",
      "organizations_url": "https://api.github.com/users/nrc/orgs",
      "repos_url": "https://api.github.com/users/nrc/repos",
      "events_url": "https://api.github.com/users/nrc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nrc/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-17T00:24:16Z",
    "updated_at": "2014-11-17T00:24:16Z",
    "body": "To make something actionable here, we should probably have a 'raw' struct (something like `core::raw::Slice`) so that it is possible to create a `Box<Foo>` via transmutes.\n\nI don't see a way to allow creating such structs in a generic, safe way and I'm not sure it is something we should encourage. If there is a use case for this, then it would have to implemented as a language feature and would be post-1.0. If there is a strong use case, please file an issue on the RFCs repo.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63247277/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63303076",
    "html_url": "https://github.com/rust-lang/rust/issues/18806#issuecomment-63303076",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18806",
    "id": 63303076,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMzAzMDc2",
    "user": {
      "login": "SimonSapin",
      "id": 291359,
      "node_id": "MDQ6VXNlcjI5MTM1OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SimonSapin",
      "html_url": "https://github.com/SimonSapin",
      "followers_url": "https://api.github.com/users/SimonSapin/followers",
      "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}",
      "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions",
      "organizations_url": "https://api.github.com/users/SimonSapin/orgs",
      "repos_url": "https://api.github.com/users/SimonSapin/repos",
      "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SimonSapin/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-17T13:18:43Z",
    "updated_at": "2014-11-17T13:18:43Z",
    "body": "Closing as I don\u2019t think there is much actionable here. I opened this based on a \u201cthere has to be a better way\u201d feeling, but understand that it pretty much has to be transmute or coercion since we can\u2019t have generics over the set of fields in a struct.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/63303076/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/281340481",
    "html_url": "https://github.com/rust-lang/rust/issues/18806#issuecomment-281340481",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18806",
    "id": 281340481,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTM0MDQ4MQ==",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2017-02-21T13:12:21Z",
    "updated_at": "2017-02-21T13:21:07Z",
    "body": "If you happen upon this issue, there is some forward progress on e.g. https://github.com/rust-lang/rfcs/pull/1808, https://github.com/rust-lang/rfcs/pull/1909",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/281340481/reactions",
      "total_count": 9,
      "+1": 9,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
