{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/10795",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/10795/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/10795/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/10795/events",
  "html_url": "https://github.com/rust-lang/rust/pull/10795",
  "id": 23692761,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTA1MDAzMjM=",
  "number": 10795,
  "title": "Store metadata separately in rlib files",
  "user": {
    "login": "alexcrichton",
    "id": 64996,
    "node_id": "MDQ6VXNlcjY0OTk2",
    "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexcrichton",
    "html_url": "https://github.com/alexcrichton",
    "followers_url": "https://api.github.com/users/alexcrichton/followers",
    "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
    "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
    "repos_url": "https://api.github.com/users/alexcrichton/repos",
    "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 2,
  "created_at": "2013-12-04T03:41:04Z",
  "updated_at": "2014-06-16T22:50:34Z",
  "closed_at": "2013-12-05T00:08:22Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/10795",
    "html_url": "https://github.com/rust-lang/rust/pull/10795",
    "diff_url": "https://github.com/rust-lang/rust/pull/10795.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/10795.patch",
    "merged_at": null
  },
  "body": "Right now whenever an rlib file is linked against, all of the metadata from the\nrlib is pulled in to the final staticlib or binary. The reason for this is that\nthe metadata is currently stored in a section of the object file. Note that this\nis intentional for dynamic libraries in order to distribute metadata bundled\nwith static libraries.\n\nThis commit alters the situation for rlib libraries to instead store the\nmetadata in a separate file in the archive. In doing so, when the archive is\npassed to the linker, none of the metadata will get pulled into the result\nexecutable. Furthermore, the metadata file is skipped when assembling rlibs into\nan archive.\n\nThe snag in this implementation comes with multiple output formats. When\ngenerating a dylib, the metadata needs to be in the object file, but when\ngenerating an rlib this needs to be separate. In order to accomplish this, the\nmetadata variable is inserted into an entirely separate LLVM Module which is\nthen codegen'd into a different location (foo.metadata.o). This is then linked\ninto dynamic libraries and silently ignored for rlib files.\n\nWhile changing how metadata is inserted into archives, I have also stopped\ncompressing metadata when inserted into rlib files. We have wanted to stop\ncompressing metadata, but the sections it creates in object file sections are\napparently too large. Thankfully if it's just an arbitrary file it doesn't\nmatter how large it is.\n\nI have seen massive reductions in executable sizes, as well as staticlib output\nsizes (to confirm that this is all working).\n",
  "closed_by": {
    "login": "alexcrichton",
    "id": 64996,
    "node_id": "MDQ6VXNlcjY0OTk2",
    "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexcrichton",
    "html_url": "https://github.com/alexcrichton",
    "followers_url": "https://api.github.com/users/alexcrichton/followers",
    "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
    "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
    "repos_url": "https://api.github.com/users/alexcrichton/repos",
    "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/10795/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/10795/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
