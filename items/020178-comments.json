[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67979901",
    "html_url": "https://github.com/rust-lang/rust/issues/20178#issuecomment-67979901",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20178",
    "id": 67979901,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3OTc5OTAx",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-23T17:59:39Z",
    "updated_at": "2014-12-23T17:59:39Z",
    "body": "This is actually expected fallout from https://github.com/rust-lang/rust/pull/19891, and you can patch it up with:\n\n``` rust\nfn accepts_optional_fn_ptr(_test: Option<fn(int) -> int>) {}\n\nfn test_int(_: int) -> int { 0i }\n\nfn main() {\n    accepts_optional_fn_ptr(Some(test_int as fn(int) -> int));\n}\n```\n\nIt is unfortunate, however, that the coercions don't happen deeply through `Some`.\n\ncc @nikomatsakis \n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67979901/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67980040",
    "html_url": "https://github.com/rust-lang/rust/issues/20178#issuecomment-67980040",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20178",
    "id": 67980040,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3OTgwMDQw",
    "user": {
      "login": "pmsanford",
      "id": 1696007,
      "node_id": "MDQ6VXNlcjE2OTYwMDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1696007?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pmsanford",
      "html_url": "https://github.com/pmsanford",
      "followers_url": "https://api.github.com/users/pmsanford/followers",
      "following_url": "https://api.github.com/users/pmsanford/following{/other_user}",
      "gists_url": "https://api.github.com/users/pmsanford/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pmsanford/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pmsanford/subscriptions",
      "organizations_url": "https://api.github.com/users/pmsanford/orgs",
      "repos_url": "https://api.github.com/users/pmsanford/repos",
      "events_url": "https://api.github.com/users/pmsanford/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pmsanford/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-23T18:01:02Z",
    "updated_at": "2014-12-23T18:01:32Z",
    "body": "@alexcrichton yea, I updated my issue to reflect that. The problem I'm reporting is really one of ergonomics. Adding explicit casts everywhere is a little messy especially if the callbacks have lots of arguments. Then you start adding newtypes for each callback...\n\nEven something like an `.as_ptr` method on fn items would be fine, in my opinion. I was going to try and look into adding that after the holidays if this isn't addressed in some other way by then.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/67980040/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68433396",
    "html_url": "https://github.com/rust-lang/rust/issues/20178#issuecomment-68433396",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20178",
    "id": 68433396,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NDMzMzk2",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-12-31T10:05:36Z",
    "updated_at": "2014-12-31T10:05:36Z",
    "body": "The real issue is a more subtle one, as the following program compiles:\n\n``` rust\nfn accepts_optional_fn_ptr(_test: Option<fn(int) -> int>) {}\n\nfn test_int(_: int) -> int { 0i }\n\nfn main() {\n    accepts_optional_fn_ptr(Some::<fn(_) -> _>(test_int));\n}\n```\n\nAs it turns out, we propagate expected types down, we do coercions inside of function calls, _but_ we don't do something which I have no idea what to call so I'm just going to name it \"polymorphic unpacking\".\nWhen we encounter `Some` in the top-down traversal, we see that it is a path requiriing one type parameter, which we treat as if it were provided with `::<_>`, i.e. it is left to be inferred.\nThus, `Some(test_int)` becomes `Some<#0>(test_int)` and the argument is expected to be `#0` - which isn't going to trigger a coercion or anything, just assign `#0 = typeof test_int`.\nBy the time we look at the return type, it is too late: there is no coercion, the actual type is `Option<typeof test_int>` and that isn't going to match `Option<fn(int) -> int>`.\nHowever, if we tried to combine the two pieces of information that we have, `Option<fn(int) -> int>` and `Option<#0>`, we could deduce that `#0 = fn(int) -> int` quite early, and everything would follow as it should.\n\nAs I was writing this, @nikomatsakis has provided me with a straight-forward way of doing this. I also realized that my original plan of extracting `fn(int) -> int` for the argument's expected type without actually assigning `#0` is just roundabout, i.e. it would force `#0` to be `fn(int) -> int` eventually _anyways_, and it's easier to just unify them up-front.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/68433396/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69533413",
    "html_url": "https://github.com/rust-lang/rust/issues/20178#issuecomment-69533413",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20178",
    "id": 69533413,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NTMzNDEz",
    "user": {
      "login": "chris-morgan",
      "id": 392868,
      "node_id": "MDQ6VXNlcjM5Mjg2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/392868?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-morgan",
      "html_url": "https://github.com/chris-morgan",
      "followers_url": "https://api.github.com/users/chris-morgan/followers",
      "following_url": "https://api.github.com/users/chris-morgan/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-morgan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-morgan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-morgan/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-morgan/orgs",
      "repos_url": "https://api.github.com/users/chris-morgan/repos",
      "events_url": "https://api.github.com/users/chris-morgan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-morgan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-12T06:27:11Z",
    "updated_at": "2015-01-12T06:27:11Z",
    "body": "More things are affected by this; here\u2019s another example, one which #20415 does not appear to have fixed:\n\n``` rust\nfn a() { }\nfn b() { }\n\nfn main() {\n    let c = if true { a } else { b };\n    c();\n}\n```\n\n``` text\nk.rs:5:13: 5:37 error: if and else have incompatible types: expected `fn() {a}`, found `fn() {b}` (expected fn item, found a different fn item)\nk.rs:5     let c = if true { a } else { b };\n                   ^~~~~~~~~~~~~~~~~~~~~~~~\nerror: aborting due to previous error\n```\n\nIs this a separate issue? Should I file it as a new issue?\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69533413/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69534174",
    "html_url": "https://github.com/rust-lang/rust/issues/20178#issuecomment-69534174",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20178",
    "id": 69534174,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NTM0MTc0",
    "user": {
      "login": "huonw",
      "id": 1203825,
      "node_id": "MDQ6VXNlcjEyMDM4MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huonw",
      "html_url": "https://github.com/huonw",
      "followers_url": "https://api.github.com/users/huonw/followers",
      "following_url": "https://api.github.com/users/huonw/following{/other_user}",
      "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huonw/subscriptions",
      "organizations_url": "https://api.github.com/users/huonw/orgs",
      "repos_url": "https://api.github.com/users/huonw/repos",
      "events_url": "https://api.github.com/users/huonw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huonw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-12T06:42:37Z",
    "updated_at": "2015-01-12T06:42:37Z",
    "body": "Separate issue please (I believe that sort of situation where the compiler has to implicitly construct some \"supertype\" without any type annotations is harder).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/69534174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75960660",
    "html_url": "https://github.com/rust-lang/rust/issues/20178#issuecomment-75960660",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/20178",
    "id": 75960660,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTYwNjYw",
    "user": {
      "login": "Ryman",
      "id": 994978,
      "node_id": "MDQ6VXNlcjk5NDk3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/994978?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ryman",
      "html_url": "https://github.com/Ryman",
      "followers_url": "https://api.github.com/users/Ryman/followers",
      "following_url": "https://api.github.com/users/Ryman/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ryman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ryman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ryman/subscriptions",
      "organizations_url": "https://api.github.com/users/Ryman/orgs",
      "repos_url": "https://api.github.com/users/Ryman/repos",
      "events_url": "https://api.github.com/users/Ryman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ryman/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-25T13:40:14Z",
    "updated_at": "2015-02-25T13:40:14Z",
    "body": "@chris-morgan Did you file an additional issue for that? (Can't find one via search)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75960660/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
