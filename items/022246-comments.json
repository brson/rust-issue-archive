[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74166265",
    "html_url": "https://github.com/rust-lang/rust/issues/22246#issuecomment-74166265",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22246",
    "id": 74166265,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTY2MjY1",
    "user": {
      "login": "aturon",
      "id": 709807,
      "node_id": "MDQ6VXNlcjcwOTgwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aturon",
      "html_url": "https://github.com/aturon",
      "followers_url": "https://api.github.com/users/aturon/followers",
      "following_url": "https://api.github.com/users/aturon/following{/other_user}",
      "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aturon/subscriptions",
      "organizations_url": "https://api.github.com/users/aturon/orgs",
      "repos_url": "https://api.github.com/users/aturon/repos",
      "events_url": "https://api.github.com/users/aturon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aturon/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-12T22:23:08Z",
    "updated_at": "2015-02-12T22:23:08Z",
    "body": "cc @japaric\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74166265/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74186523",
    "html_url": "https://github.com/rust-lang/rust/issues/22246#issuecomment-74186523",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22246",
    "id": 74186523,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTg2NTIz",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-13T00:59:43Z",
    "updated_at": "2015-02-13T01:00:47Z",
    "body": "The problem arises from the \"implied region bounds\" rules. In the older formulation (or an equivalent one, like http://is.gd/L4uIcH), you wind up with the owned type `O` as a type parameter. Therefore, the type of self is `&'a Cow<B,O>`, from which we infer that `B:'a` and `O:'a` holds. This determination is based on rules that consider the variance of each type parameter (here, `B` and `O`). Unfortunately, when `O` is moved to an associated type, the type is just `&'a Cow<B>`, from which we derive that `B:'a` but not `B::Owned : 'a`.\n\nI see a couple of ways to fix this:\n1. We could modify the WF rules to trawl the contents of the enum/structure, potentially. This would allow us to determine that `&'a Cow<B>` implies `B::Owned : 'a` because `B::Owned` is contained within one of the variants.\n2. We could modify the WF rules so that if you have a type parameter `B` with the bound `B:Borrow`, then we ensure that all associated types of `Borrow` must also outlive the surrounding region. Hence `&'a Cow<B>` would be imply `B:'a` and `B::Owned : 'a`. \n\nThe difference between 1 and 2 is that 2 doesn't require inspecting the contents of the struct, just the where-clauses declared on the struct. I have a mild preference for this -- I originally designed the rules to use variance for the same reason, basically that trawling through the contents feels like it exposes more of the guts than I would like, and raises other questions.\n\nThe downside of option 2 is that if there are associated types that don't represent data reachable from `Self`, then they will wind up with stricter lifetime requirements than necessary. Lacking variance information on associated types, we can't really make this determination. It's unclear how big a problem this would be in practice; conceivably we could eventually add some keyword (like `in type X`) to declare \"input\" types that don't represent data reachable from `self`.\n\nAnyway, just some in-progress thoughts. I think mocking up option 2 wouldn't be all that hard.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74186523/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74321340",
    "html_url": "https://github.com/rust-lang/rust/issues/22246#issuecomment-74321340",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22246",
    "id": 74321340,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MzIxMzQw",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-13T20:28:36Z",
    "updated_at": "2015-02-13T20:28:36Z",
    "body": "Somewhat simplified test case:\n\n``` rust\nuse std::ops::Deref;\n\npub trait ToOwned {\n    type Owned: Borrow<Self>;\n    fn to_owned(&self) -> Self::Owned;\n}\n\npub trait Borrow<Borrowed> {\n    fn borrow(&self) -> &Borrowed;\n}\n\npub struct Foo<B:ToOwned> {\n    owned: B::Owned\n}\n\nfn foo<B:ToOwned>(this: &Foo<B>) -> &B {\n    this.owned.borrow()\n}\n\nfn main() { }\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74321340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74530276",
    "html_url": "https://github.com/rust-lang/rust/issues/22246#issuecomment-74530276",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22246",
    "id": 74530276,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NTMwMjc2",
    "user": {
      "login": "nikomatsakis",
      "id": 155238,
      "node_id": "MDQ6VXNlcjE1NTIzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikomatsakis",
      "html_url": "https://github.com/nikomatsakis",
      "followers_url": "https://api.github.com/users/nikomatsakis/followers",
      "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions",
      "organizations_url": "https://api.github.com/users/nikomatsakis/orgs",
      "repos_url": "https://api.github.com/users/nikomatsakis/repos",
      "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikomatsakis/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-16T16:01:04Z",
    "updated_at": "2015-02-16T16:01:04Z",
    "body": "I've implemented option 2, which I think is the right call. Basically the idea is that if you have a struct with where clauses, we will require that any associated types of traits that appear in those where clauses must outlive the struct itself (as they could potentially be embedded within the struct).\n\nSo if you have:\n\n``` rust\ntrait Foo { type T; ... }\nstruct Bar<U:Foo> { ... }\n```\n\nthen if some instance of `Bar<U>` which appears in an location with lifetime `'a`, `U::T` must outlive `'a`. Similarly `&'a Bar<U>` is only legal if `U::T : 'a` (and, most importantly, a function that takes `&'a Bar<U>` can assume that `U::T : 'a`).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74530276/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75358616",
    "html_url": "https://github.com/rust-lang/rust/issues/22246#issuecomment-75358616",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22246",
    "id": 75358616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzU4NjE2",
    "user": {
      "login": "edwardw",
      "id": 454049,
      "node_id": "MDQ6VXNlcjQ1NDA0OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/454049?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/edwardw",
      "html_url": "https://github.com/edwardw",
      "followers_url": "https://api.github.com/users/edwardw/followers",
      "following_url": "https://api.github.com/users/edwardw/following{/other_user}",
      "gists_url": "https://api.github.com/users/edwardw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/edwardw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/edwardw/subscriptions",
      "organizations_url": "https://api.github.com/users/edwardw/orgs",
      "repos_url": "https://api.github.com/users/edwardw/repos",
      "events_url": "https://api.github.com/users/edwardw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/edwardw/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-21T06:27:13Z",
    "updated_at": "2015-02-21T06:27:13Z",
    "body": "This can be closed since #22436 has fixed it.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75358616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75358683",
    "html_url": "https://github.com/rust-lang/rust/issues/22246#issuecomment-75358683",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/22246",
    "id": 75358683,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzU4Njgz",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-21T06:28:30Z",
    "updated_at": "2015-02-21T06:28:30Z",
    "body": "Thanks @edwardw!\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/75358683/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
