{
  "url": "https://api.github.com/repos/rust-lang/rust/issues/26411",
  "repository_url": "https://api.github.com/repos/rust-lang/rust",
  "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/26411/labels{/name}",
  "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/26411/comments",
  "events_url": "https://api.github.com/repos/rust-lang/rust/issues/26411/events",
  "html_url": "https://github.com/rust-lang/rust/pull/26411",
  "id": 89412560,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MzgwNjAxMzM=",
  "number": 26411,
  "title": "Pass fat pointers in two immediate arguments",
  "user": {
    "login": "dotdash",
    "id": 230962,
    "node_id": "MDQ6VXNlcjIzMDk2Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dotdash",
    "html_url": "https://github.com/dotdash",
    "followers_url": "https://api.github.com/users/dotdash/followers",
    "following_url": "https://api.github.com/users/dotdash/following{/other_user}",
    "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions",
    "organizations_url": "https://api.github.com/users/dotdash/orgs",
    "repos_url": "https://api.github.com/users/dotdash/repos",
    "events_url": "https://api.github.com/users/dotdash/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dotdash/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 223796632,
      "node_id": "MDU6TGFiZWwyMjM3OTY2MzI=",
      "url": "https://api.github.com/repos/rust-lang/rust/labels/relnotes",
      "name": "relnotes",
      "color": "fad8c7",
      "default": false,
      "description": "Marks issues that should be documented in the release notes of the next release."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "pnkfelix",
    "id": 173127,
    "node_id": "MDQ6VXNlcjE3MzEyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pnkfelix",
    "html_url": "https://github.com/pnkfelix",
    "followers_url": "https://api.github.com/users/pnkfelix/followers",
    "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
    "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
    "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
    "repos_url": "https://api.github.com/users/pnkfelix/repos",
    "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 19,
  "created_at": "2015-06-18T22:28:30Z",
  "updated_at": "2015-07-27T08:49:42Z",
  "closed_at": "2015-06-20T21:36:56Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/rust-lang/rust/pulls/26411",
    "html_url": "https://github.com/rust-lang/rust/pull/26411",
    "diff_url": "https://github.com/rust-lang/rust/pull/26411.diff",
    "patch_url": "https://github.com/rust-lang/rust/pull/26411.patch",
    "merged_at": "2015-06-20T21:36:56Z"
  },
  "body": "This has a number of advantages compared to creating a copy in memory\nand passing a pointer. The obvious one is that we don't have to put the\ndata into memory but can keep it in registers. Since we're currently\npassing a pointer anyway (instead of using e.g. a known offset on the\nstack, which is what the `byval` attribute would achieve), we only use a\nsingle additional register for each fat pointer, but save at least two\npointers worth of stack in exchange (sometimes more because more than\none copy gets eliminated). On archs that pass arguments on the stack, we\nsave a pointer worth of stack even without considering the omitted\ncopies.\n\nAdditionally, LLVM can optimize the code a lot better, to a large degree\ndue to the fact that lots of copies are gone or can be optimized away.\nAdditionally, we can now emit attributes like nonnull on the data and/or\nvtable pointers contained in the fat pointer, potentially allowing for\neven more optimizations.\n\nThis results in LLVM passes being about 3-7% faster (depending on the\ncrate), and the resulting code is also a few percent smaller, for\nexample:\n\n| text | data | filename |\n| --- | --- | --- |\n| 5671479 | 3941461 | before/librustc-d8ace771.so |\n| 5447663 | 3905745 | after/librustc-d8ace771.so |\n|  |  |  |\n| 1944425 | 2394024 | before/libstd-d8ace771.so |\n| 1896769 | 2387610 | after/libstd-d8ace771.so |\n\nI had to remove a call in the backtrace-debuginfo test, because LLVM can\nnow merge the tails of some blocks when optimizations are turned on,\nwhich can't correctly preserve line info.\n\nFixes #22924\n\nCc #22891 (at least for fat pointers the code is good now)\n",
  "closed_by": {
    "login": "bors",
    "id": 3372342,
    "node_id": "MDQ6VXNlcjMzNzIzNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors",
    "html_url": "https://github.com/bors",
    "followers_url": "https://api.github.com/users/bors/followers",
    "following_url": "https://api.github.com/users/bors/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors/subscriptions",
    "organizations_url": "https://api.github.com/users/bors/orgs",
    "repos_url": "https://api.github.com/users/bors/repos",
    "events_url": "https://api.github.com/users/bors/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/26411/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/26411/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "_meta": {
    "type": "pr"
  }
}
