[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12306762",
    "html_url": "https://github.com/rust-lang/rust/issues/4489#issuecomment-12306762",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4489",
    "id": 12306762,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMzA2NzYy",
    "user": {
      "login": "amuxtux",
      "id": 1303293,
      "node_id": "MDQ6VXNlcjEzMDMyOTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1303293?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amuxtux",
      "html_url": "https://github.com/amuxtux",
      "followers_url": "https://api.github.com/users/amuxtux/followers",
      "following_url": "https://api.github.com/users/amuxtux/following{/other_user}",
      "gists_url": "https://api.github.com/users/amuxtux/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amuxtux/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amuxtux/subscriptions",
      "organizations_url": "https://api.github.com/users/amuxtux/orgs",
      "repos_url": "https://api.github.com/users/amuxtux/repos",
      "events_url": "https://api.github.com/users/amuxtux/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amuxtux/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-16T06:45:08Z",
    "updated_at": "2013-01-16T06:45:08Z",
    "body": "I  have little idea at the moment, if someone find this explanation wrong please correct.\n1. first of all its about red zone : in x86 rust code, the prologue code (possibly the red zone impl) seems to be using F and G segment registers.  in ARM there are no such registers. It may be possible to use other registers like LR and PC, I am not sure about it. \n2. second but comparatively less complex problem is to understand and port the x86 version of morestack.S to ARM assembly.\n3. third point I am also not sure but I write it in any case. It seems to have something to do with split stack option of gcc also. Unlike normal x86 libcc I did not find that option with android NDK's gcc. It must have something to with morestack call, but again also not quite clear what and how it will have impact. [any help will be highly appreciated ]\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12306762/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12308576",
    "html_url": "https://github.com/rust-lang/rust/issues/4489#issuecomment-12308576",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4489",
    "id": 12308576,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMzA4NTc2",
    "user": {
      "login": "amuxtux",
      "id": 1303293,
      "node_id": "MDQ6VXNlcjEzMDMyOTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1303293?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amuxtux",
      "html_url": "https://github.com/amuxtux",
      "followers_url": "https://api.github.com/users/amuxtux/followers",
      "following_url": "https://api.github.com/users/amuxtux/following{/other_user}",
      "gists_url": "https://api.github.com/users/amuxtux/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amuxtux/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amuxtux/subscriptions",
      "organizations_url": "https://api.github.com/users/amuxtux/orgs",
      "repos_url": "https://api.github.com/users/amuxtux/repos",
      "events_url": "https://api.github.com/users/amuxtux/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amuxtux/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-16T08:14:52Z",
    "updated_at": "2013-01-16T08:14:52Z",
    "body": "--- just in addition to above ---- \n// i captured followings with  rustc -S option for both x86 and ARM.\n\nFollowing seems to be red zone function inside prologue in i386 \n    cmpq    %gs:816, %rsp      <------ seems GS register \n    ja  LBB0_0\n    movabsq $8, %r10\n    movabsq $0, %r11\n    callq   ___morestack\n    ret\n       < ......... prologue continues ...........>\n\nFollowing is the current Prolog for ARM for same simple function: (with out red zone)\n    push    {r11, lr}\n    mov r11, sp\n    sub sp, sp, #20  <------- currently static increment of stack \n\nTo implement  in ARM we should have proper RZ implementation followed by __morestack insertion.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12308576/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12347721",
    "html_url": "https://github.com/rust-lang/rust/issues/4489#issuecomment-12347721",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4489",
    "id": 12347721,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMzQ3NzIx",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-17T00:02:28Z",
    "updated_at": "2013-01-17T00:08:42Z",
    "body": "The x86 segment registers that the prologue is looking in contain the thread control block, where pthreads stores it's per-thread data structures, in particular the task-local storage slots. The pthreads implementation reserves a number of slots for various platform-specific things and the prologue (and the accessors in `record_sp.S`) uses assembly to access one of these slots directly.\n\nFor the ARM port we want to figure out where that thread control block lives and identify a reserved slot that we can 'steal'. For example, on x86_64 Linux we are using `%fs:112` which corresponds to ... (TODO can't locate this information).\n\nThere is a [big comment](https://code.google.com/p/android-source-browsing/source/browse/libc/bionic/pthread.c?repo=platform--bionic&name=ics-mr1#1547) about bionic's TLS implementation that might offer some leads. There are apparently some [reserved TLS slots](https://code.google.com/p/android-source-browsing/source/browse/libc/private/bionic_tls.h?repo=platform--bionic&name=ics-mr1) that we may be able to use. Finally, there are [two different mechanisms](https://code.google.com/p/android-source-browsing/source/browse/libc/private/bionic_tls.h?repo=platform--bionic&name=ics-mr1) for accessing TLS on bionic depending on the hardware/software revision in use. With all this information presumably we can find a free word somewhere to hold the stack pointer.\n\nIf you haven't seen it [here](http://gcc.gnu.org/wiki/SplitStacks) is the original gcc split stack proposal, containing some useful details.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12347721/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12351478",
    "html_url": "https://github.com/rust-lang/rust/issues/4489#issuecomment-12351478",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4489",
    "id": 12351478,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMzUxNDc4",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-17T02:21:32Z",
    "updated_at": "2013-01-17T02:21:32Z",
    "body": "I mentioned this elsewhere but I'll record it here too: Rust doesn't depend on a C++ compiler with `-fsplit-stack`. All of our split stack support is provided by LLVM and the Rust runtime. We don't currently compile any C++ code with split stacks. It is not going to be a problem that the Android toolchain doesn't have `-fsplit-stack`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12351478/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12351881",
    "html_url": "https://github.com/rust-lang/rust/issues/4489#issuecomment-12351881",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4489",
    "id": 12351881,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMzUxODgx",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-17T02:39:20Z",
    "updated_at": "2013-01-17T02:39:20Z",
    "body": "A lot of ARM processors don't have the TLS register and implement TLS with a syscall (or a trap). Making a syscall on every function call is not going to work, so we may need to support a configuration that doesn't do stack growth. My impression is that newer generation processors should have the register.\n\nSome info here: http://elinux.org/Android_on_OMAP#TLS_issue\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12351881/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12931849",
    "html_url": "https://github.com/rust-lang/rust/issues/4489#issuecomment-12931849",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4489",
    "id": 12931849,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyOTMxODQ5",
    "user": {
      "login": "amuxtux",
      "id": 1303293,
      "node_id": "MDQ6VXNlcjEzMDMyOTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1303293?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amuxtux",
      "html_url": "https://github.com/amuxtux",
      "followers_url": "https://api.github.com/users/amuxtux/followers",
      "following_url": "https://api.github.com/users/amuxtux/following{/other_user}",
      "gists_url": "https://api.github.com/users/amuxtux/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amuxtux/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amuxtux/subscriptions",
      "organizations_url": "https://api.github.com/users/amuxtux/orgs",
      "repos_url": "https://api.github.com/users/amuxtux/repos",
      "events_url": "https://api.github.com/users/amuxtux/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amuxtux/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-01-31T08:09:29Z",
    "updated_at": "2013-01-31T08:09:29Z",
    "body": "Thanks @brson  , I put more effort to understand the problem and what need to be done.\n\nSo in order to get started , I first created a morestack.s with simple return for ARM  i.e. mov pc, lr and statically compiled  linked with rustrt  using ndk tool chain. \n\nHowever LLVM when generate code for ARM even with -segmented-stacks option does not insert __morestack external symbol into the generated code.\n\nFrom rust side I have verified there is no problem as EnableSegmentedStack option is true while calling LLVM.\n\nso I started implementing adjustForSegmentedStacks method in  ARMFrameLowering.cpp.\n\nSince I hardly know that big code so its being really hard and taking lot of time. Any way I believe once it is done it would give a ground to do some experiments to detect bottom of stack in case of arm-android and finally will lead to filling in empty morestack.S\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/12931849/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14220837",
    "html_url": "https://github.com/rust-lang/rust/issues/4489#issuecomment-14220837",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4489",
    "id": 14220837,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjIwODM3",
    "user": {
      "login": "ILyoan",
      "id": 2672194,
      "node_id": "MDQ6VXNlcjI2NzIxOTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2672194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ILyoan",
      "html_url": "https://github.com/ILyoan",
      "followers_url": "https://api.github.com/users/ILyoan/followers",
      "following_url": "https://api.github.com/users/ILyoan/following{/other_user}",
      "gists_url": "https://api.github.com/users/ILyoan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ILyoan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ILyoan/subscriptions",
      "organizations_url": "https://api.github.com/users/ILyoan/orgs",
      "repos_url": "https://api.github.com/users/ILyoan/repos",
      "events_url": "https://api.github.com/users/ILyoan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ILyoan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-28T07:35:13Z",
    "updated_at": "2013-02-28T07:35:13Z",
    "body": "I'm working on this and I believe I've almost done with this.\nI just supposed that all of the android devices have TLS register so that we can access TLS address via `mrc` instruction. And I use the last TLS slot(64th slot) to record stack limit because it seems to me that the android kernel tries to allocate the lowest empty TLS slot(except the reserved slot) to users.\n\nMy current working branches are\nhttps://github.com/ILyoan/rust/tree/arm_morestack\nhttps://github.com/ILyoan/llvm/tree/arm_splitstack\nBuilding rustc for android is done with CMake. It can be built with legacy make build system after issue #4513 is landed.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14220837/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14263909",
    "html_url": "https://github.com/rust-lang/rust/issues/4489#issuecomment-14263909",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4489",
    "id": 14263909,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0MjYzOTA5",
    "user": {
      "login": "brson",
      "id": 147214,
      "node_id": "MDQ6VXNlcjE0NzIxNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brson",
      "html_url": "https://github.com/brson",
      "followers_url": "https://api.github.com/users/brson/followers",
      "following_url": "https://api.github.com/users/brson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brson/subscriptions",
      "organizations_url": "https://api.github.com/users/brson/orgs",
      "repos_url": "https://api.github.com/users/brson/repos",
      "events_url": "https://api.github.com/users/brson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-02-28T23:16:53Z",
    "updated_at": "2013-02-28T23:16:53Z",
    "body": "@ILyoan Wow! Nice work.\n\nI'm glad we can assume the presence of TLS. That makes things easier.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14263909/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14416110",
    "html_url": "https://github.com/rust-lang/rust/issues/4489#issuecomment-14416110",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/4489",
    "id": 14416110,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NDE2MTEw",
    "user": {
      "login": "yichoi",
      "id": 3222276,
      "node_id": "MDQ6VXNlcjMyMjIyNzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3222276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yichoi",
      "html_url": "https://github.com/yichoi",
      "followers_url": "https://api.github.com/users/yichoi/followers",
      "following_url": "https://api.github.com/users/yichoi/following{/other_user}",
      "gists_url": "https://api.github.com/users/yichoi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yichoi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yichoi/subscriptions",
      "organizations_url": "https://api.github.com/users/yichoi/orgs",
      "repos_url": "https://api.github.com/users/yichoi/repos",
      "events_url": "https://api.github.com/users/yichoi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yichoi/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2013-03-05T00:22:51Z",
    "updated_at": "2013-03-05T00:22:51Z",
    "body": "Being managed without cmake \nhttps://github.com/yichoi/rust/commits/arm_latest (old makefile comes from [cross3](https://github.com/yichoi/rust/commits/cross3))\nhttps://github.com/yichoi/rust/commits/arm_morestack (current makefile comes for [cross5](%28https://github.com/yichoi/rust/commits/cross5%29)\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/14416110/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
