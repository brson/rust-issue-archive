[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71664873",
    "html_url": "https://github.com/rust-lang/rust/issues/21668#issuecomment-71664873",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21668",
    "id": 71664873,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNjY0ODcz",
    "user": {
      "login": "ranma42",
      "id": 1506030,
      "node_id": "MDQ6VXNlcjE1MDYwMzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1506030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ranma42",
      "html_url": "https://github.com/ranma42",
      "followers_url": "https://api.github.com/users/ranma42/followers",
      "following_url": "https://api.github.com/users/ranma42/following{/other_user}",
      "gists_url": "https://api.github.com/users/ranma42/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ranma42/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ranma42/subscriptions",
      "organizations_url": "https://api.github.com/users/ranma42/orgs",
      "repos_url": "https://api.github.com/users/ranma42/repos",
      "events_url": "https://api.github.com/users/ranma42/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ranma42/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-01-27T15:20:30Z",
    "updated_at": "2015-01-27T15:20:30Z",
    "body": "Some code in libstd seems to assume that `compare_and_swap` will always return the original value of the atomic entity.\n\nExamples:\n- https://github.com/rust-lang/rust/blob/master/src/libstd/sync/condvar.rs#L323\n- https://github.com/rust-lang/rust/blob/master/src/libstd/sync/mpsc/oneshot.rs#L287\n- https://github.com/rust-lang/rust/blob/master/src/libstd/sync/mpsc/oneshot.rs#L334\n- https://github.com/rust-lang/rust/blob/master/src/libstd/sync/mpsc/shared.rs#L364\n- https://github.com/rust-lang/rust/blob/master/src/libstd/sync/mpsc/stream.rs#L308\n  \n  This would be consistent with the definition of the [`cmpxchg`](http://llvm.org/docs/LangRef.html#cmpxchg-instruction) LLVM instruction:\n  \n  > The contents of memory at the location specified by the \u2018<pointer>\u2018 operand is read and compared to \u2018<cmp>\u2018; if the read value is the equal, the \u2018<new>\u2018 is written. The original value at the location is returned, together with a flag indicating success (true) or failure (false).\n\nMy understanding is that the same semantics holds for `compare_and_swap` in Rust, except that no flag is returned.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/71664873/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74588950",
    "html_url": "https://github.com/rust-lang/rust/issues/21668#issuecomment-74588950",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21668",
    "id": 74588950,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NTg4OTUw",
    "user": {
      "login": "steveklabnik",
      "id": 27786,
      "node_id": "MDQ6VXNlcjI3Nzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveklabnik",
      "html_url": "https://github.com/steveklabnik",
      "followers_url": "https://api.github.com/users/steveklabnik/followers",
      "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions",
      "organizations_url": "https://api.github.com/users/steveklabnik/orgs",
      "repos_url": "https://api.github.com/users/steveklabnik/repos",
      "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveklabnik/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-16T23:24:32Z",
    "updated_at": "2015-02-16T23:24:32Z",
    "body": "@pnkfelix who do you think i should ask about clarifying this behavior?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74588950/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74594256",
    "html_url": "https://github.com/rust-lang/rust/issues/21668#issuecomment-74594256",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/21668",
    "id": 74594256,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NTk0MjU2",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-02-17T00:06:08Z",
    "updated_at": "2015-02-17T00:06:08Z",
    "body": "The semantics (just forgotten to be documented) are what @ranma42 pointed out. The previous value is always returned.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/74594256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
