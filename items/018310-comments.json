[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60491792",
    "html_url": "https://github.com/rust-lang/rust/issues/18310#issuecomment-60491792",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18310",
    "id": 60491792,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDkxNzky",
    "user": {
      "login": "veddan",
      "id": 307180,
      "node_id": "MDQ6VXNlcjMwNzE4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/307180?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/veddan",
      "html_url": "https://github.com/veddan",
      "followers_url": "https://api.github.com/users/veddan/followers",
      "following_url": "https://api.github.com/users/veddan/following{/other_user}",
      "gists_url": "https://api.github.com/users/veddan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/veddan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/veddan/subscriptions",
      "organizations_url": "https://api.github.com/users/veddan/orgs",
      "repos_url": "https://api.github.com/users/veddan/repos",
      "events_url": "https://api.github.com/users/veddan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/veddan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-25T18:17:39Z",
    "updated_at": "2014-10-25T18:17:39Z",
    "body": "When run with a debug build of jemalloc, it triggers an assertion failure.\n\n```\n<jemalloc>: ../../../src/jemalloc/include/jemalloc/internal/arena.h:1153:\nFailed assertion: \"arena_mapbits_allocated_get(chunk, pageind) != 0\"\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60491792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60492011",
    "html_url": "https://github.com/rust-lang/rust/issues/18310#issuecomment-60492011",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18310",
    "id": 60492011,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDkyMDEx",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-25T18:22:25Z",
    "updated_at": "2014-10-25T18:22:25Z",
    "body": "AFAICT the assertion means that the pointer passed to deallocate is not actually a valid memory allocation. It may indicate a double-free.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60492011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61389186",
    "html_url": "https://github.com/rust-lang/rust/issues/18310#issuecomment-61389186",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18310",
    "id": 61389186,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMzg5MTg2",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-02T00:27:19Z",
    "updated_at": "2014-11-02T07:45:05Z",
    "body": "I've been doing [my own investigations](https://gist.github.com/eddyb/dc938eb712a4ccf89133) and it doesn't look like a double free - it's actually a valid memory allocation.\nI'm afraid we might be corrupting jemalloc's metadata.\nAny chance we could run AddressSanitizer on Rust code?\n\n**EDIT**: I can't seem to trigger the assert (is `./configure --enable-debug` not enough?), but I've found out that `quarantine:467184` is the minimum value that makes it abort, outside of gdb/valgrind.\nIn gdb, I got around `372380` with my binary search before realizing it's not deterministic, which reinforces the idea that this could be a race condition.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61389186/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61428785",
    "html_url": "https://github.com/rust-lang/rust/issues/18310#issuecomment-61428785",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18310",
    "id": 61428785,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNDI4Nzg1",
    "user": {
      "login": "eddyb",
      "id": 77424,
      "node_id": "MDQ6VXNlcjc3NDI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eddyb",
      "html_url": "https://github.com/eddyb",
      "followers_url": "https://api.github.com/users/eddyb/followers",
      "following_url": "https://api.github.com/users/eddyb/following{/other_user}",
      "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions",
      "organizations_url": "https://api.github.com/users/eddyb/orgs",
      "repos_url": "https://api.github.com/users/eddyb/repos",
      "events_url": "https://api.github.com/users/eddyb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eddyb/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-02T23:18:23Z",
    "updated_at": "2014-11-02T23:22:31Z",
    "body": "I wasted time denying my suspicions about jemalloc's quarantine feature being buggy, but [indeed it is](https://github.com/jemalloc/jemalloc/issues/161).\n\nThe options we have (cc @alexcrichton):\n- don't run run-pass tests under valgrind (may lead to more regressions)\n- set `JE_MALLOC_CONF=quarantine:0` (may remain in place after the bug is fixed)\n- pass `--disable-fill` to jemalloc's configure (all of the above, and is more obscure)\n- wait until the bug is fixed to build a new snapshot (@thestinger is looking into it)\n\n**EDIT**: minimal Rust testcase (works with or without the runtime):\n\n``` rust\n#[start]\nfn main(_: int, _: *const *const u8) -> int {\n    for _ in range(0, 10000u) {\n        // allocate some bytes and immediatelly free them\n        // box [0u8, ..128];\n        // smaller allocations allow valgrind to catch reads of uninitialized memory\n        box 0u8;\n    }\n    0\n}\n```\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61428785/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61757068",
    "html_url": "https://github.com/rust-lang/rust/issues/18310#issuecomment-61757068",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18310",
    "id": 61757068,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNzU3MDY4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-05T04:04:10Z",
    "updated_at": "2014-11-05T04:04:10Z",
    "body": "This has been worked around by https://github.com/rust-lang/rust/commit/dcc5c3b31b294a19c369e7b1926528610230686d and is now fixed in jemalloc by https://github.com/jemalloc/jemalloc/commit/c002a5c80058ee27acb234ef34f69b0cf6836836.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61757068/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
