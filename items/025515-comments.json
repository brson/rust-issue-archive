[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102729675",
    "html_url": "https://github.com/rust-lang/rust/issues/25515#issuecomment-102729675",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25515",
    "id": 102729675,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjcyOTY3NQ==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-17T03:01:35Z",
    "updated_at": "2015-05-17T03:01:46Z",
    "body": "Doesn't occur in 1.0 stable thankfully...\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102729675/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102781689",
    "html_url": "https://github.com/rust-lang/rust/issues/25515#issuecomment-102781689",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25515",
    "id": 102781689,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjc4MTY4OQ==",
    "user": {
      "login": "bluss",
      "id": 3209739,
      "node_id": "MDQ6VXNlcjMyMDk3Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluss",
      "html_url": "https://github.com/bluss",
      "followers_url": "https://api.github.com/users/bluss/followers",
      "following_url": "https://api.github.com/users/bluss/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluss/subscriptions",
      "organizations_url": "https://api.github.com/users/bluss/orgs",
      "repos_url": "https://api.github.com/users/bluss/repos",
      "events_url": "https://api.github.com/users/bluss/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluss/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-17T10:41:58Z",
    "updated_at": "2015-05-17T10:41:58Z",
    "body": "I'll ask this just as a control question, but it's kind of important.\n\nIs it sound that we allow simultaneous access to a value through both `Rc<T>` and `Rc<Trait>` variables? They can both be active at the same time.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102781689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102783541",
    "html_url": "https://github.com/rust-lang/rust/issues/25515#issuecomment-102783541",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25515",
    "id": 102783541,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjc4MzU0MQ==",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-17T11:02:07Z",
    "updated_at": "2015-05-17T11:02:07Z",
    "body": "If a 'normal' Rc is dropped last the problem goes away:\n\n``` rust\n// This works:\nlet _: Rc<Send> = Rc::new(Bass(37)).clone();\n\n// This also works:\nlet a: Rc<Bass> = Rc::new(Bass(37));\nlet _: Rc<Send> = a.clone();\n\n// This triggers the bug:\nlet a: Rc<Bass> = Rc::new(Bass(37));\nlet b: Rc<Send> = a.clone();\ndrop(a);\ndrop(b);\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102783541/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102784817",
    "html_url": "https://github.com/rust-lang/rust/issues/25515#issuecomment-102784817",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25515",
    "id": 102784817,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjc4NDgxNw==",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-17T11:12:59Z",
    "updated_at": "2015-05-17T11:12:59Z",
    "body": "The bug also occurs when you use an unsized type that isn't a trait:\n\n``` rust\n// Same bug.\nlet _: Rc<[Bass]> = Rc::new([Bass(37)]);\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102784817/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102838067",
    "html_url": "https://github.com/rust-lang/rust/issues/25515#issuecomment-102838067",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25515",
    "id": 102838067,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjgzODA2Nw==",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-17T19:25:36Z",
    "updated_at": "2015-05-17T19:25:36Z",
    "body": "It looks like the problem is with `drop_in_place`? The following program exhibits the same problems as Rc:\n\n``` rust\n#![feature(core)]\nstruct Foo(u8);\nimpl Drop for Foo {\n    fn drop(&mut self) { println!(\"Dropped Foo({})\", self.0); self.0 += 1; }\n}\nstruct Holder<T: ?Sized>(T);\nfn main() {\n    unsafe {\n        let ptr = std::mem::transmute::<_, *mut Holder<[Foo; 1]>>(Box::new(Holder([Foo(0)])));\n        let big_ptr: *mut Holder<[Foo]> = ptr;\n        std::intrinsics::drop_in_place(&mut (*big_ptr).0 as *mut _);\n        // leak box memory here :(\n    }\n}\n```\n\nThe same thing happens when we use the following unsafe block in main:\n\n``` rust\n    let ptr = std::mem::transmute::<_, *mut Holder<Foo>>(Box::new(Holder(Foo(0))));\n    let big_ptr: *mut Holder<Send> = ptr;\n    std::intrinsics::drop_in_place(&mut (*big_ptr).0 as *mut _);\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102838067/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102846634",
    "html_url": "https://github.com/rust-lang/rust/issues/25515#issuecomment-102846634",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25515",
    "id": 102846634,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjg0NjYzNA==",
    "user": {
      "login": "pnkfelix",
      "id": 173127,
      "node_id": "MDQ6VXNlcjE3MzEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pnkfelix",
      "html_url": "https://github.com/pnkfelix",
      "followers_url": "https://api.github.com/users/pnkfelix/followers",
      "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}",
      "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions",
      "organizations_url": "https://api.github.com/users/pnkfelix/orgs",
      "repos_url": "https://api.github.com/users/pnkfelix/repos",
      "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pnkfelix/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-17T20:14:20Z",
    "updated_at": "2015-05-17T20:14:20Z",
    "body": "cc me\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102846634/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102849720",
    "html_url": "https://github.com/rust-lang/rust/issues/25515#issuecomment-102849720",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25515",
    "id": 102849720,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjg0OTcyMA==",
    "user": {
      "login": "Thiez",
      "id": 204550,
      "node_id": "MDQ6VXNlcjIwNDU1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Thiez",
      "html_url": "https://github.com/Thiez",
      "followers_url": "https://api.github.com/users/Thiez/followers",
      "following_url": "https://api.github.com/users/Thiez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions",
      "organizations_url": "https://api.github.com/users/Thiez/orgs",
      "repos_url": "https://api.github.com/users/Thiez/repos",
      "events_url": "https://api.github.com/users/Thiez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Thiez/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-17T20:29:17Z",
    "updated_at": "2015-05-17T20:31:41Z",
    "body": "This bug is hilarious:\n\n``` rust\n#![feature(core)]\nstruct Foo(u8);\nimpl Drop for Foo {\n    fn drop(&mut self) { println!(\"Dropped Foo({})\", self.0); self.0 += 1; }\n}\nstruct Holder<T: ?Sized>(T);\nfn main() {\n    unsafe {\n        let mut foo = Holder(Foo(0));\n        &(*(&mut foo as &mut Holder<Send>)).0;\n        &(*(&mut foo as &mut Holder<Send>)).0;\n        &(*(&mut foo as &mut Holder<Send>)).0;\n        std::mem::forget(foo);\n    }\n}\n```\n\nThis prints:\n\n```\nDropped Foo(0)\nDropped Foo(1)\nDropped Foo(2)\n```\n\nYes, we dropped the same Foo three times. The problem is not in `drop_in_place`, the problem is that somehow Foo gets dropped when we take a reference to it through some other object.\n\nEdit: so the bug appeared to be in `drop_in_place` because there we took a reference to the `value` in the `RcBox` and triggered the actual bug.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102849720/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102954485",
    "html_url": "https://github.com/rust-lang/rust/issues/25515#issuecomment-102954485",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25515",
    "id": 102954485,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjk1NDQ4NQ==",
    "user": {
      "login": "ftxqxd",
      "id": 2055302,
      "node_id": "MDQ6VXNlcjIwNTUzMDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2055302?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ftxqxd",
      "html_url": "https://github.com/ftxqxd",
      "followers_url": "https://api.github.com/users/ftxqxd/followers",
      "following_url": "https://api.github.com/users/ftxqxd/following{/other_user}",
      "gists_url": "https://api.github.com/users/ftxqxd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ftxqxd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ftxqxd/subscriptions",
      "organizations_url": "https://api.github.com/users/ftxqxd/orgs",
      "repos_url": "https://api.github.com/users/ftxqxd/repos",
      "events_url": "https://api.github.com/users/ftxqxd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ftxqxd/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-18T07:52:09Z",
    "updated_at": "2015-05-18T07:52:09Z",
    "body": "Looks like this also applies to `Arc` (since e840393).\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102954485/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102954928",
    "html_url": "https://github.com/rust-lang/rust/issues/25515#issuecomment-102954928",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/25515",
    "id": 102954928,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjk1NDkyOA==",
    "user": {
      "login": "ftxqxd",
      "id": 2055302,
      "node_id": "MDQ6VXNlcjIwNTUzMDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2055302?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ftxqxd",
      "html_url": "https://github.com/ftxqxd",
      "followers_url": "https://api.github.com/users/ftxqxd/followers",
      "following_url": "https://api.github.com/users/ftxqxd/following{/other_user}",
      "gists_url": "https://api.github.com/users/ftxqxd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ftxqxd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ftxqxd/subscriptions",
      "organizations_url": "https://api.github.com/users/ftxqxd/orgs",
      "repos_url": "https://api.github.com/users/ftxqxd/repos",
      "events_url": "https://api.github.com/users/ftxqxd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ftxqxd/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2015-05-18T07:55:42Z",
    "updated_at": "2015-05-18T07:55:42Z",
    "body": "@bluss \n\n> Is it sound that we allow simultaneous access to a value through both `Rc<T>` and `Rc<Trait>` variables?\n\nI believe so, since it\u2019s always been possible to do so with `&T` and `&Trait`, and `Rc` isn\u2019t really any different, as far as I know.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/102954928/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
