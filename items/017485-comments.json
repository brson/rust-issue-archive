[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/57891163",
    "html_url": "https://github.com/rust-lang/rust/issues/17485#issuecomment-57891163",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17485",
    "id": 57891163,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3ODkxMTYz",
    "user": {
      "login": "killerswan",
      "id": 195060,
      "node_id": "MDQ6VXNlcjE5NTA2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/195060?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/killerswan",
      "html_url": "https://github.com/killerswan",
      "followers_url": "https://api.github.com/users/killerswan/followers",
      "following_url": "https://api.github.com/users/killerswan/following{/other_user}",
      "gists_url": "https://api.github.com/users/killerswan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/killerswan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/killerswan/subscriptions",
      "organizations_url": "https://api.github.com/users/killerswan/orgs",
      "repos_url": "https://api.github.com/users/killerswan/repos",
      "events_url": "https://api.github.com/users/killerswan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/killerswan/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-04T01:41:34Z",
    "updated_at": "2014-10-04T01:41:34Z",
    "body": "I can't open your file.  Can you put the code in a GitHub repo instead so I can browse it and clone it?\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/57891163/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/57896725",
    "html_url": "https://github.com/rust-lang/rust/issues/17485#issuecomment-57896725",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17485",
    "id": 57896725,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3ODk2NzI1",
    "user": {
      "login": "blastrock",
      "id": 1370530,
      "node_id": "MDQ6VXNlcjEzNzA1MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1370530?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blastrock",
      "html_url": "https://github.com/blastrock",
      "followers_url": "https://api.github.com/users/blastrock/followers",
      "following_url": "https://api.github.com/users/blastrock/following{/other_user}",
      "gists_url": "https://api.github.com/users/blastrock/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blastrock/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blastrock/subscriptions",
      "organizations_url": "https://api.github.com/users/blastrock/orgs",
      "repos_url": "https://api.github.com/users/blastrock/repos",
      "events_url": "https://api.github.com/users/blastrock/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blastrock/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-04T06:54:04Z",
    "updated_at": "2014-10-04T06:54:04Z",
    "body": "Good idea! Sorry, I didn't think of that. Anyway, here it is: https://github.com/blastrock/rustcrash\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/57896725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59646454",
    "html_url": "https://github.com/rust-lang/rust/issues/17485#issuecomment-59646454",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17485",
    "id": 59646454,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NjQ2NDU0",
    "user": {
      "login": "blastrock",
      "id": 1370530,
      "node_id": "MDQ6VXNlcjEzNzA1MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1370530?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blastrock",
      "html_url": "https://github.com/blastrock",
      "followers_url": "https://api.github.com/users/blastrock/followers",
      "following_url": "https://api.github.com/users/blastrock/following{/other_user}",
      "gists_url": "https://api.github.com/users/blastrock/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blastrock/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blastrock/subscriptions",
      "organizations_url": "https://api.github.com/users/blastrock/orgs",
      "repos_url": "https://api.github.com/users/blastrock/repos",
      "events_url": "https://api.github.com/users/blastrock/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blastrock/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-19T11:10:41Z",
    "updated_at": "2014-10-19T11:10:41Z",
    "body": "I think I found it. It comes down to a thread-local variable not being initialized. It is located in librustrt/local_ptr.rs:\n\n```\n    #[thread_local]\n    pub static mut RT_TLS_PTR: *mut u8 = 0 as *mut u8;\n```\n\nThis variable should be initialized by Task, but since we come from a c context, there is no such Task.\n\nI think that I was wrong using a Mutex here since they may pause threads and schedule another task over it, which is not what we want when we come from a c context (which may have locked native mutexes or rely on thread-local storage).\n\nMy code seems to work if I use std::rt::mutex::NativeMutex. If this is the way to go, maybe this documentation should be updated: http://doc.rust-lang.org/guide-ffi.html#asynchronous-callbacks and the error message should be made more explicit.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/59646454/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60011502",
    "html_url": "https://github.com/rust-lang/rust/issues/17485#issuecomment-60011502",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17485",
    "id": 60011502,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMDExNTAy",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-21T22:47:50Z",
    "updated_at": "2014-10-21T22:47:50Z",
    "body": "This is working as designed. It's undefined behaviour to call libstd on threads created outside of the libstd API. You need to use `#![no_std]` to write a library with a normal C API in Rust. Exposing more functionality without this requirement is a work-in-progress.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60011502/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60137294",
    "html_url": "https://github.com/rust-lang/rust/issues/17485#issuecomment-60137294",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17485",
    "id": 60137294,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTM3Mjk0",
    "user": {
      "login": "blastrock",
      "id": 1370530,
      "node_id": "MDQ6VXNlcjEzNzA1MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1370530?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blastrock",
      "html_url": "https://github.com/blastrock",
      "followers_url": "https://api.github.com/users/blastrock/followers",
      "following_url": "https://api.github.com/users/blastrock/following{/other_user}",
      "gists_url": "https://api.github.com/users/blastrock/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blastrock/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blastrock/subscriptions",
      "organizations_url": "https://api.github.com/users/blastrock/orgs",
      "repos_url": "https://api.github.com/users/blastrock/repos",
      "events_url": "https://api.github.com/users/blastrock/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blastrock/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-22T19:03:12Z",
    "updated_at": "2014-10-22T19:03:12Z",
    "body": "I'm not writing a library with a C API, I'm just using a C library. In the documentation link I provided, it is said that it is possible (and I managed to do it with either NativeMutexes or channels). If it is not officially possible, then the documentation should say it.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60137294/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60138378",
    "html_url": "https://github.com/rust-lang/rust/issues/17485#issuecomment-60138378",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17485",
    "id": 60138378,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTM4Mzc4",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-22T19:10:19Z",
    "updated_at": "2014-10-22T19:10:19Z",
    "body": "You're running code from the standard library on a thread it didn't create without manually initializing the runtime on it. That's explicitly not permitted and it is documented.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60138378/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60138945",
    "html_url": "https://github.com/rust-lang/rust/issues/17485#issuecomment-60138945",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17485",
    "id": 60138945,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTM4OTQ1",
    "user": {
      "login": "blastrock",
      "id": 1370530,
      "node_id": "MDQ6VXNlcjEzNzA1MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1370530?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blastrock",
      "html_url": "https://github.com/blastrock",
      "followers_url": "https://api.github.com/users/blastrock/followers",
      "following_url": "https://api.github.com/users/blastrock/following{/other_user}",
      "gists_url": "https://api.github.com/users/blastrock/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blastrock/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blastrock/subscriptions",
      "organizations_url": "https://api.github.com/users/blastrock/orgs",
      "repos_url": "https://api.github.com/users/blastrock/repos",
      "events_url": "https://api.github.com/users/blastrock/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blastrock/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-22T19:14:02Z",
    "updated_at": "2014-10-22T19:14:02Z",
    "body": "Maybe you're right, but I can't find that part in the documentation. What I did read is\n\n> Things get more complicated when the external library spawns its own threads and invokes callbacks from there. In these cases access to Rust data structures inside the callbacks is especially unsafe and proper synchronization mechanisms must be used. Besides classical synchronization mechanisms like mutexes, one possibility in Rust is to use channels (in std::comm) to forward data from the C thread that invoked the callback into a Rust task.\n",
    "author_association": "NONE",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60138945/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60139246",
    "html_url": "https://github.com/rust-lang/rust/issues/17485#issuecomment-60139246",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17485",
    "id": 60139246,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTM5MjQ2",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-22T19:15:52Z",
    "updated_at": "2014-10-22T19:15:52Z",
    "body": "You're free to file bugs about inaccurate parts of the documentation, but the undefined behaviour you're getting is not a bug and is documented elsewhere.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60139246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60139810",
    "html_url": "https://github.com/rust-lang/rust/issues/17485#issuecomment-60139810",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/17485",
    "id": 60139810,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTM5ODEw",
    "user": {
      "login": "thestinger",
      "id": 1505226,
      "node_id": "MDQ6VXNlcjE1MDUyMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thestinger",
      "html_url": "https://github.com/thestinger",
      "followers_url": "https://api.github.com/users/thestinger/followers",
      "following_url": "https://api.github.com/users/thestinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions",
      "organizations_url": "https://api.github.com/users/thestinger/orgs",
      "repos_url": "https://api.github.com/users/thestinger/repos",
      "events_url": "https://api.github.com/users/thestinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thestinger/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-10-22T19:19:49Z",
    "updated_at": "2014-10-22T19:19:49Z",
    "body": "Using Rust in a C callback with the standard library implies the following:\n- the code **must** run on a thread created by Rust\n- the code **must** catch exceptions thrown by Rust and either translate to an error for the C library or abort\n\nAnything else has undefined behaviour.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/60139810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
