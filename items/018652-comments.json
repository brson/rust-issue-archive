[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61911842",
    "html_url": "https://github.com/rust-lang/rust/issues/18652#issuecomment-61911842",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18652",
    "id": 61911842,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTExODQy",
    "user": {
      "login": "abonander",
      "id": 3198595,
      "node_id": "MDQ6VXNlcjMxOTg1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3198595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/abonander",
      "html_url": "https://github.com/abonander",
      "followers_url": "https://api.github.com/users/abonander/followers",
      "following_url": "https://api.github.com/users/abonander/following{/other_user}",
      "gists_url": "https://api.github.com/users/abonander/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/abonander/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/abonander/subscriptions",
      "organizations_url": "https://api.github.com/users/abonander/orgs",
      "repos_url": "https://api.github.com/users/abonander/repos",
      "events_url": "https://api.github.com/users/abonander/events{/privacy}",
      "received_events_url": "https://api.github.com/users/abonander/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-06T01:09:08Z",
    "updated_at": "2014-11-06T01:09:08Z",
    "body": "```\n$ rustc issue_18652.rs \nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' panicked at 'assertion failed: freevars.len() <= 1', /home/rustbuild/src/rust-buildbot/slave/nightly-linux/build/src/librustc/middle/trans/closure.rs:325\n\nstack backtrace:\n   1:     0x7f9ccb3cd8e0 - rt::backtrace::imp::write::h90851ece7c054d3bTVp\n   2:     0x7f9ccb3d0960 - failure::on_fail::hc015761685342dd1vhq\n   3:     0x7f9ccbb7fa20 - unwind::begin_unwind_inner::hf5743de3e545b8bbZSd\n   4:     0x7f9ccbf59820 - unwind::begin_unwind::h12836636821598676233\n   5:     0x7f9ccc3bec60 - middle::trans::closure::trans_unboxed_closure::closure.127438\n   6:     0x7f9ccc3907f0 - middle::trans::base::trans_closure::h0ee0e830d5f57196BNh\n   7:     0x7f9ccc33e380 - middle::trans::closure::trans_unboxed_closure::h10dd08b60eae5c99h9l\n   8:     0x7f9ccc329860 - middle::trans::expr::trans_rvalue_dps_unadjusted::hbba4faa267b036ffeM6\n   9:     0x7f9ccc2ef050 - middle::trans::expr::trans_into::haccb966391cea9aedn5\n  10:     0x7f9ccc2ee4b0 - middle::trans::controlflow::trans_stmt_semi::h4d0d2d7f5be74d97ZC1\n  11:     0x7f9ccc2eda60 - middle::trans::controlflow::trans_stmt::h6a80ddbefaced6ffMy1\n  12:     0x7f9ccc2ef470 - middle::trans::controlflow::trans_block::h76660195897ae193SD1\n  13:     0x7f9ccc3907f0 - middle::trans::base::trans_closure::h0ee0e830d5f57196BNh\n  14:     0x7f9ccc2e2530 - middle::trans::base::trans_fn::h9de5c2dcb3f96df5wZh\n  15:     0x7f9ccc2dfc20 - middle::trans::base::trans_item::h5f88c04c36ef66aaKii\n  16:     0x7f9ccc39b160 - middle::trans::base::trans_crate::heef2f92cab82a2c9Lgj\n  17:     0x7f9ccc818b30 - driver::driver::phase_4_translate_to_llvm::h424d161d8e05b6883UB\n  18:     0x7f9ccc80f320 - driver::driver::compile_input::h0cb1ebcd11f34cd6XrB\n  19:     0x7f9ccc893a60 - driver::run_compiler::h92ab17fc93f0a323giF\n  20:     0x7f9ccc893950 - driver::run::closure.146866\n  21:     0x7f9ccbf915f0 - task::TaskBuilder<S>::try_future::closure.104323\n  22:     0x7f9ccbf913e0 - task::TaskBuilder<S>::spawn_internal::closure.104294\n  23:     0x7f9ccd121b90 - task::NativeSpawner.Spawner::spawn::closure.8440\n  24:     0x7f9ccbbd5510 - rust_try_inner\n  25:     0x7f9ccbbd5500 - rust_try\n  26:     0x7f9ccbb7d370 - unwind::try::h9b7bcf92a04d9d42jHd\n  27:     0x7f9ccbb7d200 - task::Task::run::h74a092677bc826a59Mc\n  28:     0x7f9ccd1218d0 - task::NativeSpawner.Spawner::spawn::closure.8378\n  29:     0x7f9ccbb7ea10 - thread::thread_start::h7ebb3af704f6e202o8c\n  30:     0x7f9ccae9e0c0 - start_thread\n  31:     0x7f9ccb848f89 - __clone\n  32:                0x0 - <unknown>\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/61911842/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62093424",
    "html_url": "https://github.com/rust-lang/rust/issues/18652#issuecomment-62093424",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/18652",
    "id": 62093424,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMDkzNDI0",
    "user": {
      "login": "bkoropoff",
      "id": 2101303,
      "node_id": "MDQ6VXNlcjIxMDEzMDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2101303?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bkoropoff",
      "html_url": "https://github.com/bkoropoff",
      "followers_url": "https://api.github.com/users/bkoropoff/followers",
      "following_url": "https://api.github.com/users/bkoropoff/following{/other_user}",
      "gists_url": "https://api.github.com/users/bkoropoff/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bkoropoff/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bkoropoff/subscriptions",
      "organizations_url": "https://api.github.com/users/bkoropoff/orgs",
      "repos_url": "https://api.github.com/users/bkoropoff/repos",
      "events_url": "https://api.github.com/users/bkoropoff/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bkoropoff/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-11-07T04:10:50Z",
    "updated_at": "2014-11-07T04:10:50Z",
    "body": "We take the branch in question as an optimization when the closure is less than or equal to the size of an `int`:\n\n``` rust\n            llsize_of_alloc(ccx, llty) <= llsize_of_alloc(ccx, ccx.int_type())\n```\n\nThe assert seems to assume that this can only happen if the closure has 1 or 0 free variables, but it's trivial to have several smaller variables packed into the space of an `int`.  The following also ICEs in the same way:\n\n``` rust\n#![feature(unboxed_closures)]\n\nfn main() {\n    let x = 0u16;\n    let y = 0u16;\n    move |:| x + y;\n}\n```\n\nIn the original example, `Foo` is zero-sized so the overall closure fits in an `int`.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/62093424/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
