[
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52691198",
    "html_url": "https://github.com/rust-lang/rust/issues/16609#issuecomment-52691198",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16609",
    "id": 52691198,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjkxMTk4",
    "user": {
      "login": "Gankra",
      "id": 1136864,
      "node_id": "MDQ6VXNlcjExMzY4NjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gankra",
      "html_url": "https://github.com/Gankra",
      "followers_url": "https://api.github.com/users/Gankra/followers",
      "following_url": "https://api.github.com/users/Gankra/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions",
      "organizations_url": "https://api.github.com/users/Gankra/orgs",
      "repos_url": "https://api.github.com/users/Gankra/repos",
      "events_url": "https://api.github.com/users/Gankra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gankra/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-19T20:09:50Z",
    "updated_at": "2014-08-19T20:09:50Z",
    "body": "You need to .take() the Option:\n\n```\nstruct Foo {\n    x: Option<Rc<()>>,\n}\n\nimpl Foo {\n    fn foo(&mut self) {\n        self.x = match self.x.take() {\n            None => { Some(Rc::new(())) },\n            Some(bar) => { Some(bar) },\n        }\n    }\n}\n```\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52691198/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52691509",
    "html_url": "https://github.com/rust-lang/rust/issues/16609#issuecomment-52691509",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16609",
    "id": 52691509,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjkxNTA5",
    "user": {
      "login": "bfops",
      "id": 196249,
      "node_id": "MDQ6VXNlcjE5NjI0OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/196249?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bfops",
      "html_url": "https://github.com/bfops",
      "followers_url": "https://api.github.com/users/bfops/followers",
      "following_url": "https://api.github.com/users/bfops/following{/other_user}",
      "gists_url": "https://api.github.com/users/bfops/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bfops/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bfops/subscriptions",
      "organizations_url": "https://api.github.com/users/bfops/orgs",
      "repos_url": "https://api.github.com/users/bfops/repos",
      "events_url": "https://api.github.com/users/bfops/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bfops/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-19T20:12:16Z",
    "updated_at": "2014-08-19T20:18:35Z",
    "body": "The `Option` was just for simplicity. The basic problem exists for any Enums with movable contents.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52691509/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52693298",
    "html_url": "https://github.com/rust-lang/rust/issues/16609#issuecomment-52693298",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16609",
    "id": 52693298,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjkzMjk4",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-19T20:25:29Z",
    "updated_at": "2014-08-19T20:25:29Z",
    "body": "This is currently intended behavior, consider something like:\n\n``` rust\nstruct Foo {\n    x: Option<Rc<()>>,\n}\n\nfn foo() -> Rc<()> { fail!() }\n\nimpl Foo {\n    fn foo(&mut self) {\n        match self.x {\n            None => self.x = foo(),\n            x => self.x = x,\n        }\n    }\n}\n```\n\nIn this code, the destructor of `self` would view uninitialized memory while unwinding after calling `foo` (`self.x` is uninitialized).\n\nI believe that @nikomatsakis has some ideas of how this may be allowable, but this is a restriction required for safety today, so I'm going to close this as working as intended.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52693298/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52694462",
    "html_url": "https://github.com/rust-lang/rust/issues/16609#issuecomment-52694462",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16609",
    "id": 52694462,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjk0NDYy",
    "user": {
      "login": "bfops",
      "id": 196249,
      "node_id": "MDQ6VXNlcjE5NjI0OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/196249?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bfops",
      "html_url": "https://github.com/bfops",
      "followers_url": "https://api.github.com/users/bfops/followers",
      "following_url": "https://api.github.com/users/bfops/following{/other_user}",
      "gists_url": "https://api.github.com/users/bfops/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bfops/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bfops/subscriptions",
      "organizations_url": "https://api.github.com/users/bfops/orgs",
      "repos_url": "https://api.github.com/users/bfops/repos",
      "events_url": "https://api.github.com/users/bfops/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bfops/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-19T20:34:15Z",
    "updated_at": "2014-08-19T20:34:31Z",
    "body": "I don't see how `self.x` is uninitialized after the call to `foo()`. It's explicitly written to in every branch in `foo`.\n\nThe code you've given works for this case, but what if I actually want to _use_ the movable contents? I have octree code that looks like:\n\n```\nmatch self.contents {\n  Leaf(mut vs) => {\n    if time_to_bisect {\n      let (low, high) = Octree::bisect(vs);\n      self.contents = Branch(Branches { low_tree: box low, high_tree: box high });\n    } else {\n      ...\n    }\n  },\n  Branch(mut b) => {\n      ...\n  },\n}\n```\n\nWhen bisecting a leaf, I really do want to destruct the contents of the leaf in the process of updating the `Octree`. Right now, the best I can do is return a copy and then overwrite `self.contents` after the match is completed.\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52694462/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52694837",
    "html_url": "https://github.com/rust-lang/rust/issues/16609#issuecomment-52694837",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16609",
    "id": 52694837,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjk0ODM3",
    "user": {
      "login": "alexcrichton",
      "id": 64996,
      "node_id": "MDQ6VXNlcjY0OTk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcrichton",
      "html_url": "https://github.com/alexcrichton",
      "followers_url": "https://api.github.com/users/alexcrichton/followers",
      "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcrichton/orgs",
      "repos_url": "https://api.github.com/users/alexcrichton/repos",
      "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcrichton/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-19T20:36:56Z",
    "updated_at": "2014-08-19T20:36:56Z",
    "body": "`self.x` is only initialized _after_ the call to `foo()`, not before. Because the call to `foo()` fails, the destructor will view uninitialized memory.\n\nIn your code you also have to worry about failure of `Octree::bisect` or the `else` branch (or the `Branch` branch). Any failure will cause `self` to run a destructor on uninitialized contents.\n",
    "author_association": "MEMBER",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52694837/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52844995",
    "html_url": "https://github.com/rust-lang/rust/issues/16609#issuecomment-52844995",
    "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/16609",
    "id": 52844995,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyODQ0OTk1",
    "user": {
      "login": "bfops",
      "id": 196249,
      "node_id": "MDQ6VXNlcjE5NjI0OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/196249?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bfops",
      "html_url": "https://github.com/bfops",
      "followers_url": "https://api.github.com/users/bfops/followers",
      "following_url": "https://api.github.com/users/bfops/following{/other_user}",
      "gists_url": "https://api.github.com/users/bfops/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bfops/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bfops/subscriptions",
      "organizations_url": "https://api.github.com/users/bfops/orgs",
      "repos_url": "https://api.github.com/users/bfops/repos",
      "events_url": "https://api.github.com/users/bfops/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bfops/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "created_at": "2014-08-20T21:12:42Z",
    "updated_at": "2014-08-20T21:12:42Z",
    "body": "My mistake, I misunderstood. That makes sense now, thanks!\n",
    "author_association": "CONTRIBUTOR",
    "reactions": {
      "url": "https://api.github.com/repos/rust-lang/rust/issues/comments/52844995/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
